<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0">
<channel>
<title><![CDATA[流浪的龙－个人知识管理]]></title> 
<link>http://i.renjihe.com/blog/index.php</link> 
<description><![CDATA[]]></description> 
<language>zh-cn</language> 
<copyright><![CDATA[流浪的龙－个人知识管理]]></copyright>
<item>
<link>http://i.renjihe.com/blog/read.php?</link>
<title><![CDATA[Node.js最新技术栈之Promise篇]]></title> 
<author>renjihe1988 &lt;admin@yourname.com&gt;</author>
<category><![CDATA[web]]></category>
<pubDate>Mon, 29 Aug 2016 06:35:22 +0000</pubDate> 
<guid>http://i.renjihe.com/blog/read.php?</guid> 
<description>
<![CDATA[ 
	<p style="margin: 0px 0px 1em; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">时间原因，阉割了很多内容，其实内容少点应该更容易理解的，以下是直播的全部内容</p><h1 style="margin: 30px 0px 15px; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; line-height: 40px; color: #333333; text-rendering: optimizeLegibility; font-size: 32.5px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #eeeeee">前言</h1><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">大家好，我是桑世龙，github和cnodejs上的i5ting，目前在天津创业，公司目前使用技术主要是nodejs，算所谓的MEAN（mongodb&nbsp;&nbsp;+ express + angular + node），所有代码都部署在阿里云上</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">我的名字i5ting，原因是我媳妇叫张婷，哈哈</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">闲言少叙，下面开始正题 《Node.js最新技术栈之Promise篇》</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">js流程控制的演进过程，分以下5部分</p><ul style="padding: 0px; margin: 0px 0px 10px 25px; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; font-size: 14px; line-height: 28px"><li style="line-height: 2em"><ol style="padding: 0px; margin: 0px 0px 0px 25px"><li style="line-height: 2em">回调函数Callbacks</li></ol></li><li style="line-height: 2em"><ol style="padding: 0px; margin: 0px 0px 0px 25px"><li style="line-height: 2em">异步JavaScript</li></ol></li><li style="line-height: 2em"><ol style="padding: 0px; margin: 0px 0px 0px 25px"><li style="line-height: 2em">Promise/a+</li></ol></li><li style="line-height: 2em"><ol style="padding: 0px; margin: 0px 0px 0px 25px"><li style="line-height: 2em">生成器Generators/ yield</li></ol></li><li style="line-height: 2em"><ol style="padding: 0px; margin: 0px 0px 0px 25px"><li style="line-height: 2em">Async/ await</li></ol></li></ul><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif"><img style="height: auto; max-width: 100%; vertical-align: middle; border: 0px; cursor: pointer" src="http://dn-cnode.qbox.me/FgKu20kvFqHrkgpjbQxXkV1DmrG1" border="0" alt="1.png" /></p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">首先回调和异步是大家常见的，这里跳过，本节课主要讲promise/a+原理、实现和实践，并展望下一代的Generators/yield和Async/await等。</p><h1 style="margin: 30px 0px 15px; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; line-height: 40px; color: #333333; text-rendering: optimizeLegibility; font-size: 32.5px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #eeeeee">0）痛点</h1><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">我们知道nodejs的最大的优点是高并发，适合适合I/O密集型应用</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif"><img style="height: auto; max-width: 100%; vertical-align: middle; border: 0px; cursor: pointer" src="http://dn-cnode.qbox.me/FlPgjSEeYky4OEsdWokPlzTnQVln" border="0" alt="arch.png" /></p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">每一个函数都是异步，并发上去了，但痛苦也来了，比如</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">我现在要执行4个步骤，依次执行，于是就有下面的代码</p><pre class="prettyprint" style="line-height: 22px; white-space: pre-wrap; padding: 0px 15px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 14px; color: #333333; border-radius: 0px; margin: 20px -10px; word-break: break-all; word-wrap: break-word; border-width: 1px 0px; border-style: none; border-color: initial; background: #f7f7f7"><span style="color: #000000" class="pln">step1</span><span style="color: #666600" class="pun">(</span><span style="color: #000088" class="kwd">function</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">value1</span><span style="color: #666600" class="pun">)</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; step2</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">value1</span><span style="color: #666600" class="pun">,</span><span style="color: #000000" class="pln"> </span><span style="color: #000088" class="kwd">function</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">value2</span><span style="color: #666600" class="pun">)</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; step3</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">value2</span><span style="color: #666600" class="pun">,</span><span style="color: #000000" class="pln"> </span><span style="color: #000088" class="kwd">function</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">value3</span><span style="color: #666600" class="pun">)</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; step4</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">value3</span><span style="color: #666600" class="pun">,</span><span style="color: #000000" class="pln"> </span><span style="color: #000088" class="kwd">function</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">value4</span><span style="color: #666600" class="pun">)</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #880000" class="com">// Do something with value4</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #666600" class="pun">&#125;);</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #666600" class="pun">&#125;);</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #666600" class="pun">&#125;);</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#125;);</span></pre><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">这里只有4个，那如果更多呢？会不会崩溃，反正我会</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">有解决办法么？</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">答案是就是：promise/a+规范，下面我们看一下promise/a+规范</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">我们再来个伏笔，看一下链式写法</p><h1 style="margin: 30px 0px 15px; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; line-height: 40px; color: #333333; text-rendering: optimizeLegibility; font-size: 32.5px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #eeeeee">链式写法</h1><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">先举个jQuery的链式写法例子</p><pre class="prettyprint" style="line-height: 22px; white-space: pre-wrap; padding: 0px 15px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 14px; color: #333333; border-radius: 0px; margin: 20px -10px; word-break: break-all; word-wrap: break-word; border-width: 1px 0px; border-style: none; border-color: initial; background: #f7f7f7"><span style="color: #000000" class="pln">$</span><span style="color: #666600" class="pun">(</span><span style="color: #008800" class="str">'#tab'</span><span style="color: #666600" class="pun">).</span><span style="color: #000000" class="pln">eq</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">$</span><span style="color: #666600" class="pun">(</span><span style="color: #000088" class="kwd">this</span><span style="color: #666600" class="pun">).</span><span style="color: #000000" class="pln">index</span><span style="color: #666600" class="pun">()).</span><span style="color: #000000" class="pln">show</span><span style="color: #666600" class="pun">().</span><span style="color: #000000" class="pln">siblings</span><span style="color: #666600" class="pun">().</span><span style="color: #000000" class="pln">hide</span><span style="color: #666600" class="pun">();</span></pre><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">链式写法的核心是：每个方法都返回this（自己看jquery源码）</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">下面举一个this的简单例子</p><pre class="prettyprint" style="line-height: 22px; white-space: pre-wrap; padding: 0px 15px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 14px; color: #333333; border-radius: 0px; margin: 20px -10px; word-break: break-all; word-wrap: break-word; border-width: 1px 0px; border-style: none; border-color: initial; background: #f7f7f7"><span style="color: #000088" class="kwd">var</span><span style="color: #000000" class="pln"> obj </span><span style="color: #666600" class="pun">=</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp; step1</span><span style="color: #666600" class="pun">:</span><span style="color: #000088" class="kwd">function</span><span style="color: #666600" class="pun">()&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; console</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">log</span><span style="color: #666600" class="pun">(</span><span style="color: #008800" class="str">'a'</span><span style="color: #666600" class="pun">);</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #000088" class="kwd">return</span><span style="color: #000000" class="pln"> </span><span style="color: #000088" class="kwd">this</span><span style="color: #666600" class="pun">;</span><span style="color: #000000" class="pln">&nbsp;&nbsp; </span><span style="color: #666600" class="pun">&#125;,</span><span style="color: #000000" class="pln">&nbsp;&nbsp; step2</span><span style="color: #666600" class="pun">:</span><span style="color: #000088" class="kwd">function</span><span style="color: #666600" class="pun">()&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; console</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">log</span><span style="color: #666600" class="pun">(</span><span style="color: #008800" class="str">'b'</span><span style="color: #666600" class="pun">);</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #000088" class="kwd">return</span><span style="color: #000000" class="pln"> </span><span style="color: #000088" class="kwd">this</span><span style="color: #666600" class="pun">;</span><span style="color: #000000" class="pln">&nbsp;&nbsp; </span><span style="color: #666600" class="pun">&#125;,</span><span style="color: #000000" class="pln">&nbsp;&nbsp; step3</span><span style="color: #666600" class="pun">:</span><span style="color: #000088" class="kwd">function</span><span style="color: #666600" class="pun">()&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; console</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">log</span><span style="color: #666600" class="pun">(</span><span style="color: #008800" class="str">'c'</span><span style="color: #666600" class="pun">);</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #000088" class="kwd">return</span><span style="color: #000000" class="pln"> </span><span style="color: #000088" class="kwd">this</span><span style="color: #666600" class="pun">;</span><span style="color: #000000" class="pln">&nbsp;&nbsp; </span><span style="color: #666600" class="pun">&#125;,</span><span style="color: #000000" class="pln">&nbsp;&nbsp; step4</span><span style="color: #666600" class="pun">:</span><span style="color: #000088" class="kwd">function</span><span style="color: #666600" class="pun">()&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; console</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">log</span><span style="color: #666600" class="pun">(</span><span style="color: #008800" class="str">'d'</span><span style="color: #666600" class="pun">);</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #000088" class="kwd">return</span><span style="color: #000000" class="pln"> </span><span style="color: #000088" class="kwd">this</span><span style="color: #666600" class="pun">;</span><span style="color: #000000" class="pln">&nbsp;&nbsp; </span><span style="color: #666600" class="pun">&#125;</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#125;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;console</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">log</span><span style="color: #666600" class="pun">(</span><span style="color: #008800" class="str">'-----&#92;n'</span><span style="color: #666600" class="pun">);</span><span style="color: #000000" class="pln"> obj</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">step1</span><span style="color: #666600" class="pun">().</span><span style="color: #000000" class="pln">step2</span><span style="color: #666600" class="pun">().</span><span style="color: #000000" class="pln">step3</span><span style="color: #666600" class="pun">();</span><span style="color: #000000" class="pln"> console</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">log</span><span style="color: #666600" class="pun">(</span><span style="color: #008800" class="str">'-----&#92;n'</span><span style="color: #666600" class="pun">);</span><span style="color: #000000" class="pln"> obj</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">step4</span><span style="color: #666600" class="pun">().</span><span style="color: #000000" class="pln">step2</span><span style="color: #666600" class="pun">().</span><span style="color: #000000" class="pln">step1</span><span style="color: #666600" class="pun">();</span></pre><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">这只是一个简单返回this的链式写法而已</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">执行结果</p><pre class="prettyprint" style="line-height: 22px; white-space: pre-wrap; padding: 0px 15px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 14px; color: #333333; border-radius: 0px; margin: 20px -10px; word-break: break-all; word-wrap: break-word; border-width: 1px 0px; border-style: none; border-color: initial; background: #f7f7f7"><span style="color: #000000" class="pln">$ node doc</span><span style="color: #666600" class="pun">/</span><span style="color: #000088" class="kwd">this</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">js </span><span style="color: #666600" class="pun">-----</span><span style="color: #000000" class="pln">&nbsp;&nbsp;a b c </span><span style="color: #666600" class="pun">-----</span><span style="color: #000000" class="pln">&nbsp;&nbsp;c b a</span></pre><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">为啥要讲这个呢？先回到异步调用的场景，我们能这样调用么？如果每一个操作都可以连起来，是不是很爽</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">比如</p><pre class="prettyprint" style="line-height: 22px; white-space: pre-wrap; padding: 0px 15px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 14px; color: #333333; border-radius: 0px; margin: 20px -10px; word-break: break-all; word-wrap: break-word; border-width: 1px 0px; border-style: none; border-color: initial; background: #f7f7f7"><span style="color: #000088" class="kwd">return</span><span style="color: #000000" class="pln"> step1</span><span style="color: #666600" class="pun">().</span><span style="color: #000000" class="pln">step2</span><span style="color: #666600" class="pun">().</span><span style="color: #000000" class="pln">step3</span><span style="color: #666600" class="pun">().</span><span style="color: #000000" class="pln">step4</span><span style="color: #666600" class="pun">()</span></pre><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">这样做的好处</p><ul style="padding: 0px; margin: 0px 0px 10px 25px; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; font-size: 14px; line-height: 28px"><li style="line-height: 2em">1）每一个操作都是独立的函数</li><li style="line-height: 2em">2）可组装，拼就好了</li></ul><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">我们还可以再苛刻点</p><ul style="padding: 0px; margin: 0px 0px 10px 25px; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; font-size: 14px; line-height: 28px"><li style="line-height: 2em">1）如果要是上一步的结果作为下一步的输入就更好了（linux里的pipe：ps -ef&#124;grep node&#124;awk &lsquo;&#123;print $2&#125;&rsquo;&#124;xargs kill -9）</li><li style="line-height: 2em">2）如果出错能捕获异常就更好了</li><li style="line-height: 2em">3）如果能在函数里面也能控制流程就更好了</li></ul><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">会有人说：&ldquo;你要求的是不是太多了？&rdquo;</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">&ldquo;but，很好，我们来制定一个叫promisesaplus的规范吧，涵盖上面的所有内容&rdquo;</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">于是就有了promise/a+规范&hellip;</p><h1 style="margin: 30px 0px 15px; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; line-height: 40px; color: #333333; text-rendering: optimizeLegibility; font-size: 32.5px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #eeeeee">1）promise/a+规范</h1><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">这里面讲很多链式相关的东西，是我们异步操作里常见的问题，我们希望有更好的解决方案，promise/a+规范便应运而生</p><h2 style="margin: 30px 0px 15px; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; line-height: 40px; color: #333333; text-rendering: optimizeLegibility; font-size: 26px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #eeeeee">什么是promise/a+规范？</h2><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">Promise表示一个异步操作的最终结果。与Promise最主要的交互方法是通过将函数传入它的then方法从而获取得Promise最终的值或Promise最终最拒绝（reject）的原因。</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">想想我们刚才的那个例子，让我们来庖解一下</p><ul style="padding: 0px; margin: 0px 0px 10px 25px; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; font-size: 14px; line-height: 28px"><li style="line-height: 2em">a) 异步操作的最终结果</li></ul><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">简单点看，它也是一个链式操作,类似</p><pre class="prettyprint" style="line-height: 22px; white-space: pre-wrap; padding: 0px 15px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 14px; color: #333333; border-radius: 0px; margin: 20px -10px; word-break: break-all; word-wrap: break-word; border-width: 1px 0px; border-style: none; border-color: initial; background: #f7f7f7"><span style="color: #000088" class="kwd">return</span><span style="color: #000000" class="pln"> step1</span><span style="color: #666600" class="pun">().</span><span style="color: #000000" class="pln">step2</span><span style="color: #666600" class="pun">().</span><span style="color: #000000" class="pln">step3</span><span style="color: #666600" class="pun">().</span><span style="color: #000000" class="pln">step4</span><span style="color: #666600" class="pun">()</span></pre><ul style="padding: 0px; margin: 0px 0px 10px 25px; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; font-size: 14px; line-height: 28px"><li style="line-height: 2em">b) 与Promise最主要的交互方法是通过将函数传入它的then方法</li></ul><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">但它有点差别</p><pre class="prettyprint" style="line-height: 22px; white-space: pre-wrap; padding: 0px 15px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 14px; color: #333333; border-radius: 0px; margin: 20px -10px; word-break: break-all; word-wrap: break-word; border-width: 1px 0px; border-style: none; border-color: initial; background: #f7f7f7"><span style="color: #000088" class="kwd">return</span><span style="color: #000000" class="pln"> step1</span><span style="color: #666600" class="pun">().</span><span style="color: #000088" class="kwd">then</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">step2</span><span style="color: #666600" class="pun">).</span><span style="color: #000088" class="kwd">then</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">step3</span><span style="color: #666600" class="pun">).</span><span style="color: #000088" class="kwd">then</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">step4</span><span style="color: #666600" class="pun">)</span></pre><ul style="padding: 0px; margin: 0px 0px 10px 25px; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; font-size: 14px; line-height: 28px"><li style="line-height: 2em">c1) 从而获取得Promise最终的值或Promise最终最拒绝（reject）的原因</li></ul><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">比如step1执行成功了，那么就会执行step2，如果step2执行成功了就会执行下一个，以此类推</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">那么如果失败呢？于是应该改成这样：</p><pre class="prettyprint" style="line-height: 22px; white-space: pre-wrap; padding: 0px 15px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 14px; color: #333333; border-radius: 0px; margin: 20px -10px; word-break: break-all; word-wrap: break-word; border-width: 1px 0px; border-style: none; border-color: initial; background: #f7f7f7"><span style="color: #000088" class="kwd">return</span><span style="color: #000000" class="pln"> step1</span><span style="color: #666600" class="pun">().</span><span style="color: #000088" class="kwd">then</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">step2</span><span style="color: #666600" class="pun">).</span><span style="color: #000088" class="kwd">then</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">step3</span><span style="color: #666600" class="pun">).</span><span style="color: #000088" class="kwd">then</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">step4</span><span style="color: #666600" class="pun">).</span><span style="color: #000088" class="kwd">catch</span><span style="color: #666600" class="pun">(</span><span style="color: #000088" class="kwd">function</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">err</span><span style="color: #666600" class="pun">)&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp; </span><span style="color: #880000" class="com">// do something when err</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#125;);</span></pre><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">加了一个catch error回调，当出现异常就会直接到这个流程，会不会很好呢？</p><ul style="padding: 0px; margin: 0px 0px 10px 25px; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; font-size: 14px; line-height: 28px"><li style="line-height: 2em">c2) 从而获取得Promise最终的值或Promise最终最拒绝（reject）的原因</li></ul><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">这句话了有一个reject，其实还对应一个resolve方法</p><ul style="padding: 0px; margin: 0px 0px 10px 25px; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; font-size: 14px; line-height: 28px"><li style="line-height: 2em">reject 是拒绝，跳转到catch error</li><li style="line-height: 2em">resolve 是解决，下一步，即跳转到下一个promise操作</li></ul><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">我们还以上面的例子来说，如果step1失败了，走step3，step3失败了step4,如果step4出错就结束，报错，看一下代码</p><pre class="prettyprint" style="line-height: 22px; white-space: pre-wrap; padding: 0px 15px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 14px; color: #333333; border-radius: 0px; margin: 20px -10px; word-break: break-all; word-wrap: break-word; border-width: 1px 0px; border-style: none; border-color: initial; background: #f7f7f7"><span style="color: #000088" class="kwd">function</span><span style="color: #000000" class="pln"> step1</span><span style="color: #666600" class="pun">()&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp; </span><span style="color: #000088" class="kwd">if</span><span style="color: #666600" class="pun">(</span><span style="color: #000088" class="kwd">false</span><span style="color: #666600" class="pun">)&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #000088" class="kwd">return</span><span style="color: #000000" class="pln"> step3</span><span style="color: #666600" class="pun">().</span><span style="color: #000088" class="kwd">then</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">step4</span><span style="color: #666600" class="pun">).</span><span style="color: #000088" class="kwd">catch</span><span style="color: #666600" class="pun">(</span><span style="color: #000088" class="kwd">function</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">err</span><span style="color: #666600" class="pun">)&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #880000" class="com">// do something when err</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #666600" class="pun">&#125;);</span><span style="color: #000000" class="pln">&nbsp;&nbsp; </span><span style="color: #666600" class="pun">&#125;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #666600" class="pun">&#125;</span><span style="color: #000000" class="pln"> </span><span style="color: #000088" class="kwd">return</span><span style="color: #000000" class="pln"> step1</span><span style="color: #666600" class="pun">().</span><span style="color: #000088" class="kwd">then</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">step2</span><span style="color: #666600" class="pun">).</span><span style="color: #000088" class="kwd">then</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">step3</span><span style="color: #666600" class="pun">).</span><span style="color: #000088" class="kwd">then</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">step4</span><span style="color: #666600" class="pun">).</span><span style="color: #000088" class="kwd">catch</span><span style="color: #666600" class="pun">(</span><span style="color: #000088" class="kwd">function</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">err</span><span style="color: #666600" class="pun">)&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp; </span><span style="color: #880000" class="com">// do something when err</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#125;);</span></pre><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">总结一下：以上就是promise/a+规范的定义，我们拆解了一下，涵盖了上面我提出的几个痛点</p><h2 style="margin: 30px 0px 15px; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; line-height: 40px; color: #333333; text-rendering: optimizeLegibility; font-size: 26px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #eeeeee">术语</h2><h3 style="margin: 30px 0px 15px; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; line-height: 40px; color: #333333; text-rendering: optimizeLegibility; font-size: 24.5px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #eeeeee">promise</h3><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">是一个包含了兼容promise规范then方法的对象或函数</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">我们可以这样理解，每一个promise只要返回的可以then的都可以。就像上面举例返回的this一样，只要每一个都返回this，她就可以无限的链式下去，</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">这里的this约定为每一个对象或函数返回的都是兼容promise规范then方法。</p><h3 style="margin: 30px 0px 15px; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; line-height: 40px; color: #333333; text-rendering: optimizeLegibility; font-size: 24.5px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #eeeeee">thenable</h3><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">是一个包含了then方法的对象或函数。</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">这个可以这样理解，上面的例子，每个方法都返回this，比较麻烦，</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">那能不能只有then方法promise对象，每一个操作都返回一样的promise对象，是不是就可以无限链接下去了？</p><h3 style="margin: 30px 0px 15px; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; line-height: 40px; color: #333333; text-rendering: optimizeLegibility; font-size: 24.5px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #eeeeee">value</h3><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">是任何Javascript值。 (包括 undefined, thenable, promise等).</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">promise/a+规范约定的几个概念而已</p><h3 style="margin: 30px 0px 15px; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; line-height: 40px; color: #333333; text-rendering: optimizeLegibility; font-size: 24.5px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #eeeeee">exception</h3><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">是由throw表达式抛出来的值。</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">上面讲的，当流程出现异常的适合，把异常抛出来，由catch err处理。</p><h3 style="margin: 30px 0px 15px; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; line-height: 40px; color: #333333; text-rendering: optimizeLegibility; font-size: 24.5px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #eeeeee">reason</h3><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">是一个用于描述Promise被拒绝原因的值。</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">就是给你一个犯了错误，自我交待，争取宽大处理的机会。</p><h2 style="margin: 30px 0px 15px; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; line-height: 40px; color: #333333; text-rendering: optimizeLegibility; font-size: 26px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #eeeeee">参考</h2><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">还有一些promise里流程处理相关的东西，比较复杂，没啥大意义，有兴趣的可以看看官方网址</p><ul style="padding: 0px; margin: 0px 0px 10px 25px; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; font-size: 14px; line-height: 28px"><li style="line-height: 2em"><a style="color: #0088cc; text-decoration: none" href="https://promisesaplus.com/" target="_blank">https://promisesaplus.com/</a></li></ul><h2 style="margin: 30px 0px 15px; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; line-height: 40px; color: #333333; text-rendering: optimizeLegibility; font-size: 26px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #eeeeee">总结一下</h2><ul style="padding: 0px; margin: 0px 0px 10px 25px; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; font-size: 14px; line-height: 28px"><li style="line-height: 2em"><ol style="padding: 0px; margin: 0px 0px 0px 25px"><li style="line-height: 2em">每个操作都返回一样的promise对象，保证链式操作</li></ol></li><li style="line-height: 2em"><ol style="padding: 0px; margin: 0px 0px 0px 25px"><li style="line-height: 2em">每个链式都通过then方法</li></ol></li><li style="line-height: 2em"><ol style="padding: 0px; margin: 0px 0px 0px 25px"><li style="line-height: 2em">每个操作内部允许犯错，出了错误，统一由catch error处理</li></ol></li><li style="line-height: 2em"><ol style="padding: 0px; margin: 0px 0px 0px 25px"><li style="line-height: 2em">操作内部，也可以是一个操作链，通过reject或resolve再造流程</li></ol></li></ul><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">理解这些，实际上nodejs里就没有啥难点了。当然我还要告诉更多好处，让你受益一生（吹吹牛）</p><h2 style="margin: 30px 0px 15px; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; line-height: 40px; color: #333333; text-rendering: optimizeLegibility; font-size: 26px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #eeeeee">八卦一下</h2><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">哪个语言不需要回调呢？callback并不是js所特有的，举个例子oc里的block（如果愿意扯，也可以扯扯函数指针），如果用asi或者afnetworking处理http请求，你都可以选择用block方式，那么你如果一个业务里有多个请求呢？</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">你也只能嵌套，因为嵌套没有太多层，因为可以有其他解耦方式，其实我最想表达的是，它也可以使用promise方式的。</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">这里展示一个例子</p><pre class="prettyprint" style="line-height: 22px; white-space: pre-wrap; padding: 0px 15px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 14px; color: #333333; border-radius: 0px; margin: 20px -10px; word-break: break-all; word-wrap: break-word; border-width: 1px 0px; border-style: none; border-color: initial; background: #f7f7f7"><span style="color: #666600" class="pun">[</span><span style="color: #000088" class="kwd">self</span><span style="color: #000000" class="pln"> login</span><span style="color: #666600" class="pun">].</span><span style="color: #000088" class="kwd">then</span><span style="color: #666600" class="pun">(^&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #880000" class="com">// our login method wrapped an async task in a promise</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #000088" class="kwd">return</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">[</span><span style="color: #000000" class="pln">API fetchKittens</span><span style="color: #666600" class="pun">];</span><span style="color: #000000" class="pln">&nbsp;&nbsp;</span><span style="color: #666600" class="pun">&#125;).</span><span style="color: #000088" class="kwd">then</span><span style="color: #666600" class="pun">(^(</span><span style="color: #660066" class="typ">NSArray</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">*</span><span style="color: #000000" class="pln">fetchedKittens</span><span style="color: #666600" class="pun">)&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #880000" class="com">// our API class wraps our API and returns promises</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #880000" class="com">// fetchKittens returned a promise that resolves with an array of kittens</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #000088" class="kwd">self</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">kittens </span><span style="color: #666600" class="pun">=</span><span style="color: #000000" class="pln"> fetchedKittens</span><span style="color: #666600" class="pun">;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #666600" class="pun">[</span><span style="color: #000088" class="kwd">self</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">tableView reloadData</span><span style="color: #666600" class="pun">];</span><span style="color: #000000" class="pln">&nbsp;&nbsp;</span><span style="color: #666600" class="pun">&#125;).</span><span style="color: #000088" class="kwd">catch</span><span style="color: #666600" class="pun">(^(</span><span style="color: #660066" class="typ">NSError</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">*</span><span style="color: #000000" class="pln">error</span><span style="color: #666600" class="pun">)&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #880000" class="com">// any errors in any of the above promises land here</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #666600" class="pun">[[[</span><span style="color: #660066" class="typ">UIAlertView</span><span style="color: #000000" class="pln"> alloc</span><span style="color: #666600" class="pun">]</span><span style="color: #000000" class="pln"> init</span><span style="color: #666600" class="pun">&hellip;]</span><span style="color: #000000" class="pln"> show</span><span style="color: #666600" class="pun">];</span><span style="color: #000000" class="pln">&nbsp;&nbsp;</span><span style="color: #666600" class="pun">&#125;);</span><span style="color: #000000" class="pln"> </span></pre><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">详见http://promisekit.org/introduction/</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">是不是很奇怪，咋和上面的promise写法一样呢？</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">官方解释是</p><pre class="prettyprint" style="line-height: 22px; white-space: pre-wrap; padding: 0px 15px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 14px; color: #333333; border-radius: 0px; margin: 20px -10px; word-break: break-all; word-wrap: break-word; border-width: 1px 0px; border-style: none; border-color: initial; background: #f7f7f7"><span style="color: #660066" class="typ">PromiseKit</span><span style="color: #000000" class="pln"> </span><span style="color: #000088" class="kwd">is</span><span style="color: #000000" class="pln"> </span><span style="color: #000088" class="kwd">not</span><span style="color: #000000" class="pln"> just a promises implementation</span></pre><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">好吧，这只是冰山一角</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">如果各位熟悉前端js，相信你一定了解</p><ul style="padding: 0px; margin: 0px 0px 10px 25px; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; font-size: 14px; line-height: 28px"><li style="line-height: 2em">jQuery（1.5+）的deferred</li><li style="line-height: 2em">Angularjs的$q对象</li></ul><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">nodejs里的实现</p><ul style="padding: 0px; margin: 0px 0px 10px 25px; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; font-size: 14px; line-height: 28px"><li style="line-height: 2em">bluebird （<a style="color: #0088cc; text-decoration: none" href="https://github.com/petkaantonov/bluebird" target="_blank">https://github.com/petkaantonov/bluebird</a>&nbsp;后面继续讲，保持神秘）</li><li style="line-height: 2em">q （<a style="color: #0088cc; text-decoration: none" href="https://github.com/kriskowal/q" target="_blank">https://github.com/kriskowal/q</a>&nbsp;Angularjs的$q对象是q的精简版）</li><li style="line-height: 2em">then （teambition作品&nbsp;<a style="color: #0088cc; text-decoration: none" href="https://github.com/teambition/then.js" target="_blank">https://github.com/teambition/then.js</a>&nbsp;没用过）</li><li style="line-height: 2em">when （<a style="color: #0088cc; text-decoration: none" href="https://github.com/cujojs/when" target="_blank">https://github.com/cujojs/when</a>&nbsp;没用过）</li><li style="line-height: 2em">async （<a style="color: #0088cc; text-decoration: none" href="https://github.com/caolan/async" target="_blank">https://github.com/caolan/async</a>&nbsp;最简单的）</li><li style="line-height: 2em">eventproxy（朴灵作品&nbsp;<a style="color: #0088cc; text-decoration: none" href="https://github.com/JacksonTian/eventproxy%EF%BC%8C%E4%BD%BF%E7%94%A8event%E6%9D%A5%E5%A4%84%E7%90%86%E6%B5%81%E7%A8%8B%EF%BC%8C%E4%B9%9F%E6%98%AF%E4%B8%8D%E9%94%99%E7%9A%84%E5%B0%9D%E8%AF%95%EF%BC%89" target="_blank">https://github.com/JacksonTian/eventproxy，使用event来处理流程，也是不错的尝试）</a></li></ul><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">其他语言实现，详见 <a style="color: #0088cc; text-decoration: none" href="https://promisesaplus.com/implementations" target="_blank">https://promisesaplus.com/implementations</a></p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">其实，只要掌握了promise/a+规范，你就可以在n种语言里使用了</p><h1 style="margin: 30px 0px 15px; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; line-height: 40px; color: #333333; text-rendering: optimizeLegibility; font-size: 32.5px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #eeeeee">2）如何实现</h1><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">promise/a+规范是一个通用解决方案，不只是对nodejs管用，只要你掌握了原理，就只是换个语言实现而已</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">下面我就带着大家看一下js里是如何实现的</p><pre class="prettyprint" style="line-height: 22px; white-space: pre-wrap; padding: 0px 15px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 14px; color: #333333; border-radius: 0px; margin: 20px -10px; word-break: break-all; word-wrap: break-word; border-width: 1px 0px; border-style: none; border-color: initial; background: #f7f7f7"><span style="color: #000088" class="kwd">var</span><span style="color: #000000" class="pln"> </span><span style="color: #660066" class="typ">Promise</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">=</span><span style="color: #000000" class="pln"> </span><span style="color: #000088" class="kwd">function</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">()</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#125;;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;</span><span style="color: #000088" class="kwd">var</span><span style="color: #000000" class="pln"> isPromise </span><span style="color: #666600" class="pun">=</span><span style="color: #000000" class="pln"> </span><span style="color: #000088" class="kwd">function</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">value</span><span style="color: #666600" class="pun">)</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #000088" class="kwd">return</span><span style="color: #000000" class="pln"> value </span><span style="color: #000088" class="kwd">instanceof</span><span style="color: #000000" class="pln"> </span><span style="color: #660066" class="typ">Promise</span><span style="color: #666600" class="pun">;</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#125;;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;</span><span style="color: #000088" class="kwd">var</span><span style="color: #000000" class="pln"> defer </span><span style="color: #666600" class="pun">=</span><span style="color: #000000" class="pln"> </span><span style="color: #000088" class="kwd">function</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">()</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #000088" class="kwd">var</span><span style="color: #000000" class="pln"> pending </span><span style="color: #666600" class="pun">=</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">[],</span><span style="color: #000000" class="pln"> value</span><span style="color: #666600" class="pun">;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #000088" class="kwd">var</span><span style="color: #000000" class="pln"> promise </span><span style="color: #666600" class="pun">=</span><span style="color: #000000" class="pln"> </span><span style="color: #000088" class="kwd">new</span><span style="color: #000000" class="pln"> </span><span style="color: #660066" class="typ">Promise</span><span style="color: #666600" class="pun">();</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; promise</span><span style="color: #666600" class="pun">.</span><span style="color: #000088" class="kwd">then</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">=</span><span style="color: #000000" class="pln"> </span><span style="color: #000088" class="kwd">function</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">callback</span><span style="color: #666600" class="pun">)</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #000088" class="kwd">if</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">pending</span><span style="color: #666600" class="pun">)</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pending</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">push</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">callback</span><span style="color: #666600" class="pun">);</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #666600" class="pun">&#125;</span><span style="color: #000000" class="pln"> </span><span style="color: #000088" class="kwd">else</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; callback</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">value</span><span style="color: #666600" class="pun">);</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #666600" class="pun">&#125;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #666600" class="pun">&#125;;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #000088" class="kwd">return</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; resolve</span><span style="color: #666600" class="pun">:</span><span style="color: #000000" class="pln"> </span><span style="color: #000088" class="kwd">function</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">_value</span><span style="color: #666600" class="pun">)</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #000088" class="kwd">if</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">pending</span><span style="color: #666600" class="pun">)</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; value </span><span style="color: #666600" class="pun">=</span><span style="color: #000000" class="pln"> _value</span><span style="color: #666600" class="pun">;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #000088" class="kwd">for</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">(</span><span style="color: #000088" class="kwd">var</span><span style="color: #000000" class="pln"> i </span><span style="color: #666600" class="pun">=</span><span style="color: #000000" class="pln"> </span><span style="color: #006666" class="lit">0</span><span style="color: #666600" class="pun">,</span><span style="color: #000000" class="pln"> ii </span><span style="color: #666600" class="pun">=</span><span style="color: #000000" class="pln"> pending</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">length</span><span style="color: #666600" class="pun">;</span><span style="color: #000000" class="pln"> i </span><span style="color: #666600" class="pun">&lt;</span><span style="color: #000000" class="pln"> ii</span><span style="color: #666600" class="pun">;</span><span style="color: #000000" class="pln"> i</span><span style="color: #666600" class="pun">++)</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #000088" class="kwd">var</span><span style="color: #000000" class="pln"> callback </span><span style="color: #666600" class="pun">=</span><span style="color: #000000" class="pln"> pending</span><span style="color: #666600" class="pun">[</span><span style="color: #000000" class="pln">i</span><span style="color: #666600" class="pun">];</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; callback</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">value</span><span style="color: #666600" class="pun">);</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #666600" class="pun">&#125;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pending </span><span style="color: #666600" class="pun">=</span><span style="color: #000000" class="pln"> </span><span style="color: #000088" class="kwd">undefined</span><span style="color: #666600" class="pun">;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #666600" class="pun">&#125;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #666600" class="pun">&#125;,</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; promise</span><span style="color: #666600" class="pun">:</span><span style="color: #000000" class="pln"> promise&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #666600" class="pun">&#125;;</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#125;;</span></pre><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">首先</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">1） 声明promise对象</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">var promise = new Promise();</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">2）给promise对象增加then方法</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">promise.then = function (callback) &#123;</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">3）给defer对象返回resolve和promise</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">4）value，在resolve事件里传参，是第几个就执行第几个</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">本来想讲的更多一点，但时间不允许啊（后面还有很多内容），此处暂时讲到这里</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">cnode里的William17写的挺好的，完整的实现可以参考</p><ul style="padding: 0px; margin: 0px 0px 10px 25px; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; font-size: 14px; line-height: 28px"><li style="line-height: 2em"><a style="color: #0088cc; text-decoration: none" href="https://cnodejs.org/topic/5603cb8a152fdd025f0f5014" target="_blank">https://cnodejs.org/topic/5603cb8a152fdd025f0f5014</a></li><li style="line-height: 2em"><a style="color: #0088cc; text-decoration: none" href="https://github.com/William17/taxi" target="_blank">https://github.com/William17/taxi</a></li></ul><h2 style="margin: 30px 0px 15px; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; line-height: 40px; color: #333333; text-rendering: optimizeLegibility; font-size: 26px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #eeeeee">关于Q</h2><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">q是一个不错的项目，也是比较早的promise实现，而且angularjs的$q就是它的精简版，如果掌握了q，学习angular和bluebird都会比较简单</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">当然它还有更棒的，它把q的7个版本是如何实现的都详细记录了，刚才我给出的v1实际上就q的早期版本</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif"><a style="color: #0088cc; text-decoration: none" href="https://github.com/kriskowal/q/tree/v1/design" target="_blank">https://github.com/kriskowal/q/tree/v1/design</a></p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">很多人都以为是跟着人学，但人有不确定性，而且互联网让世界是平的了，我们如果能够学会从开源项目里学习，这才是长久的学习力</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">曾经写过一篇《如何学习之善用github篇：向 <a style="color: #0088cc; text-decoration: none" href="http://cnodejs.org/user/Pana" target="_blank">@Pana</a> 学习》，有兴趣的可以去翻翻</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif"><a style="color: #0088cc; text-decoration: none" href="http://mp.weixin.qq.com/s?__biz=MzAxMTU0NTc4Nw==&amp;mid=223428929&amp;idx=1&amp;sn=8296f5a96aa34f836ab83000f7ad995b#rd" target="_blank">http://mp.weixin.qq.com/s?__biz=MzAxMTU0NTc4Nw==&amp;mid=223428929&amp;idx=1&amp;sn=8296f5a96aa34f836ab83000f7ad995b#rd</a></p><h1 style="margin: 30px 0px 15px; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; line-height: 40px; color: #333333; text-rendering: optimizeLegibility; font-size: 32.5px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #eeeeee">3）真实项目里的实践</h1><h2 style="margin: 30px 0px 15px; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; line-height: 40px; color: #333333; text-rendering: optimizeLegibility; font-size: 26px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #eeeeee">技术选项：先看基准测试</h2><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">2015-01-05 当时最新的模块，比较结果如下</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif"><img style="height: auto; max-width: 100%; vertical-align: middle; border: 0px; cursor: pointer" src="http://dn-cnode.qbox.me/Fq-FM_N-zrlVEm-_7RS291Afo8dW" border="0" alt="benchmark.png" /></p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">对比一下结果</p><pre class="prettyprint" style="line-height: 22px; white-space: pre-wrap; padding: 0px 15px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 14px; color: #333333; border-radius: 0px; margin: 20px -10px; word-break: break-all; word-wrap: break-word; border-width: 1px 0px; border-style: none; border-color: initial; background: #f7f7f7"><span style="color: #666600" class="pun">顺序执行</span><span style="color: #000000" class="pln"> promises</span><span style="color: #666600" class="pun">-</span><span style="color: #000000" class="pln">bluebird</span><span style="color: #666600" class="pun">-</span><span style="color: #000000" class="pln">generator</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">js&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #006666" class="lit">235</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #006666" class="lit">38.04</span><span style="color: #000000" class="pln"> promises</span><span style="color: #666600" class="pun">-</span><span style="color: #000000" class="pln">bluebird</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">js&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #006666" class="lit">335</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #006666" class="lit">52.08</span><span style="color: #000000" class="pln">&nbsp;&nbsp;</span><span style="color: #666600" class="pun">并发执行</span><span style="color: #000000" class="pln"> promises</span><span style="color: #666600" class="pun">-</span><span style="color: #000000" class="pln">bluebird</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">js&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #006666" class="lit">389</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #006666" class="lit">53.49</span><span style="color: #000000" class="pln"> promises</span><span style="color: #666600" class="pun">-</span><span style="color: #000000" class="pln">bluebird</span><span style="color: #666600" class="pun">-</span><span style="color: #000000" class="pln">generator</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">js&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #006666" class="lit">491</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #006666" class="lit">55.52</span></pre><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">不管是哪种，bluebird都是前三名。然后扒一扒第一名的callbacks-baseline.js,其实就我们最讨厌的最基本的回调写法，也就说，bb实际比原生js稍慢，但比其他promise库都快</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">综合一下bb的特性</p><ul style="padding: 0px; margin: 0px 0px 10px 25px; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; font-size: 14px; line-height: 28px"><li style="line-height: 2em">速度最快</li><li style="line-height: 2em">api和文档完善，（对各个库支持都不错）</li><li style="line-height: 2em">支持generator等未来发展趋势</li><li style="line-height: 2em">github活跃</li><li style="line-height: 2em">还有让人眼前一亮的功能点（保密，下面会讲）</li></ul><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">我们的结论只有bb是目前最好的最好的选择</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">我个人的一个小喜好，对caolan的async挺喜欢的，我的选项</p><ul style="padding: 0px; margin: 0px 0px 10px 25px; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; font-size: 14px; line-height: 28px"><li style="line-height: 2em">公司项目是bb</li><li style="line-height: 2em">开源大点的还是bb</li><li style="line-height: 2em">小工具啥的我会选async</li></ul><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">其实when，then，eventproxy等也不错，只是懒得折腾</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">大家在直播过程中有任何不明白或者想提问的可以随时私信给小助手，我会在答疑阶段统一回答</p><h2 style="margin: 30px 0px 15px; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; line-height: 40px; color: #333333; text-rendering: optimizeLegibility; font-size: 26px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #eeeeee">场景</h2><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">下面举几个实际场景</p><h3 style="margin: 30px 0px 15px; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; line-height: 40px; color: #333333; text-rendering: optimizeLegibility; font-size: 24.5px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #eeeeee">神器，bluebird的promisify</h3><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">promisify原理</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">就是你给他传一个对象或者prototype，它去遍历，给他们加上async方法，此方法返回promise对象，你就可以为所欲为了</p><ul style="padding: 0px; margin: 0px 0px 10px 25px; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; font-size: 14px; line-height: 28px"><li style="line-height: 2em">优点：使用简单</li><li style="line-height: 2em">缺点：谨防对象过大，内存问题</li></ul><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">nodejs api支持</p><pre class="prettyprint" style="line-height: 22px; white-space: pre-wrap; padding: 0px 15px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 14px; color: #333333; border-radius: 0px; margin: 20px -10px; word-break: break-all; word-wrap: break-word; border-width: 1px 0px; border-style: none; border-color: initial; background: #f7f7f7"><span style="color: #880000" class="com">//Read more about promisification in the API Reference:</span><span style="color: #000000" class="pln"> </span><span style="color: #880000" class="com">//API.md</span><span style="color: #000000" class="pln"> </span><span style="color: #000088" class="kwd">var</span><span style="color: #000000" class="pln"> fs </span><span style="color: #666600" class="pun">=</span><span style="color: #000000" class="pln"> </span><span style="color: #660066" class="typ">Promise</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">promisifyAll</span><span style="color: #666600" class="pun">(</span><span style="color: #000088" class="kwd">require</span><span style="color: #666600" class="pun">(</span><span style="color: #008800" class="str">&quot;fs&quot;</span><span style="color: #666600" class="pun">));</span><span style="color: #000000" class="pln">&nbsp;&nbsp;fs</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">readFileAsync</span><span style="color: #666600" class="pun">(</span><span style="color: #008800" class="str">&quot;myfile.json&quot;</span><span style="color: #666600" class="pun">).</span><span style="color: #000088" class="kwd">then</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">JSON</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">parse</span><span style="color: #666600" class="pun">).</span><span style="color: #000088" class="kwd">then</span><span style="color: #666600" class="pun">(</span><span style="color: #000088" class="kwd">function</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">json</span><span style="color: #666600" class="pun">)</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; console</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">log</span><span style="color: #666600" class="pun">(</span><span style="color: #008800" class="str">&quot;Successful json&quot;</span><span style="color: #666600" class="pun">);</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#125;).</span><span style="color: #000088" class="kwd">catch</span><span style="color: #666600" class="pun">(</span><span style="color: #660066" class="typ">SyntaxError</span><span style="color: #666600" class="pun">,</span><span style="color: #000000" class="pln"> </span><span style="color: #000088" class="kwd">function</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">e</span><span style="color: #666600" class="pun">)</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; console</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">error</span><span style="color: #666600" class="pun">(</span><span style="color: #008800" class="str">&quot;file contains invalid json&quot;</span><span style="color: #666600" class="pun">);</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#125;).</span><span style="color: #000088" class="kwd">catch</span><span style="color: #666600" class="pun">(</span><span style="color: #660066" class="typ">Promise</span><span style="color: #666600" class="pun">.</span><span style="color: #660066" class="typ">OperationalError</span><span style="color: #666600" class="pun">,</span><span style="color: #000000" class="pln"> </span><span style="color: #000088" class="kwd">function</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">e</span><span style="color: #666600" class="pun">)</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; console</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">error</span><span style="color: #666600" class="pun">(</span><span style="color: #008800" class="str">&quot;unable to read file, because: &quot;</span><span style="color: #666600" class="pun">,</span><span style="color: #000000" class="pln"> e</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">message</span><span style="color: #666600" class="pun">);</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#125;);</span></pre><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">熟悉fs的API的都知道，fs有</p><ul style="padding: 0px; margin: 0px 0px 10px 25px; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; font-size: 14px; line-height: 28px"><li style="line-height: 2em">fs.readFile</li><li style="line-height: 2em">fs.readFileSync</li></ul><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">但没有</p><ul style="padding: 0px; margin: 0px 0px 10px 25px; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; font-size: 14px; line-height: 28px"><li style="line-height: 2em">fs.readFileAsync</li></ul><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">实际上fs.readFileAsync是bluebird加上去的</p><pre class="prettyprint" style="line-height: 22px; white-space: pre-wrap; padding: 0px 15px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 14px; color: #333333; border-radius: 0px; margin: 20px -10px; word-break: break-all; word-wrap: break-word; border-width: 1px 0px; border-style: none; border-color: initial; background: #f7f7f7"><span style="color: #000088" class="kwd">var</span><span style="color: #000000" class="pln"> fs </span><span style="color: #666600" class="pun">=</span><span style="color: #000000" class="pln"> </span><span style="color: #660066" class="typ">Promise</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">promisifyAll</span><span style="color: #666600" class="pun">(</span><span style="color: #000088" class="kwd">require</span><span style="color: #666600" class="pun">(</span><span style="color: #008800" class="str">&quot;fs&quot;</span><span style="color: #666600" class="pun">));</span></pre><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">其实也没什么神奇的，只是bb做的更多而已，让调用足够简便</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">下面我们来看一下mvc里的model层如何使用bb，我们先假定使用的是mongoose啊</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">先定义模型</p><pre class="prettyprint" style="line-height: 22px; white-space: pre-wrap; padding: 0px 15px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 14px; color: #333333; border-radius: 0px; margin: 20px -10px; word-break: break-all; word-wrap: break-word; border-width: 1px 0px; border-style: none; border-color: initial; background: #f7f7f7"><span style="color: #000088" class="kwd">var</span><span style="color: #000000" class="pln"> mongoose </span><span style="color: #666600" class="pun">=</span><span style="color: #000000" class="pln"> </span><span style="color: #000088" class="kwd">require</span><span style="color: #666600" class="pun">(</span><span style="color: #008800" class="str">'mongoose'</span><span style="color: #666600" class="pun">);</span><span style="color: #000000" class="pln"> </span><span style="color: #000088" class="kwd">var</span><span style="color: #000000" class="pln"> </span><span style="color: #660066" class="typ">Schema</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">=</span><span style="color: #000000" class="pln"> mongoose</span><span style="color: #666600" class="pun">.</span><span style="color: #660066" class="typ">Schema</span><span style="color: #666600" class="pun">;</span><span style="color: #000000" class="pln"> </span><span style="color: #000088" class="kwd">var</span><span style="color: #000000" class="pln"> </span><span style="color: #660066" class="typ">Promise</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">=</span><span style="color: #000000" class="pln"> </span><span style="color: #000088" class="kwd">require</span><span style="color: #666600" class="pun">(</span><span style="color: #008800" class="str">&quot;bluebird&quot;</span><span style="color: #666600" class="pun">);</span><span style="color: #000000" class="pln">&nbsp;&nbsp;</span><span style="color: #660066" class="typ">UserSchema</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">=</span><span style="color: #000000" class="pln"> </span><span style="color: #000088" class="kwd">new</span><span style="color: #000000" class="pln"> </span><span style="color: #660066" class="typ">Schema</span><span style="color: #666600" class="pun">(&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp; username</span><span style="color: #666600" class="pun">:</span><span style="color: #000000" class="pln"> </span><span style="color: #660066" class="typ">String</span><span style="color: #666600" class="pun">,</span><span style="color: #000000" class="pln">&nbsp;&nbsp; password</span><span style="color: #666600" class="pun">:</span><span style="color: #000000" class="pln"> </span><span style="color: #660066" class="typ">String</span><span style="color: #666600" class="pun">,</span><span style="color: #000000" class="pln">&nbsp;&nbsp; created_at</span><span style="color: #666600" class="pun">:</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; type</span><span style="color: #666600" class="pun">:</span><span style="color: #000000" class="pln"> </span><span style="color: #660066" class="typ">Date</span><span style="color: #666600" class="pun">,</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #008800" class="str">&quot;default&quot;</span><span style="color: #666600" class="pun">:</span><span style="color: #000000" class="pln"> </span><span style="color: #660066" class="typ">Date</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">now&nbsp;&nbsp; </span><span style="color: #666600" class="pun">&#125;</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#125;);</span><span style="color: #000000" class="pln">&nbsp;&nbsp;</span><span style="color: #000088" class="kwd">var</span><span style="color: #000000" class="pln"> </span><span style="color: #660066" class="typ">User</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">=</span><span style="color: #000000" class="pln"> mongoose</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">model</span><span style="color: #666600" class="pun">(</span><span style="color: #008800" class="str">'User'</span><span style="color: #666600" class="pun">,</span><span style="color: #000000" class="pln"> </span><span style="color: #660066" class="typ">UserSchema</span><span style="color: #666600" class="pun">);</span><span style="color: #000000" class="pln">&nbsp;&nbsp;</span><span style="color: #660066" class="typ">Promise</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">promisifyAll</span><span style="color: #666600" class="pun">(</span><span style="color: #660066" class="typ">User</span><span style="color: #666600" class="pun">);</span><span style="color: #000000" class="pln"> </span><span style="color: #660066" class="typ">Promise</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">promisifyAll</span><span style="color: #666600" class="pun">(</span><span style="color: #660066" class="typ">User</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">prototype</span><span style="color: #666600" class="pun">);</span></pre><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">利用上面定义好的User模型，我们就可以写业务逻辑了</p><pre class="prettyprint" style="line-height: 22px; white-space: pre-wrap; padding: 0px 15px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 14px; color: #333333; border-radius: 0px; margin: 20px -10px; word-break: break-all; word-wrap: break-word; border-width: 1px 0px; border-style: none; border-color: initial; background: #f7f7f7"><span style="color: #660066" class="typ">User</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">findAsync</span><span style="color: #666600" class="pun">(&#123;</span><span style="color: #000000" class="pln">username</span><span style="color: #666600" class="pun">:</span><span style="color: #000000" class="pln"> username</span><span style="color: #666600" class="pun">&#125;).</span><span style="color: #000088" class="kwd">then</span><span style="color: #666600" class="pun">(</span><span style="color: #000088" class="kwd">function</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">data</span><span style="color: #666600" class="pun">)</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #666600" class="pun">...</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#125;).</span><span style="color: #000088" class="kwd">catch</span><span style="color: #666600" class="pun">(</span><span style="color: #000088" class="kwd">function</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">err</span><span style="color: #666600" class="pun">)</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #666600" class="pun">...</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#125;);</span></pre><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">再来个复杂的</p><pre class="prettyprint" style="line-height: 22px; white-space: pre-wrap; padding: 0px 15px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 14px; color: #333333; border-radius: 0px; margin: 20px -10px; word-break: break-all; word-wrap: break-word; border-width: 1px 0px; border-style: none; border-color: initial; background: #f7f7f7"><span style="color: #660066" class="typ">TeamPartner</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">updateAsync</span><span style="color: #666600" class="pun">(&#123;</span><span style="color: #000000" class="pln"> &nbsp;&nbsp;</span><span style="color: #666600" class="pun">...</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#125;,</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln"> &nbsp;&nbsp;$set</span><span style="color: #666600" class="pun">:</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln"> &nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #666600" class="pun">...</span><span style="color: #000000" class="pln"> &nbsp;&nbsp;</span><span style="color: #666600" class="pun">&#125;</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#125;).</span><span style="color: #000088" class="kwd">then</span><span style="color: #666600" class="pun">(</span><span style="color: #000088" class="kwd">function</span><span style="color: #666600" class="pun">()</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln"> &nbsp;&nbsp;</span><span style="color: #000088" class="kwd">return</span><span style="color: #000000" class="pln"> </span><span style="color: #660066" class="typ">User</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">findByIdAsync</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">user_id</span><span style="color: #666600" class="pun">);</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#125;).</span><span style="color: #000088" class="kwd">then</span><span style="color: #666600" class="pun">(</span><span style="color: #000088" class="kwd">function</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">team_owner</span><span style="color: #666600" class="pun">)</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln"> &nbsp;&nbsp;</span><span style="color: #000088" class="kwd">if</span><span style="color: #666600" class="pun">(</span><span style="color: #000088" class="kwd">typeof</span><span style="color: #000000" class="pln"> team_owner</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">partner_count </span><span style="color: #666600" class="pun">!=</span><span style="color: #000000" class="pln"> </span><span style="color: #008800" class="str">'undefined'</span><span style="color: #666600" class="pun">)</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; team_new_count </span><span style="color: #666600" class="pun">=</span><span style="color: #000000" class="pln"> team_owner</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">partner_count </span><span style="color: #666600" class="pun">+</span><span style="color: #000000" class="pln"> </span><span style="color: #006666" class="lit">1</span><span style="color: #666600" class="pun">;</span><span style="color: #000000" class="pln">&nbsp;&nbsp; </span><span style="color: #666600" class="pun">&#125;</span><span style="color: #000088" class="kwd">else</span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; team_new_count </span><span style="color: #666600" class="pun">=</span><span style="color: #000000" class="pln"> </span><span style="color: #006666" class="lit">1</span><span style="color: #666600" class="pun">;</span><span style="color: #000000" class="pln">&nbsp;&nbsp; </span><span style="color: #666600" class="pun">&#125;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #880000" class="com">// 创始人成员+1</span><span style="color: #000000" class="pln">&nbsp;&nbsp; </span><span style="color: #000088" class="kwd">return</span><span style="color: #000000" class="pln"> </span><span style="color: #660066" class="typ">User</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">findByIdAndUpdateAsync</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">user_id</span><span style="color: #666600" class="pun">,</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; $set</span><span style="color: #666600" class="pun">:</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #666600" class="pun">...</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #666600" class="pun">&#125;</span><span style="color: #000000" class="pln">&nbsp;&nbsp; </span><span style="color: #666600" class="pun">&#125;,</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; upsert</span><span style="color: #666600" class="pun">:</span><span style="color: #000000" class="pln"> </span><span style="color: #000088" class="kwd">true</span><span style="color: #000000" class="pln">&nbsp;&nbsp; </span><span style="color: #666600" class="pun">&#125;);</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#125;).</span><span style="color: #000088" class="kwd">then</span><span style="color: #666600" class="pun">(</span><span style="color: #000088" class="kwd">function</span><span style="color: #666600" class="pun">()</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln"> &nbsp;&nbsp;</span><span style="color: #000088" class="kwd">return</span><span style="color: #000000" class="pln"> </span><span style="color: #660066" class="typ">Notify</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">findByIdAndUpdateAsync</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">notify_id</span><span style="color: #666600" class="pun">,</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln"> &nbsp;&nbsp;&nbsp;&nbsp;$set</span><span style="color: #666600" class="pun">:</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;read_status</span><span style="color: #666600" class="pun">:</span><span style="color: #000000" class="pln"> </span><span style="color: #000088" class="kwd">true</span><span style="color: #000000" class="pln"> &nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #666600" class="pun">&#125;</span><span style="color: #000000" class="pln"> &nbsp;&nbsp;</span><span style="color: #666600" class="pun">&#125;);</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#125;).</span><span style="color: #000088" class="kwd">then</span><span style="color: #666600" class="pun">(</span><span style="color: #000088" class="kwd">function</span><span style="color: #666600" class="pun">()</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp; </span><span style="color: #000088" class="kwd">var</span><span style="color: #000000" class="pln"> notifySave </span><span style="color: #666600" class="pun">=</span><span style="color: #000000" class="pln"> </span><span style="color: #000088" class="kwd">new</span><span style="color: #000000" class="pln"> </span><span style="color: #660066" class="typ">Notify</span><span style="color: #666600" class="pun">(&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #666600" class="pun">...</span><span style="color: #000000" class="pln">&nbsp;&nbsp; </span><span style="color: #666600" class="pun">&#125;);</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #000088" class="kwd">return</span><span style="color: #000000" class="pln"> notifySave</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">saveAsync</span><span style="color: #666600" class="pun">();</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#125;).</span><span style="color: #000088" class="kwd">then</span><span style="color: #666600" class="pun">(</span><span style="color: #000088" class="kwd">function</span><span style="color: #666600" class="pun">()</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln"> &nbsp;&nbsp;</span><span style="color: #000088" class="kwd">return</span><span style="color: #000000" class="pln"> </span><span style="color: #660066" class="typ">User</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">findByIdAsync</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">user_join</span><span style="color: #666600" class="pun">);</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#125;).</span><span style="color: #000088" class="kwd">then</span><span style="color: #666600" class="pun">(</span><span style="color: #000088" class="kwd">function</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">joiner</span><span style="color: #666600" class="pun">)</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp; </span><span style="color: #000088" class="kwd">var</span><span style="color: #000000" class="pln"> teamSave </span><span style="color: #666600" class="pun">=</span><span style="color: #000000" class="pln"> </span><span style="color: #000088" class="kwd">new</span><span style="color: #000000" class="pln"> </span><span style="color: #660066" class="typ">Team</span><span style="color: #666600" class="pun">(&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #666600" class="pun">...</span><span style="color: #000000" class="pln">&nbsp;&nbsp; </span><span style="color: #666600" class="pun">&#125;);</span><span style="color: #000000" class="pln">&nbsp;&nbsp; </span><span style="color: #000088" class="kwd">return</span><span style="color: #000000" class="pln"> teamSave</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">saveAsync</span><span style="color: #666600" class="pun">();</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#125;).</span><span style="color: #000088" class="kwd">then</span><span style="color: #666600" class="pun">(</span><span style="color: #000088" class="kwd">function</span><span style="color: #666600" class="pun">()</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln"> &nbsp;&nbsp;res</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">status</span><span style="color: #666600" class="pun">(</span><span style="color: #006666" class="lit">200</span><span style="color: #666600" class="pun">).</span><span style="color: #000000" class="pln">json</span><span style="color: #666600" class="pun">(&#123;</span><span style="color: #000000" class="pln"> &nbsp;&nbsp;&nbsp;&nbsp;data</span><span style="color: #666600" class="pun">:</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;&#125;,</span><span style="color: #000000" class="pln"> &nbsp;&nbsp;&nbsp;&nbsp;status</span><span style="color: #666600" class="pun">:</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;code</span><span style="color: #666600" class="pun">:</span><span style="color: #000000" class="pln"> </span><span style="color: #006666" class="lit">0</span><span style="color: #666600" class="pun">,</span><span style="color: #000000" class="pln"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;msg</span><span style="color: #666600" class="pun">:</span><span style="color: #000000" class="pln"> </span><span style="color: #008800" class="str">'success'</span><span style="color: #000000" class="pln"> &nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #666600" class="pun">&#125;</span><span style="color: #000000" class="pln"> &nbsp;&nbsp;</span><span style="color: #666600" class="pun">&#125;);</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#125;).</span><span style="color: #000088" class="kwd">catch</span><span style="color: #666600" class="pun">(</span><span style="color: #000088" class="kwd">function</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">err</span><span style="color: #666600" class="pun">)</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln"> &nbsp;&nbsp;console</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">log</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">err</span><span style="color: #666600" class="pun">);</span><span style="color: #000000" class="pln"> &nbsp;&nbsp;res</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">status</span><span style="color: #666600" class="pun">(</span><span style="color: #006666" class="lit">200</span><span style="color: #666600" class="pun">).</span><span style="color: #000000" class="pln">json</span><span style="color: #666600" class="pun">(&#123;</span><span style="color: #000000" class="pln"> &nbsp;&nbsp;&nbsp;&nbsp;data</span><span style="color: #666600" class="pun">:</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;&#125;,</span><span style="color: #000000" class="pln"> &nbsp;&nbsp;&nbsp;&nbsp;status</span><span style="color: #666600" class="pun">:</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;code</span><span style="color: #666600" class="pun">:</span><span style="color: #000000" class="pln"> err</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">code</span><span style="color: #666600" class="pun">,</span><span style="color: #000000" class="pln"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;msg</span><span style="color: #666600" class="pun">:</span><span style="color: #000000" class="pln"> err</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">name &nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #666600" class="pun">&#125;</span><span style="color: #000000" class="pln"> &nbsp;&nbsp;</span><span style="color: #666600" class="pun">&#125;);</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#125;);</span></pre><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">很抱歉，伤害大家了，但确切是有这样用，我想问，脑子抽么？</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">优化方案</p><ul style="padding: 0px; margin: 0px 0px 10px 25px; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; font-size: 14px; line-height: 28px"><li style="line-height: 2em">mongoose上的static和method上扩展，别暴漏太多细节在控制层</li><li style="line-height: 2em">面向promise，保证每个操作都是一个函数，让流程可以组装，不要忘了最初then的初衷</li></ul><pre class="prettyprint" style="line-height: 22px; white-space: pre-wrap; padding: 0px 15px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 14px; color: #333333; border-radius: 0px; margin: 20px -10px; word-break: break-all; word-wrap: break-word; border-width: 1px 0px; border-style: none; border-color: initial; background: #f7f7f7"><span style="color: #000088" class="kwd">function</span><span style="color: #000000" class="pln"> find_user</span><span style="color: #666600" class="pun">()</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln"> &nbsp;&nbsp;</span><span style="color: #000088" class="kwd">return</span><span style="color: #000000" class="pln"> </span><span style="color: #660066" class="typ">User</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">findByIdAsync</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">user_id</span><span style="color: #666600" class="pun">);</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#125;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;</span><span style="color: #000088" class="kwd">function</span><span style="color: #000000" class="pln"> find_user2</span><span style="color: #666600" class="pun">()</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln"> &nbsp;&nbsp;</span><span style="color: #000088" class="kwd">return</span><span style="color: #000000" class="pln"> </span><span style="color: #660066" class="typ">User</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">findByIdAsync</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">user_id</span><span style="color: #666600" class="pun">);</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#125;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;</span><span style="color: #000088" class="kwd">function</span><span style="color: #000000" class="pln"> error</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">ex</span><span style="color: #666600" class="pun">)&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp; console</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">log</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">ex</span><span style="color: #666600" class="pun">);</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#125;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;</span><span style="color: #660066" class="typ">TeamPartner</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">updateByXXAsync</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">a</span><span style="color: #666600" class="pun">,</span><span style="color: #000000" class="pln">b</span><span style="color: #666600" class="pun">,</span><span style="color: #000000" class="pln">c</span><span style="color: #666600" class="pun">).</span><span style="color: #000088" class="kwd">then</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">find_user</span><span style="color: #666600" class="pun">).</span><span style="color: #000088" class="kwd">then</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">find_user2</span><span style="color: #666600" class="pun">).</span><span style="color: #000088" class="kwd">catch</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">error</span><span style="color: #666600" class="pun">)</span></pre><h2 style="margin: 30px 0px 15px; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; line-height: 40px; color: #333333; text-rendering: optimizeLegibility; font-size: 26px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #eeeeee">开源项目里的promise</h2><ul style="padding: 0px; margin: 0px 0px 10px 25px; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; font-size: 14px; line-height: 28px"><li style="line-height: 2em">ioredis</li><li style="line-height: 2em">mongoose &amp;&amp; mongoskin</li></ul><h3 style="margin: 30px 0px 15px; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; line-height: 40px; color: #333333; text-rendering: optimizeLegibility; font-size: 24.5px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #eeeeee">ioredis</h3><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif"><a style="color: #0088cc; text-decoration: none" href="https://github.com/luin/ioredis" target="_blank">https://github.com/luin/ioredis</a></p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">ioredis是redis库里的首选，其实它是基于node_redis的，增加和优化了很多，其中关于promise的一点是</p><pre class="prettyprint" style="line-height: 22px; white-space: pre-wrap; padding: 0px 15px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 14px; color: #333333; border-radius: 0px; margin: 20px -10px; word-break: break-all; word-wrap: break-word; border-width: 1px 0px; border-style: none; border-color: initial; background: #f7f7f7"><span style="color: #660066" class="typ">Delightful</span><span style="color: #000000" class="pln"> API</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln"> </span><span style="color: #660066" class="typ">It</span><span style="color: #000000" class="pln"> works </span><span style="color: #000088" class="kwd">with</span><span style="color: #000000" class="pln"> </span><span style="color: #660066" class="typ">Node</span><span style="color: #000000" class="pln"> callbacks </span><span style="color: #000088" class="kwd">and</span><span style="color: #000000" class="pln"> </span><span style="color: #660066" class="typ">Bluebird</span><span style="color: #000000" class="pln"> promises</span><span style="color: #666600" class="pun">.</span></pre><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">用法</p><pre class="prettyprint" style="line-height: 22px; white-space: pre-wrap; padding: 0px 15px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 14px; color: #333333; border-radius: 0px; margin: 20px -10px; word-break: break-all; word-wrap: break-word; border-width: 1px 0px; border-style: none; border-color: initial; background: #f7f7f7"><span style="color: #000000" class="pln">redis</span><span style="color: #666600" class="pun">.</span><span style="color: #000088" class="kwd">get</span><span style="color: #666600" class="pun">(</span><span style="color: #008800" class="str">'foo'</span><span style="color: #666600" class="pun">).</span><span style="color: #000088" class="kwd">then</span><span style="color: #666600" class="pun">(</span><span style="color: #000088" class="kwd">function</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">result</span><span style="color: #666600" class="pun">)</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp; console</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">log</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">result</span><span style="color: #666600" class="pun">);</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#125;);</span></pre><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">真心比node_redis好用的多。</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">luin是《Redis入门指南》一书作者，90后，全栈+设计，写过不少nodejs模块，目前就在群里</p><h3 style="margin: 30px 0px 15px; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; line-height: 40px; color: #333333; text-rendering: optimizeLegibility; font-size: 24.5px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #eeeeee">mongoose &amp;&amp; mongoskin</h3><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">mongoose是nodejs处理mongodb的不二选择，简单说一下mongoskin</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">官方说</p><pre class="prettyprint" style="line-height: 22px; white-space: pre-wrap; padding: 0px 15px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 14px; color: #333333; border-radius: 0px; margin: 20px -10px; word-break: break-all; word-wrap: break-word; border-width: 1px 0px; border-style: none; border-color: initial; background: #f7f7f7"><span style="color: #660066" class="typ">The</span><span style="color: #000000" class="pln"> promise wrapper </span><span style="color: #000088" class="kwd">for</span><span style="color: #000000" class="pln"> node</span><span style="color: #666600" class="pun">-</span><span style="color: #000000" class="pln">mongodb</span><span style="color: #666600" class="pun">-</span><span style="color: #000088" class="kwd">native</span><span style="color: #666600" class="pun">.</span></pre><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">做了很多api上的优化，还是不错的，可是mongoose也出了promise</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">mongoose仿佛在喊：&ldquo;用我，我也可以then&rdquo;。。。。</p><h1 style="margin: 30px 0px 15px; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; line-height: 40px; color: #333333; text-rendering: optimizeLegibility; font-size: 32.5px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #eeeeee">4）最后给出未来展望</h1><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">未来主要是es6和es7上的实现</p><ul style="padding: 0px; margin: 0px 0px 10px 25px; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; font-size: 14px; line-height: 28px"><li style="line-height: 2em">es6上的Generators/yield</li><li style="line-height: 2em">es7上的Async/await</li></ul><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">都是好东西，可以尝试，毕竟早晚js还是要升级的，先做技术储备吧</p><h2 style="margin: 30px 0px 15px; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; line-height: 40px; color: #333333; text-rendering: optimizeLegibility; font-size: 26px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #eeeeee">生成器Generators/yield</h2><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">生成器是ES6（也被称为ES2015）的新特性。</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">想象下面这样的一个场景：</p><pre class="prettyprint" style="line-height: 22px; white-space: pre-wrap; padding: 0px 15px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 14px; color: #333333; border-radius: 0px; margin: 20px -10px; word-break: break-all; word-wrap: break-word; border-width: 1px 0px; border-style: none; border-color: initial; background: #f7f7f7"><span style="color: #666600" class="pun">当你在执行一个函数的时候，你可以在某个点暂停函数的执行，并且做一些其他工作，然后再返回这个函数继续执行，</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">甚至是携带一些新的值，然后继续执行。</span></pre><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">上面描述的场景正是JavaScript生成器函数所致力于解决的问题。</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">当我们调用一个生成器函数的时候，它并不会立即执行， 而是需要我们手动的去执行迭代操作（next方法）。也就是说，你调用生成器函数，它会返回给你一个迭代器。迭代器会遍历每个中断点。</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">看例子</p><pre class="prettyprint" style="line-height: 22px; white-space: pre-wrap; padding: 0px 15px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 14px; color: #333333; border-radius: 0px; margin: 20px -10px; word-break: break-all; word-wrap: break-word; border-width: 1px 0px; border-style: none; border-color: initial; background: #f7f7f7"><span style="color: #000088" class="kwd">function</span><span style="color: #666600" class="pun">*</span><span style="color: #000000" class="pln"> foo </span><span style="color: #666600" class="pun">()</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #000088" class="kwd">var</span><span style="color: #000000" class="pln"> index </span><span style="color: #666600" class="pun">=</span><span style="color: #000000" class="pln"> </span><span style="color: #006666" class="lit">0</span><span style="color: #666600" class="pun">;</span><span style="color: #000000" class="pln">&nbsp;&nbsp; </span><span style="color: #000088" class="kwd">while</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">index </span><span style="color: #666600" class="pun">&lt;</span><span style="color: #000000" class="pln"> </span><span style="color: #006666" class="lit">2</span><span style="color: #666600" class="pun">)</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #000088" class="kwd">yield</span><span style="color: #000000" class="pln"> index</span><span style="color: #666600" class="pun">++;</span><span style="color: #000000" class="pln"> </span><span style="color: #880000" class="com">//暂停函数执行，并执行yield后的操作</span><span style="color: #000000" class="pln">&nbsp;&nbsp; </span><span style="color: #666600" class="pun">&#125;</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#125;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;</span><span style="color: #000088" class="kwd">var</span><span style="color: #000000" class="pln"> bar </span><span style="color: #666600" class="pun">=</span><span style="color: #000000" class="pln">&nbsp;&nbsp;foo</span><span style="color: #666600" class="pun">();</span><span style="color: #000000" class="pln"> </span><span style="color: #880000" class="com">// 返回的其实是一个迭代器</span><span style="color: #000000" class="pln">&nbsp;&nbsp;console</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">log</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">bar</span><span style="color: #666600" class="pun">.</span><span style="color: #000088" class="kwd">next</span><span style="color: #666600" class="pun">());</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #880000" class="com">// &#123; value: 0, done: false &#125;&nbsp;&nbsp;</span><span style="color: #000000" class="pln"> console</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">log</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">bar</span><span style="color: #666600" class="pun">.</span><span style="color: #000088" class="kwd">next</span><span style="color: #666600" class="pun">());</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #880000" class="com">// &#123; value: 1, done: false &#125;&nbsp;&nbsp;</span><span style="color: #000000" class="pln"> console</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">log</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">bar</span><span style="color: #666600" class="pun">.</span><span style="color: #000088" class="kwd">next</span><span style="color: #666600" class="pun">());</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #880000" class="com">// &#123; value: undefined, done: true &#125;&nbsp;&nbsp;</span></pre><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">如果你想更轻松的使用生成器函数来编写异步JavaScript代码，我们可以使用 co 这个库，co是著名的tj大神写的，是一个为Node.js和浏览器打造的基于生成器的流程控制工具，借助于Promise，你可以使用更加优雅的方式编写非阻塞代码。</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">使用co，改写前面的示例代码：</p><pre class="prettyprint" style="line-height: 22px; white-space: pre-wrap; padding: 0px 15px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 14px; color: #333333; border-radius: 0px; margin: 20px -10px; word-break: break-all; word-wrap: break-word; border-width: 1px 0px; border-style: none; border-color: initial; background: #f7f7f7"><span style="color: #000000" class="pln">co</span><span style="color: #666600" class="pun">(</span><span style="color: #000088" class="kwd">function</span><span style="color: #666600" class="pun">*</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">()&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #000088" class="kwd">yield</span><span style="color: #000000" class="pln"> </span><span style="color: #660066" class="typ">Something</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">save</span><span style="color: #666600" class="pun">();</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#125;).</span><span style="color: #000088" class="kwd">then</span><span style="color: #666600" class="pun">(</span><span style="color: #000088" class="kwd">function</span><span style="color: #666600" class="pun">()</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp; </span><span style="color: #880000" class="com">// success</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#125;)</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">.</span><span style="color: #000088" class="kwd">catch</span><span style="color: #666600" class="pun">(</span><span style="color: #000088" class="kwd">function</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">err</span><span style="color: #666600" class="pun">)</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp; </span><span style="color: #880000" class="com">//error handling</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#125;);</span></pre><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">你可能会问：如何实现并行操作呢？答案可能比你想象的简单，如下</p><pre class="prettyprint" style="line-height: 22px; white-space: pre-wrap; padding: 0px 15px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 14px; color: #333333; border-radius: 0px; margin: 20px -10px; word-break: break-all; word-wrap: break-word; border-width: 1px 0px; border-style: none; border-color: initial; background: #f7f7f7"><span style="color: #000088" class="kwd">yield</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">[</span><span style="color: #000000" class="pln">a</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">save</span><span style="color: #666600" class="pun">(),</span><span style="color: #000000" class="pln"> b</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">save</span><span style="color: #666600" class="pun">()];</span><span style="color: #000000" class="pln">&nbsp;&nbsp;</span></pre><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">其实它就是Promise.all，换种写法而已</p><h2 style="margin: 30px 0px 15px; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; line-height: 40px; color: #333333; text-rendering: optimizeLegibility; font-size: 26px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #eeeeee">Async/await</h2><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">在ES7（还未正式标准化）中引入了Async函数的概念，目前如果你想要使用的话，只能借助于babel 这样的语法转换器将其转为ES5代码。</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">使用async关键字，可以轻松地达成之前使用生成器和co函数所做到的工作。当然，hack除外</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">可以这样理解，async函数实际使用的是Promise，然后使用await来执行异步操作，这里的await类似于上面讲的yield</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">因此，使用async重写上面的代码：</p><pre class="prettyprint" style="line-height: 22px; white-space: pre-wrap; padding: 0px 15px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 14px; color: #333333; border-radius: 0px; margin: 20px -10px; word-break: break-all; word-wrap: break-word; border-width: 1px 0px; border-style: none; border-color: initial; background: #f7f7f7"><span style="color: #000000" class="pln">async </span><span style="color: #000088" class="kwd">function</span><span style="color: #000000" class="pln"> save</span><span style="color: #666600" class="pun">(</span><span style="color: #660066" class="typ">Something</span><span style="color: #666600" class="pun">)</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #000088" class="kwd">try</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; await </span><span style="color: #660066" class="typ">Something</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">save</span><span style="color: #666600" class="pun">();</span><span style="color: #000000" class="pln"> </span><span style="color: #880000" class="com">// 等待await后面的代码执行完，类似于yield</span><span style="color: #000000" class="pln">&nbsp;&nbsp; </span><span style="color: #666600" class="pun">&#125;</span><span style="color: #000000" class="pln"> </span><span style="color: #000088" class="kwd">catch</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">err</span><span style="color: #666600" class="pun">)</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #880000" class="com">//error handling</span><span style="color: #000000" class="pln">&nbsp;&nbsp; </span><span style="color: #666600" class="pun">&#125;</span><span style="color: #000000" class="pln">&nbsp;&nbsp; console</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">log</span><span style="color: #666600" class="pun">(</span><span style="color: #008800" class="str">'success'</span><span style="color: #666600" class="pun">);</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#125;</span></pre><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">下一代web框架Koa也支持async函数，如果你也在使用koa，那么你现在就可以借助babel使用这一特性了</p><pre class="prettyprint" style="line-height: 22px; white-space: pre-wrap; padding: 0px 15px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 14px; color: #333333; border-radius: 0px; margin: 20px -10px; word-break: break-all; word-wrap: break-word; border-width: 1px 0px; border-style: none; border-color: initial; background: #f7f7f7"><span style="color: #000088" class="kwd">import</span><span style="color: #000000" class="pln"> koa </span><span style="color: #000088" class="kwd">from</span><span style="color: #000000" class="pln"> koa</span><span style="color: #666600" class="pun">;</span><span style="color: #000000" class="pln">&nbsp;&nbsp; let app </span><span style="color: #666600" class="pun">=</span><span style="color: #000000" class="pln"> koa</span><span style="color: #666600" class="pun">();</span><span style="color: #000000" class="pln">&nbsp;&nbsp;app</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">experimental </span><span style="color: #666600" class="pun">=</span><span style="color: #000000" class="pln"> </span><span style="color: #000088" class="kwd">true</span><span style="color: #666600" class="pun">;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;app</span><span style="color: #666600" class="pun">.</span><span style="color: #000088" class="kwd">use</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">async </span><span style="color: #000088" class="kwd">function</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">()&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #000088" class="kwd">this</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">body </span><span style="color: #666600" class="pun">=</span><span style="color: #000000" class="pln"> await </span><span style="color: #660066" class="typ">Promise</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">resolve</span><span style="color: #666600" class="pun">(</span><span style="color: #008800" class="str">'Hello Reader!'</span><span style="color: #666600" class="pun">)</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#125;)</span><span style="color: #000000" class="pln">&nbsp;&nbsp;app</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">listen</span><span style="color: #666600" class="pun">(</span><span style="color: #006666" class="lit">3000</span><span style="color: #666600" class="pun">);</span><span style="color: #000000" class="pln">&nbsp;&nbsp;</span></pre><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">这里报个料，群里<a style="color: #0088cc; text-decoration: none" href="https://github.com/fundon" target="_blank">fundon</a> 大神写的https://github.com/trekjs/trek 是基于koa的，使用babel编译，并有更多相当棒的特性。爱折腾的可以试试</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">最后还是要归纳总结一下，</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">先复习promise/a+的四个要点</p><ul style="padding: 0px; margin: 0px 0px 10px 25px; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; font-size: 14px; line-height: 28px"><li style="line-height: 2em">a) 异步操作的最终结果，尽可能每一个异步操作都是独立操作单元</li><li style="line-height: 2em">b) 与Promise最主要的交互方法是通过将函数传入它的then方法（thenable）</li><li style="line-height: 2em">c) 捕获异常catch error</li><li style="line-height: 2em">d) 根据reject和resolve重塑流程</li></ul><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">已经第三遍，该记住了！</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">继续看第一个图</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif"><img style="height: auto; max-width: 100%; vertical-align: middle; border: 0px; cursor: pointer" src="http://dn-cnode.qbox.me/FgKu20kvFqHrkgpjbQxXkV1DmrG1" border="0" alt="1.png" /></p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">再来看这张图，从callback到promose是历史的必然产物</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">generator是一种新的定义方式，定义操作单元，尤其在迭代器的情况，搭配yield来执行，可读性上差了很多，好处是真的解耦了</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">co是一个中间产品，可以说是给generator增加了promise实现，可读性和易用性是愿意好于generator + yield的</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">最后我们看看async，它实际上是通过async这个关键词，定义的函数就可以返回promise对象，可以说async就是能返回promise对象的generator。yield关键词以及被generator绑架了，那它就换个名字，叫await</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">其实从这段历史来看，反复就是promise上的折腾，只是加了generator这个别名，只是async是能返回promise的generator</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">这样理解是不是更简单呢？</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">万变不离其宗，想精通js或者nodejs，promise是大家必须迈过去的坑。</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">谢谢大家，今天讲的内容就到这里，如果有什么讲的不对的、不合理的，请不吝赐教，共同学习</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">大家有任何不明白或者想提问的可以随时私信给小助手，我会在答疑阶段统一回答</p><h2 style="margin: 30px 0px 15px; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; line-height: 40px; color: #333333; text-rendering: optimizeLegibility; font-size: 26px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #eeeeee">推荐资料</h2><ul style="padding: 0px; margin: 0px 0px 10px 25px; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; font-size: 14px; line-height: 28px"><li style="line-height: 2em"><a style="color: #0088cc; text-decoration: none" href="http://liubin.github.io/promises-book/#introduction" target="_blank">http://liubin.github.io/promises-book/#introduction</a></li><li style="line-height: 2em"><a style="color: #0088cc; text-decoration: none" href="http://www.mattgreer.org/articles/promises-in-wicked-detail/" target="_blank">http://www.mattgreer.org/articles/promises-in-wicked-detail/</a></li></ul>
]]>
</description>
</item><item>
<link>http://i.renjihe.com/blog/read.php?#blogcomment</link>
<title><![CDATA[[评论] Node.js最新技术栈之Promise篇]]></title> 
<author> &lt;user@domain.com&gt;</author>
<category><![CDATA[评论]]></category>
<pubDate>Thu, 01 Jan 1970 00:00:00 +0000</pubDate> 
<guid>http://i.renjihe.com/blog/read.php?#blogcomment</guid> 
<description>
<![CDATA[ 
	
]]>
</description>
</item>
</channel>
</rss>