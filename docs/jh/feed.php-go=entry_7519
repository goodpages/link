<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0">
<channel>
<title><![CDATA[流浪的龙－个人知识管理]]></title> 
<link>http://i.renjihe.com/blog/index.php</link> 
<description><![CDATA[]]></description> 
<language>zh-cn</language> 
<copyright><![CDATA[流浪的龙－个人知识管理]]></copyright>
<item>
<link>http://i.renjihe.com/blog/read.php?</link>
<title><![CDATA[DB主从一致性的几种解决方法]]></title> 
<author>renjihe1988 &lt;admin@yourname.com&gt;</author>
<category><![CDATA[web]]></category>
<pubDate>Wed, 31 Aug 2016 12:29:00 +0000</pubDate> 
<guid>http://i.renjihe.com/blog/read.php?</guid> 
<description>
<![CDATA[ 
	<div class="skin_center_t" style="box-sizing: border-box; margin: 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px; vertical-align: baseline; color: #999999; font-family: Arial, sans-serif; line-height: 22px; background: transparent"><div class="skin_list" style="box-sizing: border-box; margin: 0px; padding: 0px 20px 0px 0px; border: 0px; outline: 0px; vertical-align: baseline; max-width: 1200px; background: transparent"><dl class="list_c clearfix detail_list" style="box-sizing: border-box; margin: 0px; padding: 0px 0px 5px; font-family: 'Microsoft YaHei'; list-style: none; border: 0px; outline: 0px; vertical-align: baseline; position: relative; background: transparent"><dd style="box-sizing: border-box; line-height: 1.42857; margin: 0px 0px 0px 95px; padding: 0px; list-style: none; border: 0px; outline: 0px; vertical-align: baseline; max-width: 1000px; background: transparent"><div id="article_content" class="skin_detail" style="box-sizing: border-box; margin: 0px; padding: 20px 0px; border: 0px; outline: 0px; vertical-align: baseline; word-break: break-word; background: transparent"><div class="markdown_views" style="box-sizing: border-box; margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; font-family: 'microsoft yahei'; background: transparent"><h1 style="box-sizing: border-box; margin: 0.8em 0px; font-size: 28px; font-family: 'Microsoft YaHei'; font-weight: 100; line-height: 30px; color: #666666; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background: transparent">DB主从一致性的几种解决方法</h1><h2 style="box-sizing: border-box; font-family: 'Microsoft YaHei'; font-weight: 100; line-height: 1.1; color: #666666; margin: 0.8em 0px; font-size: 22px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background: transparent">起源</h2><p style="box-sizing: border-box; margin: 0px 0px 1.1em; padding: 0px; font-family: 'Microsoft YaHei'; border: 0px; outline: 0px; font-size: 15px; vertical-align: baseline; color: #666666; line-height: 26px; background: transparent">现在基本所有的程序中都会用到数据库，而数据库其实就是对所有业务逻辑处理结果的保存，所以不论在什么情况下数据的丢失都不被允许的，最坏的情况也要最小化数据的丢失程度，所以一般情况下，数据源都会至少配有两个节点，一个业务处理使用的节点，一个甚至多个从节点，这些从节点就是我们常说的冷备，业务处理节点（主节点）和备份节点一定的时间间隔内进行数据同步，从而来保证当一个数据源坏掉之后，数据也不会丢失，或着丢失很少（主要看同步的时间间隔）。但是为了提高资源的使用效率，所以有人就提出了，可不可以让冷备也被利用起来，替主节点分担部分压力，所以就提出了读写分离的方案。</p><h2 style="box-sizing: border-box; font-family: 'Microsoft YaHei'; font-weight: 100; line-height: 1.1; color: #666666; margin: 0.8em 0px; font-size: 22px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background: transparent">读写分离</h2><p style="box-sizing: border-box; margin: 0px 0px 1.1em; padding: 0px; font-family: 'Microsoft YaHei'; border: 0px; outline: 0px; font-size: 15px; vertical-align: baseline; color: #666666; line-height: 26px; background: transparent"><img style="box-sizing: border-box; border: 0px; vertical-align: middle; outline: 0px; margin: 0px; padding: 0px; max-width: 100%; background: transparent" src="http://img.blog.csdn.net/20160519201649725" border="0" alt="这里写图片描述" />&nbsp;<br />读写分离提高了资源的利用效率的同时也引出了一个问题，就是由于延时（网络传输，操作）而引起的数据库主从不一致的问题，对于这个问题，给一下集中解决方案。</p><hr style="box-sizing: border-box; height: 1px; margin: 2em 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-top-style: solid; border-top-color: rgba(128, 128, 128, 0.0980392); width: 999.188px; background-color: #eeeeee" /><h3 style="box-sizing: border-box; font-family: 'Microsoft YaHei'; font-weight: 100; line-height: 1.1; color: inherit; margin: 0.8em 0px; font-size: 14px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background: transparent">1-半同步复制</h3><p style="box-sizing: border-box; margin: 0px 0px 1.1em; padding: 0px; font-family: 'Microsoft YaHei'; border: 0px; outline: 0px; font-size: 15px; vertical-align: baseline; color: #666666; line-height: 26px; background: transparent">主从不一致的原因是延时引起的,所以要消除这个延时的影响，可以从主库进行CUD操作时进行规避，办法就是等主从同步完成之后，主库上的写请求再返回，就是大家常说的&ldquo;半同步复制&rdquo;semi-sync。</p><div class="sequence-diagram" style="box-sizing: border-box; margin: 0px 0px 1.1em; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; text-align: center; background: transparent">请求请求主库主库从库从库CUD操作开始同步同步完成CUD操作完成</div><ul style="box-sizing: border-box; margin: 0px 0px 22px; padding: 0px; font-family: 'Microsoft YaHei'; list-style: square inside; border: 0px; outline: 0px; vertical-align: baseline; background: transparent"><li style="box-sizing: border-box; margin: 0px; padding: 0px; list-style: none; border: 0px; outline: 0px; vertical-align: baseline; background: transparent"><strong style="box-sizing: border-box; margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background: transparent">方案优点：利用数据库原生功能，比较简单</strong></li><li style="box-sizing: border-box; margin: 0px; padding: 0px; list-style: none; border: 0px; outline: 0px; vertical-align: baseline; background: transparent"><strong style="box-sizing: border-box; margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background: transparent">方案缺点：主库的写请求时延会增长，吞吐量会降低</strong></li></ul><hr style="box-sizing: border-box; height: 1px; margin: 2em 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-top-style: solid; border-top-color: rgba(128, 128, 128, 0.0980392); width: 999.188px; background-color: #eeeeee" /><h3 style="box-sizing: border-box; font-family: 'Microsoft YaHei'; font-weight: 100; line-height: 1.1; color: inherit; margin: 0.8em 0px; font-size: 14px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background: transparent">2-数据库中间件</h3><h4 style="box-sizing: border-box; font-family: 'Microsoft YaHei'; font-weight: 100; line-height: 1.1; color: inherit; margin: 0.8em 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background: transparent">CUD操作</h4><div class="sequence-diagram" style="box-sizing: border-box; margin: 0px 0px 1.1em; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; text-align: center; background: transparent">请求请求中间件中间件主库主库从库从库CUD操作路由同步</div><h4 style="box-sizing: border-box; font-family: 'Microsoft YaHei'; font-weight: 100; line-height: 1.1; color: inherit; margin: 0.8em 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background: transparent">R操作</h4><div class="sequence-diagram" style="box-sizing: border-box; margin: 0px 0px 1.1em; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; text-align: center; background: transparent">请求请求中间件中间件主库主库从库从库R操作同步未完成同步完成</div><ul style="box-sizing: border-box; margin: 0px 0px 22px; padding: 0px; font-family: 'Microsoft YaHei'; list-style: square inside; border: 0px; outline: 0px; vertical-align: baseline; background: transparent"><li style="box-sizing: border-box; margin: 0px; padding: 0px; list-style: none; border: 0px; outline: 0px; vertical-align: baseline; background: transparent"><strong style="box-sizing: border-box; margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background: transparent">方案优点：能保证绝对一致</strong></li><li style="box-sizing: border-box; margin: 0px; padding: 0px; list-style: none; border: 0px; outline: 0px; vertical-align: baseline; background: transparent"><strong style="box-sizing: border-box; margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background: transparent">方案缺点：数据库中间件的成本比较高</strong></li></ul><hr style="box-sizing: border-box; height: 1px; margin: 2em 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-top-style: solid; border-top-color: rgba(128, 128, 128, 0.0980392); width: 999.188px; background-color: #eeeeee" /><h3 style="box-sizing: border-box; font-family: 'Microsoft YaHei'; font-weight: 100; line-height: 1.1; color: inherit; margin: 0.8em 0px; font-size: 14px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background: transparent">3-缓存记录写key法</h3><h4 style="box-sizing: border-box; font-family: 'Microsoft YaHei'; font-weight: 100; line-height: 1.1; color: inherit; margin: 0.8em 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background: transparent">CUD操作</h4><p style="box-sizing: border-box; margin: 0px 0px 1.1em; padding: 0px; font-family: 'Microsoft YaHei'; border: 0px; outline: 0px; font-size: 15px; vertical-align: baseline; color: #666666; line-height: 26px; background: transparent">（1）将某个库上的某个key要发生写操作，记录在cache里，并设置&ldquo;经验主从同步时间&rdquo;的cache超时时间，例如500ms&nbsp;<br />（2）修改数据库</p><h4 style="box-sizing: border-box; font-family: 'Microsoft YaHei'; font-weight: 100; line-height: 1.1; color: inherit; margin: 0.8em 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background: transparent">R操作</h4><p style="box-sizing: border-box; margin: 0px 0px 1.1em; padding: 0px; font-family: 'Microsoft YaHei'; border: 0px; outline: 0px; font-size: 15px; vertical-align: baseline; color: #666666; line-height: 26px; background: transparent">（1）先到cache里查看，对应库的对应key有没有相关数据&nbsp;<br />（2）如果cache hit，有相关数据，说明这个key上刚发生过写操作，此时需要将请求路由到主库读最新的数据&nbsp;<br />（3）如果cache miss，说明这个key上近期没有发生过写操作，此时将请求路由到从库，继续读写分离</p><ul style="box-sizing: border-box; margin: 0px 0px 22px; padding: 0px; font-family: 'Microsoft YaHei'; list-style: square inside; border: 0px; outline: 0px; vertical-align: baseline; background: transparent"><li style="box-sizing: border-box; margin: 0px; padding: 0px; list-style: none; border: 0px; outline: 0px; vertical-align: baseline; background: transparent"><strong style="box-sizing: border-box; margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background: transparent">方案优点：相对数据库中间件，成本较低</strong></li><li style="box-sizing: border-box; margin: 0px; padding: 0px; list-style: none; border: 0px; outline: 0px; vertical-align: baseline; background: transparent"><strong style="box-sizing: border-box; margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background: transparent">方案缺点：方案缺点：为了保证&ldquo;一致性&rdquo;，引入了一个cache组件，并且读写数据库时都多了一步cache操作</strong></li></ul></div></div></dd></dl></div><div class="skin_nav" style="box-sizing: border-box; margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; position: fixed; right: 275px; top: 70px; background: transparent"><div class="skin_edit" style="box-sizing: border-box; margin: 0px 0px 10px; padding: 0px; border: 2px solid #2f2f2f; outline: 0px; vertical-align: baseline; width: 28px; height: 28px; line-height: 24px; text-align: center; cursor: pointer; position: relative; background-image: initial; background-attachment: initial; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial"></div></div><div class="rssFix" style="box-sizing: border-box; margin: 0px; padding: 0px; border: 2px solid #2f2f2f; outline: 0px; vertical-align: baseline; width: 28px; height: 28px; text-align: center; line-height: 24px; position: fixed; bottom: 70px; right: 275px; background-image: initial; background-attachment: initial; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial"><a style="box-sizing: border-box; color: #444444; text-decoration: none; margin: 0px; padding: 0px; font-family: 'Microsoft YaHei'; outline: none; background: transparent" href="http://blog.csdn.net/xidiancyp/rss/list" class="column"></a></div></div><div class="detail_b" style="box-sizing: border-box; margin: 0px 0px 0px 95px; padding: 0px 60px 0px 0px; border: 0px; outline: 0px; font-size: 14px; vertical-align: baseline; max-width: 1250px; color: #999999; font-family: Arial, sans-serif; line-height: 22px; background: transparent"><p style="box-sizing: border-box; margin: 0px 0px 22px; padding: 0px; font-family: 'Microsoft YaHei'; border: 0px; outline: 0px; vertical-align: baseline; color: #e96d5b; background: transparent" class="reprint_copy">版权声明：本文为博主原创文章，未经博主允许不得转载。</p></div>
]]>
</description>
</item><item>
<link>http://i.renjihe.com/blog/read.php?#blogcomment</link>
<title><![CDATA[[评论] DB主从一致性的几种解决方法]]></title> 
<author> &lt;user@domain.com&gt;</author>
<category><![CDATA[评论]]></category>
<pubDate>Thu, 01 Jan 1970 00:00:00 +0000</pubDate> 
<guid>http://i.renjihe.com/blog/read.php?#blogcomment</guid> 
<description>
<![CDATA[ 
	
]]>
</description>
</item>
</channel>
</rss>