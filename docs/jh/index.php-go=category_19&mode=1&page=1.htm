<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-cn">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="Content-Language" content="UTF-8" />
<meta content="all" name="robots" />
<meta name="author" content="流浪的龙－个人知识管理" />
<meta name="description" content="" />
<meta name="keywords" content="bo-blog" />
<xbasehref="http://i.renjihe.com/blog/" />
<link rel="alternate" title="流浪的龙－个人知识管理" href="feed.php" type="application/rss+xml" />
<link rel="stylesheet" rev="stylesheet" href="styles.css" tppabs="http://i.renjihe.com/blog/template/default/styles.css" type="text/css" media="all" />

<title>编译原理 - 流浪的龙－个人知识管理 - </title>
<script type="text/javascript" src="common.js-jsver=2.1.1.3626.3" tppabs="http://i.renjihe.com/blog/images/js/common.js?jsver=2.1.1.3626.3"></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://i.renjihe.com/blog/inc/rsd.php" />
<script type="text/javascript" src="jslang.js-jsver=2.1.1.3626.3" tppabs="http://i.renjihe.com/blog/lang/zh-cn/jslang.js?jsver=2.1.1.3626.3"></script>
<script type="text/javascript" src="ajax.js-jsver=2.1.1.3626.3" tppabs="http://i.renjihe.com/blog/images/js/ajax.js?jsver=2.1.1.3626.3"></script>
<script type="text/javascript" src="swfobject.js-jsver=2.1.1.3626.3" tppabs="http://i.renjihe.com/blog/images/js/swfobject.js?jsver=2.1.1.3626.3"></script>
<script type="text/javascript">
//<![CDATA[
var moreimagepath="template/default/images";
var shutajax=0;
var absbaseurl='index.htm'/*tpa=http://i.renjihe.com/blog/*/;
//]]>
</script>
<link title="搜索 流浪的龙－个人知识管理" rel="search"  type="application/opensearchdescription+xml"  href="http://i.renjihe.com/blog/inc/opensearch.php" />



</head>
<body id="pagelocation-index">
<div id="wrapper">
	<div id="innerWrapper">
		<div id="header">
			<div id="innerHeader">
				<div id="blogLogo">
				</div>
				<div class="blog-header">
					<h1 class="blog-title"><a href="index.php.htm" tppabs="http://i.renjihe.com/blog/index.php">流浪的龙－个人知识管理</a></h1>
					<div class="blog-desc"></div>
				</div>
				<div id="menu">
					<ul>
					<li><span id="nav_index" class="activepage"><a href="index.php.htm" tppabs="http://i.renjihe.com/blog/index.php" ><span id="navitem_index" class="activepageitem">首页</span></a></span></li>
<li><span id="nav_http_3A_2F_2Fi.renjihe.com_2F"><a href="javascript:if(confirm('http://i.renjihe.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://i.renjihe.com/'" tppabs="http://i.renjihe.com/"  target="_blank"><span id="navitem_http_3A_2F_2Fi.renjihe.com_2F">个性首页</span></a></span></li>
<li><span id="nav_http_3A_2F_2Fi.renjihe.com_2Flink.html"><a href="javascript:if(confirm('http://i.renjihe.com/link.html  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://i.renjihe.com/link.html'" tppabs="http://i.renjihe.com/link.html"  target="_blank"><span id="navitem_http_3A_2F_2Fi.renjihe.com_2Flink.html">网址导航</span></a></span></li>
<li><span id="nav_tag"><a href="tag.php.htm" tppabs="http://i.renjihe.com/blog/tag.php" ><span id="navitem_tag">标签</span></a></span></li>
<li><span id="nav_guestbook"><a href="guestbook.php.htm" tppabs="http://i.renjihe.com/blog/guestbook.php" ><span id="navitem_guestbook">留言</span></a></span></li>
					</ul>
				</div>
			</div>
		</div>
		<div id="mainWrapper">
			<div id="content" class="content">
				<div id="innerContent">
					<div class="announce" style="display: block">
						<div class="announce-content">
						编译原理
						</div>
					</div>
					<div class="article-top" style="display: none">
						<div class="pages">
							<span class="pagebar-mainbody"> 分页： 1/9  <a href="index.php-go=category_19&mode=1&page=1.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_19&mode=1&page=1"><img src="doubleleft.gif" tppabs="http://i.renjihe.com/blog/template/default/images/arrows/doubleleft.gif" alt="第一页" title="第一页" border="0"/></a> <span class="pagebar-selections"> <span class="pagelink-current">1</span>  <a href="read.php-7179.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_19&mode=1&page=2">2</a>  <a href="read.php-7178.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_19&mode=1&page=3">3</a>  <a href="read.php-7177.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_19&mode=1&page=4">4</a>  <a href="read.php-7176.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_19&mode=1&page=5">5</a>  <a href="read.php-7175.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_19&mode=1&page=6">6</a>  <a href="read.php-7174.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_19&mode=1&page=7">7</a>  <a href="read.php-7173.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_19&mode=1&page=8">8</a>  <a href="read.php-7172.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_19&mode=1&page=9">9</a> </span> <a href="read.php-7179.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_19&mode=1&page=2"><img src="singleright.gif" tppabs="http://i.renjihe.com/blog/template/default/images/arrows/singleright.gif" alt="下页" title="下页" border="0"/></a>  <a href="read.php-7172.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_19&mode=1&page=9"><img src="doubleright.gif" tppabs="http://i.renjihe.com/blog/template/default/images/arrows/doubleright.gif" alt="最后页" title="最后页" border="0"/></a> </span> [ 显示模式： <a href="index.php-go=category_19&mode=1&page=1.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_19&mode=1&page=1" title="切换到摘要模式">摘要</a> | <a href="index.php-go=category_19&mode=2&page=1.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_19&mode=2&page=1" title="切换到列表模式">列表</a> ]
						</div>
					</div>
					<div class="textbox">
	<div class="textbox-calendar">
	<span class="textbox-calendar-month">Aug</span>
	<span class="textbox-calendar-day">31</span>
	</div>
	<div class="textbox-title">
		<h4>
		<a href="read.php-7522.htm" tppabs="http://i.renjihe.com/blog/read.php?7522">康托尔、哥德尔、图灵——永恒的金色对角线(rev#2)</a> <span id="starid7522"><img src="unstarred.gif" tppabs="http://i.renjihe.com/blog/template/default/images/others/unstarred.gif" alt="" title="未加星标" border="0"/></span> <img src="blank.gif" tppabs="http://i.renjihe.com/blog/images/weather/blank.gif" alt="不指定" title="不指定"/>
		</h4>
		<div class="textbox-label">
		<a href="view.php-go=user_1.htm" tppabs="http://i.renjihe.com/blog/view.php?go=user_1" target="_blank">renjihe1988</a> , 23:27 , <a href="index.php-go=category_2.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_2" title="查看分类： 软件">软件</a> &raquo; <a href="index.php-go=category_19.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_19" title="查看分类： 编译原理">编译原理</a> , <a href="read.php-7522.htm#reply" tppabs="http://i.renjihe.com/blog/read.php?7522#reply" title="发表您的评论">评论(0)</a> , <a href='javascript: void(0);' title="查看引用地址" onclick='showhidediv("tb7522");'>引用(0)</a> , <a href="read.php-7522.htm" tppabs="http://i.renjihe.com/blog/read.php?7522">阅读(2)</a> , Via 本站原创 
		</div>
	</div>
	<div id="tb7522" style="display: none;" class="textbox-tburl"><strong>引用功能被关闭了。</strong></div>
	
	<div class="textbox-content">
	<p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><em>我看到了它，却不敢相信它</em><sup>[1]</sup><em>。</em></p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><em>&mdash;&mdash;</em><em>康托尔</em></p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><em>计算机是数学家一次失败思考的产物。</em></p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><em>&mdash;&mdash;</em><em>无名氏</em></p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><a style="color: #313428" href="javascript:if(confirm('http://en.wikipedia.org/wiki/Kurt_Godel  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://en.wikipedia.org/wiki/Kurt_Godel'" tppabs="http://en.wikipedia.org/wiki/Kurt_Godel">哥德尔</a>的<a style="color: #313428" href="javascript:if(confirm('http://www.answers.com/topic/g-del-s-incompleteness-theorems  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.answers.com/topic/g-del-s-incompleteness-theorems'" tppabs="http://www.answers.com/topic/g-del-s-incompleteness-theorems">不完备性定理</a>震撼了20世纪数学界的天空，其数学意义颠覆了<a style="color: #313428" href="javascript:if(confirm('http://en.wikipedia.org/wiki/David_Hilbert  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://en.wikipedia.org/wiki/David_Hilbert'" tppabs="http://en.wikipedia.org/wiki/David_Hilbert">希尔伯特</a>的形式化数学的宏伟计划，其哲学意义直到21世纪的今天仍然不断被延伸到各个自然学科，深刻影响着人们的思维。<a style="color: #313428" href="javascript:if(confirm('http://www.alanturing.net/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.alanturing.net/'" tppabs="http://www.alanturing.net/">图灵</a>为了解决希尔伯特著名的<a style="color: #313428" href="javascript:if(confirm('http://en.wikipedia.org/wiki/Hilbert\'s_tenth_problem  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://en.wikipedia.org/wiki/Hilbert\'s_tenth_problem'" tppabs="http://en.wikipedia.org/wiki/Hilbert's_tenth_problem">第十问题</a>而提出有效计算模型，进而作出了<a style="color: #313428" href="javascript:if(confirm('http://en.wikipedia.org/wiki/Computability_theory_(computation)  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://en.wikipedia.org/wiki/Computability_theory_(computation)'" tppabs="http://en.wikipedia.org/wiki/Computability_theory_(computation)">可计算理论</a>和现代计算机的奠基性工作，著名的停机问题给出了机械计算模型的能力极限，其深刻的意义和漂亮的证明使它成为可计算理论中的标志性定理之一。<a style="color: #313428" href="javascript:if(confirm('http://en.wikipedia.org/wiki/Alonzo_Church  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://en.wikipedia.org/wiki/Alonzo_Church'" tppabs="http://en.wikipedia.org/wiki/Alonzo_Church">丘齐</a>，跟图灵同时代的天才，则从另一个抽象角度提出了<a style="color: #313428" href="javascript:if(confirm('http://en.wikipedia.org/wiki/Lambda_calculus  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://en.wikipedia.org/wiki/Lambda_calculus'" tppabs="http://en.wikipedia.org/wiki/Lambda_calculus">lambda算子</a>的思想，与<a style="color: #313428" href="javascript:if(confirm('http://en.wikipedia.org/wiki/Turing_machine  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://en.wikipedia.org/wiki/Turing_machine'" tppabs="http://en.wikipedia.org/wiki/Turing_machine">图灵机</a>抽象的倾向于硬件性不同，丘齐的lambda算子理论是从数学的角度进行抽象，不关心运算的机械过程而只关心运算的抽象性质，只用最简洁的几条公理便建立起了与图灵机<a style="color: #313428" href="javascript:if(confirm('http://en.wikipedia.org/wiki/Turing_machine  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://en.wikipedia.org/wiki/Turing_machine#Models_equivalent_to_the_Turing_machine_model'" tppabs="http://en.wikipedia.org/wiki/Turing_machine#Models_equivalent_to_the_Turing_machine_model">完全等价</a>的计算模型，其体现出来的数学抽象美开出了<a style="color: #313428" href="javascript:if(confirm('http://en.wikipedia.org/wiki/Functional_programming  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://en.wikipedia.org/wiki/Functional_programming'" tppabs="http://en.wikipedia.org/wiki/Functional_programming">函数式编程语言</a>这朵奇葩，<a style="color: #313428" href="javascript:if(confirm('http://en.wikipedia.org/wiki/Lisp_programming_language  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://en.wikipedia.org/wiki/Lisp_programming_language'" tppabs="http://en.wikipedia.org/wiki/Lisp_programming_language">Lisp</a>、<a style="color: #313428" href="javascript:if(confirm('http://en.wikipedia.org/wiki/Scheme_(programming_language)  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://en.wikipedia.org/wiki/Scheme_(programming_language)'" tppabs="http://en.wikipedia.org/wiki/Scheme_(programming_language)">Scheme</a>、<a style="color: #313428" href="javascript:if(confirm('http://www.haskell.org/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.haskell.org/'" tppabs="http://www.haskell.org/">Haskell</a>&hellip; 这些以抽象性和简洁美为特点的语言至今仍然活跃在计算机科学界，虽然由于其本质上源于lambda算子理论的抽象方式不符合人的思维习惯从而注定无法成为主流的编程语言<sup>[2]</sup>，然而这仍然无法妨碍它们成为编程理论乃至计算机学科的最佳教本。而诞生于函数式编程语言的神奇的<a style="color: #313428" href="javascript:if(confirm('http://en.wikipedia.org/wiki/Y_combinator  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://en.wikipedia.org/wiki/Y_combinator'" tppabs="http://en.wikipedia.org/wiki/Y_combinator">Y combinator</a>至今仍然让人们陷入深沉的震撼和反思当中&hellip;</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">然而，这一切的一切，看似不很相关却又有点相关，认真思考其关系却又有点一头雾水的背后，其实隐隐藏着一条线，这条线把它们从本质上串到了一起，而顺着时光的河流逆流而上，我们将会看到，这条线的尽头，不是别人，正是只手拨开被不严密性问题困扰的19世纪数学界阴沉天空的天才数学家<a style="color: #313428" href="javascript:if(confirm('http://en.wikipedia.org/wiki/Georg_Cantor  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://en.wikipedia.org/wiki/Georg_Cantor'" tppabs="http://en.wikipedia.org/wiki/Georg_Cantor">康托尔</a>，康托尔创造性地将一一对应和对角线方法运用到无穷集合理论的建立当中，这个被希尔伯特称为&ldquo;谁也无法将我们从康托尔为我们创造的乐园中驱逐出去&rdquo;、被罗素称为&ldquo;19世纪最伟大的智者之一&rdquo;的人，他在<a style="color: #313428" href="javascript:if(confirm('http://www.amazon.com/Contributions-Founding-Theory-Transfinite-Numbers/dp/0875481574/ref=sr_1_4/103-3576835-0834231?ie=UTF8&s=books&qid=1177237889&sr=8-4  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.amazon.com/Contributions-Founding-Theory-Transfinite-Numbers/dp/0875481574/ref=sr_1_4/103-3576835-0834231?ie=UTF8&s=books&qid=1177237889&sr=8-4'" tppabs="http://www.amazon.com/Contributions-Founding-Theory-Transfinite-Numbers/dp/0875481574/ref=sr_1_4/103-3576835-0834231?ie=UTF8&s=books&qid=1177237889&sr=8-4">集合论方面的工作</a>终于驱散了不严密性问题带来的阴霾，仿佛一道金色的阳光刺破乌云，19世纪的数学终于看到了真正严格化的曙光，数学终于得以站在了前所未有的坚固的基础之上；集合论至今仍是数学里最基础和最重要的理论之一。而康托尔当初在研究无穷集合时最具天才的方法之一&mdash;&mdash;对角线方法&mdash;&mdash;则带来了极其深远的影响，其纯粹而直指事物本质的思想如洪钟大吕般响彻数学和哲学的每一个角落<sup>[3]</sup>。随着本文的展开，你将会看到，刚才提到的一切，歌德尔的不完备性定理，图灵的停机问题，lambda算子理论中神奇的Y combinator、乃至著名的罗素悖论、理发师悖论等等，其实都源自这个简洁、纯粹而同时又是最优美的数学方法，反过来说，从康托尔的对角线方法出发，我们可以轻而易举地推导出哥德尔的不完备性定理，而由后者又可以轻易导出停机问题和Y combinator，实际上，我们将会看到，后两者也可以直接由康托尔的对角线方法导出。尤其是Y combinator，这个形式上绕来绕去，本质上捉摸不透，看上去神秘莫测的算子，其实只是一个非常自然而然的推论，如果从哥德尔的不完备性定理出发，它甚至比停机问题还要来得直接简单。总之，你将会看到这些看似深奥的理论是如何由一个至为简单而又至为深刻的数学方法得出的，你将会看到最纯粹的数学美。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><strong>图灵的停机问题</strong><strong>(The Halting Problem)</strong></p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><em>了解停机问题的可以直接跳过这一节，到下一节&ldquo;Y Combinator&rdquo;，了解后者的再跳到下一节&ldquo;哥德尔的不完备性定理&rdquo;</em></p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">我们还是从图灵著名的停机问题说起，一来它相对来说是我们要说的几个定理当中最简单的，二来它也最贴近程序员。实际上，我以前曾写过<a style="color: #313428" href="javascript:if(confirm('http://blog.csdn.net/pongba/archive/2006/03/11/621723.aspx  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://blog.csdn.net/pongba/archive/2006/03/11/621723.aspx'" tppabs="http://blog.csdn.net/pongba/archive/2006/03/11/621723.aspx">一篇关于图灵机的文章</a>，有兴趣的读者可以从那篇开始，那篇主要是从理论上阐述，所以这里我们打算避开抽象的理论，换一种符合程序员思维习惯的直观方式来加以解释。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><strong>停机问题</strong></p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><em>不存在这样一个程序（算法），它能够计算任何程序（算法）在给定输入上是否会结束（停机）。</em></p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">那么，如何来证明这个停机问题呢？反证。假设我们某一天真做出了这么一个极度聪明的万能算法（就叫God_algo吧），你只要给它一段程序（二进制描述），再给它这段程序的输入，它就能告诉你这段程序在这个输入上会不会结束（停机），我们来编写一下我们的这个算法吧：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">bool God_algo(char* program, char* input)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">&#123;</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">if(<em>&lt;program</em>&gt;&nbsp;<em>halts on&nbsp;</em>&lt;<em>input</em>&gt;)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">return true;</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">return false;</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">&#125;</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">这里我们假设if的判断语句里面是你天才思考的结晶，它能够像上帝一样洞察一切程序的宿命。现在，我们从这个God_algo出发导出一个新的算法：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">bool Satan_algo(char* program)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">&#123;</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">if(&nbsp;<em>God_algo</em>(program, program) )&#123;</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">while(1); // loop forever!</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">return false; // can never get here!</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">&#125;</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">else</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">return true;</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">&#125;</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">正如它的名字所暗示的那样，这个算法便是一切邪恶的根源了。当我们把这个算法运用到它自身身上时，会发生什么呢？</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">Satan_algo(Satan_algo);</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">我们来分析一下这行简单的调用：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">显然，Satan_algo(Satan_algo)这个调用要么能够运行结束返回（停机），要么不能返回（loop forever）。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><em>如果它能够结束</em>，那么Santa_algo算法里面的那个if判断就会成立（因为God_algo(Santa_algo,Santa_algo)将会返回true），从而程序便进入那个包含一个无穷循环while(1);的if分支，于是这个Satan_algo(Satan_algo)调用<em>便永远不会返回（结束）了</em>。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">而<em>如果</em><em>Satan_algo(Satan_algo)</em><em>不能结束（停机）呢</em>，则if判断就会失败，从而选择另一个if分支并返回true，即<em>Satan_algo(Satan_algo)</em><em>又</em><em>能够返回（停机）</em>。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">总之，我们有：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><em>Satan_algo(Satan_algo)</em><em>能够停机</em><em>&nbsp;</em><em>=&gt;&nbsp;</em><em>它不能停机</em></p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><em>Satan_algo(Satan_algo)</em><em>不能停机</em><em>&nbsp;</em><em>=&gt;&nbsp;</em><em>它能够停机</em></p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">所以它停也不是，不停也不是。左右矛盾。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">于是，我们的假设，即God_algo算法的存在性，便不成立了。正如<a style="color: #313428" href="javascript:if(confirm('http://en.wikipedia.org/wiki/Joseph_Louis_Lagrange  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://en.wikipedia.org/wiki/Joseph_Louis_Lagrange'" tppabs="http://en.wikipedia.org/wiki/Joseph_Louis_Lagrange">拉格朗日</a>所说：&ldquo;陛下，我们不需要（上帝）这个假设&rdquo;<sup>[4]</sup>。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">这个证明相信每个程序员都能够容易的看懂。然而，这个看似不可捉摸的技巧背后其实隐藏着深刻的数学原理（甚至是哲学原理）。在没有认识到这一数学原理之前，至少我当时是对于图灵如何想出这一绝妙证明感到无法理解。但后面，在介绍完了与图灵的停机问题&ldquo;同构&rdquo;的Y combinator之后，我们会深入哥德尔的不完备性定理，在理解了哥德尔不完备性定理之后，我们从这一同样绝妙的定理出发，就会突然发现，离停机问题和神奇的Y combinator只是咫尺之遥而已。当然，最后我们会回溯到一切的尽头，康托尔那里，看看停机问题、Y combinator、以及不完备性定理是如何自然而然地由康托尔的对角线方法推导出来的，我们将会看到这些看似神奇的构造性证明的背后，其实是一个简洁优美的数学方法在起作用。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><strong>Y Combinator</strong></p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><em>了解</em><em>Y combinator</em><em>的请直接跳过这一节，到下一节</em><em>&ldquo;</em><em>哥德尔的不完备性定理</em><em>&rdquo;</em><em>。</em></p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">让我们暂且搁下但记住绕人的图灵停机问题，走进函数式编程语言的世界，走进由跟图灵机理论等价的lambda算子发展出来的另一个平行的语言世界。让我们来看一看被人们一代一代吟唱着的神奇的Y Combinator&hellip;</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">关于Y Combinator的文章可谓数不胜数，这个由师从希尔伯特的著名逻辑学家<a style="color: #313428" href="javascript:if(confirm('http://en.wikipedia.org/wiki/Haskell_Curry  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://en.wikipedia.org/wiki/Haskell_Curry'" tppabs="http://en.wikipedia.org/wiki/Haskell_Curry">Haskell B.Curry</a>（Haskell语言就是以他命名的，而函数式编程语言里面的Curry手法也是以他命名）&ldquo;发明&rdquo;出来的组合算子（Haskell是研究<a style="color: #313428" href="javascript:if(confirm('http://en.wikipedia.org/wiki/Combinatory_logic  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://en.wikipedia.org/wiki/Combinatory_logic'" tppabs="http://en.wikipedia.org/wiki/Combinatory_logic">组合逻辑(combinatory logic)</a>的）仿佛有种神奇的魔力，它能够算出给定lambda表达式（函数）的<a style="color: #313428" href="javascript:if(confirm('http://en.wikipedia.org/wiki/Fixed_point  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://en.wikipedia.org/wiki/Fixed_point'" tppabs="http://en.wikipedia.org/wiki/Fixed_point">不动点</a>。从而使得递归成为可能。事实上，我们待会就会看到，Y Combinator在神奇的表面之下，其实隐藏着深刻的意义，其背后体现的意义，曾经开出过历史上最灿烂的数学之花，所以MIT的计算机科学系将它做成系徽也就不足为奇了<sup>[5]</sup>。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">当然，要了解这个神奇的算子，我们需要一点点lambda算子理论的基础知识，不过别担心，lambda算子理论是我目前见过的最简洁的公理系统，这个系统仅仅由三条非常简单的公理构成，而这三条公理里面我们又只需要关注前两条。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><em>以下小节</em><em>&mdash;&mdash;lambda calculus&mdash;&mdash;</em><em>纯粹是为了没有接触过</em><em>lambda</em><em>算子理论的读者准备的，并不属于本文重点讨论的东西，然而要讨论</em><em>Y combinator</em><em>就必须先了解一下</em><em>lambda</em><em>（当然，以编程语言来了解也行，但是你会看到，丘齐最初提出的</em><em>lambda</em><em>算子理论才是最最简洁和漂亮的，学起来也最省事。）所以我单独准备了一个小节来介绍它。如果你已经知道，可以跳过这一小节。不知道的读者也可以跳过这一小节去</em><em>wikipedia</em><em>上面看，这里的介绍使用了</em><em>wikipedia</em><em>上的方式</em></p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><strong>lambda calculus</strong></p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">先来看一下lambda表达式的基本语法(BNF)：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">&lt;expr&gt; ::= &lt;identifier&gt;</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">&lt;expr&gt; ::=&nbsp;<em>lambda</em>&nbsp;&lt;identifier-list&gt;. &lt;expr&gt;</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">&lt;expr&gt; ::= (&lt;expr&gt; &lt;expr&gt;)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">前两条语法用于生成lambda表达式（lambda函数），如：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><em>lambda</em>&nbsp;x y. x + y</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><em>haskell</em><em>里面为了简洁起见用</em><em>&ldquo;&#92;&rdquo;</em><em>来代替希腊字母</em><em>lambda</em><em>，它们形状比较相似。故而上面的定义也可以写成：</em></p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><em>&#92; x y. x + y</em></p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">这是一个匿名的加法函数，它接受两个参数，返回两值相加的结果。当然，这里我们为了方便起见赋予了lambda函数直观的计算意义，而实际上lambda calculus里面一切都只不过是文本替换，有点像C语言的宏。并且这里的&ldquo;+&rdquo;我们假设已经是一个具有原子语义的运算符<sup>[6]</sup>，此外，为了方便我们使用了中缀表达（按照lambda calculus系统的语法实际上应该写成&ldquo;(+ x y)&rdquo;才对&mdash;&mdash;参考第三条语法）。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">那么，函数定义出来了，怎么使用呢？最后一条规则就是用来调用一个lambda函数的：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">((<em>lambda</em>&nbsp;x y. x + y) 2 3)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">以上这一行就是把刚才定义的加法函数运用到2和3上（这个调用语法形式跟<a style="color: #313428" href="javascript:if(confirm('http://en.wikipedia.org/wiki/Imperative_programming  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://en.wikipedia.org/wiki/Imperative_programming'" tppabs="http://en.wikipedia.org/wiki/Imperative_programming">命令式语言(imperative language)</a>惯用的调用形式有点区别，后者是&ldquo;f(x, y)&rdquo;，而这里是&ldquo;(f x y)&rdquo;，不过好在顺序没变:) ）。为了表达简洁一点，我们可以给(<em>lambda</em>&nbsp;x y. x + y)起一个名字，像这样：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">let Add = (<em>lambda</em>&nbsp;x y. x + y)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">这样我们便可以使用Add来表示该lambda函数了：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">(Add 2 3)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">不过还是为了方便起见，后面调用的时候一般用&ldquo;Add(2, 3)&rdquo;，即我们熟悉的形式。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">有了语法规则之后，我们便可以看一看这个语言系统的两条简单至极的公理了：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><em>Alpha</em><em>转换公理</em>：例如，&ldquo;lambda x y. x + y&rdquo;转换为&ldquo;lambda a b. a + b&rdquo;。换句话说，函数的参数起什么名字没有关系，可以随意替换，只要函数体里面对参数的使用的地方也同时注意相应替换掉就是了。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><em>Beta</em><em>转换公理</em>：例如，&ldquo;(lambda x y. x + y) 2 3&rdquo;转换为&ldquo;2 + 3&rdquo;。这个就更简单了，也就是说，当把一个lambda函数用到参数身上时，只需用实际的参数来替换掉其函数体中的相应变量即可。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">就这些。是不是感觉有点太简单了？但事实就是如此，lambda算子系统从根本上其实就这些东西，然而你却能够从这几个简单的规则中推演出神奇无比的Y combinator来。我们这就开始！</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><strong>递归的迷思</strong></p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">敏锐的你可能会发现，就以上这两条公理，我们的lambda语言中无法表示递归函数，为什么呢？假设我们要计算经典的阶乘，递归描述肯定像这样：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">f(n):</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">if n == 0 return 1</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">return n*f(n-1)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">当然，上面这个程序是假定n为正整数。这个程序显示了一个特点，f在定义的过程中用到了它自身。那么如何在lambda算子系统中表达这一函数呢？理所当然的想法如下：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><em>lambda</em>&nbsp;n. If_Else n==0 1 n*&lt;<em>self</em>&gt;(n-1)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">当然，上面的程序假定了If_Else是一个已经定义好的三元操作符（你可以想象C的&ldquo;?:&rdquo;操作符，后面跟的三个参数分别是判断条件、成功后求值的表达式、失败后求值的表达式。那么很显然，这个定义里面有一个地方没法解决，那就是&lt;<em>self</em>&gt;那个地方我们应该填入什么呢？很显然，熟悉C这类命令式语言的人都知道应该填入这个函数本身的名字，然而lambda算子系统里面的lambda表达式（或称函数）是没有名字的。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">怎么办？难道就没有办法实现递归了？或者说，丘齐做出的这个lambda算子系统里面根本没法实现递归从而在计算能力上面有重大的缺陷？显然不是。马上你就会看到Y combinator是如何把一个看上去非递归的lambda表达式像变魔术那样变成一个递归版本的。在成功之前我们再失败一次，注意下面的尝试：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">let F =&nbsp;<em>lambda</em>&nbsp;n. IF_Else n==0 1 n*F(n-1)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">看上去不错，是吗？可惜还是不行。因为let F只是起到一个<a style="color: #313428" href="javascript:if(confirm('http://en.wikipedia.org/wiki/Syntactic_sugar  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://en.wikipedia.org/wiki/Syntactic_sugar'" tppabs="http://en.wikipedia.org/wiki/Syntactic_sugar">语法糖</a>的作用，在它所代表的lambda表达式还没有完全定义出来之前你是不可以使用F这个名字的。更何况实际上丘齐当初的lambda算子系统里面也并没有这个语法元素，这只是刚才为了简化代码而引入的语法糖。当然，了解这个let语句还是有意义的，后面还会用到。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><strong>一次成功的尝试</strong></p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">在上面几次失败的尝试之后，我们是不是就一筹莫展了呢？别忘了软件工程里面的一条黄金定律：&ldquo;任何问题都可以通过增加一个间接层来解决&rdquo;。不妨把它沿用到我们面临的递归问题上：没错，我们的确没办法在一个lambda函数的定义里面直接（按名字）来调用其自身。但是，可不可以间接调用呢？</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">我们回顾一下刚才不成功的定义：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><em>lambda</em>&nbsp;n. If_Else n==0 1 n*&lt;<em>self</em>&gt;(n-1)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">现在&lt;self&gt;处不是缺少&ldquo;这个函数自身&rdquo;嘛，既然不能直接填入&ldquo;这个函数自身&rdquo;，我们可以增加一个参数，也就是说，把&lt;self&gt;参数化：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><em>lambda</em>&nbsp;<strong>self</strong>&nbsp;n. If_Else n==0 1 n*<strong>self</strong>(n-1)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">上面这个lambda算子总是合法定义了吧。现在，我们调用这个函数的时候，只要加传一个参数self，这个参数不是别人，正是这个函数自身。还是为了简单起见，我们用let语句来给上面这个函数起个别名：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">let P =&nbsp;<em>lambda</em>&nbsp;self n. If_Else n==0 1 n*self(n-1)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">我们这样调用，比如说我们要计算3的阶乘：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><strong>P</strong>(<strong>P</strong>, 3)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">也就是说，把P自己作为P的第一个参数（注意，调用的时候P已经定义完毕了，所以我们当然可以使用它的名字了）。这样一来，P里面的self处不就等于是P本身了吗？自身调用自身，递归！</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">可惜这只是个美好的设想，还差一点点。我们分析一下P(P, 3)这个调用。利用前面讲的Beta转换规则，这个函数调用展开其实就是（你可以完全把P当成一个宏来进行展开！）：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">IF_Else n==0 1 n*<strong>P</strong>(n-1)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">看出问题了吗？这里的<strong>P</strong>(n-1)虽然调用到了P，然而只给出了一个参数；而从P的定义来看，它是需要两个参数的（分别为<strong>self</strong>和n）！也就是说，为了让<strong>P</strong>(n-1)变成良好的调用，我们得加一个参数才行，所以我们得稍微修改一下P的定义：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">let P =&nbsp;<em>lambda</em>&nbsp;<strong>self</strong>&nbsp;n. If_Else n==0 1 n*<strong>self</strong>(<strong>self</strong>, n-1)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">请注意，我们在P的函数体内调用self的时候增加了一个参数。现在当我们调用P(P, 3)的时候，展开就变成了：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">IF_Else 3==0 1 3*<strong>P</strong>(<strong>P</strong>, 3-1)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">而<strong>P</strong>(<strong>P</strong>, 3-1)是对P合法的递归调用。这次我们真的成功了！</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><strong>不动点原理</strong></p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">然而，看看我们的P的定义，是不是很丑陋？&ldquo;n*<strong>self</strong>(<strong>self</strong>, n-1)&rdquo;？什么玩意？为什么要多出一个多余的self？<a style="color: #313428" href="javascript:if(confirm('http://en.wikipedia.org/wiki/Don\'t_repeat_yourself  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://en.wikipedia.org/wiki/Don\'t_repeat_yourself'" tppabs="http://en.wikipedia.org/wiki/Don't_repeat_yourself">DRY</a>！怎么办呢？我们想起我们一开始定义的那个失败的P，虽然行不通，但最初的努力往往是大脑最先想到的最直观的做法，我们来回顾一下：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">let P =&nbsp;<em>lambda</em>&nbsp;self n. If_Else n==0 1 n*<strong>self</strong>(n-1)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">这个P的函数体就非常清晰，没有冗余成分，虽然参数列表里面多出一个self，但我们其实根本不用管它，看函数体就行了，self这个名字已经可以说明一切了对不对？但很可惜这个函数不能用。我们再来回想一下为什么不能用呢？因为当你调用P(P, n)的时候，里面的self(n-1)会展开为P(n-1)而P是需要两个参数的。唉，要是这里的self是一个&ldquo;真正&rdquo;的，只需要一个参数的递归阶乘函数，那该多好啊。为什么不呢？干脆我们假设出一个&ldquo;真正&rdquo;的递归阶乘函数：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">power(n):</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">if(n==0) return 1;</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">return n*power(n-1);</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">但是，前面不是说过了，这个理想的版本无法在lambda算子系统中定义出来吗（由于lambda函数都是没名字的，无法自己内部调用自己）？不急，我们并不需要它被定义出来，我们只需要在头脑中&ldquo;假设&rdquo;它以&ldquo;某种&rdquo;方式被定义出来了，现在我们把这个真正完美的power传给P，这样：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">P(<strong>power</strong>, 3)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">注意它跟P(P, 3)的不同，P(P, 3)我们传递的是一个有缺陷的P为参数。而P(power, 3)我们则是传递的一个真正的递归函数power。我们试着展开P(power, 3):</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">IF_Else 3==0 1 3*<strong>power</strong>(3-1)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">发生了什么？？power(3-1)将会计算出2的阶乘（别忘了，power是我们设想的完美递归函数），所以这个式子将会忠实地计算出3的阶乘！</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">回想一下我们是怎么完成这项任务的：我们设想了一个以某种方式构造出来的完美的能够内部自己调用自己的递归阶乘函数power，我们发现把这个power传给P的话，P(power, n)的展开式就是真正的递归计算n阶乘的代码了。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">你可能要说：废话！都有了power了我们还要费那事把它传给P来个P(power, n)干嘛？直接power(n)不就得了？! 别急，之所以设想出这个power只是为了引入不动点的概念，而不动点的概念将会带领我们发现Y combinator。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">什么是不动点？一点都不神秘。让我们考虑刚才的power与P之间的关系。一个是真正可递归的函数，一个呢，则是以一个额外的self参数来试图实现递归的伪递归函数，我们已经看到了把power交给P为参数发生了什么，对吧？不，似乎还没有，我们只是看到了，&ldquo;把power加上一个n一起交给P为参数&rdquo;能够实现真正的递归。现在我们想考虑power跟P之间的关系，直接把power交给P如何？</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">P(power)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">这是什么？这叫函数的<a style="color: #313428" href="javascript:if(confirm('http://en.wikipedia.org/wiki/Partial_evaluation  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://en.wikipedia.org/wiki/Partial_evaluation'" tppabs="http://en.wikipedia.org/wiki/Partial_evaluation"><em>部分求值</em>(<em>partial evaluation</em>)</a>。换句话说，第一个参数是给出来了，但第二个参数还悬在那里，等待给出。那么，光给一个参数得到的是什么呢？是&ldquo;还剩一个参数待给的一个新的函数&rdquo;。其实也很简单，只要按照Beta转换规则做就是了，把P的函数体里面的self出现处皆替换为power就可以了。我们得到：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">IF_Else n==0 1 n*power(n-1)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">当然，这个式子里面还有一个变量没有绑定，那就是n，所以这个式子还不能求值，你需要给它一个n才能具体求值，对吧。这么说，这可不就是一个以n为参数的函数么？实际上就是的。在lambda算子系统里面，如果给一个lambda函数的参数不足，则得到的就是一个新的lambda函数，这个新的lambda函数所接受的参数也就是你尚未给出的那些参数。换句话来说，调用一个lambda函数可以分若干步来进行，每次只给出一部分参数，而只有等所有参数都给齐了，函数的求值结果才能出来，否则你得到的就是一个&ldquo;中间函数&rdquo;。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">那么，这跟不动点定理有什么关系？关系大了，刚才不是说了，P(power)返回的是一个新的&ldquo;中间函数&rdquo;嘛？这个&ldquo;中间函数&rdquo;的函数体我们刚才已经看到了，就是简单地展开P(power)而已，回顾一遍：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">IF_Else n==0 1 n*power(n-1)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">我们已经知道，这是个函数，参数n待定。因此我们不妨给它加上一个&ldquo;lambda n&rdquo;的帽子，这样好看一点：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><em>lambda</em>&nbsp;n. IF_Else n==0 1 n*power(n-1)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">这是什么呢？这可不就是power本身的定义？（当然，如果我们能够定义power的话）。不信我们看看power如果能够定义出来像什么样子：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">let power =&nbsp;<em>lambda</em>&nbsp;n. IF_Else n==0 1 n*power(n-1)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">一模一样！也就是说，P(power)展开后跟power是一样的。即：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><strong>P(power) = power</strong></p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">以上就是所谓的<em>不动点</em>。即对于函数P来说power是这样一个&ldquo;点&rdquo;：当把P用到power身上的时候，得到的结果仍然还是power，也就是说，power这个&ldquo;点&rdquo;在P的作用下是&ldquo;不动&rdquo;的。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">可惜的是，这一切居然都是建立在一个不存在的power的基础上的，又有什么用呢？可别过早提&ldquo;不存在&rdquo;这个词，你觉得一样东西不存在或许只是你没有找到使它存在的正确方法。我们已经看到power是跟P有着密切联系的。密切到什么程度呢？对于伪递归的P，存在一个power，满足P(power)=power。注意，这里所说的&ldquo;伪递归&rdquo;的P，是指这样的形式：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">let P =&nbsp;<em>lambda</em>&nbsp;self n. If_Else n==0 1 n*<strong>self</strong>(n-1) // 注意，不是self(self,n-1)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">一般化的描述就是，对任一伪递归F（回想一下伪递归的F如何得到&mdash;&mdash;是我们为了解决lambda函数不能引用自身的问题，于是给理想的f加一个self参数从而得到的），必存在一个理想f（F就是从这个理想f演变而来的），满足F(f) = f。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">那么，现在的问题就归结为如何针对F找到它的f了。根据F和f之间的密切联系（F就比f多出一个self参数而已），我们可以从F得出f吗？假设我们可以（又是假设），也就是说假设我们找到了一根魔棒，把它朝任意一个伪递归的F一挥，眼前一花，它就变成了真正的f了。这根魔棒如果存在的话，它具有什么性质？我们假设这个神奇的函数叫做Y，把Y用到任何伪递归的函数F上就能够得到真正的f，也就是说：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">Y(F) = f</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">结合上面的F(f) = f，我们得到：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">Y(F) = f = F(f) = F(Y(F))</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">也就是说，Y具有性质：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><strong>Y(F) = F(Y(F))</strong></p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">性质倒是找出来了，怎么构造出这个Y却又成了难题。一个办法就是使用抽象法，这是从工程学的思想的角度，也就是通过不断迭代、重构，最终找到问题的解。然而对于这里的Y combinator，接近问题解的过程却显得复杂而费力，甚至过程中的有些点上的思维跳跃有点如羚羊挂角无迹可寻。然而，在这整个Y combinator介绍完了之后我们将会介绍著名的哥德尔不完备性定理，然后我们就会发现，通过哥德尔不完备性定理证明中的一个核心构造式，只需一步自然的推导就能得出我们的Y combinator。而且，最美妙的是，还可以再往下归约，把一切都归约到康托尔当初提出的对角线方法，到那时我们就会发现原来同样如羚羊挂角般的哥德尔的证明其实是对角线方法的一个自然推论。数学竟是如此奇妙，我们由简单得无法再简单的lambda calculus系统的两条公理居然能够导出如此复杂如此令人目眩神迷的Y Combinator，而这些复杂性其实也只是荡漾在定理海洋中的涟漪，拨开复杂性的迷雾我们重又发现它们居然寓于极度的简洁之中。这就是数学之美。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">让我们先来看一看Y combinator的费力而复杂的工程学构造法，我会尽量让这个过程显得自然而流畅<sup>[7]</sup>：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">我们再次回顾一下那个伪递归的求阶乘函数：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">let P =&nbsp;<em>lambda</em>&nbsp;self n. If_Else n==0 1 n*<strong>self</strong>(n-1)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">我们的目标是找出P的不动点power，根据不动点的性质，只要把power传给P，即P(power)，便能够得到真正的递归函数了。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">现在，关键的地方到了，由于：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">power = P(power) // 不动点原理</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">这就意味着，power作为一个函数（lambda calculus里面一切都是函数），它是自己调用了自己的。那么，我们如何实现这样一个能够自己调用自己的power呢？回顾我们当初成功的一次尝试，要实现递归，我们是通过增加一个间接层来进行的：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">let power_gen =&nbsp;<em>lambda</em>&nbsp;self. P(<strong>self</strong>(<strong>self</strong>))</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">还记得<strong>self</strong>(<strong>self</strong>)这个形式吗？我们在成功实现出求阶乘递归函数的时候不就是这么做的？那么对于现在这个power_gen，怎么递归调用？</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">power_gen(power_gen)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">不明白的话可以回顾一下前面我们调用P(P, n)的地方。这里power_gen(power_gen)展开后得到的是什么呢？我们根据刚才power_gen的定义展开看一看，原来是：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><strong>P</strong>(power_gen(power_gen))</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">看到了吗？也就是说：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">power_gen(power_gen) =&gt;&nbsp;<strong>P</strong>(power_gen(power_gen))</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"></p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">现在，我们把power_gen(power_gen)当成整体看，不妨令为power，就看得更清楚了：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">power =&gt;&nbsp;<strong>P</strong>(power)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">这不正是我们要的答案么？</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">OK，我们<em>总结一下</em>：对于给定的P，只要构造出一个相应的power_gen如下：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">let power_gen =&nbsp;<em>lambda</em>&nbsp;self. P(<strong>self</strong>(<strong>self</strong>))</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">我们就会发现，power_gen(power_gen)这个调用展开后正是P(power_gen(power_gen))。也就是说，我们的power_gen(power_gen)就是我们苦苦寻找的不动点了！</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><strong>铸造</strong><strong>Y Combinator</strong></p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">现在我们终于可以铸造我们的Y Combinator了，Y Combinator只要生成一个形如power_gen的lambda函数然后把它应用到自身，就大功告成：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">let&nbsp;<strong>Y</strong>&nbsp;=&nbsp;<em>lambda</em>&nbsp;F.</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">let&nbsp;<strong><em>f_gen</em></strong>&nbsp;=&nbsp;<em>lambda</em>&nbsp;self. F(<strong>self</strong>(<strong>self</strong>))</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">return&nbsp;<strong>f_gen</strong>(<strong>f_gen</strong>)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">稍微解释一下，Y是一个lambda函数，它接受一个伪递归F，在内部生成一个f_gen（还记得我们刚才看到的power_gen吧），然后把f_gen应用到它自身（记得power_gen(power_gen)吧），得到的这个f_gen(f_gen)也就是F的不动点了（因为f_gen(f_gen) = F(f_gen(f_gen))），而根据不动点的性质，F的不动点也就是那个对应于F的真正的递归函数！</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">如果你还觉得不相信，我们稍微展开一下看看，还是拿阶乘函数说事，首先我们定义阶乘函数的伪递归版本：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">let Pwr =&nbsp;<em>lambda</em>&nbsp;self n. If_Else n==0 1 n*self(n-1)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">让我们把这个Pwr交给<strong>Y</strong>，看会发生什么（根据刚才Y的定义展开吧）：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">Y(Pwr) =&gt;</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">let f_gen =&nbsp;<em>lambda</em>&nbsp;self.&nbsp;<strong>Pwr</strong>(self(self))</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">return f_gen(f_gen)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">Y(Pwr)的求值结果就是里面返回的那个f_gen(f_gen)，我们再根据f_gen的定义展开f_gen(f_gen)，得到：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">Pwr(f_gen(f_gen))</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">也就是说：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">Y(Pwr) =&gt; f_gen(f_gen) =&gt; Pwr(f_gen(f_gen))</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">我们来看看得到的这个Pwr(f_gen(f_gen))到底是不是真有递归的魔力。我们展开它（注意，因为Pwr需要两个参数，而我们这里只给出了一个，所以Pwr(f_gen(f_gen))得到的是一个单参（即n）的函数）：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">Pwr(<strong>f_gen</strong>(<strong>f_gen</strong>)) =&gt; If_Else n==0 1 n*<strong>f_gen</strong>(<strong>f_gen</strong>) (n-1)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">而里面的那个<strong>f_gen</strong>(<strong>f_gen</strong>)，根据f_gen的定义，又会展开为Pwr(f_gen(f_gen))，所以：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><strong>Pwr(f_gen(f_gen))</strong>&nbsp;=&gt; If_Else n==0 1 n*&nbsp;<strong>Pwr(f_gen(f_gen))</strong>&nbsp;(n-1)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">看到加粗的部分了吗？因为<strong>Pwr(f_gen(f_gen))</strong>是一个接受n为参数的函数，所以不妨把它令成f（f的参数是n），这样上面的式子就是：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><strong>f</strong>&nbsp;=&gt; If_Else n==0 1 n*<strong>f</strong>(n-1)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">完美的阶乘函数！</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><strong>哥德尔的不完备性定理</strong></p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><em>了解哥德尔不完备性定理的可以跳到下一节，</em><em>&ldquo;</em><em>大道至简</em><em>&mdash;&mdash;</em><em>康托尔的天才</em><em>&rdquo;</em></p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">然而，漫长的Y Combinator征途仍然并非本文的最终目的，对于Y combinator的构造和解释，只是给不了解lambda calculus或Y combinator的读者看的。关键是马上你会看到Y combinator可以由哥德尔不完备性定理证明的一个核心构造式一眼瞧出来！</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">让我们的思绪回到1931年，那个数学界风起云涌的年代，一个名不经传的20出头的学生，在他的博士论文中证明了一个惊天动地的结论。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">在那个年代，希尔伯特的数学天才就像太阳的光芒一般夺目，在关于数学严格化的大纷争中希尔伯特带领的形式主义派系技压群雄，得到许多当时有名望的数学家的支持。希尔伯特希望借助于形式化的手段，抽掉数学证明中的意义，把数学证明抽象成一堆无意义的符号转换，就连我们人类赖以自豪的逻辑推导，也不过只是一堆堆符号转换而已（想起lambda calculus系统了吧：）)。这样一来，一个我们日常所谓的，带有直观意义和解释的数学系统就变成了一个纯粹由无意义符号表达的、公理加上推导规则所构成的形式系统，而数学证明呢，只不过是在这个系统内玩的一个文字游戏。令人惊讶的是，这样一种做法，真的是可行的！数学的意义，似乎竟然真的可以被抽掉！另一方面，一个形式系统具有非常好的性质，平时人们证明一个定理所动用的推导，变成了纯粹机械的符号变换。希尔伯特希望能够证明，在任一个无矛盾的形式系统中所能表达的所有陈述都要么能够证明要么能够证伪。这看起来是个非常直观的结论，因为一个结论要么是真要么是假，而它在它所处的领域/系统中当然应该能够证明或证伪了（只要我们能够揭示出该系统中足够多的真理）。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">然而，哥德尔的证明无情的击碎了这一企图，哥德尔的证明揭示出，任何足够强到蕴含了皮亚诺算术系统（PA）的一致（即无矛盾）的系统都是不完备的，所谓不完备也就是说在系统内存在一个为真但无法在系统内推导出的命题。这在当时的数学界揭起了轩然大波，其证明不仅具有数学意义，而且蕴含了深刻的哲学意义。从那时起这一不完备性定理就被引申到自然科学乃至人文科学的各个角落&hellip;至今还没有任何一个数学定理居然能够产生这么广泛而深远的影响。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">哥德尔的证明非常的长，达到了200多页纸，但其中很大的成分是用在了一些辅助性的工作上面，比如占据超过1/3纸张的是关于一个形式系统如何映射到自然数，也就是说，如何把一个形式系统中的所有公式都表示为自然数，并可以从一自然数反过来得出相应的公式。这其实就是编码，在我们现在看来是很显然的，因为一个程序就可以被编码成二进制数，反过来也可以解码。但是在当时这是一个全新的思想，也是最关键的辅助性工作之一，另一方面，这正是&ldquo;程序即数据&rdquo;的最初想法。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">现在我们知道，要证明哥德尔的不完备性定理，只需在假定的形式系统T内表达出一个为真但无法在T内推导出（证明）的命题。于是哥德尔构造了这样一个命题，用自然语言表达就是：命题P说的是&ldquo;<em>P</em><em>不可在系统</em><em>T</em><em>内证明</em>&rdquo;（这里的系统T当然就是我们的命题P所处的形式系统了），也就是说&ldquo;<em>我不可以被证明</em>&rdquo;，跟著名的说谎者悖论非常相似，只是把&ldquo;说谎&rdquo;改成了&ldquo;不可以被证明&rdquo;。我们注意到，一旦这个命题能够在T内表达出来，我们就可以得出&ldquo;P为真但无法在T内推导出来&rdquo;的结论，从而证明T的不完备性。为什么呢？我们假设T可以证明出P，而因为P说的就是P不可在系统T内证明，于是我们又得到T无法证明出P，矛盾产生，说明我们的假设&ldquo;T可以证明P&rdquo;是错误的，根据排中律，我们得到T不可以证明P，而由于P说的正是&ldquo;T不可证明P&rdquo;，所以P就成了一个正确的命题，同时无法由T内证明！</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">如果你足够敏锐，你会发现上面这番推理本身不就是证明吗？其证明的结果不就是P是正确的？然而实际上这番证明是位于T系统之外的，它用到了一个关于T系统的假设&ldquo;T是一致（无矛盾）的&rdquo;，这个假设并非T系统里面的内容，所以我们刚才其实是在T系统<em>之外</em>推导出了P是正确的，这跟P不能在T<em>之</em><em>内</em>推导出来并不矛盾。所以别担心，一切都正常。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">那么，剩下来最关键的问题就是如何用形式语言在T内表达出这个P，上面的理论虽然漂亮，但若是P根本没法在T内表达出来，我们又如何能证明&ldquo;T内存在这个为真但无法被证明的P&rdquo;呢？那一切还不是白搭？</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">于是，就有了哥德尔证明里面最核心的构造，哥德尔构造了这样一个公式：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><strong>N(n) is unprovable in T</strong></p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">这个公式由两部分构成，n是这个公式的自由变量，它是一个自然数，一旦给定，那么这个公式就变成一个明确的命题。而N则是从n解码出的货真价实的（即我们常见的符号形式的）公式（记得哥德尔的证明第一部分就是把公式编码吗？）。&rdquo;is unprovable in T&rdquo;则是一个谓词，这里我们没有用形式语言而是用自然语言表达出来的，但哥德尔证明了它是可以用形式语言表达出来的，大致思路就是：一个形式系统中的符号数目是有限的，它们构成这个形式系统的符号表。于是，我们可以依次枚举出所有长度为1的串，长度为2的串，长度为3的串&hellip; 此外根据形式系统给出的语法规则，我们可以检查每个串是否是良构的公式（well formed formula，简称wff，其实也就是说，是否符合语法规则，前面我们在介绍lambda calculus的时候看到了，一个形式系统是需要语法规则的，比如逻辑语言形式化之后我们就会看到P-&gt;Q是一个wff，而-&gt;PQ则不是），因而我们就可以枚举出所有的wff来。最关键的是，我们观察到形式系统中的证明也不过就是由一个个的wff构成的序列（想想推导的过程，不就是一个公式接一个公式嘛）。而wff构成的序列本身同样也是由符号表内的符号构成的串。所以我们只需枚举所有的串，对每一个串检查它是否是一个由wff构成的序列（证明），如果是，则记录下这个wff序列（证明）的最后一个wff，也就是它的结论。这样我们便枚举出了所有的可由T推导出的定理。然后为了表达出&rdquo;X is unprovable in T&rdquo;，本质上我们只需说&ldquo;不存在这样一个自然数S，它所解码出来的wff序列以X为终结&rdquo;！这也就是说，我们表达出了&ldquo;is unprovable in T&rdquo;这个谓词。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">我们用UnPr(X)来表达&ldquo;X is unprovable in T&rdquo;，于是哥德尔的公式变成了：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">UnPr( N(n) )</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">现在，到了最关键的部分，首先我们把这个公式简记为G(n)&mdash;&mdash;别忘了G内有一个自由变量n，所以G现在还不是一个命题，而只是一个公式，所以谈不上真假：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">G(n): UnPr( N(n) )</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">又由于G也是个wff，所以它也有自己的编码g，当然g是一个自然数，现在我们把g作为G的参数，也就是说，把G里面的自由变量n替换为g，我们于是得到一个真正的命题：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">G(g): UnPr( G(g) )</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">用自然语言来说，这个命题G(g)说的就是&ldquo;<em>我是不可在</em><em>T</em><em>内证明的</em>&rdquo;。看，我们在形式系统T内表达出了&ldquo;我是不可在T内证明的&rdquo;这个命题。而我们一开始已经讲过了如何用这个命题来推断出G(g)为真但无法在T内证明，于是这就证明了哥德尔的不完备性定理<sup>[8]</sup>。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">哥德尔的不完备性定理被称为20世纪数学最重大的发现（不知道有没有&ldquo;之一&rdquo;:) ）现在我们知道为真但无法在系统内证明的命题不仅仅是这个诡异的&ldquo;哥德尔命题&rdquo;，还有很多真正有意义的明确命题，其中最著名的就是<a style="color: #313428" href="javascript:if(confirm('http://en.wikipedia.org/wiki/Continuum_hypothesis  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://en.wikipedia.org/wiki/Continuum_hypothesis'" tppabs="http://en.wikipedia.org/wiki/Continuum_hypothesis">连续统假设</a>，此外哥德巴赫猜想也有可能是个没法在数论系统中证明的真命题。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><strong>从哥德尔公式到</strong><strong>Y Combinator</strong></p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">哥德尔的不完备性定理证明了数学是一个未完结的学科，永远有需要我们以人的头脑从系统之外去用我们独有的直觉发现的东西。罗杰&middot;彭罗斯在<a style="color: #313428" href="javascript:if(confirm('http://www.amazon.com/Emperors-New-Mind-Roger-Penrose/dp/0140145346  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.amazon.com/Emperors-New-Mind-Roger-Penrose/dp/0140145346'" tppabs="http://www.amazon.com/Emperors-New-Mind-Roger-Penrose/dp/0140145346">《The Emperor&rsquo;s New Mind》</a>中用它来证明人工智能的不可实现。当然，这个结论是很受质疑的。但哥德尔的不完备性定理的确还有很多很多的有趣推论，数学的和哲学上的。哥德尔的不完备性定理最深刻的地方就是它揭示了自指（或称自引用，递归调用自身等等）结构的普遍存在性，我们再来看一看哥德尔命题的绝妙构造：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">G(n): UnPr( N(n) )</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">我们注意到，这里的UnPr其实是一个形式化的谓词，它不一定要说&ldquo;X在T内可证明&rdquo;，我们可以把它泛化为一个一般化的谓词，P：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><strong>G(n): P( N(n) )</strong></p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">也就是说，对于任意一个单参的谓词P，都存在上面这个哥德尔公式。然后我们算出这个哥德尔公式的自然数编码g，然后把它扔给G，就得到：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">G(g): P( G(g) )</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">是不是很熟悉这个结构？我们的Y Combinator的构造不就是这样一个形式？我们把G和P都看成一元函数，G(g)可不正是P这个函数的不动点么！于是，<strong>我们从哥德尔的证明里面直接看到了</strong><strong>Y Combinator</strong>！</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">至于如何从哥德尔的证明联系到停机问题，就留给你去解决吧:) 因为更重要的还在后面，我们看到，哥德尔的证明虽然巧妙至极，然而其背后的思维过程仍然飘逸而不可捉摸，至少我当时看到G(n)的时候，&ldquo;乃大惊&rdquo;&ldquo;不知所从出&rdquo;，他怎么想到的？难道是某一个瞬间&ldquo;灵光一现&rdquo;？一般我是不信这一说的，已经有越来越多的科学研究表明一瞬间的&ldquo;灵感&rdquo;往往是潜意识乃至表层意识长期思考的结果。哥德尔天才的证明也不例外，我们马上就会看到，在这个神秘的构造背后，其实隐藏着某种更深的东西，这就是康托尔在19世纪80年代研究无穷集合和超限数时引入的对角线方法。这个方法仿佛有种神奇的力量，能够揭示出某种自指的结构来，而同时，这又是一个极度简单的手法，通过它我们能够得到数学里面一些非常奇妙的性质。无论是哥德尔的不完备性定理还是再后来丘齐建立的lambda calculus，抑或我们非常熟悉的图灵机理论里的停机问题，其实都只是这个手法简单推演的结果！</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><strong>大道至简</strong><strong>&mdash;&mdash;</strong><strong>康托尔的天才</strong></p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">&ldquo;大道至简&rdquo;这个名词或许更多出现在文学和哲学里面，一般用在一些模模糊糊玄玄乎乎的哲学观点上。然而，用在这里，数学上，这个名词才终于适得其所。大道至简，看上去最复杂的理论其实建立在一个最简单最纯粹的道理之上。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">康托尔在无穷集合和超限数方面的工作主要集中在两篇突破性的论文上，这也是我所见过的最纯粹最美妙的数学论文，现代的数学理论充斥了太多复杂的符号和概念，很多时候让人看不到最本质的东西，当然，不否认这些东西很多也是有用的，然而，要领悟真正的数学美，像集合论和数论这种纯粹的东西，真的非常适合。不过这里就不过多谈论数学的细节了，只说康托尔引入对角线方法的动机和什么是对角线方法。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><strong>神奇的一一对应</strong></p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">康托尔在研究无穷集合的时候，富有洞察性地看到了对于无穷集合的大小问题，我们不能再使用直观的&ldquo;所含元素的个数&rdquo;来描述，于是他创造性地将一一对应引入进来，两个无穷集合&ldquo;大小&rdquo;一样当且仅当它们的元素之间能够构成一一对应。这是一个非常直观的概念，一一对应嘛，当然个数相等了，是不是呢？然而这同时就是它不直观的地方了。对于无穷集合，我们日常的所谓&ldquo;个数&rdquo;的概念不管用了，因为无穷集合里面的元素个数本就是无穷多个。不信我们来看一个小小的例子。我们说自然数集合能够跟偶数集合构成一一对应，从而<em>自然数集合跟偶数集合里面元素</em><em>&ldquo;</em><em>个数</em><em>&rdquo;</em><em>是一样多的</em>。怎么可能？偶数集合是自然数集合的真子集，所有偶数都是自然数，但自然数里面还包含奇数呢，说起来应该是二倍的关系不是？不是！我们只要这样来构造一一对应：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">1 2 3 4 &hellip;</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">2 4 6 8 &hellip;</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">用函数来描述就是 f(n) = 2n。检验一下是不是一一对应的？不可思议对吗？还有更不可思议的，<em>自然数集是跟有理数集一一对应的</em>！对应函数的构造就留给你解决吧，提示，按如下方式来挨个数所有的有理数：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">1/1 1/2 2/1 1/3 2/2 3/1 1/4 2/3 3/2 4/1 &hellip;</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">用这种一一对应的手法还可以得到很多惊人的结论，如<em>一条直线上所有的点跟一个平面上所有的点构成一一对应</em>（也就是说<em>复数集合跟实数集合构成一一对应</em>）。以致于连康托尔自己都不敢相信自己的眼睛了，这也就是为什么他在给戴得金的信中会说&ldquo;我看到了它，却不敢相信它&rdquo;的原因。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">然而，除了一一对应之外，还有没有不能构成一一对应的两个无穷集合呢？有。<em>实数集合就比自然数集合要</em><em>&ldquo;</em><em>大</em><em>&rdquo;</em>，它们之间实际上无法构成一一对应。这就是康托尔的对角线方法要解决的问题。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><strong>实数集和自然数集无法构成一一对应？！</strong></p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">我们只需将实数的小数位展开，并且我们假设实数集能够与自然数集一一对应，也就是说假设实数集<a style="color: #313428" href="javascript:if(confirm('http://en.wikipedia.org/wiki/Countable  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://en.wikipedia.org/wiki/Countable'" tppabs="http://en.wikipedia.org/wiki/Countable">可列</a>，所以我们把它们与自然数一一对应列出，如下：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">1 a<sub>10</sub>.a<sub>11</sub>a<sub>12</sub>a<sub>13</sub>&hellip;</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">2 a<sub>20</sub>.a<sub>21</sub>a<sub>22</sub>a<sub>23</sub>&hellip;</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">3 a<sub>30</sub>.a<sub>31</sub>a<sub>32</sub>a<sub>33</sub>&hellip;</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">4 &hellip;</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">5 &hellip;</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">（注：aij里面的ij是下标）</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">现在，我们构造一个新的实数，它的第i位小数不等于aii。也就是说，它跟上面列出的每一个实数都至少有一个对应的小数位不等，也就是说它不等于我们上面列出的所有实数，这跟我们上面假设已经列出了所有实数的说法相矛盾。所以实数集只能是不可列的，即不可与自然数集一一对应！这是对角线方法的最简单应用。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><strong>对角线方法</strong><strong>&mdash;&mdash;</strong><strong>停机问题的深刻含义</strong></p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">对角线方法有很多非常奇妙的结论。其中之一就是文章一开始提到的停机问题。我想绝大多数人刚接触停机问题的时候都有一个问题，图灵怎么能够想到这么诡异的证明，怎么能构造出那个诡异的&ldquo;说停机又不停机，说不停机又停机&rdquo;的悖论机器。马上我们就会看到，这其实只是对角线方法的一个直接结论。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">还是从反证开始，我们假设存在这样一个图灵机，他能够判断任何程序在任何输入上是否停机。由于所有图灵机构成的集合是一个可列集（也就是说，我们可以逐一列出所有的图灵机，严格证明见我以前的一篇文章《<a style="color: #313428" href="javascript:if(confirm('http://blog.csdn.net/pongba/archive/2006/03/11/621723.aspx  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://blog.csdn.net/pongba/archive/2006/03/11/621723.aspx'" tppabs="http://blog.csdn.net/pongba/archive/2006/03/11/621723.aspx">图灵机杂思</a>》），所以我们可以很自然地列出下表，它表示每个图灵机分别在每一个可能的输入（1,2,3,&hellip;）下的输出，N表示无法停机，其余数值则表示停机后的输出：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp; 2&nbsp; 3&nbsp; 4 &hellip;</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">M1&nbsp; N&nbsp; 1&nbsp; N&nbsp; N &hellip;</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">M2&nbsp; 2&nbsp; 0&nbsp; N&nbsp; 0 &hellip;</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">M3&nbsp; 0&nbsp; 1&nbsp; 2&nbsp; 0 &hellip;</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">M4&nbsp; N&nbsp; 0&nbsp; 5&nbsp; N &hellip;</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">&hellip;</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">M1，M2，M3 &hellip; 是逐一列出的图灵机，并且，注意，由于程序即数据，每个图灵机都有唯一编码，所以我们规定在枚举图灵机的时候Mi其实就代表编码为i的图灵机，当然这里很多图灵机将会是根本没用的玩意，但这不要紧。此外，最上面的一行1 2 3 4 &hellip; 是输入数据，如，矩阵的第一行代表M1分别在1，2，3，&hellip;上面的输出，不停机的话就是N。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">我们刚才假设存在这样一个图灵机H，它能够判断任何程序在任何输入上能否停机，换句话说，H(i,j)（i是Mi的编码）能够给出&ldquo;Mi(j)&rdquo;是N（不停）呢还是给出一个具体的结果（停）。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">我们现在来运用康托尔的对角线方法，我们构造一个新的图灵机P，P在1上的输出行为跟M1(1)&ldquo;不一样&rdquo;，在2上的输出行为跟M2(2)&ldquo;不一样&rdquo;，&hellip;总之P在输入i上的输出跟Mi(i)不一样。只需利用一下我们万能的H，这个图灵机P就不难构造出来，如下：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">P(i):</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">if(&nbsp;<strong>H</strong>(i, i) == 1 ) then // Mi(i) halts</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">&nbsp; return 1 + Mi(i)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">else // if H(i, i) == 0 (Mi(i) doesn&rsquo;t halt)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">&nbsp; return 0</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">也就是说，如果Mi(i)停机，那么P(i)的输出就是Mi(i)+1，如果Mi(i)不停机的话，P(i)就停机且输出0。这就保证了P(i)的输出行为跟Mi(i)反正不一样。现在，我们注意到P本身是一个图灵机，而我们上面已经列出了所有的图灵机，所以必然存在一个k，使得Mk = P。而两个图灵机相等当且仅当它们对于所有的输入都相等，也就是说对于任取的n，有Mk(n) = P(n)，现在令n=k，得到Mk(k)=P(k)，根据上面给出的P的定义，这实际上就是：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">Mk(k) = P(k) =</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">&nbsp; 1+Mk(k) if Mk(k) halts</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">&nbsp; 0 if Mk(k) doesn&rsquo;t halt</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">看到这个式子里蕴含的矛盾了吗？如果Mk(k)停机，那么Mk(k)=1+Mk(k)；如果Mk(k)不停机，则Mk(k)=0（给出结果0即意味着Mk(k)停机）；不管哪种情况都是矛盾。于是我们得出，不存在那样的H。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">这个对角线方法实际上说明了，无论多聪明的H，总存在一个图灵机的停机行为是它无法判断的。这跟哥德尔定理&ldquo;无论多&lsquo;完备&rsquo;的形式化公理系统，都存在一个&lsquo;哥德尔命题&rsquo;是无法在系统内推导出来的&rdquo;从本质上其实是一模一样的。只不过我们一般把图灵的停机问题称为&ldquo;可判定问题&rdquo;，而把数学的称为&ldquo;可证明问题&rdquo;。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">等等！如果我们把那个无法判定是否停机的图灵机作为算法的特例纳入到我们的H当中呢？我们把得到的新的判定算法记为H<sub>1</sub>。然而，可惜的是，在H<sub>1</sub>下，我们又可以相应地以同样的手法从H<sub>1</sub>构造出一个无法被它（H<sub>1</sub>）判定的图灵机来。你再加，我再构造，无论你加多少个特例进去，我都可以由同样的方式构造出来一个你无法够到的图灵机，以彼之矛，攻彼之盾。其实这也是哥德尔定理最深刻的结论之一，哥德尔定理其实就说明了无论你给出多少个公理，即无论你建立多么完备的公理体系，这个系统里面都有由你的那些公理出发所推导不到的地方，这些黑暗的角落，就是人类直觉之光才能照射到的地方！</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">本节我们从对角线方法证明了图灵的停机问题，我们看到，对角线方法能够揭示出某种自指结构，从而构造出一个&ldquo;悖论图灵机&rdquo;。实际上，对角线方法是一种有深远影响的方法，哥德尔的证明其实也是这个方法的一则应用。证明与上面的停机问题证明如出一辙，只不过把Mi换成了一个形式系统内的公式fi，具体的证明就留给聪明的你吧:)我们现在来简单的看一下这个奇妙方法的几个不那么明显的推论。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><strong>罗素悖论</strong></p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">学过逻辑的人大约肯定是知道著名的罗素悖论的，罗素悖论用数学的形式来描述就是：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">R = &#123;X:X不属于X&#125;;</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">这个悖论最初是从康托尔的无穷集合论里面引申出来的。当初康托尔在思考无穷集合的时候发现可以称&ldquo;一切集合的集合&rdquo;，这样一个集合由于它本身也是一个集合，所以它就属于它自身。也就是说，我们现在可以称世界上存在一类属于自己的集合，除此之外当然就是不属于自己的集合了。而我们把所有不属于自己的集合收集起来做成一个集合R，这就是上面这个著名的罗素悖论了。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">我们来看R是否属于R，如果R属于R，根据R的定义，R就不应该属于R。而如果R不属于R，则再次根据R的定义，R就应该属于R。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">这个悖论促使了集合论的公理化。后来策梅罗公理化的集合论里面就不允许X属于X（不过可惜的是，尽管如此还是没法证明这样的集合论不可能产生出新的悖论。而且永远没法证明&mdash;&mdash;这就是哥德尔第二不完备性定理的结论&mdash;&mdash;一个包含了PA的形式化公理系统永远无法在内部证明其自身的一致（无矛盾）性。从而希尔伯特想从元数学推出所有数学系统的一致性的企图也就失败了，因为元数学的一致性又得由元元数学来证明，后者的一致性又得由元元元数学来证明&hellip;）。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">这里我们只关心罗素是如何想出这个绝妙的悖论的。还是对角线方法！我们罗列出所有的集合，S1,S2,S3 &hellip;</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; S1&nbsp; S2&nbsp; S3 &hellip;</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">S1&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp;&nbsp; 1 &hellip;</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">S2&nbsp; 1&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp;&nbsp; 0 &hellip;</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">S3&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp; 0 &hellip;</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">&hellip; &hellip;</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">右侧纵向列出所有集合，顶行横向列出所有集合。0/1矩阵的(i,j)处的元素表示Si是否包含Sj，记为Si(j)。现在我们只需构造一个新的0/1序列L，它的第i位与矩阵的(i,i)处的值恰恰相反：L(i) = 1-Si(i)。我们看到，这个新的序列其实对应了一个集合，不妨也记为L，L(i)表示L是否包含Si。根据L的定义，如果矩阵的(i,i)处值为0（也就是说，如果Si不包含Si），那么L这个集合就包含Si,否则就不包含。我们注意到这个新的集合L肯定等于某个Sk（因为我们已经列出了所有的集合），L = Sk。既然L与Sk是同一集合，那么它们肯定包含同样的元素，从而对于任意n，有L(n) = Sk(n)。于是通过令n=k，得到L(k) = Sk(k)，而根据L的定义，L(k) = 1- Sk(k)。这就有Sk(k) = 1-Sk(k)，矛盾。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">通过抽象简化以上过程，我们看到，我们构造的L其实是&ldquo;包含了所有不包含它自身的集合的集合&rdquo;，用数学的描述正是罗素悖论！</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">敏锐的你可能会注意到所有集合的数目是不可数的从而根本不能S1,S2&hellip;的一一列举出来。没错，但通过假设它们可以列举出来，我们发现了一个与可列性无关的悖论。所以这里的对角线方法其实可以说是一种启发式方法。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">同样的手法也可以用到证明P(A)（A的所有子集构成的集合，也叫幂集）无法跟A构成一一对应上面。证明就留给聪明的你了:)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><strong>希尔伯特第十问题结出的硕果</strong></p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">希尔伯特是在1900年巴黎数学家大会上提出著名的希尔伯特第十问题的，简言之就是<em>是否存在一个算法，能够计算任意</em><em><a style="color: #313428" href="javascript:if(confirm('http://en.wikipedia.org/wiki/Diophantine_equation  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://en.wikipedia.org/wiki/Diophantine_equation'" tppabs="http://en.wikipedia.org/wiki/Diophantine_equation">丢番图方程</a></em><em>是否有整根</em>。要解决这个问题，就得先严格定义&ldquo;算法&rdquo;这一概念。为此图灵和丘齐分别提出了图灵机和lambda calculus这两个概念，它们从不同的角度抽象出了&ldquo;有效（机械）计算&rdquo;的概念，著名的<a style="color: #313428" href="javascript:if(confirm('http://en.wikipedia.org/wiki/Church-Turing_thesis  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://en.wikipedia.org/wiki/Church-Turing_thesis'" tppabs="http://en.wikipedia.org/wiki/Church-Turing_thesis">图灵&mdash;&mdash;丘齐命题</a>就是说<em>所有可以有效计算出来的问题都可以由图灵机计算出来</em>。实际上我们已经看到，丘齐的lambda calculus其实就是数学推理系统的一个形式化。而图灵机则是把这个数学概念物理化了。而也正因为图灵机的概念隐含了实际的物理实现，所以冯&middot;诺依曼才据此提出了奠定现代计算机体系结构的<a style="color: #313428" href="javascript:if(confirm('http://en.wikipedia.org/wiki/Von_Neumann_architecture  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://en.wikipedia.org/wiki/Von_Neumann_architecture'" tppabs="http://en.wikipedia.org/wiki/Von_Neumann_architecture">冯&middot;诺依曼体系结构</a>，其遵循的，正是图灵机的概念。而&ldquo;程序即数据&rdquo;的理念，这个发端于数学家哥德尔的不完备性定理的证明之中的理念，则早就在黑暗中预示了可编程机器的必然问世。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><strong>对角线方法</strong><strong>&mdash;&mdash;</strong><strong>回顾</strong></p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">我们看到了对角线方法是如何简洁而深刻地揭示出自指或递归结构的。我们看到了著名的不完备性定理、停机问题、Y Combinator、罗素悖论等等等等如何通过这一简洁优美的方法推导出来。这一诞生于康托尔的天才的手法如同一条金色的丝线，把位于不同年代的伟大发现串联了起来，并且将一直延续下去&hellip;</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">P.S</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">1. lambda calculus里面的&ldquo;停机问题&rdquo;</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">实际上lambda calculus里面也是有&ldquo;停机问题&rdquo;的等价版本的。其描述就是：不存在一个算法能够判定任意两个lambda函数是否等价。所谓等价当然是对于所有的n,有f(n)=g(n)了。这个问题的证明更加能够体现对角线方法的运用。仍然留给你吧。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">2.&nbsp;<a style="color: #313428" href="javascript:if(confirm('http://blog.csdn.net/g9yuayon  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://blog.csdn.net/g9yuayon'" tppabs="http://blog.csdn.net/g9yuayon">负喧琐话</a>(<a style="color: #313428" href="javascript:if(confirm('http://blog.csdn.net/g9yuayon  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://blog.csdn.net/g9yuayon'" tppabs="http://blog.csdn.net/g9yuayon">http://blog.csdn.net/g9yuayon</a>)是个非常不错的blog:)。g9的文字轻松幽默，而且有很多名人八卦可以养眼，真的灰常&hellip;灰常&hellip;不错哦。此外g9老兄还是个理论功底非常扎实的牛。所以，anyway，看了他的blog就知道啦！最初这篇文章的动机也正是看了上面的一篇<a style="color: #313428" href="javascript:if(confirm('http://blog.csdn.net/g9yuayon/archive/2006/09/24/1271319.aspx  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://blog.csdn.net/g9yuayon/archive/2006/09/24/1271319.aspx'" tppabs="http://blog.csdn.net/g9yuayon/archive/2006/09/24/1271319.aspx">关于Y Combinator的铸造过程的介绍</a>，于是想揭示一些更深的东西，于是便有了本文。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">3. 文章起名《康托尔、哥德尔、图灵&mdash;&mdash;永恒的金色对角线》其实是为了纪念看过的一本好书GEB，即《Godel、Escher、Bach-An Eternal Golden Braid》中文译名《哥德尔、埃舍尔、巴赫&mdash;&mdash;集异璧之大成》&mdash;&mdash;商务印书馆出版。对于一本定价50元居然能够在douban上卖到100元的二手旧书，我想无需多说。另，幸福的是，电子版可以找到:)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">4. 其实很久前想写的是一篇《从哥德尔到图灵》，但那篇写到1/3不到就搁下了，一是由于事务，二是总觉得少点什么。呵呵，如今把康托尔扯进来，也算是完成当时扔掉的那一篇吧。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">5. 这恐怕算是写得最曲折的一篇文章了。不仅自己被这些问题搞得有点晕头转向（还好总算走出来），更因为要把这些东西自然而然的串起来，也颇费周章。很多时候是利用吃饭睡觉前或走路的时间思考本质的问题以及如何表达等等，然后到纸上一气呵成。不过同时也锻炼了不拿纸笔思考数学的能力，呵呵。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">6. 关于图灵的停机问题、Y Combinator、哥德尔的不完备性定理以及其它种种与康托尔的对角线之间的本质联系，几乎查不到完整系统的深入介绍，一些书甚至如《The Emperor&rsquo;s New Mind》也只是介绍了与图灵停机问题之间的联系（已经非常的难得了），google和baidu的结果也是基本没有头绪。很多地方都是一带而过让人干着急。所以看到很多地方介绍这些定理和构造的时候都是弄得人晕头转向的，绝大部分人在面对如Y Combinator、不完备性定理、停机问题的时候都把注意力放在力图理解它是怎么运作的上面了，却使人看不到其本质上从何而来，于是人们便对这些东东大为惊叹。这使我感到很不痛快，如隔靴搔痒般。这也是写这篇文章的主要动机之一。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><strong>Reference</strong></p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">[1] 《数学&mdash;&mdash;确定性的丧失》</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">[2] 也有观点认为函数式编程语言之所以没有广泛流行起来是因为一些实际的商业因素。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">[3] Douglas R.Hofstadter的著作《Godel, Escher, Bach: An Eternal Golden Braid》（《哥德尔、艾舍尔、巴赫&mdash;&mdash;集异璧之大成》）就是围绕这一思想写出的一本奇书。非常建议一读。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">[4] 《数学&mdash;&mdash;确定性的丧失》</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">[5] 虽然我觉得那个系徽做得太复杂，要表达这一简洁优美的思想其实还能有更好的方式。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">[6] 关于如何在lambda calculus系统里实现&ldquo;+&rdquo;操作符以及自然数等等，可参见<a style="color: #313428" href="javascript:if(confirm('http://blog.csdn.net/g9yuayon/archive/2006/05/29/759778.aspx  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://blog.csdn.net/g9yuayon/archive/2006/05/29/759778.aspx'" tppabs="http://blog.csdn.net/g9yuayon/archive/2006/05/29/759778.aspx">这里</a>，<a style="color: #313428" href="javascript:if(confirm('http://blog.csdn.net/g9yuayon/archive/2006/06/12/790953.aspx  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://blog.csdn.net/g9yuayon/archive/2006/06/12/790953.aspx'" tppabs="http://blog.csdn.net/g9yuayon/archive/2006/06/12/790953.aspx">这里</a>，和<a style="color: #313428" href="javascript:if(confirm('http://blog.csdn.net/g9yuayon/archive/2006/08/14/1062514.aspx  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://blog.csdn.net/g9yuayon/archive/2006/08/14/1062514.aspx'" tppabs="http://blog.csdn.net/g9yuayon/archive/2006/08/14/1062514.aspx">这里</a>。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">[7] g9的blog（负暄琐话）<a style="color: #313428" href="javascript:if(confirm('http://blog.csdn.net/g9yuayon/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://blog.csdn.net/g9yuayon/'" tppabs="http://blog.csdn.net/g9yuayon/">http://blog.csdn.net/g9yuayon/</a>&nbsp;上有一系列介绍lambda calculus的文章（当然，还有其它好文章:)），非常不错，强烈推荐。最近的两篇就是介绍Y combinator的。其中有一篇以javaScript语言描述了迭代式逐步抽象出Y Combinator的过程。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">[8] 实际上这只是第一不完备性定理，它还有一个推论，被称为第二不完备性定理，说的是任一个系统T内无法证明这个系统本身的一致性。这个定理的证明核心思想如下：我们前面证明第一不完备性定理的时候用的推断其实就表明 Con/T -&gt; G(g) （自然语言描述就是，由系统T的无矛盾，可以推出G(g)成立），而这个&ldquo;Con/T -&gt; G(g)&rdquo;本身又是可以在T内表达且证明出来的（具体怎么表达就不再多说了）&mdash;&mdash;只需要用排中律即可。于是我们立即得到，T里面无法推出Con/T，因为一旦推出Con/T就立即推出G(g)从而推出UnPr(G(g))，这就矛盾了。所以，Con/T无法在T内推出（证明）。</p>
	</div>
	<div class="textbox-bottom">
	</div>
	<div class="tags" style="display: none"> 
	</div>
</div><div class="textbox">
	<div class="textbox-calendar">
	<span class="textbox-calendar-month">Aug</span>
	<span class="textbox-calendar-day">31</span>
	</div>
	<div class="textbox-title">
		<h4>
		<a href="read.php-7521.htm" tppabs="http://i.renjihe.com/blog/read.php?7521">lambda演算与函数式编程 </a> <span id="starid7521"><img src="unstarred.gif" tppabs="http://i.renjihe.com/blog/template/default/images/others/unstarred.gif" alt="" title="未加星标" border="0"/></span> <img src="blank.gif" tppabs="http://i.renjihe.com/blog/images/weather/blank.gif" alt="不指定" title="不指定"/>
		</h4>
		<div class="textbox-label">
		<a href="view.php-go=user_1.htm" tppabs="http://i.renjihe.com/blog/view.php?go=user_1" target="_blank">renjihe1988</a> , 23:26 , <a href="index.php-go=category_2.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_2" title="查看分类： 软件">软件</a> &raquo; <a href="index.php-go=category_19.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_19" title="查看分类： 编译原理">编译原理</a> , <a href="read.php-7521.htm#reply" tppabs="http://i.renjihe.com/blog/read.php?7521#reply" title="发表您的评论">评论(0)</a> , <a href='javascript: void(0);' title="查看引用地址" onclick='showhidediv("tb7521");'>引用(0)</a> , <a href="read.php-7521.htm" tppabs="http://i.renjihe.com/blog/read.php?7521">阅读(3)</a> , Via 本站原创 
		</div>
	</div>
	<div id="tb7521" style="display: none;" class="textbox-tburl"><strong>引用功能被关闭了。</strong></div>
	
	<div class="textbox-content">
	<span style="font-size: 14px; line-height: 21px; font-family: simsun; color: #494949; background-color: #eb735a">前几天开始看&lt;程序设计语言概念&gt;（&nbsp;</span><a style="text-decoration: none; color: #99481f; font-family: simsun; font-size: 14px; line-height: 21px; background-color: #eb735a" href="javascript:if(confirm('http://www.amazon.com/exec/obidos/ASIN/0521780985/qid=1129186290/sr=11-1/ref=sr_11_1/103-3929732-9947012  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.amazon.com/exec/obidos/ASIN/0521780985/qid=1129186290/sr=11-1/ref=sr_11_1/103-3929732-9947012'" tppabs="http://www.amazon.com/exec/obidos/ASIN/0521780985/qid=1129186290/sr=11-1/ref=sr_11_1/103-3929732-9947012" target="_blank"><strong>Concepts in Programming Languages</strong></a><span style="font-size: 14px; line-height: 21px; font-family: simsun; color: #494949; background-color: #eb735a">&nbsp;），里面一开始就讲了计算系统，但不是图灵机，而是&lambda;演算。以前看SICP的时候有一题Church计数，既在&lambda;演算中，计算系统用函数的嵌套次数来计数（以及对应的scheme定义）：</span><br /><table border="0" cellspacing="1" cellpadding="1" style="margin: 0px; padding: 0px; color: #494949; font-family: simsun; font-size: 14px; background-color: #eb735a"><tbody><tr><td style="margin: 0px; padding: 0px; font-size: 12px; font-family: Verdana, 宋体, sans-serif; line-height: 18px"><table border="0" cellspacing="1" cellpadding="1" style="margin: 0px; padding: 0px"><tbody><tr><td style="margin: 0px; padding: 0px; font-size: 12px; font-family: Verdana, 宋体, sans-serif; line-height: 18px; color: #787878"><span style="word-wrap: normal; word-break: normal; line-height: 19.5px; font-size: x-small"><strong>0</strong>&nbsp;&equiv;&nbsp;&lambda;f.&lambda;x. x</span></td><td style="margin: 0px; padding: 0px; font-size: 12px; font-family: Verdana, 宋体, sans-serif; line-height: 18px; color: #787878"><span style="word-wrap: normal; word-break: normal; line-height: 19.5px; font-size: x-small">(define&nbsp;zero&nbsp;(lambda&nbsp;(f) (lambda&nbsp;(x)&nbsp;x)))</span></td></tr><tr><td style="margin: 0px; padding: 0px; font-size: 12px; font-family: Verdana, 宋体, sans-serif; line-height: 18px; color: #787878"><span style="word-wrap: normal; word-break: normal; line-height: 19.5px; font-size: x-small"><strong>1</strong>&nbsp;&equiv;&nbsp;&lambda;f.&lambda;x. f x</span></td><td style="margin: 0px; padding: 0px; font-size: 12px; font-family: Verdana, 宋体, sans-serif; line-height: 18px; color: #787878"><span style="word-wrap: normal; word-break: normal; line-height: 19.5px; font-size: x-small">(define one (lambda (f) (lambda (x) (f x))))</span></td></tr><tr><td style="margin: 0px; padding: 0px; font-size: 12px; font-family: Verdana, 宋体, sans-serif; line-height: 18px; color: #787878"><span style="word-wrap: normal; word-break: normal; line-height: 19.5px; font-size: x-small"><strong>2</strong>&nbsp;&equiv;&nbsp;&lambda;f.&lambda;x. f (f x)</span></td><td style="margin: 0px; padding: 0px; font-size: 12px; font-family: Verdana, 宋体, sans-serif; line-height: 18px; color: #787878"><span style="word-wrap: normal; word-break: normal; line-height: 19.5px; font-size: x-small">(define two (lambda (f) (lambda (x) ( f (f x)))))</span></td></tr><tr><td style="margin: 0px; padding: 0px; font-size: 12px; font-family: Verdana, 宋体, sans-serif; line-height: 18px; color: #787878"><span style="word-wrap: normal; word-break: normal; line-height: 19.5px; font-size: x-small"><strong>3</strong>&nbsp;&equiv;&nbsp;&lambda;f.&lambda;x. f (f (f x))</span></td><td style="margin: 0px; padding: 0px; font-size: 12px; font-family: Verdana, 宋体, sans-serif; line-height: 18px; color: #787878"><span style="word-wrap: normal; word-break: normal; line-height: 19.5px; font-size: x-small">(define three (lambda (f) (lambda (x) (f (f (f x))))))</span></td></tr><tr><td style="margin: 0px; padding: 0px; font-size: 12px; font-family: Verdana, 宋体, sans-serif; line-height: 18px; color: #787878"><span style="word-wrap: normal; word-break: normal; line-height: 19.5px; font-size: x-small">...</span></td><td style="margin: 0px; padding: 0px; font-size: 12px; font-family: Verdana, 宋体, sans-serif; line-height: 18px; color: #787878"><span style="word-wrap: normal; word-break: normal; line-height: 19.5px; font-size: x-small">...<br /></span></td></tr><tr><td style="margin: 0px; padding: 0px; font-size: 12px; font-family: Verdana, 宋体, sans-serif; line-height: 18px; color: #787878"><span style="word-wrap: normal; word-break: normal; line-height: 19.5px; font-size: x-small"><strong>n</strong>&nbsp;&equiv;&nbsp;&lambda;f.&lambda;x. f<sup><em>n</em></sup>&nbsp;x</span></td><td style="margin: 0px; padding: 0px; font-size: 12px; font-family: Verdana, 宋体, sans-serif; line-height: 18px; color: #787878"><span style="word-wrap: normal; word-break: normal; line-height: 19.5px; font-size: x-small">...</span></td></tr></tbody></table><br />&nbsp;&nbsp;虽然计数看懂了，但是scheme的实现到现在还是没想通。。有人说对计数的lambda表达式人肉展开，我没展成功- -<br />&nbsp;&nbsp;也就是从那时候起，知道函数式编程的理论基础是&lambda;演算。正好这本书有专门的章节，在恶补了两天之后，终于知道了些皮毛。。。<br />&nbsp;<br />&nbsp;&nbsp;所谓&lambda;演算，是一套用于研究函数定义，函数应用和递归的形式系统。它包括一条变换规则（变量替换）和一条函数定义方式，Lambda演算之通用在于，任何一个可计算函数都能用这种形式来表达和求值。因而，它是等价于<a style="text-decoration: none; color: #99481f" href="javascript:if(confirm('http://zh.wikipedia.org/wiki/%E5%9B%BE%E7%81%B5%E6%9C%BA  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://zh.wikipedia.org/wiki/%E5%9B%BE%E7%81%B5%E6%9C%BA'" tppabs="http://zh.wikipedia.org/wiki/%E5%9B%BE%E7%81%B5%E6%9C%BA" title="图灵机">图灵机</a>的。尽管如此，Lambda演算强调的是变换规则的运用，而非实现它们的具体机器。可以认为这是一种更接近软件而 非硬件的方式。<br />&nbsp;&nbsp;（书上多次提到Lambda演算的计算能力已被证明等价于图灵机，就冲这点，我势必要把FP学好。。。）<br />&nbsp;&nbsp;对于Lambda演算的描述，wiki的非形式化定义：<br /><p style="margin: 0px 0px 5px; padding: 0px; border: 0px; list-style: none; word-wrap: normal; word-break: normal; color: #787878">在lambda演算中，每个表达式都代表一个只有单独参数的函数，这个函数的参数本身也是一个只有单一参数的函数，同时，函数的值是又一个只有单一 参数的函数。函数是通过lambda表达式匿名地定义的，这个表达式说明了此函数将对其参数进行什么操作。例如，&ldquo;加2&rdquo;函数f(x)= x + 2可以用lambda演算表示为&lambda;x.x + 2(&lambda;y.y + 2也是一样的，参数的取名无关紧要)而f(3)的值可以写作(&lambda;x.x + 2) 3。函数的作用（application）是<a style="text-decoration: none; color: #99481f" href="javascript:if(confirm('http://zh.wikipedia.org/w/index.php?title=%E5%B7%A6%E7%BB%93%E5%90%88&action=edit&redlink=1  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://zh.wikipedia.org/w/index.php?title=%E5%B7%A6%E7%BB%93%E5%90%88&action=edit&redlink=1'" tppabs="http://zh.wikipedia.org/w/index.php?title=%E5%B7%A6%E7%BB%93%E5%90%88&action=edit&redlink=1" title="左结合">左结合</a>的：f x y =(f x) y。考虑这么一个函数：它把一个函数作为参数，这个函数将被作用在3上：&lambda;f.f 3。如果把这个（用函数作参数的）函数作用于我们先前的&ldquo;加2&rdquo;函数上：(&lambda;f.f 3)(&lambda;x.x+2)，则明显地，下述三个表达式：</p><dl style="margin: 0px; padding: 0px; border: 0px; list-style: none; color: #787878"><dd style="margin: 0px; padding: 0px; border: 0px; list-style: none">(&lambda;f.f 3)(&lambda;x.x+2)与 (&lambda;x.x + 2) 3与3 + 2</dd></dl><p style="margin: 0px 0px 5px; padding: 0px; border: 0px; list-style: none; word-wrap: normal; word-break: normal; color: #787878">是等价的。有两个参数的函数可以通过lambda演算这么表达：一个单一参数的函数的返回值又是一个单一参数的函数（参见<a style="text-decoration: none; color: #99481f" href="javascript:if(confirm('http://zh.wikipedia.org/wiki/Currying  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://zh.wikipedia.org/wiki/Currying'" tppabs="http://zh.wikipedia.org/wiki/Currying" title="Currying">Currying</a>）。例如，函数f(x, y) = x - y可以写作&lambda;x.&lambda;y.x - y。下述三个表达式：</p><dl style="margin: 0px; padding: 0px; border: 0px; list-style: none; color: #787878"><dd style="margin: 0px; padding: 0px; border: 0px; list-style: none">(&lambda;x.&lambda;y.x - y) 7 2与 (&lambda;y.7 - y) 2与7 - 2</dd></dl><p style="margin: 0px 0px 5px; padding: 0px; border: 0px; list-style: none; word-wrap: normal; word-break: normal; color: #787878">也是等价的。然而这种lambda表达式之间的等价性无法找到一个通用的函数来判定。</p><p style="margin: 0px 0px 5px; padding: 0px; border: 0px; list-style: none; word-wrap: normal; word-break: normal; color: #787878">并非所有的lambda表达式都可以规约至上述那样的确定值，考虑</p><dl style="margin: 0px; padding: 0px; border: 0px; list-style: none; color: #787878"><dd style="margin: 0px; padding: 0px; border: 0px; list-style: none">(&lambda;x.x x)(&lambda;x.x x)</dd></dl><p style="margin: 0px 0px 5px; padding: 0px; border: 0px; list-style: none; word-wrap: normal; word-break: normal; color: #787878">或</p><dl style="margin: 0px; padding: 0px; border: 0px; list-style: none; color: #787878"><dd style="margin: 0px; padding: 0px; border: 0px; list-style: none">(&lambda;x.x x x)(&lambda;x.x x x)</dd></dl><p style="margin: 0px 0px 5px; padding: 0px; border: 0px; list-style: none; word-wrap: normal; word-break: normal; color: #787878">然后试图把第一个函数作用在它的参数上。 (&lambda;x.x x)被称为&omega;&nbsp;<a style="text-decoration: none; color: #99481f" href="javascript:if(confirm('http://zh.wikipedia.org/wiki/%E7%BB%84%E5%90%88%E5%AD%90%E9%80%BB%E8%BE%91  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://zh.wikipedia.org/wiki/%E7%BB%84%E5%90%88%E5%AD%90%E9%80%BB%E8%BE%91'" tppabs="http://zh.wikipedia.org/wiki/%E7%BB%84%E5%90%88%E5%AD%90%E9%80%BB%E8%BE%91" title="组合子逻辑">组合子</a>，((&lambda;x.x x)(&lambda;x.x x))被称为&Omega;，而((&lambda;x.x x x) (&lambda;x.x x x))被称为&Omega;<sub>2</sub>，以此类推。</p><p style="margin: 0px 0px 5px; padding: 0px; border: 0px; list-style: none; word-wrap: normal; word-break: normal; color: #787878">若仅形式化函数作用的概念而不允许lambda表达式，就得到了<a style="text-decoration: none; color: #99481f" href="javascript:if(confirm('http://zh.wikipedia.org/wiki/%E7%BB%84%E5%90%88%E5%AD%90%E9%80%BB%E8%BE%91  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://zh.wikipedia.org/wiki/%E7%BB%84%E5%90%88%E5%AD%90%E9%80%BB%E8%BE%91'" tppabs="http://zh.wikipedia.org/wiki/%E7%BB%84%E5%90%88%E5%AD%90%E9%80%BB%E8%BE%91" title="组合子逻辑">组合子逻辑</a>。</p><p style="margin: 0px 0px 5px; padding: 0px; border: 0px; list-style: none; word-wrap: normal; word-break: normal">&nbsp;&nbsp;形式化定义用巴科斯文法描述，我看不懂- -</p><p style="margin: 0px 0px 5px; padding: 0px; border: 0px; list-style: none; word-wrap: normal; word-break: normal">&nbsp;&nbsp;Lambda演算中有几个重要的法则，我的理解，它们分别成为了FP几个特性的理论基础：</p><h3 style="margin: 0px; padding: 0px; border: 0px; list-style: none"><span style="word-wrap: normal; word-break: normal; line-height: 21.0599994659424px">1，&alpha;-变换</span></h3><p style="margin: 0px 0px 5px; padding: 0px; border: 0px; list-style: none; word-wrap: normal; word-break: normal; color: #787878">Alpha-变换规则表达的是，被绑定变量的名称是不重要的。比如说&lambda;x.x和&lambda;y.y是同一个函数。尽管如此，这条规则并非像它看起来这么简单， 关于被绑定的变量能否由另一个替换有一系列的限制。</p>&nbsp;&nbsp;对应LISP中，函数参数本身的名字对函数没有任何影响，Lambda表达式的定义也很好的说明了这一点。比如以下两个函数是完全等价的。<br />&nbsp;&nbsp;(define (square x) (lambda(x) (* x x)))<br />&nbsp;&nbsp;(define (square y) (lambda(y) (* y y)))<br />&nbsp;&nbsp;另外，alpha变换涉及到变量的自由出现。即被一个函数绑定的变量不能与与另一个函数绑定的变量同时变换。例如&lambda;x.(&lambda;x.x) x这样的表达式将变换为&lambda;y.(&lambda;x.x) y。举个Scheme求平方和的例子~<br />&nbsp;&nbsp;(define (square-sum square x y)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(+ (square x) (square y)))<br />&nbsp;&nbsp;square函数在上面定义，其中有变量x，求平方和函数自身也有名为x的变量，但两者显然可以各自变换。并且这个例子用到了高阶函数（&beta;-归约和函数的curry化），下面马上说明。<br /><br /><h3 style="margin: 0px; padding: 0px; border: 0px; list-style: none"><span style="word-wrap: normal; word-break: normal; line-height: 21.0599994659424px">2，&beta;-归约</span></h3><p style="margin: 0px 0px 5px; padding: 0px; border: 0px; list-style: none; word-wrap: normal; word-break: normal; color: #787878">Beta-归约规则表达的是函数作用的概念。它陈述了若所有的E'的自由出现在E [V:=E']中仍然是自由的情况下，有</p><dl style="margin: 0px; padding: 0px; border: 0px; list-style: none; color: #787878"><dd style="margin: 0px; padding: 0px; border: 0px; list-style: none">((&lambda;V.E) E') == E [V:=E']</dd></dl><p style="margin: 0px 0px 5px; padding: 0px; border: 0px; list-style: none; word-wrap: normal; word-break: normal; color: #787878">成立。</p><p style="margin: 0px 0px 5px; padding: 0px; border: 0px; list-style: none; word-wrap: normal; word-break: normal; color: #787878">&nbsp;&nbsp;<span style="word-wrap: normal; word-break: normal; color: #000000">虽然还是巴科斯文法，不过这个大概能看明白。我觉得beta-变换是Lambda演算最重要的部分，也是函数式编程中最重要概念--<span style="word-wrap: normal; word-break: normal; font-weight: bold">高阶函数</span>的理论基础。由于Lambda演算中，函数可以接受的参数既可以是变量，也可以是另一个函数，因此可以对其进行归约，归约到只接受一个变量的函数（Lambda演算中只定义了一元函数）。举几个例子：</span></p><p style="margin: 0cm 0cm 0pt; padding: 0px; border: 0px; list-style: none; word-wrap: normal; word-break: normal; text-indent: 21pt"><u><span style="word-wrap: normal; word-break: normal; font-family: 宋体">(</span></u><u><span style="word-wrap: normal; word-break: normal; font-family: symbol">l</span></u><u><span style="word-wrap: normal; word-break: normal; font-family: 宋体">x.</span></u><u><span style="word-wrap: normal; word-break: normal; font-family: symbol">l</span></u><u><span style="word-wrap: normal; word-break: normal; font-family: 宋体">y.y x)(</span></u><u><span style="word-wrap: normal; word-break: normal; font-family: symbol">l</span></u><u><span style="word-wrap: normal; word-break: normal; font-family: 宋体">z.u)</span></u>&nbsp;<span style="word-wrap: normal; word-break: normal; font-family: symbol">&reg;</span>&nbsp;<span style="word-wrap: normal; word-break: normal; font-family: symbol">l</span><span style="word-wrap: normal; word-break: normal; font-family: 宋体">y.y(</span><span style="word-wrap: normal; word-break: normal; font-family: symbol">l</span><span style="word-wrap: normal; word-break: normal; font-family: 宋体">z.u)</span></p><p style="margin: 0cm 0cm 0pt; padding: 0px; border: 0px; list-style: none; word-wrap: normal; word-break: normal; text-indent: 21pt"><u><span style="word-wrap: normal; word-break: normal; font-family: 宋体">(</span></u><u><span style="word-wrap: normal; word-break: normal; font-family: symbol">l</span></u><u><span style="word-wrap: normal; word-break: normal; font-family: 宋体">x. x x)(</span></u><u><span style="word-wrap: normal; word-break: normal; font-family: symbol">l</span></u><u><span style="word-wrap: normal; word-break: normal; font-family: 宋体">z.u)</span></u>&nbsp;<span style="word-wrap: normal; word-break: normal; font-family: symbol">&reg;</span>&nbsp;<span style="word-wrap: normal; word-break: normal; font-family: 宋体">(</span><span style="word-wrap: normal; word-break: normal; font-family: symbol">l</span><span style="word-wrap: normal; word-break: normal; font-family: 宋体">z.u) (</span><span style="word-wrap: normal; word-break: normal; font-family: symbol">l</span><span style="word-wrap: normal; word-break: normal; font-family: 宋体">z.u)</span></p><p style="margin: 0cm 0cm 0pt; padding: 0px; border: 0px; list-style: none; word-wrap: normal; word-break: normal; text-indent: 21pt"><span style="word-wrap: normal; word-break: normal; font-family: 宋体">(</span><span style="word-wrap: normal; word-break: normal; font-family: symbol">l</span><span style="word-wrap: normal; word-break: normal; font-family: 宋体">y.y a)(<u>(</u></span><u><span style="word-wrap: normal; word-break: normal; font-family: symbol">l</span></u><u><span style="word-wrap: normal; word-break: normal; font-family: 宋体">x. x)(</span></u><u><span style="word-wrap: normal; word-break: normal; font-family: symbol">l</span></u><u><span style="word-wrap: normal; word-break: normal; font-family: 宋体">z.(</span></u><u><span style="word-wrap: normal; word-break: normal; font-family: symbol">l</span></u><u><span style="word-wrap: normal; word-break: normal; font-family: 宋体">u.u) z)</span></u><span style="word-wrap: normal; word-break: normal; font-family: 宋体">)</span>&nbsp;<span style="word-wrap: normal; word-break: normal; font-family: symbol">&reg;</span>&nbsp;<span style="word-wrap: normal; word-break: normal; font-family: 宋体">(</span><span style="word-wrap: normal; word-break: normal; font-family: symbol">l</span><span style="word-wrap: normal; word-break: normal; font-family: 宋体">y.y a)(</span><span style="word-wrap: normal; word-break: normal; font-family: symbol">l</span><span style="word-wrap: normal; word-break: normal; font-family: 宋体">z.(</span><span style="word-wrap: normal; word-break: normal; font-family: symbol">l</span><span style="word-wrap: normal; word-break: normal; font-family: 宋体">u.u) z)</span></p><p style="margin: 0cm 0cm 0pt; padding: 0px; border: 0px; list-style: none; word-wrap: normal; word-break: normal; text-indent: 21pt"><span style="word-wrap: normal; word-break: normal; font-family: 宋体">(</span><span style="word-wrap: normal; word-break: normal; font-family: symbol">l</span><span style="word-wrap: normal; word-break: normal; font-family: 宋体">y.y a)((</span><span style="word-wrap: normal; word-break: normal; font-family: symbol">l</span><span style="word-wrap: normal; word-break: normal; font-family: 宋体">x. x)(</span><span style="word-wrap: normal; word-break: normal; font-family: symbol">l</span><span style="word-wrap: normal; word-break: normal; font-family: 宋体">z.<u>(</u></span><u><span style="word-wrap: normal; word-break: normal; font-family: symbol">l</span></u><u><span style="word-wrap: normal; word-break: normal; font-family: 宋体">u.u) z</span></u><span style="word-wrap: normal; word-break: normal; font-family: 宋体">))</span>&nbsp;<span style="word-wrap: normal; word-break: normal; font-family: symbol">&reg;</span>&nbsp;<span style="word-wrap: normal; word-break: normal; font-family: 宋体">(</span><span style="word-wrap: normal; word-break: normal; font-family: symbol">l</span><span style="word-wrap: normal; word-break: normal; font-family: 宋体">y.y a)((</span><span style="word-wrap: normal; word-break: normal; font-family: symbol">l</span><span style="word-wrap: normal; word-break: normal; font-family: 宋体">x. x)(</span><span style="word-wrap: normal; word-break: normal; font-family: symbol">l</span><span style="word-wrap: normal; word-break: normal; font-family: 宋体">z. z))</span></p><span style="word-wrap: normal; word-break: normal; font-family: 宋体">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;<u><span style="word-wrap: normal; word-break: normal; font-family: 宋体">(</span></u><u><span style="word-wrap: normal; word-break: normal; font-family: symbol">l</span></u><u><span style="word-wrap: normal; word-break: normal; font-family: 宋体">y.y a)((</span></u><u><span style="word-wrap: normal; word-break: normal; font-family: symbol">l</span></u><u><span style="word-wrap: normal; word-break: normal; font-family: 宋体">x. x)(</span></u><u><span style="word-wrap: normal; word-break: normal; font-family: symbol">l</span></u><u><span style="word-wrap: normal; word-break: normal; font-family: 宋体">z.(</span></u><u><span style="word-wrap: normal; word-break: normal; font-family: symbol">l</span></u><u><span style="word-wrap: normal; word-break: normal; font-family: 宋体">u.u) z))</span></u>&nbsp;<span style="word-wrap: normal; word-break: normal; font-family: symbol">&reg;</span>&nbsp;<span style="word-wrap: normal; word-break: normal; font-family: 宋体">((</span><span style="word-wrap: normal; word-break: normal; font-family: symbol">l</span><span style="word-wrap: normal; word-break: normal; font-family: 宋体">x. x)(</span><span style="word-wrap: normal; word-break: normal; font-family: symbol">l</span><span style="word-wrap: normal; word-break: normal; font-family: 宋体">z.(</span><span style="word-wrap: normal; word-break: normal; font-family: symbol">l</span><span style="word-wrap: normal; word-break: normal; font-family: 宋体">u.u) z)) a<br /><br />这样的归约计算我到现在还不太适应- -，归约计算的每一步，就是代换，把最右边的函数/变量代入到次右边的参数，同时消去左边相应的</span>&lambda;，直到不能再归约为止。<br />&nbsp;&nbsp;显然，&beta;-归约自身结合Lambda演算的定义就可以自然而然地导出高阶函数的概念。所谓高阶函数，如果一个函数满足：<span style="word-wrap: normal; word-break: normal; color: #787878">1，接受一个或多个函数作为输入；2，输出一个函数。<span style="word-wrap: normal; word-break: normal; color: #000000">那么这就是一个高阶函数。数学中可以举个对应的例子：求导，如果这一过程作为一个函数，那么它就是一个高阶函数。它接受一个函数作为参数，输出了这个函数的导函数。在求平方和的例子中，square-sum接受了求平方函数square，输出了一个求平方和的函数，高阶函数的概念可以在这里体现。<br />&nbsp;&nbsp;另外，Lambda演算中只定义了一元函数，那么多元函数怎么办？<br />&nbsp;&nbsp;为了Lambda系统能更小，Church等人当初只定义了一元函数，并且利用&beta;-归约的定义，将多元函数化为只接受单一参数的函数，这就是<span style="word-wrap: normal; word-break: normal; font-weight: bold">函数的curry化</span>。</span></span><strong>curry化</strong>是把接受多个参数<a style="text-decoration: none; color: #99481f" href="javascript:if(confirm('http://zh.wikipedia.org/w/index.php?title=%E5%BD%A2%E5%BC%8F%E5%8F%82%E6%95%B0&action=edit&redlink=1  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://zh.wikipedia.org/w/index.php?title=%E5%BD%A2%E5%BC%8F%E5%8F%82%E6%95%B0&action=edit&redlink=1'" tppabs="http://zh.wikipedia.org/w/index.php?title=%E5%BD%A2%E5%BC%8F%E5%8F%82%E6%95%B0&action=edit&redlink=1" title="形式参数"></a>的函数变 换成接受一个单一参数（最初函数的第一个参数）的函数，并且返回接受余下的参数而且返回结果的新函数的技术。显然，curry化本身就是一个高阶函数，也用到了&beta;-归约。那么curry化如何演算呢？很简单<br />&nbsp;&nbsp;&lambda;xy.N ==&gt; &lambda;x.&lambda;y.N<br />&nbsp;&nbsp;这个文法有点抽象~~比如说有三元函数f(x,y,z)，由于只能接受一个参数，所以对它进行curry化：<br />&nbsp;&nbsp;1，接受x，并固定它，返回二元函数g(y,z)；<br />&nbsp;&nbsp;2，接受y，并固定它，返回一元函数h(z)，这样就把一个三元函数化为一元函数来处理。<br />&nbsp;&nbsp;&beta;-归约与curry化相互组合就能产生出各种复杂的过程，也产生了威力巨大的Lambda演算！<br /><br /><h3 style="margin: 0px; padding: 0px; border: 0px; list-style: none"><span style="word-wrap: normal; word-break: normal; line-height: 21.0599994659424px">3，&eta;-变换</span></h3><p style="margin: 0px 0px 5px; padding: 0px; border: 0px; list-style: none; word-wrap: normal; word-break: normal; color: #787878">&nbsp;&nbsp;前两条规则之后，还可以加入第三条规则，eta-变换，来形成一个新的等价关系。Eta-变换表达的是<a style="text-decoration: none; color: #99481f" href="javascript:if(confirm('http://zh.wikipedia.org/wiki/%E5%A4%96%E5%BB%B6%E6%80%A7  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://zh.wikipedia.org/wiki/%E5%A4%96%E5%BB%B6%E6%80%A7'" tppabs="http://zh.wikipedia.org/wiki/%E5%A4%96%E5%BB%B6%E6%80%A7" title="外延性">外延性</a>的概念，在这里外延性指的是，两个函数对于所有的参数得到的结果都一致，当且仅当它们是同一个函数。Eta-变换 可以令&lambda;x .f x和f相互转换，只要x不是f中的自由出现。下面说明了为何这条规则和外延性是等价的：</p><p style="margin: 0px 0px 5px; padding: 0px; border: 0px; list-style: none; word-wrap: normal; word-break: normal; color: #787878">若f与g外延地等价，即，f a == g a对所有的lambda表达式a成立，则当取a为在f中不是自由出现的变量x时，我们有f x == g x，因此&lambda;x .f x == &lambda;x .g x，由eta-变换f == g。所以只要eta-变换是有效的，会得到外延性也是有效的。</p><p style="margin: 0px 0px 5px; padding: 0px; border: 0px; list-style: none; word-wrap: normal; word-break: normal; color: #787878">相反地，若外延性是有效的，则由beta-归约，对所有的y有(&lambda;x .f x) y == f y，可得&lambda;x .f x == f，即eta-变换也是有效的。</p><p style="margin: 0px 0px 5px; padding: 0px; border: 0px; list-style: none; word-wrap: normal; word-break: normal; color: #787878">&nbsp;&nbsp;<span style="word-wrap: normal; word-break: normal; color: #000000">按照我的理解，eta-变换主要关于函数的等价性，这一点我在Scheme当中感触不深，倒是Python在函数之间可以直接赋值体现得更明显。</span>&nbsp;<br /></p></td><td style="margin: 0px; padding: 0px; font-size: 12px; font-family: Verdana, 宋体, sans-serif; line-height: 18px">&nbsp;</td></tr><tr><td style="margin: 0px; padding: 0px; font-size: 12px; font-family: Verdana, 宋体, sans-serif; line-height: 18px">&nbsp;</td><td style="margin: 0px; padding: 0px; font-size: 12px; font-family: Verdana, 宋体, sans-serif; line-height: 18px">&nbsp;</td></tr><tr><td style="margin: 0px; padding: 0px; font-size: 12px; font-family: Verdana, 宋体, sans-serif; line-height: 18px">&nbsp;<br />另外FP中的重要概念在Lambda演算中也有坚实的理论基础<br /><br /><span style="word-wrap: normal; word-break: normal; line-height: 27px; font-size: 18px"><span style="word-wrap: normal; word-break: normal; font-weight: bold">递归</span></span><br /></td><td style="margin: 0px; padding: 0px; font-size: 12px; font-family: Verdana, 宋体, sans-serif; line-height: 18px">&nbsp;</td></tr><tr><td style="margin: 0px; padding: 0px; font-size: 12px; font-family: Verdana, 宋体, sans-serif; line-height: 18px">&nbsp;&nbsp;由于纯函数式编程当中没有变量，所以没有循环，类似的过程全部由递归来实现，在Lambda演算中，不能定义包含自身的函数，因此递归通过<span style="word-wrap: normal; word-break: normal; font-weight: bold">不动点组合子</span>来实现。举个例子：<br /><p style="margin: 0px 0px 5px; padding: 0px; border: 0px; list-style: none; word-wrap: normal; word-break: normal">为了计算阶乘，可以开始于定义一个函数，这里叫g，它接受一个函数f作 为参数并返回接受n作为参数的另一个函数：</p><dl style="margin: 0px; padding: 0px; border: 0px; list-style: none"><dd style="margin: 0px; padding: 0px; border: 0px; list-style: none">g&nbsp;:= &lambda;f n.(if n = 0 then 1 else n&middot;f(n-1))。</dd></dl><p style="margin: 0px 0px 5px; padding: 0px; border: 0px; list-style: none; word-wrap: normal; word-break: normal">函数g返回要么常量1，要么函数f对n-1的n次应用。函数g可以用lambda演算来定义。</p><p style="margin: 0px 0px 5px; padding: 0px; border: 0px; list-style: none; word-wrap: normal; word-break: normal">但是，g自身仍然不是递归的；为了使用g来建立递归函数，作为参数传递给g的f函 数必须有特殊的性质。也就是说，作为参数传递的f函数必须展开为调用带有一个参数的函数g&nbsp;-- 并且这个参数必须再次f函数!</p>换句话说，f必须展开为g(f)。这个到g的调用将接着展开为上面的阶乘函数并计算下至另 一层递归。在这个展开中函数f将再次出现，并将被再次展开为g(f)并继续递归。这种函数，这裡的f = g(f)，叫做g的不动点。<br />&nbsp;&nbsp;在Lambda演算中，最常见最简单的不动点是Y组合子，它的定义为<br />&nbsp;&nbsp;Y = &lambda;g.(&lambda;x.g(x x))(&lambda;x.g(x x))<br />&nbsp;&nbsp;对于任意函数g，有Y g = g(Y g)。（我验算过了，这是真的- -~这是Curry发现的，您就是神）。对于阶乘函数，令n = 5<br /><dl style="margin: 0px; padding: 0px; border: 0px; list-style: none"><dd style="margin: 0px; padding: 0px; border: 0px; list-style: none">(&lambda;n.(if n = 0 then 1 else n&middot;((Y g)(n-1)))) 5</dd><dd style="margin: 0px; padding: 0px; border: 0px; list-style: none">if 5 = 0 then 1 else 5&middot;(g(Y g，5-1))</dd><dd style="margin: 0px; padding: 0px; border: 0px; list-style: none">5&middot;(g(Y g)4)</dd><dd style="margin: 0px; padding: 0px; border: 0px; list-style: none">5&middot;(&lambda;n.(if n = 0 then 1 else n&middot;((Y g)(n-1))) 4)</dd><dd style="margin: 0px; padding: 0px; border: 0px; list-style: none">5&middot;(if 4 = 0 then 1 else 4&middot;(g(Y g，4-1)))</dd><dd style="margin: 0px; padding: 0px; border: 0px; list-style: none">5&middot;(4&middot;(g(Y g)3))</dd><dd style="margin: 0px; padding: 0px; border: 0px; list-style: none">5&middot;(4&middot;(&lambda;n.(if n = 0 then 1 else n&middot;((Y g)(n-1))) 3))</dd><dd style="margin: 0px; padding: 0px; border: 0px; list-style: none">5&middot;(4&middot;(if 3 = 0 then 1 else 3&middot;(g(Y g，3-1))))</dd><dd style="margin: 0px; padding: 0px; border: 0px; list-style: none">5&middot;(4&middot;(3&middot;(g(Y g)2)))</dd><dt style="margin: 0px; padding: 0px; border: 0px; list-style: none">由于Y组合子的存在，函数反复调用自身，形成了递归。（神一般的存在。。。）</dt></dl>&nbsp;<br /><h2 style="margin: 0px; padding: 0px; border: 0px; list-style: none"><span style="word-wrap: normal; word-break: normal; line-height: 27px">逻辑与谓词</span></h2><p style="margin: 0px 0px 5px; padding: 0px; border: 0px; list-style: none; word-wrap: normal; word-break: normal">习惯上，下述两个定义（称为邱奇布尔值）被用作TRUE和FALSE这样的布尔值：</p><dl style="margin: 0px; padding: 0px; border: 0px; list-style: none"><dd style="margin: 0px; padding: 0px; border: 0px; list-style: none">TRUE&nbsp;:= &lambda;x y.x</dd><dd style="margin: 0px; padding: 0px; border: 0px; list-style: none">FALSE&nbsp;:= &lambda;x y.y<dl style="margin: 0px; padding: 0px; border: 0px; list-style: none"><dd style="margin: 0px; padding: 0px; border: 0px; list-style: none">(注意FALSE等价于前面定义邱奇数零)</dd></dl></dd></dl><p style="margin: 0px 0px 5px; padding: 0px; border: 0px; list-style: none; word-wrap: normal; word-break: normal">接着，通过这两个&lambda;-项，我们可以定义一些逻辑运算：</p><dl style="margin: 0px; padding: 0px; border: 0px; list-style: none"><dd style="margin: 0px; padding: 0px; border: 0px; list-style: none">AND&nbsp;:= &lambda;p q.p q FALSE</dd><dd style="margin: 0px; padding: 0px; border: 0px; list-style: none">OR&nbsp;:= &lambda;p q.p TRUE q</dd><dd style="margin: 0px; padding: 0px; border: 0px; list-style: none">NOT&nbsp;:= &lambda;p.p FALSE TRUE</dd><dd style="margin: 0px; padding: 0px; border: 0px; list-style: none">IFTHENELSE&nbsp;:= &lambda;p x y.p x y</dd></dl><p style="margin: 0px 0px 5px; padding: 0px; border: 0px; list-style: none; word-wrap: normal; word-break: normal">我们现在可以计算一些逻辑函数，比如：</p><dl style="margin: 0px; padding: 0px; border: 0px; list-style: none"><dd style="margin: 0px; padding: 0px; border: 0px; list-style: none">AND TRUE FALSE<dl style="margin: 0px; padding: 0px; border: 0px; list-style: none"><dd style="margin: 0px; padding: 0px; border: 0px; list-style: none">&equiv;(&lambda;p q.p q FALSE) TRUE FALSE &rarr;<sub>&beta;</sub>&nbsp;TRUE FALSE FALSE</dd><dd style="margin: 0px; padding: 0px; border: 0px; list-style: none">&equiv;(&lambda;x y.x) FALSE FALSE &rarr;<sub>&beta;</sub>&nbsp;FALSE</dd></dl></dd></dl><p style="margin: 0px 0px 5px; padding: 0px; border: 0px; list-style: none; word-wrap: normal; word-break: normal">我们见到AND TRUE FALSE等价于FALSE。</p><p style="margin: 0px 0px 5px; padding: 0px; border: 0px; list-style: none; word-wrap: normal; word-break: normal">&ldquo;谓词&rdquo;是指返回布尔值的函数。最基本的一个谓词是ISZERO，当且仅当其参数为零时返回真，否则返回假：</p><dl style="margin: 0px; padding: 0px; border: 0px; list-style: none"><dd style="margin: 0px; padding: 0px; border: 0px; list-style: none">ISZERO&nbsp;:= &lambda;n.n(&lambda;x.FALSE) TRUE</dd></dl><p style="margin: 0px 0px 5px; padding: 0px; border: 0px; list-style: none; word-wrap: normal; word-break: normal">运用谓词与上述TRUE和FALSE的定义，使得&quot;if-then-else&quot;这类语句很容易用lambda 演算写出。FP要以Lambda演算为基础,在这里谓词和逻辑语句也有了相应的Lambda定义.</p><h2 style="margin: 0px; padding: 0px; border: 0px; list-style: none"><span style="word-wrap: normal; word-break: normal; line-height: 27px">有序对</span></h2><p style="margin: 0px 0px 5px; padding: 0px; border: 0px; list-style: none; word-wrap: normal; word-break: normal">在逻辑谓词定义的基础上可以轻易的定义出有序对（2-元组）。</p><dl style="margin: 0px; padding: 0px; border: 0px; list-style: none"><dd style="margin: 0px; padding: 0px; border: 0px; list-style: none">CONS&nbsp;:= &lambda;x y.&lambda;p.IF p x y</dd><dd style="margin: 0px; padding: 0px; border: 0px; list-style: none">CAR&nbsp;:= &lambda;x.x TRUE</dd><dd style="margin: 0px; padding: 0px; border: 0px; list-style: none">CDR&nbsp;:= &lambda;x.x FALSE</dd></dl>对应Scheme程序：<br />(define (cons x y)<br />&nbsp;&nbsp;(define (dispatch m)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(if m x<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y)))<br />&nbsp;&nbsp;dispatch)<br /><br />(define (car z) (z #t))<br />(define (cdr z) (z #f))<br /><p style="margin: 0px 0px 5px; padding: 0px; border: 0px; list-style: none; word-wrap: normal; word-break: normal">链表数据类型可以定义为，要么是为空列表保留的值（e.g.FALSE），要么是CONS一个元素和一个更小的列表。这样,Lambda演算就定义出了LISP中唯一的数据结构.</p><p style="margin: 0px 0px 5px; padding: 0px; border: 0px; list-style: none; word-wrap: normal; word-break: normal"><br /></p><p style="margin: 0px 0px 5px; padding: 0px; border: 0px; list-style: none; word-wrap: normal; word-break: normal">&nbsp;&nbsp;LISP开发得非常早，当初完全是建立在Lambda演算的基础上，所以总结的这篇文章这里也看得到Lambda演算与LISP结合得非常紧密，LISP中的各个性质和元素在Lambda演算中都有对应的定义，当初接触Functional Programming的时候，完全没想到在它背后有这么一套简单，强大，完备的理论基础，LISP/Scheme也因此简单却强大。能够深入理解Lambda演算，对FP很有帮助。</p><p style="margin: 0px 0px 5px; padding: 0px; border: 0px; list-style: none; word-wrap: normal; word-break: normal">&nbsp;&nbsp;TT喜欢FP，TT要走的路还很长很长。。。。。</p></td></tr></tbody></table>
	</div>
	<div class="textbox-bottom">
	</div>
	<div class="tags" style="display: none"> 
	</div>
</div><div class="textbox">
	<div class="textbox-calendar">
	<span class="textbox-calendar-month">Jan</span>
	<span class="textbox-calendar-day">23</span>
	</div>
	<div class="textbox-title">
		<h4>
		<a href="read.php-7072.htm" tppabs="http://i.renjihe.com/blog/read.php?7072">原来编译原理可以这么学</a> <span id="starid7072"><img src="unstarred.gif" tppabs="http://i.renjihe.com/blog/template/default/images/others/unstarred.gif" alt="" title="未加星标" border="0"/></span> <img src="blank.gif" tppabs="http://i.renjihe.com/blog/images/weather/blank.gif" alt="不指定" title="不指定"/>
		</h4>
		<div class="textbox-label">
		<a href="view.php-go=user_1.htm" tppabs="http://i.renjihe.com/blog/view.php?go=user_1" target="_blank">renjihe1988</a> , 00:58 , <a href="index.php-go=category_2.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_2" title="查看分类： 软件">软件</a> &raquo; <a href="index.php-go=category_19.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_19" title="查看分类： 编译原理">编译原理</a> , <a href="read.php-7072.htm#reply" tppabs="http://i.renjihe.com/blog/read.php?7072#reply" title="发表您的评论">评论(0)</a> , <a href='javascript: void(0);' title="查看引用地址" onclick='showhidediv("tb7072");'>引用(0)</a> , <a href="read.php-7072.htm" tppabs="http://i.renjihe.com/blog/read.php?7072">阅读(1)</a> , Via 本站原创 
		</div>
	</div>
	<div id="tb7072" style="display: none;" class="textbox-tburl"><strong>引用功能被关闭了。</strong></div>
	
	<div class="textbox-content">
	http://blog.csdn.net/yi_zz/article/details/7418188<br /><br /><h1 style="margin: 0px; padding: 0px; color: #333333; font-family: Arial; line-height: 26px"><span style="font-size: 18px; font-weight: normal">最近对数据结构的研究又有了进展，挺好玩的，总结这些内容的同时，希望也能帮助到大家，这样的话，达到双赢，这才是写博客的目的，接下来我们来轻松学习编译原理，不要被这些纸老虎吓着了。我们一步步来看到底是怎么个情况，该怎么学习呢。。。</span></h1><div style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px">其实这部分内容在我上课的时候，是特别头疼的，不知道老师讲的什么，但是经过自己分析琢磨，感觉还好，能分析的差不多，所以就跟大家分享一下：</span></div><h1 style="margin: 0px; padding: 0px; color: #333333; font-family: Arial; line-height: 26px"><a style="color: #336699" name="t1"></a>文法：</h1><h1 style="margin: 0px; padding: 0px; color: #333333; font-family: Arial; line-height: 26px"><a style="color: #336699" name="t2"></a><span style="font-weight: normal"><span style="font-size: 18px">我们学习文法主要是认识到这几个方面：</span></span></h1><h1 style="margin: 0px; padding: 0px; color: #333333; font-family: Arial; line-height: 26px"><a style="color: #336699" name="t3"></a><span style="font-size: 18px">终结符和非终结符：</span></h1><div style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px">其实这个特别简单，我们来看个例子就懂了：</span></div><div style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px">S-&gt;Ap</span></div><div style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px">S-&gt;Bq</span></div><div style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px">A-&gt;a</span></div><div style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px">A-&gt;cA</span></div><div style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px">B-&gt;b</span></div><div style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px">B-&gt;dB</span></div><div style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 16px">这其中我们看到的，S为开始符，S,A,B为非终结符，在左边，可以推导出一个式子来。而p,q,a,b,c,d为终结符。其实咱们一点都不用记，应该太简单了，你这样想，S（start）也是一个非终结符，然后大写的为非终结符，小写的为终结符，那么这个概念就一点难度都没有了</span><span style="font-size: 18px">。</span></div><div style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 24px"><strong><br /></strong></span></div><div style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 24px"><strong>文法的类型：</strong></span></div><div style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px">主要是要求咱们判断这几个文法的类型。</span></div><div style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px"><strong>0型文法：</strong></span></div><div style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 16px">0型文法是这几个文法中，限制最少的一个，所以见到的至少是0型文法。G=(Vn,Vt,P,S),其中我们得知道，Vn是非终结符的集合，Vt是终结符的集合，P是推导式的一个集合，S是开始符。我们从图来慢慢分析：</span></div><div style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 12px"><img style="border: none; max-width: 100%" src="read-2.php-432.png" tppabs="http://my.csdn.net/uploads/201204/06/1333641635_3838.jpg" border="0" /><br /></span></div><div style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 16px">我们从图中来阐述一下这些概念，S,A,B为Vn，而p,q,a,b,c,d,为Vt,S为开始符。整个集合为P。</span></div><div style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 16px">我们每个式子里边的左边必须要包含这些元素或者元素组合中的至少一个非终结符，右边可以是这些元素的任意组合。我想这样可能好理解一些，这样我们什么公式都不需要记住了，左边有非终结符，右边有终结符，就OK。如：</span></div><div style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px">A-&gt;ab。</span></div><div style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 16px"><br /></span></div><div style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><p>&nbsp;</p></div><div style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px"><strong>1型文法：</strong></span></div><div style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 16px">也叫上下文有关文法；这个1型文法理解起来也没有多大的难度；在0型文法的基础上，我们再添加一点点的限制就行了，我们看添加了什么限制：</span></div><div style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 16px">右边的长度&gt;=左边的长度，这个长度咱们可以这么来理解，就是这些字符的数量，小的推出大的或者相等的。这样就没有难度了。比如：</span></div><div style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 16px">A-&gt;B，A-&gt;Bba &nbsp;都符合要求，那么反过来，Bba-&gt;A就不符合要求了，因为左边是3，右边是1。看图：<img style="border: none; max-width: 100%" src="read-2.php-385.png" tppabs="http://my.csdn.net/uploads/201204/06/1333646302_8987.jpg" border="0" /></span></div><div style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 16px"><br /></span></div><div style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 16px"><br /></span></div><div style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><strong><span style="font-size: 18px">2型文法：</span></strong></div><div style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px">叫上下文无关文法。2型文法在1型文法的基础上，我们规定2型文法中，左边必须是非终结符，然而一个终结符一个非终结符的组合不是一个非终结符，如Ab不是一个非终结符，但是两个非终结符的组合就是一个非终结符了，如AB就是行了。</span></div><div style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px">那么应该是这样的：</span></div><div style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px"><strong>aB-&gt;abc就不符合要求，但是AB-&gt;abc就符合要求了。<img style="border: none; max-width: 100%" src="read-2.php-374.png" tppabs="http://my.csdn.net/uploads/201204/06/1333646374_6293.jpg" border="0" /></strong></span></div><div style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px"><strong><br /></strong></span></div><div style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px"><strong><br /></strong></span></div><div style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><strong><span style="font-size: 18px">3型文法:</span></strong></div><div style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px">也叫正规文法，对应有限状态自动机。在2型文法的基础上再加限制。要求更加高。</span></div><div style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px">要么一个非终结符推出一个终结符，要么一个非终结符推出一个终结符并且带一个非终结符。同时说这是一个文法当中的。那么这种属于3型文法，</span></div><div style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px"><img style="border: none; max-width: 100%" src="read-2.php-373.png" tppabs="http://my.csdn.net/uploads/201204/06/1333645879_2883.jpg" border="0" /></span></div><div style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px">这右线性与左线性是相互独立的，我们来看例子。</span></div><div style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 24px"><strong><img style="border: none; max-width: 100%" src="read-2.php-304.png" tppabs="http://my.csdn.net/uploads/201204/06/1333645773_4786.jpg" border="0" /><br /></strong></span></div><div style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 16px">你不能一会写一下右线性一会写一下左线性，这样拼凑在一起就构成不了3型文法了。要写就只写右线性，或者只写左线性，不能一块来，分开来就对了。</span></div><div style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px">那么这几个文法的关系应该是：<img style="border: none; max-width: 100%" src="read-2.php-259.png" tppabs="http://my.csdn.net/uploads/201204/06/1333647126_1989.jpg" border="0" /></span></div><div style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px">接下来我们来实战一下，锻炼一下我们的基础。</span></div><div style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px">我们来做一个题目:</span></div><div style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><strong><span style="font-size: 24px">实战：</span></strong></div><div style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 12px"><img style="border: none; max-width: 100%" src="read-2.php-229.png" tppabs="http://my.csdn.net/uploads/201204/06/1333646952_4850.jpg" border="0" /><br /></span></div><div style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px">1、我们分开来写，应该是：A-&gt;e &nbsp; A-&gt;aB &nbsp; B-&gt;Ab &nbsp;B-&gt;a</span></div><div style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px">2、我们先来判断是否符合0型文法：0型文法规定左边必须有非终结符，那么这些都是符合的。</span></div><div style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px">3、我们再来看是否符合1型文法：1型文法规定从小推到大。也符合。</span></div><div style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px">4、我们再来看是否符合2型文法：2型文法规定左边必须是非终结符，也满足。</span></div><div style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px">5、我们继续看是否符合3型文法：规定只能符合右线性或者左线性，那么前面一个应该是符合右线性的，后面一个是符合左线性的。所以综合起来就不符合3型文法了。</span></div><div style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px">得出结论：那么这个题目属于2型文法。</span></div><div style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><br /></div><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><strong><span style="font-size: 24px">正规式：</span></strong></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><strong><span style="font-size: 18px">正规式与正规文法之间的转换：</span></strong></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px">我们要掌握的三个规则，咱们看一张表就能明确了</span><span style="font-size: 18px">：</span></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px"><img style="border: none; max-width: 100%" src="read-2.php-222.png" tppabs="http://my.csdn.net/uploads/201204/06/1333711868_7821.jpg" border="0" /><br /></span></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px">我们来分析一下这些规则；</span></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px">规则1：文法产生式（A&mdash;&gt;xB,B-&gt;y ），正规式（A=xy）。对于这个文法产生式转换成正规式，我觉得就是一个代入的过程，把B=y代入A-&gt;xB即可得出正规式。反过来，正规式转换成文法产生式，则添加一个变量就搞定了。</span></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px">规则2：这个式子里边有一个递归，A&mdash;&gt;xA，这样就产生递归了，应该是这样的：A-&gt;x<span style="color: #ff0000">A</span>,<span style="color: #ff0000">A</span>-&gt;x<span style="color: #3333ff">A</span>&hellip;&hellip;这样的无穷下去，最终A还是要等于y的，所以x就有无穷多个，从0个到无穷多个，所以这个推导出来的正规式就是A=x*y，表明x有无穷多个。</span></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px">规则3：A&mdash;&gt;x,A-&gt;y。那么A=x&#124;y。这个就很简单了。A退出x或者y。</span></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px">我们接下来来看看有限自动机：</span></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px"><br /></span></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><strong><span style="font-size: 24px">NFA与DFA的定义：</span></strong></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px">DFA:确定的有限自动机</span></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px">M=(S,E,f,So,Z)，我们来分析分析这个五元组：</span></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px">S是一个有限状态集合；</span></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px">E就是一个输入字符；</span></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px">f是一个SxE至S的映射；</span></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px">So：初态；</span></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px">Z:终态。</span></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px">我们来看看具体的例子，光是理论和概念的东西最不好理解，来看看例子吧：</span></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px">DFA=(&#123;S,A,B,C,f&#125;,&#123;1,0&#125;,F,S,&#123;f&#125;),</span></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px">我们对照上面式子就能看的出来各个元素代表的意义，我们再来分析一遍：</span></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px">&#123;S,A,B,C,f&#125;是一个状态集合；&#123;1,0&#125;是输入字符；F是一个映射，S是初态，&#123;f&#125;是一个终态。</span></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px">那么我们接下来看这些映射：</span></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px">K（S,0）=B,K(S,1)=A,K(A,0)=f,K(A,1)=C,K(B,0)=C,K(B,1)=f,k(C,1)=f;</span></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px">我们根据这个流程，就有了这么一张图：</span></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px"><img style="border: none; max-width: 100%" src="read-2.php-221.png" tppabs="http://my.csdn.net/uploads/201204/09/1333902149_7639.jpg" border="0" /><br /></span></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px"><br /></span></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px">然后再看看NFA的定义：</span></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px">M=(S,E,f,So,Z) 这个五元组跟DFA的定义一样。</span></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px">编译原理还有这两个的转换，我们在后面的博客中慢慢完善吧~</span></p><div><span style="font-size: 18px"><br /></span></div>
	</div>
	<div class="textbox-bottom">
	</div>
	<div class="tags" style="display: none"> 
	</div>
</div><div class="textbox">
	<div class="textbox-calendar">
	<span class="textbox-calendar-month">Jan</span>
	<span class="textbox-calendar-day">23</span>
	</div>
	<div class="textbox-title">
		<h4>
		<a href="read.php-7071.htm" tppabs="http://i.renjihe.com/blog/read.php?7071">代码之美--简单正则表达式匹配器实现</a> <span id="starid7071"><img src="unstarred.gif" tppabs="http://i.renjihe.com/blog/template/default/images/others/unstarred.gif" alt="" title="未加星标" border="0"/></span> <img src="blank.gif" tppabs="http://i.renjihe.com/blog/images/weather/blank.gif" alt="不指定" title="不指定"/>
		</h4>
		<div class="textbox-label">
		<a href="view.php-go=user_1.htm" tppabs="http://i.renjihe.com/blog/view.php?go=user_1" target="_blank">renjihe1988</a> , 00:57 , <a href="index.php-go=category_2.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_2" title="查看分类： 软件">软件</a> &raquo; <a href="index.php-go=category_19.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_19" title="查看分类： 编译原理">编译原理</a> , <a href="read.php-7071.htm#reply" tppabs="http://i.renjihe.com/blog/read.php?7071#reply" title="发表您的评论">评论(0)</a> , <a href='javascript: void(0);' title="查看引用地址" onclick='showhidediv("tb7071");'>引用(0)</a> , <a href="read.php-7071.htm" tppabs="http://i.renjihe.com/blog/read.php?7071">阅读(1)</a> , Via 本站原创 
		</div>
	</div>
	<div id="tb7071" style="display: none;" class="textbox-tburl"><strong>引用功能被关闭了。</strong></div>
	
	<div class="textbox-content">
	<h4 style="font-size: 1.15em; line-height: 1.3em; margin: 0px 0px 0.25em; padding: 0px; font-family: Helvetica, Tahoma, Arial, sans-serif" class="beTitle">代码之美&mdash;&mdash;30行代码实现正则表达式匹配器</h4><div class="bvMsg" style="font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; line-height: 25.2000007629395px"><div>Rob Pike在《The Practice of Programming》中使用约30行代码，实现了一个正则表达式匹配器，用来处理以下的模型。<table border="1"><tbody><tr><td style="font-size: 1em">字符</td><td style="font-size: 1em">含义</td></tr><tr><td style="font-size: 1em">c</td><td style="font-size: 1em">匹配认字的字母c</td></tr><tr><td style="font-size: 1em">.(句点)</td><td style="font-size: 1em">匹配任意的单个字符</td></tr><tr><td style="font-size: 1em">^</td><td style="font-size: 1em">匹配输入字符串的开头</td></tr><tr><td style="font-size: 1em">$</td><td style="font-size: 1em">匹配输入字符串的结尾</td></tr><tr><td style="font-size: 1em">*</td><td style="font-size: 1em">匹配前一个字符的零个或者多个出现</td></tr></tbody></table></div><div>&nbsp;这段代码紧凑、优雅，高效并且实用,同时展示了C指针的强大功能。</div><div class="dp-highlighter" style="font-family: Monaco, 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', Consolas, 'Courier New', monospace; font-size: 12px; width: 679px; overflow: auto; margin-left: 9px; padding: 1px; word-break: break-all; word-wrap: break-word; background-color: transparent"><div class="bar"><div class="tools" style="padding: 3px; margin: 0px; font-weight: bold">C代码&nbsp;&nbsp;<a style="color: #108ac6; text-decoration: underline" title="收藏这段代码"><img style="border: 0px" class="star" src="read-1.php-126" tppabs="http://hexlee.iteye.com/images/icon_star.png" border="0" alt="收藏代码" /></a></div></div><ol class="dp-cpp" style="font-size: 1em; line-height: 1.4em; margin: 0px 0px 1px; padding: 2px 0px; border: 1px solid #d1d7dc; color: #2b91af"><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: #d1d7dc; line-height: 18px; background-color: #fafafa"><span style="color: black"><span style="padding: 0px; margin: 0px; width: auto; border: 0px; color: #008200" class="comment">/*match&nbsp;:在text中查找regexp*/</span>&nbsp;&nbsp;</span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: #d1d7dc; line-height: 18px; background-color: #fafafa"><span style="color: black"><span style="font-weight: bold; color: #2e8b57" class="datatypes">int</span>&nbsp;match(<span style="font-weight: bold; color: #2e8b57" class="datatypes">char</span>&nbsp;*regexp,<span style="font-weight: bold; color: #2e8b57" class="datatypes">char</span>&nbsp;*text)&nbsp;&nbsp;</span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: #d1d7dc; line-height: 18px; background-color: #fafafa"><span style="color: black">&#123;&nbsp;&nbsp;</span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: #d1d7dc; line-height: 18px; background-color: #fafafa"><span style="color: black">&nbsp;<span style="font-weight: bold; color: #7f0055" class="keyword">if</span>(regexp[0]&nbsp;==&nbsp;<span style="color: blue" class="string">'^'</span>)&nbsp;&nbsp;</span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: #d1d7dc; line-height: 18px; background-color: #fafafa"><span style="color: black">&nbsp;&nbsp;<span style="font-weight: bold; color: #7f0055" class="keyword">return</span>&nbsp;matchhere(regexp+1,text);&nbsp;&nbsp;</span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: #d1d7dc; line-height: 18px; background-color: #fafafa"><span style="color: black">&nbsp;<span style="font-weight: bold; color: #7f0055" class="keyword">do</span>&#123;&nbsp;<span style="padding: 0px; margin: 0px; width: auto; border: 0px; color: #008200" class="comment">/*即使字符串为空也必须检查*/</span>&nbsp;&nbsp;</span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: #d1d7dc; line-height: 18px; background-color: #fafafa"><span style="color: black">&nbsp;&nbsp;<span style="font-weight: bold; color: #7f0055" class="keyword">if</span>&nbsp;(matchhere(regexp,text))&nbsp;&nbsp;</span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: #d1d7dc; line-height: 18px; background-color: #fafafa"><span style="color: black">&nbsp;&nbsp;&nbsp;<span style="font-weight: bold; color: #7f0055" class="keyword">return</span>&nbsp;1;&nbsp;&nbsp;</span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: #d1d7dc; line-height: 18px; background-color: #fafafa"><span style="color: black">&nbsp;&#125;<span style="font-weight: bold; color: #7f0055" class="keyword">while</span>&nbsp;(*text++!=&nbsp;<span style="color: blue" class="string">'&#92;0'</span>);&nbsp;&nbsp;</span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: #d1d7dc; line-height: 18px; background-color: #fafafa"><span style="color: black">&nbsp;<span style="font-weight: bold; color: #7f0055" class="keyword">return</span>&nbsp;0;&nbsp;&nbsp;</span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: #d1d7dc; line-height: 18px; background-color: #fafafa"><span style="color: black">&#125;&nbsp;&nbsp;</span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: #d1d7dc; line-height: 18px; background-color: #fafafa"><span style="color: black"><span style="padding: 0px; margin: 0px; width: auto; border: 0px; color: #008200" class="comment">/*matchhere在text的开头查找regexp*/</span>&nbsp;&nbsp;</span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: #d1d7dc; line-height: 18px; background-color: #fafafa"><span style="color: black"><span style="font-weight: bold; color: #2e8b57" class="datatypes">int</span>&nbsp;matchhere(<span style="font-weight: bold; color: #2e8b57" class="datatypes">char</span>&nbsp;*regexp,<span style="font-weight: bold; color: #2e8b57" class="datatypes">char</span>&nbsp;*text)&nbsp;&nbsp;</span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: #d1d7dc; line-height: 18px; background-color: #fafafa"><span style="color: black">&#123;&nbsp;&nbsp;</span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: #d1d7dc; line-height: 18px; background-color: #fafafa"><span style="color: black">&nbsp;<span style="font-weight: bold; color: #7f0055" class="keyword">if</span>&nbsp;(regexp[0]&nbsp;==&nbsp;<span style="color: blue" class="string">'&#92;0'</span>)&nbsp;&nbsp;</span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: #d1d7dc; line-height: 18px; background-color: #fafafa"><span style="color: black">&nbsp;&nbsp;<span style="font-weight: bold; color: #7f0055" class="keyword">return</span>&nbsp;1;&nbsp;&nbsp;</span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: #d1d7dc; line-height: 18px; background-color: #fafafa"><span style="color: black">&nbsp;<span style="font-weight: bold; color: #7f0055" class="keyword">if</span>&nbsp;(regexp[1]&nbsp;==&nbsp;<span style="color: blue" class="string">'*'</span>)&nbsp;&nbsp;</span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: #d1d7dc; line-height: 18px; background-color: #fafafa"><span style="color: black">&nbsp;&nbsp;<span style="font-weight: bold; color: #7f0055" class="keyword">return</span>&nbsp;matchstar(regexp[0],regexp+2,text);&nbsp;&nbsp;</span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: #d1d7dc; line-height: 18px; background-color: #fafafa"><span style="color: black">&nbsp;<span style="font-weight: bold; color: #7f0055" class="keyword">if</span>&nbsp;(regexp[0]&nbsp;==&nbsp;<span style="color: blue" class="string">'$'</span>&nbsp;&amp;&amp;&nbsp;regexp[1]==<span style="color: blue" class="string">'&#92;0'</span>)&nbsp;&nbsp;</span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: #d1d7dc; line-height: 18px; background-color: #fafafa"><span style="color: black">&nbsp;&nbsp;<span style="font-weight: bold; color: #7f0055" class="keyword">return</span>&nbsp;*text&nbsp;==&nbsp;<span style="color: blue" class="string">'&#92;0'</span>;&nbsp;&nbsp;</span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: #d1d7dc; line-height: 18px; background-color: #fafafa"><span style="color: black">&nbsp;<span style="font-weight: bold; color: #7f0055" class="keyword">if</span>&nbsp;(*text!=<span style="color: blue" class="string">'&#92;0'</span>&nbsp;&amp;&amp;&nbsp;(regexp[0]==<span style="color: blue" class="string">'.'</span>&nbsp;&#124;&#124;&nbsp;regexp[0]==*text))&nbsp;&nbsp;</span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: #d1d7dc; line-height: 18px; background-color: #fafafa"><span style="color: black">&nbsp;&nbsp;<span style="font-weight: bold; color: #7f0055" class="keyword">return</span>&nbsp;matchhere(regexp+1,text+1);&nbsp;&nbsp;</span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: #d1d7dc; line-height: 18px; background-color: #fafafa"><span style="color: black">&nbsp;<span style="font-weight: bold; color: #7f0055" class="keyword">return</span>&nbsp;0;&nbsp;&nbsp;</span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: #d1d7dc; line-height: 18px; background-color: #fafafa"><span style="color: black">&#125;&nbsp;&nbsp;</span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: #d1d7dc; line-height: 18px; background-color: #fafafa"><span style="color: black"><span style="padding: 0px; margin: 0px; width: auto; border: 0px; color: #008200" class="comment">/*matchstar&nbsp;:在text的开头查找C*regexp*/</span>&nbsp;&nbsp;</span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: #d1d7dc; line-height: 18px; background-color: #fafafa"><span style="color: black"><span style="font-weight: bold; color: #2e8b57" class="datatypes">int</span>&nbsp;matchstar&nbsp;(<span style="font-weight: bold; color: #2e8b57" class="datatypes">int</span>&nbsp;c,<span style="font-weight: bold; color: #2e8b57" class="datatypes">char</span>&nbsp;*regexp,<span style="font-weight: bold; color: #2e8b57" class="datatypes">char</span>&nbsp;*text)&nbsp;&nbsp;</span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: #d1d7dc; line-height: 18px; background-color: #fafafa"><span style="color: black">&#123;&nbsp;&nbsp;</span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: #d1d7dc; line-height: 18px; background-color: #fafafa"><span style="color: black">&nbsp;<span style="font-weight: bold; color: #7f0055" class="keyword">do</span>&nbsp;&#123;&nbsp;<span style="padding: 0px; margin: 0px; width: auto; border: 0px; color: #008200" class="comment">/*通配符*匹配零个或多个实例*/</span>&nbsp;&nbsp;</span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: #d1d7dc; line-height: 18px; background-color: #fafafa"><span style="color: black">&nbsp;&nbsp;<span style="font-weight: bold; color: #7f0055" class="keyword">if</span>&nbsp;(matchhere(regexp,text))&nbsp;&nbsp;</span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: #d1d7dc; line-height: 18px; background-color: #fafafa"><span style="color: black">&nbsp;&nbsp;&nbsp;<span style="font-weight: bold; color: #7f0055" class="keyword">return</span>&nbsp;1;&nbsp;&nbsp;</span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: #d1d7dc; line-height: 18px; background-color: #fafafa"><span style="color: black">&nbsp;&#125;<span style="font-weight: bold; color: #7f0055" class="keyword">while</span>&nbsp;(*text!=<span style="color: blue" class="string">'&#92;0'</span>&nbsp;&amp;&amp;&nbsp;(*text++&nbsp;==c&nbsp;&#124;&#124;&nbsp;c==&nbsp;<span style="color: blue" class="string">'.'</span>));&nbsp;&nbsp;</span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: #d1d7dc; line-height: 18px; background-color: #fafafa"><span style="color: black">&nbsp;<span style="font-weight: bold; color: #7f0055" class="keyword">return</span>&nbsp;0;&nbsp;&nbsp;</span></li><li style="font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left-width: 1px; border-left-style: solid; border-left-color: #d1d7dc; line-height: 18px; background-color: #fafafa"><span style="color: black">&#125;&nbsp;&nbsp;</span></li></ol></div><div>今天边晒太阳，边看《代码之美》，体会大师思想，真是种不错的享受！</div><div>摘自书上原文，有网友已经做好，故转载之~&nbsp;</div><div>来源：<a style="color: #108ac6" href="javascript:if(confirm('http://fuweilin.spaces.live.com/Blog/read.php?121  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://fuweilin.spaces.live.com/Blog/read.php?121'" tppabs="http://fuweilin.spaces.live.com/Blog/cns!3E188C10114C8655!531.entry">http://fuweilin.spaces.live.com/Blog/cns!3E188C10114C8655!531.entry</a></div></div>
	</div>
	<div class="textbox-bottom">
	</div>
	<div class="tags" style="display: none"> 
	</div>
</div><div class="textbox">
	<div class="textbox-calendar">
	<span class="textbox-calendar-month">Jan</span>
	<span class="textbox-calendar-day">23</span>
	</div>
	<div class="textbox-title">
		<h4>
		<a href="read.php-7070.htm" tppabs="http://i.renjihe.com/blog/read.php?7070">正则表达式匹配也可以简单快速(下：实现部分)</a> <span id="starid7070"><img src="unstarred.gif" tppabs="http://i.renjihe.com/blog/template/default/images/others/unstarred.gif" alt="" title="未加星标" border="0"/></span> <img src="blank.gif" tppabs="http://i.renjihe.com/blog/images/weather/blank.gif" alt="不指定" title="不指定"/>
		</h4>
		<div class="textbox-label">
		<a href="view.php-go=user_1.htm" tppabs="http://i.renjihe.com/blog/view.php?go=user_1" target="_blank">renjihe1988</a> , 00:57 , <a href="index.php-go=category_2.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_2" title="查看分类： 软件">软件</a> &raquo; <a href="index.php-go=category_19.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_19" title="查看分类： 编译原理">编译原理</a> , <a href="read.php-7070.htm#reply" tppabs="http://i.renjihe.com/blog/read.php?7070#reply" title="发表您的评论">评论(0)</a> , <a href='javascript: void(0);' title="查看引用地址" onclick='showhidediv("tb7070");'>引用(0)</a> , <a href="read.php-7070.htm" tppabs="http://i.renjihe.com/blog/read.php?7070">阅读(1)</a> , Via 本站原创 
		</div>
	</div>
	<div id="tb7070" style="display: none;" class="textbox-tburl"><strong>引用功能被关闭了。</strong></div>
	
	<div class="textbox-content">
	http://www.lofter.com/postentry?from=search&amp;permalink=1d133179_6759ec4<br /><br /><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">转载请注明译者：<a style="cursor: pointer; text-decoration: none; color: #444444; outline: none" rel="nofollow" href="mailto:phylips@bmy" target="_blank">phylips@bmy</a>&nbsp;出处：<a style="cursor: pointer; text-decoration: none; color: #444444; outline: none" href="javascript:if(confirm('http://duanple.blog.163.com/blog/static/7097176720099402916150/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://duanple.blog.163.com/blog/static/7097176720099402916150/'" tppabs="http://duanple.blog.163.com/blog/static/7097176720099402916150/" target="_blank">http://duanple.blog.163.com/blog/static/7097176720099402916150/</a></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">&nbsp;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><strong>实现</strong></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">Thompson在1968年的论文里对多状态模拟策略进行了介绍。在他的文章里，NFA的状态是使用机器码序列来表示的，可能状态列表仅仅是一系列的函数调用指令。实际上，Thompson将正则表达式编译成了机器码。四十年后，计算机已经变得很快了，所以机器码的这种方法变得不太必要了。下面的章节里介绍一种使用标准c的实现。完整的源代码(少于400行)和测试脚本在这里(http://swtch.com/~rsc/regexp/)。</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><strong>实现：编译成NFA</strong></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">第一步就是把正则表达式编译成等价的NFA。在我们的c程序里，我们使用一个带指针的结构体来表示NFA。</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">struct State</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">&#123;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">int c;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">State *out;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">State *out1;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">int lastlist;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">&#125;;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">每个状态可以用来代表下面的三个NFA片段，取决于c的值(lastlist是执行时使用的，下面还会解释)</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><a style="cursor: pointer; text-decoration: none; color: #444444; outline: none" href="javascript:if(confirm('http://img458.ph.126.net/LStNSeXniyrhrEM0LIAoZw==/read.php?117  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://img458.ph.126.net/LStNSeXniyrhrEM0LIAoZw==/read.php?117'" tppabs="http://img458.ph.126.net/LStNSeXniyrhrEM0LIAoZw==/1015843190949550943.jpg" target="_blank"><img style="border: 0px" src="read-1.php-117" tppabs="http://img458.ph.126.net/LStNSeXniyrhrEM0LIAoZw==/1015843190949550943.jpg" border="0" alt="正则表达式匹配也可以简单快速(下：实现部分) - 星星 - 银河里的星星" title="正则表达式匹配也可以简单快速(下：实现部分) - 星星 - 银河里的星星" /></a></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">根据Thomspon的论文，编译器从一个正则表达式的前缀形式开始构建NFA，对于连接通过增加一个&quot;.&quot;来将该运算以运算符的形式显示化。通过一个独立函数re2post将中缀正则表达式比如&quot;a(bb)+a&quot;转换成后缀表达式&quot;abb.+.a.&quot;。(一个实际的实现并不需要用&ldquo;.&rdquo;来代替连接字符。一个实际的实现也可能解析的同时构建NFA而不是构建一个显示的后缀表达式。然而，后缀版本更加方便也更接近Thompson的论文)当编译器扫描后缀表达式的时候，它用过一个栈来维护一个已经计算好的NFA片段。Literals push new NFA&nbsp;fragments onto the stack, while operators pop fragments off the stack and then push a new&nbsp;fragment. 比如，编译好abb.+.a.中的abb之后，栈里包含a,b和b的NFA片段。然后编译&quot;.&quot;,这时需要将两个b的NFA片段从栈里pop出来，然后将bb.的NFA片段压入栈。<strong>每个NFA片段是由开始状态和输出指针组成的</strong>：</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">struct Frag</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">&#123;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">State *start;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">Ptrlist *out;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">&#125;;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">对于片段来说，start是开始节点，out是一系列指向未链接到任何东西的状态指针的列表的指针。NFA片段里存在一些悬空指针。</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">下面这些辅助函数可以帮助控制指针链表：</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">Ptrlist *list1(State **outp);</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">Ptrlist *append(Ptrlist *l1, Ptrlist *l2);</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">void patch(Ptrlist *l, State *s);</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">list1创建一个新指针列表包括outp指针的。append将两个指针列表连接起来，并返回结果。patch将list1中的悬空指针连接使它们指向状态s：对于l里的每个指针outp,它设置*outp = s。</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">给定上面这些基础内容及片段栈，编译过程实际上是一个在后缀表达式串上的简单循环。处理到最后只剩下一个单片段：添加一个匹配状态就完成了NFA的构建。</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">State*</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">post2nfa(char *postfix)</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">&#123;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">char *p;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">Frag stack[1000], *stackp, e1, e2, e;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">State *s;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">#define push(s) *stackp++ = s</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">#define pop() &nbsp; *--stackp</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">stackp = stack;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">for(p=postfix; *p; p++)&#123;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">switch(*p)&#123;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">/* compilation cases, described below */</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">&#125;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">&#125;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">e = pop();</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">patch(e.out, matchstate);</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">return e.start;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">&#125;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">下面这些具体的编译实例，模拟了上面所描述的那些转换步骤。</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><a style="cursor: pointer; text-decoration: none; color: #444444; outline: none" href="javascript:if(confirm('http://img458.ph.126.net/1zT1hDWEkvDCrcVE4uVrlQ==/read.php?116  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://img458.ph.126.net/1zT1hDWEkvDCrcVE4uVrlQ==/read.php?116'" tppabs="http://img458.ph.126.net/1zT1hDWEkvDCrcVE4uVrlQ==/1015843190949550977.jpg" target="_blank"><img style="border: 0px" src="read-1.php-116" tppabs="http://img458.ph.126.net/1zT1hDWEkvDCrcVE4uVrlQ==/1015843190949550977.jpg" border="0" alt="正则表达式匹配也可以简单快速(下：实现部分) - 星星 - 银河里的星星" title="正则表达式匹配也可以简单快速(下：实现部分) - 星星 - 银河里的星星" /></a></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">文本字符：</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">default:</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">s = state(*p, NULL, NULL);</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">push(frag(s, list1(&amp;s-&gt;out));</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">break;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">连接：</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">case '.':</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">e2 = pop();</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">e1 = pop();</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">patch(e1.out, e2.start);</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">push(frag(e1.start, e2.out));</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">break;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">选择：</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">case '&#124;':</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">e2 = pop();</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">e1 = pop();</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">s = state(Split, e1.start, e2.start);</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">push(frag(s, append(e1.out, e2.out)));</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">break;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">Zero or one：</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">case '?':</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">e = pop();</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">s = state(Split, e.start, NULL);</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">push(frag(s, append(e.out, list1(&amp;s-&gt;out1))));</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">break;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">Zero or more:</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">case '*':</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">e = pop();</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">s = state(Split, e.start, NULL);</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">patch(e.out, s);</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">push(frag(s, list1(&amp;s-&gt;out1)));</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">break;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">One or more:</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">case '+':</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">e = pop();</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">s = state(Split, e.start, NULL);</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">patch(e.out, s);</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">push(frag(e.start, list1(&amp;s-&gt;out1)));</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">break;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><strong>实现：模拟NFA</strong></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">现在NFA已经构建好了，下面需要模拟执行。这个模拟执行需要追踪状态集，它们被保存到一个简单的链表里：</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">struct List</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">&#123;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">State **s;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">int n;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">&#125;;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">模拟执行使用了两个链表：clist是当前NFA所处在的状态集合，nlist是处理完当前状态NFA下一个将要到达的状态集合。初始时，clist只包含一个开始状态然后每次只在状态机里前进一步。</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">int</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">match(State *start, char *s)</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">&#123;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">List *clist, *nlist, *t;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">/* l1 and l2 are preallocated globals */</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">clist = startlist(start, &amp;l1);</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">nlist = &amp;l2;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">for(; *s; s++)&#123;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">step(clist, *s, nlist);</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">t = clist; clist = nlist; nlist = t; /* swap clist, nlist */</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">&#125;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">return ismatch(clist);</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">&#125;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">为了避免每次循环迭代中分配内存，match用了两个已经预先分配好的链表l1和l2作为clist和nlist,每运行一步就将它们两个交换。如果最终的状态列表中包含匹配状态，那么就说与字符串匹配。</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">int</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">ismatch(List *l)</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">&#123;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">int i;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">for(i=0; i&lt;l-&gt;n; i++)</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">if(l-&gt;s[i] == matchstate)</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">return 1;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">return 0;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">&#125;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">addstate 增加一个状态到列表中，但是如果它已经在列表中了就不用添加了。如果每次添加都需要扫描整个链表会使效率很低；变量listid作为链表的生成数。当给链表添加一个状态s，它记录一个lastid在s-&gt;lastlist里。如果两个相等，那么说明s已经存在于已建立的链表中。addstate也要沿着未标注指针前进：如果s是一个具有两个指向新状态的未标注指针的分离状态，那么addstate增加那两个新状态而不是s到链表中。</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">void</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">addstate(List *l, State *s)</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">&#123;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">if(s == NULL &#124;&#124; s-&gt;lastlist == listid)</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">return;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">s-&gt;lastlist = listid;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">if(s-&gt;c == Split)&#123;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">/* follow unlabeled arrows */</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">addstate(l, s-&gt;out);</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">addstate(l, s-&gt;out1);</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">return;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">&#125;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">l-&gt;s[l-&gt;n++] = s;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">&#125;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">开始链表创建一个初始状态列表通过增加开始状态：</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">List*</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">startlist(State *s, List *l)</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">&#123;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">listid++;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">l-&gt;n = 0;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">addstate(l, s);</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">return l;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">&#125;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">最后，每次读入一个单字符NFA就前进一步，使用当前列表clist来计算下一个列表nlist。</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">void</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">step(List *clist, int c, List *nlist)</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">&#123;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">int i;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">State *s;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">listid++;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">nlist-&gt;n = 0;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">for(i=0; i&lt;clist-&gt;n; i++)&#123;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">s = clist-&gt;s[i];</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">if(s-&gt;c == c)</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">addstate(nlist, s-&gt;out);</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">&#125;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">&#125;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><strong>性能</strong></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">刚才描述的c实现并没有将效率考虑在内。即使如此，一个线性算法也能轻易地在效率上打败一个指数级算法。通过各种流行的正则表达式引擎测试那种病态字符串可以很清楚的看到这点。</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">考虑正则表达式(a?)^na^n。如果a?不匹配任何字符，则它匹配字符串a^n，整个字符串将通过a^n匹配。考虑正则表达式的回溯实现如何实现zero-or-one的&quot;?&quot;,它首先尝试匹配1个然后尝试匹配0个。现在这里有n个这样的选择，这样总共有2^n种可能。但是只有最后一种可能--对所有的?选择0才会导致匹配成功。所以这个回溯实现需要O(2^n)，这样n最多可以扩展到n=25。</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">与此相比，Thompson算法通过维护大概n个状态列表处理字符串，如果字符串的长度也为n，这样总的时间应该是O(n^2)(运行时间是超线性的，因为伴随这输入的增加正则表达式本身并没有再改变。对于一个长为m的正则表达式运行在一个长为n的字符串上，Thompson NFA需要O(mn)时间)。</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">下面的图形画出了(a?)^na^n匹配a^n的时间花费：</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><a style="cursor: pointer; text-decoration: none; color: #444444; outline: none" href="javascript:if(confirm('http://img458.ph.126.net/PtASi_dUzayJJv1SWIRhhQ==/read.php?115  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://img458.ph.126.net/PtASi_dUzayJJv1SWIRhhQ==/read.php?115'" tppabs="http://img458.ph.126.net/PtASi_dUzayJJv1SWIRhhQ==/1015843190949551002.jpg" target="_blank"><img style="border: 0px" src="read-1.php-115" tppabs="http://img458.ph.126.net/PtASi_dUzayJJv1SWIRhhQ==/1015843190949551002.jpg" border="0" alt="正则表达式匹配也可以简单快速(下：实现部分) - 星星 - 银河里的星星" title="正则表达式匹配也可以简单快速(下：实现部分) - 星星 - 银河里的星星" /></a></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">需要注意，为了能够看到在一个图中看到一个宽广的时间跨度，图的y轴不同的位置采用了不同的时间单位。</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">从图中可以明显的看出 Perl, PCRE, Python, and Ruby 都使用了递归回溯。当n=23时，pcre已经无法得到正确答案了，因为经过过多步骤之后它自动终止了递归回溯。在perl5.6里，perl的正则表达式引擎据说采用了备忘录来进行递归回溯搜索，以内存为代价，防止搜索过程花费指数级的时间，当然如果存到反向引用也还是要花指数级时间。正如图中所展示的，备忘录方法是不完全的：即使不存在前向引用，但perl的运行时间仍然是指数级的。尽管这里没有进行测试，实际上java也使用了回溯实现。实际上，java.util.regex接口也需要一个回溯实现，因为这样大量的java代码可以被替换成匹配路径。php使用了pcre库。</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">图中的粗蓝线正是本文中描述的Thompson的c实现。awk，tcl，gnu grep 以及gnu awk构建DFAs，要么预先计算出来要么使用下一节描述的on-the-fly构建方法。</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">有些人可能认为这个测试对于回溯实现不公平，因为它专注于不常见的特例。但是这个观点忽略了一点：给你两个选择，一个实现是可预测，一致对所有的输入都有快速的运行时间，另一个通常很快速但是对于某些输入却需要花上数年的cpu时间，应该选择哪个是很明显的。 Also, while examples as dramatic as this one&nbsp;rarely occur in practice, less dramatic ones do occur. Examples include using (.*) (.*) (.*)&nbsp;(.*) (.*) to split five space-separated fields, or using alternations where the common cases&nbsp;are not listed first.结果，程序员找到哪点开销最大然后再避免它，或者他们使用所谓的优化器。使用Thompson NFA模拟不需要这样的改变，因为它不存在开销巨大的正则表达式。</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><strong>缓存NFA构建DFA</strong></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">DFAs比NFAs效率更高，因为DFAs一次只有一个可选状态，任何NFA可以转换为等价的DFA状态机。比如这里有一个关于abab&#124;abbb的NFA，图中具有状态标号。</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><a style="cursor: pointer; text-decoration: none; color: #444444; outline: none" href="javascript:if(confirm('http://img851.ph.126.net/FbEk6TOV64FewE59LBCmQQ==/read.php?114  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://img851.ph.126.net/FbEk6TOV64FewE59LBCmQQ==/read.php?114'" tppabs="http://img851.ph.126.net/FbEk6TOV64FewE59LBCmQQ==/2720737124885535921.jpg" target="_blank"><img style="border: 0px" src="read-1.php-114" tppabs="http://img851.ph.126.net/FbEk6TOV64FewE59LBCmQQ==/2720737124885535921.jpg" border="0" alt="正则表达式匹配也可以简单快速(下：实现部分) - 星星 - 银河里的星星" title="正则表达式匹配也可以简单快速(下：实现部分) - 星星 - 银河里的星星" /></a></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">等价的DFA是：</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><a style="cursor: pointer; text-decoration: none; color: #444444; outline: none" href="javascript:if(confirm('http://img851.ph.126.net/_iIwfKWCvsLqwZ6y-cRglQ==/read.php?113  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://img851.ph.126.net/_iIwfKWCvsLqwZ6y-cRglQ==/read.php?113'" tppabs="http://img851.ph.126.net/_iIwfKWCvsLqwZ6y-cRglQ==/2720737124885535936.jpg" target="_blank"><img style="border: 0px" src="read-1.php-113" tppabs="http://img851.ph.126.net/_iIwfKWCvsLqwZ6y-cRglQ==/2720737124885535936.jpg" border="0" alt="正则表达式匹配也可以简单快速(下：实现部分) - 星星 - 银河里的星星" title="正则表达式匹配也可以简单快速(下：实现部分) - 星星 - 银河里的星星" /></a></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">DFA里的每个状态对应于NFA里的一系列状态。</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">另一方面，Thompson's NFA模拟执行也可以在等价的DFA上执行：每个列表对于某个DFA状态，函数每计算一步，给定一个列表和下一个字符，下一个DFA状态加入。Thompson算法模拟执行DFA通过需要时重新构建每个DFA状态。不是将这些工作推迟到每一步后面，我们可以将这些lists缓存到内存里，避免重复计算或者必要时计算出等价的DFA形式。这一节提出了这样的一种实现方式。从前面提到的NFA实现，我们只需要添加少于100行代码就可以构造一个DFA实现。</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">为了实现缓存，我们首先引入一种新的数据类型来表示一个DFA状态：</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">struct DState</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">&#123;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">List l;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">DState *next[256];</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">DState *left;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">DState *right;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">&#125;;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">Dstate是链表l的缓存版本。数组next包含每个输入字符对应的指向下一个状态的指针：如果当前状态是d，下一个输入字符是c，那么d-&gt;next[c]就是下一个状态。如果d-&gt;next[c] = null，那么下一个状态就处于未计算状态。nextsate根据一个给定状态和字符来计算，记录返回下一个状态。正则表达式沿着d-&gt;next[c]不断匹配，调用nextstate来计算下一个状态</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">int</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">match(DState *start, char *s)</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">&#123;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">int c;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">DState *d, *next;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">d = start;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">for(; *s; s++)&#123;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">c = *s &amp; 0xFF;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">if((next = d-&gt;next[c]) == NULL)</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">next = nextstate(d, c);</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">d = next;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">&#125;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">return ismatch(&amp;d-&gt;l);</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">&#125;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">All the DStates that have been computed need to be saved in a structure that lets us look up a&nbsp;DState by its List. To do this, we arrange them in a binary tree using the sorted List as the&nbsp;key. The dstate function returns the DState for a given List, allocating one if necessary:</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">DState*</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">dstate(List *l)</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">&#123;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">int i;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">DState **dp, *d;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">static DState *alldstates;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">qsort(l-&gt;s, l-&gt;n, sizeof l-&gt;s[0], ptrcmp);</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">/* look in tree for existing DState */</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">dp = &amp;alldstates;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">while((d = *dp) != NULL)&#123;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">i = listcmp(l, &amp;d-&gt;l);</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">if(i &lt; 0)</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">dp = &amp;d-&gt;left;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">else if(i &gt; 0)</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">dp = &amp;d-&gt;right;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">else</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">return d;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">&#125;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">/* allocate, initialize new DState */</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">d = malloc(sizeof *d + l-&gt;n*sizeof l-&gt;s[0]);</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">memset(d, 0, sizeof *d);</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">d-&gt;l.s = (State**)(d+1);</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">memmove(d-&gt;l.s, l-&gt;s, l-&gt;n*sizeof l-&gt;s[0]);</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">d-&gt;l.n = l-&gt;n;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">/* insert in tree */</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">*dp = d;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">return d;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">&#125;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">nextstate运行NFA step，并返回相应的状态Dstate:</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">DState*</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">nextstate(DState *d, int c)</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">&#123;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">step(&amp;d-&gt;l, c, &amp;l1);</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">return d-&gt;next[c] = dstate(&amp;l1);</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">&#125;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">最后，DFA的开始状态就是NFA的开始列表对于的Dstate</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">DState*</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">startdstate(State *start)</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">&#123;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">return dstate(startlist(start, &amp;l1));</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">&#125;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">(正如在NFA模拟中一样，l1是预分配好的链表)</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">这个DStates是DFA中的状态，但是DFA只有需要时才会建立：如果一个DFA状态搜索过程中并没有碰到，那么它也不会出现在缓存中。另一个变种可能是预先一次计算出所有的DFA。这样做可能可以通过去掉一些条件分支使匹配速度提高一些，但是以启动时间和内存使用为代价。人们可能会担心on-the-fly DFA构建带来的内存花费太大。因为Dstates仅仅是step函数的一个缓存，dstate实现可能选择丢弃目前为止的整个dfa如果缓存需求太大。实现缓存替换策略仅仅需要一些dstate和nextstate中的额外的代码行，加上进行内存管理的50行代码。一个参考实现可以在这里找到：http://swtch.com/~rsc/regexp/(awk使用类似的限制大小的缓存策略，使用一个32个缓存状态；这个也可以说明上图中在n=28时出现的性能转折)</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">NFAS可以表现出很好的局部性：它们访问相同的状态集，沿着相同的转换指针不断的运行。这就使缓存变得很有意义：the first time an arrow is followed, the next state must be computed as in the NFA&nbsp;simulation, but future traversals of the arrow are just a single memory access.实际的基于DFA的实现可以充分使用额外的优化让它运行地更快。还应该有一篇(还未写)文章更加详细的介绍基于DFA的正则表达式匹配实现。</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><strong>现实世界的正则表达式</strong></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">实际程序中的正则表达式使用多少要比我们上面介绍的正则表达式实现要复杂。这一节将简要的介绍下这些普通的实现；当然对于这些的介绍已经超过一篇介绍性的文章所应涉及的内容。</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><strong>字符类</strong>。[0-9] or &#92;w or . 。字符类可以在编译时扩展到选择运算符，尽管如果为他们增加一个新的DFA节点类来表示可能更有效。posix还定义了一些新的字符类比如[[:upper:]]，根据不同的本地化方案具体含义可能有所不同，but the hard part of accommodating these is determining their meaning, not&nbsp;encoding that meaning into an NFA.</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><strong>转义序列</strong>。实际的正则表达式符号需要处理转义序列，一方面是为了匹配元字符，另一方面也是为了表示难以输入的字符比如&#92;n。</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><strong>重复计数</strong>。很多正则表达式实现提供了一个重复计数操作符&#123;n&#125;用来精确匹配n长度字符串；&#123;n,m&#125;用来匹配至少n但是至多m个字符；&#123;n,&#125;用来匹配n个或者更多个字符。递归回溯实现可以通过循环实现重复计数；NFA或者基于DFA的实现必须通过扩展来实现这个重复:e&#123;3&#125;扩展为eee;e&#123;3,5&#125;扩展为eeee?e?,e&#123;3,&#125;扩展成eee+。</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><strong>匹配子表达式提取</strong>。正则表达式是用来分离和解析字符串的，如果能够找到输入字符串中匹配子表达式的那部分，这样会是十分有用的。像这样的正则表达式 ([0-9]+-[0-9]+-[0-9]+) ([0-9]+:[0-9]+)匹配字符串(可能是日期或者时间)，很多正则表达式引擎可以利用括号来进行文本匹配。比如，用perl写的一个匹配：</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">if(/([0-9]+-[0-9]+-[0-9]+) ([0-9]+:[0-9]+)/)&#123;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">print &quot;date: $1, time: $2&#92;n&quot;;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">&#125;</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">子匹配的边界提取这个问题并没有被计算机科学理论研究者所重视，同时这个问题也是使用递归回溯的最强烈的原因。然而，Thompson类型的算法可以被改进以记录子匹配的边界同时也不需要放弃性能。第八版的unix regexp库已经早在1985年实现了这个算法，正如下面所解释的，这个特性并没有被广泛的使用或者被人注意到。</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><strong>无锚点匹配</strong>。这个文章假设正则表达式与整个字符串匹配。实际中，人们只是希望能够找到输入的一个子字符串与正则表达式匹配。传统的unix工具总是返回输入中的最左最长匹配。对于e的无锚点匹配实际上可以看成匹配子表达式提取的特殊情况：就等价于搜索.*(e).* 同时要求第一个.*的匹配要尽可能的短。</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><strong>非贪婪操作符</strong>。在传统的unix正则表达式里，重复操作符?, *, and + 定义成匹配尽可能长的字符串。比如用(.+)(.+) 匹配 abcd，第一个(.+)匹配abc，第二个匹配d。这些操作符被称为贪婪的。perl引入了??,&nbsp;*?, and +? 作为它们对应的非贪婪版本，可以匹配尽可能少的字符：比如 (.+?)(.+?) 匹配abcd，第一个(.+?)匹配a，第二个匹配bcd。通过定义，操作符是否是贪婪的并不影响正则表达式与字符串是否匹配，它仅仅影响到匹配的边界。回溯算法可以产生非贪婪操作符的一个简单实现：总是首先尝试较短的那个匹配。比如在一个标准回溯实现里，e?首先尝试使用e然后尝试不使用它；e??采用另一个顺序。Thompson算法的子匹配变种可以简单的应用到非贪婪操作符。</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><strong>断言</strong>。传统的正则表达式元字符^和$可以看做是它们旁边的文本的断言：^表示前一个字符是换行(或者是字符串的开始)，$表示下一个字符是换行(或者是字符串的末尾)。perl增加了更多的断言，比如字边界&#92;b，表示前一个字符是字母或者数字，但是下一个不是。perl也将这个想法继续扩展，叫做前向断言：(?=re)表明当前输入位置后面的文本匹配re，但是实际上并不将输入位置前移；(?!re)与之类似，但是它是用来说明文本不匹配re的。前向断言(?&lt;=re) and (?&lt;!re)类似，但是它们是用来表示与当前输入位置之前的文本的匹配关系的。简单断言，比如^, $, and &#92;b，很容易在NFA里表示，对于前向匹配只需要延续一个字节即可。一般化的断言虽然很难表示，但是通过一定的方法也可以编码在NFA里。</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><strong>前向引用</strong>。正如前面提到的，没有人知道怎么有效的实现带有前向引用的正则表达式，也没有人可以证明它是不可能的(特别的，这个问题是NP完全的，意味着如果有人发现了一个有效的实现，那么这将是计算机科学的一个大新，并可以获得百万奖励)。对于前向引用来说，最简单也是最有效的策略就是awk和egrep采用的，就是不实现它们。但是这个策略也不再实用了，在某些应用中用户已经开始依赖于前向引用，而且前向引用也是posix标准正则表达式的一部分。即使如此，我们也可以对大部分正则表达式使用Thompson的NFA模拟，只在需要时再使用回溯。一个特殊的聪明的实现可以将它们结合，只有使用前向引用时再使用回溯。</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><strong>记忆化回溯</strong>。perl的策略使用了记忆化来避免指数级的回溯。至少理论上，应该让perl的正则表达式表现地更像NFA，而不是回溯。记忆化并没有完全解决这个问题，记忆化本身需要等价于文本串长度(可能是正则串的数倍)的内存空间。记忆化也不能减少递归回溯需要的栈空间，这个大小与文本串大小是线性的。匹配一个长字符串就可能导致回溯实现栈空间溢出。</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">$ perl -e '(&quot;a&quot; x 100000) =~ /^(ab?)*$/;'</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">Segmentation fault (core dumped)</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">$</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><strong>字符集</strong>。现代正则表达式实现比较处理大量的非ansii字符集，比如unicode。Plan 9的正则表达式库包含了nicode，每次运行NFA通过一个unicode字符作为输入字符。库将NFA的运行与输入的解码分离，这样相同的正则表达式匹配码即可以用于utf-8也可以用于宽字符输入。</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><strong>历史及引用</strong></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">Michael Rabin and Dana Scott在1959年的论文里[7]介绍了非确定性有限自动机和非确定性的概念，指出NFAs可以使用DFAs模拟，每个DFA状态应一系列的NFA状态集。(由于他们论文中提出的非确定性的概念，获得了1976年的图灵奖)。</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">R. McNaughton and H. Yamada [4] and Ken Thompson [9] 给出了正则表达式向NFAs转换的第一个实现，即使那篇文章中并没有提到NFA的概念。McNaughton and Yamada的实现创建了DFA，Thompson的实现使用了IBM 7094机器码。正则表达式向NFA转换的区别仅仅在如何进行编码。上面使用的方法，在编码时使用了显示的节点和未标注指针。一个改进方法，也是最常用的是由 McNaughton and Yamada发明的，可以避免未标号指针，不允许NFA具有多个具有相同标注的输出指针。McIlroy在Haskell里给出了这种方法的部分实现。</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">Thompson的正则表达式为运行在IBM7094的CTSS操作系统上的QED编辑器实现的。这个编辑器的还可以在CTSS的源代码里找到。L. Peter Deutsch and Butler Lampson 开发了第一个QED，但是Thompson的重新实现是第一个采用正则表达式的版本。Dennis Ritchie，已经将QED的历史进行了文档化。</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">Thompson的论文标志这正则表达式实现的一个新的开始。他并没有使用它的算法实现文本编辑器ed(出现在1971UNIX第一版上),或者是它的后续grep。相反，这些unix工具使用了递归回溯！使用回溯是合理的，因为正则表达式的符号那个时候还十分有限：它忽略了分组括号以及&#124;,?,+运算符。Al Aho的egrep是第一个提供了完整的正则表达式符号的unix工具，采用了预先计算好的DFA。在1985年的第8版里，egrep开始即时计算DFA，就像上面给出的那个实现一样。</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">在编写文本编辑器sam的时候，Rob Pike写了一个新的正则表达式的实现。Pike的实现将子匹配加入到了一个有效的NFA模拟中，但是并没有被广泛应用。Pike本身也没有意识到他的技术有什么新颖的地方。Henry Spencer使用回溯重新实现了这个功能，并把它发布到公众面前。于是它很快变得流行起来，并且被Perl pcre python这些采用。(Spencer 知道这个过程可能变得很慢，但是他并不知道还有一个效率更高的算法存在，他甚至在文档中提出警告&quot;Many users have found the speed perfectly adequate, although replacing the insides of egrep with this code would be a mistake.&quot;)Pike的正则表达式实现，被扩展到可以支持unicode，并且可以与sam一起免费获得，但是那些效率特别高的正则匹配搜索算法却逐渐被忘记。Ville Laurikari在1999年独立发现了Pike的算法，并发展出了一个理论基础。</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">最后，任何关于正则表达式的讨论如果不提及Jeffrey Friedl的&lt;&lt;精通正则表达式&gt;&gt;都将是不完整的，或许这本书是今天的程序员最流行的参考书。 Friedl的书主要是用来教程序员如何更好地使用今天的正则表达式实现，而不是如何更好的实现它们。里面只有一小部分文本用来介绍实现，并且使得人们产生了这样一种观点，好像正则表达式只有递归回溯一种实现。很明显，Friedl 也不理解或者重视底层实现。</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><strong>摘要</strong></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">通过已经出现数十年的基于有限自动机的技术，正则表达式匹配可以很简单，很快速。与此相比，Perl, PCRE, Python, Ruby, Java,以及其他很多语言的正则表达式实现却基于递归回溯，虽然很简单，但也会很低效。不考虑前向引用的话，那些由慢的回溯实现提供的特点完全可以由基于自动机的实现更快更一致的提供。</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><strong>致谢</strong></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">Lee Feigenbaum, James Grimmelmann, Alex Healy, William Josephson, and Arnold Robbins阅读了这篇文章的手稿，并提出了很多建议。Rob Pike提供了一些关于他的正则表达式实现的历史。在这里一并表示感谢。</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><strong>参考文献：</strong></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">[1] L. Peter Deutsch and Butler Lampson, &ldquo;An online editor,&rdquo; Communications of the ACM 10(12) (December 1967), pp. 793&ndash;799. http://doi.acm.org/10.1145/363848.363863</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">[2] Ville Laurikari, &ldquo;NFAs with Tagged Transitions, their Conversion to Deterministic Automata and Application to Regular Expressions,&rdquo; in Proceedings of the Symposium on String Processing and Information Retrieval, September 2000. http://laurikari.net/ville/spire2000-tnfa.ps</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">[3] M. Douglas McIlroy, &ldquo;Enumerating the strings of regular languages,&rdquo; Journal of Functional Programming 14 (2004), pp. 503&ndash;518. http://www.cs.dartmouth.edu/~doug/nfa.ps.gz (preprint)</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">[4] R. McNaughton and H. Yamada, &ldquo;Regular expressions and state graphs for automata,&rdquo; IRE Transactions on Electronic Computers EC-9(1) (March 1960), pp. 39&ndash;47.</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">[5] Paul Pierce, &ldquo;CTSS source listings.&rdquo; http://www.piercefuller.com/library/ctss.html (Thompson's QED is in the file com5 in the source listings archive and is marked as 0QED)</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">[6] Rob Pike, &ldquo;The text editor sam,&rdquo; Software&mdash;Practice &amp; Experience 17(11) (November 1987), pp. 813&ndash;845. http://plan9.bell-labs.com/sys/doc/sam.html</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">[7] Michael Rabin and Dana Scott, &ldquo;Finite automata and their decision problems,&rdquo; IBM Journal of Research and Development 3 (1959), pp. 114&ndash;125. http://www.research.ibm.com/journal/rd/032/ibmrd0302C.pdf</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">[8] Dennis Ritchie, &ldquo;An incomplete history of the QED text editor.&rdquo; http://plan9.bell-labs.com/~dmr/qed.html</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">[9] Ken Thompson, &ldquo;Regular expression search algorithm,&rdquo; Communications of the ACM 11(6) (June 1968), pp. 419&ndash;422. http://doi.acm.org/10.1145/363347.363387 (PDF)</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">[10] Tom Van Vleck, &ldquo;The IBM 7094 and CTSS.&rdquo; http://www.multicians.org/thvv/7094.html</p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px"><br /></p><p style="padding: 0px; margin: 0px 0px 10px; color: #444444; font-family: 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, tahoma, arial, simsun, 宋体; font-size: 14px; line-height: 22.3999996185303px">Discussion on reddit and perlmonks and LtU</p>
	</div>
	<div class="textbox-bottom">
	</div>
	<div class="tags" style="display: none"> 
	</div>
</div><div class="textbox">
	<div class="textbox-calendar">
	<span class="textbox-calendar-month">Jan</span>
	<span class="textbox-calendar-day">23</span>
	</div>
	<div class="textbox-title">
		<h4>
		<a href="read.php-7069.htm" tppabs="http://i.renjihe.com/blog/read.php?7069">正则表达式匹配也可以简单快速(上：原理部分)</a> <span id="starid7069"><img src="unstarred.gif" tppabs="http://i.renjihe.com/blog/template/default/images/others/unstarred.gif" alt="" title="未加星标" border="0"/></span> <img src="blank.gif" tppabs="http://i.renjihe.com/blog/images/weather/blank.gif" alt="不指定" title="不指定"/>
		</h4>
		<div class="textbox-label">
		<a href="view.php-go=user_1.htm" tppabs="http://i.renjihe.com/blog/view.php?go=user_1" target="_blank">renjihe1988</a> , 00:56 , <a href="index.php-go=category_2.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_2" title="查看分类： 软件">软件</a> &raquo; <a href="index.php-go=category_19.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_19" title="查看分类： 编译原理">编译原理</a> , <a href="read.php-7069.htm#reply" tppabs="http://i.renjihe.com/blog/read.php?7069#reply" title="发表您的评论">评论(0)</a> , <a href='javascript: void(0);' title="查看引用地址" onclick='showhidediv("tb7069");'>引用(0)</a> , <a href="read.php-7069.htm" tppabs="http://i.renjihe.com/blog/read.php?7069">阅读(1)</a> , Via 本站原创 
		</div>
	</div>
	<div id="tb7069" style="display: none;" class="textbox-tburl"><strong>引用功能被关闭了。</strong></div>
	
	<div class="textbox-content">
	http://duanple.blog.163.com/blog/static/7097176720099402816887/<br /><br /><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px">--------------------------<span style="line-height: normal; font-weight: bold; white-space: pre; font-family: verdana"><span style="font-size: small">虽然在java perl php python ruby里它很慢</span></span></div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px">Author:Russ Cox&nbsp;<span style="white-space: pre"> </span>Email:rsc<span style="white-space: pre"> </span>January 2007</div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px">[说明：本文由phylips@bmy翻译自英文文章Regular Expression Matching Can Be Simple And Fast&nbsp;(but is slow in Java, Perl, PHP, Python, Ruby, ...)，原文地址：<a style="text-decoration: none; cursor: pointer" rel="nofollow" href="javascript:if(confirm('http://swtch.com/~rsc/regexp/read.php?109  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://swtch.com/~rsc/regexp/read.php?109'" tppabs="http://swtch.com/~rsc/regexp/regexp1.html">http://swtch.com/~rsc/regexp/regexp1.html]</a></div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px"><br /></div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px"><strong><span style="font-size: large"><span style="color: #008000">导引</span></span></strong></div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px"><br /></div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px">这篇文章介绍了正则表达式匹配的两种方法。一种被广泛应用在很多语言的标准解释器里，比如perl。另一</div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px">个仅仅在一些地方使用，主要是大部分的awk和grep实现里使用。这两个方法在性能上具有很大的区别。</div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px"><a style="text-decoration: none; cursor: pointer" href="javascript:if(confirm('http://img234.ph.126.net/_PeEzednyDlxQqXHB1exkA==/read.php?108  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://img234.ph.126.net/_PeEzednyDlxQqXHB1exkA==/read.php?108'" tppabs="http://img234.ph.126.net/_PeEzednyDlxQqXHB1exkA==/2121195424492594935.jpg" target="_blank"><img src="read-1.php-108" tppabs="http://img234.ph.126.net/_PeEzednyDlxQqXHB1exkA==/2121195424492594935.jpg" border="0" alt="正则表达式匹配也可以简单快速(上：原理部分)&nbsp;&nbsp;- 星星 - 银河里的星星" title="正则表达式匹配也可以简单快速(上：原理部分)&nbsp;&nbsp;- 星星 - 银河里的星星" /></a></div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px"><br /></div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px">我们使用上标来代表字符重复，比如 a?^3a^3 代表 a?a?a?aaa。上面两个图是使用上面两种方法来匹配模</div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px">式串a?^na^n 和字符串a^n。</div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px"><br /></div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px">可以注意到perl需要超过60秒时间来匹配一个29字符的字符串。另一种方法，标注了Thompson NFA的那个，只需要20 ms就可以完成匹配。这个不是一个打印错误，事实就是如此。perl的图时间是以秒为单位，而Thompson NFA的则是以ms为单位：可以看出Thompson NFA实现的速度是perl实现的成百上千倍。图的发展趋势可以看出：Thompson NFA 处理一个100个字符的字符串200ms内就可以完成，但是perl则需要1o^15年。(perl仅仅是使用这种算法的一个最流行的一个语言；上面的图也可能是python,php,ruby或者其他语言。文章后面还会有更细节化的图提供了其他实现的相关数据)</div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px"><br /></div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px">很难相信上面的图形，或许你使用过perl，但是可能从没有碰到正则表达式匹配会匹配的如此之慢。实际上大多数时间，perl的正则表达式匹配是足够快速的。正如图形所展示的，尽管很可能写出上面那样的病态正则表达式会让perl的匹配非常慢。与此不同的是，对于Thompson NFA实现来说，并不存在这样的病态正则表达式。这就引出了另外一个问题，&quot;为什么perl不使用Thompson NFA方法呢&quot;，它可以，它也应该，这也是我们这篇文章剩余内容要说明的。</div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px"><br /></div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px">从历史上来看，正则表达式是计算机科学领域里关于理论如何帮助产生好程序的一个出色的例子。最初它们只是被看做一种简单的计算模型进行理论性的研究，但是Ken Thompson通过他实现的文本编辑器QED把它们介绍给程序员。 Dennis Ritchie 后来又将它移植到GE-TSS系统上的QED。Thompson and Ritchie创建了UNIX，他们又把正则表达式引入了UNIX。直到1970s，正则表达式逐步成为unix领域的关键特点，广泛应用在各种工具里，比如ed,sed,grep,egrep,awk和lex中。</div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px"><br /></div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px">今天，正则表达式已经成为忽略好的理论将导致坏程序的一个良好例证。今天的那些流行工具所使用的正则表达式实现很明显速度低于30年前的那些Unix工具使用的正则表达式匹配引擎。</div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px"><br /></div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px">这篇文章将会回顾那些好的理论：正则表达式，自动机，由Ken Thompson在19世纪60年代中期发明的正则表达式搜索算法。还会将这些理论实现出来，描述了Thompson的一个简单实现。该实现，少于400行c代码，上面图中我们与perl对比的那个程序就是使用的这个实现。它要比perl,python,pcre这些软件使用的实现性能表现得要好。这篇文章主要讨论在现实实现中，理论是如何转化为实际应用的。</div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px"><br /></div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px"><strong><span style="font-size: large"><span style="color: #008000">正则表达式</span></span></strong></div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px"><br /></div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px">正则表达式是一种描述字符串集合的记法。如果一个字符串属于正则表达式描述的集合，那么我们就说正则表达式与这个字符串匹配。</div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px"><br /></div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px">最简单的正则表达式是一个单字符。除了特殊的元字符*+?&#124;,字符都是与它们本身匹配的。为了匹配一个元字符，需要增加一个转义字符&quot;&#92;&quot;,比如&#92;+匹配一个&quot;+&quot;。</div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px"><br /></div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px">两个正则表达式可以通过选择，连接形成一个新的正则表达式。如果e1匹配s，e2匹配t，那么e1&#124;e2就匹配s或者t，e1e2就陪陪st。</div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px"><br /></div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px">元字符*+和?是重复操作符，e1*匹配0个或者更多个字符串e1；e1+匹配一个或者多个；e1?匹配0个或者1个。</div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px"><br /></div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px">操作符优先级，从最弱到最强的绑定顺序，第一个是选择，然后是连接，最后是重复。显式的括号可以被用来改变优先级，就像算术表达式那样。ab&#124;cd等价于(ab)&#124;(cd);ab*等价于a(b*)。</div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px"><br /></div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px">直到目前为止，前面描述的符号只是传统unix正则表达式符号集的一个子集。这个子集足够描述所有的正则语言。 loosely speaking, a regular language is a set of strings that can be matched in a&nbsp;single pass through the text using only a fixed amount of memory.新的正则表达式语言(尤其是perl和那些使用perl的)已经添加了很多新的操作符和转义序列。这些新添加的特点，使得正则表达式语言更加准确，虽然显得更复杂，但并没有显得更强大：这些新的正则表达式通常都可以在旧的那里找到更长的等价表示方法。</div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px"><br /></div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px">有一个通用的正则表达式扩展增加了正则表达式的能力，叫做前向引用。一个前向引用比如&#92;1 &#92;2匹配前一个括号里的表达式匹配的字符串。再比如(cat&#124;dog)&#92;1 匹配catcat,dogdog但是并不与catdog,dogcat匹配。实际上含有前向引用的正则表达式已经超出了通常的正则表达式的概念范畴。增加的前向引用这个功能也带来了很大的花费：最坏情况下，现有已知的最好实现也需要指数级搜索算法，就像perl使用的那个。Perl现在并没有去掉反向引用支持，当然如果正则表达式中不包含前向引用它们实际也可以使用更快的算法，比如上面提到的那个。本文就是介绍这些更快的算法的。</div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px"><br /></div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px"><strong><span style="font-size: large"><span style="color: #008000">有限自动机</span></span></strong></div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px"><br /></div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px">另一种描述字符集的方式是使用有限自动机。有限自动机也被称为状态机，&ldquo;automaton&rdquo; 和 &ldquo;machine&rdquo;这两个单词意思一致，通常可以相互替换。</div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px"><br /></div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px">作为一个简单的例子，下面这个状态机就可以识别正则表达式a(bb)+a所代表的字符串集合。</div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px"><a style="text-decoration: none; cursor: pointer" href="javascript:if(confirm('http://img534.ph.126.net/PvUN0Kfwu5105aHS0uXSSg==/read.php?107  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://img534.ph.126.net/PvUN0Kfwu5105aHS0uXSSg==/read.php?107'" tppabs="http://img534.ph.126.net/PvUN0Kfwu5105aHS0uXSSg==/2648961005824979403.jpg" target="_blank"><img src="read-1.php-107" tppabs="http://img534.ph.126.net/PvUN0Kfwu5105aHS0uXSSg==/2648961005824979403.jpg" border="0" alt="正则表达式匹配也可以简单快速(上：原理部分)&nbsp;&nbsp;- 星星 - 银河里的星星" title="正则表达式匹配也可以简单快速(上：原理部分)&nbsp;&nbsp;- 星星 - 银河里的星星" /></a></div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px"><br /></div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px"><br /></div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px">有限自动机，通常用一个环代表一个状态(环里的标号是为了让讨论起来更方便，它们并不是自动机操作的一部分)。当读取字符串的同时，它读一个字符就从一个状态转换到另一个状态。状态机里有两个特殊状态：开始状态s0和匹配状态s4。开始状态有一个&quot;&gt;&quot;指向它们，匹配状态用一个双环表示。</div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px"><br /></div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px">状态机一次从输入字符串里读取一个字符，沿着指向状态图中的指针从一个状态转换到另一个状态。比较假设输入字符串是abbbba。当状态机读取第一个字符a的时候，它处在开始状态s0.然后它沿着指针到达状态s1。之后接着不断读入b到达s2,读入b到达s3，读入b到达s3，最后到达s4。</div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px"><a style="text-decoration: none; cursor: pointer" href="javascript:if(confirm('http://img685.ph.126.net/pqtt6R9T5I2KSUIStsYctA==/read.php?106  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://img685.ph.126.net/pqtt6R9T5I2KSUIStsYctA==/read.php?106'" tppabs="http://img685.ph.126.net/pqtt6R9T5I2KSUIStsYctA==/1099441259032930536.jpg" target="_blank"><img src="read-1.php-106" tppabs="http://img685.ph.126.net/pqtt6R9T5I2KSUIStsYctA==/1099441259032930536.jpg" border="0" alt="正则表达式匹配也可以简单快速(上：原理部分)&nbsp;&nbsp;- 星星 - 银河里的星星" title="正则表达式匹配也可以简单快速(上：原理部分)&nbsp;&nbsp;- 星星 - 银河里的星星" /></a></div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px"><br /></div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px">状态机结束在s4，匹配状态，所以它可以匹配这个字符串。如果状态机结束在一个非匹配状态，那说明它与字符串不匹配。如果在状态机执行过程中的任何一点，针对当前输入字符，没有任何指针了，那麽状态机的执行就可以提前结束了。</div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px"><br /></div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px">现在为止我们看到的都叫做确定性有限自动机(DFA)，因为在任何状态，每个可能的输入字符最多转向一个新状态。我们也可以创建具有多个可能的下一个状态的状态机。比如，下面这个状态机等价于前面那个，但是不是确定性的：</div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px"><a style="text-decoration: none; cursor: pointer" href="javascript:if(confirm('http://img534.ph.126.net/DV2w3Jvc4cTzTlU6-kByxQ==/read.php?105  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://img534.ph.126.net/DV2w3Jvc4cTzTlU6-kByxQ==/read.php?105'" tppabs="http://img534.ph.126.net/DV2w3Jvc4cTzTlU6-kByxQ==/2648961005824979425.jpg" target="_blank"><img src="read-1.php-105" tppabs="http://img534.ph.126.net/DV2w3Jvc4cTzTlU6-kByxQ==/2648961005824979425.jpg" border="0" alt="正则表达式匹配也可以简单快速(上：原理部分)&nbsp;&nbsp;- 星星 - 银河里的星星" title="正则表达式匹配也可以简单快速(上：原理部分)&nbsp;&nbsp;- 星星 - 银河里的星星" /></a></div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px"><br /></div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px">状态机不是确定性的，因为如果在状态s2读入一个字符b，下一个状态就有多种选择。它可以去状态s1，也可以到达状态s3。因为状态机不能提前看到字符串的剩余部分，也就无法判断哪一个状态是正确决定。在这个情况下，如果能让状态机总是猜的正确的也是很有挑战的。这样的状态机称为非确定性有限自动机(NFAs或者NDFAs)。如果输入字符串能够通过NFA中的某条路径到达最终的匹配状态，那么就说明字符串与该NFA匹配。</div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px"><br /></div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px">有时如果让NFA包含没有相应输入字符的指针，会很方便，我们称这些指针是未标记的。一个NFA，在任意时刻，不用读入任何输入就可以选择一个未标记的指针到达下一个状态。下面这个NFA等价于前面两个，但是未标记指针使得图形与a(bb)+a的对应关系更明显了：</div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px"><br /></div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px"><a style="text-decoration: none; cursor: pointer" href="javascript:if(confirm('http://img534.ph.126.net/nmTNHsXvWMBFvy6rlfFRXw==/read.php?104  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://img534.ph.126.net/nmTNHsXvWMBFvy6rlfFRXw==/read.php?104'" tppabs="http://img534.ph.126.net/nmTNHsXvWMBFvy6rlfFRXw==/2648961005824979447.jpg" target="_blank"><img src="read-1.php-104" tppabs="http://img534.ph.126.net/nmTNHsXvWMBFvy6rlfFRXw==/2648961005824979447.jpg" border="0" alt="正则表达式匹配也可以简单快速(上：原理部分)&nbsp;&nbsp;- 星星 - 银河里的星星" title="正则表达式匹配也可以简单快速(上：原理部分)&nbsp;&nbsp;- 星星 - 银河里的星星" /></a></div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px"><br /></div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px"><strong><span style="font-size: large"><span style="color: #008000">将正则表达式转换为NFAs</span></span></strong></div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px"><br /></div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px">正则表达式与NFAs可以相互进行等价变换：每一个正则表达式都有一个等价的NFA(它们匹配相同的字符集)(现已证明DFAs与NFAs在表达能力上也是等价的，后面我们也可以看到这点)。有多种方法将正则表达式转换成NFAs。这里描述的方法最初由Thompson在1968年发表在CACM上的。</div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px"><br /></div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px">一个正则表达式的NFAs是逐步由一个子表达式对应的那些NFAs分块构建起来的，不同的操作符具有不同的构建方式。这种NFAs分块没有匹配状态:但是它们倒有一个或者多个悬空指针(未指向任何状态)。整个构建过程将以将这些指针指向一个匹配状态结束。</div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px"><br /></div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px">NFAs对于一个单字符的匹配如下；</div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px">对于链接e1e2,需要将e1的终结指针指向e2的状态机的开始状态；</div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px">对于选择e1&#124;e2,需要增加一个新的开始状态，这个状态有两个指针指向e1和e2；</div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px">对于e?，修改e状态增加一个新状态，并添加一条空指针；</div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px">对于e*，使用类似e?相同的改变，但是还要将e的结束指针回指到这个新状态；</div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px">对于e+，因为要至少通过e一次，所以做一些改变。如下所示：</div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px"><a style="text-decoration: none; cursor: pointer" href="javascript:if(confirm('http://img534.ph.126.net/OZFGe8YqR6D4-e4Q0R6PTQ==/read.php?103  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://img534.ph.126.net/OZFGe8YqR6D4-e4Q0R6PTQ==/read.php?103'" tppabs="http://img534.ph.126.net/OZFGe8YqR6D4-e4Q0R6PTQ==/2648961005824979475.jpg" target="_blank"><img src="read-1.php-103" tppabs="http://img534.ph.126.net/OZFGe8YqR6D4-e4Q0R6PTQ==/2648961005824979475.jpg" border="0" alt="正则表达式匹配也可以简单快速(上：原理部分)&nbsp;&nbsp;- 星星 - 银河里的星星" title="正则表达式匹配也可以简单快速(上：原理部分)&nbsp;&nbsp;- 星星 - 银河里的星星" /></a></div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px"><br /></div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px">数一下上面图中的新状态，可以看到通过这种技术，正则表达式中的每个元字符刚好对应NFA的一个状态(除了括号)。因此最终的NFAs里的状态数目最多等于原始正则表达式串的长度。</div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px"><br /></div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px"><span style="color: #008000"><strong>观察上面的图示，我们还可以发现一个特点：每个子片段实际上对外只有开始状态和输出指针是可见的，而上面这些运算，所需要的操作不外乎要么增加一个新的开始状态，将新片段的输出指针指向另一个片段的开始状态，要么修改原来的输出指针，总之只涉及到输出指针和开始状态的操作。</strong></span></div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px"><br /></div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px">正如先前描述的NFA例子，很容易消除掉未标记的指针，也很容易一开始就生成不包含未标记指针的NFA。但是引用如果加上这个未标记指针，会让我们的NFA更容易理解和阅读，也能让c代码更简单，所以我们将保留它。</div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px"><br /></div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px"><strong><span style="font-size: large"><span style="color: #008000">正则表达式搜索算法</span></span></strong></div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px"><br /></div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px">现在我们有了一种方法来判断一个正则表达式与一个字符串是否匹配：将正则表达式转换为NFA然后通过字符串输入运行NFA。为了让普通的计算机运行NFA，我们必须找到一种模拟NFA运行的方式。</div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px"><br /></div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px">一种模拟这种完美猜测的方式是首先猜一个选择，如果它不成功则尝试另一个。比如考虑abab&#124;abbb对应的NFA，如果输入abbb,则整个过程如下:</div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px"><a style="text-decoration: none; cursor: pointer" href="javascript:if(confirm('http://img458.ph.126.net/kOOIxnG6aEwQI4ZYKu6J3w==/read.php?102  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://img458.ph.126.net/kOOIxnG6aEwQI4ZYKu6J3w==/read.php?102'" tppabs="http://img458.ph.126.net/kOOIxnG6aEwQI4ZYKu6J3w==/1015843190949550840.jpg" target="_blank"><img src="read-1.php-102" tppabs="http://img458.ph.126.net/kOOIxnG6aEwQI4ZYKu6J3w==/1015843190949550840.jpg" border="0" alt="正则表达式匹配也可以简单快速(上：原理部分)&nbsp;&nbsp;- 星星 - 银河里的星星" title="正则表达式匹配也可以简单快速(上：原理部分)&nbsp;&nbsp;- 星星 - 银河里的星星" /></a></div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px"><a style="text-decoration: none; cursor: pointer" href="javascript:if(confirm('http://img458.ph.126.net/68CF267v55VwEunDYBfEbg==/index.php?go=category_63&mode=2&page=1  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://img458.ph.126.net/68CF267v55VwEunDYBfEbg==/index.php?go=category_63&mode=2&page=1'" tppabs="http://img458.ph.126.net/68CF267v55VwEunDYBfEbg==/1015843190949550859.jpg" target="_blank"><img src="index-1.php-go=category_63&mode=2&page=1" tppabs="http://img458.ph.126.net/68CF267v55VwEunDYBfEbg==/1015843190949550859.jpg" border="0" alt="正则表达式匹配也可以简单快速(上：原理部分)&nbsp;&nbsp;- 星星 - 银河里的星星" title="正则表达式匹配也可以简单快速(上：原理部分)&nbsp;&nbsp;- 星星 - 银河里的星星" /></a></div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px"><br /></div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px">在step0，NFA首先做一个选择：尝试匹配abab还是abbb?在图中，NFA尝试abab，但是在第3步就失败了。然后NFA尝试另一个选择，到达step4然后匹配成功。这种回溯策略有一个简单的递归实现但是在成功之前可能会多次读入输入字符串。如果字符串不匹配，在放弃之前状态机就会尝试所有可能的执行路径。在这个例子里，NFA只尝试了两个路径，但最坏情况下，所有可能的执行路径将会是指数级的，这样会导致极低的运行时间。</div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px"><br /></div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px">一个更有效但是更复杂的方式是通过并行猜测所有的选择来模拟这个猜测的过程。在这种策略里，这个模拟过程允许这个状态机一次处于多个状态。为了处理每个字符，它让所有的状态沿着这个字符对应的指针前进。如下：</div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px"><a style="text-decoration: none; cursor: pointer; line-height: 22px" href="javascript:if(confirm('http://img458.ph.126.net/6FXiCQZW3ZgU04lKKRXhcw==/index.php?go=category_63&mode=1&page=1  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://img458.ph.126.net/6FXiCQZW3ZgU04lKKRXhcw==/index.php?go=category_63&mode=1&page=1'" tppabs="http://img458.ph.126.net/6FXiCQZW3ZgU04lKKRXhcw==/1015843190949550909.jpg" target="_blank"><img style="border-style: none" src="index-1.php-go=category_63&mode=1&page=1" tppabs="http://img458.ph.126.net/6FXiCQZW3ZgU04lKKRXhcw==/1015843190949550909.jpg" border="0" alt="正则表达式匹配也可以简单快速(上：原理部分)&nbsp;&nbsp;- 星星 - 银河里的星星" title="正则表达式匹配也可以简单快速(上：原理部分)&nbsp;&nbsp;- 星星 - 银河里的星星" /></a></div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px">状态机从开始状态以及那些所有从开始状态通过未标注指针可以到达的状态开始。在step1和2，NFA并行地处在两个状态。仅仅在step3减少到一个状态。多状态策略由于在同一时刻尝试两条可能路径，所有只需要读取输入一次。最坏情况下，NFA每一步可能处在所有的状态，但是这个结果最坏情况下也是与字符串长度常数级系数关系，所以即使很大的输入字符串也可以在线性时间内处理。与需要回溯的指数级复杂度相比，这已经是一个很大的进步了。这个效率来自于追踪所有的可达状态集，但是并不是那些可能的路径数目。在一个n节点的NFA里，每一步可能有n个可达状态，但是NFA里可能存在2^n个路径。</div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px"><br /></div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; font-size: 14px; line-height: 22.3999996185303px"><span style="color: #008000"><strong>所谓的并行执行，不过是一个在NFA状态图中的开始状态开始不断进行广度优先搜索的过程，我们每次记录当前的所有可达状态集合，然后根据下一个输入得到下一个可达状态集合，这样可达状态集合就更新为新计算的这个集合，然后继续进行上面的迭代过程。</strong></span></div>
	</div>
	<div class="textbox-bottom">
	</div>
	<div class="tags" style="display: none"> 
	</div>
</div><div class="textbox">
	<div class="textbox-calendar">
	<span class="textbox-calendar-month">Jan</span>
	<span class="textbox-calendar-day">22</span>
	</div>
	<div class="textbox-title">
		<h4>
		<a href="read.php-7067.htm" tppabs="http://i.renjihe.com/blog/read.php?7067">手把手教你构建 C 语言编译器（9）- 总结</a> <span id="starid7067"><img src="unstarred.gif" tppabs="http://i.renjihe.com/blog/template/default/images/others/unstarred.gif" alt="" title="未加星标" border="0"/></span> <img src="blank.gif" tppabs="http://i.renjihe.com/blog/images/weather/blank.gif" alt="不指定" title="不指定"/>
		</h4>
		<div class="textbox-label">
		<a href="view.php-go=user_1.htm" tppabs="http://i.renjihe.com/blog/view.php?go=user_1" target="_blank">renjihe1988</a> , 12:45 , <a href="index.php-go=category_2.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_2" title="查看分类： 软件">软件</a> &raquo; <a href="index.php-go=category_19.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_19" title="查看分类： 编译原理">编译原理</a> , <a href="read.php-7067.htm#reply" tppabs="http://i.renjihe.com/blog/read.php?7067#reply" title="发表您的评论">评论(0)</a> , <a href='javascript: void(0);' title="查看引用地址" onclick='showhidediv("tb7067");'>引用(0)</a> , <a href="read.php-7067.htm" tppabs="http://i.renjihe.com/blog/read.php?7067">阅读(2)</a> , Via 本站原创 
		</div>
	</div>
	<div id="tb7067" style="display: none;" class="textbox-tburl"><strong>引用功能被关闭了。</strong></div>
	
	<div class="textbox-content">
	<p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">恭喜你完成了自己的 C 语言编译器，本章中我们发一发牢骚，说一说编写编译器值得注意的一些问题；编写编译器时遇到的一些难题。</p><a id="more" style="outline: none; color: #368ccb; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px; background-color: transparent"></a><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">手把手教你构建 C 语言编译器系列共有10个部分：</p><ol style="padding-left: 0px; color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px"><li><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" rel="external" href="javascript:if(confirm('http://lotabout.me/2015/write-a-C-interpreter-0/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2015/write-a-C-interpreter-0/'" tppabs="http://lotabout.me/2015/write-a-C-interpreter-0/" target="_blank">手把手教你构建 C 语言编译器（0）&mdash;&mdash;前言</a></li><li><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" rel="external" href="javascript:if(confirm('http://lotabout.me/2015/write-a-C-interpreter-1/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2015/write-a-C-interpreter-1/'" tppabs="http://lotabout.me/2015/write-a-C-interpreter-1/" target="_blank">手把手教你构建 C 语言编译器（1）&mdash;&mdash;设计</a></li><li><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" rel="external" href="javascript:if(confirm('http://lotabout.me/2015/write-a-C-interpreter-2/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2015/write-a-C-interpreter-2/'" tppabs="http://lotabout.me/2015/write-a-C-interpreter-2/" target="_blank">手把手教你构建 C 语言编译器（2）&mdash;&mdash;虚拟机</a></li><li><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" rel="external" href="javascript:if(confirm('http://lotabout.me/2015/write-a-C-interpreter-3/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2015/write-a-C-interpreter-3/'" tppabs="http://lotabout.me/2015/write-a-C-interpreter-3/" target="_blank">手把手教你构建 C 语言编译器（3）&mdash;&mdash;词法分析器</a></li><li><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" rel="external" href="javascript:if(confirm('http://lotabout.me/2016/write-a-C-interpreter-4/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2016/write-a-C-interpreter-4/'" tppabs="http://lotabout.me/2016/write-a-C-interpreter-4/" target="_blank">手把手教你构建 C 语言编译器（4）&mdash;&mdash;递归下降</a></li><li><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" rel="external" href="javascript:if(confirm('http://lotabout.me/2016/write-a-C-interpreter-5/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2016/write-a-C-interpreter-5/'" tppabs="http://lotabout.me/2016/write-a-C-interpreter-5/" target="_blank">手把手教你构建 C 语言编译器（5）&mdash;&mdash;变量定义</a></li><li><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" rel="external" href="javascript:if(confirm('http://lotabout.me/2016/write-a-C-interpreter-6/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2016/write-a-C-interpreter-6/'" tppabs="http://lotabout.me/2016/write-a-C-interpreter-6/" target="_blank">手把手教你构建 C 语言编译器（6）&mdash;&mdash;函数定义</a></li><li><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" rel="external" href="javascript:if(confirm('http://lotabout.me/2016/write-a-C-interpreter-7/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2016/write-a-C-interpreter-7/'" tppabs="http://lotabout.me/2016/write-a-C-interpreter-7/" target="_blank">手把手教你构建 C 语言编译器（7）&mdash;&mdash;语句</a></li><li><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" rel="external" href="javascript:if(confirm('http://lotabout.me/2016/write-a-C-interpreter-8/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2016/write-a-C-interpreter-8/'" tppabs="http://lotabout.me/2016/write-a-C-interpreter-8/" target="_blank">手把手教你构建 C 语言编译器（8）&mdash;&mdash;表达式</a></li><li><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" rel="external" href="javascript:if(confirm('http://lotabout.me/2016/write-a-C-interpreter-9/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2016/write-a-C-interpreter-9/'" tppabs="http://lotabout.me/2016/write-a-C-interpreter-9/" target="_blank">手把手教你构建 C 语言编译器（9）&mdash;&mdash;总结</a></li></ol><h1 style="margin: 0.67em 0px; font-family: 'Helvetica Neue', 'WenQuanYi Micro Hei', Heiti, Impact, Charcoal, sans-serif; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #333333; padding: 3px 0px; color: #333333"><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" href="javascript:if(confirm('http://lotabout.me/2016/write-a-C-interpreter-9/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2016/write-a-C-interpreter-9/#u865A_u62DF_u673A_u4E0E_u76EE_u6807_u4EE3_u7801'" tppabs="http://lotabout.me/2016/write-a-C-interpreter-9/#u865A_u62DF_u673A_u4E0E_u76EE_u6807_u4EE3_u7801" title="虚拟机与目标代码" class="headerlink"></a>虚拟机与目标代码</h1><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">整个系列的一开始，我们就着手虚拟机的实现。不知道你是否有同感，这部分对于整个编译器的编写其实是十分重要的。我认为至少占了重要程度的50%。</p><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">这里要说明这样一个观点，学习编译原理时常常着眼于词法分析和语法分析，而忽略了同样重要的代码生成。对于学习或考试而言或许可以，但实际编译项目时，最为重要的是能&ldquo;跑起来&rdquo;，所以我们需要给予代码生成高度的重视。</p><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">同时我们也看到，在后期解析语句和表达式时，难点已经不再是语法分析了，而是如何为运算符生成相应的汇编代码。</p><h1 style="margin: 0.67em 0px; font-family: 'Helvetica Neue', 'WenQuanYi Micro Hei', Heiti, Impact, Charcoal, sans-serif; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #333333; padding: 3px 0px; color: #333333"><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" href="javascript:if(confirm('http://lotabout.me/2016/write-a-C-interpreter-9/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2016/write-a-C-interpreter-9/#u8BCD_u6CD5_u5206_u6790'" tppabs="http://lotabout.me/2016/write-a-C-interpreter-9/#u8BCD_u6CD5_u5206_u6790" title="词法分析" class="headerlink"></a>词法分析</h1><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">我们用了很暴力的手段编写了我们的词法分析器，我认为这并无不可。</p><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">但你依旧可以学习相关的知识，了解自动生成词法分析器的原理，它涉及到了&ldquo;正则表达式&rdquo;，&ldquo;状态机&rdquo;等等知识。相信这部分的知识能够很大程度上提高你的编程水平。</p><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">同时，如果今后你仍然想编写编译器，不妨试试这些自动生成工具。</p><h1 style="margin: 0.67em 0px; font-family: 'Helvetica Neue', 'WenQuanYi Micro Hei', Heiti, Impact, Charcoal, sans-serif; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #333333; padding: 3px 0px; color: #333333"><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" href="javascript:if(confirm('http://lotabout.me/2016/write-a-C-interpreter-9/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2016/write-a-C-interpreter-9/#u8BED_u6CD5_u5206_u6790'" tppabs="http://lotabout.me/2016/write-a-C-interpreter-9/#u8BED_u6CD5_u5206_u6790" title="语法分析" class="headerlink"></a>语法分析</h1><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">长期以来，语法分析对我而言一直是迷一样的存在，直到真正用递归下降的方式实现了一个。</p><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">我们用了专门的一章讲解了&ldquo;递归下降&rdquo;与 BNF 文法的关系。希望能减少你对理论的厌恶。至少，实现起来并不是太难。</p><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">如果有兴趣，可以学习学习这些文法，因为已经有许多自动生成的工具支持它们。这样你就不需要重复造轮子。可以看看 yacc 等工具，更先进的版本是&nbsp;bsion。同时其它语言也有许多类似的支持。</p><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">题外话，最近知道了一个叫&ldquo;PEG 文法&rdquo;的表示方法，无论是读起来，还是实现起来，都比 BNF 要容易，你也可以学习看看。</p><h1 style="margin: 0.67em 0px; font-family: 'Helvetica Neue', 'WenQuanYi Micro Hei', Heiti, Impact, Charcoal, sans-serif; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #333333; padding: 3px 0px; color: #333333"><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" href="javascript:if(confirm('http://lotabout.me/2016/write-a-C-interpreter-9/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2016/write-a-C-interpreter-9/#u5173_u4E8E_u7F16_u4EE3_u7801'" tppabs="http://lotabout.me/2016/write-a-C-interpreter-9/#u5173_u4E8E_u7F16_u4EE3_u7801" title="关于编代码" class="headerlink"></a>关于编代码</h1><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">这也是我自己的感慨吧。无论多好的教程，想要完全理解它，最好的方式恐怕还是要自己实现它。</p><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">只是在编写代码的过程中，我们会遇到许多的挫折，例如需要考虑许多细节，或是调试起来十分困难。但也只有真正静下心来去克服它，我们才能有所成长吧。</p><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">例如在编写表达式的解析时，大量重复的代码特别让人崩溃。还有就是调试编译器，简直痛苦地无话可说。</p><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">P.S. 如果你按这个系列自己编写代码，记得事先写一些用于输出汇编代码的函数，很有帮助的。</p><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">还有就是写这个系列的文章，开始的冲动过了之后，每写一篇都特别心烦，希望文章本身没有受我的这种情绪影响吧。</p><h1 style="margin: 0.67em 0px; font-family: 'Helvetica Neue', 'WenQuanYi Micro Hei', Heiti, Impact, Charcoal, sans-serif; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #333333; padding: 3px 0px; color: #333333"><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" href="javascript:if(confirm('http://lotabout.me/2016/write-a-C-interpreter-9/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2016/write-a-C-interpreter-9/#u7ED3_u8BED'" tppabs="http://lotabout.me/2016/write-a-C-interpreter-9/#u7ED3_u8BED" title="结语" class="headerlink"></a>结语</h1><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">编程有趣又无趣，只有身在其中的我们才能体会吧。</p>
	</div>
	<div class="textbox-bottom">
	</div>
	<div class="tags" style="display: none"> 
	</div>
</div><div class="textbox">
	<div class="textbox-calendar">
	<span class="textbox-calendar-month">Jan</span>
	<span class="textbox-calendar-day">22</span>
	</div>
	<div class="textbox-title">
		<h4>
		<a href="read.php-7066.htm" tppabs="http://i.renjihe.com/blog/read.php?7066">手把手教你构建 C 语言编译器（8）- 表达式</a> <span id="starid7066"><img src="unstarred.gif" tppabs="http://i.renjihe.com/blog/template/default/images/others/unstarred.gif" alt="" title="未加星标" border="0"/></span> <img src="blank.gif" tppabs="http://i.renjihe.com/blog/images/weather/blank.gif" alt="不指定" title="不指定"/>
		</h4>
		<div class="textbox-label">
		<a href="view.php-go=user_1.htm" tppabs="http://i.renjihe.com/blog/view.php?go=user_1" target="_blank">renjihe1988</a> , 12:45 , <a href="index.php-go=category_2.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_2" title="查看分类： 软件">软件</a> &raquo; <a href="index.php-go=category_19.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_19" title="查看分类： 编译原理">编译原理</a> , <a href="read.php-7066.htm#reply" tppabs="http://i.renjihe.com/blog/read.php?7066#reply" title="发表您的评论">评论(0)</a> , <a href='javascript: void(0);' title="查看引用地址" onclick='showhidediv("tb7066");'>引用(0)</a> , <a href="read.php-7066.htm" tppabs="http://i.renjihe.com/blog/read.php?7066">阅读(1)</a> , Via 本站原创 
		</div>
	</div>
	<div id="tb7066" style="display: none;" class="textbox-tburl"><strong>引用功能被关闭了。</strong></div>
	
	<div class="textbox-content">
	<p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">这是整个编译器的最后一部分，解析表达式。什么是表达式？表达式是将各种语言要素的一个组合，用来求值。例如：函数调用、变量赋值、运算符运算等等。</p><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">表达式的解析难点有二：一是运算符的优先级问题，二是如何将表达式编译成目标代码。我们就来逐一说明。</p><a id="more" style="outline: none; color: #368ccb; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px; background-color: transparent"></a><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">手把手教你构建 C 语言编译器系列共有10个部分：</p><ol style="padding-left: 0px; color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px"><li><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" rel="external" href="javascript:if(confirm('http://lotabout.me/2015/write-a-C-interpreter-0/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2015/write-a-C-interpreter-0/'" tppabs="http://lotabout.me/2015/write-a-C-interpreter-0/" target="_blank">手把手教你构建 C 语言编译器（0）&mdash;&mdash;前言</a></li><li><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" rel="external" href="javascript:if(confirm('http://lotabout.me/2015/write-a-C-interpreter-1/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2015/write-a-C-interpreter-1/'" tppabs="http://lotabout.me/2015/write-a-C-interpreter-1/" target="_blank">手把手教你构建 C 语言编译器（1）&mdash;&mdash;设计</a></li><li><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" rel="external" href="javascript:if(confirm('http://lotabout.me/2015/write-a-C-interpreter-2/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2015/write-a-C-interpreter-2/'" tppabs="http://lotabout.me/2015/write-a-C-interpreter-2/" target="_blank">手把手教你构建 C 语言编译器（2）&mdash;&mdash;虚拟机</a></li><li><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" rel="external" href="javascript:if(confirm('http://lotabout.me/2015/write-a-C-interpreter-3/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2015/write-a-C-interpreter-3/'" tppabs="http://lotabout.me/2015/write-a-C-interpreter-3/" target="_blank">手把手教你构建 C 语言编译器（3）&mdash;&mdash;词法分析器</a></li><li><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" rel="external" href="javascript:if(confirm('http://lotabout.me/2016/write-a-C-interpreter-4/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2016/write-a-C-interpreter-4/'" tppabs="http://lotabout.me/2016/write-a-C-interpreter-4/" target="_blank">手把手教你构建 C 语言编译器（4）&mdash;&mdash;递归下降</a></li><li><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" rel="external" href="javascript:if(confirm('http://lotabout.me/2016/write-a-C-interpreter-5/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2016/write-a-C-interpreter-5/'" tppabs="http://lotabout.me/2016/write-a-C-interpreter-5/" target="_blank">手把手教你构建 C 语言编译器（5）&mdash;&mdash;变量定义</a></li><li><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" rel="external" href="javascript:if(confirm('http://lotabout.me/2016/write-a-C-interpreter-6/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2016/write-a-C-interpreter-6/'" tppabs="http://lotabout.me/2016/write-a-C-interpreter-6/" target="_blank">手把手教你构建 C 语言编译器（6）&mdash;&mdash;函数定义</a></li><li><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" rel="external" href="javascript:if(confirm('http://lotabout.me/2016/write-a-C-interpreter-7/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2016/write-a-C-interpreter-7/'" tppabs="http://lotabout.me/2016/write-a-C-interpreter-7/" target="_blank">手把手教你构建 C 语言编译器（7）&mdash;&mdash;语句</a></li><li><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" rel="external" href="javascript:if(confirm('http://lotabout.me/2016/write-a-C-interpreter-8/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2016/write-a-C-interpreter-8/'" tppabs="http://lotabout.me/2016/write-a-C-interpreter-8/" target="_blank">手把手教你构建 C 语言编译器（8）&mdash;&mdash;表达式</a></li><li><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" rel="external" href="javascript:if(confirm('http://lotabout.me/2016/write-a-C-interpreter-9/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2016/write-a-C-interpreter-9/'" tppabs="http://lotabout.me/2016/write-a-C-interpreter-9/" target="_blank">手把手教你构建 C 语言编译器（9）&mdash;&mdash;总结</a></li></ol><h1 style="margin: 0.67em 0px; font-family: 'Helvetica Neue', 'WenQuanYi Micro Hei', Heiti, Impact, Charcoal, sans-serif; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #333333; padding: 3px 0px; color: #333333"><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" href="javascript:if(confirm('http://lotabout.me/2016/write-a-C-interpreter-8/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2016/write-a-C-interpreter-8/#u8FD0_u7B97_u7B26_u7684_u4F18_u5148_u7EA7'" tppabs="http://lotabout.me/2016/write-a-C-interpreter-8/#u8FD0_u7B97_u7B26_u7684_u4F18_u5148_u7EA7" title="运算符的优先级" class="headerlink"></a>运算符的优先级</h1><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">运算符的优先级决定了表达式的运算顺序，如在普通的四则运算中，乘法&nbsp;*&nbsp;优先级高于加法&nbsp;+，这就意味着表达式&nbsp;2 + 3 * 4&nbsp;的实际运行顺序是&nbsp;2 + (3 * 4)&nbsp;而不是&nbsp;(2 + 3) * 4。</p><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">C 语言定义了各种表达式的优先级，可以参考&nbsp;<a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" rel="external" href="javascript:if(confirm('http://en.cppreference.com/w/c/language/read.php?1263  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://en.cppreference.com/w/c/language/read.php?1263'" tppabs="http://en.cppreference.com/w/c/language/operator_precedence" target="_blank">C 语言运算符优先级</a>。</p><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">传统的编程书籍会用&ldquo;逆波兰式&rdquo;实现四则运算来讲解优先级问题。实际上，优先级关心的就是哪个运算符先计算，哪个运算符后计算（毕竟叫做&ldquo;优先级&rdquo;嘛）。而这就意味着我们需要决定先为哪个运算符生成目标代码（汇编），因为汇编代码是顺序排列的，我们必须先计算优先级高的运算符。</p><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">那么如何确定运算符的优先级呢？答曰：栈（递归调用的实质也是栈的处理）。</p><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">举一个例子：2 + 3 - 4 * 5，它的运算顺序是这样的：</p><ol style="padding-left: 0px; color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px"><li>将&nbsp;2&nbsp;入栈</li><li>遇到运算符&nbsp;+，入栈，此时我们期待的是+的另一个参数</li><li>遇到数字&nbsp;3，原则上我们需要立即计算&nbsp;2+3的值，但我们不确定数字&nbsp;3&nbsp;是否属于优先级更高的运算符，所以先将它入栈。</li><li>遇到运算符&nbsp;-，它的优先级和&nbsp;+&nbsp;相同，此时判断参数&nbsp;3&nbsp;属于这前的&nbsp;+。将运算符&nbsp;+&nbsp;出栈，并将之前的&nbsp;2&nbsp;和&nbsp;3&nbsp;出栈，计算&nbsp;2+3&nbsp;的结果，得到&nbsp;5&nbsp;入栈。同时将运算符&nbsp;-&nbsp;入栈。</li><li>遇到数字4，同样不能确定是否能立即计算，入栈</li><li>遇到运算符&nbsp;*&nbsp;优先级大于&nbsp;-，入栈</li><li>遇到数字5，依旧不能确定是否立即计算，入栈</li><li>表达式结束，运算符出栈，为&nbsp;*，将参数出栈，计算&nbsp;4*5&nbsp;得到结果&nbsp;20&nbsp;入栈。</li><li>运算符出栈，为&nbsp;-，将参数出栈，计算&nbsp;5-20，得到&nbsp;-15&nbsp;入栈。</li><li>此时运算符栈为空，因此得到结果&nbsp;-15。</li></ol><table border="0" style="border-collapse: collapse; border-spacing: 0px; width: auto; vertical-align: middle; margin: 0px"><tbody><tr><td class="code" style="padding: 0px; border: none"><pre style="overflow: auto; font-family: 'Source Code Pro', Consolas, Monaco, Menlo, Consolas, monospace; font-size: 16px; margin-top: 0px; margin-bottom: 0px; padding: 0px; border: none; border-radius: 2px; color: #cccccc; line-height: 1.6em; background-image: initial; background-attachment: initial; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial"><span style="height: 1.6em" class="line">// after step 1, 2</span><br /><span style="height: 1.6em" class="line">&#124;<span style="color: #99cc99" class="string">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>&#124;</span><br /><span style="height: 1.6em" class="line">+------+</span><br /><span style="height: 1.6em" class="line">&#124;<span style="color: #99cc99" class="string"> 3&nbsp;&nbsp;&nbsp;&nbsp;</span>&#124;<span style="color: #99cc99" class="string">&nbsp;&nbsp; </span>&#124;<span style="color: #99cc99" class="string">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>&#124;</span><br /><span style="height: 1.6em" class="line">+------+&nbsp;&nbsp; +------+</span><br /><span style="height: 1.6em" class="line">&#124;<span style="color: #99cc99" class="string"> 2&nbsp;&nbsp;&nbsp;&nbsp;</span>&#124;<span style="color: #99cc99" class="string">&nbsp;&nbsp; </span>&#124;<span style="color: #99cc99" class="string"> +&nbsp;&nbsp;&nbsp;&nbsp;</span>&#124;</span><br /><span style="height: 1.6em" class="line">+------+&nbsp;&nbsp; +------+</span><br /><br /><span style="height: 1.6em" class="line">// after step 4</span><br /><span style="height: 1.6em" class="line">&#124;<span style="color: #99cc99" class="string">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>&#124;<span style="color: #99cc99" class="string">&nbsp;&nbsp; </span>&#124;<span style="color: #99cc99" class="string">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>&#124;</span><br /><span style="height: 1.6em" class="line">+------+&nbsp;&nbsp; +------+</span><br /><span style="height: 1.6em" class="line">&#124;<span style="color: #99cc99" class="string"> 5&nbsp;&nbsp;&nbsp;&nbsp;</span>&#124;<span style="color: #99cc99" class="string">&nbsp;&nbsp; </span>&#124;<span style="color: #99cc99" class="string"> -&nbsp;&nbsp;&nbsp;&nbsp;</span>&#124;</span><br /><span style="height: 1.6em" class="line">+------+&nbsp;&nbsp; +------+</span><br /><br /><span style="height: 1.6em" class="line">// after step 7</span><br /><span style="height: 1.6em" class="line">&#124;<span style="color: #99cc99" class="string">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>&#124;</span><br /><span style="height: 1.6em" class="line">+------+</span><br /><span style="height: 1.6em" class="line">&#124;<span style="color: #99cc99" class="string"> 5&nbsp;&nbsp;&nbsp;&nbsp;</span>&#124;</span><br /><span style="height: 1.6em" class="line">+------+&nbsp;&nbsp; +------+</span><br /><span style="height: 1.6em" class="line">&#124;<span style="color: #99cc99" class="string"> 4&nbsp;&nbsp;&nbsp;&nbsp;</span>&#124;<span style="color: #99cc99" class="string">&nbsp;&nbsp; </span>&#124;<span style="color: #99cc99" class="string"> *&nbsp;&nbsp;&nbsp;&nbsp;</span>&#124;</span><br /><span style="height: 1.6em" class="line">+------+&nbsp;&nbsp; +------+</span><br /><span style="height: 1.6em" class="line">&#124;<span style="color: #99cc99" class="string"> 5&nbsp;&nbsp;&nbsp;&nbsp;</span>&#124;<span style="color: #99cc99" class="string">&nbsp;&nbsp; </span>&#124;<span style="color: #99cc99" class="string"> -&nbsp;&nbsp;&nbsp;&nbsp;</span>&#124;</span><br /><span style="height: 1.6em" class="line">+------+&nbsp;&nbsp; +------+</span><br /></pre></td></tr></tbody></table><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">综上，在计算一个运算符&lsquo;x&rsquo;之前，必须先查看它的右方，找出并计算所有优先级大于&lsquo;x&rsquo;的运算符，之后再计算运算符&lsquo;x&rsquo;。</p><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">最后注意的是优先通常只与多元运算符相关，单元运算符往往没有这个问题（因为只有一个参数）。也可以认为&ldquo;优先级&rdquo;的实质就是两个运算符在抢参数。</p><h1 style="margin: 0.67em 0px; font-family: 'Helvetica Neue', 'WenQuanYi Micro Hei', Heiti, Impact, Charcoal, sans-serif; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #333333; padding: 3px 0px; color: #333333"><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" href="javascript:if(confirm('http://lotabout.me/2016/write-a-C-interpreter-8/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2016/write-a-C-interpreter-8/#u4E00_u5143_u8FD0_u7B97_u7B26'" tppabs="http://lotabout.me/2016/write-a-C-interpreter-8/#u4E00_u5143_u8FD0_u7B97_u7B26" title="一元运算符" class="headerlink"></a>一元运算符</h1><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">上节中说到了运算符的优先级，也提到了优先级一般只与多元运算符有关，这也意味着一元运算符的优先级总是高于多元运算符。因为我们需要先对它们进行解析。</p><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">当然，这部分也将同时解析参数本身（如变量、数字、字符串等等）。</p><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">关于表达式的解析，与语法分析相关的部分就是上文所说的优先级问题了，而剩下的较难较烦的部分是与目标代码的生成有关的。因此对于需要讲解的运算符，我们主要从它的目标代码入手。</p><h2 style="font-family: 'Helvetica Neue', 'WenQuanYi Micro Hei', Heiti, Impact, Charcoal, sans-serif; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #cccccc; color: #333333"><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" href="javascript:if(confirm('http://lotabout.me/2016/write-a-C-interpreter-8/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2016/write-a-C-interpreter-8/#u5E38_u91CF'" tppabs="http://lotabout.me/2016/write-a-C-interpreter-8/#u5E38_u91CF" title="常量" class="headerlink"></a>常量</h2><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">首先是数字，用&nbsp;IMM&nbsp;指令将它加载到&nbsp;AX&nbsp;中即可：</p><table border="0" style="border-collapse: collapse; border-spacing: 0px; width: auto; vertical-align: middle; margin: 0px"><tbody><tr><td class="code" style="padding: 0px; border: none"><pre style="overflow: auto; font-family: 'Source Code Pro', Consolas, Monaco, Menlo, Consolas, monospace; font-size: 16px; margin-top: 0px; margin-bottom: 0px; padding: 0px; border: none; border-radius: 2px; color: #cccccc; line-height: 1.6em; background-image: initial; background-attachment: initial; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial"><span style="height: 1.6em" class="line"><span style="color: #cc99cc" class="keyword">if</span> (token == Num) &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;match(Num);</span><br /><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// emit code</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;*++text = IMM;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;*++text = token_val;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;expr_type = INT;</span><br /><span style="height: 1.6em" class="line">&#125;</span><br /></pre></td></tr></tbody></table><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">接着是字符串常量。它比较特殊的一点是 C 语言的字符串常量支持如下风格：</p><table border="0" style="border-collapse: collapse; border-spacing: 0px; width: auto; vertical-align: middle; margin: 0px"><tbody><tr><td class="code" style="padding: 0px; border: none"><pre style="overflow: auto; font-family: 'Source Code Pro', Consolas, Monaco, Menlo, Consolas, monospace; font-size: 16px; margin-top: 0px; margin-bottom: 0px; padding: 0px; border: none; border-radius: 2px; color: #cccccc; line-height: 1.6em; background-image: initial; background-attachment: initial; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial"><span style="height: 1.6em" class="line"><span style="color: #cc99cc" class="keyword">char</span> *p;</span><br /><span style="height: 1.6em" class="line">p = <span style="color: #99cc99" class="string">&quot;first line&quot;</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #99cc99" class="string">&quot;second line&quot;</span>;</span><br /></pre></td></tr></tbody></table><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">即跨行的字符串拼接，它相当于：</p><table border="0" style="border-collapse: collapse; border-spacing: 0px; width: auto; vertical-align: middle; margin: 0px"><tbody><tr><td class="code" style="padding: 0px; border: none"><pre style="overflow: auto; font-family: 'Source Code Pro', Consolas, Monaco, Menlo, Consolas, monospace; font-size: 16px; margin-top: 0px; margin-bottom: 0px; padding: 0px; border: none; border-radius: 2px; color: #cccccc; line-height: 1.6em; background-image: initial; background-attachment: initial; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial"><span style="height: 1.6em" class="line"><span style="color: #cc99cc" class="keyword">char</span> *p;</span><br /><span style="height: 1.6em" class="line">p = <span style="color: #99cc99" class="string">&quot;first linesecond line&quot;</span>;</span><br /></pre></td></tr></tbody></table><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">所以解析的时候要注意这一点：</p><table border="0" style="border-collapse: collapse; border-spacing: 0px; width: auto; vertical-align: middle; margin: 0px"><tbody><tr><td class="code" style="padding: 0px; border: none"><pre style="overflow: auto; font-family: 'Source Code Pro', Consolas, Monaco, Menlo, Consolas, monospace; font-size: 16px; margin-top: 0px; margin-bottom: 0px; padding: 0px; border: none; border-radius: 2px; color: #cccccc; line-height: 1.6em; background-image: initial; background-attachment: initial; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial"><span style="height: 1.6em" class="line"><span style="color: #cc99cc" class="keyword">else</span> <span style="color: #cc99cc" class="keyword">if</span> (token == <span style="color: #99cc99" class="string">'&quot;'</span>) &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// emit code</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;*++text = IMM;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;*++text = token_val;</span><br /><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;match(<span style="color: #99cc99" class="string">'&quot;'</span>);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// store the rest strings</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cc99cc" class="keyword">while</span> (token == <span style="color: #99cc99" class="string">'&quot;'</span>) &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match(<span style="color: #99cc99" class="string">'&quot;'</span>);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&#125;</span><br /><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// append the end of string character '&#92;0', all the data are default</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// to 0, so just move data one position forward.</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;data = (<span style="color: #cc99cc" class="keyword">char</span> *)(((<span style="color: #cc99cc" class="keyword">int</span>)data + <span style="color: #cc99cc" class="keyword">sizeof</span>(<span style="color: #cc99cc" class="keyword">int</span>)) &amp; (-<span style="color: #cc99cc" class="keyword">sizeof</span>(<span style="color: #cc99cc" class="keyword">int</span>)));</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;expr_type = PTR;</span><br /><span style="height: 1.6em" class="line">&#125;</span><br /></pre></td></tr></tbody></table><h2 style="font-family: 'Helvetica Neue', 'WenQuanYi Micro Hei', Heiti, Impact, Charcoal, sans-serif; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #cccccc; color: #333333"><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" href="javascript:if(confirm('http://lotabout.me/2016/write-a-C-interpreter-8/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2016/write-a-C-interpreter-8/#sizeof'" tppabs="http://lotabout.me/2016/write-a-C-interpreter-8/#sizeof" title="sizeof" class="headerlink"></a>sizeof</h2><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">sizeof&nbsp;是一个一元运算符，我们需要知道后面参数的类型，类型的解析在前面的文章中我们已经很熟悉了。</p><table border="0" style="border-collapse: collapse; border-spacing: 0px; width: auto; vertical-align: middle; margin: 0px"><tbody><tr><td class="code" style="padding: 0px; border: none"><pre style="overflow: auto; font-family: 'Source Code Pro', Consolas, Monaco, Menlo, Consolas, monospace; font-size: 16px; margin-top: 0px; margin-bottom: 0px; padding: 0px; border: none; border-radius: 2px; color: #cccccc; line-height: 1.6em; background-image: initial; background-attachment: initial; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial"><span style="height: 1.6em" class="line"><span style="color: #cc99cc" class="keyword">else</span> <span style="color: #cc99cc" class="keyword">if</span> (token == Sizeof) &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// sizeof is actually an unary operator</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// now only `sizeof(int)`, `sizeof(char)` and `sizeof(*...)` are</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// supported.</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;match(Sizeof);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;match(<span style="color: #99cc99" class="string">'('</span>);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;expr_type = INT;</span><br /><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cc99cc" class="keyword">if</span> (token == Int) &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match(Int);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&#125; <span style="color: #cc99cc" class="keyword">else</span> <span style="color: #cc99cc" class="keyword">if</span> (token == Char) &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match(Char);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expr_type = CHAR;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&#125;</span><br /><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cc99cc" class="keyword">while</span> (token == Mul) &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match(Mul);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expr_type = expr_type + PTR;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&#125;</span><br /><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;match(<span style="color: #99cc99" class="string">')'</span>);</span><br /><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// emit code</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;*++text = IMM;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;*++text = (expr_type == CHAR) ? <span style="color: #cc99cc" class="keyword">sizeof</span>(<span style="color: #cc99cc" class="keyword">char</span>) : <span style="color: #cc99cc" class="keyword">sizeof</span>(<span style="color: #cc99cc" class="keyword">int</span>);</span><br /><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;expr_type = INT;</span><br /><span style="height: 1.6em" class="line">&#125;</span><br /></pre></td></tr></tbody></table><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">注意的是只支持&nbsp;sizeof(int)，sizeof(char)&nbsp;及&nbsp;sizeof(pointer type...)。并且它的结果是int&nbsp;型。</p><h2 style="font-family: 'Helvetica Neue', 'WenQuanYi Micro Hei', Heiti, Impact, Charcoal, sans-serif; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #cccccc; color: #333333"><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" href="javascript:if(confirm('http://lotabout.me/2016/write-a-C-interpreter-8/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2016/write-a-C-interpreter-8/#u53D8_u91CF_u4E0E_u51FD_u6570_u8C03_u7528'" tppabs="http://lotabout.me/2016/write-a-C-interpreter-8/#u53D8_u91CF_u4E0E_u51FD_u6570_u8C03_u7528" title="变量与函数调用" class="headerlink"></a>变量与函数调用</h2><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">由于取变量的值与函数的调用都是以&nbsp;Id&nbsp;标记开头的，因此将它们放在一起处理。</p><table border="0" style="border-collapse: collapse; border-spacing: 0px; width: auto; vertical-align: middle; margin: 0px"><tbody><tr><td class="code" style="padding: 0px; border: none"><pre style="overflow: auto; font-family: 'Source Code Pro', Consolas, Monaco, Menlo, Consolas, monospace; font-size: 16px; margin-top: 0px; margin-bottom: 0px; padding: 0px; border: none; border-radius: 2px; color: #cccccc; line-height: 1.6em; background-image: initial; background-attachment: initial; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial"><span style="height: 1.6em" class="line"><span style="color: #cc99cc" class="keyword">else</span> <span style="color: #cc99cc" class="keyword">if</span> (token == Id) &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// there are several type when occurs to Id</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// but this is unit, so it can only be</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// 1. function call</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// 2. Enum variable</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// 3. global/local variable</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;match(Id);</span><br /><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;id = current_id;</span><br /><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cc99cc" class="keyword">if</span> (token == <span style="color: #99cc99" class="string">'('</span>) &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// function call</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match(<span style="color: #99cc99" class="string">'('</span>);</span><br /><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// ①</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// pass in arguments</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tmp = <span style="color: #f99157" class="number">0</span>; <span style="color: #999999" class="comment">// number of arguments</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cc99cc" class="keyword">while</span> (token != <span style="color: #99cc99" class="string">')'</span>) &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expression(Assign);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*++text = PUSH;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tmp ++;</span><br /><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cc99cc" class="keyword">if</span> (token == <span style="color: #99cc99" class="string">','</span>) &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match(<span style="color: #99cc99" class="string">','</span>);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match(<span style="color: #99cc99" class="string">')'</span>);</span><br /><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// ②</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// emit code</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cc99cc" class="keyword">if</span> (id[Class] == Sys) &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// system functions</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*++text = id[Value];</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cc99cc" class="keyword">else</span> <span style="color: #cc99cc" class="keyword">if</span> (id[Class] == Fun) &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// function call</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*++text = CALL;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*++text = id[Value];</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cc99cc" class="keyword">else</span> &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #f99157" class="built_in">printf</span>(<span style="color: #99cc99" class="string">&quot;%d: bad function call&#92;n&quot;</span>, line);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #f99157" class="built_in">exit</span>(-<span style="color: #f99157" class="number">1</span>);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125;</span><br /><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// ③</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// clean the stack for arguments</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cc99cc" class="keyword">if</span> (tmp &gt; <span style="color: #f99157" class="number">0</span>) &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*++text = ADJ;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*++text = tmp;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expr_type = id[Type];</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&#125;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cc99cc" class="keyword">else</span> <span style="color: #cc99cc" class="keyword">if</span> (id[Class] == Num) &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// ④</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// enum variable</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*++text = IMM;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*++text = id[Value];</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expr_type = INT;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&#125;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cc99cc" class="keyword">else</span> &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// ⑤</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// variable</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cc99cc" class="keyword">if</span> (id[Class] == Loc) &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*++text = LEA;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*++text = index_of_bp - id[Value];</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cc99cc" class="keyword">else</span> <span style="color: #cc99cc" class="keyword">if</span> (id[Class] == Glo) &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*++text = IMM;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*++text = id[Value];</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cc99cc" class="keyword">else</span> &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #f99157" class="built_in">printf</span>(<span style="color: #99cc99" class="string">&quot;%d: undefined variable&#92;n&quot;</span>, line);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #f99157" class="built_in">exit</span>(-<span style="color: #f99157" class="number">1</span>);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125;</span><br /><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">//⑥</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// emit code, default behaviour is to load the value of the</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// address which is stored in `ax`</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expr_type = id[Type];</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*++text = (expr_type == Char) ? LC : LI;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&#125;</span><br /><span style="height: 1.6em" class="line">&#125;</span><br /></pre></td></tr></tbody></table><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">①中注意我们是顺序将参数入栈，这和第三章：虚拟机中讲解的指令是对应的。与之不同，标准 C 是逆序将参数入栈的。</p><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">②中判断函数的类型，同样在第三章：&ldquo;虚拟机&rdquo;中我们介绍过内置函数的支持，如&nbsp;printf,read,&nbsp;malloc&nbsp;等等。内置函数有对应的汇编指令，而普通的函数则编译成&nbsp;CALL &lt;addr&gt;&nbsp;的形式。</p><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">③用于清除入栈的参数。因为我们不在乎出栈的值，所以直接修改栈指针的大小即可。</p><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">④：当该标识符是全局定义的枚举类型时，直接将对应的值用&nbsp;IMM&nbsp;指令存入&nbsp;AX&nbsp;即可。</p><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">⑤则是用于加载变量的值，如果是局部变量则采用与&nbsp;bp&nbsp;指针相对位置的形式（参见第 7章函数定义）。而如果是全局变量则用&nbsp;IMM&nbsp;加载变量的地址。</p><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">⑥：无论是全局还是局部变量，最终都根据它们的类型用&nbsp;LC&nbsp;或&nbsp;LI&nbsp;指令加载对应的值。</p><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">关于变量，你可能有疑问，如果遇到标识符就用&nbsp;LC/LI&nbsp;载入相应的值，那诸如&nbsp;a[10]&nbsp;之类的表达式要如何实现呢？后面我们会看到，根据标识符后的运算符，我们可能会修改或删除现有的&nbsp;LC/LI&nbsp;指令。</p><h2 style="font-family: 'Helvetica Neue', 'WenQuanYi Micro Hei', Heiti, Impact, Charcoal, sans-serif; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #cccccc; color: #333333"><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" href="javascript:if(confirm('http://lotabout.me/2016/write-a-C-interpreter-8/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2016/write-a-C-interpreter-8/#u5F3A_u5236_u8F6C_u6362'" tppabs="http://lotabout.me/2016/write-a-C-interpreter-8/#u5F3A_u5236_u8F6C_u6362" title="强制转换" class="headerlink"></a>强制转换</h2><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">虽然我们前面没有提到，但我们一直用&nbsp;expr_type&nbsp;来保存一个表达式的类型，强制转换的作用是获取转换的类型，并直接修改&nbsp;expr_type&nbsp;的值。</p><table border="0" style="border-collapse: collapse; border-spacing: 0px; width: auto; vertical-align: middle; margin: 0px"><tbody><tr><td class="code" style="padding: 0px; border: none"><pre style="overflow: auto; font-family: 'Source Code Pro', Consolas, Monaco, Menlo, Consolas, monospace; font-size: 16px; margin-top: 0px; margin-bottom: 0px; padding: 0px; border: none; border-radius: 2px; color: #cccccc; line-height: 1.6em; background-image: initial; background-attachment: initial; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial"><span style="height: 1.6em" class="line"><span style="color: #cc99cc" class="keyword">else</span> <span style="color: #cc99cc" class="keyword">if</span> (token == <span style="color: #99cc99" class="string">'('</span>) &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// cast or parenthesis</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;match(<span style="color: #99cc99" class="string">'('</span>);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cc99cc" class="keyword">if</span> (token == Int &#124;&#124; token == Char) &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tmp = (token == Char) ? CHAR : INT; <span style="color: #999999" class="comment">// cast type</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match(token);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cc99cc" class="keyword">while</span> (token == Mul) &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match(Mul);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tmp = tmp + PTR;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125;</span><br /><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match(<span style="color: #99cc99" class="string">')'</span>);</span><br /><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expression(Inc); <span style="color: #999999" class="comment">// cast has precedence as Inc(++)</span></span><br /><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expr_type&nbsp;&nbsp;= tmp;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&#125; <span style="color: #cc99cc" class="keyword">else</span> &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// normal parenthesis</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expression(Assign);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match(<span style="color: #99cc99" class="string">')'</span>);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&#125;</span><br /><span style="height: 1.6em" class="line">&#125;</span><br /></pre></td></tr></tbody></table><h2 style="font-family: 'Helvetica Neue', 'WenQuanYi Micro Hei', Heiti, Impact, Charcoal, sans-serif; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #cccccc; color: #333333"><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" href="javascript:if(confirm('http://lotabout.me/2016/write-a-C-interpreter-8/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2016/write-a-C-interpreter-8/#u6307_u9488_u53D6_u503C'" tppabs="http://lotabout.me/2016/write-a-C-interpreter-8/#u6307_u9488_u53D6_u503C" title="指针取值" class="headerlink"></a>指针取值</h2><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">诸如&nbsp;*a&nbsp;的指针取值，关键是判断&nbsp;a&nbsp;的类型，而就像上节中提到的，当一个表达式解析结束时，它的类型保存在变量&nbsp;expr_type&nbsp;中。</p><table border="0" style="border-collapse: collapse; border-spacing: 0px; width: auto; vertical-align: middle; margin: 0px"><tbody><tr><td class="code" style="padding: 0px; border: none"><pre style="overflow: auto; font-family: 'Source Code Pro', Consolas, Monaco, Menlo, Consolas, monospace; font-size: 16px; margin-top: 0px; margin-bottom: 0px; padding: 0px; border: none; border-radius: 2px; color: #cccccc; line-height: 1.6em; background-image: initial; background-attachment: initial; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial"><span style="height: 1.6em" class="line"><span style="color: #cc99cc" class="keyword">else</span> <span style="color: #cc99cc" class="keyword">if</span> (token == Mul) &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// dereference *&lt;addr&gt;</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;match(Mul);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;expression(Inc); <span style="color: #999999" class="comment">// dereference has the same precedence as Inc(++)</span></span><br /><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cc99cc" class="keyword">if</span> (expr_type &gt;= PTR) &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expr_type = expr_type - PTR;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&#125; <span style="color: #cc99cc" class="keyword">else</span> &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #f99157" class="built_in">printf</span>(<span style="color: #99cc99" class="string">&quot;%d: bad dereference&#92;n&quot;</span>, line);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #f99157" class="built_in">exit</span>(-<span style="color: #f99157" class="number">1</span>);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&#125;</span><br /><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;*++text = (expr_type == CHAR) ? LC : LI;</span><br /><span style="height: 1.6em" class="line">&#125;</span><br /></pre></td></tr></tbody></table><h2 style="font-family: 'Helvetica Neue', 'WenQuanYi Micro Hei', Heiti, Impact, Charcoal, sans-serif; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #cccccc; color: #333333"><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" href="javascript:if(confirm('http://lotabout.me/2016/write-a-C-interpreter-8/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2016/write-a-C-interpreter-8/#u53D6_u5740_u64CD_u4F5C'" tppabs="http://lotabout.me/2016/write-a-C-interpreter-8/#u53D6_u5740_u64CD_u4F5C" title="取址操作" class="headerlink"></a>取址操作</h2><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">这里我们就能看到&ldquo;变量与函数调用&rdquo;一节中所说的修改或删除&nbsp;LC/LI&nbsp;指令了。前文中我们说到，对于变量，我们会先加载它的地址，并根据它们类型使用&nbsp;LC/LI&nbsp;指令加载实际内容，例如对变量&nbsp;a：</p><table border="0" style="border-collapse: collapse; border-spacing: 0px; width: auto; vertical-align: middle; margin: 0px"><tbody><tr><td class="code" style="padding: 0px; border: none"><pre style="overflow: auto; font-family: 'Source Code Pro', Consolas, Monaco, Menlo, Consolas, monospace; font-size: 16px; margin-top: 0px; margin-bottom: 0px; padding: 0px; border: none; border-radius: 2px; color: #cccccc; line-height: 1.6em; background-image: initial; background-attachment: initial; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial"><span style="height: 1.6em" class="line"><span class="label">IMM</span> &lt;<span style="color: #cc99cc" class="keyword">addr&gt;</span><br /><span class="label">LI</span></span><br /></pre></td></tr></tbody></table><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">那么对变量&nbsp;a&nbsp;取址，其实只要不执行&nbsp;LC/LI&nbsp;即可。因此我们删除相应的指令。</p><table border="0" style="border-collapse: collapse; border-spacing: 0px; width: auto; vertical-align: middle; margin: 0px"><tbody><tr><td class="code" style="padding: 0px; border: none"><pre style="overflow: auto; font-family: 'Source Code Pro', Consolas, Monaco, Menlo, Consolas, monospace; font-size: 16px; margin-top: 0px; margin-bottom: 0px; padding: 0px; border: none; border-radius: 2px; color: #cccccc; line-height: 1.6em; background-image: initial; background-attachment: initial; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial"><span style="height: 1.6em" class="line"><span style="color: #cc99cc" class="keyword">else</span> <span style="color: #cc99cc" class="keyword">if</span> (token == And) &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// get the address of</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;match(And);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;expression(Inc); <span style="color: #999999" class="comment">// get the address of</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cc99cc" class="keyword">if</span> (*text == LC &#124;&#124; *text == LI) &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text --;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&#125; <span style="color: #cc99cc" class="keyword">else</span> &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #f99157" class="built_in">printf</span>(<span style="color: #99cc99" class="string">&quot;%d: bad address of&#92;n&quot;</span>, line);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #f99157" class="built_in">exit</span>(-<span style="color: #f99157" class="number">1</span>);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&#125;</span><br /><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;expr_type = expr_type + PTR;</span><br /><span style="height: 1.6em" class="line">&#125;</span><br /></pre></td></tr></tbody></table><h2 style="font-family: 'Helvetica Neue', 'WenQuanYi Micro Hei', Heiti, Impact, Charcoal, sans-serif; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #cccccc; color: #333333"><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" href="javascript:if(confirm('http://lotabout.me/2016/write-a-C-interpreter-8/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2016/write-a-C-interpreter-8/#u903B_u8F91_u53D6_u53CD'" tppabs="http://lotabout.me/2016/write-a-C-interpreter-8/#u903B_u8F91_u53D6_u53CD" title="逻辑取反" class="headerlink"></a>逻辑取反</h2><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">我们没有直接的逻辑取反指令，因此我们判断它是否与数字 0 相等。而数字 0 代表了逻辑 &ldquo;False&rdquo;。</p><table border="0" style="border-collapse: collapse; border-spacing: 0px; width: auto; vertical-align: middle; margin: 0px"><tbody><tr><td class="code" style="padding: 0px; border: none"><pre style="overflow: auto; font-family: 'Source Code Pro', Consolas, Monaco, Menlo, Consolas, monospace; font-size: 16px; margin-top: 0px; margin-bottom: 0px; padding: 0px; border: none; border-radius: 2px; color: #cccccc; line-height: 1.6em; background-image: initial; background-attachment: initial; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial"><span style="height: 1.6em" class="line"><span style="color: #cc99cc" class="keyword">else</span> <span style="color: #cc99cc" class="keyword">if</span> (token == <span style="color: #99cc99" class="string">'!'</span>) &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// not</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;match(<span style="color: #99cc99" class="string">'!'</span>);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;expression(Inc);</span><br /><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// emit code, use &lt;expr&gt; == 0</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;*++text = PUSH;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;*++text = IMM;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;*++text = <span style="color: #f99157" class="number">0</span>;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;*++text = EQ;</span><br /><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;expr_type = INT;</span><br /><span style="height: 1.6em" class="line">&#125;</span><br /></pre></td></tr></tbody></table><h2 style="font-family: 'Helvetica Neue', 'WenQuanYi Micro Hei', Heiti, Impact, Charcoal, sans-serif; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #cccccc; color: #333333"><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" href="javascript:if(confirm('http://lotabout.me/2016/write-a-C-interpreter-8/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2016/write-a-C-interpreter-8/#u6309_u4F4D_u53D6_u53CD'" tppabs="http://lotabout.me/2016/write-a-C-interpreter-8/#u6309_u4F4D_u53D6_u53CD" title="按位取反" class="headerlink"></a>按位取反</h2><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">同样我们没有相应的指令，所以我们用异或来实现，即&nbsp;~a = a ^ 0xFFFF。</p><table border="0" style="border-collapse: collapse; border-spacing: 0px; width: auto; vertical-align: middle; margin: 0px"><tbody><tr><td class="code" style="padding: 0px; border: none"><pre style="overflow: auto; font-family: 'Source Code Pro', Consolas, Monaco, Menlo, Consolas, monospace; font-size: 16px; margin-top: 0px; margin-bottom: 0px; padding: 0px; border: none; border-radius: 2px; color: #cccccc; line-height: 1.6em; background-image: initial; background-attachment: initial; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial"><span style="height: 1.6em" class="line"><span style="color: #cc99cc" class="keyword">else</span> <span style="color: #cc99cc" class="keyword">if</span> (token == <span style="color: #99cc99" class="string">'~'</span>) &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// bitwise not</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;match(<span style="color: #99cc99" class="string">'~'</span>);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;expression(Inc);</span><br /><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// emit code, use &lt;expr&gt; XOR -1</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;*++text = PUSH;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;*++text = IMM;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;*++text = -<span style="color: #f99157" class="number">1</span>;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;*++text = XOR;</span><br /><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;expr_type = INT;</span><br /><span style="height: 1.6em" class="line">&#125;</span><br /></pre></td></tr></tbody></table><h2 style="font-family: 'Helvetica Neue', 'WenQuanYi Micro Hei', Heiti, Impact, Charcoal, sans-serif; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #cccccc; color: #333333"><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" href="javascript:if(confirm('http://lotabout.me/2016/write-a-C-interpreter-8/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2016/write-a-C-interpreter-8/#u6B63_u8D1F_u53F7'" tppabs="http://lotabout.me/2016/write-a-C-interpreter-8/#u6B63_u8D1F_u53F7" title="正负号" class="headerlink"></a>正负号</h2><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">注意这里并不是四则运算中的加减法，而是单个数字的取正取负操作。同样，我们没有取负的操作，用&nbsp;0 - x&nbsp;来实现&nbsp;-x。</p><table border="0" style="border-collapse: collapse; border-spacing: 0px; width: auto; vertical-align: middle; margin: 0px"><tbody><tr><td class="code" style="padding: 0px; border: none"><pre style="overflow: auto; font-family: 'Source Code Pro', Consolas, Monaco, Menlo, Consolas, monospace; font-size: 16px; margin-top: 0px; margin-bottom: 0px; padding: 0px; border: none; border-radius: 2px; color: #cccccc; line-height: 1.6em; background-image: initial; background-attachment: initial; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial"><span style="height: 1.6em" class="line"><span style="color: #cc99cc" class="keyword">else</span> <span style="color: #cc99cc" class="keyword">if</span> (token == Add) &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// +var, do nothing</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;match(Add);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;expression(Inc);</span><br /><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;expr_type = INT;</span><br /><span style="height: 1.6em" class="line">&#125;</span><br /><span style="height: 1.6em" class="line"><span style="color: #cc99cc" class="keyword">else</span> <span style="color: #cc99cc" class="keyword">if</span> (token == Sub) &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// -var</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;match(Sub);</span><br /><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cc99cc" class="keyword">if</span> (token == Num) &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*++text = IMM;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*++text = -token_val;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match(Num);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&#125; <span style="color: #cc99cc" class="keyword">else</span> &#123;</span><br /><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*++text = IMM;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*++text = -<span style="color: #f99157" class="number">1</span>;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*++text = PUSH;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expression(Inc);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*++text = MUL;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&#125;</span><br /><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;expr_type = INT;</span><br /><span style="height: 1.6em" class="line">&#125;</span><br /></pre></td></tr></tbody></table><h2 style="font-family: 'Helvetica Neue', 'WenQuanYi Micro Hei', Heiti, Impact, Charcoal, sans-serif; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #cccccc; color: #333333"><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" href="javascript:if(confirm('http://lotabout.me/2016/write-a-C-interpreter-8/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2016/write-a-C-interpreter-8/#u81EA_u589E_u81EA_u51CF'" tppabs="http://lotabout.me/2016/write-a-C-interpreter-8/#u81EA_u589E_u81EA_u51CF" title="自增自减" class="headerlink"></a>自增自减</h2><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">注意的是自增自减操作的优先级是和它的位置有关的。如&nbsp;++p&nbsp;的优先级高于&nbsp;p++，这里我们解析的就是类似&nbsp;++p&nbsp;的操作。</p><table border="0" style="border-collapse: collapse; border-spacing: 0px; width: auto; vertical-align: middle; margin: 0px"><tbody><tr><td class="code" style="padding: 0px; border: none"><pre style="overflow: auto; font-family: 'Source Code Pro', Consolas, Monaco, Menlo, Consolas, monospace; font-size: 16px; margin-top: 0px; margin-bottom: 0px; padding: 0px; border: none; border-radius: 2px; color: #cccccc; line-height: 1.6em; background-image: initial; background-attachment: initial; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial"><span style="height: 1.6em" class="line"><span style="color: #cc99cc" class="keyword">else</span> <span style="color: #cc99cc" class="keyword">if</span> (token == Inc &#124;&#124; token == Dec) &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;tmp = token;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;match(token);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;expression(Inc);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// ①</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cc99cc" class="keyword">if</span> (*text == LC) &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*text = PUSH;&nbsp;&nbsp;<span style="color: #999999" class="comment">// to duplicate the address</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*++text = LC;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&#125; <span style="color: #cc99cc" class="keyword">else</span> <span style="color: #cc99cc" class="keyword">if</span> (*text == LI) &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*text = PUSH;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*++text = LI;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&#125; <span style="color: #cc99cc" class="keyword">else</span> &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #f99157" class="built_in">printf</span>(<span style="color: #99cc99" class="string">&quot;%d: bad lvalue of pre-increment&#92;n&quot;</span>, line);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #f99157" class="built_in">exit</span>(-<span style="color: #f99157" class="number">1</span>);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&#125;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;*++text = PUSH;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;*++text = IMM;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// ②</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;*++text = (expr_type &gt; PTR) ? <span style="color: #cc99cc" class="keyword">sizeof</span>(<span style="color: #cc99cc" class="keyword">int</span>) : <span style="color: #cc99cc" class="keyword">sizeof</span>(<span style="color: #cc99cc" class="keyword">char</span>);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;*++text = (tmp == Inc) ? ADD : SUB;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;*++text = (expr_type == CHAR) ? SC : SI;</span><br /><span style="height: 1.6em" class="line">&#125;</span><br /></pre></td></tr></tbody></table><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">对应的汇编代码也比较直观，只是在实现&nbsp;++p时，我们要使用变量&nbsp;p&nbsp;的地址两次，所以我们需要先&nbsp;PUSH&nbsp;（①）。</p><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">②则是因为自增自减操作还需要处理是指针的情形。</p><h1 style="margin: 0.67em 0px; font-family: 'Helvetica Neue', 'WenQuanYi Micro Hei', Heiti, Impact, Charcoal, sans-serif; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #333333; padding: 3px 0px; color: #333333"><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" href="javascript:if(confirm('http://lotabout.me/2016/write-a-C-interpreter-8/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2016/write-a-C-interpreter-8/#u4E8C_u5143_u8FD0_u7B97_u7B26'" tppabs="http://lotabout.me/2016/write-a-C-interpreter-8/#u4E8C_u5143_u8FD0_u7B97_u7B26" title="二元运算符" class="headerlink"></a>二元运算符</h1><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">这里，我们需要处理多运算符的优先级问题，就如前文的&ldquo;优先级&rdquo;一节提到的，我们需要不断地向右扫描，直到遇到优先级&nbsp;<strong>小于</strong>&nbsp;当前优先级的运算符。</p><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">回想起我们之前定义过的各个标记，它们是以优先级从低到高排列的，即&nbsp;Assign&nbsp;的优先级最低，而&nbsp;Brak（[） 的优先级最高。</p><table border="0" style="border-collapse: collapse; border-spacing: 0px; width: auto; vertical-align: middle; margin: 0px"><tbody><tr><td class="code" style="padding: 0px; border: none"><pre style="overflow: auto; font-family: 'Source Code Pro', Consolas, Monaco, Menlo, Consolas, monospace; font-size: 16px; margin-top: 0px; margin-bottom: 0px; padding: 0px; border: none; border-radius: 2px; color: #cccccc; line-height: 1.6em; background-image: initial; background-attachment: initial; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial"><span style="height: 1.6em" class="line"><span style="color: #cc99cc" class="keyword">enum</span> &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;Num = <span style="color: #f99157" class="number">128</span>, Fun, Sys, Glo, Loc, Id,</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;Char, Else, Enum, If, Int, Return, Sizeof, While,</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;Assign, Cond, Lor, Lan, Or, Xor, And, Eq, Ne, Lt, Gt, Le, Ge, Shl, Shr, Add, Sub, Mul, Div, Mod, Inc, Dec, Brak</span><br /><span style="height: 1.6em" class="line">&#125;;</span><br /></pre></td></tr></tbody></table><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">所以，当我们调用&nbsp;expression(level)&nbsp;进行解析的时候，我们其实通过了参数&nbsp;level&nbsp;指定了当前的优先级。在前文的一元运算符处理中也用到了这一点。</p><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">所以，此时的二元运算符的解析的框架为：</p><table border="0" style="border-collapse: collapse; border-spacing: 0px; width: auto; vertical-align: middle; margin: 0px"><tbody><tr><td class="code" style="padding: 0px; border: none"><pre style="overflow: auto; font-family: 'Source Code Pro', Consolas, Monaco, Menlo, Consolas, monospace; font-size: 16px; margin-top: 0px; margin-bottom: 0px; padding: 0px; border: none; border-radius: 2px; color: #cccccc; line-height: 1.6em; background-image: initial; background-attachment: initial; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial"><span style="height: 1.6em" class="line"><span style="color: #cc99cc" class="keyword">while</span> (token &gt;= level) &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// parse token for binary operator and postfix operator</span></span><br /><span style="height: 1.6em" class="line">&#125;</span><br /></pre></td></tr></tbody></table><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">解决了优先级的问题，让我们继续讲解如何把运算符编译成汇编代码吧。</p><h2 style="font-family: 'Helvetica Neue', 'WenQuanYi Micro Hei', Heiti, Impact, Charcoal, sans-serif; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #cccccc; color: #333333"><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" href="javascript:if(confirm('http://lotabout.me/2016/write-a-C-interpreter-8/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2016/write-a-C-interpreter-8/#u8D4B_u503C_u64CD_u4F5C'" tppabs="http://lotabout.me/2016/write-a-C-interpreter-8/#u8D4B_u503C_u64CD_u4F5C" title="赋值操作" class="headerlink"></a>赋值操作</h2><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">赋值操作是优先级最低的运算符。考虑诸如&nbsp;a = (expession)&nbsp;的表达式，在解析&nbsp;=&nbsp;之前，我们已经为变量&nbsp;a&nbsp;生成了如下的汇编代码：</p><table border="0" style="border-collapse: collapse; border-spacing: 0px; width: auto; vertical-align: middle; margin: 0px"><tbody><tr><td class="code" style="padding: 0px; border: none"><pre style="overflow: auto; font-family: 'Source Code Pro', Consolas, Monaco, Menlo, Consolas, monospace; font-size: 16px; margin-top: 0px; margin-bottom: 0px; padding: 0px; border: none; border-radius: 2px; color: #cccccc; line-height: 1.6em; background-image: initial; background-attachment: initial; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial"><span style="height: 1.6em" class="line"><span class="label">IMM</span> &lt;<span style="color: #cc99cc" class="keyword">addr&gt;</span><br /><span class="label">LC</span>/LI</span><br /></pre></td></tr></tbody></table><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">当解析完=右边的表达式后，相应的值会存放在&nbsp;ax&nbsp;中，此时，为了实际将这个值保存起来，我们需要类似下面的汇编代码：</p><table border="0" style="border-collapse: collapse; border-spacing: 0px; width: auto; vertical-align: middle; margin: 0px"><tbody><tr><td class="code" style="padding: 0px; border: none"><pre style="overflow: auto; font-family: 'Source Code Pro', Consolas, Monaco, Menlo, Consolas, monospace; font-size: 16px; margin-top: 0px; margin-bottom: 0px; padding: 0px; border: none; border-radius: 2px; color: #cccccc; line-height: 1.6em; background-image: initial; background-attachment: initial; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial"><span style="height: 1.6em" class="line"><span class="label">IMM</span> &lt;<span style="color: #cc99cc" class="keyword">addr&gt;</span><br /><span style="color: #cc99cc" class="keyword">PUSH</span><br /><span class="label">SC</span>/SI</span><br /></pre></td></tr></tbody></table><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">明白了这点，也就能理解下面的源代码了：</p><table border="0" style="border-collapse: collapse; border-spacing: 0px; width: auto; vertical-align: middle; margin: 0px"><tbody><tr><td class="code" style="padding: 0px; border: none"><pre style="overflow: auto; font-family: 'Source Code Pro', Consolas, Monaco, Menlo, Consolas, monospace; font-size: 16px; margin-top: 0px; margin-bottom: 0px; padding: 0px; border: none; border-radius: 2px; color: #cccccc; line-height: 1.6em; background-image: initial; background-attachment: initial; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial"><span style="height: 1.6em" class="line">tmp = expr_type;</span><br /><span style="height: 1.6em" class="line"><span style="color: #cc99cc" class="keyword">if</span> (token == Assign) &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// var = expr;</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;match(Assign);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cc99cc" class="keyword">if</span> (*text == LC &#124;&#124; *text == LI) &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*text = PUSH; <span style="color: #999999" class="comment">// save the lvalue's pointer</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&#125; <span style="color: #cc99cc" class="keyword">else</span> &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #f99157" class="built_in">printf</span>(<span style="color: #99cc99" class="string">&quot;%d: bad lvalue in assignment&#92;n&quot;</span>, line);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #f99157" class="built_in">exit</span>(-<span style="color: #f99157" class="number">1</span>);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&#125;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;expression(Assign);</span><br /><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;expr_type = tmp;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;*++text = (expr_type == CHAR) ? SC : SI;</span><br /><span style="height: 1.6em" class="line">&#125;</span><br /></pre></td></tr></tbody></table><h2 style="font-family: 'Helvetica Neue', 'WenQuanYi Micro Hei', Heiti, Impact, Charcoal, sans-serif; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #cccccc; color: #333333"><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" href="javascript:if(confirm('http://lotabout.me/2016/write-a-C-interpreter-8/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2016/write-a-C-interpreter-8/#u4E09_u76EE_u8FD0_u7B97_u7B26'" tppabs="http://lotabout.me/2016/write-a-C-interpreter-8/#u4E09_u76EE_u8FD0_u7B97_u7B26" title="三目运算符" class="headerlink"></a>三目运算符</h2><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">这是 C 语言中唯一的一个三元运算符：&nbsp;? :，它相当于一个小型的 If 语句，所以生成的代码也类似于 If 语句，这里就不多作解释。</p><table border="0" style="border-collapse: collapse; border-spacing: 0px; width: auto; vertical-align: middle; margin: 0px"><tbody><tr><td class="code" style="padding: 0px; border: none"><pre style="overflow: auto; font-family: 'Source Code Pro', Consolas, Monaco, Menlo, Consolas, monospace; font-size: 16px; margin-top: 0px; margin-bottom: 0px; padding: 0px; border: none; border-radius: 2px; color: #cccccc; line-height: 1.6em; background-image: initial; background-attachment: initial; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial"><span style="height: 1.6em" class="line"><span style="color: #cc99cc" class="keyword">else</span> <span style="color: #cc99cc" class="keyword">if</span> (token == Cond) &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// expr ? a : b;</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;match(Cond);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;*++text = JZ;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;addr = ++text;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;expression(Assign);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cc99cc" class="keyword">if</span> (token == <span style="color: #99cc99" class="string">':'</span>) &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match(<span style="color: #99cc99" class="string">':'</span>);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&#125; <span style="color: #cc99cc" class="keyword">else</span> &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #f99157" class="built_in">printf</span>(<span style="color: #99cc99" class="string">&quot;%d: missing colon in conditional&#92;n&quot;</span>, line);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #f99157" class="built_in">exit</span>(-<span style="color: #f99157" class="number">1</span>);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&#125;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;*addr = (<span style="color: #cc99cc" class="keyword">int</span>)(text + <span style="color: #f99157" class="number">3</span>);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;*++text = JMP;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;addr = ++text;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;expression(Cond);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;*addr = (<span style="color: #cc99cc" class="keyword">int</span>)(text + <span style="color: #f99157" class="number">1</span>);</span><br /><span style="height: 1.6em" class="line">&#125;</span><br /></pre></td></tr></tbody></table><h2 style="font-family: 'Helvetica Neue', 'WenQuanYi Micro Hei', Heiti, Impact, Charcoal, sans-serif; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #cccccc; color: #333333"><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" href="javascript:if(confirm('http://lotabout.me/2016/write-a-C-interpreter-8/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2016/write-a-C-interpreter-8/#u903B_u8F91_u8FD0_u7B97_u7B26'" tppabs="http://lotabout.me/2016/write-a-C-interpreter-8/#u903B_u8F91_u8FD0_u7B97_u7B26" title="逻辑运算符" class="headerlink"></a>逻辑运算符</h2><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">这包括&nbsp;&#124;&#124;&nbsp;和&nbsp;&amp;&amp;。它们对应的汇编代码如下：</p><table border="0" style="border-collapse: collapse; border-spacing: 0px; width: auto; vertical-align: middle; margin: 0px"><tbody><tr><td class="code" style="padding: 0px; border: none"><pre style="overflow: auto; font-family: 'Source Code Pro', Consolas, Monaco, Menlo, Consolas, monospace; font-size: 16px; margin-top: 0px; margin-bottom: 0px; padding: 0px; border: none; border-radius: 2px; color: #cccccc; line-height: 1.6em; background-image: initial; background-attachment: initial; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial"><span style="height: 1.6em" class="line"><span style="color: #f2777a" class="tag">&lt;<span style="color: #999999" class="title">expr1</span>&gt;</span> &#124;&#124; <span style="color: #f2777a" class="tag">&lt;<span style="color: #999999" class="title">expr2</span>&gt;</span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #f2777a" class="tag">&lt;<span style="color: #999999" class="title">expr1</span>&gt;</span> &amp;&amp; <span style="color: #f2777a" class="tag">&lt;<span style="color: #999999" class="title">expr2</span>&gt;</span></span><br /><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;...<span style="color: #f2777a" class="tag">&lt;<span style="color: #999999" class="title">expr1</span>&gt;</span>...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...<span style="color: #f2777a" class="tag">&lt;<span style="color: #999999" class="title">expr1</span>&gt;</span>...</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;JNZ b&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JZ b</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;...<span style="color: #f2777a" class="tag">&lt;<span style="color: #999999" class="title">expr2</span>&gt;</span>...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...<span style="color: #f2777a" class="tag">&lt;<span style="color: #999999" class="title">expr2</span>&gt;</span>...</span><br /><span style="height: 1.6em" class="line">b:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; b:</span><br /></pre></td></tr></tbody></table><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">所以源码如下：</p><table border="0" style="border-collapse: collapse; border-spacing: 0px; width: auto; vertical-align: middle; margin: 0px"><tbody><tr><td class="code" style="padding: 0px; border: none"><pre style="overflow: auto; font-family: 'Source Code Pro', Consolas, Monaco, Menlo, Consolas, monospace; font-size: 16px; margin-top: 0px; margin-bottom: 0px; padding: 0px; border: none; border-radius: 2px; color: #cccccc; line-height: 1.6em; background-image: initial; background-attachment: initial; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial"><span style="height: 1.6em" class="line"><span style="color: #cc99cc" class="keyword">else</span> <span style="color: #cc99cc" class="keyword">if</span> (token == Lor) &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// logic or</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;match(Lor);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;*++text = JNZ;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;addr = ++text;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;expression(Lan);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;*addr = (<span style="color: #cc99cc" class="keyword">int</span>)(text + <span style="color: #f99157" class="number">1</span>);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;expr_type = INT;</span><br /><span style="height: 1.6em" class="line">&#125;</span><br /><span style="height: 1.6em" class="line"><span style="color: #cc99cc" class="keyword">else</span> <span style="color: #cc99cc" class="keyword">if</span> (token == Lan) &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// logic and</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;match(Lan);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;*++text = JZ;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;addr = ++text;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;expression(Or);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;*addr = (<span style="color: #cc99cc" class="keyword">int</span>)(text + <span style="color: #f99157" class="number">1</span>);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;expr_type = INT;</span><br /><span style="height: 1.6em" class="line">&#125;</span><br /></pre></td></tr></tbody></table><h2 style="font-family: 'Helvetica Neue', 'WenQuanYi Micro Hei', Heiti, Impact, Charcoal, sans-serif; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #cccccc; color: #333333"><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" href="javascript:if(confirm('http://lotabout.me/2016/write-a-C-interpreter-8/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2016/write-a-C-interpreter-8/#u6570_u5B66_u8FD0_u7B97_u7B26'" tppabs="http://lotabout.me/2016/write-a-C-interpreter-8/#u6570_u5B66_u8FD0_u7B97_u7B26" title="数学运算符" class="headerlink"></a>数学运算符</h2><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">它们包括&nbsp;&#124;,&nbsp;^,&nbsp;&amp;,&nbsp;==,&nbsp;!=&nbsp;&lt;=,&nbsp;&gt;=,&nbsp;&lt;,&nbsp;&gt;,&nbsp;&lt;&lt;,&nbsp;&gt;&gt;,&nbsp;+,&nbsp;-,&nbsp;*,&nbsp;/,&nbsp;%。它们的实现都很类似，我们以异或&nbsp;^&nbsp;为例：</p><table border="0" style="border-collapse: collapse; border-spacing: 0px; width: auto; vertical-align: middle; margin: 0px"><tbody><tr><td class="code" style="padding: 0px; border: none"><pre style="overflow: auto; font-family: 'Source Code Pro', Consolas, Monaco, Menlo, Consolas, monospace; font-size: 16px; margin-top: 0px; margin-bottom: 0px; padding: 0px; border: none; border-radius: 2px; color: #cccccc; line-height: 1.6em; background-image: initial; background-attachment: initial; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial"><span style="height: 1.6em" class="line">&lt;expr1&gt; ^ &lt;expr2&gt;</span><br /><br /><span style="height: 1.6em" class="line">...&lt;expr1&gt;...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;- now the <span style="color: #f99157" class="literal">result</span> <span style="color: #cc99cc" class="keyword">is</span> on ax</span><br /><span style="height: 1.6em" class="line"><span class="type">PUSH</span></span><br /><span style="height: 1.6em" class="line">...&lt;expr2&gt;...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;- now the value <span style="color: #cc99cc" class="keyword">of</span> &lt;expr2&gt; <span style="color: #cc99cc" class="keyword">is</span> on ax</span><br /><span style="height: 1.6em" class="line"><span class="type">XOR</span></span><br /></pre></td></tr></tbody></table><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">所以它对应的代码为：</p><table border="0" style="border-collapse: collapse; border-spacing: 0px; width: auto; vertical-align: middle; margin: 0px"><tbody><tr><td class="code" style="padding: 0px; border: none"><pre style="overflow: auto; font-family: 'Source Code Pro', Consolas, Monaco, Menlo, Consolas, monospace; font-size: 16px; margin-top: 0px; margin-bottom: 0px; padding: 0px; border: none; border-radius: 2px; color: #cccccc; line-height: 1.6em; background-image: initial; background-attachment: initial; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial"><span style="height: 1.6em" class="line"><span style="color: #cc99cc" class="keyword">else</span> <span style="color: #cc99cc" class="keyword">if</span> (token == Xor) &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// bitwise xor</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;match(Xor);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;*++text = PUSH;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;expression(And);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;*++text = XOR;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;expr_type = INT;</span><br /><span style="height: 1.6em" class="line">&#125;</span><br /></pre></td></tr></tbody></table><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">其它的我们便不再详述。但这当中还有一个问题，就是指针的加减。在 C 语言中，指针加上数值等于将指针移位，且根据不同的类型移动的位移不同。如&nbsp;a + 1，如果&nbsp;a&nbsp;是&nbsp;char *&nbsp;型，则移动一字节，而如果&nbsp;a&nbsp;是&nbsp;int *&nbsp;型，则移动 4 个字节（32位系统）。</p><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">另外，在作指针减法时，如果是两个指针相减（相同类型），则结果是两个指针间隔的元素个数。因此要有特殊的处理。</p><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">下面以加法为例，对应的汇编代码为：</p><table border="0" style="border-collapse: collapse; border-spacing: 0px; width: auto; vertical-align: middle; margin: 0px"><tbody><tr><td class="code" style="padding: 0px; border: none"><pre style="overflow: auto; font-family: 'Source Code Pro', Consolas, Monaco, Menlo, Consolas, monospace; font-size: 16px; margin-top: 0px; margin-bottom: 0px; padding: 0px; border: none; border-radius: 2px; color: #cccccc; line-height: 1.6em; background-image: initial; background-attachment: initial; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial"><span style="height: 1.6em" class="line"><span style="color: #f2777a" class="variable">&lt;expr1&gt;</span> + <span style="color: #f2777a" class="variable">&lt;expr2&gt;</span></span><br /><br /><span style="height: 1.6em" class="line">normal&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pointer</span><br /><br /><span style="height: 1.6em" class="line"><span style="color: #f2777a" class="variable">&lt;expr1&gt;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #f2777a" class="variable">&lt;expr1&gt;</span></span><br /><span style="height: 1.6em" class="line">PUSH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PUSH</span><br /><span style="height: 1.6em" class="line"><span style="color: #f2777a" class="variable">&lt;expr2&gt;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #f2777a" class="variable">&lt;expr2&gt;</span>&nbsp;&nbsp;&nbsp;&nbsp; &#124;<br /><span style="height: 1.6em" class="line">ADD&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PUSH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>&#124;<span style="color: #99cc99" class="string"> &lt;expr2&gt; * &lt;unit&gt;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; IMM &lt;unit&gt;&nbsp;&nbsp;</span>&#124;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MUL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#124;<br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ADD</span></span><br /></pre></td></tr></tbody></table><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">即当&nbsp;&lt;expr1&gt;&nbsp;是指针时，要根据它的类型放大&nbsp;&lt;expr2&gt;&nbsp;的值，因此对应的源码如下：</p><table border="0" style="border-collapse: collapse; border-spacing: 0px; width: auto; vertical-align: middle; margin: 0px"><tbody><tr><td class="code" style="padding: 0px; border: none"><pre style="overflow: auto; font-family: 'Source Code Pro', Consolas, Monaco, Menlo, Consolas, monospace; font-size: 16px; margin-top: 0px; margin-bottom: 0px; padding: 0px; border: none; border-radius: 2px; color: #cccccc; line-height: 1.6em; background-image: initial; background-attachment: initial; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial"><span style="height: 1.6em" class="line"><span style="color: #cc99cc" class="keyword">else</span> <span style="color: #cc99cc" class="keyword">if</span> (token == Add) &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// add</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;match(Add);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;*++text = PUSH;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;expression(Mul);</span><br /><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;expr_type = tmp;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cc99cc" class="keyword">if</span> (expr_type &gt; PTR) &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// pointer type, and not `char *`</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*++text = PUSH;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*++text = IMM;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*++text = <span style="color: #cc99cc" class="keyword">sizeof</span>(<span style="color: #cc99cc" class="keyword">int</span>);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*++text = MUL;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&#125;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;*++text = ADD;</span><br /><span style="height: 1.6em" class="line">&#125;</span><br /></pre></td></tr></tbody></table><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">相应的减法的代码就不贴了，可以自己实现看看，也可以看文末给出的链接。</p><h2 style="font-family: 'Helvetica Neue', 'WenQuanYi Micro Hei', Heiti, Impact, Charcoal, sans-serif; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #cccccc; color: #333333"><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" href="javascript:if(confirm('http://lotabout.me/2016/write-a-C-interpreter-8/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2016/write-a-C-interpreter-8/#u81EA_u589E_u81EA_u51CF-1'" tppabs="http://lotabout.me/2016/write-a-C-interpreter-8/#u81EA_u589E_u81EA_u51CF-1" title="自增自减" class="headerlink"></a>自增自减</h2><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">这次是后缀形式的，即&nbsp;p++&nbsp;或&nbsp;p--。与前缀形式不同的是，在执行自增自减后，&nbsp;ax上需要保留原来的值。所以我们首先执行类似前缀自增自减的操作，再将&nbsp;ax&nbsp;中的值执行减/增的操作。</p><table border="0" style="border-collapse: collapse; border-spacing: 0px; width: auto; vertical-align: middle; margin: 0px"><tbody><tr><td class="code" style="padding: 0px; border: none"><pre style="overflow: auto; font-family: 'Source Code Pro', Consolas, Monaco, Menlo, Consolas, monospace; font-size: 16px; margin-top: 0px; margin-bottom: 0px; padding: 0px; border: none; border-radius: 2px; color: #cccccc; line-height: 1.6em; background-image: initial; background-attachment: initial; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial"><span style="height: 1.6em" class="line"><span style="color: #999999" class="comment">// 前缀形式 生成汇编代码</span></span><br /><span style="height: 1.6em" class="line">*++text = PUSH;</span><br /><span style="height: 1.6em" class="line">*++text = IMM;</span><br /><span style="height: 1.6em" class="line">*++text = (expr_type &gt; PTR) ? <span style="color: #cc99cc" class="keyword">sizeof</span>(<span style="color: #cc99cc" class="keyword">int</span>) : <span style="color: #cc99cc" class="keyword">sizeof</span>(<span style="color: #cc99cc" class="keyword">char</span>);</span><br /><span style="height: 1.6em" class="line">*++text = (tmp == Inc) ? ADD : SUB;</span><br /><span style="height: 1.6em" class="line">*++text = (expr_type == CHAR) ? SC : SI;</span><br /><br /><span style="height: 1.6em" class="line"><span style="color: #999999" class="comment">// 后缀形式 生成汇编代码</span></span><br /><span style="height: 1.6em" class="line">*++text = PUSH;</span><br /><span style="height: 1.6em" class="line">*++text = IMM;</span><br /><span style="height: 1.6em" class="line">*++text = (expr_type &gt; PTR) ? <span style="color: #cc99cc" class="keyword">sizeof</span>(<span style="color: #cc99cc" class="keyword">int</span>) : <span style="color: #cc99cc" class="keyword">sizeof</span>(<span style="color: #cc99cc" class="keyword">char</span>);</span><br /><span style="height: 1.6em" class="line">*++text = (token == Inc) ? ADD : SUB;</span><br /><span style="height: 1.6em" class="line">*++text = (expr_type == CHAR) ? SC : SI;</span><br /><span style="height: 1.6em" class="line">*++text = PUSH;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #999999" class="comment">//</span></span><br /><span style="height: 1.6em" class="line">*++text = IMM;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// 执行相反的增/减操作</span></span><br /><span style="height: 1.6em" class="line">*++text = (expr_type &gt; PTR) ? <span style="color: #cc99cc" class="keyword">sizeof</span>(<span style="color: #cc99cc" class="keyword">int</span>) : <span style="color: #cc99cc" class="keyword">sizeof</span>(<span style="color: #cc99cc" class="keyword">char</span>);&nbsp;&nbsp; <span style="color: #999999" class="comment">//</span></span><br /><span style="height: 1.6em" class="line">*++text = (token == Inc) ? SUB : ADD;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #999999" class="comment">//</span></span><br /></pre></td></tr></tbody></table><h2 style="font-family: 'Helvetica Neue', 'WenQuanYi Micro Hei', Heiti, Impact, Charcoal, sans-serif; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #cccccc; color: #333333"><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" href="javascript:if(confirm('http://lotabout.me/2016/write-a-C-interpreter-8/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2016/write-a-C-interpreter-8/#u6570_u7EC4_u53D6_u503C_u64CD_u4F5C'" tppabs="http://lotabout.me/2016/write-a-C-interpreter-8/#u6570_u7EC4_u53D6_u503C_u64CD_u4F5C" title="数组取值操作" class="headerlink"></a>数组取值操作</h2><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">在学习 C 语言的时候你可能已经知道了，诸如&nbsp;a[10]&nbsp;的操作等价于&nbsp;*(a + 10)。因此我们要做的就是生成类似的汇编代码：</p><table border="0" style="border-collapse: collapse; border-spacing: 0px; width: auto; vertical-align: middle; margin: 0px"><tbody><tr><td class="code" style="padding: 0px; border: none"><pre style="overflow: auto; font-family: 'Source Code Pro', Consolas, Monaco, Menlo, Consolas, monospace; font-size: 16px; margin-top: 0px; margin-bottom: 0px; padding: 0px; border: none; border-radius: 2px; color: #cccccc; line-height: 1.6em; background-image: initial; background-attachment: initial; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial"><span style="height: 1.6em" class="line"><span style="color: #cc99cc" class="keyword">else</span> <span style="color: #cc99cc" class="keyword">if</span> (token == Brak) &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// array access var[xx]</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;match(Brak);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;*++text = PUSH;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;expression(Assign);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;match(<span style="color: #99cc99" class="string">']'</span>);</span><br /><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cc99cc" class="keyword">if</span> (tmp &gt; PTR) &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// pointer, `not char *`</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*++text = PUSH;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*++text = IMM;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*++text = <span style="color: #cc99cc" class="keyword">sizeof</span>(<span style="color: #cc99cc" class="keyword">int</span>);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*++text = MUL;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&#125;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cc99cc" class="keyword">else</span> <span style="color: #cc99cc" class="keyword">if</span> (tmp &lt; PTR) &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #f99157" class="built_in">printf</span>(<span style="color: #99cc99" class="string">&quot;%d: pointer type expected&#92;n&quot;</span>, line);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #f99157" class="built_in">exit</span>(-<span style="color: #f99157" class="number">1</span>);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&#125;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;expr_type = tmp - PTR;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;*++text = ADD;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;*++text = (expr_type == CHAR) ? LC : LI;</span><br /><span style="height: 1.6em" class="line">&#125;</span><br /></pre></td></tr></tbody></table><h1 style="margin: 0.67em 0px; font-family: 'Helvetica Neue', 'WenQuanYi Micro Hei', Heiti, Impact, Charcoal, sans-serif; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #333333; padding: 3px 0px; color: #333333"><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" href="javascript:if(confirm('http://lotabout.me/2016/write-a-C-interpreter-8/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2016/write-a-C-interpreter-8/#u4EE3_u7801'" tppabs="http://lotabout.me/2016/write-a-C-interpreter-8/#u4EE3_u7801" title="代码" class="headerlink"></a>代码</h1><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">除了上述对表达式的解析外，我们还需要初始化虚拟机的栈，我们可以正确调用&nbsp;main&nbsp;函数，且当&nbsp;main&nbsp;函数结束时退出进程。</p><table border="0" style="border-collapse: collapse; border-spacing: 0px; width: auto; vertical-align: middle; margin: 0px"><tbody><tr><td class="code" style="padding: 0px; border: none"><pre style="overflow: auto; font-family: 'Source Code Pro', Consolas, Monaco, Menlo, Consolas, monospace; font-size: 16px; margin-top: 0px; margin-bottom: 0px; padding: 0px; border: none; border-radius: 2px; color: #cccccc; line-height: 1.6em; background-image: initial; background-attachment: initial; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial"><span style="height: 1.6em" class="line"><span style="color: #cc99cc" class="keyword">int</span> *tmp;</span><br /><span style="height: 1.6em" class="line"><span style="color: #999999" class="comment">// setup stack</span></span><br /><span style="height: 1.6em" class="line">sp = (<span style="color: #cc99cc" class="keyword">int</span> *)((<span style="color: #cc99cc" class="keyword">int</span>)<span style="color: #f99157" class="built_in">stack</span> + poolsize);</span><br /><span style="height: 1.6em" class="line">*--sp = EXIT; <span style="color: #999999" class="comment">// call exit if main returns</span></span><br /><span style="height: 1.6em" class="line">*--sp = PUSH; tmp = sp;</span><br /><span style="height: 1.6em" class="line">*--sp = argc;</span><br /><span style="height: 1.6em" class="line">*--sp = (<span style="color: #cc99cc" class="keyword">int</span>)argv;</span><br /><span style="height: 1.6em" class="line">*--sp = (<span style="color: #cc99cc" class="keyword">int</span>)tmp;</span><br /></pre></td></tr></tbody></table><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">当然，最后要注意的一点是：所有的变量定义必须放在语句之前。</p><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">本章的代码可以在&nbsp;<a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" rel="external" href="javascript:if(confirm('https://github.com/lotabout/write-a-C-interpreter/tree/read.php?1262  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='https://github.com/lotabout/write-a-C-interpreter/tree/read.php?1262'" tppabs="https://github.com/lotabout/write-a-C-interpreter/tree/step-6" target="_blank">Github</a>&nbsp;上下载，也可以直接 clone</p><table border="0" style="border-collapse: collapse; border-spacing: 0px; width: auto; vertical-align: middle; margin: 0px"><tbody><tr><td class="code" style="padding: 0px; border: none"><pre style="overflow: auto; font-family: 'Source Code Pro', Consolas, Monaco, Menlo, Consolas, monospace; font-size: 16px; margin-top: 0px; margin-bottom: 0px; padding: 0px; border: none; border-radius: 2px; color: #cccccc; line-height: 1.6em; background-image: initial; background-attachment: initial; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial"><span style="height: 1.6em" class="line">git <span style="color: #cc99cc" class="keyword">clone</span> <span style="color: #999999" class="title">-b</span> step-<span style="color: #f99157" class="number">6</span> https://github.com/lotabout/<span class="operator">write</span>-a-C-interpreter</span><br /></pre></td></tr></tbody></table><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">通过&nbsp;gcc -o xc-tutor xc-tutor.c&nbsp;进行编译。并执行&nbsp;./xc-tutor hello.c&nbsp;查看结果。</p><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">正如我们保证的那样，我们的代码是自举的，能自己编译自己，所以你可以执行&nbsp;./xc-tutor xc-tutor.c hello.c。可以看到和之前有同样的输出。</p><h1 style="margin: 0.67em 0px; font-family: 'Helvetica Neue', 'WenQuanYi Micro Hei', Heiti, Impact, Charcoal, sans-serif; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #333333; padding: 3px 0px; color: #333333"><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" href="javascript:if(confirm('http://lotabout.me/2016/write-a-C-interpreter-8/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2016/write-a-C-interpreter-8/#u5C0F_u7ED3'" tppabs="http://lotabout.me/2016/write-a-C-interpreter-8/#u5C0F_u7ED3" title="小结" class="headerlink"></a>小结</h1><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">本章我们进行了最后的解析，解析表达式。本章有两个难点：</p><ol style="padding-left: 0px; color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px"><li>如何通过递归调用&nbsp;expression&nbsp;来实现运算符的优先级。</li><li>如何为每个运算符生成对应的汇编代码。</li></ol><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">尽管代码看起来比较简单（虽然多），但其中用到的原理还是需要仔细推敲的。</p><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">最后，恭喜你！通过一步步的学习，自己实现了一个C语言的编译器（好吧，是解释器）。</p>
	</div>
	<div class="textbox-bottom">
	</div>
	<div class="tags" style="display: none"> 
	</div>
</div><div class="textbox">
	<div class="textbox-calendar">
	<span class="textbox-calendar-month">Jan</span>
	<span class="textbox-calendar-day">22</span>
	</div>
	<div class="textbox-title">
		<h4>
		<a href="read.php-7065.htm" tppabs="http://i.renjihe.com/blog/read.php?7065">手把手教你构建 C 语言编译器（7）- 语句</a> <span id="starid7065"><img src="unstarred.gif" tppabs="http://i.renjihe.com/blog/template/default/images/others/unstarred.gif" alt="" title="未加星标" border="0"/></span> <img src="blank.gif" tppabs="http://i.renjihe.com/blog/images/weather/blank.gif" alt="不指定" title="不指定"/>
		</h4>
		<div class="textbox-label">
		<a href="view.php-go=user_1.htm" tppabs="http://i.renjihe.com/blog/view.php?go=user_1" target="_blank">renjihe1988</a> , 12:44 , <a href="index.php-go=category_2.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_2" title="查看分类： 软件">软件</a> &raquo; <a href="index.php-go=category_19.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_19" title="查看分类： 编译原理">编译原理</a> , <a href="read.php-7065.htm#reply" tppabs="http://i.renjihe.com/blog/read.php?7065#reply" title="发表您的评论">评论(0)</a> , <a href='javascript: void(0);' title="查看引用地址" onclick='showhidediv("tb7065");'>引用(0)</a> , <a href="read.php-7065.htm" tppabs="http://i.renjihe.com/blog/read.php?7065">阅读(1)</a> , Via 本站原创 
		</div>
	</div>
	<div id="tb7065" style="display: none;" class="textbox-tburl"><strong>引用功能被关闭了。</strong></div>
	
	<div class="textbox-content">
	<p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">整个编译器还剩下最后两个部分：语句和表达式的解析。它们的内容比较多，主要涉及如何将语句和表达式编译成汇编代码。这章讲解语句的解析，相对于表达式来说它还是较为容易的。</p><a id="more" style="outline: none; color: #368ccb; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px; background-color: transparent"></a><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">手把手教你构建 C 语言编译器系列共有10个部分：</p><ol style="padding-left: 0px; color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px"><li><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" rel="external" href="javascript:if(confirm('http://lotabout.me/2015/write-a-C-interpreter-0/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2015/write-a-C-interpreter-0/'" tppabs="http://lotabout.me/2015/write-a-C-interpreter-0/" target="_blank">手把手教你构建 C 语言编译器（0）&mdash;&mdash;前言</a></li><li><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" rel="external" href="javascript:if(confirm('http://lotabout.me/2015/write-a-C-interpreter-1/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2015/write-a-C-interpreter-1/'" tppabs="http://lotabout.me/2015/write-a-C-interpreter-1/" target="_blank">手把手教你构建 C 语言编译器（1）&mdash;&mdash;设计</a></li><li><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" rel="external" href="javascript:if(confirm('http://lotabout.me/2015/write-a-C-interpreter-2/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2015/write-a-C-interpreter-2/'" tppabs="http://lotabout.me/2015/write-a-C-interpreter-2/" target="_blank">手把手教你构建 C 语言编译器（2）&mdash;&mdash;虚拟机</a></li><li><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" rel="external" href="javascript:if(confirm('http://lotabout.me/2015/write-a-C-interpreter-3/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2015/write-a-C-interpreter-3/'" tppabs="http://lotabout.me/2015/write-a-C-interpreter-3/" target="_blank">手把手教你构建 C 语言编译器（3）&mdash;&mdash;词法分析器</a></li><li><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" rel="external" href="javascript:if(confirm('http://lotabout.me/2016/write-a-C-interpreter-4/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2016/write-a-C-interpreter-4/'" tppabs="http://lotabout.me/2016/write-a-C-interpreter-4/" target="_blank">手把手教你构建 C 语言编译器（4）&mdash;&mdash;递归下降</a></li><li><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" rel="external" href="javascript:if(confirm('http://lotabout.me/2016/write-a-C-interpreter-5/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2016/write-a-C-interpreter-5/'" tppabs="http://lotabout.me/2016/write-a-C-interpreter-5/" target="_blank">手把手教你构建 C 语言编译器（5）&mdash;&mdash;变量定义</a></li><li><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" rel="external" href="javascript:if(confirm('http://lotabout.me/2016/write-a-C-interpreter-6/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2016/write-a-C-interpreter-6/'" tppabs="http://lotabout.me/2016/write-a-C-interpreter-6/" target="_blank">手把手教你构建 C 语言编译器（6）&mdash;&mdash;函数定义</a></li><li><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" rel="external" href="javascript:if(confirm('http://lotabout.me/2016/write-a-C-interpreter-7/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2016/write-a-C-interpreter-7/'" tppabs="http://lotabout.me/2016/write-a-C-interpreter-7/" target="_blank">手把手教你构建 C 语言编译器（7）&mdash;&mdash;语句</a></li><li><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" rel="external" href="javascript:if(confirm('http://lotabout.me/2016/write-a-C-interpreter-8/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2016/write-a-C-interpreter-8/'" tppabs="http://lotabout.me/2016/write-a-C-interpreter-8/" target="_blank">手把手教你构建 C 语言编译器（8）&mdash;&mdash;表达式</a></li><li><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" rel="external" href="javascript:if(confirm('http://lotabout.me/2016/write-a-C-interpreter-9/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2016/write-a-C-interpreter-9/'" tppabs="http://lotabout.me/2016/write-a-C-interpreter-9/" target="_blank">手把手教你构建 C 语言编译器（9）&mdash;&mdash;总结</a></li></ol><h1 style="margin: 0.67em 0px; font-family: 'Helvetica Neue', 'WenQuanYi Micro Hei', Heiti, Impact, Charcoal, sans-serif; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #333333; padding: 3px 0px; color: #333333"><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" href="javascript:if(confirm('http://lotabout.me/2016/write-a-C-interpreter-7/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2016/write-a-C-interpreter-7/#u8BED_u53E5'" tppabs="http://lotabout.me/2016/write-a-C-interpreter-7/#u8BED_u53E5" title="语句" class="headerlink"></a>语句</h1><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">C 语言区分&ldquo;语句&rdquo;（statement）和&ldquo;表达式&rdquo;（expression）两个概念。简单地说，可以认为语句就是表达式加上末尾的分号。</p><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">在我们的编译器中共识别 6 种语句：</p><ol style="padding-left: 0px; color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px"><li>if (...) &lt;statement&gt; [else &lt;statement&gt;]</li><li>while (...) &lt;statement&gt;</li><li>&#123; &lt;statement&gt; &#125;</li><li>return xxx;</li><li>&lt;empty statement&gt;;</li><li>expression;&nbsp;(expression end with semicolon)</li></ol><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">它们的语法分析都相对容易，重要的是去理解如何将这些语句编译成汇编代码，下面我们逐一解释。</p><h2 style="font-family: 'Helvetica Neue', 'WenQuanYi Micro Hei', Heiti, Impact, Charcoal, sans-serif; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #cccccc; color: #333333"><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" href="javascript:if(confirm('http://lotabout.me/2016/write-a-C-interpreter-7/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2016/write-a-C-interpreter-7/#IF__u8BED_u53E5'" tppabs="http://lotabout.me/2016/write-a-C-interpreter-7/#IF__u8BED_u53E5" title="IF 语句" class="headerlink"></a>IF 语句</h2><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">IF 语句的作用是跳转，跟据条件表达式决定跳转的位置。我们看看下面的伪代码：</p><table border="0" style="border-collapse: collapse; border-spacing: 0px; width: auto; vertical-align: middle; margin: 0px"><tbody><tr><td class="code" style="padding: 0px; border: none"><pre style="overflow: auto; font-family: 'Source Code Pro', Consolas, Monaco, Menlo, Consolas, monospace; font-size: 16px; margin-top: 0px; margin-bottom: 0px; padding: 0px; border: none; border-radius: 2px; color: #cccccc; line-height: 1.6em; background-image: initial; background-attachment: initial; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial"><span style="height: 1.6em" class="line"><span style="color: #cc99cc" class="keyword">if</span> (...) &lt;statement&gt; [<span style="color: #cc99cc" class="keyword">else</span> &lt;statement&gt;]</span><br /><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;<span style="color: #cc99cc" class="keyword">if</span> (&lt;cond&gt;)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;cond&gt;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JZ <span style="color: #f2777a" class="tag">a</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&lt;true_statement&gt;&nbsp;&nbsp; ===&gt;&nbsp;&nbsp;&nbsp;&nbsp; &lt;true_statement&gt;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;<span style="color: #cc99cc" class="keyword">else</span>:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; JMP <span style="color: #f2777a" class="tag">b</span></span><br /><span style="height: 1.6em" class="line"><span style="color: #f2777a" class="tag">a</span>:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #f2777a" class="tag">a</span>:</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&lt;false_statement&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;false_statement&gt;</span><br /><span style="height: 1.6em" class="line"><span style="color: #f2777a" class="tag">b</span>:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #f2777a" class="tag">b</span>:</span><br /></pre></td></tr></tbody></table><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">对应的汇编代码流程为：</p><ol style="padding-left: 0px; color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px"><li>执行条件表达式&nbsp;&lt;cond&gt;。</li><li>如果条件失败，则跳转到&nbsp;a&nbsp;的位置，执行&nbsp;else&nbsp;语句。这里&nbsp;else&nbsp;语句是可以省略的，此时&nbsp;a&nbsp;和&nbsp;b&nbsp;都指向 IF 语句后方的代码。</li><li>因为汇编代码是顺序排列的，所以如果执行了&nbsp;true_statement，为了防止因为顺序排列而执行了&nbsp;false_statement，所以需要无条件跳转&nbsp;JMP b。</li></ol><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">对应的 C 代码如下：</p><table border="0" style="border-collapse: collapse; border-spacing: 0px; width: auto; vertical-align: middle; margin: 0px"><tbody><tr><td class="code" style="padding: 0px; border: none"><pre style="overflow: auto; font-family: 'Source Code Pro', Consolas, Monaco, Menlo, Consolas, monospace; font-size: 16px; margin-top: 0px; margin-bottom: 0px; padding: 0px; border: none; border-radius: 2px; color: #cccccc; line-height: 1.6em; background-image: initial; background-attachment: initial; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial"><span style="height: 1.6em" class="line"><span style="color: #cc99cc" class="keyword">if</span> (token == If) &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;match(If);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;match(<span style="color: #99cc99" class="string">'('</span>);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;expression(Assign);&nbsp;&nbsp;<span style="color: #999999" class="comment">// parse condition</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;match(<span style="color: #99cc99" class="string">')'</span>);</span><br /><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;*++text = JZ;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;b = ++text;</span><br /><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;statement();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #999999" class="comment">// parse statement</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cc99cc" class="keyword">if</span> (token == Else) &#123; <span style="color: #999999" class="comment">// parse else</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match(Else);</span><br /><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// emit code for JMP B</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*b = (<span style="color: #cc99cc" class="keyword">int</span>)(text + <span style="color: #f99157" class="number">3</span>);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*++text = JMP;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b = ++text;</span><br /><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;statement();</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&#125;</span><br /><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;*b = (<span style="color: #cc99cc" class="keyword">int</span>)(text + <span style="color: #f99157" class="number">1</span>);</span><br /><span style="height: 1.6em" class="line">&#125;</span><br /></pre></td></tr></tbody></table><h2 style="font-family: 'Helvetica Neue', 'WenQuanYi Micro Hei', Heiti, Impact, Charcoal, sans-serif; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #cccccc; color: #333333"><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" href="javascript:if(confirm('http://lotabout.me/2016/write-a-C-interpreter-7/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2016/write-a-C-interpreter-7/#While__u8BED_u53E5'" tppabs="http://lotabout.me/2016/write-a-C-interpreter-7/#While__u8BED_u53E5" title="While 语句" class="headerlink"></a>While 语句</h2><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">While 语句比 If 语句简单，它对应的汇编代码如下：</p><table border="0" style="border-collapse: collapse; border-spacing: 0px; width: auto; vertical-align: middle; margin: 0px"><tbody><tr><td class="code" style="padding: 0px; border: none"><pre style="overflow: auto; font-family: 'Source Code Pro', Consolas, Monaco, Menlo, Consolas, monospace; font-size: 16px; margin-top: 0px; margin-bottom: 0px; padding: 0px; border: none; border-radius: 2px; color: #cccccc; line-height: 1.6em; background-image: initial; background-attachment: initial; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial"><span style="height: 1.6em" class="line"><span style="color: #f2777a" class="tag">a</span>:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #f2777a" class="tag">a</span>:</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp; while (&lt;cond&gt;)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;cond&gt;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; JZ <span style="color: #f2777a" class="tag">b</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&lt;statement&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;statement&gt;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; JMP <span style="color: #f2777a" class="tag">a</span></span><br /><span style="height: 1.6em" class="line"><span style="color: #f2777a" class="tag">b</span>:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #f2777a" class="tag">b</span>:</span><br /></pre></td></tr></tbody></table><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">没有什么值得说明的内容，它的 C 代码如下：</p><table border="0" style="border-collapse: collapse; border-spacing: 0px; width: auto; vertical-align: middle; margin: 0px"><tbody><tr><td class="code" style="padding: 0px; border: none"><pre style="overflow: auto; font-family: 'Source Code Pro', Consolas, Monaco, Menlo, Consolas, monospace; font-size: 16px; margin-top: 0px; margin-bottom: 0px; padding: 0px; border: none; border-radius: 2px; color: #cccccc; line-height: 1.6em; background-image: initial; background-attachment: initial; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial"><span style="height: 1.6em" class="line"><span style="color: #cc99cc" class="keyword">else</span> <span style="color: #cc99cc" class="keyword">if</span> (token == While) &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;match(While);</span><br /><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;a = text + <span style="color: #f99157" class="number">1</span>;</span><br /><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;match(<span style="color: #99cc99" class="string">'('</span>);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;expression(Assign);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;match(<span style="color: #99cc99" class="string">')'</span>);</span><br /><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;*++text = JZ;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;b = ++text;</span><br /><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;statement();</span><br /><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;*++text = JMP;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;*++text = (<span style="color: #cc99cc" class="keyword">int</span>)a;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;*b = (<span style="color: #cc99cc" class="keyword">int</span>)(text + <span style="color: #f99157" class="number">1</span>);</span><br /><span style="height: 1.6em" class="line">&#125;</span><br /></pre></td></tr></tbody></table><h2 style="font-family: 'Helvetica Neue', 'WenQuanYi Micro Hei', Heiti, Impact, Charcoal, sans-serif; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #cccccc; color: #333333"><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" href="javascript:if(confirm('http://lotabout.me/2016/write-a-C-interpreter-7/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2016/write-a-C-interpreter-7/#Return__u8BED_u53E5'" tppabs="http://lotabout.me/2016/write-a-C-interpreter-7/#Return__u8BED_u53E5" title="Return 语句" class="headerlink"></a>Return 语句</h2><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">Return 唯一特殊的地方是：一旦遇到了 Return 语句，则意味着函数要退出了，所以需要生成汇编代码&nbsp;LEV&nbsp;来表示退出。</p><table border="0" style="border-collapse: collapse; border-spacing: 0px; width: auto; vertical-align: middle; margin: 0px"><tbody><tr><td class="code" style="padding: 0px; border: none"><pre style="overflow: auto; font-family: 'Source Code Pro', Consolas, Monaco, Menlo, Consolas, monospace; font-size: 16px; margin-top: 0px; margin-bottom: 0px; padding: 0px; border: none; border-radius: 2px; color: #cccccc; line-height: 1.6em; background-image: initial; background-attachment: initial; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial"><span style="height: 1.6em" class="line"><span style="color: #cc99cc" class="keyword">else</span> <span style="color: #cc99cc" class="keyword">if</span> (token == Return) &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// return [expression];</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;match(Return);</span><br /><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cc99cc" class="keyword">if</span> (token != <span style="color: #99cc99" class="string">';'</span>) &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expression(Assign);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&#125;</span><br /><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;match(<span style="color: #99cc99" class="string">';'</span>);</span><br /><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// emit code for return</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;*++text = LEV;</span><br /><span style="height: 1.6em" class="line">&#125;</span><br /></pre></td></tr></tbody></table><h2 style="font-family: 'Helvetica Neue', 'WenQuanYi Micro Hei', Heiti, Impact, Charcoal, sans-serif; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #cccccc; color: #333333"><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" href="javascript:if(confirm('http://lotabout.me/2016/write-a-C-interpreter-7/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2016/write-a-C-interpreter-7/#u5176_u5B83_u8BED_u53E5'" tppabs="http://lotabout.me/2016/write-a-C-interpreter-7/#u5176_u5B83_u8BED_u53E5" title="其它语句" class="headerlink"></a>其它语句</h2><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">其它语句并不直接生成汇编代码，所以不多做说明，代码如下：</p><table border="0" style="border-collapse: collapse; border-spacing: 0px; width: auto; vertical-align: middle; margin: 0px"><tbody><tr><td class="code" style="padding: 0px; border: none"><pre style="overflow: auto; font-family: 'Source Code Pro', Consolas, Monaco, Menlo, Consolas, monospace; font-size: 16px; margin-top: 0px; margin-bottom: 0px; padding: 0px; border: none; border-radius: 2px; color: #cccccc; line-height: 1.6em; background-image: initial; background-attachment: initial; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial"><span style="height: 1.6em" class="line"><span style="color: #cc99cc" class="keyword">else</span> <span style="color: #cc99cc" class="keyword">if</span> (token == <span style="color: #99cc99" class="string">'&#123;'</span>) &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// &#123; &lt;statement&gt; ... &#125;</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;match(<span style="color: #99cc99" class="string">'&#123;'</span>);</span><br /><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cc99cc" class="keyword">while</span> (token != <span style="color: #99cc99" class="string">'&#125;'</span>) &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;statement();</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&#125;</span><br /><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;match(<span style="color: #99cc99" class="string">'&#125;'</span>);</span><br /><span style="height: 1.6em" class="line">&#125;</span><br /><span style="height: 1.6em" class="line"><span style="color: #cc99cc" class="keyword">else</span> <span style="color: #cc99cc" class="keyword">if</span> (token == <span style="color: #99cc99" class="string">';'</span>) &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// empty statement</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;match(<span style="color: #99cc99" class="string">';'</span>);</span><br /><span style="height: 1.6em" class="line">&#125;</span><br /><span style="height: 1.6em" class="line"><span style="color: #cc99cc" class="keyword">else</span> &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// a = b; or function_call();</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;expression(Assign);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;match(<span style="color: #99cc99" class="string">';'</span>);</span><br /><span style="height: 1.6em" class="line">&#125;</span><br /></pre></td></tr></tbody></table><h1 style="margin: 0.67em 0px; font-family: 'Helvetica Neue', 'WenQuanYi Micro Hei', Heiti, Impact, Charcoal, sans-serif; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #333333; padding: 3px 0px; color: #333333"><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" href="javascript:if(confirm('http://lotabout.me/2016/write-a-C-interpreter-7/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2016/write-a-C-interpreter-7/#u4EE3_u7801'" tppabs="http://lotabout.me/2016/write-a-C-interpreter-7/#u4EE3_u7801" title="代码" class="headerlink"></a>代码</h1><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">本章的代码可以在&nbsp;<a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" rel="external" href="javascript:if(confirm('https://github.com/lotabout/write-a-C-interpreter/tree/read.php?362  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='https://github.com/lotabout/write-a-C-interpreter/tree/read.php?362'" tppabs="https://github.com/lotabout/write-a-C-interpreter/tree/step-5" target="_blank">Github</a>&nbsp;上下载，也可以直接 clone</p><table border="0" style="border-collapse: collapse; border-spacing: 0px; width: auto; vertical-align: middle; margin: 0px"><tbody><tr><td class="code" style="padding: 0px; border: none"><pre style="overflow: auto; font-family: 'Source Code Pro', Consolas, Monaco, Menlo, Consolas, monospace; font-size: 16px; margin-top: 0px; margin-bottom: 0px; padding: 0px; border: none; border-radius: 2px; color: #cccccc; line-height: 1.6em; background-image: initial; background-attachment: initial; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial"><span style="height: 1.6em" class="line">git <span style="color: #cc99cc" class="keyword">clone</span> <span style="color: #999999" class="title">-b</span> step-<span style="color: #f99157" class="number">5</span> https://github.com/lotabout/<span class="operator">write</span>-a-C-interpreter</span><br /></pre></td></tr></tbody></table><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">本章的代码依旧无法运行，还剩最后一部分没有完成：expression。</p><h1 style="margin: 0.67em 0px; font-family: 'Helvetica Neue', 'WenQuanYi Micro Hei', Heiti, Impact, Charcoal, sans-serif; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #333333; padding: 3px 0px; color: #333333"><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" href="javascript:if(confirm('http://lotabout.me/2016/write-a-C-interpreter-7/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2016/write-a-C-interpreter-7/#u5C0F_u7ED3'" tppabs="http://lotabout.me/2016/write-a-C-interpreter-7/#u5C0F_u7ED3" title="小结" class="headerlink"></a>小结</h1><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">本章讲解了如何将语句编译成汇编代码，内容相对容易一些，关键就是去理解汇编代码的执行原理。</p><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">同时值得一提的是，编译器的语法分析部分其实是很简单的，而真正的难点是如何在语法分析时收集足够多的信息，最终把源代码转换成目标代码（汇编）。我认为这也是初学者实现编译器的一大难点，往往比词法分析/语法分析更困难。</p><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">所以建议如果没有学过汇编，可以学习学习，它本身不难，但对理解计算机的原理有很大帮助。</p>
	</div>
	<div class="textbox-bottom">
	</div>
	<div class="tags" style="display: none"> 
	</div>
</div><div class="textbox">
	<div class="textbox-calendar">
	<span class="textbox-calendar-month">Jan</span>
	<span class="textbox-calendar-day">22</span>
	</div>
	<div class="textbox-title">
		<h4>
		<a href="read.php-7064.htm" tppabs="http://i.renjihe.com/blog/read.php?7064">手把手教你构建 C 语言编译器（6）- 函数定义</a> <span id="starid7064"><img src="unstarred.gif" tppabs="http://i.renjihe.com/blog/template/default/images/others/unstarred.gif" alt="" title="未加星标" border="0"/></span> <img src="blank.gif" tppabs="http://i.renjihe.com/blog/images/weather/blank.gif" alt="不指定" title="不指定"/>
		</h4>
		<div class="textbox-label">
		<a href="view.php-go=user_1.htm" tppabs="http://i.renjihe.com/blog/view.php?go=user_1" target="_blank">renjihe1988</a> , 12:44 , <a href="index.php-go=category_2.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_2" title="查看分类： 软件">软件</a> &raquo; <a href="index.php-go=category_19.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_19" title="查看分类： 编译原理">编译原理</a> , <a href="read.php-7064.htm#reply" tppabs="http://i.renjihe.com/blog/read.php?7064#reply" title="发表您的评论">评论(0)</a> , <a href='javascript: void(0);' title="查看引用地址" onclick='showhidediv("tb7064");'>引用(0)</a> , <a href="read.php-7064.htm" tppabs="http://i.renjihe.com/blog/read.php?7064">阅读(1)</a> , Via 本站原创 
		</div>
	</div>
	<div id="tb7064" style="display: none;" class="textbox-tburl"><strong>引用功能被关闭了。</strong></div>
	
	<div class="textbox-content">
	<p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">由于语法分析本身比较复杂，所以我们将它拆分成 3 个部分进行讲解，分别是：变量定义、函数定义、表达式。本章讲解函数定义相关的内容。</p><a id="more" style="outline: none; color: #368ccb; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px; background-color: transparent"></a><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">手把手教你构建 C 语言编译器系列共有10个部分：</p><ol style="padding-left: 0px; color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px"><li><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" rel="external" href="javascript:if(confirm('http://lotabout.me/2015/write-a-C-interpreter-0/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2015/write-a-C-interpreter-0/'" tppabs="http://lotabout.me/2015/write-a-C-interpreter-0/" target="_blank">手把手教你构建 C 语言编译器（0）&mdash;&mdash;前言</a></li><li><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" rel="external" href="javascript:if(confirm('http://lotabout.me/2015/write-a-C-interpreter-1/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2015/write-a-C-interpreter-1/'" tppabs="http://lotabout.me/2015/write-a-C-interpreter-1/" target="_blank">手把手教你构建 C 语言编译器（1）&mdash;&mdash;设计</a></li><li><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" rel="external" href="javascript:if(confirm('http://lotabout.me/2015/write-a-C-interpreter-2/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2015/write-a-C-interpreter-2/'" tppabs="http://lotabout.me/2015/write-a-C-interpreter-2/" target="_blank">手把手教你构建 C 语言编译器（2）&mdash;&mdash;虚拟机</a></li><li><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" rel="external" href="javascript:if(confirm('http://lotabout.me/2015/write-a-C-interpreter-3/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2015/write-a-C-interpreter-3/'" tppabs="http://lotabout.me/2015/write-a-C-interpreter-3/" target="_blank">手把手教你构建 C 语言编译器（3）&mdash;&mdash;词法分析器</a></li><li><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" rel="external" href="javascript:if(confirm('http://lotabout.me/2016/write-a-C-interpreter-4/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2016/write-a-C-interpreter-4/'" tppabs="http://lotabout.me/2016/write-a-C-interpreter-4/" target="_blank">手把手教你构建 C 语言编译器（4）&mdash;&mdash;递归下降</a></li><li><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" rel="external" href="javascript:if(confirm('http://lotabout.me/2016/write-a-C-interpreter-5/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2016/write-a-C-interpreter-5/'" tppabs="http://lotabout.me/2016/write-a-C-interpreter-5/" target="_blank">手把手教你构建 C 语言编译器（5）&mdash;&mdash;变量定义</a></li><li><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" rel="external" href="javascript:if(confirm('http://lotabout.me/2016/write-a-C-interpreter-6/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2016/write-a-C-interpreter-6/'" tppabs="http://lotabout.me/2016/write-a-C-interpreter-6/" target="_blank">手把手教你构建 C 语言编译器（6）&mdash;&mdash;函数定义</a></li><li><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" rel="external" href="javascript:if(confirm('http://lotabout.me/2016/write-a-C-interpreter-7/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2016/write-a-C-interpreter-7/'" tppabs="http://lotabout.me/2016/write-a-C-interpreter-7/" target="_blank">手把手教你构建 C 语言编译器（7）&mdash;&mdash;语句</a></li><li><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" rel="external" href="javascript:if(confirm('http://lotabout.me/2016/write-a-C-interpreter-8/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2016/write-a-C-interpreter-8/'" tppabs="http://lotabout.me/2016/write-a-C-interpreter-8/" target="_blank">手把手教你构建 C 语言编译器（8）&mdash;&mdash;表达式</a></li><li><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" rel="external" href="javascript:if(confirm('http://lotabout.me/2016/write-a-C-interpreter-9/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2016/write-a-C-interpreter-9/'" tppabs="http://lotabout.me/2016/write-a-C-interpreter-9/" target="_blank">手把手教你构建 C 语言编译器（9）&mdash;&mdash;总结</a></li></ol><h1 style="margin: 0.67em 0px; font-family: 'Helvetica Neue', 'WenQuanYi Micro Hei', Heiti, Impact, Charcoal, sans-serif; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #333333; padding: 3px 0px; color: #333333"><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" href="javascript:if(confirm('http://lotabout.me/2016/write-a-C-interpreter-6/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2016/write-a-C-interpreter-6/#EBNF__u8868_u793A'" tppabs="http://lotabout.me/2016/write-a-C-interpreter-6/#EBNF__u8868_u793A" title="EBNF 表示" class="headerlink"></a>EBNF 表示</h1><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">这是上一章的 EBNF 方法中与函数定义相关的内容。</p><table border="0" style="border-collapse: collapse; border-spacing: 0px; width: auto; vertical-align: middle; margin: 0px"><tbody><tr><td class="code" style="padding: 0px; border: none"><pre style="overflow: auto; font-family: 'Source Code Pro', Consolas, Monaco, Menlo, Consolas, monospace; font-size: 16px; margin-top: 0px; margin-bottom: 0px; padding: 0px; border: none; border-radius: 2px; color: #cccccc; line-height: 1.6em; background-image: initial; background-attachment: initial; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial"><span style="height: 1.6em" class="line">variable_decl <span class="type-annotation">::</span>= <span style="color: #cc99cc" class="keyword">type</span> &#123;<span class="char">'*'</span>&#125; id &#123; <span class="char">','</span> &#123;<span class="char">'*'</span>&#125; id &#125; <span class="char">';'</span></span><br /><br /><span style="height: 1.6em" class="line">function_decl <span class="type-annotation">::</span>= <span style="color: #cc99cc" class="keyword">type</span> &#123;<span class="char">'*'</span>&#125; id <span class="char">'('</span> parameter_decl <span class="char">')'</span> <span class="char">'&#123;'</span> body_decl <span class="char">'&#125;'</span></span><br /><br /><span style="height: 1.6em" class="line">parameter_decl <span class="type-annotation">::</span>= <span style="color: #cc99cc" class="keyword">type</span> &#123;<span class="char">'*'</span>&#125; id &#123;<span class="char">','</span> <span style="color: #cc99cc" class="keyword">type</span> &#123;<span class="char">'*'</span>&#125; id&#125;</span><br /><br /><span style="height: 1.6em" class="line">body_decl <span class="type-annotation">::</span>= &#123;variable_decl&#125;, &#123;statement&#125;</span><br /><br /><span style="height: 1.6em" class="line">statement <span class="type-annotation">::</span>= non_empty_statement &#124; empty_statement</span><br /><br /><span style="height: 1.6em" class="line">non_empty_statement <span class="type-annotation">::</span>= if_statement &#124; while_statement &#124; <span class="char">'&#123;'</span> statement <span class="char">'&#125;'</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#124; '<span style="color: #cc99cc" class="keyword">return</span>' expression &#124; expression <span class="char">';'</span></span><br /><br /><span style="height: 1.6em" class="line">if_statement <span class="type-annotation">::</span>= '<span style="color: #cc99cc" class="keyword">if</span><span class="char">' '</span>(' expression <span class="char">')'</span> statement ['<span style="color: #cc99cc" class="keyword">else</span>' non_empty_statement]</span><br /><br /><span style="height: 1.6em" class="line">while_statement <span class="type-annotation">::</span>= '<span style="color: #cc99cc" class="keyword">while</span><span class="char">' '</span>(' expression <span class="char">')'</span> non_empty_statement</span><br /></pre></td></tr></tbody></table><h1 style="margin: 0.67em 0px; font-family: 'Helvetica Neue', 'WenQuanYi Micro Hei', Heiti, Impact, Charcoal, sans-serif; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #333333; padding: 3px 0px; color: #333333"><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" href="javascript:if(confirm('http://lotabout.me/2016/write-a-C-interpreter-6/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2016/write-a-C-interpreter-6/#u89E3_u6790_u51FD_u6570_u7684_u5B9A_u4E49'" tppabs="http://lotabout.me/2016/write-a-C-interpreter-6/#u89E3_u6790_u51FD_u6570_u7684_u5B9A_u4E49" title="解析函数的定义" class="headerlink"></a>解析函数的定义</h1><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">上一章的代码中，我们已经知道了什么时候开始解析函数的定义，相关的代码如下：</p><table border="0" style="border-collapse: collapse; border-spacing: 0px; width: auto; vertical-align: middle; margin: 0px"><tbody><tr><td class="code" style="padding: 0px; border: none"><pre style="overflow: auto; font-family: 'Source Code Pro', Consolas, Monaco, Menlo, Consolas, monospace; font-size: 16px; margin-top: 0px; margin-bottom: 0px; padding: 0px; border: none; border-radius: 2px; color: #cccccc; line-height: 1.6em; background-image: initial; background-attachment: initial; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial"><span style="height: 1.6em" class="line">...</span><br /><span style="height: 1.6em" class="line"><span style="color: #cc99cc" class="keyword">if</span> (token == <span style="color: #99cc99" class="string">'('</span>) &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;current_id[Class] = Fun;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;current_id[Value] = (<span style="color: #cc99cc" class="keyword">int</span>)(text + <span style="color: #f99157" class="number">1</span>); <span style="color: #999999" class="comment">// the memory address of function</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;function_declaration();</span><br /><span style="height: 1.6em" class="line">&#125; <span style="color: #cc99cc" class="keyword">else</span> &#123;</span><br /><span style="height: 1.6em" class="line">...</span><br /></pre></td></tr></tbody></table><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">即在这断代码之前，我们已经为当前的标识符（identifier）设置了正确的类型，上面这断代码为当前的标识符设置了正确的类别（Fun），以及该函数在代码段（text segment）中的位置。接下来开始解析函数定义相关的内容：parameter_decl&nbsp;及&nbsp;body_decl。</p><h2 style="font-family: 'Helvetica Neue', 'WenQuanYi Micro Hei', Heiti, Impact, Charcoal, sans-serif; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #cccccc; color: #333333"><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" href="javascript:if(confirm('http://lotabout.me/2016/write-a-C-interpreter-6/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2016/write-a-C-interpreter-6/#u51FD_u6570_u53C2_u6570_u4E0E_u6C47_u7F16_u4EE3_u7801'" tppabs="http://lotabout.me/2016/write-a-C-interpreter-6/#u51FD_u6570_u53C2_u6570_u4E0E_u6C47_u7F16_u4EE3_u7801" title="函数参数与汇编代码" class="headerlink"></a>函数参数与汇编代码</h2><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">现在我们要回忆如何将&ldquo;函数&rdquo;转换成对应的汇编代码，因为这决定了在解析时我们需要哪些相关的信息。考虑下列函数：</p><table border="0" style="border-collapse: collapse; border-spacing: 0px; width: auto; vertical-align: middle; margin: 0px"><tbody><tr><td class="code" style="padding: 0px; border: none"><pre style="overflow: auto; font-family: 'Source Code Pro', Consolas, Monaco, Menlo, Consolas, monospace; font-size: 16px; margin-top: 0px; margin-bottom: 0px; padding: 0px; border: none; border-radius: 2px; color: #cccccc; line-height: 1.6em; background-image: initial; background-attachment: initial; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial"><span style="height: 1.6em" class="line"><span style="color: #6699cc" class="function"><span style="color: #cc99cc" class="keyword">int</span> <span style="color: #999999" class="title">demo</span><span style="color: #f99157" class="params">(<span style="color: #cc99cc" class="keyword">int</span> param_a, <span style="color: #cc99cc" class="keyword">int</span> *param_b)</span> </span>&#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cc99cc" class="keyword">int</span> local_1;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cc99cc" class="keyword">char</span> local_2;</span><br /><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;...</span><br /><span style="height: 1.6em" class="line">&#125;</span><br /></pre></td></tr></tbody></table><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">那么它应该被转换成什么样的汇编代码呢？在思考这个问题之前，我们需要了解当&nbsp;demo函数被调用时，计算机的栈的状态，如下（参照第三章讲解的虚拟机）：</p><table border="0" style="border-collapse: collapse; border-spacing: 0px; width: auto; vertical-align: middle; margin: 0px"><tbody><tr><td class="code" style="padding: 0px; border: none"><pre style="overflow: auto; font-family: 'Source Code Pro', Consolas, Monaco, Menlo, Consolas, monospace; font-size: 16px; margin-top: 0px; margin-bottom: 0px; padding: 0px; border: none; border-radius: 2px; color: #cccccc; line-height: 1.6em; background-image: initial; background-attachment: initial; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial"><span style="height: 1.6em" class="line"><span style="color: #99cc99" class="header">&#124;&nbsp;&nbsp;&nbsp;&nbsp;....&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#124; high address</span><br /><span style="height: 1.6em" class="line">+---------------+</span></span><br /><span style="height: 1.6em" class="line"><span style="color: #99cc99" class="header">&#124; arg: param_a&nbsp;&nbsp;&#124;&nbsp;&nbsp;&nbsp;&nbsp;new_bp + 3</span><br /><span style="height: 1.6em" class="line">+---------------+</span></span><br /><span style="height: 1.6em" class="line"><span style="color: #99cc99" class="header">&#124; arg: param_b&nbsp;&nbsp;&#124;&nbsp;&nbsp;&nbsp;&nbsp;new_bp + 2</span><br /><span style="height: 1.6em" class="line">+---------------+</span></span><br /><span style="height: 1.6em" class="line"><span style="color: #99cc99" class="header">&#124;return address &#124;&nbsp;&nbsp;&nbsp;&nbsp;new_bp + 1</span><br /><span style="height: 1.6em" class="line">+---------------+</span></span><br /><span style="height: 1.6em" class="line"><span style="color: #99cc99" class="header">&#124; old BP&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#124; &lt;- new BP</span><br /><span style="height: 1.6em" class="line">+---------------+</span></span><br /><span style="height: 1.6em" class="line"><span style="color: #99cc99" class="header">&#124; local_1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#124;&nbsp;&nbsp;&nbsp;&nbsp;new_bp - 1</span><br /><span style="height: 1.6em" class="line">+---------------+</span></span><br /><span style="height: 1.6em" class="line"><span style="color: #99cc99" class="header">&#124; local_2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#124;&nbsp;&nbsp;&nbsp;&nbsp;new_bp - 2</span><br /><span style="height: 1.6em" class="line">+---------------+</span></span><br /><span style="height: 1.6em" class="line">&#124;&nbsp;&nbsp;&nbsp;&nbsp;....&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#124;&nbsp;&nbsp;low address</span><br /></pre></td></tr></tbody></table><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">这里最为重要的一点是，无论是函数的参数（如&nbsp;param_a）还是函数的局部变量（如local_1）都是存放在计算机的&nbsp;<strong>栈</strong>&nbsp;上的。因此，与存放在&nbsp;<strong>数据段</strong>&nbsp;中的全局变量不同，在函数内访问它们是通过&nbsp;new_bp&nbsp;指针和对应的位移量进行的。因此，在解析的过程中，我们需要知道参数的个数，各个参数的位移量。</p><h2 style="font-family: 'Helvetica Neue', 'WenQuanYi Micro Hei', Heiti, Impact, Charcoal, sans-serif; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #cccccc; color: #333333"><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" href="javascript:if(confirm('http://lotabout.me/2016/write-a-C-interpreter-6/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2016/write-a-C-interpreter-6/#u51FD_u6570_u5B9A_u4E49_u7684_u89E3_u6790'" tppabs="http://lotabout.me/2016/write-a-C-interpreter-6/#u51FD_u6570_u5B9A_u4E49_u7684_u89E3_u6790" title="函数定义的解析" class="headerlink"></a>函数定义的解析</h2><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">这相当于是整个函数定义的语法解析的框架，代码如下：</p><table border="0" style="border-collapse: collapse; border-spacing: 0px; width: auto; vertical-align: middle; margin: 0px"><tbody><tr><td class="code" style="padding: 0px; border: none"><pre style="overflow: auto; font-family: 'Source Code Pro', Consolas, Monaco, Menlo, Consolas, monospace; font-size: 16px; margin-top: 0px; margin-bottom: 0px; padding: 0px; border: none; border-radius: 2px; color: #cccccc; line-height: 1.6em; background-image: initial; background-attachment: initial; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial"><span style="height: 1.6em" class="line"><span style="color: #6699cc" class="function"><span style="color: #cc99cc" class="keyword">void</span> <span style="color: #999999" class="title">function_declaration</span><span style="color: #f99157" class="params">()</span> </span>&#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// type func_name (...) &#123;...&#125;</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#124; this part</span></span><br /><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;match(<span style="color: #99cc99" class="string">'('</span>);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;function_parameter();</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;match(<span style="color: #99cc99" class="string">')'</span>);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;match(<span style="color: #99cc99" class="string">'&#123;'</span>);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;function_body();</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">//match('&#125;');&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //&nbsp;&nbsp;①</span></span><br /><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// ②</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// unwind local variable declarations for all local variables.</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;current_id = symbols;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cc99cc" class="keyword">while</span> (current_id[Token]) &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cc99cc" class="keyword">if</span> (current_id[Class] == Loc) &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;current_id[Class] = current_id[BClass];</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;current_id[Type]&nbsp;&nbsp;= current_id[BType];</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;current_id[Value] = current_id[BValue];</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;current_id = current_id + IdSize;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&#125;</span><br /><span style="height: 1.6em" class="line">&#125;</span><br /></pre></td></tr></tbody></table><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">其中①中我们没有消耗最后的&#125;字符。这么做的原因是：variable_decl&nbsp;与&nbsp;function_decl是放在一起解析的，而&nbsp;variable_decl&nbsp;是以字符&nbsp;;&nbsp;结束的。而&nbsp;function_decl&nbsp;是以字符&nbsp;&#125;结束的，若在此通过&nbsp;match&nbsp;消耗了 &lsquo;;&rsquo; 字符，那么外层的&nbsp;while&nbsp;循环就没法准确地知道函数定义已经结束。所以我们将结束符的解析放在了外层的&nbsp;while&nbsp;循环中。</p><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">而②中的代码是用于将符号表中的信息恢复成全局的信息。这是因为，局部变量是可以和全局变量同名的，一旦同名，在函数体内局部变量就会覆盖全局变量，出了函数体，全局变量就恢复了原先的作用。这段代码线性地遍历所有标识符，并将保存在&nbsp;BXXX&nbsp;中的信息还原。</p><h2 style="font-family: 'Helvetica Neue', 'WenQuanYi Micro Hei', Heiti, Impact, Charcoal, sans-serif; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #cccccc; color: #333333"><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" href="javascript:if(confirm('http://lotabout.me/2016/write-a-C-interpreter-6/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2016/write-a-C-interpreter-6/#u89E3_u6790_u53C2_u6570'" tppabs="http://lotabout.me/2016/write-a-C-interpreter-6/#u89E3_u6790_u53C2_u6570" title="解析参数" class="headerlink"></a>解析参数</h2><table border="0" style="border-collapse: collapse; border-spacing: 0px; width: auto; vertical-align: middle; margin: 0px"><tbody><tr><td class="code" style="padding: 0px; border: none"><pre style="overflow: auto; font-family: 'Source Code Pro', Consolas, Monaco, Menlo, Consolas, monospace; font-size: 16px; margin-top: 0px; margin-bottom: 0px; padding: 0px; border: none; border-radius: 2px; color: #cccccc; line-height: 1.6em; background-image: initial; background-attachment: initial; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial"><span style="height: 1.6em" class="line">parameter_decl ::= <span class="name">type</span> &#123;<span style="color: #99cc99" class="string">'*'</span>&#125; <span class="name">id</span> &#123;<span style="color: #99cc99" class="string">','</span> <span style="color: #f99157" class="built_in">type</span> &#123;<span style="color: #99cc99" class="string">'*'</span>&#125; <span class="name">id</span>&#125;</span><br /></pre></td></tr></tbody></table><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">解析函数的参数就是解析以逗号分隔的一个个标识符，同时记录它们的位置与类型。</p><table border="0" style="border-collapse: collapse; border-spacing: 0px; width: auto; vertical-align: middle; margin: 0px"><tbody><tr><td class="code" style="padding: 0px; border: none"><pre style="overflow: auto; font-family: 'Source Code Pro', Consolas, Monaco, Menlo, Consolas, monospace; font-size: 16px; margin-top: 0px; margin-bottom: 0px; padding: 0px; border: none; border-radius: 2px; color: #cccccc; line-height: 1.6em; background-image: initial; background-attachment: initial; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial"><span style="height: 1.6em" class="line"><span style="color: #cc99cc" class="keyword">int</span> index_of_bp; <span style="color: #999999" class="comment">// index of bp pointer on stack</span></span><br /><br /><span style="height: 1.6em" class="line"><span style="color: #6699cc" class="function"><span style="color: #cc99cc" class="keyword">void</span> <span style="color: #999999" class="title">function_parameter</span><span style="color: #f99157" class="params">()</span> </span>&#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cc99cc" class="keyword">int</span> type;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cc99cc" class="keyword">int</span> params;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;params = <span style="color: #f99157" class="number">0</span>;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cc99cc" class="keyword">while</span> (token != <span style="color: #99cc99" class="string">')'</span>) &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// ①</span></span><br /><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// int name, ...</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;type = INT;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cc99cc" class="keyword">if</span> (token == Int) &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match(Int);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125; <span style="color: #cc99cc" class="keyword">else</span> <span style="color: #cc99cc" class="keyword">if</span> (token == Char) &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;type = CHAR;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match(Char);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125;</span><br /><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// pointer type</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cc99cc" class="keyword">while</span> (token == Mul) &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match(Mul);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;type = type + PTR;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125;</span><br /><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// parameter name</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cc99cc" class="keyword">if</span> (token != Id) &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #f99157" class="built_in">printf</span>(<span style="color: #99cc99" class="string">&quot;%d: bad parameter declaration&#92;n&quot;</span>, line);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #f99157" class="built_in">exit</span>(-<span style="color: #f99157" class="number">1</span>);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cc99cc" class="keyword">if</span> (current_id[Class] == Loc) &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #f99157" class="built_in">printf</span>(<span style="color: #99cc99" class="string">&quot;%d: duplicate parameter declaration&#92;n&quot;</span>, line);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #f99157" class="built_in">exit</span>(-<span style="color: #f99157" class="number">1</span>);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125;</span><br /><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match(Id);</span><br /><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">//②</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// store the local variable</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;current_id[BClass] = current_id[Class]; current_id[Class]&nbsp;&nbsp;= Loc;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;current_id[BType]&nbsp;&nbsp;= current_id[Type];&nbsp;&nbsp;current_id[Type]&nbsp;&nbsp; = type;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;current_id[BValue] = current_id[Value]; current_id[Value]&nbsp;&nbsp;= params++;&nbsp;&nbsp; <span style="color: #999999" class="comment">// index of current parameter</span></span><br /><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cc99cc" class="keyword">if</span> (token == <span style="color: #99cc99" class="string">','</span>) &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match(<span style="color: #99cc99" class="string">','</span>);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&#125;</span><br /><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// ③</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;index_of_bp = params+<span style="color: #f99157" class="number">1</span>;</span><br /><span style="height: 1.6em" class="line">&#125;</span><br /></pre></td></tr></tbody></table><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">其中①与全局变量定义的解析十分一样，用于解析该参数的类型。</p><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">而②则与上节中提到的&ldquo;局部变量覆盖全局变量&rdquo;相关，先将全局变量的信息保存（无论是是否真的在全局中用到了这个变量）在&nbsp;BXXX&nbsp;中，再赋上局部变量相关的信息，如&nbsp;Value&nbsp;中存放的是参数的位置（是第几个参数）。</p><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">③则与汇编代码的生成有关，index_of_bp&nbsp;就是前文提到的&nbsp;new_bp&nbsp;的位置。</p><h2 style="font-family: 'Helvetica Neue', 'WenQuanYi Micro Hei', Heiti, Impact, Charcoal, sans-serif; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #cccccc; color: #333333"><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" href="javascript:if(confirm('http://lotabout.me/2016/write-a-C-interpreter-6/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2016/write-a-C-interpreter-6/#u51FD_u6570_u4F53_u7684_u89E3_u6790'" tppabs="http://lotabout.me/2016/write-a-C-interpreter-6/#u51FD_u6570_u4F53_u7684_u89E3_u6790" title="函数体的解析" class="headerlink"></a>函数体的解析</h2><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">我们实现的 C 语言与现代的 C 语言不太一致，我们需要所有的变量定义出现在所有的语句之前。函数体的代码如下：</p><table border="0" style="border-collapse: collapse; border-spacing: 0px; width: auto; vertical-align: middle; margin: 0px"><tbody><tr><td class="code" style="padding: 0px; border: none"><pre style="overflow: auto; font-family: 'Source Code Pro', Consolas, Monaco, Menlo, Consolas, monospace; font-size: 16px; margin-top: 0px; margin-bottom: 0px; padding: 0px; border: none; border-radius: 2px; color: #cccccc; line-height: 1.6em; background-image: initial; background-attachment: initial; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial"><span style="height: 1.6em" class="line"><span style="color: #6699cc" class="function"><span style="color: #cc99cc" class="keyword">void</span> <span style="color: #999999" class="title">function_body</span><span style="color: #f99157" class="params">()</span> </span>&#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// type func_name (...) &#123;...&#125;</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; --&gt;&#124;&nbsp;&nbsp; &#124;&lt;--</span></span><br /><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// ... &#123;</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// 1. local declarations</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// 2. statements</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// &#125;</span></span><br /><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cc99cc" class="keyword">int</span> pos_local; <span style="color: #999999" class="comment">// position of local variables on the stack.</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cc99cc" class="keyword">int</span> type;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;pos_local = index_of_bp;</span><br /><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// ①</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cc99cc" class="keyword">while</span> (token == Int &#124;&#124; token == Char) &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// local variable declaration, just like global ones.</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;basetype = (token == Int) ? INT : CHAR;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match(token);</span><br /><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cc99cc" class="keyword">while</span> (token != <span style="color: #99cc99" class="string">';'</span>) &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;type = basetype;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cc99cc" class="keyword">while</span> (token == Mul) &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match(Mul);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;type = type + PTR;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125;</span><br /><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cc99cc" class="keyword">if</span> (token != Id) &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// invalid declaration</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #f99157" class="built_in">printf</span>(<span style="color: #99cc99" class="string">&quot;%d: bad local declaration&#92;n&quot;</span>, line);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #f99157" class="built_in">exit</span>(-<span style="color: #f99157" class="number">1</span>);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cc99cc" class="keyword">if</span> (current_id[Class] == Loc) &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// identifier exists</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #f99157" class="built_in">printf</span>(<span style="color: #99cc99" class="string">&quot;%d: duplicate local declaration&#92;n&quot;</span>, line);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #f99157" class="built_in">exit</span>(-<span style="color: #f99157" class="number">1</span>);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match(Id);</span><br /><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// store the local variable</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;current_id[BClass] = current_id[Class]; current_id[Class]&nbsp;&nbsp;= Loc;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;current_id[BType]&nbsp;&nbsp;= current_id[Type];&nbsp;&nbsp;current_id[Type]&nbsp;&nbsp; = type;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;current_id[BValue] = current_id[Value]; current_id[Value]&nbsp;&nbsp;= ++pos_local;&nbsp;&nbsp; <span style="color: #999999" class="comment">// index of current parameter</span></span><br /><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cc99cc" class="keyword">if</span> (token == <span style="color: #99cc99" class="string">','</span>) &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match(<span style="color: #99cc99" class="string">','</span>);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match(<span style="color: #99cc99" class="string">';'</span>);</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&#125;</span><br /><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// ②</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// save the stack size for local variables</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;*++text = ENT;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;*++text = pos_local - index_of_bp;</span><br /><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// statements</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cc99cc" class="keyword">while</span> (token != <span style="color: #99cc99" class="string">'&#125;'</span>) &#123;</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;statement();</span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;&#125;</span><br /><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999999" class="comment">// emit code for leaving the sub function</span></span><br /><span style="height: 1.6em" class="line">&nbsp;&nbsp;&nbsp;&nbsp;*++text = LEV;</span><br /><span style="height: 1.6em" class="line">&#125;</span><br /></pre></td></tr></tbody></table><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">其中①用于解析函数体内的局部变量的定义，代码与全局的变量定义几乎一样。</p><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">而②则用于生成汇编代码，我们在第三章的虚拟机中提到过，我们需要在栈上为局部变量预留空间，这两行代码起的就是这个作用。</p><h1 style="margin: 0.67em 0px; font-family: 'Helvetica Neue', 'WenQuanYi Micro Hei', Heiti, Impact, Charcoal, sans-serif; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #333333; padding: 3px 0px; color: #333333"><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" href="javascript:if(confirm('http://lotabout.me/2016/write-a-C-interpreter-6/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2016/write-a-C-interpreter-6/#u4EE3_u7801'" tppabs="http://lotabout.me/2016/write-a-C-interpreter-6/#u4EE3_u7801" title="代码" class="headerlink"></a>代码</h1><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">本章的代码可以在&nbsp;<a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" rel="external" href="javascript:if(confirm('https://github.com/lotabout/write-a-C-interpreter/tree/index.php?go=category_4&mode=1&page=1  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='https://github.com/lotabout/write-a-C-interpreter/tree/index.php?go=category_4&mode=1&page=1'" tppabs="https://github.com/lotabout/write-a-C-interpreter/tree/step-4" target="_blank">Github</a>&nbsp;上下载，也可以直接 clone</p><table border="0" style="border-collapse: collapse; border-spacing: 0px; width: auto; vertical-align: middle; margin: 0px"><tbody><tr><td class="code" style="padding: 0px; border: none"><pre style="overflow: auto; font-family: 'Source Code Pro', Consolas, Monaco, Menlo, Consolas, monospace; font-size: 16px; margin-top: 0px; margin-bottom: 0px; padding: 0px; border: none; border-radius: 2px; color: #cccccc; line-height: 1.6em; background-image: initial; background-attachment: initial; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial"><span style="height: 1.6em" class="line">git <span style="color: #cc99cc" class="keyword">clone</span> <span style="color: #999999" class="title">-b</span> step-<span style="color: #f99157" class="number">4</span> https://github.com/lotabout/<span class="operator">write</span>-a-C-interpreter</span><br /></pre></td></tr></tbody></table><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">本章的代码依旧无法运行，还有两个重要函数没有完成：statement&nbsp;及&nbsp;expression，感兴趣的话可以尝试自己实现它们。</p><h1 style="margin: 0.67em 0px; font-family: 'Helvetica Neue', 'WenQuanYi Micro Hei', Heiti, Impact, Charcoal, sans-serif; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #333333; padding: 3px 0px; color: #333333"><a style="outline: none; color: #368ccb; text-decoration: none; opacity: 0.9; transition: color 0.2s; border-bottom-width: 0.08em; border-bottom-style: solid; border-bottom-color: #d3d3d3; background-color: transparent" href="javascript:if(confirm('http://lotabout.me/2016/write-a-C-interpreter-6/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://lotabout.me/2016/write-a-C-interpreter-6/#u5C0F_u7ED3'" tppabs="http://lotabout.me/2016/write-a-C-interpreter-6/#u5C0F_u7ED3" title="小结" class="headerlink"></a>小结</h1><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">本章中我们用了不多的代码完成了函数定义的解析。大部分的代码依旧是用于解析变量：参数和局部变量，而它们的逻辑和全局变量的解析几乎一致，最大的区别就是保存的信息不同。</p><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">当然，要理解函数定义的解析过程，最重要的是理解我们会为函数生成怎样的汇编代码，因为这决定了我们需要从解析中获取什么样的信息（例如参数的位置，个数等），而这些可能需要你重新回顾一下&ldquo;虚拟机&rdquo;这一章，或是重新学习学习汇编相关的知识。</p><p style="color: #333333; font-family: Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Heiti, ubuntu, sans-serif; font-size: 18px; line-height: 31.5px">下一章中我们将讲解语句的解析，敬请期待。</p>
	</div>
	<div class="textbox-bottom">
	</div>
	<div class="tags" style="display: none"> 
	</div>
</div>
					<div class="article-bottom" style="display: block">
						<div class="pages">
							<span class="pagebar-mainbody"> 分页： 1/9  <a href="index.php-go=category_19&mode=1&page=1.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_19&mode=1&page=1"><img src="doubleleft.gif" tppabs="http://i.renjihe.com/blog/template/default/images/arrows/doubleleft.gif" alt="第一页" title="第一页" border="0"/></a> <span class="pagebar-selections"> <span class="pagelink-current">1</span>  <a href="read.php-7179.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_19&mode=1&page=2">2</a>  <a href="read.php-7178.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_19&mode=1&page=3">3</a>  <a href="read.php-7177.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_19&mode=1&page=4">4</a>  <a href="read.php-7176.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_19&mode=1&page=5">5</a>  <a href="read.php-7175.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_19&mode=1&page=6">6</a>  <a href="read.php-7174.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_19&mode=1&page=7">7</a>  <a href="read.php-7173.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_19&mode=1&page=8">8</a>  <a href="read.php-7172.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_19&mode=1&page=9">9</a> </span> <a href="read.php-7179.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_19&mode=1&page=2"><img src="singleright.gif" tppabs="http://i.renjihe.com/blog/template/default/images/arrows/singleright.gif" alt="下页" title="下页" border="0"/></a>  <a href="read.php-7172.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_19&mode=1&page=9"><img src="doubleright.gif" tppabs="http://i.renjihe.com/blog/template/default/images/arrows/doubleright.gif" alt="最后页" title="最后页" border="0"/></a> </span> [ 显示模式： <a href="index.php-go=category_19&mode=1&page=1.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_19&mode=1&page=1" title="切换到摘要模式">摘要</a> | <a href="index.php-go=category_19&mode=2&page=1.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_19&mode=2&page=1" title="切换到列表模式">列表</a> ]
						</div>
					</div>
				</div>
			</div>
		<div id="sidebar" class="sidebar">
			<div id="innerSidebar">
				<div id="innerSidebarSearch">
					<form method="post" action="http://i.renjihe.com/blog/visit.php">
	<input name="job" type="hidden" value="search"/>
	<input name="keyword" class="search-field" type="text"/>
	<select name="searchmethod"><option value="1">日志标题</option><option value="2">日志全文</option><option value="3">评论引用</option><option value="4">所有留言</option></select>
	<input value="搜索" class="button" type="submit"/>
	</form>
				</div>
				<div id="innerSidebarOne">
					<div id='panelCategory' class="panel">
<h5 style="cursor: pointer" onclick='showhidediv("sideblock_category");'>分类</h5>
<div class="panel-content" id="sideblock_category" style="display: block">
<ul><li><a href="index.php-go=category_1.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_1" title="硬件">硬件</a> [1] <a href="feed.php-go=category_1" tppabs="http://i.renjihe.com/blog/feed.php?go=category_1"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_6.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_6" title="fpga/cpld">fpga/cpld</a> [10] <a href="feed.php-go=category_6" tppabs="http://i.renjihe.com/blog/feed.php?go=category_6"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_66.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_66" title="模电与电路">模电与电路</a> [1] <a href="feed.php-go=category_66" tppabs="http://i.renjihe.com/blog/feed.php?go=category_66"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_7.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_7" title="DSP">DSP</a> [14] <a href="feed.php-go=category_7" tppabs="http://i.renjihe.com/blog/feed.php?go=category_7"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_27.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_27" title="硬件知识">硬件知识</a> [26] <a href="feed.php-go=category_27" tppabs="http://i.renjihe.com/blog/feed.php?go=category_27"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_73.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_73" title="3D打印">3D打印</a> [1] <a href="feed.php-go=category_73" tppabs="http://i.renjihe.com/blog/feed.php?go=category_73"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_64.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_64" title="资讯">资讯</a> [18] <a href="feed.php-go=category_64" tppabs="http://i.renjihe.com/blog/feed.php?go=category_64"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_78.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_78" title="树莓派">树莓派</a> [5] <a href="feed.php-go=category_78" tppabs="http://i.renjihe.com/blog/feed.php?go=category_78"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_2.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_2" title="软件">软件</a> [0] <a href="feed.php-go=category_2.htm" tppabs="http://i.renjihe.com/blog/feed.php?go=category_2"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_9.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_9" title="linux">linux</a> [912] <a href="feed.php-go=category_9" tppabs="http://i.renjihe.com/blog/feed.php?go=category_9"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_14.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_14" title="QT">QT</a> [131] <a href="feed.php-go=category_14" tppabs="http://i.renjihe.com/blog/feed.php?go=category_14"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_82.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_82" title="Lua">Lua</a> [15] <a href="feed.php-go=category_82" tppabs="http://i.renjihe.com/blog/feed.php?go=category_82"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_15.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_15" title="Android">Android</a> [261] <a href="feed.php-go=category_15" tppabs="http://i.renjihe.com/blog/feed.php?go=category_15"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_65.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_65" title="Iphone">Iphone</a> [48] <a href="feed.php-go=category_65" tppabs="http://i.renjihe.com/blog/feed.php?go=category_65"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_32.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_32" title="windows">windows</a> [61] <a href="feed.php-go=category_32" tppabs="http://i.renjihe.com/blog/feed.php?go=category_32"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_31.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_31" title="webkit">webkit</a> [79] <a href="feed.php-go=category_31" tppabs="http://i.renjihe.com/blog/feed.php?go=category_31"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_10.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_10" title="C/C++">C/C++</a> [98] <a href="feed.php-go=category_10" tppabs="http://i.renjihe.com/blog/feed.php?go=category_10"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_29.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_29" title="lisp、Erlang">Erlang、Lisp</a> [28] <a href="feed.php-go=category_29" tppabs="http://i.renjihe.com/blog/feed.php?go=category_29"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_46.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_46" title="Python">Python</a> [255] <a href="feed.php-go=category_46" tppabs="http://i.renjihe.com/blog/feed.php?go=category_46"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_18.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_18" title="Java">Java</a> [25] <a href="feed.php-go=category_18" tppabs="http://i.renjihe.com/blog/feed.php?go=category_18"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_13.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_13" title="web">web</a> [486] <a href="feed.php-go=category_13" tppabs="http://i.renjihe.com/blog/feed.php?go=category_13"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_50.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_50" title="测试">测试</a> [12] <a href="feed.php-go=category_50" tppabs="http://i.renjihe.com/blog/feed.php?go=category_50"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_23.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_23" title="源码分析">源码分析</a> [85] <a href="feed.php-go=category_23" tppabs="http://i.renjihe.com/blog/feed.php?go=category_23"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_19.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_19" title="编译原理"><strong>编译原理</strong></a> [82] <a href="feed.php-go=category_19" tppabs="http://i.renjihe.com/blog/feed.php?go=category_19"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_83.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_83" title="黑客">黑客</a> [4] <a href="feed.php-go=category_83" tppabs="http://i.renjihe.com/blog/feed.php?go=category_83"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_39.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_39" title="GPU编程">GPU编程</a> [89] <a href="feed.php-go=category_39" tppabs="http://i.renjihe.com/blog/feed.php?go=category_39"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_48.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_48" title="OpenGL">OpenGL</a> [117] <a href="feed.php-go=category_48" tppabs="http://i.renjihe.com/blog/feed.php?go=category_48"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_52.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_52" title="OpenCV">OpenCV</a> [18] <a href="feed.php-go=category_52" tppabs="http://i.renjihe.com/blog/feed.php?go=category_52"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_20.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_20" title="音视频与流媒体">音视频与流媒体</a> [412] <a href="feed.php-go=category_20" tppabs="http://i.renjihe.com/blog/feed.php?go=category_20"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_62.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_62" title="游戏">游戏</a> [455] <a href="feed.php-go=category_62" tppabs="http://i.renjihe.com/blog/feed.php?go=category_62"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_54.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_54" title="FLEX&AS">FLEX&amp;AS</a> [124] <a href="feed.php-go=category_54" tppabs="http://i.renjihe.com/blog/feed.php?go=category_54"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_61.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_61" title="编程杂项">编程杂项</a> [55] <a href="feed.php-go=category_61" tppabs="http://i.renjihe.com/blog/feed.php?go=category_61"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_57.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_57" title="网络安全">网络安全</a> [43] <a href="feed.php-go=category_57" tppabs="http://i.renjihe.com/blog/feed.php?go=category_57"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_28.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_28" title="软件工程">软件工程</a> [40] <a href="feed.php-go=category_28" tppabs="http://i.renjihe.com/blog/feed.php?go=category_28"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_74.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_74" title="并行编程">并行编程</a> [4] <a href="feed.php-go=category_74" tppabs="http://i.renjihe.com/blog/feed.php?go=category_74"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_77.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_77" title="大数据">大数据</a> [10] <a href="feed.php-go=category_77" tppabs="http://i.renjihe.com/blog/feed.php?go=category_77"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_37.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_37" title="理论">理论</a> [0] <a href="feed.php-go=category_37.htm" tppabs="http://i.renjihe.com/blog/feed.php?go=category_37"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_38.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_38" title="数学">数学</a> [75] <a href="feed.php-go=category_38" tppabs="http://i.renjihe.com/blog/feed.php?go=category_38"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_43.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_43" title="物理">物理</a> [19] <a href="feed.php-go=category_43" tppabs="http://i.renjihe.com/blog/feed.php?go=category_43"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_24.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_24" title="算法">算法</a> [80] <a href="feed.php-go=category_24" tppabs="http://i.renjihe.com/blog/feed.php?go=category_24"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_40.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_40" title="音频处理">音频处理</a> [3] <a href="feed.php-go=category_40" tppabs="http://i.renjihe.com/blog/feed.php?go=category_40"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_36.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_36" title="CV&Graphic">CV&amp;Graphic</a> [183] <a href="feed.php-go=category_36" tppabs="http://i.renjihe.com/blog/feed.php?go=category_36"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_35.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_35" title="AR&AI&模式识别">AR&amp;AI&amp;模式识别</a> [127] <a href="feed.php-go=category_35" tppabs="http://i.renjihe.com/blog/feed.php?go=category_35"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_26.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_26" title="工具">工具</a> [56] <a href="feed.php-go=category_26" tppabs="http://i.renjihe.com/blog/feed.php?go=category_26"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_3.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_3" title="新鲜玩意">新鲜玩意</a> [446] <a href="feed.php-go=category_3" tppabs="http://i.renjihe.com/blog/feed.php?go=category_3"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_63.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_63" title="行业应用">行业应用</a> [6] <a href="feed.php-go=category_63" tppabs="http://i.renjihe.com/blog/feed.php?go=category_63"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_4.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_4" title="资讯">资讯</a> [137] <a href="feed.php-go=category_4" tppabs="http://i.renjihe.com/blog/feed.php?go=category_4"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_12.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_12" title="网文">网文</a> [622] <a href="feed.php-go=category_12" tppabs="http://i.renjihe.com/blog/feed.php?go=category_12"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_41.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_41" title="点子正传">点子正传</a> [20] <a href="feed.php-go=category_41" tppabs="http://i.renjihe.com/blog/feed.php?go=category_41"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_56.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_56" title="理财">理财</a> [24] <a href="feed.php-go=category_56" tppabs="http://i.renjihe.com/blog/feed.php?go=category_56"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_55.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_55" title="收集">收集</a> [157] <a href="feed.php-go=category_55" tppabs="http://i.renjihe.com/blog/feed.php?go=category_55"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_71.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_71" title="创业">创业</a> [405] <a href="feed.php-go=category_71" tppabs="http://i.renjihe.com/blog/feed.php?go=category_71"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_80.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_80" title="共享软件">共享软件</a> [12] <a href="feed.php-go=category_80" tppabs="http://i.renjihe.com/blog/feed.php?go=category_80"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_72.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_72" title="创意">创意</a> [20] <a href="feed.php-go=category_72" tppabs="http://i.renjihe.com/blog/feed.php?go=category_72"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_85.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_85" title="星象命理">星象命理</a> [40] <a href="feed.php-go=category_85" tppabs="http://i.renjihe.com/blog/feed.php?go=category_85"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_11.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_11" title="杂项">杂项</a> [50] <a href="feed.php-go=category_11" tppabs="http://i.renjihe.com/blog/feed.php?go=category_11"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_58.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_58" title="记录">记录</a> [26] <a href="feed.php-go=category_58" tppabs="http://i.renjihe.com/blog/feed.php?go=category_58"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_79.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_79" title="心灵鸡汤">心灵鸡汤</a> [78] <a href="feed.php-go=category_79" tppabs="http://i.renjihe.com/blog/feed.php?go=category_79"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_75.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_75" title="文学">文学</a> [9] <a href="feed.php-go=category_75" tppabs="http://i.renjihe.com/blog/feed.php?go=category_75"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_67.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_67" title="其它工程资料">其它工程资料</a> [2] <a href="feed.php-go=category_67" tppabs="http://i.renjihe.com/blog/feed.php?go=category_67"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_84.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_84" title="哲学">哲学</a> [24] <a href="feed.php-go=category_84" tppabs="http://i.renjihe.com/blog/feed.php?go=category_84"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_87.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_87" title="有言">有言</a> [9] <a href="feed.php-go=category_87" tppabs="http://i.renjihe.com/blog/feed.php?go=category_87"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_88.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_88" title="微语录">微语录</a> [15] <a href="feed.php-go=category_88" tppabs="http://i.renjihe.com/blog/feed.php?go=category_88"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_76.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_76" title="置顶">置顶</a> [440] <a href="feed.php-go=category_76" tppabs="http://i.renjihe.com/blog/feed.php?go=category_76"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_86.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_86" title="励志">励志</a> [10] <a href="feed.php-go=category_86" tppabs="http://i.renjihe.com/blog/feed.php?go=category_86"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_81.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_81" title="资源管理">资源管理</a> [1] <a href="feed.php-go=category_81" tppabs="http://i.renjihe.com/blog/feed.php?go=category_81"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li></ul>
</div>
</div><div class="panel">
<h5 onclick='showhidediv("sidebar_calendar");'>日历</h5>
<div class="panel-content" id="sidebar_calendar" style="display: block">
<table id="calendar" cellspacing="1" width="100%">
<tbody><tr><td colspan="7" class="calendar-top">
<a href="index.php-go=archive&cm=9&cy=2015.htm" tppabs="http://i.renjihe.com/blog/index.php?go=archive&cm=9&cy=2015" rel="noindex,nofollow">&lt;</a>
<a href="archive.php.htm" tppabs="http://i.renjihe.com/blog/archive.php" rel="noindex,nofollow"><span class="calendar-year">2016</span></a>
<a href="index.php-go=archive&cm=9&cy=2017.htm" tppabs="http://i.renjihe.com/blog/index.php?go=archive&cm=9&cy=2017" rel="noindex,nofollow">&gt;</a>
	&nbsp;&nbsp;
<a href="index.php-go=archive&cm=8&cy=2016.htm" tppabs="http://i.renjihe.com/blog/index.php?go=archive&cm=8&cy=2016" rel="noindex,nofollow">&lt;</a>
<a href="index.php-go=archive&cm=9&cy=2016.htm" tppabs="http://i.renjihe.com/blog/index.php?go=archive&cm=9&cy=2016" rel="noindex,nofollow"><span class="calendar-month">9</span></a>
<a href="index.php-go=archive&cm=10&cy=2016.htm" tppabs="http://i.renjihe.com/blog/index.php?go=archive&cm=10&cy=2016" rel="noindex,nofollow">&gt;</a>
</td></tr>
<tr class="calendar-weekdays">
	<td class="calendar-weekday-cell">日</td>
	<td class="calendar-weekday-cell">一</td>
	<td class="calendar-weekday-cell">二</td>
	<td class="calendar-weekday-cell">三</td>
	<td class="calendar-weekday-cell">四</td>
	<td class="calendar-weekday-cell">五</td>
	<td class="calendar-weekday-cell">六</td>
</tr>
<tr class="calendar-weekdays"><td class="calendar-sunday"></td><td class="calendar-day"></td><td class="calendar-day"></td><td class="calendar-day"></td><td id="cal1" class="calendar-day"><a href="index.php-go=showday_2016-9-1.htm" tppabs="http://i.renjihe.com/blog/index.php?go=showday_2016-9-1" rel="noindex,nofollow">1</a></td><td id="cal2" class="calendar-day">2</td><td id="cal3" class="calendar-today">3</td></tr><tr class="calendar-weekdays"><td id="cal4" class="calendar-sunday">4</td><td id="cal5" class="calendar-day">5</td><td id="cal6" class="calendar-day">6</td><td id="cal7" class="calendar-day">7</td><td id="cal8" class="calendar-day">8</td><td id="cal9" class="calendar-day">9</td><td id="cal10" class="calendar-saturday">10</td></tr><tr class="calendar-weekdays"><td id="cal11" class="calendar-sunday">11</td><td id="cal12" class="calendar-day">12</td><td id="cal13" class="calendar-day">13</td><td id="cal14" class="calendar-day">14</td><td id="cal15" class="calendar-day">15</td><td id="cal16" class="calendar-day">16</td><td id="cal17" class="calendar-saturday">17</td></tr><tr class="calendar-weekdays"><td id="cal18" class="calendar-sunday">18</td><td id="cal19" class="calendar-day">19</td><td id="cal20" class="calendar-day">20</td><td id="cal21" class="calendar-day">21</td><td id="cal22" class="calendar-day">22</td><td id="cal23" class="calendar-day">23</td><td id="cal24" class="calendar-saturday">24</td></tr><tr class="calendar-weekdays"><td id="cal25" class="calendar-sunday">25</td><td id="cal26" class="calendar-day">26</td><td id="cal27" class="calendar-day">27</td><td id="cal28" class="calendar-day">28</td><td id="cal29" class="calendar-day">29</td><td id="cal30" class="calendar-day">30</td><td class="calendar-saturday"></td></tr>
</tbody></table>
</div>
</div><div class="panel">
<h5 onclick='showhidediv("sidebar_statistics");'>统计</h5>
<div class="panel-content" id="sidebar_statistics" style="display: block">
访问次数 133640<br/>今日访问 1<br/>日志数量 7121<br/><a href="guestbook.php.htm" tppabs="http://i.renjihe.com/blog/guestbook.php">留言数量 2</a><br/>在线人数 1<br/>
</div>
</div><div class="panel">
<h5 onclick='showhidediv("sidebar_entries");'>最新日志</h5>
<div class="panel-content" id="sidebar_entries" style="display: block">
<ul><li class='rowcouple'><a href="read.php-7527.htm" tppabs="http://i.renjihe.com/blog/read.php?7527" title="mysql优化之索引优化">mysql优化之索引优化</a></li><li class='rowodd'><a href="read.php-7526.htm" tppabs="http://i.renjihe.com/blog/read.php?7526" title="Mysql limit 优化，百万至千万级快速分页，--复合索引的引用并应用于轻量级框架&nbsp;&nbsp;">Mysql limit ...</a></li><li class='rowcouple'><a href="read.php-7525.htm" tppabs="http://i.renjihe.com/blog/read.php?7525" title="mysql sql语句执行时间查询">mysql sql语句执...</a></li><li class='rowodd'><a href="read.php-7524.htm" tppabs="http://i.renjihe.com/blog/read.php?7524" title="GeoHash核心原理解析">GeoHash核心原理解...</a></li><li class='rowcouple'><a href="read.php-7523.htm" tppabs="http://i.renjihe.com/blog/read.php?7523" title="如何实现按距离排序、范围查找">如何实现按距离排序、范围...</a></li></ul>
</div>
</div>
				</div>
				<div id="innerSidebarTwo">
					<div class="panel">
<h5 onclick='showhidediv("sidebar_link");'>链接</h5>
<div class="panel-content" id="sidebar_link" style="display: block">
<ul><li><strong>协会</strong></li><li class="indent"><a href="javascript:if(confirm('http://www.siggraph.org/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.siggraph.org/'" tppabs="http://www.siggraph.org/" target="_blank" title="siggraph - ">siggraph</a></li><li class="indent"><a href="javascript:if(confirm('http://www.siggraph.org.cn/Pages/index.aspx  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.siggraph.org.cn/Pages/index.aspx'" tppabs="http://www.siggraph.org.cn/Pages/index.aspx" target="_blank" title="siggraph中国 - ">siggraph中国</a></li><li class="indent"><a href="javascript:if(confirm('http://www.igf.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.igf.com/'" tppabs="http://www.igf.com/" target="_blank" title="独立游戏节 - ">独立游戏节</a></li><li><strong>项目</strong></li><li class="indent"><a href="javascript:if(confirm('http://youyur.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://youyur.com/'" tppabs="http://youyur.com/" target="_blank" title="有鱼 - ">有鱼</a></li><li class="indent"><a href="javascript:if(confirm('http://codecanyon.net/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://codecanyon.net/'" tppabs="http://codecanyon.net/" target="_blank" title="codecanyon - ">codecanyon</a></li><li class="indent"><a href="javascript:if(confirm('http://www.sxsoft.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.sxsoft.com/'" tppabs="http://www.sxsoft.com/" target="_blank" title="软件项目交易网 - ">软件项目交易网</a></li><li class="indent"><a href="javascript:if(confirm('http://www.csto.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.csto.com/'" tppabs="http://www.csto.com/" target="_blank" title="csto - ">csto</a></li><li class="indent"><a href="javascript:if(confirm('http://themeforest.net/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://themeforest.net/'" tppabs="http://themeforest.net/" target="_blank" title="themeforest - ">themeforest</a></li><li class="indent"><a href="javascript:if(confirm('http://www.digitalriver.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.digitalriver.com/'" tppabs="http://www.digitalriver.com/" target="_blank" title="Digital River - ">Digital River</a></li><li class="indent"><a href="javascript:if(confirm('http://www.vworker.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.vworker.com/'" tppabs="http://www.vworker.com/" target="_blank" title="vworker - ">vworker</a></li><li class="indent"><a href="javascript:if(confirm('http://luexiao.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://luexiao.com/'" tppabs="http://luexiao.com/" target="_blank" title="略晓 - ">略晓</a></li><li class="indent"><a href="javascript:if(confirm('http://www.yateshi.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.yateshi.com/'" tppabs="http://www.yateshi.com/" target="_blank" title="雅特士外包网  - ">雅特士外包网 </a></li><li class="indent"><a href="javascript:if(confirm('http://wpappstore.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://wpappstore.com/'" tppabs="http://wpappstore.com/" target="_blank" title="WP App Store - ">WP App Store</a></li><li class="indent"><a href="javascript:if(confirm('http://store.steampowered.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://store.steampowered.com/'" tppabs="http://store.steampowered.com/" target="_blank" title="Steam - ">Steam</a></li><li class="indent"><a href="javascript:if(confirm('http://www.taskcity.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.taskcity.com/'" tppabs="http://www.taskcity.com/" target="_blank" title="TaskCity - ">TaskCity</a></li><li class="indent"><a href="javascript:if(confirm('http://www.istockphoto.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.istockphoto.com/'" tppabs="http://www.istockphoto.com/" target="_blank" title="iStockphoto - ">iStockphoto</a></li><li class="indent"><a href="javascript:if(confirm('http://envato.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://envato.com/'" tppabs="http://envato.com/" target="_blank" title="Envato - ">Envato</a></li><li class="indent"><a href="javascript:if(confirm('https://tutsplus.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='https://tutsplus.com/'" tppabs="https://tutsplus.com/" target="_blank" title="Tuts+ Premium - ">Tuts+ Premium</a></li><li class="indent"><a href="javascript:if(confirm('http://www.sharebank.com.cn/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.sharebank.com.cn/'" tppabs="http://www.sharebank.com.cn/" target="_blank" title="软行天下  - ">软行天下 </a></li><li class="indent"><a href="javascript:if(confirm('http://www.softreg.com.cn/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.softreg.com.cn/'" tppabs="http://www.softreg.com.cn/" target="_blank" title="中国共享软件注册中心 - ">中国共享软件注册中心</a></li><li class="indent"><a href="javascript:if(confirm('https://www.elance.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='https://www.elance.com/'" tppabs="https://www.elance.com/" target="_blank" title="Elance - ">Elance</a></li><li class="indent"><a href="javascript:if(confirm('http://www.freelancer.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.freelancer.com/'" tppabs="http://www.freelancer.com/" target="_blank" title="freelancer - ">freelancer</a></li><li class="indent"><a href="javascript:if(confirm('http://www.bizsofts.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.bizsofts.com/'" tppabs="http://www.bizsofts.com/" target="_blank" title="软件商务网 - ">软件商务网</a></li><li class="indent"><a href="javascript:if(confirm('https://www.odesk.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='https://www.odesk.com/'" tppabs="https://www.odesk.com/" target="_blank" title="oDesk - ">oDesk</a></li><li class="indent"><a href="javascript:if(confirm('http://store.raspberrypi.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://store.raspberrypi.com/'" tppabs="http://store.raspberrypi.com/" target="_blank" title="树莓派商店 - ">树莓派商店</a></li><li><strong>杂项</strong></li><li class="indent"><a href="javascript:if(confirm('http://www.codinghorror.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.codinghorror.com/'" tppabs="http://www.codinghorror.com/" target="_blank" title="codinghorror - ">codinghorror</a></li><li class="indent"><a href="javascript:if(confirm('http://www.fabiensanglard.net/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.fabiensanglard.net/'" tppabs="http://www.fabiensanglard.net/" target="_blank" title="fabiensanglard - ">fabiensanglard</a></li><li class="indent"><a href="javascript:if(confirm('http://www.intel.com/intelpress/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.intel.com/intelpress/'" tppabs="http://www.intel.com/intelpress/" target="_blank" title="英特尔出版社 - ">英特尔出版社</a></li><li class="indent"><a href="javascript:if(confirm('http://www.opencart.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.opencart.com/'" tppabs="http://www.opencart.com/" target="_blank" title="OpenCart - ">OpenCart</a></li><li class="indent"><a href="javascript:if(confirm('http://www.appinn.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.appinn.com/'" tppabs="http://www.appinn.com/" target="_blank" title="小众软件 - ">小众软件</a></li><li class="indent"><a href="javascript:if(confirm('http://renderhjs.net/shoebox/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://renderhjs.net/shoebox/'" tppabs="http://renderhjs.net/shoebox/" target="_blank" title="shoebox工具 - ">shoebox工具</a></li><li><strong>个人</strong></li><li><strong>阅读</strong></li><li class="indent"><a href="javascript:if(confirm('http://huaban.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://huaban.com/'" tppabs="http://huaban.com/" target="_blank" title="花瓣网 - ">花瓣网</a></li><li class="indent"><a href="javascript:if(confirm('http://www.oralstudy.cn/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.oralstudy.cn/'" tppabs="http://www.oralstudy.cn/" target="_blank" title="英语口语学习网 - ">英语口语学习网</a></li><li class="indent"><a href="javascript:if(confirm('http://www.dspguide.com/pdfbook.htm  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.dspguide.com/pdfbook.htm'" tppabs="http://www.dspguide.com/pdfbook.htm" target="_blank" title="DSP Guide - ">DSP Guide</a></li><li><strong>在线文档</strong></li><li class="indent"><a href="javascript:if(confirm('http://help.adobe.com/zh_CN/flex/mobileapps/index.html  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://help.adobe.com/zh_CN/flex/mobileapps/index.html'" tppabs="http://help.adobe.com/zh_CN/flex/mobileapps/index.html" target="_blank" title="Flex移动开发 - ">Flex移动开发</a></li><li class="indent"><a href="javascript:if(confirm('http://help.adobe.com/zh_CN/as3/learn/index.html  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://help.adobe.com/zh_CN/as3/learn/index.html'" tppabs="http://help.adobe.com/zh_CN/as3/learn/index.html" target="_blank" title="Flex AS3 - ">Flex AS3</a></li><li class="indent"><a href="javascript:if(confirm('http://www.adobe.com/cn/devnet.html  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.adobe.com/cn/devnet.html'" tppabs="http://www.adobe.com/cn/devnet.html" target="_blank" title="Adobe开发者中心 - ">Adobe开发者中心</a></li><li class="indent"><a href="javascript:if(confirm('http://help.adobe.com/zh_CN/FlashPlatform/reference/actionscript/3/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://help.adobe.com/zh_CN/FlashPlatform/reference/actionscript/3/'" tppabs="http://help.adobe.com/zh_CN/FlashPlatform/reference/actionscript/3/" target="_blank" title="ActionScript3.0参考 - ">ActionScript3.0参考</a></li><li class="indent"><a href="javascript:if(confirm('http://help.adobe.com/zh_CN/as3/dev/index.html  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://help.adobe.com/zh_CN/as3/dev/index.html'" tppabs="http://help.adobe.com/zh_CN/as3/dev/index.html" target="_blank" title="ActionScript 3.0 - ">ActionScript 3.0</a></li><li class="indent"><a href="javascript:if(confirm('http://help.adobe.com/zh_CN/air/build/index.html  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://help.adobe.com/zh_CN/air/build/index.html'" tppabs="http://help.adobe.com/zh_CN/air/build/index.html" target="_blank" title="AIR - ">AIR</a></li><li class="indent"><a href="javascript:if(confirm('http://www.ppurl.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.ppurl.com/'" tppabs="http://www.ppurl.com/" target="_blank" title="皮皮书屋 - ">皮皮书屋</a></li><li class="indent"><a href="javascript:if(confirm('http://science.scileaf.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://science.scileaf.com/'" tppabs="http://science.scileaf.com/" target="_blank" title="四叶科学百科 - ">四叶科学百科</a></li><li><strong>临时</strong></li><li class="indent"><a href="javascript:if(confirm('http://www.uisdc.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.uisdc.com/'" tppabs="http://www.uisdc.com/" target="_blank" title="优设 - ">优设</a></li><li class="indent"><a href="javascript:if(confirm('http://www.genesis-3d.com.cn/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.genesis-3d.com.cn/'" tppabs="http://www.genesis-3d.com.cn/" target="_blank" title="genesis-3d - ">genesis-3d</a></li><li class="indent"><a href="javascript:if(confirm('http://designlol.net/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://designlol.net/'" tppabs="http://designlol.net/" target="_blank" title="designlol - ">designlol</a></li></ul>
</div>
</div><div class="panel">
<h5 onclick='showhidediv("sidebar_misc");'>其他</h5>
<div class="panel-content" id="sidebar_misc" style="display: block">
<a href="login.php.htm" tppabs="http://i.renjihe.com/blog/login.php">登入</a><br/><a href="login.php-job=register.htm" tppabs="http://i.renjihe.com/blog/login.php?job=register">注册</a><br/>RSS： <a href="feed.php" tppabs="http://i.renjihe.com/blog/feed.php">日志</a> | <a href="feed.php-go=comment.htm" tppabs="http://i.renjihe.com/blog/feed.php?go=comment">评论</a><br/>编码：UTF-8<br/><a href="javascript:if(confirm('http://validator.w3.org/check?uri=referer  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://validator.w3.org/check?uri=referer'" tppabs="http://validator.w3.org/check?uri=referer" target="_blank">XHTML 1.0</a>
</div>
</div>
				</div>
				<div id="innerSidebarFooter">
				 Powered by <a href="javascript:if(confirm('http://www.bo-blog.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.bo-blog.com/'" tppabs="http://www.bo-blog.com/" target="_blank">Bo-Blog 2.1.1 Release</a><span id="footer-security"><a href="javascript:if(confirm('http://www.cnbct.org/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.cnbct.org/'" tppabs="http://www.cnbct.org/" target="_blank" title="Code detection by Bug.Center.Team"><img src="detect.gif" tppabs="http://i.renjihe.com/blog/images/others/detect.gif" alt="Code detection by Bug.Center.Team" border="0" /></a></span>
				<div id="processtime">
				</div>
				</div>
			</div>
		</div>
	</div>
		<div id="footer">
		</div>
	</div>
</div>
<script type="text/javascript">
loadSidebar();
</script>
<script type='text/javascript'>
//<![CDATA[
if (document.getElementById('processtime')) document.getElementById('processtime').innerHTML="<span class='runtimedisplay'>Run in 309 ms, 4 Queries.</span>";
//]]>
</script></body>
</html>