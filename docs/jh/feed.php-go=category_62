<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0">
<channel>
<title><![CDATA[流浪的龙－个人知识管理]]></title> 
<link>http://i.renjihe.com/blog/index.php</link> 
<description><![CDATA[]]></description> 
<language>zh-cn</language> 
<copyright><![CDATA[流浪的龙－个人知识管理]]></copyright>
<item>
<link>http://i.renjihe.com/blog/read.php?7422</link>
<title><![CDATA[手游2016大数据报告：告诉你互联网最赚钱行业的未来密码]]></title> 
<author>renjihe1988 &lt;admin@yourname.com&gt;</author>
<category><![CDATA[游戏]]></category>
<pubDate>Wed, 27 Jul 2016 06:35:16 +0000</pubDate> 
<guid>http://i.renjihe.com/blog/read.php?7422</guid> 
<description>
<![CDATA[ 
	<table border="0" cellspacing="0" cellpadding="0" style="word-wrap: break-word; empty-cells: show; border-collapse: collapse; table-layout: fixed; width: 678px; overflow: hidden; color: #000000; font-family: Tahoma, 'Microsoft Yahei', Simsun; font-size: 14px; line-height: 25.2px"><tbody><tr style="word-wrap: break-word"><td id="postmessage_1973936" class="t_f" style="word-wrap: break-word; font-size: 16px">作为中国互联网生态中重要的一极，手机游戏（以下简称手游）市场的任何波动，都牵连着资本、巨头和创业者的心。在经过多轮竞争后，目前整个手游市场格局趋于稳定，资本的投入趋于理性，用户增量空间依然可期。从产品层面看，手游业则正在经历一次&ldquo;效益升级&rdquo;。<br /><br />　　企鹅智酷联手应用宝大数据，基于产品数据、智酷全国智能手机用户调研和行业趋势洞察，发布了这份《中国手游行业2016年中报告》。<br /><br />　　在这份报告中，我们将针对手游的精细化运营，来探索几个核心议题：<br /><br />　　重度和轻度手游玩家各自有怎样特征？<br /><br />　　用户对不同类型游戏存在怎样的需求差异？<br /><br />　　开发商/渠道商又该如何操作，才能挖掘出更多商业价值？<br /><br />　　以下为报告全文：<br /><br /><p style="word-wrap: break-word; margin: 0px; padding: 0px" align="center"><img id="aimg_350726" style="word-wrap: break-word; cursor: pointer; max-width: 620px" class="zoom" src="http://www.gameres.com/data/attachment/forum/201607/25/093231ipcljlbbej5nwclw.jpg" border="0" alt="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." title="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." width="600" /></p><p style="word-wrap: break-word; margin: 0px; padding: 0px"></p><br /><p style="word-wrap: break-word; margin: 0px; padding: 0px" align="center"><img id="aimg_350727" style="word-wrap: break-word; cursor: pointer; max-width: 620px" class="zoom" src="http://www.gameres.com/data/attachment/forum/201607/25/093231f0n5fw7zqkkqsp1k.jpg" border="0" alt="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." title="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." width="600" /></p><p style="word-wrap: break-word; margin: 0px; padding: 0px"></p><br />　　企鹅智酷联手应用宝大数据，基于产品数据、智酷全国智能手机用户调研和行业趋势洞察，发布了这份《中国手游行业2016年中报告》。<br /><br /><p style="word-wrap: break-word; margin: 0px; padding: 0px" align="center"><img id="aimg_350728" style="word-wrap: break-word; cursor: pointer; max-width: 620px" class="zoom" src="http://www.gameres.com/data/attachment/forum/201607/25/093231v9y8z2dwd2nt82d2.jpg" border="0" alt="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." title="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." width="600" /></p><p style="word-wrap: break-word; margin: 0px; padding: 0px"></p><br />　　报告章节目录，从多个维度，以数据和分析来呈现中国手游行业的现状与未来。<br /><br /><p style="word-wrap: break-word; margin: 0px; padding: 0px" align="center"><img id="aimg_350729" style="word-wrap: break-word; cursor: pointer; max-width: 620px" class="zoom" src="http://www.gameres.com/data/attachment/forum/201607/25/093232qxyeaxqggzqryett.jpg" border="0" alt="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." title="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." width="600" /></p><p style="word-wrap: break-word; margin: 0px; padding: 0px"></p><br /><p style="word-wrap: break-word; margin: 0px; padding: 0px" align="center"><img id="aimg_350730" style="word-wrap: break-word; cursor: pointer; max-width: 620px" class="zoom" src="http://www.gameres.com/data/attachment/forum/201607/25/093232aligwqzt6cc9wnid.jpg" border="0" alt="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." title="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." width="600" /></p><p style="word-wrap: break-word; margin: 0px; padding: 0px"></p><br />　　从2008年开始，手机游戏与智能手机和移动互联网结合，呈现出巨大的生机。<br /><br /><p style="word-wrap: break-word; margin: 0px; padding: 0px" align="center"><img id="aimg_350731" style="word-wrap: break-word; cursor: pointer; max-width: 620px" class="zoom" src="http://www.gameres.com/data/attachment/forum/201607/25/0932321wticyywycwisbsl.jpg" border="0" alt="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." title="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." width="600" /></p><p style="word-wrap: break-word; margin: 0px; padding: 0px"></p><br />　　在应用宝可监测的手机网民中，49%的用户安装了手游APP。用户日均手游使用时长约32分钟，日均打开手游的次数约3.3次。<br /><br />　　这意味着用户每天打开的手游APP数量有限，专注于自己的喜好或爆款。尽管整体的用户增量空间可期（51%待发掘智能手机用户），但整体市场正在进入爆款迭代+用户重度垂直的时期。<br /><br /><p style="word-wrap: break-word; margin: 0px; padding: 0px" align="center"><img id="aimg_350732" style="word-wrap: break-word; cursor: pointer; max-width: 620px" class="zoom" src="http://www.gameres.com/data/attachment/forum/201607/25/093232h3r3sp5e7s04o7s9.jpg" border="0" alt="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." title="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." width="600" /></p><p style="word-wrap: break-word; margin: 0px; padding: 0px"></p><br />　　CNNIC第36次《中国互联网络发展状况统计报告》数据显示，截至2015年6月，我国使用手机上网玩游戏的用户规模达到2.67亿，较去年底增长了1876万，占整体手机网民的45%。<br /><br />　　自2014年起，手游用户的整体规模进入连续两年的稳定期。尚未渗透的用户，可能需要新的产品形态去突破。<br /><br /><p style="word-wrap: break-word; margin: 0px; padding: 0px" align="center"><img id="aimg_350733" style="word-wrap: break-word; cursor: pointer; max-width: 620px" class="zoom" src="http://www.gameres.com/data/attachment/forum/201607/25/093233nng5zc5q65fnrc6k.jpg" border="0" alt="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." title="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." width="600" /></p><p style="word-wrap: break-word; margin: 0px; padding: 0px"></p><br />　　手游APP玩家以男性用户居多，主要分布在较大城市（二/三线城市）。相对于各级别城市的人口总数而言，手游APP在一线城市渗透情况更好，这和手游人口红利，推广成本/渗透时间等因素相关。<br /><br />　　相对而言，大城市的用户覆盖程度更高，手游开发机会更大。<br /><br />　　在没玩过游戏的智能手机用户中，女性用户比男性高出11%。<br /><br />　　考虑到智能手机用户和中国网民的性别比例（男性均高于女性），女性的手游热情仍有待进一步挖掘。<br /><br />　　这也是一个新的机会窗口：适合女性的手游可能会更快激活增量用户市场。<br /><br /><p style="word-wrap: break-word; margin: 0px; padding: 0px" align="center"><img id="aimg_350735" style="word-wrap: break-word; cursor: pointer; max-width: 620px" class="zoom" src="http://www.gameres.com/data/attachment/forum/201607/25/093233ujou2f5j02vw90tf.jpg" border="0" alt="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." title="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." width="600" /></p><p style="word-wrap: break-word; margin: 0px; padding: 0px"></p><br /><p style="word-wrap: break-word; margin: 0px; padding: 0px" align="center"><img id="aimg_350736" style="word-wrap: break-word; cursor: pointer; max-width: 620px" class="zoom" src="http://www.gameres.com/data/attachment/forum/201607/25/093233zfcxzd9dix4mnzdi.jpg" border="0" alt="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." title="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." width="600" /></p><p style="word-wrap: break-word; margin: 0px; padding: 0px"></p><br />　　手游类型中，角色沉浸感强和具有画面冲击力的角色扮演类、动作冒险类游戏最受用户欢迎。<br /><br />　　休闲益智类、飞行射击类轻量移动游戏因能打发碎片化时间，游戏规则简单，用户也较为喜欢。<br /><br />　　玩休闲益智类游戏的女性用户更多，玩体育竞技类游戏的男性用户更多。<br /><br /><p style="word-wrap: break-word; margin: 0px; padding: 0px" align="center"><img id="aimg_350737" style="word-wrap: break-word; cursor: pointer; max-width: 620px" class="zoom" src="http://www.gameres.com/data/attachment/forum/201607/25/093234w6lhqqhqqzzflh13.jpg" border="0" alt="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." title="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." width="600" /></p><p style="word-wrap: break-word; margin: 0px; padding: 0px"></p><br />　　联网手游以84%的渗透率占据第一，单机类手游排名第二。<br /><br />　　联网手游用户中男性更多，而轻量级手机网页游戏中，女性玩家更多。<br /><br />　　联网手游超过单机手游的用户渗透，代表了整个手游产品设计进入了一个新的课题：如何激活网络在手游中的作用和价值。<br /><br /><p style="word-wrap: break-word; margin: 0px; padding: 0px" align="center"><img id="aimg_350739" style="word-wrap: break-word; cursor: pointer; max-width: 620px" class="zoom" src="http://www.gameres.com/data/attachment/forum/201607/25/0932346cfwxckx27k5gqc0.jpg" border="0" alt="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." title="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." width="600" /></p><p style="word-wrap: break-word; margin: 0px; padding: 0px"></p><br />　　手游题材/类型是吸引用户下载的最主要原因。口碑和热度也是影响用户体验的重要因素，这在20岁以下的年轻人中尤为明显。<br /><br />　　26-35岁群体，多具有早期端游的体验回忆，经典端游移植手游，能对这个群体产生较大吸引力。<br /><br />　　63%的用户在成块闲暇时间（饭后/睡前等）体验手游，一半的用户玩手游是基于游戏目的（体验乐趣/缓解压力），消磨零碎时间并不是用户玩手游的最主要场景。<br /><br />　　男性用户体验手游更追求团队作战乐趣，游戏类型上倾向体育竞技，女性更容易在零碎时间拿出手机玩游戏，轻量级的休闲益智类游戏更受欢迎。<br /><br /><p style="word-wrap: break-word; margin: 0px; padding: 0px" align="center"><img id="aimg_350740" style="word-wrap: break-word; cursor: pointer; max-width: 620px" class="zoom" src="http://www.gameres.com/data/attachment/forum/201607/25/093234z9aw4p7n4733a193.jpg" border="0" alt="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." title="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." width="600" /></p><p style="word-wrap: break-word; margin: 0px; padding: 0px"></p><br />　　在均值调研中我们发现，手游比端游更难维持热度，次日留存和7日留存率都较低。5.7%用户的热度不超过一天，只有33%的用户对一款手游的热度能维持半年以上。<br /><br />　　手游时代，用户对游戏的消费更加快速，市场因此对开发者提出更高要求&mdash;&mdash;游戏要在开始就能吸引用户，另外还要在故事和玩法上进行创新，尽量延迟用户的离开。<br /><br />　　对于不再热衷的游戏，超过70%的用户选择直接卸载删除。&ldquo;剧情、功能单一&rdquo;是用户删除游戏的首要原因。<br /><br />　　游戏太消耗时间、太费钱也导致四成用户选择删除游戏。<br /><br />　　值得注意的是，只有11%的用户会因为好友不玩了而放弃游戏&mdash;&mdash;联网手游虽然已成为市场主流，但社交元素尚未形成足够的用户游戏粘性。<br /><br /><p style="word-wrap: break-word; margin: 0px; padding: 0px" align="center"><img id="aimg_350742" style="word-wrap: break-word; cursor: pointer; max-width: 620px" class="zoom" src="http://www.gameres.com/data/attachment/forum/201607/25/093235rzbogxmmrebblfe7.jpg" border="0" alt="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." title="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." width="600" /></p><p style="word-wrap: break-word; margin: 0px; padding: 0px"></p><br /><p style="word-wrap: break-word; margin: 0px; padding: 0px" align="center"><img id="aimg_350743" style="word-wrap: break-word; cursor: pointer; max-width: 620px" class="zoom" src="http://www.gameres.com/data/attachment/forum/201607/25/093235norxlqlzznwebxnb.jpg" border="0" alt="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." title="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." width="600" /></p><p style="word-wrap: break-word; margin: 0px; padding: 0px"></p><br />　　除了打发成块闲暇时间（饭后/睡前），享受与他人作战乐趣是重度用户体验手游的重要原因。<br /><br />　　而对于轻度用户，这个因素并不具有吸引力；从分布来说，大城市的重度手游用户相对更多，集中在20-30岁的人群。<br /><br />　　小城市（四线及以下）的重度用户多于轻度用户；25岁以下用户中，轻度用户多于重度用户。<br /><br /><p style="word-wrap: break-word; margin: 0px; padding: 0px" align="center"><img id="aimg_350744" style="word-wrap: break-word; cursor: pointer; max-width: 620px" class="zoom" src="http://www.gameres.com/data/attachment/forum/201607/25/093236nuqxuqaj4qxnjyoz.jpg" border="0" alt="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." title="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." width="600" /></p><p style="word-wrap: break-word; margin: 0px; padding: 0px"></p><br />　　高消费用户更加看重游戏体验的技术环境（不能存在外挂/BUG）以及游戏搭档合拍；<br /><br />　　低消费用户比较在意游戏对设备的影响（手机耗电快/易发热）；<br /><br />　　25岁以下的低消费用户多于高消费用户；<br /><br />　　在城市分布上，不同程度消费的用户并无明显差异。<br /><br /><p style="word-wrap: break-word; margin: 0px; padding: 0px" align="center"><img id="aimg_350745" style="word-wrap: break-word; cursor: pointer; max-width: 620px" class="zoom" src="http://www.gameres.com/data/attachment/forum/201607/25/0932363u6jxre0406x6rlz.jpg" border="0" alt="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." title="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." width="600" /></p><p style="word-wrap: break-word; margin: 0px; padding: 0px"></p><br />　　常见的手游设定中，能够带来强烈成就感的游戏环节（打败对手、游戏通关）最受用户欢迎。个人成长升级、获得装备的体验也深受用户喜欢。<br /><br />　　对于重度用户来说，他们最看重打败对手和获得装备这样的游戏环节，二者比例均超过60%。<br /><br /><p style="word-wrap: break-word; margin: 0px; padding: 0px" align="center"><img id="aimg_350746" style="word-wrap: break-word; cursor: pointer; max-width: 620px" class="zoom" src="http://www.gameres.com/data/attachment/forum/201607/25/09323673cxp47px5jz7ej9.jpg" border="0" alt="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." title="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." width="600" /></p><p style="word-wrap: break-word; margin: 0px; padding: 0px"></p><br />　　一次性付费是用户最希望采用的付费方式，其次为游戏免费+道具收费。<br /><br />　　高消费用户更能接受游戏、道具双重收费，比例是整体水平两倍多。<br /><br /><p style="word-wrap: break-word; margin: 0px; padding: 0px" align="center"><img id="aimg_350747" style="word-wrap: break-word; cursor: pointer; max-width: 620px" class="zoom" src="http://www.gameres.com/data/attachment/forum/201607/25/0932369fqvhvjkakodf1ov.jpg" border="0" alt="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." title="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." width="600" /></p><p style="word-wrap: break-word; margin: 0px; padding: 0px"></p><br />　　对于游戏/道具的定价，用户的接受度集中在低价（10元以下）和高价（50元以上）两端。 11-50元的中间价位接受度最低。<br /><br />　　超过一半的低消费用户每天用于游戏的时间不超过一小时，比其它用户更愿意体验单机游戏，体验手游的目的以消磨时间、缓解压力为主。<br /><br /><p style="word-wrap: break-word; margin: 0px; padding: 0px" align="center"><img id="aimg_350748" style="word-wrap: break-word; cursor: pointer; max-width: 620px" class="zoom" src="http://www.gameres.com/data/attachment/forum/201607/25/093237emtx6h4egzeleeyh.jpg" border="0" alt="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." title="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." width="600" /></p><p style="word-wrap: break-word; margin: 0px; padding: 0px"></p><br /><p style="word-wrap: break-word; margin: 0px; padding: 0px" align="center"><img id="aimg_350749" style="word-wrap: break-word; cursor: pointer; max-width: 620px" class="zoom" src="http://www.gameres.com/data/attachment/forum/201607/25/093237eo5wpstbeufwsc4u.jpg" border="0" alt="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." title="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." width="600" /></p><p style="word-wrap: break-word; margin: 0px; padding: 0px"></p><br />　　CNNIC发布报告显示，国内手游用户的付费率显著提高，由2014年27.6%提升至2015年的46.6%。<br /><br />　　根据企鹅智酷调查，2016年上半年，手游用户付费率进一步提升至68.4%，较2015年提升了21.8个百分点。<br /><br />　　用户平均收入的增长、游戏重度化造成的用户黏性增强，用户付费意识提升，加上便捷多样的支付手段等多方面原因促成用户付费比例快速增长。<br /><br /><p style="word-wrap: break-word; margin: 0px; padding: 0px" align="center"><img id="aimg_350750" style="word-wrap: break-word; cursor: pointer; max-width: 620px" class="zoom" src="http://www.gameres.com/data/attachment/forum/201607/25/0932373jcxwzmc2yxaw2fq.jpg" border="0" alt="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." title="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." width="600" /></p><p style="word-wrap: break-word; margin: 0px; padding: 0px"></p><br />　　手游付费用户中，月均消费在50元以上的比例，2014年到2015年有明显提升，月均消费100元以上的付费用户占比涨幅翻倍。<br /><br />　　用户平均收入的增长、手游重度化造成的用户黏性增强，以及便捷多样的支付手段等原因，促成了用户消费提升。对于游戏变现来说，2015年开启了一个黄金时代。<br /><br /><p style="word-wrap: break-word; margin: 0px; padding: 0px" align="center"><img id="aimg_350751" style="word-wrap: break-word; cursor: pointer; max-width: 620px" class="zoom" src="http://www.gameres.com/data/attachment/forum/201607/25/093238e6w4wt4hzlxmc3hl.jpg" border="0" alt="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." title="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." width="600" /></p><p style="word-wrap: break-word; margin: 0px; padding: 0px"></p><br />　　和其它数字服务相比，手游用户中有过付费行为的比例高达68.4%，是从未付费用户的两倍多。<br /><br />　　不同类型用户付费情况同样存在很大差异。中度、重度用户的付费渗透率，显著高于轻度用户。<br /><br /><p style="word-wrap: break-word; margin: 0px; padding: 0px" align="center"><img id="aimg_350752" style="word-wrap: break-word; cursor: pointer; max-width: 620px" class="zoom" src="http://www.gameres.com/data/attachment/forum/201607/25/093238gqoz6g4q8dv3vqov.jpg" border="0" alt="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." title="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." width="600" /></p><p style="word-wrap: break-word; margin: 0px; padding: 0px"></p><br />　　用户每天在手游上的时间消费，30分钟-3小时是最集中的时段。15.2%的用户每天用于手游的时间超过3小时。<br /><br />　　只有三成用户每天用于手游的平均时间在半小时以内。<br /><br />　　对于游戏/道具定价，四成重度用户能接受100元以上的单价。<br /><br /><p style="word-wrap: break-word; margin: 0px; padding: 0px" align="center"><img id="aimg_350753" style="word-wrap: break-word; cursor: pointer; max-width: 620px" class="zoom" src="http://www.gameres.com/data/attachment/forum/201607/25/093238ce5wtw59xw5uu59x.jpg" border="0" alt="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." title="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." width="600" /></p><p style="word-wrap: break-word; margin: 0px; padding: 0px"></p><br />　　对于感兴趣的游戏，半数以上用户会在不同设备上体验不同版本。<br /><br />　　游戏改编的影视作品，有四成用户抱有期待；而对于游戏改版为漫画小说，支持者仅为23%。<br /><br /><p style="word-wrap: break-word; margin: 0px; padding: 0px" align="center"><img id="aimg_350754" style="word-wrap: break-word; cursor: pointer; max-width: 620px" class="zoom" src="http://www.gameres.com/data/attachment/forum/201607/25/093239lvluccyed7cppdhv.jpg" border="0" alt="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." title="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." width="600" /></p><p style="word-wrap: break-word; margin: 0px; padding: 0px"></p><br />　　手游用户希望能体验同款游戏的电脑版本，而电脑游戏用户对同款游戏的手游版却没有那么期待。<br /><br />　　对于游戏改编的其他作品形式，手游用户的体验意愿也相对更强烈。<br /><br />　　一方面轻量的手游还无法做到复杂功能和情境的完全还原；另一方面手游在体验设备和操作习惯上受限，很难享受到端游的深度畅玩。<br /><br /><p style="word-wrap: break-word; margin: 0px; padding: 0px" align="center"><img id="aimg_350755" style="word-wrap: break-word; cursor: pointer; max-width: 620px" class="zoom" src="http://www.gameres.com/data/attachment/forum/201607/25/093239v47tvzzakqqwepaq.jpg" border="0" alt="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." title="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." width="600" /></p><p style="word-wrap: break-word; margin: 0px; padding: 0px"></p><br /><p style="word-wrap: break-word; margin: 0px; padding: 0px" align="center"><img id="aimg_350756" style="word-wrap: break-word; cursor: pointer; max-width: 620px" class="zoom" src="http://www.gameres.com/data/attachment/forum/201607/25/093239rbrgs5chebdnad5s.jpg" border="0" alt="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." title="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." width="600" /></p><p style="word-wrap: break-word; margin: 0px; padding: 0px"></p><br />　　超过60%的用户愿意为角色扮演类手游付费，它是用户付费意愿最高的手游类型。<br /><br />　　动作冒险、经营策略类手游是用户付费意愿第二高的手游类型。<br /><br />　　部分用户能够接受50元以上的游戏/道具收费，这类高消费用户最愿付费的手游类型是角色扮演和经营策略，其付费意愿均高于整体水平。<br /><br /><p style="word-wrap: break-word; margin: 0px; padding: 0px" align="center"><img id="aimg_350757" style="word-wrap: break-word; cursor: pointer; max-width: 620px" class="zoom" src="http://www.gameres.com/data/attachment/forum/201607/25/093240bpe129jjf6bezpjz.jpg" border="0" alt="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." title="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." width="600" /></p><p style="word-wrap: break-word; margin: 0px; padding: 0px"></p><br />　　在日均打开次数上，各类手游APP稳定在3-4次，类别之间并无明显差异。<br /><br />　　角色扮演类手游用户带入感强，无论用户吸收还是用户粘性，均表现出色，用户付费意愿位列各手游类型之首。<br /><br />　　目前角色扮演类手游数量不及整个手游生态APP十分之一，是值得关注的一座金矿。<br /><br /><p style="word-wrap: break-word; margin: 0px; padding: 0px" align="center"><img id="aimg_350758" style="word-wrap: break-word; cursor: pointer; max-width: 620px" class="zoom" src="http://www.gameres.com/data/attachment/forum/201607/25/093240enqhg4naqm2m34le.jpg" border="0" alt="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." title="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." width="600" /></p><p style="word-wrap: break-word; margin: 0px; padding: 0px"></p><br />　　休闲益智类手游APP游戏规则简单，同质化严重，导致此类APP体量巨大，但其用户留存能力较弱；用户对此类手游APP的付费意愿低，商业开发风险高。<br /><br />　　动作冒险类游戏用户很喜欢，但是现有的APP数量并不满足用户需求。<br /><br />　　棋牌类手游社交互动性强，单个APP拥有用户规模最大，此类APP以4%的数量占比吸引了16%的游戏用户下载。<br /><br /><p style="word-wrap: break-word; margin: 0px; padding: 0px" align="center"><img id="aimg_350759" style="word-wrap: break-word; cursor: pointer; max-width: 620px" class="zoom" src="http://www.gameres.com/data/attachment/forum/201607/25/093240u09t6szfo3y6yya3.jpg" border="0" alt="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." title="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." width="600" /></p><p style="word-wrap: break-word; margin: 0px; padding: 0px"></p><br />　　&ldquo;更多游戏角色&rdquo;和&ldquo;快速升级&rdquo;是用户最愿付费的两类手游特性，二者比例分别为50.2%、41.1%。<br /><br />　　游戏关卡的帮助提示和音画效果提升对用户付费的吸引力低，游戏的核心内容仍然是用户最意付费的特性。<br /><br />　　对于游戏中成长升级、获取装备、打败对手等经历所带来的体验，付费用户的感受比非付费用户更强烈。<br /><br /><p style="word-wrap: break-word; margin: 0px; padding: 0px" align="center"><img id="aimg_350760" style="word-wrap: break-word; cursor: pointer; max-width: 620px" class="zoom" src="http://www.gameres.com/data/attachment/forum/201607/25/093241gg60b3nftlfol0df.jpg" border="0" alt="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." title="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." width="600" /></p><p style="word-wrap: break-word; margin: 0px; padding: 0px"></p><br />　　手游的题材、玩法的创新，仍然是用户的第一需求。<br /><br />　　合作和海外拓展也是中国游戏发展的大趋势。同时，用户希望在手游IP衍生领域有更多内容涌现，例如进行其他形式改编，举办电竞比赛、游戏展览等。<br /><br /><p style="word-wrap: break-word; margin: 0px; padding: 0px" align="center"><img id="aimg_350761" style="word-wrap: break-word; cursor: pointer; max-width: 620px" class="zoom" src="http://www.gameres.com/data/attachment/forum/201607/25/093241vx6b00x7r030z7z3.jpg" border="0" alt="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." title="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." width="600" /></p><p style="word-wrap: break-word; margin: 0px; padding: 0px"></p><br />　　基础性能是用户最希望改进的手游特性，包括改善耗电发热、减少游戏Bug等。<br /><br />　　游戏的整体体验是用户希望改善的第二类改进，包括丰富故事、改善游戏操作和音效等。<br /><br />　　除此之外，用户还希望手游改善压缩包大小等游戏细节，同时增加新功能。<br /><br /><p style="word-wrap: break-word; margin: 0px; padding: 0px" align="center"><img id="aimg_350762" style="word-wrap: break-word; cursor: pointer; max-width: 620px" class="zoom" src="http://www.gameres.com/data/attachment/forum/201607/25/0932417eto9d4dod7ed9zd.jpg" border="0" alt="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." title="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." width="600" /></p><p style="word-wrap: break-word; margin: 0px; padding: 0px"></p><br /><p style="word-wrap: break-word; margin: 0px; padding: 0px" align="center"><img id="aimg_350763" style="word-wrap: break-word; cursor: pointer; max-width: 620px" class="zoom" src="http://www.gameres.com/data/attachment/forum/201607/25/093242of500fj5n0sco380.jpg" border="0" alt="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." title="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." width="600" /></p><p style="word-wrap: break-word; margin: 0px; padding: 0px"></p><br />　　手游行业经过自2013年开始的用户规模高速增长后，在2015年逐渐走向成熟。无论是用户增速，还是资本热度，都在回归理性。<br /><br />　　对于游戏来说，重度和垂直时代让产品、技术重要性更加凸显。手游需要依靠品质来吸引用户长期使用和提高体验，游戏玩法的差异化发展和创新尤为重要。<br /><br /><p style="word-wrap: break-word; margin: 0px; padding: 0px" align="center"><img id="aimg_350764" style="word-wrap: break-word; cursor: pointer; max-width: 620px" class="zoom" src="http://www.gameres.com/data/attachment/forum/201607/25/0932427tn4gjyuqnkgsht2.jpg" border="0" alt="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." title="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." width="600" /></p><p style="word-wrap: break-word; margin: 0px; padding: 0px"></p><br />　　手游用户规模在现有模式下，已趋于稳定。而随着手游APP的海量增长，吸引留存沉浸用户越加困难，仅有33.1%的用户会玩同一款手游超过半年，因此在产品高热期充分挖掘多元价值变得更为重要。<br /><br />　　用户的手游消费意愿在快速提升，中度和重度玩家的付费意愿覆盖度超过70%，挖掘手游用户的付费行为正在成为新的生命线，游戏付费环节的设计对未来手游开发越来越重要。<br /><br /><p style="word-wrap: break-word; margin: 0px; padding: 0px" align="center"><img id="aimg_350765" style="word-wrap: break-word; cursor: pointer; max-width: 620px" class="zoom" src="http://www.gameres.com/data/attachment/forum/201607/25/093242wxihatzarbpwsrrx.jpg" border="0" alt="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." title="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." width="600" /></p><p style="word-wrap: break-word; margin: 0px; padding: 0px"></p><br />　　对于手游公司而言，国际化的诱惑是无法抗拒的。中国手游产品在经历了探索期后，近年来已有多款产品成功拓展了海外市场。<br /><br />　　在产品出海之外，手游资本出海也成为了新的价值方向。除了投资成熟产品获取可观的利润和现金流之外，对潜力产品和潜力团队的投资，以及对手游新技术和解决方案的布局，也同样重要。<br /><br />　　资本出海投资和产品出海赚钱，是两条看似平行实则相交的路线。资本的海外投资并购，可以拓展全球渠道资源、本地化团队与文化认知，这对于自身产品的海外版本研发和落地推广，有着重要价值。<br /><br />　　基于体验环境、体验习惯、载体的差异性，端游到手游的移植鲜有成功。同一IP的情怀升级可能会吸引目标用户进入，但手游生态差异导致深度畅玩受限，用户流失以及卸载APP的风险较高。<br /><br />　　端游成功移植手游四要素：<br /><br />　　针对目标用户经典玩法还原；付费内容相对前置；降低游戏复杂度，做好前期新手引导；做好社交关系链，让用户更好融入组织，良性社交。<br /><br /><p style="word-wrap: break-word; margin: 0px; padding: 0px" align="center"><img id="aimg_350767" style="word-wrap: break-word; cursor: pointer; max-width: 620px" class="zoom" src="http://www.gameres.com/data/attachment/forum/201607/25/093243f0hthwwx4r4e8ier.jpg" border="0" alt="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." title="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." width="600" /></p><p style="word-wrap: break-word; margin: 0px; padding: 0px"></p><br />　　联网手游超过单机手游，但联网手游依然是游戏性为主，好友社交对留住用户的价值还没有充分挖掘。<br /><br />　　中度、重度手游研发的成本高，对用户的期求不仅是稳定，更要有足够黏度。未来手游市场的竞争，中重度手游的社交化元素将是关键。<br /><br />　　从单纯分享转变到和好友PK，以及排名功能社交深化，满足用户竞争心理，提高移动游戏的生命力和耐玩度。<br /><br /><p style="word-wrap: break-word; margin: 0px; padding: 0px" align="center"><img id="aimg_350768" style="word-wrap: break-word; cursor: pointer; max-width: 620px" class="zoom" src="http://www.gameres.com/data/attachment/forum/201607/25/0932434jgrxfdq4ir69znk.jpg" border="0" alt="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." title="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." width="600" /></p><p style="word-wrap: break-word; margin: 0px; padding: 0px"></p><br />　　市场巨头通过强强联合和收购明星产品，优势互补以达到成本收益最优，同时帮助行业培养用户习惯，搭建平台，规范、引领行业进化，帮助行业找寻新的增长点。<br /><br />　　中国市场的用户需求更为多元，存在很多可拓展的空间和领域，利于小公司的生存。小公司可以注重创新小众方向，灵活根据市场需求调节，切入热点，并通过大公司帮助拓展，减小成本压力，精准把握尾量用户，细分游戏类型做差异化的产品。<br /><br /><p style="word-wrap: break-word; margin: 0px; padding: 0px" align="center"><img id="aimg_350769" style="word-wrap: break-word; cursor: pointer; max-width: 620px" class="zoom" src="http://www.gameres.com/data/attachment/forum/201607/25/093243tss1zb1w8zs1wy1e.jpg" border="0" alt="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." title="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." width="600" /></p><p style="word-wrap: break-word; margin: 0px; padding: 0px"></p><br /><p style="word-wrap: break-word; margin: 0px; padding: 0px" align="center"><img id="aimg_350770" style="word-wrap: break-word; cursor: pointer; max-width: 620px" class="zoom" src="http://www.gameres.com/data/attachment/forum/201607/25/0932441loxxmzmor3o1n3g.jpg" border="0" alt="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." title="手游2016大数据报告：告诉你互联网最赚钱行业的未来密码 ..." width="600" /></p><p style="word-wrap: break-word; margin: 0px; padding: 0px"></p><br /><p style="word-wrap: break-word; margin: 0px; padding: 0px" align="left">via：腾讯</p><br /><p style="word-wrap: break-word; margin: 0px; padding: 0px" align="left">相关阅读：<a style="word-wrap: break-word; color: #000066" href="http://www.gameres.com/671406.html" target="_blank">App Annie：2016年Q2全球移动应用数据报告</a></p><br /><p style="word-wrap: break-word; margin: 0px; padding: 0px" align="left"><span style="word-wrap: break-word; font-size: x-small"><span style="word-wrap: break-word; color: #8b0000">声明：游资网登载此文出于传递信息之目的，绝不意味着游资网赞同其观点或证实其描述。</span></span></p></td></tr></tbody></table><div class="pattl" style="word-wrap: break-word; overflow: hidden; padding: 1em 0px; width: 678px; font-family: Tahoma, 'Microsoft Yahei', Simsun; border-bottom-width: 1px !important; border-bottom-style: dashed !important; border-bottom-color: #cdcdcd !important"><dl class="tattl attm" style="word-wrap: break-word; margin: 0px; padding: 10px 10px 10px 0px; float: none; overflow: visible; width: 580px; height: auto"><dt style="word-wrap: break-word; float: left; width: 0px; font-weight: 700"></dt><dd style="word-wrap: break-word; margin: 0px; padding: 0px; color: #999999"><p style="word-wrap: break-word; margin-top: 0px; margin-right: 0px; margin-left: 0px; padding: 0px; margin-bottom: 5px !important" class="mbn"><a id="aid350766" style="word-wrap: break-word; color: #000066; font-weight: 700" href="http://www.gameres.com/forum.php?mod=attachment&amp;aid=MzUwNzY2fDg5YjJkODlkfDE0Njk1OTExNjV8MHw2NzE4NTE%3D&amp;nothumb=yes" target="_blank" class="xw1">550.jpg</a>&nbsp;<span style="word-wrap: break-word; color: #666666" class="xg1">(50.69 KB, 下载次数: 1)</span></p><p style="word-wrap: break-word; margin-top: 0px; margin-right: 0px; margin-left: 0px; padding: 0px; margin-bottom: 5px !important" class="mbn"></p><p style="word-wrap: break-word; margin-top: 0px; margin-right: 0px; margin-left: 0px; padding: 0px; margin-bottom: 5px !important" class="mbn"><img id="aimg_350766" style="word-wrap: break-word; cursor: pointer; max-width: 620px" class="zoom" src="http://www.gameres.com/data/attachment/forum/201607/25/093243x1gozllcww8wpokh.jpg" border="0" alt="550.jpg" title="550.jpg" width="600" /></p></dd></dl><dl class="tattl attm" style="word-wrap: break-word; margin: 0px; padding: 10px 10px 10px 0px; float: none; overflow: visible; width: 580px; height: auto"><dt style="word-wrap: break-word; float: left; width: 0px; font-weight: 700"></dt><dd style="word-wrap: break-word; margin: 0px; padding: 0px; color: #999999"><p style="word-wrap: break-word; margin-top: 0px; margin-right: 0px; margin-left: 0px; padding: 0px; margin-bottom: 5px !important" class="mbn"><a id="aid350741" style="word-wrap: break-word; color: #000066; font-weight: 700" href="http://www.gameres.com/forum.php?mod=attachment&amp;aid=MzUwNzQxfDE1MGMxZjk1fDE0Njk1OTExNjV8MHw2NzE4NTE%3D&amp;nothumb=yes" target="_blank" class="xw1">525.jpg</a>&nbsp;<span style="word-wrap: break-word; color: #666666" class="xg1">(63.15 KB, 下载次数: 1)</span></p><p style="word-wrap: break-word; margin-top: 0px; margin-right: 0px; margin-left: 0px; padding: 0px; margin-bottom: 5px !important" class="mbn"></p><p style="word-wrap: break-word; margin-top: 0px; margin-right: 0px; margin-left: 0px; padding: 0px; margin-bottom: 5px !important" class="mbn"><img id="aimg_350741" style="word-wrap: break-word; cursor: pointer; max-width: 620px" class="zoom" src="http://www.gameres.com/data/attachment/forum/201607/25/093235epmvzglp13m9aalp.jpg" border="0" alt="525.jpg" title="525.jpg" width="600" /></p></dd></dl><dl class="tattl attm" style="word-wrap: break-word; margin: 0px; padding: 10px 10px 10px 0px; float: none; overflow: visible; width: 580px; height: auto"><dt style="word-wrap: break-word; float: left; width: 0px; font-weight: 700"></dt><dd style="word-wrap: break-word; margin: 0px; padding: 0px; color: #999999"><p style="word-wrap: break-word; margin-top: 0px; margin-right: 0px; margin-left: 0px; padding: 0px; margin-bottom: 5px !important" class="mbn"><a id="aid350738" style="word-wrap: break-word; color: #000066; font-weight: 700" href="http://www.gameres.com/forum.php?mod=attachment&amp;aid=MzUwNzM4fGU0ODI3NWU1fDE0Njk1OTExNjV8MHw2NzE4NTE%3D&amp;nothumb=yes" target="_blank" class="xw1">522.jpg</a>&nbsp;<span style="word-wrap: break-word; color: #666666" class="xg1">(49.72 KB, 下载次数: 1)</span></p><p style="word-wrap: break-word; margin-top: 0px; margin-right: 0px; margin-left: 0px; padding: 0px; margin-bottom: 5px !important" class="mbn"></p><p style="word-wrap: break-word; margin-top: 0px; margin-right: 0px; margin-left: 0px; padding: 0px; margin-bottom: 5px !important" class="mbn"><img id="aimg_350738" style="word-wrap: break-word; cursor: pointer; max-width: 620px" class="zoom" src="http://www.gameres.com/data/attachment/forum/201607/25/093234ws2zgwa0gg6gg6e2.jpg" border="0" alt="522.jpg" title="522.jpg" width="600" /></p></dd></dl><dl class="tattl attm" style="word-wrap: break-word; margin: 0px; padding: 10px 10px 10px 0px; float: none; overflow: visible; width: 580px; height: auto"><dt style="word-wrap: break-word; float: left; width: 0px; font-weight: 700"></dt><dd style="word-wrap: break-word; margin: 0px; padding: 0px; color: #999999"><p style="word-wrap: break-word; margin-top: 0px; margin-right: 0px; margin-left: 0px; padding: 0px; margin-bottom: 5px !important" class="mbn"><a id="aid350734" style="word-wrap: break-word; color: #000066; font-weight: 700" href="http://www.gameres.com/forum.php?mod=attachment&amp;aid=MzUwNzM0fDNmNTZiYmE5fDE0Njk1OTExNjV8MHw2NzE4NTE%3D&amp;nothumb=yes" target="_blank" class="xw1">518.jpg</a>&nbsp;<span style="word-wrap: break-word; color: #666666" class="xg1">(43.87 KB, 下载次数: 0)</span></p><p style="word-wrap: break-word; margin-top: 0px; margin-right: 0px; margin-left: 0px; padding: 0px; margin-bottom: 5px !important" class="mbn"></p><p style="word-wrap: break-word; margin-top: 0px; margin-right: 0px; margin-left: 0px; padding: 0px; margin-bottom: 5px !important" class="mbn"><img id="aimg_350734" style="word-wrap: break-word; cursor: pointer; max-width: 620px" class="zoom" src="http://www.gameres.com/data/attachment/forum/201607/25/093233buooutjnznioibeu.jpg" border="0" alt="518.jpg" title="518.jpg" width="600" /></p></dd></dl></div>
]]>
</description>
</item><item>
<link>http://i.renjihe.com/blog/read.php?7417</link>
<title><![CDATA[解构C#游戏框架uFrame兼谈游戏架构设计]]></title> 
<author>renjihe1988 &lt;admin@yourname.com&gt;</author>
<category><![CDATA[游戏]]></category>
<pubDate>Mon, 25 Jul 2016 13:10:31 +0000</pubDate> 
<guid>http://i.renjihe.com/blog/read.php?7417</guid> 
<description>
<![CDATA[ 
	<div id="cnblogs_post_body" class="cnblogs-markdown" style="margin: 0px 0px 20px; padding: 0px; word-break: break-word; font-family: 微软雅黑, 宋体, 黑体, Arial; font-size: 14px; line-height: 25.2px"><div id="navCategory" style="margin: 0px; padding: 0px"><p style="margin: 10px auto; padding: 0px; font-size: 18px"><a style="margin: 0px; padding: 0px; outline: none; color: black" href="http://www.cnblogs.com/murongxiaopifu/p/4531234.html"><strong style="margin: 0px; padding: 0px">c#语言规范</strong></a></p><p style="margin: 10px auto; padding: 0px; font-size: 18px"><strong style="margin: 0px; padding: 0px">阅读目录</strong></p><ul style="margin: 0px 0px 0px 30px; padding: 0px; word-break: break-all"><li style="margin: 0px 0px 1em; padding: 0px; list-style: disc; font-size: 15px"><a style="margin: 0px; padding: 0px; outline: none; color: black" href="http://www.cnblogs.com/murongxiaopifu/p/5582408.html#_label0">1.概览</a></li><li style="margin: 0px 0px 1em; padding: 0px; list-style: disc; font-size: 15px"><a style="margin: 0px; padding: 0px; outline: none; color: black" href="http://www.cnblogs.com/murongxiaopifu/p/5582408.html#_label1">2.基本概念</a></li><li style="margin: 0px 0px 1em; padding: 0px; list-style: disc; font-size: 15px"><a style="margin: 0px; padding: 0px; outline: none; color: black" href="http://www.cnblogs.com/murongxiaopifu/p/5582408.html#_label2">3.依赖注入</a></li><li style="margin: 0px 0px 1em; padding: 0px; list-style: disc; font-size: 15px"><a style="margin: 0px; padding: 0px; outline: none; color: black" href="http://www.cnblogs.com/murongxiaopifu/p/5582408.html#_label3">4.Manager of Managers</a></li><li style="margin: 0px 0px 1em; padding: 0px; list-style: disc; font-size: 15px"><a style="margin: 0px; padding: 0px; outline: none; color: black" href="http://www.cnblogs.com/murongxiaopifu/p/5582408.html#_label4">5.利用UniRX实现响应式编程</a></li><li style="margin: 0px 0px 1em; padding: 0px; list-style: disc; font-size: 15px"><a style="margin: 0px; padding: 0px; outline: none; color: black" href="http://www.cnblogs.com/murongxiaopifu/p/5582408.html#_label5">6.研究总结</a></li></ul></div><div style="margin: 0px; padding: 0px; text-align: right"><a style="margin: 0px; padding: 0px; outline: none; color: black" href="http://www.cnblogs.com/murongxiaopifu/p/5582408.html#_labelTop">回到目录</a><a style="margin: 0px; padding: 0px; outline: none; color: #21759b" name="_label0"></a></div><h2 style="padding: 5px 0px 5px 10px; font-size: 21px; border-radius: 6px; box-shadow: rgb(95, 90, 75) 0px 0px 0px 1px, rgba(10, 10, 0, 0.498039) 1px 1px 6px 1px; color: #ffffff; height: 24px; line-height: 23px; text-shadow: #222222 2px 2px 3px; margin: 12px 0px !important; background: #2b6600">1.概览</h2><p style="margin: 10px auto; padding: 0px; font-size: 15px"><a style="margin: 0px; padding: 0px; outline: none; color: black" href="https://github.com/InvertGames/uFrame-MVVM">uFrame</a>是提供给Unity3D开发者使用的一个框架插件，它本身模仿了MVVM这种架构模式（事实上并不包含Model部分，且多出了Controller部分）。因为用于Unity3D，所以它向开发者提供了一套基于Editor的可视化编辑工具，可以用来管理代码结构等。<br />需要指出的是它的一个重要的理念，同时也是软件工程中的一个重要理念就是关注分离（Separation of concern，SoC）。uFrame借助控制反转（IoC）/依赖注入（DI）实现了这种分离，从而进一步实现了MVVM这种模式。且在1.5版本之后，引入了UniRx库，引进了响应式编程的思想。<br />本文主要描述uFrame的这种设计思路以及uFrame本身的一些重要概念，且文中的uFrame版本为1.6。</p><div style="margin: 0px; padding: 0px; text-align: right"><a style="margin: 0px; padding: 0px; outline: none; color: black" href="http://www.cnblogs.com/murongxiaopifu/p/5582408.html#_labelTop">回到目录</a><a style="margin: 0px; padding: 0px; outline: none; color: #21759b" name="_label1"></a></div><h2 style="padding: 5px 0px 5px 10px; font-size: 21px; border-radius: 6px; box-shadow: rgb(95, 90, 75) 0px 0px 0px 1px, rgba(10, 10, 0, 0.498039) 1px 1px 6px 1px; color: #ffffff; height: 24px; line-height: 23px; text-shadow: #222222 2px 2px 3px; margin: 12px 0px !important; background: #2b6600">2.基本概念</h2><h4 style="padding: 0px; border-radius: 6px; box-shadow: rgb(95, 90, 75) 0px 0px 0px 1px, rgba(10, 10, 0, 0.498039) 1px 1px 6px 1px; color: #ffffff; height: 25px; line-height: 25px; margin: 18px 0px !important; background: #2b6695">2.1.清晰且简单</h4><p style="margin: 10px auto; padding: 0px; font-size: 15px">uFrame本身实现了一套MVVM的架构模式。我们之前更熟悉MVC架构模式，虽然MVC分层方式清楚，但是如果使用不当很可能让大量代码都集中在Controller之中，从而造成Controller的臃肿，甚至很多时候Controller和View会产生很多耦合。</p><p style="margin: 10px auto; padding: 0px; font-size: 15px">而MVVM和MVC最大的一个区别是引入了ViewModel的概念。从名字上看，ViewModel是一种针对视图的模型。由于引入了ViewModel，从而解放了Controller。具体到Unity3D项目，使用uFrame我们可以将U3D中和视觉相关的内容和真正的核心逻辑剥离。</p><p style="margin: 10px auto; padding: 0px; font-size: 15px">在uFrame中，使用<strong style="margin: 0px; padding: 0px">Element</strong>这个概念将业务分拆成三部分：</p><ul style="margin: 0px 0px 0px 30px; padding: 0px; word-break: break-all"><li style="margin: 0px 0px 1em; padding: 0px; list-style: disc; font-size: 15px"><strong style="margin: 0px; padding: 0px">ViewModel</strong>：保存游戏中对象的<strong style="margin: 0px; padding: 0px">数据结构</strong>，例如血量、经验、金钱等等。</li><li style="margin: 0px 0px 1em; padding: 0px; list-style: disc; font-size: 15px"><strong style="margin: 0px; padding: 0px">Controller</strong>：处理游戏业务逻辑。例如加血、减血之类的。</li><li style="margin: 0px 0px 1em; padding: 0px; list-style: disc; font-size: 15px"><strong style="margin: 0px; padding: 0px">View</strong>：游戏世界中可以见的对象，和ViewModel绑定，以在游戏中进行展现。</li></ul><p style="margin: 10px auto; padding: 0px; font-size: 15px">其中ViewModel和Controller是属于Element的，View是配合Element而产生的游戏世界中的可见对象。<br />下面是一个的名为&ldquo;Player&rdquo;的Element在uFrame中的样子：<br /><img style="margin: 0px; padding: 0px; border: 0px; max-width: 900px" src="http://images2015.cnblogs.com/blog/686199/201606/686199-20160617095504917-1812275961.png" border="0" /></p><h4 style="padding: 0px; border-radius: 6px; box-shadow: rgb(95, 90, 75) 0px 0px 0px 1px, rgba(10, 10, 0, 0.498039) 1px 1px 6px 1px; color: #ffffff; height: 25px; line-height: 25px; margin: 18px 0px !important; background: #2b6695">2.2.可移植性</h4><p style="margin: 10px auto; padding: 0px; font-size: 15px">通过刚刚的例子，我们可以看到<strong style="margin: 0px; padding: 0px">ViewModel</strong>和<strong style="margin: 0px; padding: 0px">Controller</strong>事实上是处在幕后的，它们只需要实现纯逻辑代码即可，完全不需要关心在游戏中视觉上如何展示。正是因为不必关心具体的表现如何，所以ViewModel和Controller是具备移植性的。而在U3D项目中，<strong style="margin: 0px; padding: 0px">View</strong>需要挂载在游戏对象上，同时它也是连接具体的游戏世界和抽象的逻辑代码之间的桥梁，通过<strong style="margin: 0px; padding: 0px">View</strong>，uFrame将<strong style="margin: 0px; padding: 0px">ViewModel</strong>和<strong style="margin: 0px; padding: 0px">Controller</strong>与U3D连接。<br />因此，我们不能通过<strong style="margin: 0px; padding: 0px">Controller</strong>来访问<strong style="margin: 0px; padding: 0px">View</strong>，因为正常情况下它们是不知道彼此的存在的，Controller将只和<strong style="margin: 0px; padding: 0px">ViewModel</strong>进行交互，这样才能保持整体结构的清晰。<br />同时，我们也不应该通过<strong style="margin: 0px; padding: 0px">ViewModel</strong>直接获取<strong style="margin: 0px; padding: 0px">View</strong>，这是因为<strong style="margin: 0px; padding: 0px">ViewModel</strong>应该只关心它自己的数据，而不关心到底是哪个<strong style="margin: 0px; padding: 0px">View</strong>绑定了自己。</p><h4 style="padding: 0px; border-radius: 6px; box-shadow: rgb(95, 90, 75) 0px 0px 0px 1px, rgba(10, 10, 0, 0.498039) 1px 1px 6px 1px; color: #ffffff; height: 25px; line-height: 25px; margin: 18px 0px !important; background: #2b6695">2.3.MVVM和Controller</h4><p style="margin: 10px auto; padding: 0px; font-size: 15px">既然说uFrame模仿了MVVM的架构，但是和传统的MVVM相比，uFrame却多出了一个Controller。<br /><img style="margin: 0px; padding: 0px; border: 0px; max-width: 900px" src="http://images2015.cnblogs.com/blog/686199/201606/686199-20160613232802245-739389242.jpg" border="0" /><br />因此需要在这里指出，uFrame中的Controller用来配合ViewModel封装逻辑。 这是因为在uFrame中逻辑并不在ViewModel中，相反，当我们执行一条命令时，是对应的Controller来执行相应的逻辑。游戏逻辑有时有可能会十分复杂，但是由于将游戏逻辑移到了Controller中，因此ViewModel是十分轻量级的。</p><div style="margin: 0px; padding: 0px; text-align: right"><a style="margin: 0px; padding: 0px; outline: none; color: black" href="http://www.cnblogs.com/murongxiaopifu/p/5582408.html#_labelTop">回到目录</a><a style="margin: 0px; padding: 0px; outline: none; color: #21759b" name="_label2"></a></div><h2 style="padding: 5px 0px 5px 10px; font-size: 21px; border-radius: 6px; box-shadow: rgb(95, 90, 75) 0px 0px 0px 1px, rgba(10, 10, 0, 0.498039) 1px 1px 6px 1px; color: #ffffff; height: 24px; line-height: 23px; text-shadow: #222222 2px 2px 3px; margin: 12px 0px !important; background: #2b6600">3.依赖注入</h2><h4 style="padding: 0px; border-radius: 6px; box-shadow: rgb(95, 90, 75) 0px 0px 0px 1px, rgba(10, 10, 0, 0.498039) 1px 1px 6px 1px; color: #ffffff; height: 25px; line-height: 25px; margin: 18px 0px !important; background: #2b6695">3.1.面向接口编程</h4><p style="margin: 10px auto; padding: 0px; font-size: 15px">在介绍依赖注入之前，我们先来看一段项目中的代码。</p><pre style="margin-top: 10px; margin-bottom: 10px; padding: 0px; white-space: pre-wrap; word-wrap: break-word"><span style="margin: 0px; padding: 0px" class="hljs-class"><span style="margin: 0px; padding: 0px; color: #0000ff" class="hljs-keyword">class</span> <span style="margin: 0px; padding: 0px; color: #a31515" class="hljs-type">EquipDevelopPanelScript</span> : <span style="margin: 0px; padding: 0px; color: #a31515" class="hljs-type">IPanelScript</span> &#123;&nbsp;&nbsp;&nbsp;&nbsp; ...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public void <span style="margin: 0px; padding: 0px; color: #a31515" class="hljs-type">SetType</span>(<span style="margin: 0px; padding: 0px; color: #a31515" class="hljs-type">DevelopType</span> <span style="margin: 0px; padding: 0px; color: #a31515" class="hljs-type">Type</span>)&nbsp;&nbsp;&nbsp;&nbsp; &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if(<span style="margin: 0px; padding: 0px; color: #a31515" class="hljs-type">Type</span> == <span style="margin: 0px; padding: 0px; color: #a31515" class="hljs-type">DevelopType</span>.<span style="margin: 0px; padding: 0px; color: #a31515" class="hljs-type">Split</span>)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; color: #a31515" class="hljs-type">TODO</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else if(<span style="margin: 0px; padding: 0px; color: #a31515" class="hljs-type">Type</span> == <span style="margin: 0px; padding: 0px; color: #a31515" class="hljs-title">xxx</span>)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; color: #a31515" class="hljs-type">TODO</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else if(<span style="margin: 0px; padding: 0px; color: #a31515" class="hljs-type">Type</span> == <span style="margin: 0px; padding: 0px; color: #a31515" class="hljs-title">xxxx</span>)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; color: #a31515" class="hljs-type">TODO</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ...&nbsp;&nbsp;&nbsp;&nbsp; &#125;&nbsp;&nbsp;&nbsp;&nbsp; ... &#125;</span></pre><p style="margin: 10px auto; padding: 0px; font-size: 15px">可以看到：</p><p style="margin: 10px auto; padding: 0px; font-size: 15px">首先，在这段代码中我们设计的EquipDevelopPanelScript类（处在UI层的类！）的SetType方法很长（170+行），并且方法中有一个冗长的if&hellip;else结构，且每个分支的代码的业务逻辑很相似，只是很少的地方不同，无非是根据不同的类型来设置显示内容。</p><p style="margin: 10px auto; padding: 0px; font-size: 15px">再者，我认为这个设计比较大的一个问题是违反了OCP原则（开放关闭原则，指设计应该对扩展开放，对修改关闭。）。在这个设计中，如果以后我们增加一个新的UI类型，我们就要打开EquipDevelopPanelScript，修改SetType方法。而我们的代码应该是对修改关闭的，当有新UI加入的时候，应该使用扩展完成，避免修改已有代码。</p><p style="margin: 10px auto; padding: 0px; font-size: 15px">一般来说，当一个方法里面出现冗长的if&hellip;else或switch&hellip;case结构，且每个分支代码业务相似时，往往预示这里应该引入多态性来解决问题。而这里，如果把不同的UI类型看成一个策略，那么引入策略模式（Strategy Pattern，即将逻辑分别封装起来，让他们之间可以相互替换，此模式使得逻辑的变化独立于使用者。）是明智的选择。</p><p style="margin: 10px auto; padding: 0px; font-size: 15px">最后，说一个小的问题，UI层主要是用来对数据进行展现，不应该包含过多的逻辑。</p><p style="margin: 10px auto; padding: 0px; font-size: 15px">因此我们采用这样的思路：<strong style="margin: 0px; padding: 0px">面向接口而不是具体的类（或逻辑）编程，使得我们可以轻松的替换具体的实现。</strong>所以，我们可以定义一个接口Interface：</p><pre style="margin-top: 10px; margin-bottom: 10px; padding: 0px; white-space: pre-wrap; word-wrap: break-word"><span style="margin: 0px; padding: 0px; color: #0000ff" class="hljs-keyword">public</span> <span style="margin: 0px; padding: 0px; color: #0000ff" class="hljs-keyword">interface</span> <span style="margin: 0px; padding: 0px; color: #a31515" class="hljs-title">IDevelopType</span> &#123;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px" class="hljs-function"><span style="margin: 0px; padding: 0px; color: #0000ff" class="hljs-keyword">void</span> <span style="margin: 0px; padding: 0px; color: #a31515" class="hljs-title">SetInfoByType</span>()</span>; &#125;</pre><p style="margin: 10px auto; padding: 0px; font-size: 15px">该接口将之前代码中TODO的部分归纳为了一个方法SetInfoByType，而只需要实现该接口的不同类（例如SplitTypeClass）重写SetInfoByType方法，便实现了在UI层中去除具体逻辑的功能。之后，我们只需要根据不同的要求，提供实现了IDevelopType接口的不同的类即可。<br />所以之前的100多行代码可以变成了这样的2行代码：</p><pre style="margin-top: 10px; margin-bottom: 10px; padding: 0px; white-space: pre-wrap; word-wrap: break-word">IDevelopType typeInfo = XXXX.GetInfoByType(<span style="margin: 0px; padding: 0px; color: #0000ff" class="hljs-keyword">Type</span>); teypInfo.SetInfoByType();</pre><p style="margin: 10px auto; padding: 0px; font-size: 15px">使用这种思路将之前的代码重构之后，我们能获得什么好处呢？</p><p style="margin: 10px auto; padding: 0px; font-size: 15px">1.代码结构变得很清晰了，虽然类的数量增加了(因为if...else块中的逻辑被封装成了类），但是每个类中方法的代码都非常短，没有了以前SetType方法那种很长的方法，也没有了冗长的if&hellip;else。</p><p style="margin: 10px auto; padding: 0px; font-size: 15px">2.类的职责更明确了，UI层的类的主要作用是来将数据展示出来，具体的逻辑交给别的类来处理。</p><p style="margin: 10px auto; padding: 0px; font-size: 15px">3.引入Strategy策略模式后，不但消除了重复性代码，更重要的是使得设计符合了开闭原则。如果以后要加一个新UI类型，只要新建一个类，实现IDevelopType接口，当需要使用这个UI类型时，我们只要实例化一个新UI类型类，并赋给局部变量typeInfo即可，已有的EquipDevelopPanelScript代码不用改动。这样就实现了对扩展开放，对修改关闭。</p><h4 style="padding: 0px; border-radius: 6px; box-shadow: rgb(95, 90, 75) 0px 0px 0px 1px, rgba(10, 10, 0, 0.498039) 1px 1px 6px 1px; color: #ffffff; height: 25px; line-height: 25px; margin: 18px 0px !important; background: #2b6695">3.2.依赖注入的本质</h4><p style="margin: 10px auto; padding: 0px; font-size: 15px">好了，说了这么多依赖注入在哪里呢？其实它早就存在了。</p><p style="margin: 10px auto; padding: 0px; font-size: 15px">我们再仔细看看刚刚的设计，经过这样设计之后，有个基本的问题被解决了：<strong style="margin: 0px; padding: 0px">现在EquipDevelopPanelScript类的SetType方法不再依赖具体的UI类型，而仅仅依赖一个IDevelopType接口，接口是不能实例化的，但最终还是会被赋予一个实现了IDevelopType接口的具体UI类型类。</strong></p><p style="margin: 10px auto; padding: 0px; font-size: 15px">这里，实例化一个具体的UI类型类，并赋给变量typeInfo的过程，就是依赖注入，这里要清楚，依赖注入其实只是一个过程的称谓。</p><p style="margin: 10px auto; padding: 0px; font-size: 15px">通过阅读uFrame的源代码，最直观的印象是：一个良好的设计必须做到将变化隔离，使得变化部分发生变化时，不变部分不受影响。只有这样才有可能适用于各种情况。为了做到这一点，就要利用面向对象中的多态性，使用多态性后，类和类之间便不再直接存在依赖，取而代之的是依赖于一个抽象的接口，这样，客户类就不能在内部直接实例化具体的服务类。</p><p style="margin: 10px auto; padding: 0px; font-size: 15px">但是这样做的结果是客户类在运作中又客观需要具体的服务类提供服务，因为接口是不能实例化去提供服务的，于是就产生了&ldquo;客户类不能依赖具体服务类&rdquo;和&ldquo;客户类需要具体服务类&rdquo;这样一对矛盾。为了解决这个矛盾，开发人员提出了一种模式：客户类（如上例中的EquipDevelopPanelScript）定义一个注入点（临时变量typeInfo），用于服务类（实现IDevelopType接口的具体类，如SplitTypeClass等等）的注入，之后根据具体情况，实例化服务类，注入到客户类中，从而解决了这个矛盾。</p><p style="margin: 10px auto; padding: 0px; font-size: 15px">uFrame的基本思想便是使用依赖注入、面向接口编程使代码解耦，这些也是值得我们学习的地方。<br />例如下面这段uFrame的核心代码，大量的使用面向接口的思路，解除耦合：</p><pre style="margin-top: 10px; margin-bottom: 10px; padding: 0px; white-space: pre-wrap; word-wrap: break-word"> <span style="margin: 0px; padding: 0px; color: green" class="hljs-comment">//参数只要实现IDisposable接口即可，不是具体的类型</span> <span style="margin: 0px; padding: 0px" class="hljs-function"><span style="margin: 0px; padding: 0px; color: #0000ff" class="hljs-keyword">public</span> IDisposable <span style="margin: 0px; padding: 0px; color: #a31515" class="hljs-title">AddBinding</span><span style="margin: 0px; padding: 0px" class="hljs-params">(IDisposable binding)</span> </span>&#123;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; color: #0000ff" class="hljs-keyword">if</span> (!Bindings.ContainsKey(<span style="margin: 0px; padding: 0px" class="hljs-number">-1</span>))&nbsp;&nbsp;&nbsp;&nbsp; &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Bindings[<span style="margin: 0px; padding: 0px" class="hljs-number">-1</span>] = <span style="margin: 0px; padding: 0px; color: #0000ff" class="hljs-keyword">new</span> List&lt;IDisposable&gt;();&nbsp;&nbsp;&nbsp;&nbsp; &#125;&nbsp;&nbsp;&nbsp;&nbsp; Bindings[<span style="margin: 0px; padding: 0px" class="hljs-number">-1</span>].Add(binding);&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; color: #0000ff" class="hljs-keyword">return</span> binding; &#125;</pre><div style="margin: 0px; padding: 0px; text-align: right"><a style="margin: 0px; padding: 0px; outline: none; color: black" href="http://www.cnblogs.com/murongxiaopifu/p/5582408.html#_labelTop">回到目录</a><a style="margin: 0px; padding: 0px; outline: none; color: #21759b" name="_label3"></a></div><h2 style="padding: 5px 0px 5px 10px; font-size: 21px; border-radius: 6px; box-shadow: rgb(95, 90, 75) 0px 0px 0px 1px, rgba(10, 10, 0, 0.498039) 1px 1px 6px 1px; color: #ffffff; height: 24px; line-height: 23px; text-shadow: #222222 2px 2px 3px; margin: 12px 0px !important; background: #2b6600">4.Manager of Managers</h2><p style="margin: 10px auto; padding: 0px; font-size: 15px">如果在Unity3D项目开发中没有考虑过架构的问题，那么最常见也最直接的一种做法就是在游戏场景中创建一个空的GameObject，然后挂上所有与GameObject无关的逻辑控制的脚本，并且使用GameObject.Find()访问对象数据。这样做最直接，但这个选择却十分糟糕，因为逻辑代码散落在各处，基本没有可维护性。</p><p style="margin: 10px auto; padding: 0px; font-size: 15px">之后，我们可能会考虑将代码放在不同的单例中，但是有可能会导致一个单例的代码过多的问题，且和刚刚那个最直接的做法没有本质的区别，虽然存在很多单例，但是由于缺少组织，代码还是散落在各处，不适宜维护拓展。因此，我们需要一种可以组织代码的方式来架构我们的项目。</p><p style="margin: 10px auto; padding: 0px; font-size: 15px">一个更好的思路是将代码按照业务划分成一些子系统，并通过相应的管理器来管理，例如UISysManager、GameStateSysManager等等。一个子系统内可以封装很多内容，但是只通过管理器对外暴露一些接口，使得整个子系统成为一个黑箱，外部调用者通过子系统暴露在外的接口进行操作。而这些Manager又需要被更高层级的Manager进行管理，使得整个游戏架构按照逻辑构造成了树状的结构，如下图：</p><pre style="margin-top: 10px; margin-bottom: 10px; padding: 0px; white-space: pre-wrap; word-wrap: break-word">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Fox(游戏最高层管理器或者称为总入口)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#92;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#92;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#92;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LogicMgr(逻辑管理）&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpMgr（网络管理）&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px" class="hljs-regexp">/&nbsp;&nbsp;&nbsp;&nbsp;&#124;&nbsp;&nbsp; &#92;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/</span>&nbsp;&nbsp;&nbsp;&nbsp; &#92;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px" class="hljs-regexp">/&nbsp;&nbsp;&nbsp;&nbsp; &#124;&nbsp;&nbsp;&nbsp;&nbsp;&#92;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#92;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px" class="hljs-regexp">/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#124;&nbsp;&nbsp;&nbsp;&nbsp; &#92;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#92;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UISysManager XXXXMgr XXXXMgr YYYMgr&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;YYYYMgr</pre><p style="margin: 10px auto; padding: 0px; font-size: 15px">这样做的优点便是代码的逻辑层次清晰，将逻辑模块化易于管理，且将对逻辑对象的访问都通过管理器的接口实现，从而规范了对游戏内对象的操作方式。例如我想要获取一个UI，只需要这样调用：</p><pre style="margin-top: 10px; margin-bottom: 10px; padding: 0px; white-space: pre-wrap; word-wrap: break-word"><span style="margin: 0px; padding: 0px; color: #0000ff" class="hljs-built_in">UIClass</span> ui = Fox.LogicMgr.UISysManager.GetUI(<span style="margin: 0px; padding: 0px; color: #0000ff" class="hljs-keyword">id</span>);</pre><p style="margin: 10px auto; padding: 0px; font-size: 15px">作为UI子系统外的调用者无需关心GetUI内部发生了什么，他需要做的仅仅是使用UI系统管理器提供的接口来获取目标UI。</p><p style="margin: 10px auto; padding: 0px; font-size: 15px">uFrame中也包含类似的思想，它为我们提供了一个称为SubSystem的控件，在uFrane的Editor设计器中SubSystem是这样子的：<br /><img style="margin: 0px; padding: 0px; border: 0px; max-width: 900px" src="https://camo.githubusercontent.com/bd349155fdb241b92f519b9125cbb0bf50167715/687474703a2f2f692e696d6775722e636f6d2f65657536587a6c2e6a7067" border="0" /><br />且每个SubSystem在设计器中都会对应一个System Loader类的实例，用来在运行时对子系统进行初始化等工作。</p><div style="margin: 0px; padding: 0px; text-align: right"><a style="margin: 0px; padding: 0px; outline: none; color: black" href="http://www.cnblogs.com/murongxiaopifu/p/5582408.html#_labelTop">回到目录</a><a style="margin: 0px; padding: 0px; outline: none; color: #21759b" name="_label4"></a></div><h2 style="padding: 5px 0px 5px 10px; font-size: 21px; border-radius: 6px; box-shadow: rgb(95, 90, 75) 0px 0px 0px 1px, rgba(10, 10, 0, 0.498039) 1px 1px 6px 1px; color: #ffffff; height: 24px; line-height: 23px; text-shadow: #222222 2px 2px 3px; margin: 12px 0px !important; background: #2b6600">5.利用UniRX实现响应式编程</h2><p style="margin: 10px auto; padding: 0px; font-size: 15px"><strong style="margin: 0px; padding: 0px">uFrame框架1.6版本中处理View的绑定时大量的使用了响应式编程的思想。</strong></p><p style="margin: 10px auto; padding: 0px; font-size: 15px">所谓的响应式编程指的是：使用异步数据流进行编程，而所谓的异步数据流简单的说就是按时间排序的事件序列。而我们需要做的就是监听或者订阅（Subscribe）事件流，当事件触发（Publish）时响应即可。换句话说，这是一种观察者模式或者说订阅发布模式的实现。</p><p style="margin: 10px auto; padding: 0px; font-size: 15px">uFrame实现响应式编程的方式是引入了UniRx库。需要说明的是Rx库是微软推出的一个响应式拓展的框架，但是由于Rx库无法在Unity3D中运行且存在iOS中IL2CPP兼容性的问题，因此后来有人为Unity3D重写了Rx库，也就是UniRx库。</p><p style="margin: 10px auto; padding: 0px; font-size: 15px">为了实现观察者模式，UniRx提供了两个关键接口：IObservable和IObserver。</p><p style="margin: 10px auto; padding: 0px; font-size: 15px">IObservable接口定义如下：</p><pre style="margin-top: 10px; margin-bottom: 10px; padding: 0px; white-space: pre-wrap; word-wrap: break-word"><span style="margin: 0px; padding: 0px; color: #0000ff" class="hljs-keyword">public</span> <span style="margin: 0px; padding: 0px" class="hljs-class"><span style="margin: 0px; padding: 0px; color: #0000ff" class="hljs-keyword">interface</span> <span style="margin: 0px; padding: 0px; color: #a31515" class="hljs-title">IObservable</span>&lt;<span style="margin: 0px; padding: 0px; color: #a31515" class="hljs-title">out</span> <span style="margin: 0px; padding: 0px; color: #a31515" class="hljs-title">T</span>&gt; </span>&#123;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px" class="hljs-function">IDisposable <span style="margin: 0px; padding: 0px; color: #a31515" class="hljs-title">Subscribe</span><span style="margin: 0px; padding: 0px" class="hljs-params">(IObserver&lt;T&gt; observer)</span></span>; &#125;</pre><p style="margin: 10px auto; padding: 0px; font-size: 15px">IObserver接口定义如下：</p><pre style="margin-top: 10px; margin-bottom: 10px; padding: 0px; white-space: pre-wrap; word-wrap: break-word"><span style="margin: 0px; padding: 0px; color: #0000ff" class="hljs-keyword">public</span> <span style="margin: 0px; padding: 0px" class="hljs-class"><span style="margin: 0px; padding: 0px; color: #0000ff" class="hljs-keyword">interface</span> <span style="margin: 0px; padding: 0px; color: #a31515" class="hljs-title">IObserver</span>&lt;<span style="margin: 0px; padding: 0px; color: #a31515" class="hljs-title">in</span> <span style="margin: 0px; padding: 0px; color: #a31515" class="hljs-title">T</span>&gt; </span>&#123;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px" class="hljs-function"><span style="margin: 0px; padding: 0px; color: #0000ff" class="hljs-keyword">void</span> <span style="margin: 0px; padding: 0px; color: #a31515" class="hljs-title">OnCompleted</span><span style="margin: 0px; padding: 0px" class="hljs-params">()</span></span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px" class="hljs-function"><span style="margin: 0px; padding: 0px; color: #0000ff" class="hljs-keyword">void</span> <span style="margin: 0px; padding: 0px; color: #a31515" class="hljs-title">OnError</span><span style="margin: 0px; padding: 0px" class="hljs-params">(Exception error)</span></span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px" class="hljs-function"><span style="margin: 0px; padding: 0px; color: #0000ff" class="hljs-keyword">void</span> <span style="margin: 0px; padding: 0px; color: #a31515" class="hljs-title">OnNext</span><span style="margin: 0px; padding: 0px" class="hljs-params">(T value)</span></span>; &#125;</pre><p style="margin: 10px auto; padding: 0px; font-size: 15px">在uFrame中，很多地方会使用这两个接口以实现观察者模式，例如在ViewModel中的订阅方法Subscribe的参数就是一个IObserver的集合：</p><pre style="margin-top: 10px; margin-bottom: 10px; padding: 0px; white-space: pre-wrap; word-wrap: break-word">public IDisposable Subscribe(IObserver&lt;IObservableProperty&gt; observer) &#123;&nbsp;&nbsp;&nbsp;&nbsp; PropertyChangedEventHandler propertyChanged = <span style="margin: 0px; padding: 0px" class="hljs-function"><span style="margin: 0px; padding: 0px" class="hljs-params">(sender, args)</span> =&gt;</span>&nbsp;&nbsp;&nbsp;&nbsp; &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var property = sender as IObservableProperty;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px" class="hljs-regexp">//i</span>f (property != <span style="margin: 0px; padding: 0px; color: #a31515" class="hljs-literal">null</span>)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; observer.OnNext(property);&nbsp;&nbsp;&nbsp;&nbsp; &#125;;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PropertyChanged += propertyChanged;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; color: #0000ff" class="hljs-keyword">return</span> Disposable.Create(<span style="margin: 0px; padding: 0px" class="hljs-function"><span style="margin: 0px; padding: 0px" class="hljs-params">()</span> =&gt;</span> PropertyChanged -= propertyChanged); &#125;</pre><p style="margin: 10px auto; padding: 0px; font-size: 15px">自然IObserver集合是基于观察者模式设计的。观察者模式的关键在于被观察的对象有一些行为或者属性，观察者可以注册某些感兴趣的属性或者行为。当被观察者发生状态改变时，会通知观察者（通常是发起一个事件），之后会有相应该事件的���法被调用，uFrame借助UniRx实现了这种模式。</p><p style="margin: 10px auto; padding: 0px; font-size: 15px">下面我们就通过一个小例子来看看这种观察者模式在uFrame中的实现：</p><p style="margin: 10px auto; padding: 0px; font-size: 15px">View中将指定的LevelSelectButton和RequestMainMenuScreenCommand进行绑定：</p><pre style="margin-top: 10px; margin-bottom: 10px; padding: 0px; white-space: pre-wrap; word-wrap: break-word">&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; color: #0000ff" class="hljs-keyword">this</span>.BindButtonToHandler(LevelSelectButton, <span style="margin: 0px; padding: 0px" class="hljs-function"><span style="margin: 0px; padding: 0px" class="hljs-params">()</span> =&gt;</span>&nbsp;&nbsp; &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Publish(<span style="margin: 0px; padding: 0px; color: #0000ff" class="hljs-keyword">new</span> RequestMainMenuScreenCommand()&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ScreenType = <span style="margin: 0px; padding: 0px; color: #0000ff" class="hljs-keyword">typeof</span> (LevelSelectScreenViewModel)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125;);&nbsp;&nbsp; &#125;);</pre><p style="margin: 10px auto; padding: 0px; font-size: 15px">绑定的代码可以重写成以下形式可能更容易理解，即Publish发布一个事件：</p><pre style="margin-top: 10px; margin-bottom: 10px; padding: 0px; white-space: pre-wrap; word-wrap: break-word"><span style="margin: 0px; padding: 0px; color: #0000ff" class="hljs-keyword">var</span> evt= <span style="margin: 0px; padding: 0px; color: #0000ff" class="hljs-keyword">new</span> RequestMainMenuScreenCommand(); evt.ScreenType = <span style="margin: 0px; padding: 0px; color: #0000ff" class="hljs-keyword">typeof</span>(LevelSelectScreenViewModel); Publish(evt);</pre><p style="margin: 10px auto; padding: 0px; font-size: 15px">Controller中订阅/监听RequestMainMenuScreenCommand，并注册回调函数：</p><pre style="margin-top: 10px; margin-bottom: 10px; padding: 0px; white-space: pre-wrap; word-wrap: break-word"><span style="margin: 0px; padding: 0px; color: #0000ff" class="hljs-selector-tag">this</span><span style="margin: 0px; padding: 0px" class="hljs-selector-class">.OnEvent</span>&lt;<span style="margin: 0px; padding: 0px; color: #0000ff" class="hljs-selector-tag">RequestMainMenuScreenCommand</span>&gt;()<span style="margin: 0px; padding: 0px" class="hljs-selector-class">.Subscribe</span>(<span style="margin: 0px; padding: 0px; color: #0000ff" class="hljs-selector-tag">this</span><span style="margin: 0px; padding: 0px" class="hljs-selector-class">.RequestMainMenuScreenCommandHandler</span>);</pre><p style="margin: 10px auto; padding: 0px; font-size: 15px">其中this.OnEvent方法会返回一个IObservable的对象，所以我们可以接着调用Subscribe(handler)来订阅事件T，每当T事件被发布（Publish），对应的handler就会被调用。</p><div style="margin: 0px; padding: 0px; text-align: right"><a style="margin: 0px; padding: 0px; outline: none; color: black" href="http://www.cnblogs.com/murongxiaopifu/p/5582408.html#_labelTop">回到目录</a><a style="margin: 0px; padding: 0px; outline: none; color: #21759b" name="_label5"></a></div><h2 style="padding: 5px 0px 5px 10px; font-size: 21px; border-radius: 6px; box-shadow: rgb(95, 90, 75) 0px 0px 0px 1px, rgba(10, 10, 0, 0.498039) 1px 1px 6px 1px; color: #ffffff; height: 24px; line-height: 23px; text-shadow: #222222 2px 2px 3px; margin: 12px 0px !important; background: #2b6600">6.研究总结</h2><p style="margin: 10px auto; padding: 0px; font-size: 15px">uFrameMVVM架构无疑是十分简洁和易拓展的。它所使用的一些架构设计的思想十分值得我们学习和借鉴。例如利用依赖注入，使整个架构面向接口编程，因而具备了很强的拓展性。引入响应式编程的思想，实现了各个部分之间基于发布订阅模式的通信方式，更加消除了各个模块之间的耦合，使得代码易于维护和测试。最后，其整体逻辑架构也有一些Manager of Managers的思想，各个模块之间能够有效的管理和组织，使得基于该架构的游戏逻辑层次清晰。</p><p style="margin: 10px auto; padding: 0px; font-size: 15px">但是，由于该插件提供的设计器要依赖Unity3D的Editor进行可视化操作，因此有可能会导致Editor方面的一些潜在风险，例如游戏内部系统过多会导致Editor的可视化区域难以管理，或者是我们在开发中对Editor的不当操作导致一些未知的问题。甚至由于是第三方提供的代码，因此uFrame的版本更迭可能会带来很多问题（1.5到1.6发生了很大的变化）等等。</p><p style="margin: 10px auto; padding: 0px; font-size: 15px">因此，建议重点学习和掌握工具所提供的思想和设计思路。</p></div><div id="MySignature" style="margin: 0px; padding: 0px; font-family: 微软雅黑, 宋体, 黑体, Arial; font-size: 14px; line-height: 25.2px"><a style="margin: 0px; padding: 0px; outline: none; color: black" rel="license" href="http://creativecommons.org/licenses/by-nc-sa/2.5/cn/"><img style="margin: 0px; padding: 0px; border: 0px" src="https://i.creativecommons.org/l/by-nc-sa/2.5/cn/88x31.png" border="0" alt="知识共享许可协议" /></a><br />本作品采用<a style="margin: 0px; padding: 0px; outline: none; color: black" rel="license" href="http://creativecommons.org/licenses/by-nc-sa/2.5/cn/">知识共享署名-非商业性使用-相同方式共享 2.5 中国大陆许可协议</a>进行许可，我的博客欢迎复制共享，但在同时，希望保留我的署名权<a style="margin: 0px; padding: 0px; outline: none; color: black" href="https://mvp.microsoft.com/zh-cn/PublicProfile/5001664?fullName=Jiadong%20%20Chen">陈嘉栋</a>（慕容小匹夫），并且，不得用于商业用途。如您有任何疑问或者授权方面的协商，请<a style="margin: 0px; padding: 0px; outline: none; color: black" href="http://msg.cnblogs.com/msg/send/%E6%85%95%E5%AE%B9%E5%B0%8F%E5%8C%B9%E5%A4%AB">给我留言</a>。&nbsp;<br />知乎专栏：<br /><a style="margin: 0px; padding: 0px; outline: none; color: black" href="http://zhuanlan.zhihu.com/chenjiadong">Runtime</a><br />联系方式：<br />Email：shaun.chan@hotmail.com</div>
]]>
</description>
</item><item>
<link>http://i.renjihe.com/blog/read.php?7396</link>
<title><![CDATA[“手游审核前置”新规正式实施：情况真有那么糟？]]></title> 
<author>renjihe1988 &lt;admin@yourname.com&gt;</author>
<category><![CDATA[游戏]]></category>
<pubDate>Fri, 22 Jul 2016 06:35:58 +0000</pubDate> 
<guid>http://i.renjihe.com/blog/read.php?7396</guid> 
<description>
<![CDATA[ 
	<p style="margin: 0px 0px 29px; padding: 0px; line-height: 28px; font-family: 宋体, Arial, sans-serif; font-size: 15.9996px; text-indent: 2em">7月1日，中国的<a style="outline: none; color: #000000; text-decoration: none; border-bottom-width: 1px; border-bottom-style: dotted; border-bottom-color: #536da6" href="http://games.qq.com/mobile/" target="_blank" class="a-tips-Article-QQ">手游</a>行业迎来一个拐点&mdash;&mdash;国家新闻出版广电总局发布的《关于移动游戏出版服务管理的通知》正式实施。也就是说，从今天开始，手游的出版需国家新闻出版广电总局前置审批，才能上线运营。</p><p style="margin: 0px 0px 29px; padding: 0px; line-height: 28px; font-family: 宋体, Arial, sans-serif; font-size: 15.9996px; text-indent: 2em">新《通知》的消息在6月初就已经公布，一个月以来，业内对此事议论纷纷，其中&ldquo;苹果App Store是否会受到新规影响&rdquo;是大家关注的焦点之一。而就在昨天，苹果官方发的一则公开信，给予不少中国开发者以沉重一击：致中国地区开发人员的一封信，遵照&ldquo;通知&rdquo;，上架App Store的游戏必须办理版号。</p><p style="margin: 0px 0px 29px; padding: 0px; line-height: 28px; font-family: 宋体, Arial, sans-serif; font-size: 15.9996px" align="center"><img style="border: none; vertical-align: bottom; max-width: 640px" src="http://img1.gtimg.com/gamezone/pics/hv1/77/166/2092/136074707.png" border="0" alt="苹果致中国地区开发人员的一封信截图" /></p><p style="margin: 0px 0px 29px; padding: 0px; line-height: 28px; font-family: 宋体, Arial, sans-serif; font-size: 10pt" align="center">苹果致中国地区开发人员的一封信截图</p><p style="margin: 0px 0px 29px; padding: 0px; line-height: 28px; font-family: 宋体, Arial, sans-serif; font-size: 15.9996px; text-indent: 2em">这则消息一下就占据了多家游戏媒体订阅号的头条大图，众人纷纷对此事可能产生的影响进行了极端预测，包括以下两种比较悲观的情况：</p><p style="margin: 0px 0px 29px; padding: 0px; line-height: 28px; font-family: 宋体, Arial, sans-serif; font-size: 15.9996px; text-indent: 2em">中国的独立手游将因此灭亡。</p><p style="margin: 0px 0px 29px; padding: 0px; line-height: 28px; font-family: 宋体, Arial, sans-serif; font-size: 15.9996px; text-indent: 2em">国外游戏因为App Store中国区申请版号的繁琐流程，干脆放弃中国市场，不久之后中国区的appstore将只剩下国产手游和被国内公司引进的海外手游。</p><p style="margin: 0px 0px 29px; padding: 0px; line-height: 28px; font-family: 宋体, Arial, sans-serif; font-size: 15.9996px; text-indent: 2em">看到这里，许多原本不太关注新规的玩家或手游开发者，可能会感到很绝望。再翻开知乎、微博等地，讨论手游审核新规的，基本上也都一片哀嚎之声。</p><p style="margin: 0px 0px 29px; padding: 0px; line-height: 28px; font-family: 宋体, Arial, sans-serif; font-size: 15.9996px; text-indent: 2em"><span style="font-size: 16px"><strong>手游出版前置审批的影响真的有这么严重吗？</strong></span></p><p style="margin: 0px 0px 29px; padding: 0px; line-height: 28px; font-family: 宋体, Arial, sans-serif; font-size: 15.9996px; text-indent: 2em">腾讯游戏频道采访了几位资深游戏行业从业者，他们之中有研发、有发行，有大公司的、也有中小CP、独立开发商。我们发现，产业链不同环节的人看待这个问题确实有很大的差别。我们在此列举一部分具有代表性的观点。（由于部分受访者言辞激烈，我们决定全部匿名）</p><p style="margin: 0px 0px 29px; padding: 0px; line-height: 28px; font-family: 宋体, Arial, sans-serif; font-size: 15.9996px" align="center"></p><div class="mbArticleSharePic&nbsp;&nbsp;&nbsp;&nbsp;" style="position: relative; z-index: 1; margin: 0px auto; width: 437px"><img style="border: none; vertical-align: bottom; max-width: 640px" src="http://img1.gtimg.com/gamezone/pics/hv1/78/166/2092/136074708.png" border="0" alt="版号送审流程图（图片来自文公子ASO公众号）" /></div><p>&nbsp;</p><p style="margin: 0px 0px 29px; padding: 0px; line-height: 28px; font-family: 宋体, Arial, sans-serif; font-size: 10pt" align="center">版号送审流程图（图片来自文公子ASO公众号）</p><p style="margin: 0px 0px 29px; padding: 0px; line-height: 28px; font-family: 宋体, Arial, sans-serif; font-size: 15.9996px; text-indent: 2em"><span style="font-size: 18px"><strong>专注研发领域的人这样说：</strong></span></p><p style="margin: 0px 0px 29px; padding: 0px; line-height: 28px; font-family: 宋体, Arial, sans-serif; font-size: 15.9996px; text-indent: 2em"><strong>某独立游戏人：</strong></p><p style="margin: 0px 0px 29px; padding: 0px; line-height: 28px; font-family: 宋体, Arial, sans-serif; font-size: 15.9996px; text-indent: 2em">对于现金流良好的公司来说，就是被恶心一下，花点小钱，找相应的工作人员来搞定就是了，影响不大。但我伤心的是，这会对身边那些有创意、没现金的独立游戏人或爱好者造成很大的困扰，他们的产量和质量可能都会受到影响。想想，本来我可能48小时做个游戏，一高兴了就发App Store上去了；现在一想到要把手机、安装盘啥的快递过去，我就宁可洗洗睡了。所以，我再次决定认真考虑移民！</p><p style="margin: 0px 0px 29px; padding: 0px; line-height: 28px; font-family: 宋体, Arial, sans-serif; font-size: 15.9996px; text-indent: 2em"><strong>某中小CP负责人：</strong></p><p style="margin: 0px 0px 29px; padding: 0px; line-height: 28px; font-family: 宋体, Arial, sans-serif; font-size: 15.9996px; text-indent: 2em">我们不发愁这事，我们产品交给发行商代理，他们会负责办版号，所以现在主要是发行商在发愁这事。这个政策主要影响的就是上线时间，尤其是原本计划7、8、9月期间上线的产品，内容上影响不大，大部分CP做内容也不会过线，有黄暴的改掉就好。我们现在跟发行商的合作还挺好的，不存在因为他们帮我们办了版号，就为难我们的情况。</p><p style="margin: 0px 0px 29px; padding: 0px; line-height: 28px; font-family: 宋体, Arial, sans-serif; font-size: 15.9996px; text-indent: 2em"><strong>某大厂游戏研发人员：</strong></p><p style="margin: 0px 0px 29px; padding: 0px; line-height: 28px; font-family: 宋体, Arial, sans-serif; font-size: 15.9996px; text-indent: 2em">新规对我们影响不大啊，毕竟中国上有政策下有对策。我们还是比较在意苹果的审核标准。</p><p style="margin: 0px 0px 29px; padding: 0px; line-height: 28px; font-family: 宋体, Arial, sans-serif; font-size: 15.9996px; text-indent: 2em"><strong>某手游大厂高管：</strong></p><p style="margin: 0px 0px 29px; padding: 0px; line-height: 28px; font-family: 宋体, Arial, sans-serif; font-size: 15.9996px; text-indent: 2em">这个政策对我们的影响并不大，因为我们愿意投入时间和金钱去做大IP的精品。我们布局的产品研发周期足够长，有资质也有能力在正式商业化前去完成必要的审核。</p><p style="margin: 0px 0px 29px; padding: 0px; line-height: 28px; font-family: 宋体, Arial, sans-serif; font-size: 15.9996px; text-indent: 2em">这个政策对中小公司来说风险可能很大。大部分的手游生命周期很短，竞争非常激烈，市场变化也很快。中小公司都盼着尽早上线变现，会不会出现审核完毕后，产品已经错过了最佳上线时间？我不知道广电总局的审核是否匹配快速变化的移动互联网市场。</p><p style="margin: 0px 0px 29px; padding: 0px; line-height: 28px; font-family: 宋体, Arial, sans-serif; font-size: 15.9996px; text-indent: 2em">每个国家都有自己的法律法规，苹果遵守中国法律天经地义。手游进入门槛相对较低，乱象多，确实需要些措施来规范市场。但我认为一个产品是否适合，在市场经济时代是由市场说了算的。相对于审核而言，更重要的是有效发挥政府的监管作用。</p><p style="margin: 0px 0px 29px; padding: 0px; line-height: 28px; font-family: 宋体, Arial, sans-serif; font-size: 15.9996px; text-indent: 2em"><strong>某大厂工作室市场负责人：</strong></p><p style="margin: 0px 0px 29px; padding: 0px; line-height: 28px; font-family: 宋体, Arial, sans-serif; font-size: 15.9996px; text-indent: 2em">总体来说，版号管理对于行业长远发展是有益的。渠道和广告平台等，现在已经开始要求发行商提供版号用于上线审核，这样可以较大地减弱盗版、山寨的情况。有一些人认为可能会给中小CP和独立开发者造成困难，但是从另一个方面去考虑，也许可以规范和引导整个行业分工的健康发展，有专业资质和能力的发行商将更受重视。但这也是一个理想的假设，需要时间验证。</p><p style="margin: 0px 0px 29px; padding: 0px; line-height: 28px; font-family: 宋体, Arial, sans-serif; font-size: 15.9996px; text-indent: 2em">近期，手游产品的庞大数量与政府审批流程效率的不匹配是近期网络上争论比较多。因为审批期限已经到来，所以申报产品激增，审批效率降低。多数手游厂商没有相关经验，在前期准备资料和沟通方面就有很多困难。不能如期拿到版号是手游厂商最恐惧、也是最无奈的。</p><p style="margin: 0px 0px 29px; padding: 0px; line-height: 28px; font-family: 宋体, Arial, sans-serif; font-size: 15.9996px; text-indent: 2em"><span style="font-size: 18px"><strong>专注发行领域的人这样说：</strong></span></p><p style="margin: 0px 0px 29px; padding: 0px; line-height: 28px; font-family: 宋体, Arial, sans-serif; font-size: 15.9996px; text-indent: 2em"><strong>某手游发行商CEO：</strong></p><p style="margin: 0px 0px 29px; padding: 0px; line-height: 28px; font-family: 宋体, Arial, sans-serif; font-size: 15.9996px; text-indent: 2em">广东买量派的发行公司笑了，他们从来都是自己买量自己导官网包，不上渠道也不上App Store，自己监管自己。手游不像页游，都有落地网页有据可查，这个条文颁发对他们影响不大。</p><p style="margin: 0px 0px 29px; padding: 0px; line-height: 28px; font-family: 宋体, Arial, sans-serif; font-size: 15.9996px; text-indent: 2em">有海外资质的发行公司笑了，他们的产品本身就是立足于海外市场的，届时如果国内用户有需求，勾选人民币充值就可以了。</p><p style="margin: 0px 0px 29px; padding: 0px; line-height: 28px; font-family: 宋体, Arial, sans-serif; font-size: 15.9996px; text-indent: 2em">三证齐全的公司（中小型发行公司基本很难拥有这个资质）笑了，以后专门增加一个游戏评审专员，收各个无证经营CP、小发行一个手续费，条文颁发无异于给这些公司提供了一个新的盈利增长点。</p><p style="margin: 0px 0px 29px; padding: 0px; line-height: 28px; font-family: 宋体, Arial, sans-serif; font-size: 15.9996px; text-indent: 2em"><strong>某手游发行商负责人：</strong></p><p style="margin: 0px 0px 29px; padding: 0px; line-height: 28px; font-family: 宋体, Arial, sans-serif; font-size: 15.9996px; text-indent: 2em">新政策对发行公司来说肯定是有影响的，公司需要积极去响应新政策，且新资料篇也需要重新审核，给公司增加了时间成本，迫使游戏的上线计划被打乱。但新政的出台也正好是给市场一个洗牌的机会，以前正规送审的公司非常少，这也是中国手游行业乱的最大原因。而现在那些涉及不合法的公司将被清除，对整个市场是好事。</p><p style="margin: 0px 0px 29px; padding: 0px; line-height: 28px; font-family: 宋体, Arial, sans-serif; font-size: 15.9996px; text-indent: 2em"><strong>某手游公司创始人：</strong></p><p style="margin: 0px 0px 29px; padding: 0px; line-height: 28px; font-family: 宋体, Arial, sans-serif; font-size: 15.9996px; text-indent: 2em">对大环境来说是好事，但是对于独立开发者和中小型CP是一个致命的打击，因为可能大家只能找大的厂商去做发行，那大厂就拥有了更多的议价权。所以这个新规其实对大厂帮助比较大，中小发行团队可选择的就变得更少了。不过现在有很多CP目标是做全球化的产品，国外的渠道还是可以随便上的，没有影响。</p><p style="margin: 0px 0px 29px; padding: 0px; line-height: 28px; font-family: 宋体, Arial, sans-serif; font-size: 15.9996px; text-indent: 2em"><strong>某手游公司CEO：</strong></p><p style="margin: 0px 0px 29px; padding: 0px; line-height: 28px; font-family: 宋体, Arial, sans-serif; font-size: 15.9996px; text-indent: 2em">对商业游戏来说影响不大，大部分游戏都已经办版号了，未来办版号的成本也在可接受的范围之内。实际影响比较大的是独立游戏，办个版号不但耗时耗力耗钱，还有申请资质这种很难绕过的槛。对于独立游戏开发者来说，去海外没问题，但是没有必要为了版号问题放弃国内市场（除非游戏内容是睬红线的），最方便省力的方法就是找一家发行公司来帮你的游戏搞定版号，比如我们&hellip;&hellip;</p><p style="margin: 0px 0px 29px; padding: 0px; line-height: 28px; font-family: 宋体, Arial, sans-serif; font-size: 15.9996px" align="center"></p><div class="mbArticleSharePic&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" style="position: relative; z-index: 1; margin: 0px auto; width: 554px"><img style="border: none; vertical-align: bottom; max-width: 640px" src="http://img1.gtimg.com/gamezone/pics/hv1/79/166/2092/136074709.png" border="0" alt="&ldquo;手游审核前置&rdquo;新规正式实施：情况真有那么糟？" /></div><p>&nbsp;</p><p style="margin: 0px 0px 29px; padding: 0px; line-height: 28px; font-family: 宋体, Arial, sans-serif; font-size: 15.9996px; text-indent: 2em">从这些采访中也能看出，大部分游戏行业人士对新规的态度都比较一致：</p><p style="margin: 0px 0px 29px; padding: 0px; line-height: 28px; font-family: 宋体, Arial, sans-serif; font-size: 15.9996px; text-indent: 2em">游戏大厂受到的影响并不大，通常会有专人负责版号业务，即便是上线时间可能因此有一些推迟，但大厂的核心产品也普遍是重度游戏，开发周期长、生命周期也相对更长，有更充足的时间来准备版号。</p><p style="margin: 0px 0px 29px; padding: 0px; line-height: 28px; font-family: 宋体, Arial, sans-serif; font-size: 15.9996px; text-indent: 2em">对于中小CP来说，影响会更大一些，但也不会对其造成毁灭性打击，尤其是对于准备将自己的产品交给发行商的CP。据<strong>某发行商负责人透露，尽管也有CP自己办版号的情况，但大多数时候是由发行商负责版号的申请。</strong></p><p style="margin: 0px 0px 29px; padding: 0px; line-height: 28px; font-family: 宋体, Arial, sans-serif; font-size: 15.9996px; text-indent: 2em">值得一提的是，<strong>不少CP担心由发行商办版号，会导致发行拥有更高的议价权，使得CP的<a style="outline: none; color: #000000; text-decoration: none; border-bottom-width: 1px; border-bottom-style: dotted; border-bottom-color: #536da6" href="http://datalib.games.qq.com/net_game/259/index.shtml" target="_blank" class="a-tips-Article-QQ">生存</a>空间进一步收窄。但某发行商负责人表示：不太会出现这样的情况。</strong>&ldquo;办版号本来就是发行商该做的事，不会一个版号的事就给发行增加谈判筹码。还是要从游戏本身的品质出发去谈合作。&rdquo;</p><p style="margin: 0px 0px 29px; padding: 0px; line-height: 28px; font-family: 宋体, Arial, sans-serif; font-size: 15.9996px; text-indent: 2em">而事实上，<strong>一些游戏发行商已经推出了新的代理发行方式：不绑定发行，仅协助优秀的独立游戏解决版号问题。</strong>具体的操作是：先以发行商的名义协助游戏把版号办了，成本费用发行方垫付（费用多少事先约定好，比如说1万元）。后续游戏收入若能抵扣掉版号成本后，所有的收入都归开发者，且开发者可以随便再拿去给别人发行；如果游戏最终收入不够抵扣版号费用，就算了，也不用欠发行商钱。&mdash;&mdash;该发行商唯一的要求是，合作期间游戏带上自己公司的LOGO，推广自己的品牌。</p><p style="margin: 0px 0px 29px; padding: 0px; line-height: 28px; font-family: 宋体, Arial, sans-serif; font-size: 15.9996px; text-indent: 2em"><span style="font-size: 18px"><strong>打击最大的是：不打算找发行的独立游戏开发者。</strong></span></p><p style="margin: 0px 0px 29px; padding: 0px; line-height: 28px; font-family: 宋体, Arial, sans-serif; font-size: 15.9996px; text-indent: 2em">在知乎上，一位名为&ldquo;冷月无声&rdquo;的网友（自称是一名手游研发人员）吐槽了《通知》所需要提交的材料，获得了最多的点赞数。在他看来，正常的材料都能理解，但以下材料很&ldquo;荒谬&rdquo;：</p><p style="margin: 0px 0px 29px; padding: 0px; line-height: 28px; font-family: 宋体, Arial, sans-serif; font-size: 15.9996px; text-indent: 2em">1.必须刻录5张光盘，必须是DVD。</p><p style="margin: 0px 0px 29px; padding: 0px; line-height: 28px; font-family: 宋体, Arial, sans-serif; font-size: 15.9996px; text-indent: 2em">安卓版安装包一张，iOS版安装包一张。还有3张是公司相关的资质证明扫描件的jpg格式。对你没看错，现在这个时代了，不能直接传文件，甚至不能把5个文件放在同一张光盘里。</p><p style="margin: 0px 0px 29px; padding: 0px; line-height: 28px; font-family: 宋体, Arial, sans-serif; font-size: 15.9996px; text-indent: 2em">2.必须寄过去两个装好游戏的手机，安卓一部，iPhone一部。假设这个游戏没有安卓版，就提供iphone两部。一个公司假如有N个游戏，就要寄2&times;N个手机。</p><p style="margin: 0px 0px 29px; padding: 0px; line-height: 28px; font-family: 宋体, Arial, sans-serif; font-size: 15.9996px; text-indent: 2em">3.手机里必须有电话卡，电话卡必须有流量。不能寄iTouch，假设有穷苦的小公司一直用iTouch做测试机，则必须为了审核买iPhone。</p><p style="margin: 0px 0px 29px; padding: 0px; line-height: 28px; font-family: 宋体, Arial, sans-serif; font-size: 15.9996px" align="center"></p><div class="mbArticleSharePic&nbsp;&nbsp;" style="position: relative; z-index: 1; margin: 0px auto; width: 640px"><img style="border: none; vertical-align: bottom; max-width: 640px" src="http://img1.gtimg.com/gamezone/pics/hv1/239/170/2092/136075889.png" border="0" alt="&ldquo;手游审核前置&rdquo;新规正式实施：情况真有那么糟？" /></div><p>&nbsp;</p><p style="margin: 0px 0px 29px; padding: 0px; line-height: 28px; font-family: 宋体, Arial, sans-serif; font-size: 15.9996px; text-indent: 2em">该知乎答案在之后发布了更新，称近期接到了新的通知，手游版号申请材料的&ldquo;设备提供&rdquo;有变动：提交手机改为提交4个同样的DVD安装光盘，若游戏只有安卓或iOS一个版本，则提交4个光盘，每个装有1个该版本游戏的安装包；若游戏有安卓和iOS两个版本，则提交4个光盘，每个光盘有1个安卓和1个iOS的安装包。</p><p style="margin: 0px 0px 29px; padding: 0px; line-height: 28px; font-family: 宋体, Arial, sans-serif; font-size: 15.9996px; text-indent: 2em">可以看出，准备各种材料对于独立游戏开发者来说是一件相当繁琐的事，如果自己准备，则需要耗费大量的精力&mdash;&mdash;并且很可能递交的材料不符合规定，来回折腾。也因此，催生出手游版号代办这样类似中介的产业。</p><p style="margin: 0px 0px 29px; padding: 0px; line-height: 28px; font-family: 宋体, Arial, sans-serif; font-size: 15.9996px; text-indent: 2em">即便如此，从媒体曝光的版号代办价格来看，一个版号15000~35000元，对一般游戏厂商来说是不痛不痒，但对于个人独立开发者来说，这很可能比他开发游戏的全部成本都要高得多。付出这笔钱，都会使得很多独立游戏望而却步。</p><p style="margin: 0px 0px 29px; padding: 0px; line-height: 28px; font-family: 宋体, Arial, sans-serif; font-size: 15.9996px; text-indent: 2em">&ldquo;其实大家并不担心办不下来，就是觉得突然来这么一茬很恶心，花时间又花人力。&rdquo;某独立游戏开发者如是说。</p><p style="margin: 0px 0px 29px; padding: 0px; line-height: 28px; font-family: 宋体, Arial, sans-serif; font-size: 15.9996px" align="center"></p><div class="mbArticleSharePic&nbsp;&nbsp;" style="position: relative; z-index: 1; margin: 0px auto; width: 467px"><img style="border: none; vertical-align: bottom; max-width: 640px" src="http://img1.gtimg.com/gamezone/pics/hv1/80/166/2092/136074710.png" border="0" alt="最近很火的游戏版号代办产业" /></div><p>&nbsp;</p><p style="margin: 0px 0px 29px; padding: 0px; line-height: 28px; font-family: 宋体, Arial, sans-serif; font-size: 10pt" align="center">最近很火的游戏版号代办产业</p><p style="margin: 0px 0px 29px; padding: 0px; line-height: 28px; font-family: 宋体, Arial, sans-serif; font-size: 15.9996px; text-indent: 2em">在6月28日，国家新闻出版广电总局在北京召开了为期两天的&ldquo;<a style="outline: none; color: #000000; text-decoration: none; border-bottom-width: 1px; border-bottom-style: dotted; border-bottom-color: #536da6" href="http://games.qq.com/ntgame/netgame.shtml" target="_blank" class="a-tips-Article-QQ">网络游戏</a>内容管理培训会&rdquo;，给相关企业做了一些关于新规的培训，具体培训内容包括政策解读、具体申报审批材料、游戏内容规范等。</p><p style="margin: 0px 0px 29px; padding: 0px; line-height: 28px; font-family: 宋体, Arial, sans-serif; font-size: 15.9996px; text-indent: 2em">会后，我们联系到了相关内部人士，阐明了游戏行业目前对新规的种种疑惑，询问对方是否会将培训的重点内容整理发布，以指导游戏同行们更好地申办版号。对方表示：&ldquo;目前新规刚开始实施，总局希望能在新规实施了一段时间之后，再安排发布类似的、更具实操意义的指导方案。&rdquo;</p><p style="margin: 0px 0px 29px; padding: 0px; line-height: 28px; font-family: 宋体, Arial, sans-serif; font-size: 15.9996px; text-indent: 2em">无论支持也好、吐槽也好，事实上大部分人还是理解，这次的新规是为了让中国手游市场更健康的发展。但具体实施之后，会给行业带来什么样的影响？我们静观其变。</p>
]]>
</description>
</item><item>
<link>http://i.renjihe.com/blog/read.php?7367</link>
<title><![CDATA[Unity 游戏框架搭建 (五) 简易消息机制]]></title> 
<author>renjihe1988 &lt;admin@yourname.com&gt;</author>
<category><![CDATA[游戏]]></category>
<pubDate>Thu, 30 Jun 2016 16:07:50 +0000</pubDate> 
<guid>http://i.renjihe.com/blog/read.php?7367</guid> 
<description>
<![CDATA[ 
	http://liangxiegame.com/unity-you-xi-kuang-jia-da-jian-wu-jian-yi-xiao-xi-ji-zhi/<br /><br /><h4 style="margin: 1em 0px 0.5em; padding: 0px; border: 0px; font-family: ff-tisa-web-pro-1, ff-tisa-web-pro-2, 'Lucida Grande', 'Hiragino Sans GB', 'Hiragino Sans GB W3', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-size: 1.1em; font-weight: lighter; font-stretch: inherit; line-height: inherit; vertical-align: baseline; color: #333333; -webkit-font-smoothing: antialiased">什么是消息机制?</h4><p style="margin: 0px 0px 1.3em; padding: 0px; border: 0px; font-family: ff-tisa-web-pro-1, ff-tisa-web-pro-2, 'Lucida Grande', 'Hiragino Sans GB', 'Hiragino Sans GB W3', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-size: 16px; font-stretch: inherit; line-height: 1.7em; vertical-align: baseline; color: #666666"><img style="margin: 0px auto; padding: 0px; border: 0px; font-family: inherit; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; max-width: 100%; border-radius: 3px; text-align: center; display: block" src="http://liangxiegame.com/content/images/2016/06/-----2016-06-05---12-57-55.png" border="0" /><img style="margin: 0px auto; padding: 0px; border: 0px; font-family: inherit; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; max-width: 100%; border-radius: 3px; text-align: center; display: block" src="http://liangxiegame.com/content/images/2016/06/-----2016-06-05---12-58-29.png" border="0" /><img style="margin: 0px auto; padding: 0px; border: 0px; font-family: inherit; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; max-width: 100%; border-radius: 3px; text-align: center; display: block" src="http://liangxiegame.com/content/images/2016/06/-----2016-06-05---12-58-52.png" border="0" /><img style="margin: 0px auto; padding: 0px; border: 0px; font-family: inherit; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; max-width: 100%; border-radius: 3px; text-align: center; display: block" src="http://liangxiegame.com/content/images/2016/06/-----2016-06-05---12-59-14.png" border="0" /><img style="margin: 0px auto; padding: 0px; border: 0px; font-family: inherit; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; max-width: 100%; border-radius: 3px; text-align: center; display: block" src="http://liangxiegame.com/content/images/2016/06/-----2016-06-05---12-59-39.png" border="0" />23333333，让我先笑一会。</p><h4 style="margin: 1em 0px 0.5em; padding: 0px; border: 0px; font-family: ff-tisa-web-pro-1, ff-tisa-web-pro-2, 'Lucida Grande', 'Hiragino Sans GB', 'Hiragino Sans GB W3', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-size: 1.1em; font-weight: lighter; font-stretch: inherit; line-height: inherit; vertical-align: baseline; color: #333333; -webkit-font-smoothing: antialiased">为什么用消息机制?</h4><p style="margin: 0px 0px 1.3em; padding: 0px; border: 0px; font-family: ff-tisa-web-pro-1, ff-tisa-web-pro-2, 'Lucida Grande', 'Hiragino Sans GB', 'Hiragino Sans GB W3', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-size: 16px; font-stretch: inherit; line-height: 1.7em; vertical-align: baseline; color: #666666">&emsp;&emsp;三个字,解!!!!耦!!!!合!!!!。</p><h5 style="margin: 1em 0px 0.5em; padding: 0px; border: 0px; font-family: ff-tisa-web-pro-1, ff-tisa-web-pro-2, 'Lucida Grande', 'Hiragino Sans GB', 'Hiragino Sans GB W3', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-size: 1em; font-weight: lighter; font-stretch: inherit; line-height: 16px; vertical-align: baseline; color: #333333; -webkit-font-smoothing: antialiased">我的框架中的消息机制用例:</h5><p style="margin: 0px 0px 1.3em; padding: 0px; border: 0px; font-family: ff-tisa-web-pro-1, ff-tisa-web-pro-2, 'Lucida Grande', 'Hiragino Sans GB', 'Hiragino Sans GB W3', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-size: 16px; font-stretch: inherit; line-height: 1.7em; vertical-align: baseline; color: #666666">1.接收者</p><pre style="margin-top: 0px; margin-bottom: 1.3em; padding: 1em 18.84375px; border: 1px solid #c9e1f6; font-family: Consolas, Menlo, Monaco, 'Lucida Console', 'Liberation Mono', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Courier New', monospace, serif; font-size: 0.9em; font-stretch: inherit; line-height: 1.3em; vertical-align: baseline; border-radius: 3px; overflow: auto; width: 716.609375px; color: #666666; background: #e8f2fb"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">using</span> UnityEngine;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">using</span> System.Collections;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">using</span> QFramework;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment">/// &lt;summary&gt;</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment">/// 1.接收者需要实现IMsgReceiver接口。</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment">/// 2.使用this.RegisterLogicMsg注册消息和回调函数。</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment">/// &lt;/summary&gt;</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">public</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">class</span> Receiver : MonoBehaviour,IMsgReceiver &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #4271ae" class="hljs-function"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">void</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #3e999f" class="hljs-title">Awake</span><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #f5871f" class="hljs-params">()</span>&nbsp;&nbsp;&nbsp;&nbsp; </span>&#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">this</span>.RegisterLogicMsg (<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #718c00" class="hljs-string">&quot;Receiver Show Sth&quot;</span>, ReceiverMsg);&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.UnRegisterLogicMsg (&quot;Receiver Show Sth&quot;, ReceiverMsg);</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #4271ae" class="hljs-function"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">void</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #3e999f" class="hljs-title">ReceiverMsg</span><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #f5871f" class="hljs-params">(params object[] paramList)</span>&nbsp;&nbsp;&nbsp;&nbsp; </span>&#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; foreach (var sth in paramList) &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; QPrint.Warn (sth.ToString());&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125;&nbsp;&nbsp;&nbsp;&nbsp; &#125; &#125; </pre><p style="margin: 0px 0px 1.3em; padding: 0px; border: 0px; font-family: ff-tisa-web-pro-1, ff-tisa-web-pro-2, 'Lucida Grande', 'Hiragino Sans GB', 'Hiragino Sans GB W3', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-size: 16px; font-stretch: inherit; line-height: 1.7em; vertical-align: baseline; color: #666666">2.发送者</p><pre style="margin-top: 0px; margin-bottom: 1.3em; padding: 1em 18.84375px; border: 1px solid #c9e1f6; font-family: Consolas, Menlo, Monaco, 'Lucida Console', 'Liberation Mono', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Courier New', monospace, serif; font-size: 0.9em; font-stretch: inherit; line-height: 1.3em; vertical-align: baseline; border-radius: 3px; overflow: auto; width: 716.609375px; color: #666666; background: #e8f2fb"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">using</span> UnityEngine;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">using</span> System.Collections;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">using</span> QFramework;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment">/// &lt;summary&gt;</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment">/// 1.发送者需要,实现IMsgSender接口</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment">/// 2.调用this.SendLogicMsg发送Receiver Show Sth消息,并传入两个参数</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment">/// &lt;/summary&gt;</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">public</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">class</span> Sender : MonoBehaviour,IMsgSender &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment">// Update is called once per frame</span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #4271ae" class="hljs-function"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">void</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #3e999f" class="hljs-title">Update</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #f5871f" class="hljs-params">()</span> </span>&#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">this</span>.SendLogicMsg (<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #718c00" class="hljs-string">&quot;Receiver Show Sth&quot;</span>,<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #718c00" class="hljs-string">&quot;你好&quot;</span>,<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #718c00" class="hljs-string">&quot;世界&quot;</span>);&nbsp;&nbsp;&nbsp;&nbsp; &#125; &#125; </pre><p style="margin: 0px 0px 1.3em; padding: 0px; border: 0px; font-family: ff-tisa-web-pro-1, ff-tisa-web-pro-2, 'Lucida Grande', 'Hiragino Sans GB', 'Hiragino Sans GB W3', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-size: 16px; font-stretch: inherit; line-height: 1.7em; vertical-align: baseline; color: #666666">3.运行结果&nbsp;<br /><img style="margin: 0px auto; padding: 0px; border: 0px; font-family: inherit; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; max-width: 100%; border-radius: 3px; text-align: center; display: block" src="http://liangxiegame.com/content/images/2016/06/-----2016-06-05---1-11-11.png" border="0" />使用起来几行代码的事情,实现起来就没这么简单了。</p><h4 style="margin: 1em 0px 0.5em; padding: 0px; border: 0px; font-family: ff-tisa-web-pro-1, ff-tisa-web-pro-2, 'Lucida Grande', 'Hiragino Sans GB', 'Hiragino Sans GB W3', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-size: 1.1em; font-weight: lighter; font-stretch: inherit; line-height: inherit; vertical-align: baseline; color: #333333; -webkit-font-smoothing: antialiased">如何实现的?</h4><p style="margin: 0px 0px 1.3em; padding: 0px; border: 0px; font-family: ff-tisa-web-pro-1, ff-tisa-web-pro-2, 'Lucida Grande', 'Hiragino Sans GB', 'Hiragino Sans GB W3', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-size: 16px; font-stretch: inherit; line-height: 1.7em; vertical-align: baseline; color: #666666">&emsp;&emsp;可以看到接收者实现了接口IMsgReceiver,发送者实现了接口IMsgSender。 那先看下这两个接口定义。<br />IMsgReceiver:</p><pre style="margin-top: 0px; margin-bottom: 1.3em; padding: 1em 18.84375px; border: 1px solid #c9e1f6; font-family: Consolas, Menlo, Monaco, 'Lucida Console', 'Liberation Mono', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Courier New', monospace, serif; font-size: 0.9em; font-stretch: inherit; line-height: 1.3em; vertical-align: baseline; border-radius: 3px; overflow: auto; width: 716.609375px; color: #666666; background: #e8f2fb"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">using</span> UnityEngine;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">using</span> System.Collections;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">namespace</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #3e999f" class="hljs-title">QFramework</span> &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">public</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">interface</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #3e999f" class="hljs-title">IMsgReceiver</span>&nbsp;&nbsp;&#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125; &#125; </pre><p style="margin: 0px 0px 1.3em; padding: 0px; border: 0px; font-family: ff-tisa-web-pro-1, ff-tisa-web-pro-2, 'Lucida Grande', 'Hiragino Sans GB', 'Hiragino Sans GB W3', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-size: 16px; font-stretch: inherit; line-height: 1.7em; vertical-align: baseline; color: #666666">IMsgSender</p><pre style="margin-top: 0px; margin-bottom: 1.3em; padding: 1em 18.84375px; border: 1px solid #c9e1f6; font-family: Consolas, Menlo, Monaco, 'Lucida Console', 'Liberation Mono', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Courier New', monospace, serif; font-size: 0.9em; font-stretch: inherit; line-height: 1.3em; vertical-align: baseline; border-radius: 3px; overflow: auto; width: 716.609375px; color: #666666; background: #e8f2fb"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">using</span> UnityEngine;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">using</span> System.Collections;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">namespace</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #3e999f" class="hljs-title">QFramework</span> &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">public</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">interface</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #3e999f" class="hljs-title">IMsgSender</span>&nbsp;&nbsp;&#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125; &#125; </pre><p style="margin: 0px 0px 1.3em; padding: 0px; border: 0px; font-family: ff-tisa-web-pro-1, ff-tisa-web-pro-2, 'Lucida Grande', 'Hiragino Sans GB', 'Hiragino Sans GB W3', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-size: 16px; font-stretch: inherit; line-height: 1.7em; vertical-align: baseline; color: #666666">毛都没有啊。也没有SendLogicMsg或者ReceiveLogicMsg方法的定义啊。</p><p style="margin: 0px 0px 1.3em; padding: 0px; border: 0px; font-family: ff-tisa-web-pro-1, ff-tisa-web-pro-2, 'Lucida Grande', 'Hiragino Sans GB', 'Hiragino Sans GB W3', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-size: 16px; font-stretch: inherit; line-height: 1.7em; vertical-align: baseline; color: #666666">答案是使用C# this的扩展方式实现接口方法。 不清楚的童鞋请百度C# this扩展,有好多文章就不介绍了。 以上先告一段落,先介绍个重要的角色,MsgDispatcher(消息分发器)。</p><p style="margin: 0px 0px 1.3em; padding: 0px; border: 0px; font-family: ff-tisa-web-pro-1, ff-tisa-web-pro-2, 'Lucida Grande', 'Hiragino Sans GB', 'Hiragino Sans GB W3', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-size: 16px; font-stretch: inherit; line-height: 1.7em; vertical-align: baseline; color: #666666">贴上第一部分代码:</p><pre style="margin-top: 0px; margin-bottom: 1.3em; padding: 1em 18.84375px; border: 1px solid #c9e1f6; font-family: Consolas, Menlo, Monaco, 'Lucida Console', 'Liberation Mono', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Courier New', monospace, serif; font-size: 0.9em; font-stretch: inherit; line-height: 1.3em; vertical-align: baseline; border-radius: 3px; overflow: auto; width: 716.609375px; color: #666666; background: #e8f2fb"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">namespace</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #3e999f" class="hljs-title">QFramework</span> &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-xmlDocTag">///</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-xmlDocTag">&lt;summary&gt;</span></span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-xmlDocTag">///</span> 消息分发器</span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-xmlDocTag">///</span> C# this扩展 需要静态类</span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-xmlDocTag">///</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-xmlDocTag">&lt;/summary&gt;</span></span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">public</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">static</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">class</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #3e999f" class="hljs-title">QMsgDispatcher</span>&nbsp;&nbsp;&#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-xmlDocTag">///</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-xmlDocTag">&lt;summary&gt;</span></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-xmlDocTag">///</span> 消息捕捉器</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-xmlDocTag">///</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-xmlDocTag">&lt;/summary&gt;</span></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">class</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #3e999f" class="hljs-title">LogicMsgHandler</span> &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">public</span> IMsgReceiver receiver;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">public</span>&nbsp;&nbsp;VoidDelegate.WithParams callback;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment">/*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* VoidDelegate.WithParams 是一种委托 ,定义是这样的&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *&nbsp;&nbsp;public class VoidDelegate&#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public delegate void WithParams(params object[] paramList);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&#125;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #4271ae" class="hljs-function"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">public</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #3e999f" class="hljs-title">LogicMsgHandler</span><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #f5871f" class="hljs-params">(IMsgReceiver receiver,VoidDelegate.WithParams callback)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>&#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">this</span>.receiver = receiver;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">this</span>.callback = callback;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-xmlDocTag">///</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-xmlDocTag">&lt;summary&gt;</span></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-xmlDocTag">///</span> 每个消息名字维护一组消息捕捉器。</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-xmlDocTag">///</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-xmlDocTag">&lt;/summary&gt;</span></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">static</span> Dictionary&lt;<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">string</span>,List&lt;LogicMsgHandler&gt;&gt; mMsgHandlerDict = <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">new</span> Dictionary&lt;<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">string</span>,List&lt;LogicMsgHandler&gt;&gt; (); </pre><p style="margin: 0px 0px 1.3em; padding: 0px; border: 0px; font-family: ff-tisa-web-pro-1, ff-tisa-web-pro-2, 'Lucida Grande', 'Hiragino Sans GB', 'Hiragino Sans GB W3', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-size: 16px; font-stretch: inherit; line-height: 1.7em; vertical-align: baseline; color: #666666">读注释!!!</p><p style="margin: 0px 0px 1.3em; padding: 0px; border: 0px; font-family: ff-tisa-web-pro-1, ff-tisa-web-pro-2, 'Lucida Grande', 'Hiragino Sans GB', 'Hiragino Sans GB W3', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-size: 16px; font-stretch: inherit; line-height: 1.7em; vertical-align: baseline; color: #666666">贴上注册消息的代码</p><pre style="margin-top: 0px; margin-bottom: 1.3em; padding: 1em 18.84375px; border: 1px solid #c9e1f6; font-family: Consolas, Menlo, Monaco, 'Lucida Console', 'Liberation Mono', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Courier New', monospace, serif; font-size: 0.9em; font-stretch: inherit; line-height: 1.3em; vertical-align: baseline; border-radius: 3px; overflow: auto; width: 716.609375px; color: #666666; background: #e8f2fb">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-xmlDocTag">///</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-xmlDocTag">&lt;summary&gt;</span></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-xmlDocTag">///</span> 注册消息,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-xmlDocTag">///</span> 注意第一个参数,使用了C# this的扩展,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-xmlDocTag">///</span> 所以只有实现IMsgReceiver的对象才能调用此方法</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-xmlDocTag">///</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-xmlDocTag">&lt;/summary&gt;</span></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #4271ae" class="hljs-function"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">public</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">static</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">void</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #3e999f" class="hljs-title">RegisterLogicMsg</span><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #f5871f" class="hljs-params">(<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">this</span> IMsgReceiver self, <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">string</span> msgName,VoidDelegate.WithParams callback)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>&#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment">// 略过</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">if</span> (<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">string</span>.IsNullOrEmpty(msgName)) &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; QPrint.FrameworkWarn(<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #718c00" class="hljs-string">&quot;RegisterMsg:&quot;</span> + msgName + <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #718c00" class="hljs-string">&quot; is Null or Empty&quot;</span>);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">return</span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment">// 略过</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">if</span> (<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">null</span> == callback) &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; QPrint.FrameworkWarn (<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #718c00" class="hljs-string">&quot;RegisterMsg:&quot;</span> + msgName + <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #718c00" class="hljs-string">&quot; callback is Null&quot;</span>);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">return</span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment">// 略过</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">if</span> (!mMsgHandlerDict.ContainsKey (msgName)) &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mMsgHandlerDict [msgName] = <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">new</span> List&lt;LogicMsgHandler&gt; ();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment">// 看下这里</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">var</span> handlers = mMsgHandlerDict [msgName];&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment">// 略过</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment">// 防止重复注册</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">foreach</span> (<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">var</span> handler <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">in</span> handlers) &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">if</span> (handler.receiver == self &amp;&amp; handler.callback == callback) &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; QPrint.FrameworkWarn (<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #718c00" class="hljs-string">&quot;RegisterMsg:&quot;</span> + msgName + <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #718c00" class="hljs-string">&quot; ayready Register&quot;</span>);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">return</span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment">// 再看下这里</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; handlers.Add (<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">new</span> LogicMsgHandler (self, callback));&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125; </pre><p style="margin: 0px 0px 1.3em; padding: 0px; border: 0px; font-family: ff-tisa-web-pro-1, ff-tisa-web-pro-2, 'Lucida Grande', 'Hiragino Sans GB', 'Hiragino Sans GB W3', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-size: 16px; font-stretch: inherit; line-height: 1.7em; vertical-align: baseline; color: #666666">为了节省您时间,略过部分的代码就不要看了,什么?!!你都看了!!!! 23333</p><p style="margin: 0px 0px 1.3em; padding: 0px; border: 0px; font-family: ff-tisa-web-pro-1, ff-tisa-web-pro-2, 'Lucida Grande', 'Hiragino Sans GB', 'Hiragino Sans GB W3', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-size: 16px; font-stretch: inherit; line-height: 1.7em; vertical-align: baseline; color: #666666">发送消息相关的代码</p><pre style="margin-top: 0px; margin-bottom: 1.3em; padding: 1em 18.84375px; border: 1px solid #c9e1f6; font-family: Consolas, Menlo, Monaco, 'Lucida Console', 'Liberation Mono', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Courier New', monospace, serif; font-size: 0.9em; font-stretch: inherit; line-height: 1.3em; vertical-align: baseline; border-radius: 3px; overflow: auto; width: 716.609375px; color: #666666; background: #e8f2fb">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-xmlDocTag">///</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-xmlDocTag">&lt;summary&gt;</span></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-xmlDocTag">///</span> 发送消息</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-xmlDocTag">///</span> 注意第一个参数</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-xmlDocTag">///</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-xmlDocTag">&lt;/summary&gt;</span></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #4271ae" class="hljs-function"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">public</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">static</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">void</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #3e999f" class="hljs-title">SendLogicMsg</span><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #f5871f" class="hljs-params">(<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">this</span> IMsgSender sender, <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">string</span> msgName,<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">params</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">object</span>[] paramList )</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>&#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment">// 略过,不用看</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">if</span> (<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">string</span>.IsNullOrEmpty(msgName)) &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; QPrint.FrameworkError(<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #718c00" class="hljs-string">&quot;SendMsg is Null or Empty&quot;</span>);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">return</span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment">// 略过,不用看</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">if</span> (!mMsgHandlerDict.ContainsKey(msgName))&#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; QPrint.FrameworkWarn(<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #718c00" class="hljs-string">&quot;SendMsg is UnRegister&quot;</span>);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">return</span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment">// 开始看!!!!</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">var</span> handlers = mMsgHandlerDict[msgName];&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">var</span> handlerCount = handlers.Count;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment">// 之所以是从后向前遍历,是因为&nbsp;&nbsp;从前向后遍历删除后索引值会不断变化</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment">// 参考文章,http://www.2cto.com/kf/201312/266723.html</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">for</span> (<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">int</span> index = handlerCount - <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #f5871f" class="hljs-number">1</span>;index &gt;= <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #f5871f" class="hljs-number">0</span>;index--)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">var</span> handler = handlers[index];&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">if</span> (handler.receiver != <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">null</span>) &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; QPrint.FrameworkLog (<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #718c00" class="hljs-string">&quot;SendLogicMsg:&quot;</span> + msgName + <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #718c00" class="hljs-string">&quot; Succeed&quot;</span>);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; handler.callback (paramList);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">else</span> &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; handlers.Remove (handler);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125; </pre><p style="margin: 0px 0px 1.3em; padding: 0px; border: 0px; font-family: ff-tisa-web-pro-1, ff-tisa-web-pro-2, 'Lucida Grande', 'Hiragino Sans GB', 'Hiragino Sans GB W3', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-size: 16px; font-stretch: inherit; line-height: 1.7em; vertical-align: baseline; color: #666666">OK主要的部分全都贴出来啦&nbsp;<br />以上代码以全部上传到Github上边<br />贴出代码地址:<a style="margin: 0px; padding: 0px; border: 0px; font-family: inherit; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; text-decoration: none; color: #bf1827" href="https://github.com/liangxiegame/QFramework/tree/master/Script/LogicMsg" target="_blank">消息机制相关代码地址</a></p><h5 style="margin: 1em 0px 0.5em; padding: 0px; border: 0px; font-family: ff-tisa-web-pro-1, ff-tisa-web-pro-2, 'Lucida Grande', 'Hiragino Sans GB', 'Hiragino Sans GB W3', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-size: 1em; font-weight: lighter; font-stretch: inherit; line-height: 16px; vertical-align: baseline; color: #333333; -webkit-font-smoothing: antialiased">可以改进的地方:</h5><p style="margin: 0px 0px 1.3em; padding: 0px; border: 0px; font-family: ff-tisa-web-pro-1, ff-tisa-web-pro-2, 'Lucida Grande', 'Hiragino Sans GB', 'Hiragino Sans GB W3', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-size: 16px; font-stretch: inherit; line-height: 1.7em; vertical-align: baseline; color: #666666">&emsp;&emsp;1.目前整个游戏的消息都由一个字典维护,可以改进为每个模块维护一个字典或者其他方式。 &emsp;&emsp;2.消息名字类型由字符串定义的,可以改成枚举转unsigned int方式。 &emsp;&emsp;3.欢迎补充。</p><h5 style="margin: 1em 0px 0.5em; padding: 0px; border: 0px; font-family: ff-tisa-web-pro-1, ff-tisa-web-pro-2, 'Lucida Grande', 'Hiragino Sans GB', 'Hiragino Sans GB W3', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-size: 1em; font-weight: lighter; font-stretch: inherit; line-height: 16px; vertical-align: baseline; color: #333333; -webkit-font-smoothing: antialiased">坑</h5><p style="margin: 0px 0px 1.3em; padding: 0px; border: 0px; font-family: ff-tisa-web-pro-1, ff-tisa-web-pro-2, 'Lucida Grande', 'Hiragino Sans GB', 'Hiragino Sans GB W3', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-size: 16px; font-stretch: inherit; line-height: 1.7em; vertical-align: baseline; color: #666666">&emsp;&emsp;1.如果是MonoBehaviour注册消息之后,GameObject Destroy之前一定要注销消息,之前的解决方案是,自定义一个基类来维护该对象已经注册的消息列表,然后在基类的OnDestory时候遍历卸载。 &emsp;&emsp;2.欢迎补充。</p>
]]>
</description>
</item><item>
<link>http://i.renjihe.com/blog/read.php?7366</link>
<title><![CDATA[Unity 游戏框架搭建 (四) 简易有限状态机]]></title> 
<author>renjihe1988 &lt;admin@yourname.com&gt;</author>
<category><![CDATA[游戏]]></category>
<pubDate>Thu, 30 Jun 2016 16:07:16 +0000</pubDate> 
<guid>http://i.renjihe.com/blog/read.php?7366</guid> 
<description>
<![CDATA[ 
	http://liangxiegame.com/unity-you-xi-kuang-jia-da-jian-er-dan-li-de-mo-ban-2/<br /><br /><h5 style="margin: 1em 0px 0.5em; padding: 0px; border: 0px; font-family: ff-tisa-web-pro-1, ff-tisa-web-pro-2, 'Lucida Grande', 'Hiragino Sans GB', 'Hiragino Sans GB W3', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-size: 1em; font-weight: lighter; font-stretch: inherit; line-height: 16px; vertical-align: baseline; color: #333333; -webkit-font-smoothing: antialiased">为什么用有限状态机?</h5><p style="margin: 0px 0px 1.3em; padding: 0px; border: 0px; font-family: ff-tisa-web-pro-1, ff-tisa-web-pro-2, 'Lucida Grande', 'Hiragino Sans GB', 'Hiragino Sans GB W3', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-size: 16px; font-stretch: inherit; line-height: 1.7em; vertical-align: baseline; color: #666666">&emsp;&emsp;之前做过一款跑酷游戏,跑酷角色有很多状态:跑、跳、二段跳、死亡等等。一开始是使用if/switch来切换状态,但是每次角色添加一个状态（提前没规划好),所有状态处理相关的代码就会指数级增长,那样就会嗅出代码的坏味道了。在这种处理状态并且状态数量不是特别多的情况下,自然就想到了引入状态机。<br /><br />优点:<br />&emsp;&emsp;1.使代码整洁,状态容易扩展和管理。<br />&emsp;&emsp;2.可复用。<br />&emsp;&emsp;3.还没想到.....<br />缺点:<br />&emsp;&emsp;1.也没想到......</p><h5 style="margin: 1em 0px 0.5em; padding: 0px; border: 0px; font-family: ff-tisa-web-pro-1, ff-tisa-web-pro-2, 'Lucida Grande', 'Hiragino Sans GB', 'Hiragino Sans GB W3', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-size: 1em; font-weight: lighter; font-stretch: inherit; line-height: 16px; vertical-align: baseline; color: #333333; -webkit-font-smoothing: antialiased">什么是有限状态机?</h5><p style="margin: 0px 0px 1.3em; padding: 0px; border: 0px; font-family: ff-tisa-web-pro-1, ff-tisa-web-pro-2, 'Lucida Grande', 'Hiragino Sans GB', 'Hiragino Sans GB W3', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-size: 16px; font-stretch: inherit; line-height: 1.7em; vertical-align: baseline; color: #666666">&emsp;&emsp;解释不清楚,看了下百度百科。反正是一种数据结构,一个解决问题的工具。<br />&emsp;&emsp;从百度百科可以看到,有限状态机最最最基础的概念有两个:状态和转移。<br />&emsp;&emsp;从刚才跑酷的例子来讲,跑、跳、二段跳等这些就是角色的状态。<br />如图所示:<img style="margin: 0px auto; padding: 0px; border: 0px; font-family: inherit; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; max-width: 100%; border-radius: 3px; text-align: center; display: block" src="http://liangxiegame.com/content/images/2016/05/-----2016-05-08---3-10-32.png" border="0" />&emsp;&emsp;主角从跑状态切换到跳状态,从跳状态切换到二段跳状态,这里的切换就是指状态的转移。状态的转移是有条件的,比如主角从跑状态不可以直接切换到二段跳状态。但是可以从二段跳状态切换到跑状态。<br />&emsp;&emsp;另外,一个基本的状态有:进入状态、退出状态、接收输入、转移状态等动作。但是仅仅作为跑酷的角色的状态管理来说,只需要转移状态就足够了。有兴趣的同学可以自行扩展。</p><h5 style="margin: 1em 0px 0.5em; padding: 0px; border: 0px; font-family: ff-tisa-web-pro-1, ff-tisa-web-pro-2, 'Lucida Grande', 'Hiragino Sans GB', 'Hiragino Sans GB W3', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-size: 1em; font-weight: lighter; font-stretch: inherit; line-height: 16px; vertical-align: baseline; color: #333333; -webkit-font-smoothing: antialiased">如何实现?</h5><p style="margin: 0px 0px 1.3em; padding: 0px; border: 0px; font-family: ff-tisa-web-pro-1, ff-tisa-web-pro-2, 'Lucida Grande', 'Hiragino Sans GB', 'Hiragino Sans GB W3', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-size: 16px; font-stretch: inherit; line-height: 1.7em; vertical-align: baseline; color: #666666">&emsp;&emsp;恰好之前看到过一个还算简易的实现(简易就是指我能看得懂- -,希望大家也是),原版是用lua实现的,我的跑酷游戏是用C#实现的,所以直接贴出C#代码。</p><pre style="margin-top: 0px; margin-bottom: 1.3em; padding: 1em 18.84375px; border: 1px solid #c9e1f6; font-family: Consolas, Menlo, Monaco, 'Lucida Console', 'Liberation Mono', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Courier New', monospace, serif; font-size: 0.9em; font-stretch: inherit; line-height: 1.3em; vertical-align: baseline; border-radius: 3px; overflow: auto; width: 716.609375px; color: #666666; background: #e8f2fb"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">using</span> UnityEngine;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">using</span> System.Collections;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">using</span> System.Collections.Generic;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">public</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">class</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #3e999f" class="hljs-title">FSM</span> &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment">// 定义函数指针类型</span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #4271ae" class="hljs-function"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">public</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">delegate</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">void</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #3e999f" class="hljs-title">FSMTranslationCallfunc</span><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #f5871f" class="hljs-params">()</span></span>;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-xmlDocTag">///</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-xmlDocTag">&lt;summary&gt;</span></span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-xmlDocTag">///</span> 状态类</span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-xmlDocTag">///</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-xmlDocTag">&lt;/summary&gt;</span></span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">public</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">class</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #3e999f" class="hljs-title">FSMState</span>&nbsp;&nbsp;&nbsp;&nbsp; &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">public</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">string</span> name;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #4271ae" class="hljs-function"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">public</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #3e999f" class="hljs-title">FSMState</span><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #f5871f" class="hljs-params">(<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">string</span> name)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>&#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">this</span>.name = name;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-xmlDocTag">///</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-xmlDocTag">&lt;summary&gt;</span></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-xmlDocTag">///</span> 存储事件对应的条转</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-xmlDocTag">///</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-xmlDocTag">&lt;/summary&gt;</span></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">public</span> Dictionary &lt;<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">string</span>,FSMTranslation&gt; TranslationDict = <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">new</span> Dictionary&lt;<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">string</span>,FSMTranslation&gt;();&nbsp;&nbsp;&nbsp;&nbsp; &#125;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-xmlDocTag">///</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-xmlDocTag">&lt;summary&gt;</span></span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-xmlDocTag">///</span> 跳转类</span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-xmlDocTag">///</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-xmlDocTag">&lt;/summary&gt;</span></span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">public</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">class</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #3e999f" class="hljs-title">FSMTranslation</span>&nbsp;&nbsp;&nbsp;&nbsp; &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">public</span> FSMState fromState;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">public</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">string</span> name;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">public</span> FSMState toState;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">public</span> FSMTranslationCallfunc callfunc; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment">// 回调函数</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #4271ae" class="hljs-function"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">public</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #3e999f" class="hljs-title">FSMTranslation</span><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #f5871f" class="hljs-params">(FSMState fromState,<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">string</span> name, FSMState toState,FSMTranslationCallfunc callfunc)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>&#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">this</span>.fromState = fromState;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">this</span>.toState&nbsp;&nbsp; = toState;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">this</span>.name = name;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">this</span>.callfunc = callfunc;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125;&nbsp;&nbsp;&nbsp;&nbsp; &#125;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment">// 当前状态</span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">private</span> FSMState mCurState;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Dictionary &lt;<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">string</span>,FSMState&gt; StateDict = <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">new</span> Dictionary&lt;<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">string</span>,FSMState&gt;();&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-xmlDocTag">///</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-xmlDocTag">&lt;summary&gt;</span></span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-xmlDocTag">///</span> 添加状态</span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-xmlDocTag">///</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-xmlDocTag">&lt;/summary&gt;</span></span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-xmlDocTag">///</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-xmlDocTag">&lt;param name=&quot;state&quot;&gt;</span>State.<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-xmlDocTag">&lt;/param&gt;</span></span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #4271ae" class="hljs-function"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">public</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">void</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #3e999f" class="hljs-title">AddState</span><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #f5871f" class="hljs-params">(FSMState state)</span>&nbsp;&nbsp;&nbsp;&nbsp; </span>&#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; StateDict [state.name] = state;&nbsp;&nbsp;&nbsp;&nbsp; &#125;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-xmlDocTag">///</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-xmlDocTag">&lt;summary&gt;</span></span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-xmlDocTag">///</span> 添加条转</span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-xmlDocTag">///</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-xmlDocTag">&lt;/summary&gt;</span></span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-xmlDocTag">///</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-xmlDocTag">&lt;param name=&quot;translation&quot;&gt;</span>Translation.<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-xmlDocTag">&lt;/param&gt;</span></span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #4271ae" class="hljs-function"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">public</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">void</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #3e999f" class="hljs-title">AddTranslation</span><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #f5871f" class="hljs-params">(FSMTranslation translation)</span>&nbsp;&nbsp;&nbsp;&nbsp; </span>&#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; StateDict [translation.fromState.name].TranslationDict [translation.name] = translation;&nbsp;&nbsp;&nbsp;&nbsp; &#125;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-xmlDocTag">///</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-xmlDocTag">&lt;summary&gt;</span></span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-xmlDocTag">///</span> 启动状态机</span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-xmlDocTag">///</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-xmlDocTag">&lt;/summary&gt;</span></span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-xmlDocTag">///</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-xmlDocTag">&lt;param name=&quot;state&quot;&gt;</span>State.<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-xmlDocTag">&lt;/param&gt;</span></span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #4271ae" class="hljs-function"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">public</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">void</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #3e999f" class="hljs-title">Start</span><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #f5871f" class="hljs-params">(FSMState state)</span>&nbsp;&nbsp;&nbsp;&nbsp; </span>&#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mCurState = state;&nbsp;&nbsp;&nbsp;&nbsp; &#125;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-xmlDocTag">///</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-xmlDocTag">&lt;summary&gt;</span></span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-xmlDocTag">///</span> 处理事件</span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-xmlDocTag">///</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-xmlDocTag">&lt;/summary&gt;</span></span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-xmlDocTag">///</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-xmlDocTag">&lt;param name=&quot;name&quot;&gt;</span>Name.<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-xmlDocTag">&lt;/param&gt;</span></span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #4271ae" class="hljs-function"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">public</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">void</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #3e999f" class="hljs-title">HandleEvent</span><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #f5871f" class="hljs-params">(<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">string</span> name)</span>&nbsp;&nbsp;&nbsp;&nbsp; </span>&#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">if</span> (mCurState != <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">null</span> &amp;&amp; mCurState.TranslationDict.ContainsKey(name)) &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Debug.LogWarning (<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #718c00" class="hljs-string">&quot;fromState:&quot;</span> + mCurState.name);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mCurState.TranslationDict [name].callfunc ();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mCurState = mCurState.TranslationDict [name].toState;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Debug.LogWarning (<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #718c00" class="hljs-string">&quot;toState:&quot;</span> + mCurState.name);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125;&nbsp;&nbsp;&nbsp;&nbsp; &#125; &#125; </pre><p style="margin: 0px 0px 1.3em; padding: 0px; border: 0px; font-family: ff-tisa-web-pro-1, ff-tisa-web-pro-2, 'Lucida Grande', 'Hiragino Sans GB', 'Hiragino Sans GB W3', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-size: 16px; font-stretch: inherit; line-height: 1.7em; vertical-align: baseline; color: #666666">测试代码(需自行修改):</p><pre style="margin-top: 0px; margin-bottom: 1.3em; padding: 1em 18.84375px; border: 1px solid #c9e1f6; font-family: Consolas, Menlo, Monaco, 'Lucida Console', 'Liberation Mono', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Courier New', monospace, serif; font-size: 0.9em; font-stretch: inherit; line-height: 1.3em; vertical-align: baseline; border-radius: 3px; overflow: auto; width: 716.609375px; color: #666666; background: #e8f2fb"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Idle,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 闲置</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Run,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;跑</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Jump,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 一段跳</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DoubleJump,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 二段跳</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Die,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;挂彩</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment">// 创建状态</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FSM.FSMState idleState = <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">new</span> FSM.FSMState(<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #718c00" class="hljs-string">&quot;idle&quot;</span>);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FSM.FSMState runState&nbsp;&nbsp;= <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">new</span> FSM.FSMState(<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #718c00" class="hljs-string">&quot;run&quot;</span>);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FSM.FSMState jumpState = <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">new</span> FSM.FSMState(<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #718c00" class="hljs-string">&quot;jump&quot;</span>);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FSM.FSMState doubleJumpState = <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">new</span> FSM.FSMState(<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #718c00" class="hljs-string">&quot;double_jump&quot;</span>);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FSM.FSMState dieState&nbsp;&nbsp;= <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">new</span> FSM.FSMState(<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #718c00" class="hljs-string">&quot;die&quot;</span>);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment">// 创建跳转</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FSM.FSMTranslation touchTranslation1 = <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">new</span> FSM.FSMTranslation(runState,<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #718c00" class="hljs-string">&quot;touch_down&quot;</span>,jumpState,Jump);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FSM.FSMTranslation touchTranslation2 = <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">new</span> FSM.FSMTranslation(jumpState,<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #718c00" class="hljs-string">&quot;touch_down&quot;</span>,doubleJumpState,DoubleJump);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FSM.FSMTranslation landTranslation1 = <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">new</span> FSM.FSMTranslation(jumpState,<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #718c00" class="hljs-string">&quot;land&quot;</span>,runState,Run);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FSM.FSMTranslation landTranslation2 = <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">new</span> FSM.FSMTranslation(doubleJumpState,<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #718c00" class="hljs-string">&quot;land&quot;</span>,runState,Run);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment">// 添加状态</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PlayerModel.Instance ().fsm.AddState (idleState);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PlayerModel.Instance ().fsm.AddState (runState);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PlayerModel.Instance ().fsm.AddState (jumpState);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PlayerModel.Instance ().fsm.AddState (doubleJumpState);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PlayerModel.Instance ().fsm.AddState (dieState);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment">// 添加跳转</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PlayerModel.Instance ().fsm.AddTranslation (touchTranslation1);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PlayerModel.Instance ().fsm.AddTranslation (touchTranslation2);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PlayerModel.Instance ().fsm.AddTranslation (landTranslation1);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PlayerModel.Instance ().fsm.AddTranslation (landTranslation2);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PlayerModel.Instance ().fsm.Start (runState); </pre><p style="margin: 0px 0px 1.3em; padding: 0px; border: 0px; font-family: ff-tisa-web-pro-1, ff-tisa-web-pro-2, 'Lucida Grande', 'Hiragino Sans GB', 'Hiragino Sans GB W3', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-size: 16px; font-stretch: inherit; line-height: 1.7em; vertical-align: baseline; color: #666666">贴上代码地址址:<a style="margin: 0px; padding: 0px; border: 0px; font-family: inherit; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; text-decoration: none; color: #bf1827" href="https://github.com/liangxiegame/QFramework/blob/master/Script/DesignPattern/QFSM.cs" target="_blank">https://github.com/liangxiegame/QFramework/blob/master/Script/DesignPattern/QFSM.cs</a></p><p style="margin: 0px 0px 1.3em; padding: 0px; border: 0px; font-family: ff-tisa-web-pro-1, ff-tisa-web-pro-2, 'Lucida Grande', 'Hiragino Sans GB', 'Hiragino Sans GB W3', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-size: 16px; font-stretch: inherit; line-height: 1.7em; vertical-align: baseline; color: #666666">&emsp;&emsp;就这些,想要进一步扩展的话,可以给FSMState类添加EnterCallback和ExitCallback等委托,然后在FSM的HandleEvent方法中进行调用。当时对跑酷的项目来说够用了,接没继续扩展了,我好懒- -,懒的借口是:没有最好的设计,只有最适合的设计,233333。</p><p style="margin: 0px 0px 1.3em; padding: 0px; border: 0px; font-family: ff-tisa-web-pro-1, ff-tisa-web-pro-2, 'Lucida Grande', 'Hiragino Sans GB', 'Hiragino Sans GB W3', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-size: 16px; font-stretch: inherit; line-height: 1.7em; vertical-align: baseline; color: #666666">附:<a style="margin: 0px; padding: 0px; border: 0px; font-family: inherit; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; text-decoration: none; color: #bf1827" href="https://github.com/liangxiegame/QFramework" target="_blank">我的框架地址</a><br />转载请注明地址:<a style="margin: 0px; padding: 0px; border: 0px; font-family: inherit; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; text-decoration: none; color: #bf1827" href="http://liangxiegame.com/">凉鞋的笔记</a></p>
]]>
</description>
</item><item>
<link>http://i.renjihe.com/blog/read.php?7365</link>
<title><![CDATA[Unity 游戏框架搭建 (三) MonoBehaviour单例的模板]]></title> 
<author>renjihe1988 &lt;admin@yourname.com&gt;</author>
<category><![CDATA[游戏]]></category>
<pubDate>Thu, 30 Jun 2016 16:06:51 +0000</pubDate> 
<guid>http://i.renjihe.com/blog/read.php?7365</guid> 
<description>
<![CDATA[ 
	http://liangxiegame.com/unity-you-xi-kuang-jia-da-jian-san-monobehaviourdan-li-de-mo-ban/<br /><br /><p style="margin: 0px 0px 1.3em; padding: 0px; border: 0px; font-family: ff-tisa-web-pro-1, ff-tisa-web-pro-2, 'Lucida Grande', 'Hiragino Sans GB', 'Hiragino Sans GB W3', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-size: 16px; font-stretch: inherit; line-height: 1.7em; vertical-align: baseline; color: #666666">上一篇文章讲述了如何设计C#单例的模板。也随之抛出了问题:<br />如何设计接收MonoBehaviour生命周期的单例的模板?<br /></p><h4 style="margin: 1em 0px 0.5em; padding: 0px; border: 0px; font-family: ff-tisa-web-pro-1, ff-tisa-web-pro-2, 'Lucida Grande', 'Hiragino Sans GB', 'Hiragino Sans GB W3', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-size: 1.1em; font-weight: lighter; font-stretch: inherit; line-height: inherit; vertical-align: baseline; color: #333333; -webkit-font-smoothing: antialiased">如何设计?</h4><p style="margin: 0px 0px 1.3em; padding: 0px; border: 0px; font-family: ff-tisa-web-pro-1, ff-tisa-web-pro-2, 'Lucida Grande', 'Hiragino Sans GB', 'Hiragino Sans GB W3', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-size: 16px; font-stretch: inherit; line-height: 1.7em; vertical-align: baseline; color: #666666">先分析下需求:<br />&emsp;&emsp;1.约束脚本实例对象的个数。&nbsp;<br />&emsp;&emsp;2.约束GameObject的个数。&nbsp;<br />&emsp;&emsp;3.接收MonoBehaviour生命周期。<br />&emsp;&emsp;4.销毁单例和对应的GameObject。<br /><br />&emsp;&emsp;首先，第一点,约束脚本实例对象的个数,这个在上一篇中已经实现了。<br />&emsp;&emsp;但是第二点,约束GameObject的个数,这个需求,还没有思路,只好在游戏运行时判断有多少个GameObject已经挂上了该脚本,然后如果个数大于1抛出错误即可。&nbsp;<br />&emsp;&emsp;第三点,通过继承MonoBehaviour实现,只要覆写相应的回调方法即可。 第四点,在脚本销毁时,把静态实例置空。 完整的代码就如下所示:<br /></p><pre style="margin-top: 0px; margin-bottom: 1.3em; padding: 1em 18.84375px; border: 1px solid #c9e1f6; font-family: Consolas, Menlo, Monaco, 'Lucida Console', 'Liberation Mono', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Courier New', monospace, serif; font-size: 0.9em; font-stretch: inherit; line-height: 1.3em; vertical-align: baseline; border-radius: 3px; overflow: auto; width: 716.609375px; color: #666666; background: #e8f2fb"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">using</span> UnityEngine;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment">/// &lt;summary&gt;</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment">/// 需要使用Unity生命周期的单例模式</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment">/// &lt;/summary&gt;</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">namespace</span> QFramework &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">public</span> abstract <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">class</span> QMonoSingleton&lt;T&gt; : MonoBehaviour where T : QMonoSingleton&lt;T&gt;&nbsp;&nbsp;&nbsp;&nbsp; &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">protected</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">static</span> T instance = null;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #4271ae" class="hljs-function"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">public</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">static</span> T <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #3e999f" class="hljs-title">Instance</span><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #f5871f" class="hljs-params">()</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>&#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">if</span> (instance == null)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; instance = FindObjectOfType&lt;T&gt;();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">if</span> (FindObjectsOfType&lt;T&gt;().Length &gt; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #f5871f" class="hljs-number">1</span>)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; QPrint.FrameworkError (<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #718c00" class="hljs-string">&quot;More than 1!&quot;</span>);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">return</span> instance;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">if</span> (instance == null)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #f5871f" class="hljs-built_in">string</span> instanceName = typeof(T).Name;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; QPrint.FrameworkLog (<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #718c00" class="hljs-string">&quot;Instance Name: &quot;</span> + instanceName);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GameObject instanceGO = GameObject.Find(instanceName);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">if</span> (instanceGO == null)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; instanceGO = <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">new</span> GameObject(instanceName);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; instance = instanceGO.AddComponent&lt;T&gt;();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DontDestroyOnLoad(instanceGO);&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment">//保证实例不会被释放</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; QPrint.FrameworkLog (<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #718c00" class="hljs-string">&quot;Add New Singleton &quot;</span> + instance.name + <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #718c00" class="hljs-string">&quot; in Game!&quot;</span>);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">else</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; QPrint.FrameworkLog (<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #718c00" class="hljs-string">&quot;Already exist: &quot;</span> + instance.name);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">return</span> instance;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #4271ae" class="hljs-function"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">protected</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">virtual</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">void</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #3e999f" class="hljs-title">OnDestroy</span><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #f5871f" class="hljs-params">()</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>&#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; instance = null;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125;&nbsp;&nbsp;&nbsp;&nbsp; &#125;&nbsp;&nbsp;&#125; </pre><h4 style="margin: 1em 0px 0.5em; padding: 0px; border: 0px; font-family: ff-tisa-web-pro-1, ff-tisa-web-pro-2, 'Lucida Grande', 'Hiragino Sans GB', 'Hiragino Sans GB W3', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-size: 1.1em; font-weight: lighter; font-stretch: inherit; line-height: inherit; vertical-align: baseline; color: #333333; -webkit-font-smoothing: antialiased">总结:</h4><p style="margin: 0px 0px 1.3em; padding: 0px; border: 0px; font-family: ff-tisa-web-pro-1, ff-tisa-web-pro-2, 'Lucida Grande', 'Hiragino Sans GB', 'Hiragino Sans GB W3', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-size: 16px; font-stretch: inherit; line-height: 1.7em; vertical-align: baseline; color: #666666">&emsp;&emsp;目前已经实现了两种单例的模板,一种是需要接收Unity的生命周期的,一种是不需要接收生命周期的,可以配合着使用。虽然不是本人实现的,但是用起来可是超级爽快,2333。</p>
]]>
</description>
</item><item>
<link>http://i.renjihe.com/blog/read.php?7364</link>
<title><![CDATA[Unity 游戏框架搭建 (二) 单例的模板]]></title> 
<author>renjihe1988 &lt;admin@yourname.com&gt;</author>
<category><![CDATA[游戏]]></category>
<pubDate>Thu, 30 Jun 2016 16:06:24 +0000</pubDate> 
<guid>http://i.renjihe.com/blog/read.php?7364</guid> 
<description>
<![CDATA[ 
	http://liangxiegame.com/unity-you-xi-kuang-jia-da-jian-er-dan-li-de-mo-ban/<br /><br /><p style="margin: 0px 0px 1.3em; padding: 0px; border: 0px; font-family: ff-tisa-web-pro-1, ff-tisa-web-pro-2, 'Lucida Grande', 'Hiragino Sans GB', 'Hiragino Sans GB W3', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-size: 16px; font-stretch: inherit; line-height: 1.7em; vertical-align: baseline; color: #666666">上一篇文章中说到的manager of managers,其中每个manager都是单例的实现,当然也可以使用静态类实现,但是相比于静态类的实现,单例的实现更为通用,可以适用大多数情况。<br /></p><h5 style="margin: 1em 0px 0.5em; padding: 0px; border: 0px; font-family: ff-tisa-web-pro-1, ff-tisa-web-pro-2, 'Lucida Grande', 'Hiragino Sans GB', 'Hiragino Sans GB W3', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-size: 1em; font-weight: lighter; font-stretch: inherit; line-height: 16px; vertical-align: baseline; color: #333333; -webkit-font-smoothing: antialiased">如何设计这个单例的模板?</h5><p style="margin: 0px 0px 1.3em; padding: 0px; border: 0px; font-family: ff-tisa-web-pro-1, ff-tisa-web-pro-2, 'Lucida Grande', 'Hiragino Sans GB', 'Hiragino Sans GB W3', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-size: 16px; font-stretch: inherit; line-height: 1.7em; vertical-align: baseline; color: #666666">&emsp;&emsp;先分析下需求,当设计一个manager时候,我们希望整个程序只有一个该manager对象实例,一般马上能想到的实现是这样的:<br /></p><pre style="margin-top: 0px; margin-bottom: 1.3em; padding: 1em 18.84375px; border: 1px solid #c9e1f6; font-family: Consolas, Menlo, Monaco, 'Lucida Console', 'Liberation Mono', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Courier New', monospace, serif; font-size: 0.9em; font-stretch: inherit; line-height: 1.3em; vertical-align: baseline; border-radius: 3px; overflow: auto; width: 716.609375px; color: #666666; background: #e8f2fb"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">public</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-class"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">class</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #3e999f" class="hljs-title">XXXManager</span> </span>&#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">private</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">static</span> XXXManager instance = <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">null</span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">private</span> XXXManager &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment">// to do ...</span>&nbsp;&nbsp;&nbsp;&nbsp; &#125;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #4271ae" class="hljs-function"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">public</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">static</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #3e999f" class="hljs-title">XXXManager</span><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #f5871f" class="hljs-params">()</span> </span>&#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">if</span> (instance == <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">null</span>)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; instance = <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">new</span> XXXManager();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">return</span> instance;&nbsp;&nbsp;&nbsp;&nbsp; &#125; &#125; </pre><p style="margin: 0px 0px 1.3em; padding: 0px; border: 0px; font-family: ff-tisa-web-pro-1, ff-tisa-web-pro-2, 'Lucida Grande', 'Hiragino Sans GB', 'Hiragino Sans GB W3', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-size: 16px; font-stretch: inherit; line-height: 1.7em; vertical-align: baseline; color: #666666">&emsp;&emsp;如果一个游戏需要10个各种各样的manager,那么以上这些代码要复制粘贴好多遍。重复的代码太多!!!想要把重复的代码抽离出来,怎么办?答案是引入泛型。实现如下:<br /></p><pre style="margin-top: 0px; margin-bottom: 1.3em; padding: 1em 18.84375px; border: 1px solid #c9e1f6; font-family: Consolas, Menlo, Monaco, 'Lucida Console', 'Liberation Mono', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Courier New', monospace, serif; font-size: 0.9em; font-stretch: inherit; line-height: 1.3em; vertical-align: baseline; border-radius: 3px; overflow: auto; width: 716.609375px; color: #666666; background: #e8f2fb"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">using</span> System;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">using</span> System.Collections.Generic;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">using</span> System.Text;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">using</span> System.Reflection;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">namespace</span> QFramework &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">public</span> abstract <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">class</span> QSingleton&lt;T&gt; where T : QSingleton&lt;T&gt;&nbsp;&nbsp;&nbsp;&nbsp; &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">protected</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">static</span> T instance = null;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #4271ae" class="hljs-function"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">protected</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #3e999f" class="hljs-title">QSingleton</span><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #f5871f" class="hljs-params">()</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>&#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #4271ae" class="hljs-function"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">public</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">static</span> T <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #3e999f" class="hljs-title">Instance</span><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #f5871f" class="hljs-params">()</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>&#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">if</span> (instance == null)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment">// 如何new 一个T???</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">return</span> instance;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125;&nbsp;&nbsp;&nbsp;&nbsp; &#125; &#125; </pre><p style="margin: 0px 0px 1.3em; padding: 0px; border: 0px; font-family: ff-tisa-web-pro-1, ff-tisa-web-pro-2, 'Lucida Grande', 'Hiragino Sans GB', 'Hiragino Sans GB W3', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-size: 16px; font-stretch: inherit; line-height: 1.7em; vertical-align: baseline; color: #666666">&emsp;&emsp;为了可以被继承,静态实例和构造方法都使用protect修饰符。以上的问题很显而易见,那就是不能new一个泛型(3月9日补充:并不是不能new一个泛型,参考:<a style="margin: 0px; padding: 0px; border: 0px; font-family: inherit; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; text-decoration: none; color: #bf1827" href="http://bbs.csdn.net/topics/390911693" target="_blank">new一个泛型的实例，编译失败了，为什么?-CSDN论坛-CSDN.NET-中国最大的IT技术社区</a>),(4月5日补充:有同学说可以new一个泛型的实例,不过要求改泛型提供了public的构造函数,好吧,这里不用new的原因是,无法显示调用private的构造函数)。因为泛型本身不是一个类型,那该怎么办呢?答案是使用反射。实现如下:</p><pre style="margin-top: 0px; margin-bottom: 1.3em; padding: 1em 18.84375px; border: 1px solid #c9e1f6; font-family: Consolas, Menlo, Monaco, 'Lucida Console', 'Liberation Mono', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Courier New', monospace, serif; font-size: 0.9em; font-stretch: inherit; line-height: 1.3em; vertical-align: baseline; border-radius: 3px; overflow: auto; width: 716.609375px; color: #666666; background: #e8f2fb"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">using</span> System;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">using</span> System.Collections.Generic;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">using</span> System.Text;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">using</span> System.Reflection;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment">/// &lt;summary&gt;</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment">/// 1.泛型</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment">/// 2.反射</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment">/// 3.抽象类</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment">/// 4.命名空间</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment">/// &lt;/summary&gt;</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">namespace</span> QFramework &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">public</span> abstract <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">class</span> QSingleton&lt;T&gt; where T : QSingleton&lt;T&gt;&nbsp;&nbsp;&nbsp;&nbsp; &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">protected</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">static</span> T instance = null;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #4271ae" class="hljs-function"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">protected</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #3e999f" class="hljs-title">QSingleton</span><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #f5871f" class="hljs-params">()</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>&#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #4271ae" class="hljs-function"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">public</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">static</span> T <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #3e999f" class="hljs-title">Instance</span><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #f5871f" class="hljs-params">()</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>&#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">if</span> (instance == null)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment">// 先获取所有非public的构造方法</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ConstructorInfo[] ctors = typeof(T).GetConstructors(BindingFlags.Instance &#124; BindingFlags.NonPublic);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment">// 从ctors中获取无参的构造方法</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ConstructorInfo ctor = Array.Find(ctors, c =&gt; c.GetParameters().Length == <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #f5871f" class="hljs-number">0</span>);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">if</span> (ctor == null)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">throw</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">new</span> Exception(<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #718c00" class="hljs-string">&quot;Non-public ctor() not found!&quot;</span>);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment">// 调用构造方法</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; instance = ctor.Invoke(null) as T;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">return</span> instance;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125;&nbsp;&nbsp;&nbsp;&nbsp; &#125; &#125; </pre><p style="margin: 0px 0px 1.3em; padding: 0px; border: 0px; font-family: ff-tisa-web-pro-1, ff-tisa-web-pro-2, 'Lucida Grande', 'Hiragino Sans GB', 'Hiragino Sans GB W3', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-size: 16px; font-stretch: inherit; line-height: 1.7em; vertical-align: baseline; color: #666666">以上就是最终实现了。这个实现是在任何C#程序中都是通用的。其测试用例如下所示:<br /></p><pre style="margin-top: 0px; margin-bottom: 1.3em; padding: 1em 18.84375px; border: 1px solid #c9e1f6; font-family: Consolas, Menlo, Monaco, 'Lucida Console', 'Liberation Mono', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Courier New', monospace, serif; font-size: 0.9em; font-stretch: inherit; line-height: 1.3em; vertical-align: baseline; border-radius: 3px; overflow: auto; width: 716.609375px; color: #666666; background: #e8f2fb"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">using</span> QFramework;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment">// 1.需要继承QSingleton。</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment">// 2.需要实现非public的构造方法。</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">public</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">class</span> XXXManager : QSingleton&lt;XXXManager&gt; &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #4271ae" class="hljs-function"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">private</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #3e999f" class="hljs-title">XXXManager</span><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #f5871f" class="hljs-params">()</span> </span>&#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment">// to do ...</span>&nbsp;&nbsp;&nbsp;&nbsp; &#125; &#125;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #4271ae" class="hljs-function"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">public</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">static</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">void</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #3e999f" class="hljs-title">main</span><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #f5871f" class="hljs-params">(<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit" class="hljs-built_in">string</span>[] args)</span>&nbsp;&nbsp; </span>&#123;&nbsp;&nbsp;&nbsp;&nbsp; XXXManager.Instance().xxxyyyzzz(); &#125; </pre><p style="margin: 0px 0px 1.3em; padding: 0px; border: 0px; font-family: ff-tisa-web-pro-1, ff-tisa-web-pro-2, 'Lucida Grande', 'Hiragino Sans GB', 'Hiragino Sans GB W3', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-size: 16px; font-stretch: inherit; line-height: 1.7em; vertical-align: baseline; color: #666666">总结<br />&emsp;&emsp;这个单例的模板是平时用得比较顺手的工具了,其实现是在其他的框架中发现的,拿来直接用了。反射的部分可能会耗一些性能,但是只会执行一次。在Unity中可能会需要继承MonoBehaviour的单例,因为很多游戏可能会只创建一个GameObject,用来获取MonoBehaviour的生命周期,这些内容会再下一讲中介绍:)。&nbsp;<br />附:<a style="margin: 0px; padding: 0px; border: 0px; font-family: inherit; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; text-decoration: none; color: #bf1827" href="https://github.com/liangxiegame/QFramework" target="_blank">我的框架地址</a><br />转载请注明地址:<a style="margin: 0px; padding: 0px; border: 0px; font-family: inherit; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; text-decoration: none; color: #bf1827" href="http://liangxiegame.com/">凉鞋的笔记</a></p>
]]>
</description>
</item><item>
<link>http://i.renjihe.com/blog/read.php?7363</link>
<title><![CDATA[Unity 游戏框架搭建 (一) 概述]]></title> 
<author>renjihe1988 &lt;admin@yourname.com&gt;</author>
<category><![CDATA[游戏]]></category>
<pubDate>Thu, 30 Jun 2016 16:05:42 +0000</pubDate> 
<guid>http://i.renjihe.com/blog/read.php?7363</guid> 
<description>
<![CDATA[ 
	http://liangxiegame.com/unity-you-xi-kuang-jia-da-jian-yi-gai-shu/<br /><br /><br /><p style="margin: 0px 0px 1.3em; padding: 0px; border: 0px; font-family: ff-tisa-web-pro-1, ff-tisa-web-pro-2, 'Lucida Grande', 'Hiragino Sans GB', 'Hiragino Sans GB W3', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-size: 16px; font-stretch: inherit; line-height: 1.7em; vertical-align: baseline; color: #666666">为了重构手头的一款项目,翻出来当时未接触Unity时候收藏的视频<a style="margin: 0px; padding: 0px; border: 0px; font-family: inherit; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; text-decoration: none; color: #bf1827" href="http://v.qq.com/boke/page/d/0/u/d016340mkcu.html" target="_blank">《Unity项目架构设计与开发管理》</a>,对于我这种初学者来说全是干货。简单的总结了一下,以后慢慢提炼。<br />关于Unity的架构有如下几种常用的方式。<br /></p><h5 style="margin: 1em 0px 0.5em; padding: 0px; border: 0px; font-family: ff-tisa-web-pro-1, ff-tisa-web-pro-2, 'Lucida Grande', 'Hiragino Sans GB', 'Hiragino Sans GB W3', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-size: 1em; font-weight: lighter; font-stretch: inherit; line-height: 16px; vertical-align: baseline; color: #333333; -webkit-font-smoothing: antialiased">1.EmptyGO:</h5><p style="margin: 0px 0px 1.3em; padding: 0px; border: 0px; font-family: ff-tisa-web-pro-1, ff-tisa-web-pro-2, 'Lucida Grande', 'Hiragino Sans GB', 'Hiragino Sans GB W3', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-size: 16px; font-stretch: inherit; line-height: 1.7em; vertical-align: baseline; color: #666666">&emsp;&emsp;在Hierarchy上创建一个空的GameObject,然后挂上所有与GameObject无关的逻辑控制的脚本。使用GameObject.Find()访问对象数据。 缺点:逻辑代码散落在各处,不适合大型项目。<br /></p><h5 style="margin: 1em 0px 0.5em; padding: 0px; border: 0px; font-family: ff-tisa-web-pro-1, ff-tisa-web-pro-2, 'Lucida Grande', 'Hiragino Sans GB', 'Hiragino Sans GB W3', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-size: 1em; font-weight: lighter; font-stretch: inherit; line-height: 16px; vertical-align: baseline; color: #333333; -webkit-font-smoothing: antialiased">2.Simple GameManager:</h5><p style="margin: 0px 0px 1.3em; padding: 0px; border: 0px; font-family: ff-tisa-web-pro-1, ff-tisa-web-pro-2, 'Lucida Grande', 'Hiragino Sans GB', 'Hiragino Sans GB W3', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-size: 16px; font-stretch: inherit; line-height: 1.7em; vertical-align: baseline; color: #666666">&emsp;&emsp;所有与GameObject无关的逻辑都放在一个单例中。<br />缺点:单一文件过于庞大。</p><h5 style="margin: 1em 0px 0.5em; padding: 0px; border: 0px; font-family: ff-tisa-web-pro-1, ff-tisa-web-pro-2, 'Lucida Grande', 'Hiragino Sans GB', 'Hiragino Sans GB W3', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-size: 1em; font-weight: lighter; font-stretch: inherit; line-height: 16px; vertical-align: baseline; color: #333333; -webkit-font-smoothing: antialiased">3.Manager Of Managers:</h5><p style="margin: 0px 0px 1.3em; padding: 0px; border: 0px; font-family: ff-tisa-web-pro-1, ff-tisa-web-pro-2, 'Lucida Grande', 'Hiragino Sans GB', 'Hiragino Sans GB W3', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-size: 16px; font-stretch: inherit; line-height: 1.7em; vertical-align: baseline; color: #666666">&emsp;&emsp;将不同的功能单独管理。如下:<br />MainManager: 作为入口管理器。&nbsp;<br />EventManager: 消息管理。&nbsp;<br />GUIManager: 图形视图管理。&nbsp;<br />AudioManager: 音效管理。&nbsp;<br />*PoolManager: go管理（减少动态开辟内存消耗,减少GC)。<br /><br /></p><h6 style="margin: 0px; padding: 0px; border: 0px; font-family: ff-tisa-web-pro-1, ff-tisa-web-pro-2, 'Lucida Grande', 'Hiragino Sans GB', 'Hiragino Sans GB W3', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-size: inherit; font-weight: inherit; font-stretch: inherit; line-height: 16px; vertical-align: baseline; color: #666666">实现一个简单的PoolManager<br /></h6><pre style="margin-top: 0px; margin-bottom: 1.3em; padding: 1em 18.84375px; border: 1px solid #c9e1f6; font-family: Consolas, Menlo, Monaco, 'Lucida Console', 'Liberation Mono', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Courier New', monospace, serif; font-size: 0.9em; font-stretch: inherit; line-height: 1.3em; vertical-align: baseline; border-radius: 3px; overflow: auto; width: 716.609375px; color: #666666; background: #e8f2fb"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment">// 存储动可服用的GameObject。</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">private</span> List&lt;GameObject&gt; dormantObjects = <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">new</span> List&lt;GameObject&gt;();&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment">// 在dormantObjects获取与go类型相同的GameObject,如果没有则new一个。</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #4271ae" class="hljs-function"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">public</span> GameObject <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #3e999f" class="hljs-title">Spawn</span><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #f5871f" class="hljs-params">(GameObject go)</span>&nbsp;&nbsp; </span>&#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GameObject temp = <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">null</span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">if</span> (dormantObjects.Count &gt; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #f5871f" class="hljs-number">0</span>)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">foreach</span> (GameObject dob <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">in</span> dormantObjects)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">if</span> (dob.name == go.name)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment">// Find an available GameObject</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; temp = dob;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dormantObjects.Remove(temp);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">return</span> temp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment">// Now Instantiate a new GameObject.</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;temp = GameObject.Instantialte(go) <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">as</span> GameObject;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;temp.name = go.name;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">return</span> temp; &#125;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment">// 将用完的GameObject放入dormantObjects中</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #4271ae" class="hljs-function"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">public</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">void</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #3e999f" class="hljs-title">Despawn</span><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #f5871f" class="hljs-params">(GameObject go)</span>&nbsp;&nbsp; </span>&#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;go.transform.parent = PoolManager.transform;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;go.SetActive(<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">false</span>);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dormantObject.Add(go);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Trim(); &#125;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8e908c" class="hljs-comment">//FIFO 如果dormantObjects大于最大个数则将之前的GameObject都推出来。</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #4271ae" class="hljs-function"><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">public</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">void</span> <span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #3e999f" class="hljs-title">Trim</span><span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #f5871f" class="hljs-params">()</span>&nbsp;&nbsp; </span>&#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #8959a8" class="hljs-keyword">while</span> (dormantObjects.Count &gt; Capacity)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GameObject dob = dormantObjects[<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #f5871f" class="hljs-number">0</span>];&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dormantObjects.RemoveAt(<span style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; font-family: inherit; color: #f5871f" class="hljs-number">0</span>);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Destroy(dob);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125; &#125; </pre><p style="margin: 0px 0px 1.3em; padding: 0px; border: 0px; font-family: ff-tisa-web-pro-1, ff-tisa-web-pro-2, 'Lucida Grande', 'Hiragino Sans GB', 'Hiragino Sans GB W3', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-size: 16px; font-stretch: inherit; line-height: 1.7em; vertical-align: baseline; color: #666666">缺点:<br />&emsp;&emsp;(1)不能管理prefabs。<br />&emsp;&emsp;(2)没有进行分类。<br /><br />更好的实现方式是将一个PoolManager分成:<br />&emsp;&emsp;若干个 SpawnPool。<br />&emsp;&emsp;每个SpawnPool分成PrefabPool和PoolManager。<br /><br />&emsp;&emsp;PrefabPool负责Prefab的加载和卸载。<br />&emsp;&emsp;PoolManager与之前的PoolMananger功能一样,负责GameObject的Spawn、Despawn和Trim。<br /></p><p style="margin: 0px 0px 1.3em; padding: 0px; border: 0px; font-family: ff-tisa-web-pro-1, ff-tisa-web-pro-2, 'Lucida Grande', 'Hiragino Sans GB', 'Hiragino Sans GB W3', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-size: 16px; font-stretch: inherit; line-height: 1.7em; vertical-align: baseline; color: #666666">要注意的是:<br />&emsp;&emsp;(1)每个SpawnPool是EmeptyGO。<br />&emsp;&emsp;(2)每个PoolManager管理两个List (Active,Deactive)。<br /></p><p style="margin: 0px 0px 1.3em; padding: 0px; border: 0px; font-family: ff-tisa-web-pro-1, ff-tisa-web-pro-2, 'Lucida Grande', 'Hiragino Sans GB', 'Hiragino Sans GB W3', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-size: 16px; font-stretch: inherit; line-height: 1.7em; vertical-align: baseline; color: #666666">讲了一堆,最后告诉有一个NB的插件叫Pool Manager- -。<br /></p><p style="margin: 0px 0px 1.3em; padding: 0px; border: 0px; font-family: ff-tisa-web-pro-1, ff-tisa-web-pro-2, 'Lucida Grande', 'Hiragino Sans GB', 'Hiragino Sans GB W3', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-size: 16px; font-stretch: inherit; line-height: 1.7em; vertical-align: baseline; color: #666666">*LevelManager: 关卡管理。<br />推荐插件:MadLevelManager。<br />GameManager: 游戏管理。&nbsp;<br />&emsp;&emsp;<a style="margin: 0px; padding: 0px; border: 0px; font-family: inherit; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline; text-decoration: none; color: #bf1827" href="http://www.tuicool.com/articles/u6NN7v" target="_blank">C#程序员整理的Unity 3D笔记（十二）：Unity3D之单体模式实现GameManager</a><br />*SaveManager: 配置管理。<br />&emsp;&emsp;实现Resume,功能玩到一半数据临时存储。<br />&emsp;&emsp;推荐SaveManager插件。可以Load、Save均采用二进制(快!!!)<br />&emsp;&emsp;所有C#类型都可以做Serialize。<br />&emsp;&emsp;数据混淆,截屏操作。<br />MenuManager 菜单管理。</p><h5 style="margin: 1em 0px 0.5em; padding: 0px; border: 0px; font-family: ff-tisa-web-pro-1, ff-tisa-web-pro-2, 'Lucida Grande', 'Hiragino Sans GB', 'Hiragino Sans GB W3', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-size: 1em; font-weight: lighter; font-stretch: inherit; line-height: 16px; vertical-align: baseline; color: #333333; -webkit-font-smoothing: antialiased">4.将View和Model之间增加一个媒介层。</h5><p style="margin: 0px 0px 1.3em; padding: 0px; border: 0px; font-family: ff-tisa-web-pro-1, ff-tisa-web-pro-2, 'Lucida Grande', 'Hiragino Sans GB', 'Hiragino Sans GB W3', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-size: 16px; font-stretch: inherit; line-height: 1.7em; vertical-align: baseline; color: #666666">MVCS:StrangeIOC插件。</p><p style="margin: 0px 0px 1.3em; padding: 0px; border: 0px; font-family: ff-tisa-web-pro-1, ff-tisa-web-pro-2, 'Lucida Grande', 'Hiragino Sans GB', 'Hiragino Sans GB W3', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-size: 16px; font-stretch: inherit; line-height: 1.7em; vertical-align: baseline; color: #666666">MVVM:uFrame插件。</p>
]]>
</description>
</item><item>
<link>http://i.renjihe.com/blog/read.php?7362</link>
<title><![CDATA[Get Start StrangeIOC for Unity3D]]></title> 
<author>renjihe1988 &lt;admin@yourname.com&gt;</author>
<category><![CDATA[游戏]]></category>
<pubDate>Thu, 30 Jun 2016 16:05:13 +0000</pubDate> 
<guid>http://i.renjihe.com/blog/read.php?7362</guid> 
<description>
<![CDATA[ 
	http://www.tuicool.com/articles/NJFBv2j<br /><br /><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2000007629395px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">好久没有发blog了，因为只发原创内容，而去年发布的那几篇后来发现随便百度到处都是转载的或者各种网站自动扒的，我觉得既然大家都不尊重这种东西就没必要发上来了！不过由于工作原因最近在看Unity的一个IOC框架:StrangeIOC，官方的文档都不是很好理解，找到了一篇比较好的GetStart文章，顺手翻译一下，一来方便自己加深理解，二来还是想共享出来，没事，随意转吧，拜托注明下出处！&nbsp;<a style="color: #949494; text-decoration: none; transition: 0.25s; outline: none 0px; border-bottom-width: 1px; border-bottom-style: dashed; border-bottom-color: #949494; font-style: italic; font-weight: bold" rel="nofollow,noindex" href="https://coffeebraingames.wordpress.com/2014/03/05/getting-started-with-strange-ioc/" target="_blank">原文在这里</a>&nbsp;(不太清楚有没有被墙)</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2000007629395px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">译文：</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2000007629395px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">Strange是一个Unity3D中用于控制反转的第三方框架,控制反转(IOC-Inversion of Control)思想是类间解耦的一个重要方法,对于我来说,任何解耦技术都值得去学习。什么是IOC？&nbsp;<a style="color: #949494; text-decoration: none; transition: 0.25s; outline: none 0px; border-bottom-width: 1px; border-bottom-style: dashed; border-bottom-color: #949494; font-style: italic; font-weight: bold" rel="nofollow,noindex" href="http://en.wikipedia.org/wiki/Inversion_of_control">这里</a>&nbsp;有详细解答。IOC框架已经在企业级开发和其他非游戏软件的开发中成为了主流，并且可以说已经非常成熟。我觉得它可以帮助游戏开发变得更加容易测试，更好的进行协作开发。我非常想尝试它看看到底可以在游戏开发过程中起到多大的帮助程度。</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2000007629395px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">Strange使用起来真的像他的名字一样，非常&quot;奇怪&quot;。我发现它对于初学者来说，使用起来真的非常&quot;闹心&quot;，比如你想试着去写一个&quot;Hello World&quot;都非常不容易。&nbsp;<a style="color: #949494; text-decoration: none; transition: 0.25s; outline: none 0px; border-bottom-width: 1px; border-bottom-style: dashed; border-bottom-color: #949494; font-style: italic; font-weight: bold" rel="nofollow,noindex" href="http://strangeioc.github.io/strangeioc/TheBigStrangeHowTo.html">这里</a>&nbsp;是StrangeIOC框架的说明页面，但是这上面并没有一个真正意义上的&quot;新手引导&quot;来帮助我们了解Strange的工作机制，这就是你现在看到现在这篇文章的意义-用StrangeIOC框架写一个HelloWorld。</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2000007629395px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">一些提醒：</p><div style="font-size: 16px; line-height: 27.2000007629395px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe"><ul style="padding: 0px; margin: 0px 0px 0.75em 25px; list-style-type: none; line-height: 1.7em"><li style="line-height: 1.7em; list-style-type: disc">在阅读本篇文章之前，最好先去上面提到的官方说明页面了解一下Strange框架的架构(看看它的每个部分的功能以及怎么整合到一块工作的)。</li><li style="line-height: 1.7em; list-style-type: disc">这篇文档使用的是signal(消息)而非event(事件)(因为相比event我更喜欢signal)</li><li style="line-height: 1.7em; list-style-type: disc">我不会把文档中的Unity项目提供出来，因为我希望大家自己动手去做，这样肯定会学到更多:)</li><li style="line-height: 1.7em; list-style-type: disc">这个Hello World示例只是简单的提供注入绑定(injection binding)、命令绑定(command binding)、调解绑定(mediation binding)的示例。</li></ul><strong>Signal</strong></div><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2000007629395px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">建立一个空Unity项目,下载并且解压Strange框架到Assets文件夹中，我们只需要框架的脚本，把&quot;examples&quot;和&quot;.doc&quot;文件夹去除，在Unity的的结构应该是这样的：</p><pre class="prettyprint undefined" style="padding: 0.3em; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; color: #333333; border-radius: 4px; margin-top: 0px; margin-bottom: 1.5em; font-size: 12px; line-height: 1.5em; word-break: break-all; word-wrap: break-word; white-space: pre-wrap; border: 1px solid rgba(0, 0, 0, 0.14902); overflow-y: auto; background-color: #f6f6f6">Assets&nbsp;&nbsp;&nbsp;&nbsp; StrangeIoC&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; scripts</pre><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2000007629395px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">在Assets文件夹下创建&quot;Game&quot;文件夹，即用来创建Hello World示例的文件夹。文件夹的的结构应该是这样的：</p><div style="font-size: 16px; line-height: 27.2000007629395px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe"><pre class="prettyprint undefined" style="padding: 0.3em; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; border-radius: 4px; margin-top: 0px; margin-bottom: 1.5em; font-size: 12px; line-height: 1.5em; word-break: break-all; word-wrap: break-word; white-space: pre-wrap; border: 1px solid rgba(0, 0, 0, 0.14902); overflow-y: auto; background-color: #f6f6f6">Assets&nbsp;&nbsp;&nbsp;&nbsp; Game&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Scenes&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Scripts</pre><p style="margin: 0px 0px 0.75em; line-height: 1.7em; text-indent: 1em">在Scripts文件夹下新建名为HelloWorldSignals.cs的c#脚本，这个类将包含所有用到的signal，让我们coding起来:</p><div style="line-height: 1.7em"><pre class="prettyprint python" style="padding: 0.3em; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; border-radius: 4px; margin-top: 0px; margin-bottom: 1.5em; font-size: 12px; line-height: 1.5em; word-break: break-all; word-wrap: break-word; white-space: pre-wrap; border: 1px solid rgba(0, 0, 0, 0.14902); overflow-y: auto; background-color: #f6f6f6"><span style="color: #0000ff">using</span><span style="color: #000000"> System;&nbsp;&nbsp; </span><span style="color: #0000ff">using</span><span style="color: #000000"> strange.extensions.signal.impl;&nbsp;&nbsp; </span><span style="color: #0000ff">namespace</span><span style="color: #000000"> Game &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #0000ff">public</span> <span style="color: #0000ff"><span style="font-weight: bold; color: #445588" class="class"><span style="color: #333333" class="keyword">class</span></span></span><span style="font-weight: bold; color: #445588" class="class"><span style="color: #000000"> <span style="color: #445588" class="title">StartSignal</span> :</span></span><span style="color: #000000"> Signal &#123;&#125;&nbsp;&nbsp; &#125;</span></pre></div><p style="margin: 0px 0px 0.75em; line-height: 1.7em; text-indent: 1em">在Strange中，这个signal的概念非常像观察者模式(observer pattern)中的事件(events)。在这里，它以命名类的方式实现了继承Strange的Signal类.别急，我们马上会看到怎么去使用它。</p></div><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2000007629395px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">Strange采用&quot;Contexts&quot;的概念来识别不同的问题域或者子模块。在实际的游戏项目中，你可以有多个&quot;Contexts&quot;，比如游戏逻辑、资源、持久层、统计分析、社交模块等等。我们在这个实例中只用了一个&quot;Context&quot;。</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2000007629395px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">一个预构建的context在Strange中称为MVCSContext，MVCSContext默认使用event机制，我们来创建另外一种context父类，改造成使用signal机制，我们其他的context要继承这个SignalContext。</p><div style="font-size: 16px; line-height: 27.2000007629395px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe"><p style="margin: 0px 0px 0.75em; line-height: 1.7em; text-indent: 1em">在Scripts下创建名为SignalContext.cs的脚本:</p><div style="line-height: 1.7em"><pre class="prettyprint cs" style="padding: 0.3em; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; border-radius: 4px; margin-top: 0px; margin-bottom: 1.5em; font-size: 12px; line-height: 1.5em; word-break: break-all; word-wrap: break-word; white-space: pre-wrap; border: 1px solid rgba(0, 0, 0, 0.14902); overflow-y: auto; background-color: #f6f6f6"><span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">using</span></span><span style="color: #000000"> System;&nbsp;&nbsp; </span><span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">using</span></span><span style="color: #000000"> UnityEngine;&nbsp;&nbsp; </span><span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">using</span></span><span style="color: #000000"> strange.extensions.context.impl; </span><span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">using</span></span><span style="color: #000000"> strange.extensions.command.api; </span><span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">using</span></span><span style="color: #000000"> strange.extensions.command.impl; </span><span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">using</span></span><span style="color: #000000"> strange.extensions.signal.impl;&nbsp;&nbsp; </span><span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">namespace</span></span><span style="color: #000000"> Game &#123;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">public</span></span> <span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">class</span></span><span style="color: #000000"> SignalContext : MVCSContext &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #008000"><span style="font-style: italic; color: #999988" class="comment">/*</span></span><span style="font-style: italic; color: #999988" class="comment"><span style="color: #008000">*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* Constructor&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #008000">*/</span></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">public</span></span> SignalContext (MonoBehaviour contextView) : <span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">base</span></span><span style="color: #000000">(contextView) &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">protected</span></span> <span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">override</span></span> <span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">void</span></span><span style="color: #000000"> addCoreComponents() &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">base</span></span><span style="color: #000000">.addCoreComponents();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #008000"><span style="font-style: italic; color: #999988" class="comment">//</span></span><span style="font-style: italic; color: #999988" class="comment"><span style="color: #008000"> bind signal command binder</span></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; injectionBinder.Unbind&lt;ICommandBinder&gt;<span style="color: #000000">();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; injectionBinder.Bind</span>&lt;ICommandBinder&gt;().To&lt;SignalCommandBinder&gt;<span style="color: #000000">().ToSingleton();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">public</span></span> <span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">override</span></span> <span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">void</span></span><span style="color: #000000"> Launch() &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">base</span></span><span style="color: #000000">.Launch();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Signal startSignal </span>= injectionBinder.GetInstance&lt;StartSignal&gt;<span style="color: #000000">();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; startSignal.Dispatch();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125; &#125;</span></pre></div><p style="margin: 0px 0px 0.75em; line-height: 1.7em; text-indent: 1em">在&quot;Scripts&quot;文件夹下创建一个新文件夹&quot;Controller&quot;，到这里有了一点MVC模式的特征。Strange作者建议我们应该以指令类(Command Class)的形式实现各个Controller接口，这个文件夹将包含所有的Command类，现在我们创建一个在StartSignal指令调用时执行的指令。在Controller文件夹下创建名为HelloWorldStartCommand.cs的类：</p><div style="line-height: 1.7em"><pre class="prettyprint python" style="padding: 0.3em; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; border-radius: 4px; margin-top: 0px; margin-bottom: 1.5em; font-size: 12px; line-height: 1.5em; word-break: break-all; word-wrap: break-word; white-space: pre-wrap; border: 1px solid rgba(0, 0, 0, 0.14902); overflow-y: auto; background-color: #f6f6f6"><span style="color: #0000ff">using</span><span style="color: #000000"> System;&nbsp;&nbsp; </span><span style="color: #0000ff">using</span><span style="color: #000000"> UnityEngine;&nbsp;&nbsp; </span><span style="color: #0000ff">using</span><span style="color: #000000"> strange.extensions.context.api; </span><span style="color: #0000ff">using</span><span style="color: #000000"> strange.extensions.command.impl;&nbsp;&nbsp; </span><span style="color: #0000ff">namespace</span><span style="color: #000000"> Game &#123;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #0000ff">public</span> <span style="color: #0000ff"><span style="font-weight: bold; color: #445588" class="class"><span style="color: #333333" class="keyword">class</span></span></span><span style="font-weight: bold; color: #445588" class="class"><span style="color: #000000"> <span style="color: #445588" class="title">HelloWorldStartCommand</span> :</span></span><span style="color: #000000"> Command &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #0000ff">public</span> <span style="color: #0000ff">override</span> <span style="color: #0000ff">void</span><span style="color: #000000"> Execute() &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #008000">//</span><span style="color: #008000"> perform all game start setup here</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Debug.Log(<span style="color: #800000"><span style="color: #dd1144" class="string">&quot;</span></span><span style="color: #dd1144" class="string"><span style="color: #800000">Hello World</span><span style="color: #800000">&quot;</span></span><span style="color: #000000">);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125; &#125;</span></pre></div></div><div style="font-size: 16px; line-height: 27.2000007629395px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe"><p style="margin: 0px 0px 0.75em; line-height: 1.7em; text-indent: 1em">现在我们为这个HelloWorld示例创建一个自定义的context类HelloWorldContext.cs:</p><div style="line-height: 1.7em"><pre class="prettyprint cs" style="padding: 0.3em; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; border-radius: 4px; margin-top: 0px; margin-bottom: 1.5em; font-size: 12px; line-height: 1.5em; word-break: break-all; word-wrap: break-word; white-space: pre-wrap; border: 1px solid rgba(0, 0, 0, 0.14902); overflow-y: auto; background-color: #f6f6f6"><span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">using</span></span><span style="color: #000000"> System;&nbsp;&nbsp; </span><span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">using</span></span><span style="color: #000000"> UnityEngine;&nbsp;&nbsp; </span><span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">using</span></span><span style="color: #000000"> strange.extensions.context.impl;&nbsp;&nbsp; </span><span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">namespace</span></span><span style="color: #000000"> Game &#123;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">public</span></span> <span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">class</span></span><span style="color: #000000"> HelloWorldContext : SignalContext &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #008000"><span style="font-style: italic; color: #999988" class="comment">/*</span></span><span style="font-style: italic; color: #999988" class="comment"><span style="color: #008000">*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* Constructor&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #008000">*/</span></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">public</span></span> HelloWorldContext(MonoBehaviour contextView) : <span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">base</span></span><span style="color: #000000">(contextView) &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">protected</span></span> <span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">override</span></span> <span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">void</span></span><span style="color: #000000"> mapBindings() &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">base</span></span><span style="color: #000000">.mapBindings();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #008000"><span style="font-style: italic; color: #999988" class="comment">//</span></span><span style="font-style: italic; color: #999988" class="comment"><span style="color: #008000"> we bind a command to StartSignal since it is invoked by SignalContext (the parent class) on Launch()</span></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; commandBinder.Bind&lt;StartSignal&gt;().To&lt;HelloWorldStartCommand&gt;<span style="color: #000000">().Once();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125; &#125;</span></pre></div><p style="margin: 0px 0px 0.75em; line-height: 1.7em; text-indent: 1em">在这里，我们把StartSignal类绑定(bind)给了HelloWorldStartCommand类。这样在StartSignal的实例被调用时，HelloWorldStartCommand会进行实例化(instantiated)和执行(executed)，注意在我们的示例中StartSignal信号会在SignalContext.Launch()方法中调用发出。</p></div><div style="font-size: 16px; line-height: 27.2000007629395px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">最后一步就是创建一个MonoBehaviour来在Unity中管理context，在Scripts文件夹下创建HelloWorldBootstrap.cs:<div style="line-height: 1.7em"><pre class="prettyprint python" style="padding: 0.3em; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; border-radius: 4px; margin-top: 0px; margin-bottom: 1.5em; font-size: 12px; line-height: 1.5em; word-break: break-all; word-wrap: break-word; white-space: pre-wrap; border: 1px solid rgba(0, 0, 0, 0.14902); overflow-y: auto; background-color: #f6f6f6"><span style="color: #0000ff">using</span><span style="color: #000000"> System;&nbsp;&nbsp; </span><span style="color: #0000ff">using</span><span style="color: #000000"> UnityEngine;&nbsp;&nbsp; </span><span style="color: #0000ff">using</span><span style="color: #000000"> strange.extensions.context.impl;&nbsp;&nbsp; </span><span style="color: #0000ff">namespace</span><span style="color: #000000"> Game &#123;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #0000ff">public</span> <span style="color: #0000ff"><span style="font-weight: bold; color: #445588" class="class"><span style="color: #333333" class="keyword">class</span></span></span><span style="font-weight: bold; color: #445588" class="class"><span style="color: #000000"> <span style="color: #445588" class="title">HelloWorldBootstrap</span> :</span></span><span style="color: #000000"> ContextView &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #0000ff">void</span><span style="color: #000000"> Awake() &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #0000ff">this</span>.context = <span style="color: #0000ff">new</span> HelloWorldContext(<span style="color: #0000ff">this</span><span style="color: #000000">);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125; &#125;</span></pre></div></div><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2000007629395px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">用于在Unity中管理Strange context的接口类通常命名为&ldquo;xxxBootstrap&rdquo;，当然这只是一个建议，如果你乐意你可以随意起名字。这里唯一需要注意的是继承Strange框架的ContextView类的类需要是一个MonoBehaviour，我们在Awake()里分配了一个我们自定义好的context实例给继承的变量&quot;context&quot;。</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2000007629395px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">创建一个空场景命名为&quot;HelloStrange&quot;，创建一个EmptyObject命名为Bootstrap，把我们之前创建的HelloWorldBootstrap&nbsp;add上来。可以跑一下这个场景，之前程序正确的话，你应该看到控制台的&quot;Hello World&quot;输出了。</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2000007629395px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe"><img style="max-width: 96%; height: auto; vertical-align: middle; border: 0px none; margin: 0px auto 10px; text-align: center; display: block" class="alignCenter" src="http://img1.tuicool.com/uErmUr.jpg!web" border="0" /></p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2000007629395px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe"></p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2000007629395px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">Injection in Mediator</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2000007629395px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">&nbsp;&nbsp;到目前为止写这么一大堆东西只是输出一句&ldquo;HelloWorld&rdquo;，是不是被Strange搞得头都大了？其实做到现在这一步已经大致为你梳理出来Strange的一些机制了。首先我们有了一个能跑的context，从这一步开始，我们就可以添加view和相应的mediator，还可以使用injection binder把一个实例映射到一些可注入controllers/commands和mediators的接口中，而这些接口并不需要关心这个实例是怎么来的。接下来就是见证奇迹的时刻了！</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2000007629395px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">一般我们做游戏编程的时候，会有一堆单例管理器(singleton managers)比如EnemyManager、AsteroidManager、CombatManager等等，假如需要同一个实例给任意一个管理器去调用有很多解决方案，比如我们可以使用GameObject.Find() 或者为这个类添加一个静态单例(GetInstance() static method)，OK,让我们看看有了Strange以后，这样的情形可以怎么去解决：创建一个名为&quot;ISomeManager&quot;的接口，模拟一个上面说的那种manager，在Scripts文件夹创建ISomeManager.cs脚本</p><div style="font-size: 16px; line-height: 27.2000007629395px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe"><div style="line-height: 1.7em"><pre class="prettyprint java" style="padding: 0.3em; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; border-radius: 4px; margin-top: 0px; margin-bottom: 1.5em; font-size: 12px; line-height: 1.5em; word-break: break-all; word-wrap: break-word; white-space: pre-wrap; border: 1px solid rgba(0, 0, 0, 0.14902); overflow-y: auto; background-color: #f6f6f6"><span style="color: #0000ff">namespace</span><span style="color: #000000"> Game &#123;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">public</span></span> <span style="color: #0000ff"><span style="font-weight: bold; color: #445588" class="class"><span style="color: #333333" class="keyword">interface</span></span></span><span style="font-weight: bold; color: #445588" class="class"><span style="color: #000000"> <span style="color: #445588" class="title">ISomeManager</span> &#123;</span></span><span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #008000"><span style="font-style: italic; color: #999988" class="javadoc">/*</span></span><span style="font-style: italic; color: #999988" class="javadoc"><span style="color: #008000">*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* Perform some management&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #008000">*/</span></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">void</span></span><span style="color: #000000"> DoManagement();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125; &#125;</span></pre></div><p style="margin: 0px 0px 0.75em; line-height: 1.7em; text-indent: 1em">这就是我们示例当中的manager接口，注意：Strange的作者建议我们总是使用一个接口然后通过injectionBinder将它映射到一个真正的实现类，当然，你也可以使用多对多的映射。接下来我们创建一个具体实现类，在Scripts文件夹下创建ManagerAsNormalClass.cs脚本：</p><div style="line-height: 1.7em"><pre class="prettyprint python" style="padding: 0.3em; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; border-radius: 4px; margin-top: 0px; margin-bottom: 1.5em; font-size: 12px; line-height: 1.5em; word-break: break-all; word-wrap: break-word; white-space: pre-wrap; border: 1px solid rgba(0, 0, 0, 0.14902); overflow-y: auto; background-color: #f6f6f6"><span style="color: #0000ff">using</span><span style="color: #000000"> System;&nbsp;&nbsp;</span><span style="color: #0000ff">using</span><span style="color: #000000"> UnityEngine;&nbsp;&nbsp;</span><span style="color: #0000ff">namespace</span><span style="color: #000000"> Game &#123;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #0000ff">public</span> <span style="color: #0000ff"><span style="font-weight: bold; color: #445588" class="class"><span style="color: #333333" class="keyword">class</span></span></span><span style="font-weight: bold; color: #445588" class="class"><span style="color: #000000"> <span style="color: #445588" class="title">ManagerAsNormalClass</span> :</span></span><span style="color: #000000"> ISomeManager &#123;&nbsp;&nbsp;<span class="indent">&nbsp;&nbsp;</span></span><span style="color: #0000ff">public</span><span style="color: #000000"> ManagerAsNormalClass() &#123; <span class="indent">&nbsp;&nbsp;</span>&#125;&nbsp;&nbsp;<span class="indent">&nbsp;&nbsp;</span></span><span style="color: #0000ff"><span style="font-style: italic; color: #999988" class="comment">#region</span></span><span style="font-style: italic; color: #999988" class="comment"> ISomeManager implementation</span> <span class="indent">&nbsp;&nbsp;</span><span style="color: #0000ff">public</span> <span style="color: #0000ff">void</span><span style="color: #000000"> DoManagement() &#123; <span class="indent">&nbsp;&nbsp;</span>&nbsp;&nbsp;&nbsp;&nbsp;Debug.Log(</span><span style="color: #800000"><span style="color: #dd1144" class="string">&quot;</span></span><span style="color: #dd1144" class="string"><span style="color: #800000">Manager implemented as a normal class</span><span style="color: #800000">&quot;</span></span><span style="color: #000000">); <span class="indent">&nbsp;&nbsp;</span>&#125; <span class="indent">&nbsp;&nbsp;</span></span><span style="color: #0000ff"><span style="font-style: italic; color: #999988" class="comment">#endregion</span></span><span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125; &#125;</span></pre></div><p style="margin: 0px 0px 0.75em; line-height: 1.7em; text-indent: 1em">如果你仔细在看你可能会发现这是一个没有MonoBehaviour的manager，别急，一会再介绍怎么bind有MonoBehaviour的</p><p style="margin: 0px 0px 0.75em; line-height: 1.7em; text-indent: 1em">现在我们来创建一个简单的交互场景，效果是当一个Button按下时，ISomeManager的DoManagement函数执行，这里我们有一个要求：用MVC思想---对controll层(ISomeManager)和view层(控制Button触发事件的脚本)完全解耦，view层只需要通知controll层:&quot;hey！button被点击了&quot;，至于接下来发生什么交由controll层进行逻辑处理。</p><p style="margin: 0px 0px 0.75em; line-height: 1.7em; text-indent: 1em">现在缺一个view层，把它创建出来吧---在Game文件夹下创建&quot;View&quot;文件夹，创建HelloWorldView.cs脚本:</p><div style="line-height: 1.7em"><pre class="prettyprint cs" style="padding: 0.3em; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; border-radius: 4px; margin-top: 0px; margin-bottom: 1.5em; font-size: 12px; line-height: 1.5em; word-break: break-all; word-wrap: break-word; white-space: pre-wrap; border: 1px solid rgba(0, 0, 0, 0.14902); overflow-y: auto; background-color: #f6f6f6"><span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">using</span></span><span style="color: #000000"> System;&nbsp;&nbsp;</span><span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">using</span></span><span style="color: #000000"> UnityEngine;&nbsp;&nbsp;</span><span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">using</span></span><span style="color: #000000"> strange.extensions.mediation.impl; </span><span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">using</span></span><span style="color: #000000"> strange.extensions.signal.impl;&nbsp;&nbsp;</span><span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">namespace</span></span><span style="color: #000000"> Game &#123; <span class="indent">&nbsp;&nbsp;</span></span><span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">public</span></span> <span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">class</span></span><span style="color: #000000"> HelloWorldView : View &#123;&nbsp;&nbsp;<span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span></span><span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">public</span></span> Signal buttonClicked = <span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">new</span></span><span style="color: #000000"> Signal();&nbsp;&nbsp;<span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span></span><span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">private</span></span> Rect buttonRect = <span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">new</span></span> Rect(<span style="color: #800080"><span style="color: #009999" class="number">0</span></span>, <span style="color: #800080"><span style="color: #009999" class="number">0</span></span>, <span style="color: #800080"><span style="color: #009999" class="number">200</span></span>, <span style="color: #800080"><span style="color: #009999" class="number">50</span></span><span style="color: #000000">);&nbsp;&nbsp;<span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span></span><span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">public</span></span> <span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">void</span></span><span style="color: #000000"> OnGUI() &#123; <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span></span><span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">if</span></span>(GUI.Button(buttonRect, <span style="color: #800000"><span style="color: #dd1144" class="string">&quot;</span></span><span style="color: #dd1144" class="string"><span style="color: #800000">Manage</span><span style="color: #800000">&quot;</span></span><span style="color: #000000">)) &#123; <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span>buttonClicked.Dispatch(); <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span>&#125; <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span>&#125;&nbsp;&nbsp;<span class="indent">&nbsp;&nbsp;</span>&#125; &#125;</span></pre></div><p style="margin: 0px 0px 0.75em; line-height: 1.7em; text-indent: 1em">这里继承的Strange框架中的View类已经包含了MonoBehaviour。所有使用Strange context的View层类都必须继承这个Strange的View类，我们刚刚创建的View类只有一个交互功能：在点击名为&quot;Manage&quot;的Button后，调用一个 generic signal(通用信号) 。</p><p style="margin: 0px 0px 0.75em; line-height: 1.7em; text-indent: 1em">Strange作者建议对每个View创建对应的Mediator。Mediator是一个薄层，他的作用是让与之对应的View和整个程序进行交互。mediation binder的作用是把View映射到它对应的mediator上。所以接下来为View层创建对应的mediator---在&quot;view&quot;文件夹下创建HelloWorldMediator.cs脚本:</p><div style="line-height: 1.7em"><pre class="prettyprint cs" style="padding: 0.3em; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; border-radius: 4px; margin-top: 0px; margin-bottom: 1.5em; font-size: 12px; line-height: 1.5em; word-break: break-all; word-wrap: break-word; white-space: pre-wrap; border: 1px solid rgba(0, 0, 0, 0.14902); overflow-y: auto; background-color: #f6f6f6"><span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">using</span></span><span style="color: #000000"> System;&nbsp;&nbsp;</span><span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">using</span></span><span style="color: #000000"> UnityEngine;&nbsp;&nbsp;</span><span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">using</span></span><span style="color: #000000"> strange.extensions.mediation.impl;&nbsp;&nbsp;</span><span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">namespace</span></span><span style="color: #000000"> Game &#123;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">public</span></span> <span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">class</span></span><span style="color: #000000"> HelloWorldMediator : Mediator &#123;&nbsp;&nbsp;<span class="indent">&nbsp;&nbsp;</span>[Inject] <span class="indent">&nbsp;&nbsp;</span></span><span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">public</span></span> HelloWorldView view &#123;<span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">get</span></span>; <span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">set</span></span><span style="color: #000000">;&#125;&nbsp;&nbsp;<span class="indent">&nbsp;&nbsp;</span>[Inject] <span class="indent">&nbsp;&nbsp;</span></span><span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">public</span></span> ISomeManager manager &#123;<span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">get</span></span>; <span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">set</span></span><span style="color: #000000">;&#125;&nbsp;&nbsp;<span class="indent">&nbsp;&nbsp;</span></span><span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">public</span></span> <span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">override</span></span> <span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">void</span></span><span style="color: #000000"> OnRegister() &#123; <span class="indent">&nbsp;&nbsp;</span>&nbsp;&nbsp;&nbsp;&nbsp;view.buttonClicked.AddListener(</span><span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">delegate</span></span><span style="color: #000000">() &#123; <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span>manager.DoManagement(); <span class="indent">&nbsp;&nbsp;</span>&nbsp;&nbsp;&nbsp;&nbsp;&#125;); <span class="indent">&nbsp;&nbsp;</span>&#125;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125; &#125;</span></pre></div><p style="margin: 0px 0px 0.75em; line-height: 1.7em; text-indent: 1em">在这段代码里我们可以看到神奇的&quot;Inject&quot;标注(Inject attribute)。这个&quot;Inject&quot;标注只能和变量搭配使用，当一个变量上面有&quot;Inject&quot;标注时，意味着Strange会把这个变量的一个实例自动注入到它对应映射的context中。据此从我们上面的代码来分析，在这里我们获取到了&quot;view&quot;和&quot;manager&quot;的实例，并且不用去关心这些个实例是怎么来的。</p><p style="margin: 0px 0px 0.75em; line-height: 1.7em; text-indent: 1em">OnRegister()是一个可以被重写的方法，它用来标记实例注入完成已经可以使用了，它的意义主要是进行初始化，或者说做准备。在上面的类中，OnRegister方法中为HellowWorldView.buttonClicked signal添加了一个监听器，这个监听器的逻辑是按下就执行manager.DoManagement方法。</p></div><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2000007629395px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">接下来就是最后的工作，我们需要把待绑的类映射到Strange Context中。打开我们之前写的HelloWorldContext脚本，在mapBindings()方法中添加代码:</p><div style="font-size: 16px; line-height: 27.2000007629395px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe"><pre class="prettyprint xml" style="padding: 0.3em; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; border-radius: 4px; margin-top: 0px; margin-bottom: 1.5em; font-size: 12px; line-height: 1.5em; word-break: break-all; word-wrap: break-word; white-space: pre-wrap; border: 1px solid rgba(0, 0, 0, 0.14902); overflow-y: auto; background-color: #f6f6f6"><span style="color: #0000ff">protected</span> <span style="color: #0000ff">override</span> <span style="color: #0000ff">void</span><span style="color: #000000"> mapBindings() &#123; <span class="indent">&nbsp;&nbsp;</span> </span><span style="color: #0000ff">base</span><span style="color: #000000">.mapBindings();&nbsp;&nbsp; <span class="indent">&nbsp;&nbsp;</span> </span><span style="color: #008000">//</span><span style="color: #008000"> we bind a command to StartSignal since it is invoked by SignalContext (the parent class) during on Launch()</span> <span class="indent">&nbsp;&nbsp;</span> commandBinder.Bind<span style="color: #000080" class="tag">&lt;<span class="title">StartSignal</span>&gt;</span>().To<span style="color: #000080" class="tag">&lt;<span class="title">HelloWorldStartCommand</span>&gt;</span><span style="color: #000000">().Once();&nbsp;&nbsp; <span class="indent">&nbsp;&nbsp;</span> </span><span style="color: #008000">//</span><span style="color: #008000"> bind our view to its mediator</span> <span class="indent">&nbsp;&nbsp;</span> mediationBinder.Bind<span style="color: #000080" class="tag">&lt;<span class="title">HelloWorldView</span>&gt;</span>().To<span style="color: #000080" class="tag">&lt;<span class="title">HelloWorldMediator</span>&gt;</span><span style="color: #000000">();&nbsp;&nbsp; <span class="indent">&nbsp;&nbsp;</span> </span><span style="color: #008000">//</span><span style="color: #008000"> bind our interface to a concrete implementation</span> <span class="indent">&nbsp;&nbsp;</span> injectionBinder.Bind<span style="color: #000080" class="tag">&lt;<span class="title">ISomeManager</span>&gt;</span>().To<span style="color: #000080" class="tag">&lt;<span class="title">ManagerAsNormalClass</span>&gt;</span><span style="color: #000000">().ToSingleton(); &#125;</span></pre></div><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2000007629395px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">在HelloWorld scene中，添加一个名为&quot;View&quot;的GameObject，add&nbsp;HelloWorldView 脚本，运行场景，你应该能看到当我们按下&quot;Manage&quot;按钮时，控制台输出&quot;Manager implemented as a normal class&quot;。</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2000007629395px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe"><img style="max-width: 96%; height: 237.199312714777px; vertical-align: middle; border: 0px none; margin: 0px auto; text-align: center; width: 550px; display: block" src="https://coffeebraingames.files.wordpress.com/2014/03/3-5-2014a.png?w=620" border="0" alt="ISomeManager in action" /></p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2000007629395px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">你会发现Strange自动把HelloWorldMediator脚本挂载到了&quot;View&quot;GameObject上面。注意我们之前并没有手动把HelloWorldMediator脚本挂载到&quot;View&quot;GameObject上。</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2000007629395px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe"><img style="max-width: 96%; height: auto; vertical-align: middle; border: 0px none; margin: 0px auto; text-align: center; display: block" src="https://coffeebraingames.files.wordpress.com/2014/03/3-5-2014b.png?w=620" border="0" alt="Where did the mediator came from?" /></p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2000007629395px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe"></p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2000007629395px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">MonoBehaviour Manager</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2000007629395px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">大部分时候，我们需要类似于上面的manager但是实现类是一个MonoBehaviour，这样我们才能使用例如协程、序列化的Unity特性。</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2000007629395px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">接下来创建实现MonoBehaviour接口的manager实例，看看怎么在Strange中进行bind。</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2000007629395px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">创建一个实现MonoBehaviour接口的manager，在Script文件夹下，命名为ManagerAsMonobehaviour.cs</p><div style="font-size: 16px; line-height: 27.2000007629395px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe"><pre class="prettyprint python" style="padding: 0.3em; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; border-radius: 4px; margin-top: 0px; margin-bottom: 1.5em; font-size: 12px; line-height: 1.5em; word-break: break-all; word-wrap: break-word; white-space: pre-wrap; border: 1px solid rgba(0, 0, 0, 0.14902); overflow-y: auto; background-color: #f6f6f6"><span style="color: #0000ff">using</span><span style="color: #000000"> System;&nbsp;&nbsp; </span><span style="color: #0000ff">using</span><span style="color: #000000"> UnityEngine;&nbsp;&nbsp; </span><span style="color: #0000ff">namespace</span><span style="color: #000000"> Game &#123; <span class="indent">&nbsp;&nbsp;</span></span><span style="color: #0000ff">public</span> <span style="color: #0000ff"><span style="font-weight: bold; color: #445588" class="class"><span style="color: #333333" class="keyword">class</span></span></span><span style="font-weight: bold; color: #445588" class="class"><span style="color: #000000"> <span style="color: #445588" class="title">ManagerAsMonoBehaviour</span> :</span></span><span style="color: #000000"> MonoBehaviour, ISomeManager &#123;&nbsp;&nbsp; <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span></span><span style="color: #0000ff"><span style="font-style: italic; color: #999988" class="comment">#region</span></span><span style="font-style: italic; color: #999988" class="comment"> ISomeManager implementation</span> <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span style="color: #0000ff">public</span> <span style="color: #0000ff">void</span><span style="color: #000000"> DoManagement() &#123; <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span>Debug.Log(</span><span style="color: #800000"><span style="color: #dd1144" class="string">&quot;</span></span><span style="color: #dd1144" class="string"><span style="color: #800000">Manager implemented as MonoBehaviour</span><span style="color: #800000">&quot;</span></span><span style="color: #000000">); <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span>&#125; <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span></span><span style="color: #0000ff"><span style="font-style: italic; color: #999988" class="comment">#endregion</span></span><span style="color: #000000">&nbsp;&nbsp; <span class="indent">&nbsp;&nbsp;</span>&#125; &#125;</span></pre>&nbsp; 在HelloStrangeScene中，创建一个新的GameObject名为&quot;Manager&quot;，add 上面创建好的 ManagerAsMonobehaviour脚本</div><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2000007629395px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">编辑HelloWorldContext脚本的mapBindings()方法:</p><div style="font-size: 16px; line-height: 27.2000007629395px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe"><pre class="prettyprint xml" style="padding: 0.3em; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; border-radius: 4px; margin-top: 0px; margin-bottom: 1.5em; font-size: 12px; line-height: 1.5em; word-break: break-all; word-wrap: break-word; white-space: pre-wrap; border: 1px solid rgba(0, 0, 0, 0.14902); overflow-y: auto; background-color: #f6f6f6"><span style="color: #0000ff">protected</span> <span style="color: #0000ff">override</span> <span style="color: #0000ff">void</span><span style="color: #000000"> mapBindings() &#123; <span class="indent">&nbsp;&nbsp;</span> </span><span style="color: #0000ff">base</span><span style="color: #000000">.mapBindings();&nbsp;&nbsp; <span class="indent">&nbsp;&nbsp;</span> </span><span style="color: #008000">//</span><span style="color: #008000"> we bind a command to StartSignal since it is invoked by SignalContext (the parent class) during on Launch()</span> <span class="indent">&nbsp;&nbsp;</span> commandBinder.Bind<span style="color: #000080" class="tag">&lt;<span class="title">StartSignal</span>&gt;</span>().To<span style="color: #000080" class="tag">&lt;<span class="title">HelloWorldStartCommand</span>&gt;</span><span style="color: #000000">().Once();&nbsp;&nbsp; <span class="indent">&nbsp;&nbsp;</span> </span><span style="color: #008000">//</span><span style="color: #008000"> bind our view to its mediator</span> <span class="indent">&nbsp;&nbsp;</span> mediationBinder.Bind<span style="color: #000080" class="tag">&lt;<span class="title">HelloWorldView</span>&gt;</span>().To<span style="color: #000080" class="tag">&lt;<span class="title">HelloWorldMediator</span>&gt;</span><span style="color: #000000">();&nbsp;&nbsp; <span class="indent">&nbsp;&nbsp;</span> </span><span style="color: #008000">//</span><span style="color: #008000"> REMOVED!!! <span class="indent">&nbsp;&nbsp;</span> </span><span style="color: #008000">//</span><span style="color: #008000">injectionBinder.Bind<span style="color: #000080" class="tag">&lt;<span class="title">ISomeManager</span>&gt;</span>().To<span style="color: #000080" class="tag">&lt;<span class="title">ManagerAsNormalClass</span>&gt;</span>().ToSingleton();&nbsp;&nbsp; <span class="indent">&nbsp;&nbsp;</span> </span><span style="color: #008000">//</span><span style="color: #008000"> bind the manager implemented as a MonoBehaviour</span> <span class="indent">&nbsp;&nbsp;</span> ManagerAsMonoBehaviour manager = GameObject.Find(<span style="color: #800000">&quot;</span><span style="color: #800000">Manager</span><span style="color: #800000">&quot;</span>).GetComponent<span style="color: #000080" class="tag">&lt;<span class="title">ManagerAsMonoBehaviour</span>&gt;</span><span style="color: #000000">(); <span class="indent">&nbsp;&nbsp;</span> injectionBinder.Bind</span><span style="color: #000080" class="tag">&lt;<span class="title">ISomeManager</span>&gt;</span><span style="color: #000000">().ToValue(manager); &#125;</span></pre>与把ISomeManager映射为一个类型相反，我们把这个ManagerAsMonobehaviour映射为一个实例值(instance value)。</div><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2000007629395px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe"><img style="max-width: 96%; height: auto; vertical-align: middle; border: 0px none; margin: 0px auto; text-align: center; display: block" src="https://coffeebraingames.files.wordpress.com/2014/03/3-5-2014c.png?w=620" border="0" alt="Manager is now a MonoBehaviour" /></p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2000007629395px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe"></p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2000007629395px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe"><strong style="text-indent: 0px">Injection in Command</strong></p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2000007629395px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">到目前为止我们为HelloWorldMediator注入了一个ISomeManager的一个实例，并且可以直接使用它。这样做其实并不是很理想，一个Mediator应该是在view层和controller层之间的一个薄层。我们需要尽量使Mediator层不去关心应该在Manager类去做的那部分复杂的逻辑处理代码。虽然这么做也可以，我们还是用signal把这部分映射到command层吧。</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2000007629395px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">编辑HelloWorldSignals.cs脚本，添加一个DoManagementSignal:</p><div style="font-size: 16px; line-height: 27.2000007629395px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe"><pre class="prettyprint python" style="padding: 0.3em; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; border-radius: 4px; margin-top: 0px; margin-bottom: 1.5em; font-size: 12px; line-height: 1.5em; word-break: break-all; word-wrap: break-word; white-space: pre-wrap; border: 1px solid rgba(0, 0, 0, 0.14902); overflow-y: auto; background-color: #f6f6f6"><span style="color: #0000ff">using</span><span style="color: #000000"> System;&nbsp;&nbsp; </span><span style="color: #0000ff">using</span><span style="color: #000000"> strange.extensions.signal.impl;&nbsp;&nbsp; </span><span style="color: #0000ff">namespace</span><span style="color: #000000"> Game &#123;&nbsp;&nbsp; <span class="indent">&nbsp;&nbsp;</span> </span><span style="color: #0000ff">public</span> <span style="color: #0000ff"><span style="font-weight: bold; color: #445588" class="class"><span style="color: #333333" class="keyword">class</span></span></span><span style="font-weight: bold; color: #445588" class="class"><span style="color: #000000"> <span style="color: #445588" class="title">StartSignal</span> :</span></span><span style="color: #000000"> Signal &#123;&#125;&nbsp;&nbsp; <span class="indent">&nbsp;&nbsp;</span> </span><span style="color: #0000ff">public</span> <span style="color: #0000ff"><span style="font-weight: bold; color: #445588" class="class"><span style="color: #333333" class="keyword">class</span></span></span><span style="font-weight: bold; color: #445588" class="class"> <span class="title">DoManagementSignal</span> :</span> Signal &#123;&#125; <span style="color: #008000">//</span><span style="color: #008000"> A new signal!</span> <span style="color: #000000">&nbsp;&nbsp;&#125;</span></pre>&nbsp; 我们创建command映射到signal:在Controller文件夹下创建一个脚本DoManagementCommand.cs</div><div style="font-size: 16px; line-height: 27.2000007629395px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe"><pre class="prettyprint cs" style="padding: 0.3em; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; border-radius: 4px; margin-top: 0px; margin-bottom: 1.5em; font-size: 12px; line-height: 1.5em; word-break: break-all; word-wrap: break-word; white-space: pre-wrap; border: 1px solid rgba(0, 0, 0, 0.14902); overflow-y: auto; background-color: #f6f6f6"><span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">using</span></span><span style="color: #000000"> System;&nbsp;&nbsp; </span><span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">using</span></span><span style="color: #000000"> UnityEngine;&nbsp;&nbsp; </span><span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">using</span></span><span style="color: #000000"> strange.extensions.context.api; </span><span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">using</span></span><span style="color: #000000"> strange.extensions.command.impl;&nbsp;&nbsp; </span><span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">namespace</span></span><span style="color: #000000"> Game &#123;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">public</span></span> <span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">class</span></span><span style="color: #000000"> DoManagementCommand : Command &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [Inject]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">public</span></span> ISomeManager manager &#123;<span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">get</span></span>; <span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">set</span></span><span style="color: #000000">;&#125;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">public</span></span> <span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">override</span></span> <span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">void</span></span><span style="color: #000000"> Execute() &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; manager.DoManagement();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125; &#125;</span></pre>在这个类，我们把ISomeManager注入到command类，并且在Execute方法中让它的DoManagement方法执行。</div><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2000007629395px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">修改HelloWorldMediator类:</p><div style="font-size: 16px; line-height: 27.2000007629395px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe"><pre class="prettyprint cs" style="padding: 0.3em; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; border-radius: 4px; margin-top: 0px; margin-bottom: 1.5em; font-size: 12px; line-height: 1.5em; word-break: break-all; word-wrap: break-word; white-space: pre-wrap; border: 1px solid rgba(0, 0, 0, 0.14902); overflow-y: auto; background-color: #f6f6f6"><span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">using</span></span><span style="color: #000000"> System;&nbsp;&nbsp; </span><span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">using</span></span><span style="color: #000000"> UnityEngine;&nbsp;&nbsp; </span><span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">using</span></span><span style="color: #000000"> strange.extensions.mediation.impl;&nbsp;&nbsp; </span><span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">namespace</span></span><span style="color: #000000"> Game &#123;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">public</span></span> <span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">class</span></span><span style="color: #000000"> HelloWorldMediator : Mediator &#123;&nbsp;&nbsp; <span class="indent">&nbsp;&nbsp;</span> [Inject] <span class="indent">&nbsp;&nbsp;</span> </span><span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">public</span></span> HelloWorldView view &#123;<span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">get</span></span>; <span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">set</span></span><span style="color: #000000">;&#125;&nbsp;&nbsp; <span class="indent">&nbsp;&nbsp;</span> [Inject] <span class="indent">&nbsp;&nbsp;</span> </span><span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">public</span></span> DoManagementSignal doManagement &#123;<span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">get</span></span>; <span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">set</span></span><span style="color: #000000">;&#125;&nbsp;&nbsp; <span class="indent">&nbsp;&nbsp;</span> </span><span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">public</span></span> <span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">override</span></span> <span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">void</span></span><span style="color: #000000"> OnRegister() &#123; <span class="indent">&nbsp;&nbsp;</span>&nbsp;&nbsp;&nbsp;&nbsp; view.buttonClicked.AddListener(doManagement.Dispatch); <span class="indent">&nbsp;&nbsp;</span> &#125;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125; &#125;</span></pre>现在我们的mediator类中已经没有任何对ISomeManager接口的调用了。取而代之的是要在mediator类获取到DoManagementSignal的实例，当button点击时，这个类会发出DoManagementSignal。mediator层不需要知道任何manager的事情，它只管发送信号(signal)出去。</div><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2000007629395px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">最后，在HelloWorldContext.mapBindings()方法中添加这个signal-command映射。</p><div style="font-size: 16px; line-height: 27.2000007629395px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe"><pre class="prettyprint xml" style="padding: 0.3em; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; border-radius: 4px; margin-top: 0px; margin-bottom: 1.5em; font-size: 12px; line-height: 1.5em; word-break: break-all; word-wrap: break-word; white-space: pre-wrap; border: 1px solid rgba(0, 0, 0, 0.14902); overflow-y: auto; background-color: #f6f6f6"><span style="color: #0000ff">protected</span> <span style="color: #0000ff">override</span> <span style="color: #0000ff">void</span><span style="color: #000000"> mapBindings() &#123; <span class="indent">&nbsp;&nbsp;</span> </span><span style="color: #0000ff">base</span><span style="color: #000000">.mapBindings();&nbsp;&nbsp; <span class="indent">&nbsp;&nbsp;</span> </span><span style="color: #008000">//</span><span style="color: #008000"> we bind a command to StartSignal since it is invoked by SignalContext (the parent class) during on Launch()</span> <span class="indent">&nbsp;&nbsp;</span> commandBinder.Bind<span style="color: #000080" class="tag">&lt;<span class="title">StartSignal</span>&gt;</span>().To<span style="color: #000080" class="tag">&lt;<span class="title">HelloWorldStartCommand</span>&gt;</span><span style="color: #000000">().Once(); <span class="indent">&nbsp;&nbsp;</span> commandBinder.Bind</span><span style="color: #000080" class="tag">&lt;<span class="title">DoManagementSignal</span>&gt;</span>().To<span style="color: #000080" class="tag">&lt;<span class="title">DoManagementCommand</span>&gt;</span>().Pooled(); <span style="color: #008000">//</span><span style="color: #008000"> THIS IS THE NEW MAPPING!!!&nbsp;&nbsp; <span class="indent">&nbsp;&nbsp;</span> </span><span style="color: #008000">//</span><span style="color: #008000"> bind our view to its mediator</span> <span class="indent">&nbsp;&nbsp;</span> mediationBinder.Bind<span style="color: #000080" class="tag">&lt;<span class="title">HelloWorldView</span>&gt;</span>().To<span style="color: #000080" class="tag">&lt;<span class="title">HelloWorldMediator</span>&gt;</span><span style="color: #000000">();&nbsp;&nbsp; <span class="indent">&nbsp;&nbsp;</span> </span><span style="color: #008000">//</span><span style="color: #008000"> bind the manager implemented as a MonoBehaviour</span> <span class="indent">&nbsp;&nbsp;</span> ManagerAsMonoBehaviour manager = GameObject.Find(<span style="color: #800000">&quot;</span><span style="color: #800000">Manager</span><span style="color: #800000">&quot;</span>).GetComponent<span style="color: #000080" class="tag">&lt;<span class="title">ManagerAsMonoBehaviour</span>&gt;</span><span style="color: #000000">(); <span class="indent">&nbsp;&nbsp;</span> injectionBinder.Bind</span><span style="color: #000080" class="tag">&lt;<span class="title">ISomeManager</span>&gt;</span><span style="color: #000000">().ToValue(manager); &#125;</span></pre>运行场景，效果和之前一样，但是我们在代码层面把这块代码重构了。</div><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2000007629395px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe"></p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2000007629395px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">最后</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2000007629395px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">你会注意到这篇文章动不动就提到&quot;作者建议&quot;这样的话，这是因为作者的建议确实是一个比较重要的选择。比如说你可以在你的view层中直接注入各种实例，可能你压根不想去创建什么mediator层！我想说的是你可以根据你的实际需要来决定使用Strange的方法，但是我选择了根据作者的建议来使用它因为对于我来说这样还不错。</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2000007629395px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">如果你把这篇文章看到了这里，你可能会很疑惑:&quot;我为什么要在我的项目里搞这么多复杂又多余的层？&quot;其实在我自己的项目中应用这个框架也是处于探索研究阶段，现在的感受Strange有一个好处是强行让我把每个模块划分了。比如这样一个情形:用Strange Context处理SimpleSQL数据持久化，对于现有的游戏逻辑代码，没有使用Strange的部分，他们间的通信通过signal来进行。</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2000007629395px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">我们还在另外一个RPG项目用了Strange，我希望用了它以后可以像它的口号一样，确实有助于代码间的协作。到目前来看我没法跟你宣称它在我的项目中有多好，因为我们也只是在起步阶段，但是至少到目前为止对于我们来说它工作的还不错。我们的模式是使用多个Context，一个程序员负责一个Context，然后通过signal来与其他人的Context通信。</p>
]]>
</description>
</item><item>
<link>http://i.renjihe.com/blog/read.php?7358</link>
<title><![CDATA[六角网格的实现]]></title> 
<author>renjihe1988 &lt;admin@yourname.com&gt;</author>
<category><![CDATA[游戏]]></category>
<pubDate>Wed, 29 Jun 2016 13:09:24 +0000</pubDate> 
<guid>http://i.renjihe.com/blog/read.php?7358</guid> 
<description>
<![CDATA[ 
	<div>http://www-cs-students.stanford.edu/~amitp/gameprog.html</div><div>http://theory.stanford.edu/~amitp/GameProgramming/</div><div><br /></div><div>http://www.indienova.com/indie-game-development/grid-implementation-of-hex/<br /><br /><h4 style="box-sizing: border-box; font-family: Raleway, sans-serif; line-height: 1.5; color: #444444; margin: 0px 0px 20px; font-size: 18px; padding-top: 0px; padding-bottom: 15px; border-bottom-width: 1px; border-bottom-style: dotted; border-bottom-color: #0088cc; background-color: #f4f4f4">引言</h4><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">Amit 潜心研究六角网格系统多年，本文是其系列教程中的一篇，探讨了具体如何实现六角网格系统。<br />文本需要参考作者的另外一篇文章《六角网格大观》(<a style="box-sizing: border-box; color: #0088cc; text-decoration: none !important; background-color: transparent" href="http://www.indienova.com/indie-game-development/hex-grids-reference/">indienova译文版</a>)来阅读。</p><h4 style="box-sizing: border-box; font-family: Raleway, sans-serif; line-height: 1.5; color: #444444; margin: 0px 0px 20px; font-size: 18px; padding-top: 30px; padding-bottom: 15px; border-bottom-width: 1px; border-bottom-style: dotted; border-bottom-color: #0088cc; background-color: #f4f4f4">概述</h4><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">我在<a style="box-sizing: border-box; color: #0088cc; text-decoration: none !important; background-color: transparent" href="http://www.indienova.com/indie-game-development/game-programming-grids/">《网格沉思》</a>与<a style="box-sizing: border-box; color: #0088cc; text-decoration: none !important; background-color: transparent" href="http://www.indienova.com/indie-game-development/hex-grids-reference/">《六角网格大观》</a>等文章中描述了实现六角网格系统的数学基础与算法，这里就让我们基于它们实现一个可用的六角网格系统库文件。我们首先需要考虑的是这个库需要哪些核心内容：</p><ul style="box-sizing: border-box; margin: 0px 0px 30px; padding: 0px 0px 0px 40px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; line-height: 24px; background-color: #f4f4f4"><li style="box-sizing: border-box; margin: 0px; padding: 0px">由于许多算法都基于立方坐标，因此我需要为其建立一个数据结构，这样就能以它为基础实现这些算法。我将这个类命名为 Hex。</li><li style="box-sizing: border-box; margin: 0px; padding: 0px">某些游戏需要向玩家显示坐标，但并非显示立方坐标，而是轴坐标或偏移坐标，因此我们还需要为玩家可见的坐标系统建立一个数据结构，并且编写用于在两种坐标间相互转换的函数。立方坐标与轴坐标本质上没有区别，因此我不会为其单独建立新的坐标系统，还是继续使用 Hex 类。但我会为偏移坐标建立单独的数据结构 Offest。</li><li style="box-sizing: border-box; margin: 0px; padding: 0px">网格地图中还需要存储一些额外的信息，诸如地形，对象，单元等等。用2维数列是可行之策，但有时这样会稍显不直观，因此我创建了 Map 类专门负责此项任务。</li><li style="box-sizing: border-box; margin: 0px; padding: 0px">为了向屏幕绘制六边形，我需要将网格坐标转换为屏幕坐标的方法。为此需要创建 Layout 类。在六角网格大观中没有涵盖某些内容：<p style="box-sizing: border-box; margin: 0px 0px 15px"></p><ul style="box-sizing: border-box; margin: 0px; padding: 0px 0px 0px 40px"><li style="box-sizing: border-box; margin: 0px; padding: 0px">既支持 y 轴朝上的坐标系(在 3d 库中很常见)也支持 y 轴朝下的坐标系(在 2d 库中很常见)，在六角网格大观中我只讨论了 y 轴朝下的情况。</li><li style="box-sizing: border-box; margin: 0px; padding: 0px">支持拉伸或收缩后的六边形，这在使用像素图形时尤为常见。在六角网格大观中我只讨论了正六边形的情况。</li><li style="box-sizing: border-box; margin: 0px; padding: 0px">支持将&nbsp;0,0&nbsp;六角网格放置在屏幕的任意位置。在六角网格大观一文中，我只讨论了将&nbsp;0,0&nbsp;六角网格放置在0,0&nbsp;位置。</li></ul></li><li style="box-sizing: border-box; margin: 0px; padding: 0px">此外，我还需要实现将鼠标点击位置和其他像素坐标转换为六角网格坐标的方法。我会将这块功能放入&nbsp;Layout&nbsp;类中。六角网格坐标与屏幕坐标的相互转换有相似之处，因此将它们放到一起很合理。</li><li style="box-sizing: border-box; margin: 0px; padding: 0px">《六角网格大观》中没有讨论整点六角坐标与浮点数六角网格坐标之间的区别。在需要用到浮点数坐标的地方，我会专门定义&nbsp;FractionalHex&nbsp;来实现线性插值与圆整的算法。</li><li style="box-sizing: border-box; margin: 0px; padding: 0px">一旦创建好坐标系并实现求相邻网格的方法，就可以运用基于图论的算法来求解移动范围，寻路搜寻等诸多问题。寻路算法我已经在另外<a style="box-sizing: border-box; color: #0088cc; text-decoration: none !important; background-color: transparent" href="http://www.redblobgames.com/pathfinding/a-star/introduction.html">一篇教程</a>中详细讨论过了，这里就不再重复。</li></ul><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">我打算主要使用 C++ 来编写范例代码，但我也为这份代码编写了 Java，C#，Python，JavaScript，Haxe 和 Lua 的版本。</p><h4 style="box-sizing: border-box; font-family: Raleway, sans-serif; line-height: 1.5; color: #444444; margin: 0px 0px 20px; font-size: 18px; padding-top: 30px; padding-bottom: 15px; border-bottom-width: 1px; border-bottom-style: dotted; border-bottom-color: #0088cc; background-color: #f4f4f4">六角网格坐标</h4><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">在《六角网格大观》一文中我将立方坐标与轴坐标视为两种不同的坐标系。立方坐标实则是&nbsp;x, y, z&nbsp;三维空间中的一个面&nbsp;x + y + z = 0。轴坐标只有两个轴，轴间夹角为 60&deg; 或 120&deg;。我这里使用了以&nbsp;q, r, s&nbsp;而非&nbsp;x, y, z&nbsp;来命名坐标的立方类：</p><pre class="prettyprint" style="box-sizing: border-box; overflow: auto; font-size: 13px; line-height: 20px; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; padding: 10px 15px; margin-bottom: 20px; word-break: break-all; word-wrap: break-word; border: 1px solid #e1e1e8; border-radius: 4px; white-space: pre-wrap; margin-top: 0px !important"><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">struct</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Hex</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #999999" class="com">// 存储立方坐标，立方坐标构造函数</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">const</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> q</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> r</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> s</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Hex</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> q_</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> r_</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> s_</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">):</span><span style="box-sizing: border-box" class="pln"> q</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">q_</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">),</span><span style="box-sizing: border-box" class="pln"> r</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">r_</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">),</span><span style="box-sizing: border-box" class="pln"> s</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">s_</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">assert</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">q </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">+</span><span style="box-sizing: border-box" class="pln"> r </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">+</span><span style="box-sizing: border-box" class="pln"> s </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">==</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #195f91" class="lit">0</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">);</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#125;</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#125;;</span></pre><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">简洁明了。下面这个类内部也存储了轴坐标，但使用立方坐标作为接口：</p><pre class="prettyprint" style="box-sizing: border-box; overflow: auto; font-size: 13px; line-height: 20px; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; padding: 10px 15px; margin-bottom: 20px; word-break: break-all; word-wrap: break-word; border: 1px solid #e1e1e8; border-radius: 4px; white-space: pre-wrap; margin-top: 0px !important"><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">struct</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Hex</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #999999" class="com">// 存储轴坐标，立方坐标构造函数</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">const</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> q_</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> r_</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Hex</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> q</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> r</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> s</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">):</span><span style="box-sizing: border-box" class="pln"> q_</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">q</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">),</span><span style="box-sizing: border-box" class="pln"> r_</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">r</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">assert</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">q </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">+</span><span style="box-sizing: border-box" class="pln"> r </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">+</span><span style="box-sizing: border-box" class="pln"> s </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">==</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #195f91" class="lit">0</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">);</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#125;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">inline</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> q</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">()</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">return</span><span style="box-sizing: border-box" class="pln"> q_</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#125;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">inline</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> r</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">()</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">return</span><span style="box-sizing: border-box" class="pln"> r_</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#125;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">inline</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> s</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">()</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">return</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">-</span><span style="box-sizing: border-box" class="pln"> q_ </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">-</span><span style="box-sizing: border-box" class="pln"> r_</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#125;</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#125;;</span></pre><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">这两种写法效果一致。头一种显式地写出了&nbsp;s&nbsp;坐标，第二种则使用寄存器，在需要的时候再计算具体的&nbsp;s。立方坐标与轴坐标本质上是一种坐标系，因此我不会为其单独编写独立的类。</p><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">另一种风格是将&nbsp;s&nbsp;放入构造函数而非将其作为参数传递：</p><pre class="prettyprint" style="box-sizing: border-box; overflow: auto; font-size: 13px; line-height: 20px; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; padding: 10px 15px; margin-bottom: 20px; word-break: break-all; word-wrap: break-word; border: 1px solid #e1e1e8; border-radius: 4px; white-space: pre-wrap; margin-top: 0px !important"><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">struct</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Hex</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #999999" class="com">// 存储立方坐标，轴坐标构造函数</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">const</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> q</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> r</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> s</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Hex</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> q_</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> r_</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">):</span><span style="box-sizing: border-box" class="pln"> q</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">q_</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">),</span><span style="box-sizing: border-box" class="pln"> r</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">r_</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">),</span><span style="box-sizing: border-box" class="pln"> s</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(-</span><span style="box-sizing: border-box" class="pln">q_ </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">-</span><span style="box-sizing: border-box" class="pln"> r_</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;&#125;</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#125;;</span></pre><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">这种写法的优势在于你需要用到&nbsp;s&nbsp;的时候多半是在调用的时候。你拥有&nbsp;q&nbsp;和&nbsp;r，虽然没有&nbsp;s，但是将&nbsp;-q-r&nbsp;作为第三个参数就可以了。你还可以将这种风格与第二种写法(存储轴坐标)相融合，只存储&nbsp;q&nbsp;与&nbsp;r，并使用寄存器来计算&nbsp;s。</p><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">还有一种风格是，使用数组而非命名字段：</p><pre class="prettyprint" style="box-sizing: border-box; overflow: auto; font-size: 13px; line-height: 20px; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; padding: 10px 15px; margin-bottom: 20px; word-break: break-all; word-wrap: break-word; border: 1px solid #e1e1e8; border-radius: 4px; white-space: pre-wrap; margin-top: 0px !important"><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">struct</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Hex</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #999999" class="com">// 存储矢量，立方坐标构造函数</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">const</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> v</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">[</span><span style="box-sizing: border-box; color: #195f91" class="lit">3</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">];</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Hex</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> q</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> r</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> s</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">):</span><span style="box-sizing: border-box" class="pln"> v</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;</span><span style="box-sizing: border-box" class="pln">q</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> r</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> s</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#125;</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">assert</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">q </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">+</span><span style="box-sizing: border-box" class="pln"> r </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">+</span><span style="box-sizing: border-box" class="pln"> s </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">==</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #195f91" class="lit">0</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">);</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#125;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">inline</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> q</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">()</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">return</span><span style="box-sizing: border-box" class="pln"> v</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">[</span><span style="box-sizing: border-box; color: #195f91" class="lit">0</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">];</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#125;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">inline</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> r</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">()</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">return</span><span style="box-sizing: border-box" class="pln"> v</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">[</span><span style="box-sizing: border-box; color: #195f91" class="lit">1</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">];</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#125;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">inline</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> s</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">()</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">return</span><span style="box-sizing: border-box" class="pln"> v</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">[</span><span style="box-sizing: border-box; color: #195f91" class="lit">2</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">];</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#125;</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#125;;</span></pre><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">这种写法的好处，就像你一开始就看到的，在于它平等看待三个坐标值&nbsp;q, r, s。你可以编写循环来处理它们而无须复制代码。如果使用 CPU 运算你应该使用 SIMD(单指令多数据流) 指令，使用 GPU 运算则应该使用&nbsp;vec3。如果你已经读过后文中的相等判断以及&nbsp;hex_add，&nbsp;hex_subtract，&nbsp;hex_scale，hex_length，hex_round&nbsp;以及&nbsp;hex_lerp&nbsp;等函数，你应该能感觉到统一对待三个坐标用途有多么巨大。当使用这种表达方式时，如果你读过后文的&nbsp;hex_to_pixel&nbsp;和pixel_code，你会发现可以直接使用六角坐标来进行矢量与矩阵运算(无论是使用 CPU 还是 GPU)。</p><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">编程是一项充满权衡的活动。就本文而言，我首先关注的方面是简洁性和可读性，并不刻意注重性能或者抽象层次的问题，因此我选择使用第一种风格：储存立方坐标，使用立方坐标构造函数。这样最易于阐述算法。然而，以上提到这些风格我都很喜欢，如果适合项目我会毫不犹豫地选择它们。在一些具有多重构造函数的语言中，出于方便，我会同时使用轴坐标与立方坐标的构造函数。在 C++ 中，我会使用模板参数来替代&nbsp;int&nbsp;类型，而在 C 或 C++11 中， 可以使用&nbsp;union将&nbsp;int v[]&nbsp;和&nbsp;int q, r, s&nbsp;两种风格融为一体。模板参数&nbsp;w&nbsp;可以用于区分位置与矢量。将它们结合在一起，代码如下：</p><pre class="prettyprint" style="box-sizing: border-box; overflow: auto; font-size: 13px; line-height: 20px; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; padding: 10px 15px; margin-bottom: 20px; word-break: break-all; word-wrap: break-word; border: 1px solid #e1e1e8; border-radius: 4px; white-space: pre-wrap; margin-top: 0px !important"><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">template</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">struct</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">_Hex</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #999999" class="com">// Both storage types, both constructors</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">union</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">const</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Number</span><span style="box-sizing: border-box" class="pln"> v</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">[</span><span style="box-sizing: border-box; color: #195f91" class="lit">3</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">];</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">struct</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">const</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Number</span><span style="box-sizing: border-box" class="pln"> q</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> r</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> s</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#125;;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#125;;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Hex</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Number</span><span style="box-sizing: border-box" class="pln"> q_</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Number</span><span style="box-sizing: border-box" class="pln"> r_</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">):</span><span style="box-sizing: border-box" class="pln"> v</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;</span><span style="box-sizing: border-box" class="pln">q_</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> r_</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">-</span><span style="box-sizing: border-box" class="pln">q_ </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">-</span><span style="box-sizing: border-box" class="pln"> r_</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#125;</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;&#125;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Hex</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Number</span><span style="box-sizing: border-box" class="pln"> q_</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Number</span><span style="box-sizing: border-box" class="pln"> r_</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Number</span><span style="box-sizing: border-box" class="pln"> s_</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">):</span><span style="box-sizing: border-box" class="pln"> v</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;</span><span style="box-sizing: border-box" class="pln">q_</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> r_</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> s_</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#125;</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;&#125;</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#125;;</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">typedef</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">_Hex</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Hex</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">typedef</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">_Hex</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">HexDifference</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">typedef</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">_Hex</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">FractionalHex</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">typedef</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">_Hex</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">FractionalHexDifference</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span></pre><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">在这篇教程中，我没有选择 C++ 特有的编程风格，因为我希望本文的代码能更直接地翻译成其他语言。</p><h5 style="box-sizing: border-box; font-family: Raleway, sans-serif; line-height: 1.5; color: #444444; margin: 0px 0px 20px; font-size: 14px; background-color: #f4f4f4">相等判断</h5><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">判断是否相等是非常直观的问题：坐标相等即说明是同一个六边形。在 C++ 中，使用&nbsp;==&nbsp;操作符；在 Python 中，使用方法&nbsp;__eq__;在 Java 中，专门定义一个&nbsp;equals()&nbsp;方法。尽可能贴合语言本身的编程风格：</p><pre class="prettyprint" style="box-sizing: border-box; overflow: auto; font-size: 13px; line-height: 20px; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; padding: 10px 15px; margin-bottom: 20px; word-break: break-all; word-wrap: break-word; border: 1px solid #e1e1e8; border-radius: 4px; white-space: pre-wrap; margin-top: 0px !important"><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">bool</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">operator</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">==</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Hex</span><span style="box-sizing: border-box" class="pln"> a</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Hex</span><span style="box-sizing: border-box" class="pln"> b</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">return</span><span style="box-sizing: border-box" class="pln"> a</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">q </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">==</span><span style="box-sizing: border-box" class="pln"> b</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">q </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&amp;&amp;</span><span style="box-sizing: border-box" class="pln"> a</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">r </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">==</span><span style="box-sizing: border-box" class="pln"> b</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">r </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&amp;&amp;</span><span style="box-sizing: border-box" class="pln"> a</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">s </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">==</span><span style="box-sizing: border-box" class="pln"> b</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">s</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#125;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;</span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">bool</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">operator</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">!=</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Hex</span><span style="box-sizing: border-box" class="pln"> a</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Hex</span><span style="box-sizing: border-box" class="pln"> b</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">return</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">!(</span><span style="box-sizing: border-box" class="pln">a </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">==</span><span style="box-sizing: border-box" class="pln"> b</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">);</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#125;</span></pre><h5 style="box-sizing: border-box; font-family: Raleway, sans-serif; line-height: 1.5; color: #444444; margin: 0px 0px 20px; font-size: 14px; background-color: #f4f4f4">坐标运算</h5><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">由于立方坐标来自3维笛卡尔坐标系，因此它们也可以进行一般的加减乘除运算。举例来讲，Hex(2, 0, -2)&nbsp;代表指向东北长度为2的矢量，因此从位置&nbsp;Hex(3, -5, 2)&nbsp;向东北移动2格的方法也十分明显：&nbsp;Hex(2 + 3, 0 + -5, -2 + -2)。在其他的坐标系，比如偏移坐标系中，这种写法是行不通的。只有当你实现了三维笛卡尔坐标系时才能进行这些运算，但我这里选择用&nbsp;q, r, s&nbsp;来命名，没有使用传统的命名方法&nbsp;x, y, z:</p><pre class="prettyprint" style="box-sizing: border-box; overflow: auto; font-size: 13px; line-height: 20px; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; padding: 10px 15px; margin-bottom: 20px; word-break: break-all; word-wrap: break-word; border: 1px solid #e1e1e8; border-radius: 4px; white-space: pre-wrap; margin-top: 0px !important"><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Hex</span><span style="box-sizing: border-box" class="pln"> hex_add</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Hex</span><span style="box-sizing: border-box" class="pln"> a</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Hex</span><span style="box-sizing: border-box" class="pln"> b</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">return</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Hex</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">a</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">q </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">+</span><span style="box-sizing: border-box" class="pln"> b</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">q</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> a</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">r </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">+</span><span style="box-sizing: border-box" class="pln"> b</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">r</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> a</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">s </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">+</span><span style="box-sizing: border-box" class="pln"> b</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">s</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">);</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#125;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;</span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Hex</span><span style="box-sizing: border-box" class="pln"> hex_subtract</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Hex</span><span style="box-sizing: border-box" class="pln"> a</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Hex</span><span style="box-sizing: border-box" class="pln"> b</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">return</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Hex</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">a</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">q </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">-</span><span style="box-sizing: border-box" class="pln"> b</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">q</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> a</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">r </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">-</span><span style="box-sizing: border-box" class="pln"> b</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">r</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> a</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">s </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">-</span><span style="box-sizing: border-box" class="pln"> b</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">s</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">);</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#125;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;</span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Hex</span><span style="box-sizing: border-box" class="pln"> hex_multiply</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Hex</span><span style="box-sizing: border-box" class="pln"> a</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> k</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">return</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Hex</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">a</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">q </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">*</span><span style="box-sizing: border-box" class="pln"> k</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> a</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">r </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">*</span><span style="box-sizing: border-box" class="pln"> k</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> a</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">s </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">*</span><span style="box-sizing: border-box" class="pln"> k</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">);</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#125;</span></pre><h5 style="box-sizing: border-box; font-family: Raleway, sans-serif; line-height: 1.5; color: #444444; margin: 0px 0px 20px; font-size: 14px; background-color: #f4f4f4">距离</h5><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">两个六边形的距离即两者连线的长度。不管是求距离还是求连线长度，运算起来都不麻烦。参见《六角网格大观》一文：</p><pre class="prettyprint" style="box-sizing: border-box; overflow: auto; font-size: 13px; line-height: 20px; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; padding: 10px 15px; margin-bottom: 20px; word-break: break-all; word-wrap: break-word; border: 1px solid #e1e1e8; border-radius: 4px; white-space: pre-wrap; margin-top: 0px !important"><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> hex_length</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Hex</span><span style="box-sizing: border-box" class="pln"> hex</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">return</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">((</span><span style="box-sizing: border-box" class="pln">abs</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">hex</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">q</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">+</span><span style="box-sizing: border-box" class="pln"> abs</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">hex</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">r</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">+</span><span style="box-sizing: border-box" class="pln"> abs</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">hex</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">s</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">))</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">/</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #195f91" class="lit">2</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">);</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#125;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;</span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> hex_distance</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Hex</span><span style="box-sizing: border-box" class="pln"> a</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Hex</span><span style="box-sizing: border-box" class="pln"> b</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">return</span><span style="box-sizing: border-box" class="pln"> hex_length</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">hex_subtract</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">a</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> b</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">));</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#125;</span></pre><h6 style="box-sizing: border-box; font-family: Raleway, sans-serif; line-height: 1.5; color: #444444; margin: 0px 0px 20px; font-size: 12px; background-color: #f4f4f4">相邻</h6><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">计算距离时，我定义了两个函数：一个参数的&nbsp;length&nbsp;和两个参数的&nbsp;distance。对相邻问题处理方式也很类似。direction&nbsp;函数有一个参数，而&nbsp;neighbor&nbsp;函数有两个参数。参看六角网格大观：</p><pre class="prettyprint" style="box-sizing: border-box; overflow: auto; font-size: 13px; line-height: 20px; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; padding: 10px 15px; margin-bottom: 20px; word-break: break-all; word-wrap: break-word; border: 1px solid #e1e1e8; border-radius: 4px; white-space: pre-wrap; margin-top: 0px !important"><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">const</span><span style="box-sizing: border-box" class="pln"> vector</span><span style="box-sizing: border-box" class="pln"> hex_directions </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Hex</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #195f91" class="lit">1</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #195f91" class="lit">0</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">-</span><span style="box-sizing: border-box; color: #195f91" class="lit">1</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">),</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Hex</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #195f91" class="lit">1</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">-</span><span style="box-sizing: border-box; color: #195f91" class="lit">1</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #195f91" class="lit">0</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">),</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Hex</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #195f91" class="lit">0</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">-</span><span style="box-sizing: border-box; color: #195f91" class="lit">1</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #195f91" class="lit">1</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">),</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Hex</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(-</span><span style="box-sizing: border-box; color: #195f91" class="lit">1</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #195f91" class="lit">0</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #195f91" class="lit">1</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">),</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Hex</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(-</span><span style="box-sizing: border-box; color: #195f91" class="lit">1</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #195f91" class="lit">1</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #195f91" class="lit">0</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">),</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Hex</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #195f91" class="lit">0</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #195f91" class="lit">1</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">-</span><span style="box-sizing: border-box; color: #195f91" class="lit">1</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#125;;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;</span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Hex</span><span style="box-sizing: border-box" class="pln"> hex_direction</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> direction </span><span style="box-sizing: border-box; color: #999999" class="com">/* 0 to 5 */</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">assert</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #195f91" class="lit">0</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&lt;=</span><span style="box-sizing: border-box" class="pln"> direction </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&amp;&amp;</span><span style="box-sizing: border-box" class="pln"> direction </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&lt;</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #195f91" class="lit">6</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">);</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">return</span><span style="box-sizing: border-box" class="pln"> hex_directions</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">[</span><span style="box-sizing: border-box" class="pln">direction</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">];</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#125;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;</span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Hex</span><span style="box-sizing: border-box" class="pln"> hex_neighbor</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Hex</span><span style="box-sizing: border-box" class="pln"> hex</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> direction</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">return</span><span style="box-sizing: border-box" class="pln"> hex_add</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">hex</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> hex_direction</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">direction</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">));</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#125;</span></pre><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">假如超出默认的六个方向范围，就使用&nbsp;hex_directions[(6 + (direction % 6)) % 6]。嗯，看起来是有点丑，但它即使对反方向也适用。(附记：如果 C++ 能有可以处理负数的取模运算符那该多好啊。参见&nbsp;<a style="box-sizing: border-box; color: #0088cc; text-decoration: none !important; background-color: transparent" href="http://stackoverflow.com/questions/4003232/how-to-code-a-modulo-operator-in-c-c-obj-c-that-handles-negative-numbers">stackoverflow</a>&nbsp;的一篇讨论。)</p><h4 style="box-sizing: border-box; font-family: Raleway, sans-serif; line-height: 1.5; color: #444444; margin: 0px 0px 20px; font-size: 18px; padding-top: 30px; padding-bottom: 15px; border-bottom-width: 1px; border-bottom-style: dotted; border-bottom-color: #0088cc; background-color: #f4f4f4">布局</h4><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">接着我们来实现在六角坐标与屏幕坐标间相互转换的功能。布局方案分顶点朝上和边线朝上。我们会用到转换矩阵以及它的逆矩阵，因此需要有存储矩阵的方案。在绘制顶点时，顶点朝上布局起始角度为 30&deg; 而边线朝上则从 0&deg; 开始，因此也需要存放布局信息。</p><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">我定义了一个辅助类&nbsp;<span style="box-sizing: border-box; font-weight: 700">Orientation</span>&nbsp;来存储这些数据:<br />2x2 的转换矩阵，2x2 的逆矩阵，以及起始角度。</p><pre class="prettyprint" style="box-sizing: border-box; overflow: auto; font-size: 13px; line-height: 20px; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; padding: 10px 15px; margin-bottom: 20px; word-break: break-all; word-wrap: break-word; border: 1px solid #e1e1e8; border-radius: 4px; white-space: pre-wrap; margin-top: 0px !important"><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">struct</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Orientation</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">const</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">double</span><span style="box-sizing: border-box" class="pln"> f0</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> f1</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> f2</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> f3</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">const</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">double</span><span style="box-sizing: border-box" class="pln"> b0</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> b1</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> b2</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> b3</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">const</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">double</span><span style="box-sizing: border-box" class="pln"> start_angle</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #999999" class="com">// in multiples of 60&deg;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Orientation</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">double</span><span style="box-sizing: border-box" class="pln"> f0_</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">double</span><span style="box-sizing: border-box" class="pln"> f1_</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">double</span><span style="box-sizing: border-box" class="pln"> f2_</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">double</span><span style="box-sizing: border-box" class="pln"> f3_</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">double</span><span style="box-sizing: border-box" class="pln"> b0_</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">double</span><span style="box-sizing: border-box" class="pln"> b1_</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">double</span><span style="box-sizing: border-box" class="pln"> b2_</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">double</span><span style="box-sizing: border-box" class="pln"> b3_</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">double</span><span style="box-sizing: border-box" class="pln"> start_angle_</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">:</span><span style="box-sizing: border-box" class="pln"> f0</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">f0_</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">),</span><span style="box-sizing: border-box" class="pln"> f1</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">f1_</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">),</span><span style="box-sizing: border-box" class="pln"> f2</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">f2_</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">),</span><span style="box-sizing: border-box" class="pln"> f3</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">f3_</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">),</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; b0</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">b0_</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">),</span><span style="box-sizing: border-box" class="pln"> b1</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">b1_</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">),</span><span style="box-sizing: border-box" class="pln"> b2</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">b2_</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">),</span><span style="box-sizing: border-box" class="pln"> b3</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">b3_</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">),</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; start_angle</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">start_angle_</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;&#125;</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#125;;</span></pre><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">由于仅有两种朝向，因此我使用常量：</p><pre class="prettyprint" style="box-sizing: border-box; overflow: auto; font-size: 13px; line-height: 20px; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; padding: 10px 15px; margin-bottom: 20px; word-break: break-all; word-wrap: break-word; border: 1px solid #e1e1e8; border-radius: 4px; white-space: pre-wrap; margin-top: 0px !important"><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">const</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Orientation</span><span style="box-sizing: border-box" class="pln"> layout_pointy&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Orientation</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">sqrt</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #195f91" class="lit">3.0</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">),</span><span style="box-sizing: border-box" class="pln"> sqrt</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #195f91" class="lit">3.0</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">/</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #195f91" class="lit">2.0</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #195f91" class="lit">0.0</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #195f91" class="lit">3.0</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">/</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #195f91" class="lit">2.0</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sqrt</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #195f91" class="lit">3.0</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">/</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #195f91" class="lit">3.0</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">-</span><span style="box-sizing: border-box; color: #195f91" class="lit">1.0</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">/</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #195f91" class="lit">3.0</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #195f91" class="lit">0.0</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #195f91" class="lit">2.0</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">/</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #195f91" class="lit">3.0</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #195f91" class="lit">0.5</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">);</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">const</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Orientation</span><span style="box-sizing: border-box" class="pln"> layout_flat&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Orientation</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #195f91" class="lit">3.0</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">/</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #195f91" class="lit">2.0</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #195f91" class="lit">0.0</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> sqrt</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #195f91" class="lit">3.0</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">/</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #195f91" class="lit">2.0</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> sqrt</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #195f91" class="lit">3.0</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">),</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #195f91" class="lit">2.0</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">/</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #195f91" class="lit">3.0</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #195f91" class="lit">0.0</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">-</span><span style="box-sizing: border-box; color: #195f91" class="lit">1.0</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">/</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #195f91" class="lit">3.0</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> sqrt</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #195f91" class="lit">3.0</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">/</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #195f91" class="lit">3.0</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #195f91" class="lit">0.0</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">);</span></pre><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">将它们用于&nbsp;Layout&nbsp;类：</p><pre class="prettyprint" style="box-sizing: border-box; overflow: auto; font-size: 13px; line-height: 20px; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; padding: 10px 15px; margin-bottom: 20px; word-break: break-all; word-wrap: break-word; border: 1px solid #e1e1e8; border-radius: 4px; white-space: pre-wrap; margin-top: 0px !important"><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">struct</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Layout</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">const</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Orientation</span><span style="box-sizing: border-box" class="pln"> orientation</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">const</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Point</span><span style="box-sizing: border-box" class="pln"> size</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">const</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Point</span><span style="box-sizing: border-box" class="pln"> origin</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Layout</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Orientation</span><span style="box-sizing: border-box" class="pln"> orientation_</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Point</span><span style="box-sizing: border-box" class="pln"> size_</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Point</span><span style="box-sizing: border-box" class="pln"> origin_</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">:</span><span style="box-sizing: border-box" class="pln"> orientation</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">orientation_</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">),</span><span style="box-sizing: border-box" class="pln"> size</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">size_</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">),</span><span style="box-sizing: border-box" class="pln"> origin</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">origin_</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;&#125;</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#125;;</span></pre><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">哦，对了，我还需要定义个极简的&nbsp;<span style="box-sizing: border-box; font-weight: 700">Point</span>&nbsp;类。如果你使用的图形库/几何库中以及提供了这个类，就用它们提供的就好：</p><pre class="prettyprint" style="box-sizing: border-box; overflow: auto; font-size: 13px; line-height: 20px; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; padding: 10px 15px; margin-bottom: 20px; word-break: break-all; word-wrap: break-word; border: 1px solid #e1e1e8; border-radius: 4px; white-space: pre-wrap; margin-top: 0px !important"><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">struct</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Point</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">const</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">double</span><span style="box-sizing: border-box" class="pln"> x</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> y</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Point</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">double</span><span style="box-sizing: border-box" class="pln"> x_</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">double</span><span style="box-sizing: border-box" class="pln"> y_</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">):</span><span style="box-sizing: border-box" class="pln"> x</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">x_</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">),</span><span style="box-sizing: border-box" class="pln"> y</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">y_</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;&#125;</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#125;;</span></pre><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">附记：你可能已经注意到了，这里的许多东西其底层都是元素为数字的数组。Hex&nbsp;是&nbsp;int[3]。朝向是一个角度，用双精度浮点数&nbsp;double&nbsp;表示，而两个矩阵，都是&nbsp;double[4]&nbsp;或&nbsp;double[2][2]。点 Point 是&nbsp;double[2]。布局由一个朝向Orientation&nbsp;和两个点&nbsp;Point&nbsp;组成。后文中将会用到的&nbsp;FractionalHex&nbsp;是&nbsp;double[3]，而&nbsp;OffsetCoord&nbsp;是int[2]。我选择使用结构体，而没有使用数组，是因为我可以为结构体的元素命名，而这些名字能够帮助我理解它们，同时对类型检查也有好处。</p><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">一切就绪，我们来编写布局的算法吧。</p><h5 style="box-sizing: border-box; font-family: Raleway, sans-serif; line-height: 1.5; color: #444444; margin: 0px 0px 20px; font-size: 14px; background-color: #f4f4f4">六角网格到屏幕</h5><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">《六角网格大观》一文中包括两种六角网格坐标转换为像素坐标的方法，每一种适应一种朝向。尽管数值有所不同，但本质上代码是一样的。 因此，在实现该功能时，我将具体的数值放入了&nbsp;Orientation&nbsp;类中，从&nbsp;f0&nbsp;到&nbsp;f3:</p><pre class="prettyprint" style="box-sizing: border-box; overflow: auto; font-size: 13px; line-height: 20px; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; padding: 10px 15px; margin-bottom: 20px; word-break: break-all; word-wrap: break-word; border: 1px solid #e1e1e8; border-radius: 4px; white-space: pre-wrap; margin-top: 0px !important"><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Point</span><span style="box-sizing: border-box" class="pln"> hex_to_pixel</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Layout</span><span style="box-sizing: border-box" class="pln"> layout</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Hex</span><span style="box-sizing: border-box" class="pln"> h</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">const</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Orientation</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&amp;</span><span style="box-sizing: border-box" class="pln"> M </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box" class="pln"> layout</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">orientation</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">double</span><span style="box-sizing: border-box" class="pln"> x </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">M</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">f0 </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">*</span><span style="box-sizing: border-box" class="pln"> h</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">q </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">+</span><span style="box-sizing: border-box" class="pln"> M</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">f1 </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">*</span><span style="box-sizing: border-box" class="pln"> h</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">r</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">*</span><span style="box-sizing: border-box" class="pln"> layout</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">size</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">x</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">double</span><span style="box-sizing: border-box" class="pln"> y </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">M</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">f2 </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">*</span><span style="box-sizing: border-box" class="pln"> h</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">q </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">+</span><span style="box-sizing: border-box" class="pln"> M</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">f3 </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">*</span><span style="box-sizing: border-box" class="pln"> h</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">r</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">*</span><span style="box-sizing: border-box" class="pln"> layout</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">size</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">y</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">return</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Point</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">x </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">+</span><span style="box-sizing: border-box" class="pln"> layout</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">origin</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">x</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> y </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">+</span><span style="box-sizing: border-box" class="pln"> layout</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">origin</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">y</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">);</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#125;</span></pre><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">和《六角网格大观》一文有所不同的是，我分别声明了两个方向的大小：x&nbsp;与&nbsp;y。这样就能实现：</p><ul style="box-sizing: border-box; margin: 0px 0px 30px; padding: 0px 0px 0px 40px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; line-height: 24px; background-color: #f4f4f4"><li style="box-sizing: border-box; margin: 0px; padding: 0px">你可以拉伸，收缩六边形来适配你使用的任意大小的像素材质。请注意&nbsp;size.x&nbsp;与&nbsp;size.y&nbsp;并非六边形的宽度和高度。</li><li style="box-sizing: border-box; margin: 0px; padding: 0px">你可以令 y 变为负数来反转 y 轴方向。</li></ul><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">此外，《六角网格大观》一文中将&nbsp;q = 0, r = 0&nbsp;的六边形面心放置在&nbsp;x = 0,y = 0&nbsp;位置，但起始基本上你想放到什么位置都无关紧要。如果想要其他的位置，只需要往中心位置(layout.origin)增加一个变化量就好。</p><h5 style="box-sizing: border-box; font-family: Raleway, sans-serif; line-height: 1.5; color: #444444; margin: 0px 0px 20px; font-size: 14px; background-color: #f4f4f4">屏幕到六角网格</h5><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">《六角网格大观》一文也包含两种将像素坐标转换为六角网格坐标的方案，每一种适用于一种朝向。同样地，虽然数值不同，但代码没有本质差别。这次我们使用的是逆矩阵，我将矩阵求逆放入了&nbsp;Orientation&nbsp;中，从&nbsp;b0&nbsp;到&nbsp;b3，并用在下面的函数中。在六角网格到屏幕坐标的转换中，我先乘以矩阵，再乘以大小，然后加上原点。而从屏幕坐标转换到六角网格，我需要逆转这个过程：首先减去原点，然后除以大小，再乘以逆矩阵：</p><pre class="prettyprint" style="box-sizing: border-box; overflow: auto; font-size: 13px; line-height: 20px; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; padding: 10px 15px; margin-bottom: 20px; word-break: break-all; word-wrap: break-word; border: 1px solid #e1e1e8; border-radius: 4px; white-space: pre-wrap; margin-top: 0px !important"><span style="box-sizing: border-box; color: #4f9fcf" class="typ">FractionalHex</span><span style="box-sizing: border-box" class="pln"> pixel_to_hex</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Layout</span><span style="box-sizing: border-box" class="pln"> layout</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Point</span><span style="box-sizing: border-box" class="pln"> p</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">const</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Orientation</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&amp;</span><span style="box-sizing: border-box" class="pln"> M </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box" class="pln"> layout</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">orientation</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Point</span><span style="box-sizing: border-box" class="pln"> pt </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Point</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">((</span><span style="box-sizing: border-box" class="pln">p</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">x </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">-</span><span style="box-sizing: border-box" class="pln"> layout</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">origin</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">x</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">/</span><span style="box-sizing: border-box" class="pln"> layout</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">size</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">x</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">p</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">y </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">-</span><span style="box-sizing: border-box" class="pln"> layout</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">origin</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">y</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">/</span><span style="box-sizing: border-box" class="pln"> layout</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">size</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">y</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">);</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">double</span><span style="box-sizing: border-box" class="pln"> q </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box" class="pln"> M</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">b0 </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">*</span><span style="box-sizing: border-box" class="pln"> pt</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">x </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">+</span><span style="box-sizing: border-box" class="pln"> M</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">b1 </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">*</span><span style="box-sizing: border-box" class="pln"> pt</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">y</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">double</span><span style="box-sizing: border-box" class="pln"> r </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box" class="pln"> M</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">b2 </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">*</span><span style="box-sizing: border-box" class="pln"> pt</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">x </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">+</span><span style="box-sizing: border-box" class="pln"> M</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">b3 </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">*</span><span style="box-sizing: border-box" class="pln"> pt</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">y</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">return</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">FractionalHex</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">q</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> r</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">-</span><span style="box-sizing: border-box" class="pln">q </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">-</span><span style="box-sizing: border-box" class="pln"> r</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">);</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#125;</span></pre><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">此处可能会出现一点稍微麻烦的情况：我将整型的六角网格坐标转换为屏幕坐标，但反过来，却无法保证屏幕坐标转换后的六角网格坐标恰好为整数。这样我得到的不是整型的坐标，而是双精度浮点类型的坐标，转换函数的返回值为<span style="box-sizing: border-box; font-weight: 700">FractionalHex</span>&nbsp;而非&nbsp;<span style="box-sizing: border-box; font-weight: 700">Hex</span>。为了得到整型坐标，还需要经过一次圆整，稍后我会实现这一功能。</p><h5 style="box-sizing: border-box; font-family: Raleway, sans-serif; line-height: 1.5; color: #444444; margin: 0px 0px 20px; font-size: 14px; background-color: #f4f4f4">绘制六角网格</h5><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">绘制六边形需要清楚它的顶角相对于中心的位置关系。使用边线朝上布局时，顶角位于 0&deg;，60&deg;，120&deg;，180&deg;，240&deg;，300&deg;；使用顶点朝上布局时，顶角位于 30&deg;, 90&deg;, 150&deg;, 210&deg;, 270&deg;, 330&deg;。我在&nbsp;Orientation&nbsp;类中编码了起始角度start_angle&nbsp;的值，为 0&deg; 时是&nbsp;0.0，为 60&deg; 时是&nbsp;0.5。</p><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">当我知道顶角相对中心的位置关系后，就能够通过从中心位置移动相对距离来找到顶角的屏幕位置，并将坐标放入数组之中：</p><pre class="prettyprint" style="box-sizing: border-box; overflow: auto; font-size: 13px; line-height: 20px; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; padding: 10px 15px; margin-bottom: 20px; word-break: break-all; word-wrap: break-word; border: 1px solid #e1e1e8; border-radius: 4px; white-space: pre-wrap; margin-top: 0px !important"><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Point</span><span style="box-sizing: border-box" class="pln"> hex_corner_offset</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Layout</span><span style="box-sizing: border-box" class="pln"> layout</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> corner</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Point</span><span style="box-sizing: border-box" class="pln"> size </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box" class="pln"> layout</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">size</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">double</span><span style="box-sizing: border-box" class="pln"> angle </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #195f91" class="lit">2.0</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">*</span><span style="box-sizing: border-box" class="pln"> M_PI </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">*</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">corner </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">+</span><span style="box-sizing: border-box" class="pln"> layout</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">orientation</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">start_angle</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">/</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #195f91" class="lit">6</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">return</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Point</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">size</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">x </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">*</span><span style="box-sizing: border-box" class="pln"> cos</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">angle</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">),</span><span style="box-sizing: border-box" class="pln"> size</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">y </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">*</span><span style="box-sizing: border-box" class="pln"> sin</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">angle</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">));</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#125;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;vector</span><span style="box-sizing: border-box" class="pln"> polygon_corners</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Layout</span><span style="box-sizing: border-box" class="pln"> layout</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Hex</span><span style="box-sizing: border-box" class="pln"> h</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; vector</span><span style="box-sizing: border-box" class="pln"> corners </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;&#125;;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Point</span><span style="box-sizing: border-box" class="pln"> center </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box" class="pln"> hex_to_pixel</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">layout</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> h</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">);</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">for</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> i </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #195f91" class="lit">0</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln"> i </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&lt;</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #195f91" class="lit">6</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln"> i</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">++)</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Point</span><span style="box-sizing: border-box" class="pln"> offset </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box" class="pln"> hex_corner_offset</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">layout</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> i</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">);</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; corners</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">push_back</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Point</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">center</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">x </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">+</span><span style="box-sizing: border-box" class="pln"> offset</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">x</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; center</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">y </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">+</span><span style="box-sizing: border-box" class="pln"> offset</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">y</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">));</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#125;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">return</span><span style="box-sizing: border-box" class="pln"> corners</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#125;</span></pre><h5 style="box-sizing: border-box; font-family: Raleway, sans-serif; line-height: 1.5; color: #444444; margin: 0px 0px 20px; font-size: 14px; background-color: #f4f4f4">布局范例</h5><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">好的，下面我们来试试看。我们已经编写好了&nbsp;Hex，&nbsp;Orientation，Layout，Point&nbsp;以及他们间互相转换的函数。这样就足够绘制六边形了。我决定用 JavaScript 版本的代码在浏览器中绘制一些六边形。</p><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">我们先来尝试这两种布局：layout_pointy&nbsp;和&nbsp;layout_flat:</p><div class="col_half" style="box-sizing: border-box; width: 384px; position: relative; margin-right: 32px; margin-bottom: 50px; float: left; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; line-height: 24px; background-color: #f4f4f4"><img style="box-sizing: border-box; border: 0px; vertical-align: middle; max-width: 100%; display: block; margin: 30px auto; float: none; height: auto" class="alignnone size-full wp-image-10540" src="http://indienova.com/wp-uploads/2016/05/1.png" border="0" alt="1" width="300" height="200" /></div><div class="col_half col_last" style="box-sizing: border-box; width: 384px; position: relative; margin-bottom: 50px; float: left; clear: right; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; line-height: 24px; margin-right: 0px !important; background-color: #f4f4f4"><img style="box-sizing: border-box; border: 0px; vertical-align: middle; max-width: 100%; display: block; margin: 30px auto; float: none; height: auto" class="alignnone size-full wp-image-10541" src="http://indienova.com/wp-uploads/2016/05/2.png" border="0" alt="2" width="300" height="200" /></div><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">接着我们来试试大小的网格：分别为&nbsp;Point(10, 10)，Point(20, 20)&nbsp;以及&nbsp;Point(40, 40):</p><div class="col_one_third" style="box-sizing: border-box; width: 245.031px; position: relative; margin-right: 32px; margin-bottom: 50px; float: left; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; line-height: 24px; background-color: #f4f4f4"><img style="box-sizing: border-box; border: 0px; vertical-align: middle; max-width: 100%; display: block; margin: 30px auto; float: none; height: auto" class="alignnone size-full wp-image-10545" src="http://indienova.com/wp-uploads/2016/05/3.png" border="0" alt="3" width="200" height="200" /></div><div class="col_one_third" style="box-sizing: border-box; width: 245.031px; position: relative; margin-right: 32px; margin-bottom: 50px; float: left; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; line-height: 24px; background-color: #f4f4f4"><img style="box-sizing: border-box; border: 0px; vertical-align: middle; max-width: 100%; display: block; margin: 30px auto; float: none; height: auto" class="alignnone size-full wp-image-10546" src="http://indienova.com/wp-uploads/2016/05/4.png" border="0" alt="4" width="200" height="200" /></div><div class="col_one_third col_last" style="box-sizing: border-box; width: 245.031px; position: relative; margin-bottom: 50px; float: left; clear: right; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; line-height: 24px; margin-right: 0px !important; background-color: #f4f4f4"><img style="box-sizing: border-box; border: 0px; vertical-align: middle; max-width: 100%; display: block; margin: 30px auto; float: none; height: auto" class="alignnone size-full wp-image-10548" src="http://indienova.com/wp-uploads/2016/05/5.png" border="0" alt="5" width="200" height="200" /></div><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">我们试试拉伸和收缩六边形，将大小设置为&nbsp;Point(15, 25)&nbsp;和&nbsp;Point(25, 15):</p><div class="col_half" style="box-sizing: border-box; width: 384px; position: relative; margin-right: 32px; margin-bottom: 50px; float: left; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; line-height: 24px; background-color: #f4f4f4"><img style="box-sizing: border-box; border: 0px; vertical-align: middle; max-width: 100%; display: block; margin: 30px auto; float: none; height: auto" class="alignnone size-full wp-image-10549" src="http://indienova.com/wp-uploads/2016/05/6.png" border="0" alt="6" width="300" height="200" /></div><div class="col_half col_last" style="box-sizing: border-box; width: 384px; position: relative; margin-bottom: 50px; float: left; clear: right; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; line-height: 24px; margin-right: 0px !important; background-color: #f4f4f4"><img style="box-sizing: border-box; border: 0px; vertical-align: middle; max-width: 100%; display: block; margin: 30px auto; float: none; height: auto" class="alignnone size-full wp-image-10550" src="http://indienova.com/wp-uploads/2016/05/7.png" border="0" alt="7" width="300" height="200" /></div><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">让我们试着将 y 轴朝下设置&nbsp;Point(25, 25)&nbsp;再反转 y 轴设置&nbsp;Point(25, -25)。我们仔细来看一看方向反转前后&nbsp;r&nbsp;是如何增长的：</p><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">我认为这是一组很合理的朝向大小测试，它展现出&nbsp;Layout&nbsp;类能够处理广泛类型的需求，甚至无需编写其他类型的&nbsp;Hex类。</p><h4 style="box-sizing: border-box; font-family: Raleway, sans-serif; line-height: 1.5; color: #444444; margin: 0px 0px 20px; font-size: 18px; padding-top: 30px; padding-bottom: 15px; border-bottom-width: 1px; border-bottom-style: dotted; border-bottom-color: #0088cc; background-color: #f4f4f4">浮点数六角网格</h4><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">从像素转换为六角坐标我们会用到浮点六角坐标。看起来很像&nbsp;Hex&nbsp;类，但使用&nbsp;double&nbsp;而非&nbsp;int:</p><pre class="prettyprint" style="box-sizing: border-box; overflow: auto; font-size: 13px; line-height: 20px; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; padding: 10px 15px; margin-bottom: 20px; word-break: break-all; word-wrap: break-word; border: 1px solid #e1e1e8; border-radius: 4px; white-space: pre-wrap; margin-top: 0px !important"><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">struct</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">FractionalHex</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">const</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">double</span><span style="box-sizing: border-box" class="pln"> q</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> r</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> s</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">FractionalHex</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">double</span><span style="box-sizing: border-box" class="pln"> q_</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">double</span><span style="box-sizing: border-box" class="pln"> r_</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">double</span><span style="box-sizing: border-box" class="pln"> s_</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">:</span><span style="box-sizing: border-box" class="pln"> q</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">q_</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">),</span><span style="box-sizing: border-box" class="pln"> r</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">r_</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">),</span><span style="box-sizing: border-box" class="pln"> s</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">s_</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;&#125;</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#125;;</span></pre><h5 style="box-sizing: border-box; font-family: Raleway, sans-serif; line-height: 1.5; color: #444444; margin: 0px 0px 20px; font-size: 14px; background-color: #f4f4f4">六角网格坐标圆整</h5><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">将浮点六角坐标圆整到最近的整型六角坐标。六角网格大观一文中的算法十分直观：</p><pre class="prettyprint" style="box-sizing: border-box; overflow: auto; font-size: 13px; line-height: 20px; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; padding: 10px 15px; margin-bottom: 20px; word-break: break-all; word-wrap: break-word; border: 1px solid #e1e1e8; border-radius: 4px; white-space: pre-wrap; margin-top: 0px !important"><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Hex</span><span style="box-sizing: border-box" class="pln"> hex_round</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">FractionalHex</span><span style="box-sizing: border-box" class="pln"> h</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> q </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">round</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">h</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">q</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">));</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> r </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">round</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">h</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">r</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">));</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> s </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">round</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">h</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">s</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">));</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">double</span><span style="box-sizing: border-box" class="pln"> q_diff </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box" class="pln"> abs</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">q </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">-</span><span style="box-sizing: border-box" class="pln"> h</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">q</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">);</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">double</span><span style="box-sizing: border-box" class="pln"> r_diff </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box" class="pln"> abs</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">r </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">-</span><span style="box-sizing: border-box" class="pln"> h</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">r</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">);</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">double</span><span style="box-sizing: border-box" class="pln"> s_diff </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box" class="pln"> abs</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">s </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">-</span><span style="box-sizing: border-box" class="pln"> h</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">s</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">);</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">if</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">q_diff </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&gt;</span><span style="box-sizing: border-box" class="pln"> r_diff </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">and</span><span style="box-sizing: border-box" class="pln"> q_diff </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&gt;</span><span style="box-sizing: border-box" class="pln"> s_diff</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; q </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">-</span><span style="box-sizing: border-box" class="pln">r </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">-</span><span style="box-sizing: border-box" class="pln"> s</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#125;</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">else</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">if</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">r_diff </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&gt;</span><span style="box-sizing: border-box" class="pln"> s_diff</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; r </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">-</span><span style="box-sizing: border-box" class="pln">q </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">-</span><span style="box-sizing: border-box" class="pln"> s</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#125;</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">else</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; s </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">-</span><span style="box-sizing: border-box" class="pln">q </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">-</span><span style="box-sizing: border-box" class="pln"> r</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#125;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">return</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Hex</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">q</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> r</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> s</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">);</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#125;</span></pre><h5 style="box-sizing: border-box; font-family: Raleway, sans-serif; line-height: 1.5; color: #444444; margin: 0px 0px 20px; font-size: 14px; background-color: #f4f4f4">线条绘制</h5><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">我们通过线性插值在两个六边形间绘制连线，再将其圆整到最近的六边形上。线性插值的实现非常简单：</p><pre class="prettyprint" style="box-sizing: border-box; overflow: auto; font-size: 13px; line-height: 20px; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; padding: 10px 15px; margin-bottom: 20px; word-break: break-all; word-wrap: break-word; border: 1px solid #e1e1e8; border-radius: 4px; white-space: pre-wrap; margin-top: 0px !important"><span style="box-sizing: border-box; color: #4f9fcf" class="typ">FractionalHex</span><span style="box-sizing: border-box" class="pln"> hex_lerp</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Hex</span><span style="box-sizing: border-box" class="pln"> a</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Hex</span><span style="box-sizing: border-box" class="pln"> b</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">double</span><span style="box-sizing: border-box" class="pln"> t</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">return</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">FractionalHex</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">a</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">q </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">+</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">b</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">q </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">-</span><span style="box-sizing: border-box" class="pln"> a</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">q</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">*</span><span style="box-sizing: border-box" class="pln"> t</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">r </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">+</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">b</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">r </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">-</span><span style="box-sizing: border-box" class="pln"> a</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">r</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">*</span><span style="box-sizing: border-box" class="pln"> t</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">s </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">+</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">b</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">s </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">-</span><span style="box-sizing: border-box" class="pln"> a</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">s</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">*</span><span style="box-sizing: border-box" class="pln"> t</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">);</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#125;</span></pre><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">当线性插值实现后，连线的实现就非常容易了：</p><pre class="prettyprint" style="box-sizing: border-box; overflow: auto; font-size: 13px; line-height: 20px; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; padding: 10px 15px; margin-bottom: 20px; word-break: break-all; word-wrap: break-word; border: 1px solid #e1e1e8; border-radius: 4px; white-space: pre-wrap; margin-top: 0px !important"><span style="box-sizing: border-box" class="pln">vector</span><span style="box-sizing: border-box" class="pln"> hex_linedraw</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Hex</span><span style="box-sizing: border-box" class="pln"> a</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Hex</span><span style="box-sizing: border-box" class="pln"> b</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> N </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box" class="pln"> hex_distance</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">a</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> b</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">);</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; vector</span><span style="box-sizing: border-box" class="pln"> results </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;&#125;;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">double</span><span style="box-sizing: border-box" class="pln"> step </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #195f91" class="lit">1.0</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">/</span><span style="box-sizing: border-box" class="pln"> max</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">N</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #195f91" class="lit">1</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">);</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">for</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> i </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #195f91" class="lit">0</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln"> i </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&lt;=</span><span style="box-sizing: border-box" class="pln"> N</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln"> i</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">++)</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; results</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">push_back</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">hex_round</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">hex_lerp</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">a</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> b</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> step </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">*</span><span style="box-sizing: border-box" class="pln"> i</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)));</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#125;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">return</span><span style="box-sizing: border-box" class="pln"> results</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#125;</span></pre><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">max(N, 1)&nbsp;这一段代码是用来处理&nbsp;A == B&nbsp;长度为&nbsp;0&nbsp;的情况。</p><h4 style="box-sizing: border-box; font-family: Raleway, sans-serif; line-height: 1.5; color: #444444; margin: 0px 0px 20px; font-size: 18px; padding-top: 30px; padding-bottom: 15px; border-bottom-width: 1px; border-bottom-style: dotted; border-bottom-color: #0088cc; background-color: #f4f4f4">地图</h4><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">有两个相关的问题需要解决：如何<span style="box-sizing: border-box; font-weight: 700">生成六边形形状</span>以及如何存储地图数据。让我先从地图数据存储开始：</p><h5 style="box-sizing: border-box; font-family: Raleway, sans-serif; line-height: 1.5; color: #444444; margin: 0px 0px 20px; font-size: 14px; background-color: #f4f4f4">地图存储</h5><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">存储地图最简单的办法是使用哈希表。在 C++ 中，为了使用&nbsp;unordered_map&nbsp;或者&nbsp;unordered_set&nbsp;我们需要为&nbsp;Hex&nbsp;定义哈希函数。如果 C++ 让定义它的过程简单点就好了，不过现在这样倒也还不坏。我将求出&nbsp;q&nbsp;和&nbsp;r&nbsp;字段的哈希值(这里我就略去冗余的步骤)，并使用 Boost 提供的&nbsp;hash_combine&nbsp;算法将其联合起来：</p><pre class="prettyprint" style="box-sizing: border-box; overflow: auto; font-size: 13px; line-height: 20px; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; padding: 10px 15px; margin-bottom: 20px; word-break: break-all; word-wrap: break-word; border: 1px solid #e1e1e8; border-radius: 4px; white-space: pre-wrap; margin-top: 0px !important"><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">namespace</span><span style="box-sizing: border-box" class="pln"> std </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">template</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&lt;&gt;</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">struct</span><span style="box-sizing: border-box" class="pln"> hash</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">size_t</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">operator</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">()(</span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">const</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Hex</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&amp;</span><span style="box-sizing: border-box" class="pln"> h</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">const</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; hash</span><span style="box-sizing: border-box" class="pln"> int_hash</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">size_t</span><span style="box-sizing: border-box" class="pln"> hq </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box" class="pln"> int_hash</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">h</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">q</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">);</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">size_t</span><span style="box-sizing: border-box" class="pln"> hr </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box" class="pln"> int_hash</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">h</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">r</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">);</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">return</span><span style="box-sizing: border-box" class="pln"> hq </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">^</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">hr </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">+</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #195f91" class="lit">0x9e3779b9</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">+</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">hq </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&lt;&lt;</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #195f91" class="lit">6</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">+</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">hq </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&gt;&gt;</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #195f91" class="lit">2</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">));</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#125;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#125;;</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#125;</span></pre><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">下面的例子演示了如何为每个六边形制作浮点数高度的地图：</p><pre class="prettyprint" style="box-sizing: border-box; overflow: auto; font-size: 13px; line-height: 20px; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; padding: 10px 15px; margin-bottom: 20px; word-break: break-all; word-wrap: break-word; border: 1px solid #e1e1e8; border-radius: 4px; white-space: pre-wrap; margin-top: 0px !important"><span style="box-sizing: border-box" class="pln">unordered_map</span><span style="box-sizing: border-box" class="pln"> heights</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln"> heights</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">[</span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Hex</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #195f91" class="lit">1</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">-</span><span style="box-sizing: border-box; color: #195f91" class="lit">2</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #195f91" class="lit">3</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)]</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #195f91" class="lit">4.3</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln"> cout </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&lt;&lt;</span><span style="box-sizing: border-box" class="pln"> heights</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">[</span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Hex</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #195f91" class="lit">1</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">-</span><span style="box-sizing: border-box; color: #195f91" class="lit">2</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #195f91" class="lit">3</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)];</span></pre><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">哈希表本身不是很有用，我需要将其与其他数据联合起来创建地图形状。用图论术语来讲，我需要一些数据来创建节点。</p><h5 style="box-sizing: border-box; font-family: Raleway, sans-serif; line-height: 1.5; color: #444444; margin: 0px 0px 20px; font-size: 14px; background-color: #f4f4f4">地图形状</h5><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">在这个章节中我会写一些循环来产生许多形状的地图。你可以利用这些循环来为你的地图生成一系列六角坐标。我编写了填充这些六角坐标的样例代码。</p><h6 style="box-sizing: border-box; font-family: Raleway, sans-serif; line-height: 1.5; color: #444444; margin: 0px 0px 20px; font-size: 12px; background-color: #f4f4f4">平行四边形</h6><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">如果使用是是轴坐标/立方坐标，下面这个直观的循环代码就能产生出平行四边形的地图而不是常见的四边形地图：</p><pre class="prettyprint" style="box-sizing: border-box; overflow: auto; font-size: 13px; line-height: 20px; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; padding: 10px 15px; margin-bottom: 20px; word-break: break-all; word-wrap: break-word; border: 1px solid #e1e1e8; border-radius: 4px; white-space: pre-wrap; margin-top: 0px !important"><span style="box-sizing: border-box" class="pln">unordered_set</span><span style="box-sizing: border-box" class="pln"> map</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">for</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> q </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box" class="pln"> q1</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln"> q </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&lt;=</span><span style="box-sizing: border-box" class="pln"> q2</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln"> q</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">++)</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">for</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> r </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box" class="pln"> r1</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln"> r </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&lt;=</span><span style="box-sizing: border-box" class="pln"> r2</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln"> r</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">++)</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; map</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">insert</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Hex</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">q</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> r</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">-</span><span style="box-sizing: border-box" class="pln">q</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">-</span><span style="box-sizing: border-box" class="pln">r</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)));</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#125;</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#125;</span></pre><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">有三个坐标，循环要求你选出其中两个：&nbsp;(q, r),&nbsp;(s, q)&nbsp;或者&nbsp;(r, s)。</p><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">分别产生顶点朝上布局地图为：</p><div class="col_one_third" style="box-sizing: border-box; width: 245.031px; position: relative; margin-right: 32px; margin-bottom: 50px; float: left; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; line-height: 24px; background-color: #f4f4f4"><img style="box-sizing: border-box; border: 0px; vertical-align: middle; max-width: 100%; display: block; margin: 30px auto; float: none; height: auto" class="alignnone size-full wp-image-10552" src="http://indienova.com/wp-uploads/2016/05/8.png" border="0" alt="8" width="200" height="200" /></div><div class="col_one_third" style="box-sizing: border-box; width: 245.031px; position: relative; margin-right: 32px; margin-bottom: 50px; float: left; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; line-height: 24px; background-color: #f4f4f4"><img style="box-sizing: border-box; border: 0px; vertical-align: middle; max-width: 100%; display: block; margin: 30px auto; float: none; height: auto" class="alignnone size-full wp-image-10553" src="http://indienova.com/wp-uploads/2016/05/9.png" border="0" alt="9" width="200" height="200" /></div><div class="col_one_third col_last" style="box-sizing: border-box; width: 245.031px; position: relative; margin-bottom: 50px; float: left; clear: right; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; line-height: 24px; margin-right: 0px !important; background-color: #f4f4f4"><img style="box-sizing: border-box; border: 0px; vertical-align: middle; max-width: 100%; display: block; margin: 30px auto; float: none; height: auto" class="alignnone size-full wp-image-10554" src="http://indienova.com/wp-uploads/2016/05/10.png" border="0" alt="10" width="200" height="200" /></div><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">边线朝上布局地图为：</p><div class="col_one_third" style="box-sizing: border-box; width: 245.031px; position: relative; margin-right: 32px; margin-bottom: 50px; float: left; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; line-height: 24px; background-color: #f4f4f4"><img style="box-sizing: border-box; border: 0px; vertical-align: middle; max-width: 100%; display: block; margin: 30px auto; float: none; height: auto" class="alignnone size-full wp-image-10555" src="http://indienova.com/wp-uploads/2016/05/11.png" border="0" alt="11" width="200" height="200" /></div><div class="col_one_third" style="box-sizing: border-box; width: 245.031px; position: relative; margin-right: 32px; margin-bottom: 50px; float: left; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; line-height: 24px; background-color: #f4f4f4"><img style="box-sizing: border-box; border: 0px; vertical-align: middle; max-width: 100%; display: block; margin: 30px auto; float: none; height: auto" class="alignnone size-full wp-image-10556" src="http://indienova.com/wp-uploads/2016/05/12.png" border="0" alt="12" width="200" height="200" /></div><div class="col_one_third col_last" style="box-sizing: border-box; width: 245.031px; position: relative; margin-bottom: 50px; float: left; clear: right; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; line-height: 24px; margin-right: 0px !important; background-color: #f4f4f4"><img style="box-sizing: border-box; border: 0px; vertical-align: middle; max-width: 100%; display: block; margin: 30px auto; float: none; height: auto" class="alignnone size-full wp-image-10557" src="http://indienova.com/wp-uploads/2016/05/13.png" border="0" alt="13" width="200" height="200" /></div><h6 style="box-sizing: border-box; font-family: Raleway, sans-serif; line-height: 1.5; color: #444444; margin: 0px 0px 20px; font-size: 12px; background-color: #f4f4f4">三角形</h6><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">三角形有两种朝向，在代码中需要考虑你具体选择哪种朝向。假定 y 轴方向朝下，当使用顶点朝上布局时，这些三角形将面朝南边/西北/东北：</p><pre class="prettyprint" style="box-sizing: border-box; overflow: auto; font-size: 13px; line-height: 20px; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; padding: 10px 15px; margin-bottom: 20px; word-break: break-all; word-wrap: break-word; border: 1px solid #e1e1e8; border-radius: 4px; white-space: pre-wrap; margin-top: 0px !important"><span style="box-sizing: border-box" class="pln">unordered_set</span><span style="box-sizing: border-box" class="pln"> map</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">for</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> q </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #195f91" class="lit">0</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln"> q </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&lt;=</span><span style="box-sizing: border-box" class="pln"> map_size</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln"> q</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">++)</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">for</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> r </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #195f91" class="lit">0</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln"> r </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&lt;=</span><span style="box-sizing: border-box" class="pln"> map_size </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">-</span><span style="box-sizing: border-box" class="pln"> q</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln"> r</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">++)</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; map</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">insert</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Hex</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">q</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> r</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">-</span><span style="box-sizing: border-box" class="pln">q</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">-</span><span style="box-sizing: border-box" class="pln">r</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">));</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#125;</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#125;</span></pre><div class="col_half" style="box-sizing: border-box; width: 384px; position: relative; margin-right: 32px; margin-bottom: 50px; float: left; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; line-height: 24px; background-color: #f4f4f4"><img style="box-sizing: border-box; border: 0px; vertical-align: middle; max-width: 100%; display: block; margin: 30px auto; float: none; height: auto" class="alignnone size-full wp-image-10558" src="http://indienova.com/wp-uploads/2016/05/14.png" border="0" alt="14" width="300" height="200" /></div><div class="col_half col_last" style="box-sizing: border-box; width: 384px; position: relative; margin-bottom: 50px; float: left; clear: right; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; line-height: 24px; margin-right: 0px !important; background-color: #f4f4f4"><img style="box-sizing: border-box; border: 0px; vertical-align: middle; max-width: 100%; display: block; margin: 30px auto; float: none; height: auto" class="alignnone size-full wp-image-10559" src="http://indienova.com/wp-uploads/2016/05/15.png" border="0" alt="15" width="300" height="200" /></div><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">而在边线朝上布局中，这些三角形面朝东边/西北/西南：</p><pre class="prettyprint" style="box-sizing: border-box; overflow: auto; font-size: 13px; line-height: 20px; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; padding: 10px 15px; margin-bottom: 20px; word-break: break-all; word-wrap: break-word; border: 1px solid #e1e1e8; border-radius: 4px; white-space: pre-wrap; margin-top: 0px !important"><span style="box-sizing: border-box" class="pln">unordered_set</span><span style="box-sizing: border-box" class="pln"> map</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">for</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> q </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #195f91" class="lit">0</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln"> q </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&lt;=</span><span style="box-sizing: border-box" class="pln"> map_size</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln"> q</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">++)</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">for</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> r </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box" class="pln"> map_size </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">-</span><span style="box-sizing: border-box" class="pln"> q</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln"> r </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&lt;=</span><span style="box-sizing: border-box" class="pln"> map_size</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln"> r</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">++)</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; map</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">insert</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Hex</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">q</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> r</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">-</span><span style="box-sizing: border-box" class="pln">q</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">-</span><span style="box-sizing: border-box" class="pln">r</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">));</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#125;</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#125;</span></pre><div class="col_half" style="box-sizing: border-box; width: 384px; position: relative; margin-right: 32px; margin-bottom: 50px; float: left; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; line-height: 24px; background-color: #f4f4f4"><img style="box-sizing: border-box; border: 0px; vertical-align: middle; max-width: 100%; display: block; margin: 30px auto; float: none; height: auto" class="alignnone size-full wp-image-10560" src="http://indienova.com/wp-uploads/2016/05/16.png" border="0" alt="16" width="300" height="200" /></div><div class="col_half col_last" style="box-sizing: border-box; width: 384px; position: relative; margin-bottom: 50px; float: left; clear: right; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; line-height: 24px; margin-right: 0px !important; background-color: #f4f4f4"><img style="box-sizing: border-box; border: 0px; vertical-align: middle; max-width: 100%; display: block; margin: 30px auto; float: none; height: auto" class="alignnone size-full wp-image-10561" src="http://indienova.com/wp-uploads/2016/05/17.png" border="0" alt="17" width="300" height="200" /></div><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">如果反转 y 轴方向，只需在代码中调换南北方向即可。</p><h6 style="box-sizing: border-box; font-family: Raleway, sans-serif; line-height: 1.5; color: #444444; margin: 0px 0px 20px; font-size: 12px; background-color: #f4f4f4">六边形</h6><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">六角网格大观中我演示了如何生成六边形的地图：</p><pre class="prettyprint" style="box-sizing: border-box; overflow: auto; font-size: 13px; line-height: 20px; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; padding: 10px 15px; margin-bottom: 20px; word-break: break-all; word-wrap: break-word; border: 1px solid #e1e1e8; border-radius: 4px; white-space: pre-wrap; margin-top: 0px !important"><span style="box-sizing: border-box" class="pln">unordered_set</span><span style="box-sizing: border-box" class="pln"> map</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">for</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> q </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">-</span><span style="box-sizing: border-box" class="pln">map_radius</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln"> q </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&lt;=</span><span style="box-sizing: border-box" class="pln"> map_radius</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln"> q</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">++)</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> r1 </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box" class="pln"> max</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(-</span><span style="box-sizing: border-box" class="pln">map_radius</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">-</span><span style="box-sizing: border-box" class="pln">q </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">-</span><span style="box-sizing: border-box" class="pln"> map_radius</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">);</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> r2 </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box" class="pln"> min</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">map_radius</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">-</span><span style="box-sizing: border-box" class="pln">q </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">+</span><span style="box-sizing: border-box" class="pln"> map_radius</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">);</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">for</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> r </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box" class="pln"> r1</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln"> r </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&lt;=</span><span style="box-sizing: border-box" class="pln"> r2</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln"> r</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">++)</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; map</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">insert</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Hex</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">q</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> r</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">-</span><span style="box-sizing: border-box" class="pln">q</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">-</span><span style="box-sizing: border-box" class="pln">r</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">));</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#125;</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#125;</span></pre><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">下面分别是顶点朝上布局和边线朝上布局的地图：</p><div class="col_half" style="box-sizing: border-box; width: 384px; position: relative; margin-right: 32px; margin-bottom: 50px; float: left; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; line-height: 24px; background-color: #f4f4f4"><img style="box-sizing: border-box; border: 0px; vertical-align: middle; max-width: 100%; display: block; margin: 30px auto; float: none; height: auto" class="alignnone size-full wp-image-10563" src="http://indienova.com/wp-uploads/2016/05/18.png" border="0" alt="18" width="300" height="200" /></div><div class="col_half col_last" style="box-sizing: border-box; width: 384px; position: relative; margin-bottom: 50px; float: left; clear: right; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; line-height: 24px; margin-right: 0px !important; background-color: #f4f4f4"><img style="box-sizing: border-box; border: 0px; vertical-align: middle; max-width: 100%; display: block; margin: 30px auto; float: none; height: auto" class="alignnone size-full wp-image-10564" src="http://indienova.com/wp-uploads/2016/05/19.png" border="0" alt="19" width="300" height="200" /></div><h6 style="box-sizing: border-box; font-family: Raleway, sans-serif; line-height: 1.5; color: #444444; margin: 0px 0px 20px; font-size: 12px; background-color: #f4f4f4">矩形</h6><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">在轴坐标/立方坐标中，生成四边形的地图略微有些棘手。六角网格大观中给了立方坐标生成六边形地图的一个方案，但是我当时并没有给出具体的代码，这里我将它写出来，如下所示：</p><pre class="prettyprint" style="box-sizing: border-box; overflow: auto; font-size: 13px; line-height: 20px; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; padding: 10px 15px; margin-bottom: 20px; word-break: break-all; word-wrap: break-word; border: 1px solid #e1e1e8; border-radius: 4px; white-space: pre-wrap; margin-top: 0px !important"><span style="box-sizing: border-box" class="pln">unordered_set</span><span style="box-sizing: border-box" class="pln"> map</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">for</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> r </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #195f91" class="lit">0</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln"> r </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&lt;</span><span style="box-sizing: border-box" class="pln"> map_height</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln"> r</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">++)</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> r_offset </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box" class="pln"> floor</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">r</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">/</span><span style="box-sizing: border-box; color: #195f91" class="lit">2</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">);</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #999999" class="com">// or r&gt;&gt;1</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">for</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> q </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">-</span><span style="box-sizing: border-box" class="pln">r_offset</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln"> q </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&lt;</span><span style="box-sizing: border-box" class="pln"> map_width </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">-</span><span style="box-sizing: border-box" class="pln"> r_offset</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln"> q</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">++)</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; map</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">insert</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Hex</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">q</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> r</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">-</span><span style="box-sizing: border-box" class="pln">q</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">-</span><span style="box-sizing: border-box" class="pln">r</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">));</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#125;</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#125;</span></pre><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">和前面一样，我会从&nbsp;q, r, s&nbsp;中选出两个用于循环，但这一次顺序至关重要，因为外层与内层的循环是有所区别的。下面是使用顶点朝上布局，将&nbsp;(outer, inner)&nbsp;循环设置为&nbsp;(r, q), (q, s), (s, r), (q, r), (s, q), (r, s)&nbsp;时生成的地图：</p><div class="col_one_third" style="box-sizing: border-box; width: 245.031px; position: relative; margin-right: 32px; margin-bottom: 50px; float: left; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; line-height: 24px; background-color: #f4f4f4"><img style="box-sizing: border-box; border: 0px; vertical-align: middle; max-width: 100%; display: block; margin: 30px auto; float: none; height: auto" class="alignnone size-full wp-image-10565" src="http://indienova.com/wp-uploads/2016/05/20.png" border="0" alt="20" width="200" height="200" /></div><div class="col_one_third" style="box-sizing: border-box; width: 245.031px; position: relative; margin-right: 32px; margin-bottom: 50px; float: left; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; line-height: 24px; background-color: #f4f4f4"><img style="box-sizing: border-box; border: 0px; vertical-align: middle; max-width: 100%; display: block; margin: 30px auto; float: none; height: auto" class="alignnone size-full wp-image-10566" src="http://indienova.com/wp-uploads/2016/05/21.png" border="0" alt="21" width="200" height="200" /></div><div class="col_one_third col_last" style="box-sizing: border-box; width: 245.031px; position: relative; margin-bottom: 50px; float: left; clear: right; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; line-height: 24px; margin-right: 0px !important; background-color: #f4f4f4"><img style="box-sizing: border-box; border: 0px; vertical-align: middle; max-width: 100%; display: block; margin: 30px auto; float: none; height: auto" class="alignnone size-full wp-image-10567" src="http://indienova.com/wp-uploads/2016/05/22.png" border="0" alt="22" width="200" height="200" /></div><div class="col_one_third" style="box-sizing: border-box; width: 245.031px; position: relative; margin-right: 32px; margin-bottom: 50px; float: left; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; line-height: 24px; background-color: #f4f4f4"><img style="box-sizing: border-box; border: 0px; vertical-align: middle; max-width: 100%; display: block; margin: 30px auto; float: none; height: auto" class="alignnone size-full wp-image-10568" src="http://indienova.com/wp-uploads/2016/05/23.png" border="0" alt="23" width="200" height="200" /></div><div class="col_one_third" style="box-sizing: border-box; width: 245.031px; position: relative; margin-right: 32px; margin-bottom: 50px; float: left; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; line-height: 24px; background-color: #f4f4f4"><img style="box-sizing: border-box; border: 0px; vertical-align: middle; max-width: 100%; display: block; margin: 30px auto; float: none; height: auto" class="alignnone size-full wp-image-10569" src="http://indienova.com/wp-uploads/2016/05/25.png" border="0" alt="25" width="200" height="200" /></div><div class="col_one_third col_last" style="box-sizing: border-box; width: 245.031px; position: relative; margin-bottom: 50px; float: left; clear: right; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; line-height: 24px; margin-right: 0px !important; background-color: #f4f4f4"><img style="box-sizing: border-box; border: 0px; vertical-align: middle; max-width: 100%; display: block; margin: 30px auto; float: none; height: auto" class="alignnone size-full wp-image-10570" src="http://indienova.com/wp-uploads/2016/05/26.png" border="0" alt="26" width="200" height="200" /></div><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">他们的确都是四边形，但他们不用都得与 x， y 轴方向对齐！你们大多数人可能会希望得到第一种地图，也就是&nbsp;r&nbsp;作为外层循环参数而&nbsp;q&nbsp;作为内层循环参数。</p><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">那么使用边线朝上布局时又怎么样呢？当&nbsp;(outer, inner)&nbsp;循环参数分别为&nbsp;(r, q), (q, s), (s, r), (q, r), (s, q), (r, s)&nbsp;时地图如下所示：</p><div class="col_one_third" style="box-sizing: border-box; width: 245.031px; position: relative; margin-right: 32px; margin-bottom: 50px; float: left; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; line-height: 24px; background-color: #f4f4f4"><img style="box-sizing: border-box; border: 0px; vertical-align: middle; max-width: 100%; display: block; margin: 30px auto; float: none; height: auto" class="alignnone size-full wp-image-10571" src="http://indienova.com/wp-uploads/2016/05/27.png" border="0" alt="27" width="200" height="200" /></div><div class="col_one_third" style="box-sizing: border-box; width: 245.031px; position: relative; margin-right: 32px; margin-bottom: 50px; float: left; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; line-height: 24px; background-color: #f4f4f4"><img style="box-sizing: border-box; border: 0px; vertical-align: middle; max-width: 100%; display: block; margin: 30px auto; float: none; height: auto" class="alignnone size-full wp-image-10572" src="http://indienova.com/wp-uploads/2016/05/28.png" border="0" alt="28" width="200" height="200" /></div><div class="col_one_third col_last" style="box-sizing: border-box; width: 245.031px; position: relative; margin-bottom: 50px; float: left; clear: right; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; line-height: 24px; margin-right: 0px !important; background-color: #f4f4f4"><img style="box-sizing: border-box; border: 0px; vertical-align: middle; max-width: 100%; display: block; margin: 30px auto; float: none; height: auto" class="alignnone size-full wp-image-10573" src="http://indienova.com/wp-uploads/2016/05/29.png" border="0" alt="29" width="200" height="200" /></div><div class="col_one_third" style="box-sizing: border-box; width: 245.031px; position: relative; margin-right: 32px; margin-bottom: 50px; float: left; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; line-height: 24px; background-color: #f4f4f4"><img style="box-sizing: border-box; border: 0px; vertical-align: middle; max-width: 100%; display: block; margin: 30px auto; float: none; height: auto" class="alignnone size-full wp-image-10574" src="http://indienova.com/wp-uploads/2016/05/30.png" border="0" alt="30" width="200" height="200" /></div><div class="col_one_third" style="box-sizing: border-box; width: 245.031px; position: relative; margin-right: 32px; margin-bottom: 50px; float: left; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; line-height: 24px; background-color: #f4f4f4"><img style="box-sizing: border-box; border: 0px; vertical-align: middle; max-width: 100%; display: block; margin: 30px auto; float: none; height: auto" class="alignnone size-full wp-image-10575" src="http://indienova.com/wp-uploads/2016/05/31.png" border="0" alt="31" width="200" height="200" /></div><div class="col_one_third col_last" style="box-sizing: border-box; width: 245.031px; position: relative; margin-bottom: 50px; float: left; clear: right; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; line-height: 24px; margin-right: 0px !important; background-color: #f4f4f4"><img style="box-sizing: border-box; border: 0px; vertical-align: middle; max-width: 100%; display: block; margin: 30px auto; float: none; height: auto" class="alignnone size-full wp-image-10576" src="http://indienova.com/wp-uploads/2016/05/32.png" border="0" alt="32" width="200" height="200" /></div><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">为了得到第四种地图，你可以使用&nbsp;q&nbsp;作为外层循环参数，&nbsp;作为内层循环参数&nbsp;然后调换宽高：</p><pre class="prettyprint" style="box-sizing: border-box; overflow: auto; font-size: 13px; line-height: 20px; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; padding: 10px 15px; margin-bottom: 20px; word-break: break-all; word-wrap: break-word; border: 1px solid #e1e1e8; border-radius: 4px; white-space: pre-wrap; margin-top: 0px !important"><span style="box-sizing: border-box" class="pln">unordered_set</span><span style="box-sizing: border-box" class="pln"> map</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">for</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> q </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #195f91" class="lit">0</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln"> q </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&lt;</span><span style="box-sizing: border-box" class="pln"> map_width</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln"> q</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">++)</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> q_offset </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box" class="pln"> floor</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">q</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">/</span><span style="box-sizing: border-box; color: #195f91" class="lit">2</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">);</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #999999" class="com">// or q&gt;&gt;1</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">for</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> r </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">-</span><span style="box-sizing: border-box" class="pln">q_offset</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln"> r </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&lt;</span><span style="box-sizing: border-box" class="pln"> map_height </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">-</span><span style="box-sizing: border-box" class="pln"> q_offset</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln"> r</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">++)</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; map</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">insert</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Hex</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">q</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> r</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">-</span><span style="box-sizing: border-box" class="pln">q</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">-</span><span style="box-sizing: border-box" class="pln">r</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">));</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#125;</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#125;</span></pre><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">这两种版本的代码会产生本质上相同，但细节处稍有区别的形状。你可能需要多做一些实验才能得到精确满足你需求的地图形状。例如，你可以试着将偏移设为&nbsp;floor((q+1)/2)&nbsp;或者&nbsp;floor((q-1)/2)&nbsp;而非&nbsp;floor(q/2)，以观察地图边界如何发生轻微的变化。</p><h5 style="box-sizing: border-box; font-family: Raleway, sans-serif; line-height: 1.5; color: #444444; margin: 0px 0px 20px; font-size: 14px; background-color: #f4f4f4">优化存储</h5><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">哈希表是一个相当通用的解决方案，并且适用于任何一种地图形状，甚至适用于一些奇形怪状，中间带空洞的地图形状。你可以将其作为一个节点-边类型的图来查看它，使用&nbsp;hex_neighbor&nbsp;来存储节点，并且显式地临时计算节点之间的边。</p><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">还有一种方法也可以用于存储节点-边类型的图结构，预先计算所有的边并且显式地存储它们。每一个节点都有一个整型id，并且我们会使用数组的数组来存储接壤的节点。或者每一个节点都是一个对象，我们使用它的一个字段来储存相邻节点的列表。这种图的拓扑结构也具有通用性，可以适用于任何形状的地图。你也可以对其使用各种基于图论的算法，可以用来求解移动范围，地图距离或者路径搜寻等诸多问题。如果地图形状规则或者经常会被编辑修改，那么隐式地存储边的数据也不会有什么问题；如果地图形状不规则(有界，有墙壁，有空洞等等)而且不会经常变动，那么还是显式储存边的数据为好。</p><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">某些地图形状也可以使用紧凑的2维数组或者1维数组来存储。六角大观中为此给出了可视化的演示。这里，我再给出一个代码范例。主要的思想是无论对哪种地图形状来说，代码中都会包含嵌套的循环：</p><pre class="prettyprint" style="box-sizing: border-box; overflow: auto; font-size: 13px; line-height: 20px; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; padding: 10px 15px; margin-bottom: 20px; word-break: break-all; word-wrap: break-word; border: 1px solid #e1e1e8; border-radius: 4px; white-space: pre-wrap; margin-top: 0px !important"><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">for</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> a </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box" class="pln"> a1</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln"> a </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&lt;</span><span style="box-sizing: border-box" class="pln"> a2</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln"> a</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">++)</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">for</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> b </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box" class="pln"> b1</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln"> b </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&lt;</span><span style="box-sizing: border-box" class="pln"> b2</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln"> b</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">++)</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">...</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#125;</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#125;</span></pre><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">如果要紧凑地存储地图数据，我会使用数组的数组，并且使用形如&nbsp;array[a-a1][b-b1]&nbsp;的索引。例如，下面是四边形的代码：</p><pre class="prettyprint" style="box-sizing: border-box; overflow: auto; font-size: 13px; line-height: 20px; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; padding: 10px 15px; margin-bottom: 20px; word-break: break-all; word-wrap: break-word; border: 1px solid #e1e1e8; border-radius: 4px; white-space: pre-wrap; margin-top: 0px !important"><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">for</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> r </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #195f91" class="lit">0</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln"> r </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&lt;</span><span style="box-sizing: border-box" class="pln"> height</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln"> r</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">++)</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> r_offset </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box" class="pln"> floor</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">r</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">/</span><span style="box-sizing: border-box; color: #195f91" class="lit">2</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">);</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">for</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> q </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">-</span><span style="box-sizing: border-box" class="pln">r_offset</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln"> q </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&lt;</span><span style="box-sizing: border-box" class="pln"> width </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">-</span><span style="box-sizing: border-box" class="pln"> r_offset</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln"> q</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">++)</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; map</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">insert</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Hex</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">q</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> r</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">-</span><span style="box-sizing: border-box" class="pln">q</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">-</span><span style="box-sizing: border-box" class="pln">r</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">));</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#125;</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#125;</span></pre><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">变量&nbsp;a&nbsp;表示&nbsp;r，而变量&nbsp;b&nbsp;为&nbsp;q。数值&nbsp;a1&nbsp;为 0 而&nbsp;b1&nbsp;为&nbsp;-floor(r/2)， 即&nbsp;array[r-0][q-(-floor(r/2))]&nbsp;，因此可以被简化成&nbsp;array[r][q+floor(r/2)]。注意&nbsp;floor(r/2)&nbsp;中&nbsp;r &gt;&gt; 1。</p><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">此外，我还需要知道数组的大小&nbsp;size。我需要&nbsp;a2-a1&nbsp;个数组，而每个数组的大小应该是&nbsp;b2-b1。(务必小心检查偏移1的错误:如果循环之中&nbsp;a &lt;= a2&nbsp;你会需要&nbsp;a2-a1+1&nbsp;个数组，类似还有&nbsp;b &lt;= b2&nbsp;的情况。)我可以使用 C++ 矢量模板来建立这些数组：</p><pre class="prettyprint" style="box-sizing: border-box; overflow: auto; font-size: 13px; line-height: 20px; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; padding: 10px 15px; margin-bottom: 20px; word-break: break-all; word-wrap: break-word; border: 1px solid #e1e1e8; border-radius: 4px; white-space: pre-wrap; margin-top: 0px !important"><span style="box-sizing: border-box" class="pln">vector</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&gt;</span><span style="box-sizing: border-box" class="pln"> map</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">height</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">);</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">for</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> r </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #195f91" class="lit">0</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln"> r </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&lt;</span><span style="box-sizing: border-box" class="pln"> height</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln"> r</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">++)</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; map</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">emplace_back</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">width</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">);</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#125;</span></pre><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">我可以将它们封装到&nbsp;Map&nbsp;类中：</p><pre class="prettyprint" style="box-sizing: border-box; overflow: auto; font-size: 13px; line-height: 20px; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; padding: 10px 15px; margin-bottom: 20px; word-break: break-all; word-wrap: break-word; border: 1px solid #e1e1e8; border-radius: 4px; white-space: pre-wrap; margin-top: 0px !important"><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">template</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">class</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">RectangularPointyTopMap</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; vector</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&gt;</span><span style="box-sizing: border-box" class="pln"> map</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">public</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">:</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Map</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> width</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> height</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">):</span><span style="box-sizing: border-box" class="pln"> map</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">height</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">for</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> r </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #195f91" class="lit">0</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln"> r </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&lt;</span><span style="box-sizing: border-box" class="pln"> height</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln"> r</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">++)</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; map</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">emplace_back</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">width</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">);</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#125;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#125;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">inline</span><span style="box-sizing: border-box" class="pln"> T</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&amp;</span><span style="box-sizing: border-box" class="pln"> at</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> q</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> r</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">return</span><span style="box-sizing: border-box" class="pln"> map</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">[</span><span style="box-sizing: border-box" class="pln">r</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">][</span><span style="box-sizing: border-box" class="pln">q </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">+</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">r </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&gt;&gt;</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #195f91" class="lit">1</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)];</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#125;</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#125;;</span></pre><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">如果是其他类型的地图形状，可能会略微复杂一些，但还是遵循相同的模式：为了确定地图的大小，解决数组访问的问题，我必须研究创建地图的循环代码。</p><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">如果使用1维数组会显得棘手一些，因此我这里就不展开说了。我自己的多数项目中会使用基于图论的表示方法，它具有最大的灵活性和可重用性。当存储空间比较紧要的时候我只需要考虑使用更加紧凑的地图存储格式就好了。</p><h4 style="box-sizing: border-box; font-family: Raleway, sans-serif; line-height: 1.5; color: #444444; margin: 0px 0px 20px; font-size: 18px; padding-top: 30px; padding-bottom: 15px; border-bottom-width: 1px; border-bottom-style: dotted; border-bottom-color: #0088cc; background-color: #f4f4f4">偏移坐标</h4><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">在六角网格大观一文中我使用&nbsp;q&nbsp;和&nbsp;r&nbsp;来存放偏移坐标，但由于我也将其用于立方坐标系和轴坐标系中，所以这里我就改用&nbsp;col&nbsp;与&nbsp;row:</p><pre class="prettyprint" style="box-sizing: border-box; overflow: auto; font-size: 13px; line-height: 20px; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; padding: 10px 15px; margin-bottom: 20px; word-break: break-all; word-wrap: break-word; border: 1px solid #e1e1e8; border-radius: 4px; white-space: pre-wrap; margin-top: 0px !important"><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">struct</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">OffsetCoord</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">const</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> col</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> row</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">OffsetCoord</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> col_</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> row_</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">):</span><span style="box-sizing: border-box" class="pln"> col</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">col_</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">),</span><span style="box-sizing: border-box" class="pln"> row</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">row_</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;&#125;</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#125;;</span></pre><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">我希望能把立方坐标系与轴坐标系使用的&nbsp;Hex&nbsp;类用于除了玩家看到的显示位置(那里还是偏移坐标更有用武之地)之外的所有地方。这也就是说，我需要编写&nbsp;Hex&nbsp;与&nbsp;OffsetCoord&nbsp;之间相互转换的代码。</p><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">有四种偏移坐标系类型：奇行，偶行，奇列，偶列。行类型使用顶点朝上布局，而列类型使用边线朝上布局。偶类型偏移为 +1，而奇类型偏移为 -1:</p><pre class="prettyprint" style="box-sizing: border-box; overflow: auto; font-size: 13px; line-height: 20px; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; padding: 10px 15px; margin-bottom: 20px; word-break: break-all; word-wrap: break-word; border: 1px solid #e1e1e8; border-radius: 4px; white-space: pre-wrap; margin-top: 0px !important"><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">const</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> EVEN </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #195f91" class="lit">1</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">const</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> ODD </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">-</span><span style="box-sizing: border-box; color: #195f91" class="lit">1</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;</span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">OffsetCoord</span><span style="box-sizing: border-box" class="pln"> qoffset_from_cube</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> offset</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Hex</span><span style="box-sizing: border-box" class="pln"> h</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> col </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box" class="pln"> h</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">q</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> row </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box" class="pln"> h</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">r </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">+</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">((</span><span style="box-sizing: border-box" class="pln">h</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">q </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">+</span><span style="box-sizing: border-box" class="pln"> offset </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">*</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">h</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">q </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&amp;</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #195f91" class="lit">1</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">))</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">/</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #195f91" class="lit">2</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">);</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">return</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">OffsetCoord</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">col</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> row</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">);</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#125;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;</span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Hex</span><span style="box-sizing: border-box" class="pln"> qoffset_to_cube</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> offset</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">OffsetCoord</span><span style="box-sizing: border-box" class="pln"> h</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> q </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box" class="pln"> h</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">col</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> r </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box" class="pln"> h</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">row </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">-</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">((</span><span style="box-sizing: border-box" class="pln">h</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">col </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">+</span><span style="box-sizing: border-box" class="pln"> offset </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">*</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">h</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">col </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&amp;</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #195f91" class="lit">1</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">))</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">/</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #195f91" class="lit">2</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">);</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> s </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">-</span><span style="box-sizing: border-box" class="pln">q </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">-</span><span style="box-sizing: border-box" class="pln"> r</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">return</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Hex</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">q</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> r</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> s</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">);</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#125;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;</span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">OffsetCoord</span><span style="box-sizing: border-box" class="pln"> roffset_from_cube</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> offset</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Hex</span><span style="box-sizing: border-box" class="pln"> h</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> col </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box" class="pln"> h</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">q </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">+</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">((</span><span style="box-sizing: border-box" class="pln">h</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">r </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">+</span><span style="box-sizing: border-box" class="pln"> offset </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">*</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">h</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">r </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&amp;</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #195f91" class="lit">1</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">))</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">/</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #195f91" class="lit">2</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">);</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> row </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box" class="pln"> h</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">r</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">return</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">OffsetCoord</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">col</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> row</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">);</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#125;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;</span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Hex</span><span style="box-sizing: border-box" class="pln"> roffset_to_cube</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> offset</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">OffsetCoord</span><span style="box-sizing: border-box" class="pln"> h</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#123;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> q </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box" class="pln"> h</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">col </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">-</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">((</span><span style="box-sizing: border-box" class="pln">h</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">row </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">+</span><span style="box-sizing: border-box" class="pln"> offset </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">*</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">h</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">row </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&amp;</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #195f91" class="lit">1</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">))</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">/</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #195f91" class="lit">2</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">);</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> r </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box" class="pln"> h</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box" class="pln">row</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">int</span><span style="box-sizing: border-box" class="pln"> s </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">-</span><span style="box-sizing: border-box" class="pln">q </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">-</span><span style="box-sizing: border-box" class="pln"> r</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; color: #2f6f9f" class="kwd">return</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #4f9fcf" class="typ">Hex</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box" class="pln">q</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> r</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box" class="pln"> s</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">);</span><span style="box-sizing: border-box" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&#125;</span></pre><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">如果你仅使用奇偶两种类型中的一种，可以将偏移量硬编码到代码之中，这样可以让代码更为简单快速。抑或你可以将偏移量&nbsp;offset&nbsp;作为模板参数，这样可以让编译器内联它从而优化代码。</p><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">使用偏移坐标系时我需要知道行列数的奇偶性，我们使用&nbsp;a&amp;1&nbsp;而不用&nbsp;a%2&nbsp;来返回&nbsp;0&nbsp;或者&nbsp;+1，为什么呢？</p><ul style="box-sizing: border-box; margin: 0px 0px 30px; padding: 0px 0px 0px 40px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; line-height: 24px; background-color: #f4f4f4"><li style="box-sizing: border-box; margin: 0px; padding: 0px">如果是使用补码的系统(几乎囊括目前大多数的系统)，当&nbsp;a&nbsp;为偶数时&nbsp;a&amp;1&nbsp;会返回&nbsp;0，为奇数时会返回&nbsp;1。这正是我想要的结果。虽然严格来说，它也并非是完全可移植的。</li><li style="box-sizing: border-box; margin: 0px; padding: 0px">在某些语言中，包括&nbsp;C++&nbsp;在内，a%2&nbsp;计算的是余数而非模数。如果&nbsp;a&nbsp;为&nbsp;-1，我们知道这是一个奇数，我们希望&nbsp;a%2&nbsp;返回&nbsp;1， 然而一些系统却会返回&nbsp;-1。如果你使用的语言可以计算模数，那就放心大胆使用&nbsp;a%2&nbsp;就好。</li><li style="box-sizing: border-box; margin: 0px; padding: 0px">如果你使用的坐标数值永远都不可能为负数，用&nbsp;a%2&nbsp;也不会出什么问题。</li><li style="box-sizing: border-box; margin: 0px; padding: 0px">如果你使用的语言里没有&nbsp;a&amp;1&nbsp;可用，可以用&nbsp;abs(a) % 2作为替代。</li></ul><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">此外，在很多(或者说所有？)语言中，&amp;&nbsp;的优先级都比&nbsp;+&nbsp;低，所以最好在&nbsp;a&amp;1&nbsp;外加上圆括号。</p><h4 style="box-sizing: border-box; font-family: Raleway, sans-serif; line-height: 1.5; color: #444444; margin: 0px 0px 20px; font-size: 18px; padding-top: 30px; padding-bottom: 15px; border-bottom-width: 1px; border-bottom-style: dotted; border-bottom-color: #0088cc; background-color: #f4f4f4">附记</h4><h5 style="box-sizing: border-box; font-family: Raleway, sans-serif; line-height: 1.5; color: #444444; margin: 0px 0px 20px; font-size: 14px; background-color: #f4f4f4">立方坐标 VS 轴坐标</h5><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">立方网格坐标包含三个数字，但其中一个在约束条件下可以通过另外两个求出。选择将其存放进第三个字段或者选择在访问函数计算它基本上只是代码风格的区别。如果非常关注性能问题，就有必须仔细考虑到底是使用寄存器还是临时计算结果节约开销了。在 C++ 这样的语言中，只要能使用寄存器和内联方法，就应该尽可能使用它，以节约内存(毕竟访问 RAM 的开销十分昂贵)。在有些语言中，例如 Python，使用寄存器的性能开销也不小，这时候我们应该减少函数的调用(函数调用开销并不小)，并且在字段中存储第三个坐标。</p><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">另外有兴趣的读者也可以查阅这篇<a style="box-sizing: border-box; color: #0088cc; text-decoration: none !important; background-color: transparent" href="http://cs.ucla.edu/~tianyi.zhang/perfdiff.pdf">论文</a>，它提到使用轴坐标和立方坐标相比使用偏移坐标，会在视线，距离等算法的计算中更快一筹，但在用作显示时会更慢一些(正和我们预料的一样)。但我没能找到他们测试用的代码。</p><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">如果性能真的很重要，最佳做法是实际去测试具体的数据。</p><h5 style="box-sizing: border-box; font-family: Raleway, sans-serif; line-height: 1.5; color: #444444; margin: 0px 0px 20px; font-size: 14px; background-color: #f4f4f4">C++</h5><ul style="box-sizing: border-box; margin: 0px 0px 30px; padding: 0px 0px 0px 40px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; line-height: 24px; background-color: #f4f4f4"><li style="box-sizing: border-box; margin: 0px; padding: 0px">C++ 具有各种数值类型，复制和传递它们的开销都很小。为了让代码更紧凑，如果你的地图不大，可以考虑在&nbsp;Hex或者&nbsp;Offset&nbsp;中使用 int16 或者 int8 的整型。假如你使用寄存器来计算&nbsp;s，并使用 int16 来保存&nbsp;q&nbsp;和&nbsp;r(或是col&nbsp;和&nbsp;row)，那么整个坐标恰好用掉一个32位的字长。</li><p style="box-sizing: border-box; margin: 0px 0px 15px">。</p><li style="box-sizing: border-box; margin: 0px; padding: 0px">正如前文所述，这些类没有默认为空的构造函数，因此它们不会被看作是普通的 POD 对象类型，尽管我觉得把它们当成 POD 对象也没什么关系。如果你更习惯 POD 对象那么就改用默认的构造函数并进行结构体初始化。</li><li style="box-sizing: border-box; margin: 0px; padding: 0px">我本来可以写一个模板类&nbsp;Hex&lt;&gt;，实例化就能得到&nbsp;Hex&nbsp;与&nbsp;Hex。考虑到许多读者可能愿意将代码翻译成其他语言的版本，最后我放弃了这种想法。</li></ul><h5 style="box-sizing: border-box; font-family: Raleway, sans-serif; line-height: 1.5; color: #444444; margin: 0px 0px 20px; font-size: 14px; background-color: #f4f4f4">Python，JavaScript</h5><ul style="box-sizing: border-box; margin: 0px 0px 30px; padding: 0px 0px 0px 40px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; line-height: 24px; background-color: #f4f4f4"><li style="box-sizing: border-box; margin: 0px; padding: 0px">Python 和其他一些动态类型的语言(比如 JS)无需区分&nbsp;Hex&nbsp;与&nbsp;FractionalHex。因此你可以直接使用&nbsp;Hex&nbsp;而无需理会&nbsp;FractionalHex&nbsp;类。</li></ul><h4 style="box-sizing: border-box; font-family: Raleway, sans-serif; line-height: 1.5; color: #444444; margin: 0px 0px 20px; font-size: 18px; padding-top: 30px; padding-bottom: 15px; border-bottom-width: 1px; border-bottom-style: dotted; border-bottom-color: #0088cc; background-color: #f4f4f4">源码</h4><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">我已经用一些语言写了一些还没有优化过的半成品代码，写过一点单元测试，但缺乏详细的文档。不过你可以随意地借鉴和参考它们来编写自己的六角网格库：</p><ul class="org-ul" style="box-sizing: border-box; margin: 0px 0px 30px; padding: 0px 0px 0px 40px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; line-height: 24px; background-color: #f4f4f4"><li style="box-sizing: border-box; margin: 0px; padding: 0px"><a style="box-sizing: border-box; color: #0088cc; text-decoration: none !important; background-color: transparent" href="http://www.indienova.com/indie-game-development/grid-implementation-of-hex/codegen/output/lib.cc">C++</a></li><li style="box-sizing: border-box; margin: 0px; padding: 0px"><a style="box-sizing: border-box; color: #0088cc; text-decoration: none !important; background-color: transparent" href="http://www.indienova.com/indie-game-development/grid-implementation-of-hex/codegen/output/lib.py">Python</a></li><li style="box-sizing: border-box; margin: 0px; padding: 0px"><a style="box-sizing: border-box; color: #0088cc; text-decoration: none !important; background-color: transparent" href="http://www.indienova.com/indie-game-development/grid-implementation-of-hex/codegen/output/lib.js">Javascript</a></li><li style="box-sizing: border-box; margin: 0px; padding: 0px"><a style="box-sizing: border-box; color: #0088cc; text-decoration: none !important; background-color: transparent" href="http://www.indienova.com/indie-game-development/grid-implementation-of-hex/codegen/output/lib.cs">C#</a></li><li style="box-sizing: border-box; margin: 0px; padding: 0px"><a style="box-sizing: border-box; color: #0088cc; text-decoration: none !important; background-color: transparent" href="http://www.indienova.com/indie-game-development/grid-implementation-of-hex/codegen/output/Tests.hx">Haxe</a></li><li style="box-sizing: border-box; margin: 0px; padding: 0px"><a style="box-sizing: border-box; color: #0088cc; text-decoration: none !important; background-color: transparent" href="http://www.indienova.com/indie-game-development/grid-implementation-of-hex/codegen/output/Tests.java">Java</a></li><li style="box-sizing: border-box; margin: 0px; padding: 0px"><a style="box-sizing: border-box; color: #0088cc; text-decoration: none !important; background-color: transparent" href="http://www.indienova.com/indie-game-development/grid-implementation-of-hex/codegen/output/lib.ts">Typescript</a></li><li style="box-sizing: border-box; margin: 0px; padding: 0px"><a style="box-sizing: border-box; color: #0088cc; text-decoration: none !important; background-color: transparent" href="http://www.indienova.com/indie-game-development/grid-implementation-of-hex/codegen/output/lib.lua">Lua</a>&nbsp;5.2; 查看&nbsp;<a style="box-sizing: border-box; color: #0088cc; text-decoration: none !important; background-color: transparent" href="http://www.indienova.com/indie-game-development/grid-implementation-of-hex/codegen/OutputLua.hx">源码</a>中关于 5.1 与 5.3 版本的笔记。</li></ul><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">如果以后能编写 Racket，Rust，Ruby，Haskell，Swift 等其他语言的版本那就更酷了。不过我不知道能不能抽出这个时间。</p><p style="box-sizing: border-box; margin: 0px 0px 15px; line-height: 24px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; background-color: #f4f4f4">下面这些程序库也值得一看，有些包含源码：</p><ul class="org-ul" style="box-sizing: border-box; margin: 0px 0px 30px; padding: 0px 0px 0px 40px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; line-height: 24px; background-color: #f4f4f4"><li style="box-sizing: border-box; margin: 0px; padding: 0px"><a style="box-sizing: border-box; color: #0088cc; text-decoration: none !important; background-color: transparent" href="http://gamelogic.co.za/grids/">GameLogic Grids</a>&nbsp;- Unity - includes more grid types than I knew even existed! Their blog has tons of useful information about grids (hex and others)</li><li style="box-sizing: border-box; margin: 0px; padding: 0px"><a style="box-sizing: border-box; color: #0088cc; text-decoration: none !important; background-color: transparent" href="http://hexgridutilities.codeplex.com/">Hex-Grid Utilities</a>&nbsp;- C# - includes field of view, pathfinding, WinForms</li><li style="box-sizing: border-box; margin: 0px; padding: 0px"><a style="box-sizing: border-box; color: #0088cc; text-decoration: none !important; background-color: transparent" href="https://github.com/tejon/HexCoord">tejon/HexCoord</a>&nbsp;- C#/Unity</li><li style="box-sizing: border-box; margin: 0px; padding: 0px"><a style="box-sizing: border-box; color: #0088cc; text-decoration: none !important; background-color: transparent" href="http://settworks.com/pages/tools/hexkit">HexKit</a>&nbsp;- Unity - the tejon/HexCoord library plus more</li><li style="box-sizing: border-box; margin: 0px; padding: 0px"><a style="box-sizing: border-box; color: #0088cc; text-decoration: none !important; background-color: transparent" href="https://github.com/dpc/hex2d-rs">dpc/hex2d-rs</a>&nbsp;- Rust</li><li style="box-sizing: border-box; margin: 0px; padding: 0px"><a style="box-sizing: border-box; color: #0088cc; text-decoration: none !important; background-color: transparent" href="https://github.com/Hexworks/hexameter">Hexworks/hexameter</a>&nbsp;- Java</li><li style="box-sizing: border-box; margin: 0px; padding: 0px"><a style="box-sizing: border-box; color: #0088cc; text-decoration: none !important; background-color: transparent" href="https://github.com/denizztret/ObjectiveHexagon">denizztret/ObjectiveHexagon</a>&nbsp;- Objective C</li><li style="box-sizing: border-box; margin: 0px; padding: 0px"><a style="box-sizing: border-box; color: #777777; outline: 0px; background-color: transparent" href="https://github.com/Sscchhmueptfter/HexUtils">Sscchhmueptfter/HexUtils</a>&nbsp;- Java</li><li style="box-sizing: border-box; margin: 0px; padding: 0px"><a style="box-sizing: border-box; color: #0088cc; text-decoration: none !important; background-color: transparent" href="https://github.com/mpalmerlee/HexagonTools">mpalmerlee/HexagonTools</a>&nbsp;- Javascript</li><li style="box-sizing: border-box; margin: 0px; padding: 0px"><a style="box-sizing: border-box; color: #0088cc; text-decoration: none !important; background-color: transparent" href="https://github.com/timgilbert/scala-hexmap">timgilbert/scala-hexmap</a>&nbsp;- Scala</li><li style="box-sizing: border-box; margin: 0px; padding: 0px"><a style="box-sizing: border-box; color: #0088cc; text-decoration: none !important; background-color: transparent" href="https://github.com/mhwombat/grid/wiki">mhwombat/grid</a>&nbsp;- Haskell - includes square, triangle, hexagonal, octagonal grids</li><li style="box-sizing: border-box; margin: 0px; padding: 0px"><a style="box-sizing: border-box; color: #0088cc; text-decoration: none !important; background-color: transparent" href="https://github.com/DigitalMachinist/HexGrid">DigitalMachinist/HexGrid</a>&nbsp;- C#</li><li style="box-sizing: border-box; margin: 0px; padding: 0px"><a style="box-sizing: border-box; color: #0088cc; text-decoration: none !important; background-color: transparent" href="https://github.com/RobertBrewitz/axial-hexagonal-grid">RobertBrewitz/axial-hexagonal-grid</a>&nbsp;- Javascript</li><li style="box-sizing: border-box; margin: 0px; padding: 0px"><a style="box-sizing: border-box; color: #0088cc; text-decoration: none !important; background-color: transparent" href="https://github.com/Amaranthos/UnityHexGrid/">Amaranthos/UnityHexGrid</a>&nbsp;- C#/Unity</li><li style="box-sizing: border-box; margin: 0px; padding: 0px"><a style="box-sizing: border-box; color: #0088cc; text-decoration: none !important; background-color: transparent" href="https://github.com/icrawler/HexaMoon">icrawler/Hexamoon</a>&nbsp;- Lua</li></ul></div>
]]>
</description>
</item>
</channel>
</rss>