<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-cn">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="Content-Language" content="UTF-8" />
<meta content="all" name="robots" />
<meta name="author" content="流浪的龙－个人知识管理" />
<meta name="description" content="" />
<meta name="keywords" content="bo-blog" />
<xbasehref="http://i.renjihe.com/blog/" />
<link rel="alternate" title="流浪的龙－个人知识管理" href="feed.php" type="application/rss+xml" />
<link rel="stylesheet" rev="stylesheet" href="styles.css" tppabs="http://i.renjihe.com/blog/template/default/styles.css" type="text/css" media="all" />

<title>API_HOOK_金山词霸取词功能原理 - 流浪的龙－个人知识管理 - </title>
<script type="text/javascript" src="common.js-jsver=2.1.1.3626.3" tppabs="http://i.renjihe.com/blog/images/js/common.js?jsver=2.1.1.3626.3"></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://i.renjihe.com/blog/inc/rsd.php" />
<script type="text/javascript" src="jslang.js-jsver=2.1.1.3626.3" tppabs="http://i.renjihe.com/blog/lang/zh-cn/jslang.js?jsver=2.1.1.3626.3"></script>
<script type="text/javascript" src="ajax.js-jsver=2.1.1.3626.3" tppabs="http://i.renjihe.com/blog/images/js/ajax.js?jsver=2.1.1.3626.3"></script>
<script type="text/javascript" src="swfobject.js-jsver=2.1.1.3626.3" tppabs="http://i.renjihe.com/blog/images/js/swfobject.js?jsver=2.1.1.3626.3"></script>
<script type="text/javascript">
//<![CDATA[
var moreimagepath="template/default/images";
var shutajax=0;
var absbaseurl='index.htm'/*tpa=http://i.renjihe.com/blog/*/;
//]]>
</script>
<link title="搜索 流浪的龙－个人知识管理" rel="search"  type="application/opensearchdescription+xml"  href="http://i.renjihe.com/blog/inc/opensearch.php" />



</head>
<body id="pagelocation-read">
<div id="wrapper">
	<div id="innerWrapper">
		<div id="header">
			<div id="innerHeader">
				<div id="blogLogo">
				</div>
				<div class="blog-header">
					<h1 class="blog-title"><a href="index.php.htm" tppabs="http://i.renjihe.com/blog/index.php">流浪的龙－个人知识管理</a></h1>
					<div class="blog-desc"></div>
				</div>
				<div id="menu">
					<ul>
					<li><span id="nav_index" class="activepage"><a href="index.php.htm" tppabs="http://i.renjihe.com/blog/index.php" ><span id="navitem_index" class="activepageitem">首页</span></a></span></li>
<li><span id="nav_http_3A_2F_2Fi.renjihe.com_2F"><a href="javascript:if(confirm('http://i.renjihe.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://i.renjihe.com/'" tppabs="http://i.renjihe.com/"  target="_blank"><span id="navitem_http_3A_2F_2Fi.renjihe.com_2F">个性首页</span></a></span></li>
<li><span id="nav_http_3A_2F_2Fi.renjihe.com_2Flink.html"><a href="javascript:if(confirm('http://i.renjihe.com/link.html  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://i.renjihe.com/link.html'" tppabs="http://i.renjihe.com/link.html"  target="_blank"><span id="navitem_http_3A_2F_2Fi.renjihe.com_2Flink.html">网址导航</span></a></span></li>
<li><span id="nav_tag"><a href="tag.php.htm" tppabs="http://i.renjihe.com/blog/tag.php" ><span id="navitem_tag">标签</span></a></span></li>
<li><span id="nav_guestbook"><a href="guestbook.php.htm" tppabs="http://i.renjihe.com/blog/guestbook.php" ><span id="navitem_guestbook">留言</span></a></span></li>
					</ul>
				</div>
			</div>
		</div>
		<div id="mainWrapper">
			<div id="content" class="content">
				<div id="innerContent">
					<div class="announce" style="display: none">
						<div class="announce-content">
						
						</div>
					</div>
					<div class="article-top" style="display: none">
						<div class="pages">
							
						</div>
					</div>
					<div class="article-top">
	<div class="prev-article"><a href="read.php-4525.htm" tppabs="http://i.renjihe.com/blog/read.php?4525" title="上一篇 MFC的发展简史"><img src="toolbar_previous.gif" tppabs="http://i.renjihe.com/blog/template/default/images/toolbar_previous.gif" alt='' border='0'/>MFC的发展简史</a></div>
	<div class="next-article"><a href="read.php-4761.htm" tppabs="http://i.renjihe.com/blog/read.php?4761" title="下一篇 国外开放IP Camer"><img src="toolbar_next.gif" tppabs="http://i.renjihe.com/blog/template/default/images/toolbar_next.gif" alt='' border='0'/>国外开放IP Camer</a></div>
</div>
<div class="textbox">
	<div class="textbox-calendar">
	<span class="textbox-calendar-month">Mar</span>
	<span class="textbox-calendar-day">7</span>
	</div>
	<div class="textbox-title">
		<h4>
		API_HOOK_金山词霸取词功能原理 <span id="starid4529"><img src="unstarred.gif" tppabs="http://i.renjihe.com/blog/template/default/images/others/unstarred.gif" alt="" title="未加星标" border="0"/></span> <img src="blank.gif" tppabs="http://i.renjihe.com/blog/images/weather/blank.gif" alt="不指定" title="不指定"/> 
		</h4>
		<div class="textbox-label">
		 <a href="view.php-go=user_1.htm" tppabs="http://i.renjihe.com/blog/view.php?go=user_1" target="_blank">renjihe1988</a> , 10:46 , <a href="index.php-go=category_2.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_2" title="查看分类： 软件">软件</a> &raquo; <a href="index.php-go=category_61.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_61" title="查看分类： 编程杂项">编程杂项</a> , <a href="read.php-4529.htm#reply" tppabs="http://i.renjihe.com/blog/read.php?4529#reply" title="发表您的评论">评论(0)</a> , <a href='javascript: void(0);' title="查看引用地址" onclick='showhidediv("tb4529");'>引用(0)</a> , <a href="read.php-4529.htm" tppabs="http://i.renjihe.com/blog/read.php?4529">阅读(1)</a> ,  Via 本站原创 <span class="text-label-indented"><img src="toolbar_fontsize.gif" tppabs="http://i.renjihe.com/blog/template/default/images/toolbar_fontsize.gif" alt='' title="字体大小" border='0'/> <a href="javascript: doZoom(16);">大</a> | <a href="javascript: doZoom(14);">中</a> | <a href="javascript: doZoom(12);">小</a> <a href="read.php-6912.htm" tppabs="http://i.renjihe.com/blog/feed.php?go=entry_4529"><img src="toolbar_rss.gif" tppabs="http://i.renjihe.com/blog/template/default/images/toolbar_rss.gif" alt='' title="订阅本文" border='0'/></a> <a href="read.php-6911.htm" tppabs="http://i.renjihe.com/blog/read.php?save_4529"><img src="toolbar_save.gif" tppabs="http://i.renjihe.com/blog/template/default/images/toolbar_save.gif" alt='' title="保存本文为文本文档" border='0'/></a></span>
		</div>
	</div>
	<div id="tb4529" style="display: none;" class="textbox-tburl"><strong>引用功能被关闭了。</strong></div>
	
	<div class="textbox-content" id="zoomtext">
	 	<div>&nbsp;API HOOK 金山词霸取词功能原理收藏</div><div>1　屏幕抓词 &nbsp;&nbsp;</div><div>&nbsp; 　　屏幕抓词（或者叫动态翻译）是指随着鼠标的移动，软件能够随时获知屏幕上鼠标位置的单词或汉字，并翻译出来提示用户。它对於上网浏览、在线阅读外文文章等很有帮助作用，因此许多词典软件都提供了屏幕抓词功能。 &nbsp;&nbsp;</div><div>&nbsp; 　　屏幕抓词的关键是如何获得鼠标位置的字符串，Windows的动态链接和消息响应机制为之提供了实现途径。 &nbsp; 概括地说，主要通过下面的几个步骤来取得屏幕上鼠标位置的字符串： &nbsp;&nbsp;</div><div>&nbsp; 符串： &nbsp;&nbsp;</div><div>&nbsp; 　　. &nbsp; 代码拦截：Windows以DLL方式提供系统服务，可以方便地获取Windows字符输出API的地址，修改其入口代码，拦截应用程序对它们的调用。 &nbsp;&nbsp;</div><div>&nbsp; 　　. &nbsp; &nbsp; 鼠标HOOK：安装WH-MOUSEPROC类型的全局鼠标HOOK过程，监视鼠标在整个屏幕上的移动。 &nbsp;&nbsp;</div><div>&nbsp; 　　. &nbsp; &nbsp; &nbsp; 屏幕刷新：使鼠标周围一块区域无效，并强制鼠标位置的窗口刷新屏幕输出。窗口过程响应WM-NCPAINT和WM-PAINT消息，调用 ExtTextOut/TextOut等字符输出API更新无效区域里面的字符串。这些调用被我们截获，从堆栈里取得窗口过程传给字符API的参数，如字 符串地址、长度、输出坐标、HDC、裁剪区等信息。 &nbsp;&nbsp;</div><div>&nbsp; 2　Windows &nbsp; 95/98的字符输出方法 &nbsp;&nbsp;</div><div>&nbsp; 　　Windows95/98不是一个纯32位的操作系统，它从16位操作系统发展而来，为了保持兼容，其内部仍然是32位和16位代码的混合体。系统通 过gdi.exe &nbsp; 、user.exe和krnl386.exe提供16位API，供16位程序调用；通过gdi32.dll、user32.dll和 kernel32.dll提归结如下： &nbsp;&nbsp;</div><div>&nbsp; 图1　Windows &nbsp; 95/98的字符输出机制 &nbsp;&nbsp;</div><div>&nbsp; 　　. &nbsp; &nbsp; 16位程序通过16位gdi.exe的ExtTextOut/TextOut函数输出字符； &nbsp;&nbsp;</div><div>&nbsp; 　　. &nbsp; &nbsp; 32位程序通过gdi32.dll的ExtTextOutA/TextOutA输出ANSI格式的字符，通过ExtTextOutW/TextOutW输出UNICODE格式的字符； &nbsp;&nbsp;</div><div>&nbsp; 　　. &nbsp; &nbsp; 32位的ExtTextOutA/TextOutA转换到16位的ExtTextOut/TextOut，完成ANSI格式字符的输出； &nbsp;&nbsp;</div><div>&nbsp; 　　. &nbsp; &nbsp; 32位的ExtTextOutW/TextOutW转换到16位gdi.exe的两个未公开API，完成UNICODE格式字符的输出。为方便叙述，本文对这两个未公开API称为ExtTextOut16W和TextOut16W。 &nbsp;&nbsp;</div><div>&nbsp; t16W。 &nbsp;&nbsp;</div><div>&nbsp; 　　因此，只要拦截四个16位函数：TextOut、ExtTextOut、TextOut16W和ExtTextOut16W，就能截获32位和16位应用程序的所有字符串输出。 &nbsp;&nbsp;</div><div>&nbsp; 3　拦截字符输出API &nbsp;&nbsp;</div><div>&nbsp; 3.1　代码拦截的基本思路 &nbsp;&nbsp;</div><div>&nbsp; 　　为了实现对ExtTextOut/TextOut等API的拦截，需要在函数入口放入一条动态生成的&quot;JMP&lt;替代函数&gt;&quot;指令，JMP 的操作数是我们提供的一个拦截替代函数的地址。当该API被调用时，JMP指令首先执行，跳转到替代函数。替代函数负责从堆栈中获取参数，计算字符串坐 标，分出鼠标位置的单词等工作。执行完成后，替代函数再调用原来的被拦截函数，完成正常的字符输出，然后返回。 &nbsp; 图2表明了应用程序对TextOut的正常调用流程和TextOut被拦截后的流程。 &nbsp;&nbsp;</div><div>&nbsp; a) &nbsp;&nbsp;</div><div>&nbsp; ① &nbsp; 程序调用TextOut； &nbsp;&nbsp;</div><div>&nbsp; ② &nbsp; 从TextOut返回程序。 &nbsp;&nbsp;</div><div>&nbsp; ① &nbsp; 程序调用TextOut(其入口已经被修改)； &nbsp;&nbsp;</div><div>&nbsp; ② &nbsp; 转入拦截替代函数myTextOut; &nbsp;&nbsp;</div><div>&nbsp; ③ &nbsp; 从myTextOut调用原来的TextOut; &nbsp;&nbsp;</div><div>&nbsp; ④ &nbsp; 从TextOut返回myTextOut; &nbsp;&nbsp;</div><div>&nbsp; ⑤ &nbsp; 从myTextOut返回程序。 &nbsp;&nbsp;</div><div>&nbsp; 图2　对TextOut的正常调用流程 &nbsp;&nbsp;</div><div>&nbsp; &nbsp; &nbsp; 　　和TextOut被拦截后的流程 &nbsp;&nbsp;</div><div>&nbsp; 3.2　提供拦截替代函数 &nbsp;&nbsp;</div><div>&nbsp; 　　拦截替代函数插入被拦截API的流程中执行，需要有相同的参数和返回值原型。以对　　拦截替代函数插入被拦截API的流程中执行，需要有相同的参数和返回值原型。以对TextOut的拦截为例，下面是替代函数myTextOut的伪代码： &nbsp;&nbsp;</div><div>&nbsp; BOOL &nbsp; myTextOut(HDC &nbsp; hdc,int &nbsp; x,int &nbsp; y,LPSTR &nbsp; lpstr,int &nbsp; cbstr) &nbsp;&nbsp;</div><div>&nbsp; &#123; &nbsp;&nbsp;</div><div>&nbsp; DoSpy(hDC,x &nbsp; ,y,lpstr,cbstr); &nbsp;&nbsp;</div><div>&nbsp; //保存参数，作抓词的所有工作 &nbsp;&nbsp;</div><div>&nbsp; RestoreCode();//恢复TextOut入口原来的指令 &nbsp;&nbsp;</div><div>&nbsp; TextOut(hDC,x,y,lpstr,cbstr);//调用原来的API &nbsp;&nbsp;</div><div>&nbsp; SpyCode();//再次放入JMP指令 &nbsp;&nbsp;</div><div>&nbsp; return &nbsp; TRUE; &nbsp;&nbsp;</div><div>&nbsp; &#125; &nbsp;&nbsp;</div><div>&nbsp; 　　函数首先调用DoSpy()来作抓词的具体工作，然后RestoreCode()函数恢复被拦截函 &nbsp;&nbsp;</div><div>&nbsp; 数入口的代码，再调用TextOut()执行正常的字符输出，接下来SpyCode()在被拦截函数 &nbsp;&nbsp;</div><div>&nbsp; 入口再次放入JMP指令，最后返回调用进程。 &nbsp;&nbsp;</div><div>&nbsp; 3.3　获取被拦截API的动态链接地址 &nbsp;&nbsp;</div><div>&nbsp; 　　TextOut和ExtTextOut的地址可以通过GetProcAddress取得，而TextOut16W和ExtTextOut16W既未公 开于文档，也没有用字符串或序号从gdi.exe中引出，无法使用GetProcAddress取得它们的地址。下面讨论如何解决这个问题。 &nbsp;&nbsp;</div><div>&nbsp; 　　第一种方法：用softICE可以跟踪发现，ExtTextOut16W位于公开函数GetTextMetrics &nbsp; 入口的偏移20H处，TextOut16W位于GetTextMetrics的偏移7CH处。所以可以先取得GetTextMetrics的地址，再分别 在加上20H和7CH，就是ExtTextOutW和TextOutW的地址。 &nbsp;&nbsp;</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; 　　第二种方法：从指令里面析出地址。 &nbsp;&nbsp;</div><div>&nbsp; 　　第二种方法：从指令里面析出地址。 &nbsp;&nbsp;</div><div>&nbsp; 　　Windows &nbsp; 95/98维持一个DWORD类型的数组，称为32位-16位替换表，表中每个元素存 &nbsp;&nbsp;</div><div>&nbsp; 放了一个Win32 &nbsp; API对应的16位API的段：偏移地址。需要转入16位运行的Win32API使用 &nbsp;&nbsp;</div><div>&nbsp; 不同的索引来从该表格里面取目的地址。ExtTextOutW和TextOutW分别使用索引B2H和30 &nbsp;&nbsp;</div><div>&nbsp; H，取表中相应元素作为ExtTextOut16W和TextOut16W的地址。取得这个数组的起始位置 &nbsp;&nbsp;</div><div>&nbsp; ，根据索引号即可找到16位函数的地址。由于这个数组是一个重定位项，在内存的地址 &nbsp;&nbsp;</div><div>&nbsp; 不固定，所以需要从指令流里面动态析出它的地址。 &nbsp;&nbsp;</div><div>&nbsp; 3.4　动态生成JMP指令 &nbsp;&nbsp;</div><div>&nbsp; 　　动态生成的JMP指令占用5个字节，保存在一个数组里面。以生成跳转到TextOut的替 &nbsp;&nbsp;</div><div>&nbsp; 代函数myTextOut的JMP指令为例： &nbsp;&nbsp;</div><div>&nbsp; BYTE &nbsp; ins［5］; &nbsp; //保存JMP指令 &nbsp;&nbsp;</div><div>&nbsp; ins［0］ &nbsp; = &nbsp; 0xea; &nbsp; //操作码:1 &nbsp; byte &nbsp;&nbsp;</div><div>&nbsp; *(WORD &nbsp; *)(ins+1) &nbsp; = &nbsp; FP-OFF(myTextOut); &nbsp;&nbsp;</div><div>&nbsp; 　//操作数:2byte的偏移 &nbsp;&nbsp;</div><div>&nbsp; *(WORD &nbsp; *)(ins+3) &nbsp; = &nbsp; FP-SEG(myTextOut); &nbsp;&nbsp;</div><div>&nbsp; 　//操作数:2byte的段 &nbsp;&nbsp;</div><div>&nbsp; 3.5　修改被拦截函数的入口 &nbsp;&nbsp;</div><div>&nbsp; 　　Windows运行在保护模式下，16位进程采用了段保护机制，代码段描述符的属性被标记为只读。如果直接向被拦截函数的入口写入JMP指令，会引起CPU保护错误，因此在修改代码前要采用下面的方法绕过段保护机制： &nbsp;&nbsp;</div><div>&nbsp; 　　. &nbsp; &nbsp; 获取GDI代码段的基地址和界限； &nbsp;&nbsp;</div><div>&nbsp; 　　. &nbsp; &nbsp; 用当前DS复制一个新的段选择子，该选择子的描述符具有可读写的属性； &nbsp;&nbsp;</div><div>&nbsp; 　　. &nbsp; &nbsp; 将复制得到的选择子的基地址和界限设置为GDI代码段的基地址和界限； &nbsp;&nbsp;</div><div>&nbsp; 　　. &nbsp; &nbsp; 将复制得到的选择子的基地址和界限设置为GDI代码段的基地址和界限； &nbsp;&nbsp;</div><div>&nbsp; 　　. &nbsp; &nbsp; 用新的选择子作为段，同被拦截API的偏移组合成一个新的地址。 &nbsp;&nbsp;</div><div>&nbsp; 　　这样就获得了一个指向被拦截代码的可写指针。先保存5字节内容，再将数组ins［ &nbsp;&nbsp;</div><div>&nbsp; ］复制到该地址，即完成对TextOut等API的拦截修改。 &nbsp;&nbsp;</div><div>&nbsp; 4　使用HOOK监视鼠标移动 &nbsp;&nbsp;</div><div>&nbsp; 　　安装一个WH-MOUSEPROC类型的全局HOOK可以监视鼠标在全屏幕的移动。每当有鼠标事件产生，HOOK过程被调用，它判断出鼠标移动了后，就向主窗口发送消息，通知主窗口鼠标位置发生了变化。 &nbsp;&nbsp;</div><div>&nbsp; 　　主窗口收到消息后，设置定时器，监视鼠标在某一位置停留时间的长短。如果鼠标停留超过设定的时间，才启动抓词功能，否则抓词功能保持禁止状态。这样可以减少代码拦截对系统性能的影响。 &nbsp;&nbsp;</div><div>&nbsp; 　　全局HOOK过程需要放入DLL里面。 &nbsp;&nbsp;</div><div>&nbsp; 5　刷新屏幕输出 &nbsp;&nbsp;</div><div>&nbsp; 　　预先创建一个小的工具窗口，当鼠标停留在某个位置超过设定时间后，使工具窗口在鼠标位置上显示一下，然后隐含掉，这样就会在目标窗口--鼠标位置的窗 口产生无效区域。然后调用UpdateWindow强制目标窗口刷新屏幕输出。在响应WM-PAINT &nbsp; /WM-N &nbsp;&nbsp;</div><div>&nbsp; CPAINT中，目标窗口对字符输出API的调用将被我们截获和处理，完成一次抓词过程。 &nbsp;&nbsp;</div><div>&nbsp; 6　其它 &nbsp;&nbsp;</div><div>&nbsp; 　　本文所介绍的Windows &nbsp; 95/98环境下屏幕抓词的原理和取得鼠标位置字符串的实现方法。对于进一步的探索，笔者提出下面的几点看法： &nbsp;&nbsp;</div><div>&nbsp; 　　. &nbsp; &nbsp; 只有通过响应WM-PAINT &nbsp; /WM-NCPAINT消息输出的字符串才会被捕捉到； &nbsp;&nbsp;</div><div>&nbsp; 　　. &nbsp; &nbsp; 有些软件（例如Internet &nbsp; Explorer）在刷新屏幕时，为了消除闪烁，不直接把字符串输出到屏幕DC，而是创建一个兼容的内存DC，先将字符串写到内存DC，再复制到效区域。 然后调用UpdateWindow强制目标窗口刷新屏幕输出。在响应WM-PAINT &nbsp; /WM-N屏幕上去。由于内存DC坐标和屏幕DC坐标的不同，不能直接依赖内存DC的坐标来计算字符串的屏幕位置； &nbsp;&nbsp;</div><div>&nbsp; 　　. &nbsp; &nbsp; 本文讨论的方法不适用于Windows &nbsp; NT下的抓词。Windows &nbsp; NT的系统功能完全由32位代码提供，NT下的抓词需要拦截Win32 &nbsp; API。其实现机制同在Windows &nbsp; 95/98下也不一样。在NT里，KERNEL、USER、GDI模块位於进程的私有地址空间内，所以需要使用HOOK来将拦截替代函数动态映射到不同的 被拦截进程的地址空间里面。而且由于控制台窗口禁止大多数HOOK，还需要创建远程线程来获取控制台窗口的字符输出。 &nbsp;&nbsp;</div><div>&nbsp; &nbsp;&nbsp;</div><div>＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝</div><div><br /></div><div>屏幕上的文字大都是由gdi32.dll的以下几个函数显示的：TextOutA、TextOutW、ExtTextOutA、ExtTextOutW。实现屏幕抓词的关键就是截获对这些函数的调用，得到程序发给它们的参数。 &nbsp;&nbsp;</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; 　　我的方法有以下三个步骤： &nbsp;&nbsp;</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; 　　一、得到鼠标的当前位置 &nbsp;&nbsp;</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; 　　通过SetWindowsHookEx实现。 &nbsp;&nbsp;</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; 　　二、向鼠标下的窗口发重画消息，让它调用系统函数重画 &nbsp;&nbsp;</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; 　　通过WindowFromPoint，ScreenToClient，InvalidateRect &nbsp; 实现。 &nbsp;&nbsp;</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; 　　三、截获对系统函数的调用，取得参数(以TextOutA为例) &nbsp;&nbsp;</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; 　　1.仿照TextOutA作成自己的函数MyTextOutA，与TextOutA有相同参数和返回值，放在系统钩子所在的DLL里。 &nbsp;&nbsp;</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; 　　SysFunc1=(DWORD)GetProcAddress(GetModuleHandle(&quot;gdi32.dll&quot;),&quot;TextOutA&quot;); &nbsp;&nbsp;</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; 　　BOOL &nbsp; WINAPI &nbsp; MyTextOutA(HDC &nbsp; hdc, &nbsp; int &nbsp; nXStart, &nbsp; int &nbsp; nYStart, &nbsp; LPCSTR &nbsp; lpszString,int &nbsp; cbString) &nbsp;&nbsp;</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; 　　&#123; &nbsp; //输出lpszString的处理 &nbsp;&nbsp;</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; return &nbsp; ((FARPROC)SysFunc1)(hdc,nXStart,nYStart,lpszString,cbString);&#125; &nbsp;&nbsp;</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; 　　2.由于系统鼠标钩子已经完成注入其它GUI进程的工作，我们不需要为注入再做工作。 &nbsp;&nbsp;</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; 　　如果你知道所有系统钩子的函数必须要在动态库里，就不会对&quot;注入&quot;感到奇怪。当进程隐式或显式调用一个动态库里的函数时，系统都要把这个动态库映射到 这个进程的虚拟地址空间里(以下简称&quot;地址空间&quot;)。这使得DLL成为进程的一部分，以这个进程的身份执行，使用这个进程的堆栈(见图1)。 &nbsp;&nbsp;</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; 　　图1 &nbsp; DLL映射到虚拟地址空间中 &nbsp;&nbsp;</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; 　　对系统钩子来说，系统自动将包含&quot;钩子回调函数&quot;的DLL映射到受钩子函数影响的所有进程的地址空间中，即将这个DLL注入了那些进程。 &nbsp;&nbsp;</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; 　　3.当包含钩子的DLL注入其它进程后，寻找映射到这个进程虚拟内存里的各个模块（EXE和DLL）的基地址。EXE和DLL被映射到虚拟内存空间的 什么地方是由它们的基地址决定的。它们的基地址是在链接时由链接器决定的。当你新建一个Win32工程时，VC＋＋链接器使用缺省的基地址 0x00400000。可以通过链接器的BASE选项改变模块的基地址。EXE通常被映射到虚拟内存的0x00400000处，DLL也随之有不同的基地 址，通常被映射到不同进程的相同的虚拟地址空间处。 &nbsp;&nbsp;</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; 　　如何知道EXE和DLL被映射到哪里了呢？ &nbsp;&nbsp;</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; 　　在Win32中，HMODULE和HINSTANCE是相同的。它们就是相应模块被装入进程的虚拟内存空间的基地址。比如： &nbsp;&nbsp;</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; 　　HMODULE &nbsp; hmodule=GetModuleHandle(〃gdi32.dll〃); &nbsp;&nbsp;</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; 　　返回的模块句柄强制转换为指针后，就是gdi32.dll被装入的基地址。 &nbsp;&nbsp;</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; 　　关于如何找到虚拟内存空间映射了哪些DLL？我用如下方式实现： &nbsp;&nbsp;</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; while(VirtualQuery &nbsp; (base, &nbsp; ＆mbi, &nbsp; sizeof &nbsp; (mbi))〉0) &nbsp;&nbsp;</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; &#123; &nbsp; if(mbi.Type==MEM-IMAGE) &nbsp;&nbsp;</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; ChangeFuncEntry((DWORD)mbi.BaseAddress,1); &nbsp;&nbsp;</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; base=(DWORD)mbi.BaseAddress＋mbi.RegionSize; &nbsp; &#125; &nbsp;&nbsp;</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; 　　4.得到模块的基地址后，根据PE文件的格式穷举这个模块的IMAGE-IMPORT-DESCRIPTOR数组，看是否引入了gdi32.dll。如是，则穷举IMAGE-THUNK-DATA数组，看是否引入了TextOutA函数。 &nbsp;&nbsp;</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; 　　5.如果找到，将其替换为相应的自己的函数。 &nbsp;&nbsp;</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; 　　系统将EXE和DLL原封不动映射到虚拟内存空间中，它们在内存中的结构与磁盘上的静态文件结构是一样的。即PE &nbsp; (Portable &nbsp; Executable) &nbsp; 文件格式。 &nbsp;&nbsp;</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; 　　所有对给定API函数的调用总是通过可执行文件的同一个地方转移。那就是一个模块(可以是EXE或DLL)的输入地址表(import &nbsp; address &nbsp; table)。那里有所有本模块调用的其它DLL的函数名及地址。对其它DLL的函数调用实际上只是跳转到输入地址表，由输入地址表再跳转到DLL真正的 函数入口。例如： &nbsp;&nbsp;</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; 　　图2 &nbsp; 对MessageBox()的调用跳转到输入地址表，从输入地址表再跳转到MessageBox函数 &nbsp;&nbsp;</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; 　　IMAGE-IMPORT-DESCRIPTOR和IMAGE-THUNK-DATA分别对应于DLL和函数。它们是PE文件的输入地址表的格式（数据结构参见winnt.h）。 &nbsp;&nbsp;</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; 　　BOOL &nbsp; ChangeFuncEntry(HMODULE &nbsp; hmodule) &nbsp;&nbsp;</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; 　　&#123; &nbsp; PIMAGE-DOS-HEADER &nbsp; pDOSHeader; &nbsp;&nbsp;</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; 　　PIMAGE-NT-HEADERS &nbsp; pNTHeader; &nbsp;&nbsp;</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; 　　PIMAGE-IMPORT-DESCRIPTOR &nbsp; pImportDesc; &nbsp;&nbsp;</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; / &nbsp; get &nbsp; system &nbsp; functions &nbsp; and &nbsp; my &nbsp; functions&prime;entry &nbsp; / &nbsp;&nbsp;</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; 　　pSysFunc1=(DWORD)GetProcAddress(GetModuleHandle(〃gdi32.dll〃),〃TextOutA〃); &nbsp;&nbsp;</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; 　　pMyFunc1= &nbsp; (DWORD)GetProcAddress(GetModuleHandle(〃hookdll.dll〃),〃MyTextOutA〃); &nbsp;&nbsp;</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; pDOSHeader=(PIMAGE-DOS-HEADER)hmodule; &nbsp;&nbsp;</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; 　　if &nbsp; (IsBadReadPtr(hmodule, &nbsp; sizeof(PIMAGE-NT-HEADERS))) &nbsp;&nbsp;</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; 　　 &nbsp; return &nbsp; FALSE; &nbsp;&nbsp;</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; 　　if &nbsp; (pDOSHeader－〉e-magic &nbsp; != &nbsp; IMAGE-DOS-SIGNATURE) &nbsp;&nbsp;</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; 　　 &nbsp; return &nbsp; FALSE; &nbsp;&nbsp;</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; 　　pNTHeader=(PIMAGE-NT-HEADERS)((DWORD)pDOSHeader+(DWORD)pDOSHeader－〉e-lfanew); &nbsp;&nbsp;</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; 　　if &nbsp; (pNTHeader－〉Signature &nbsp; != &nbsp; IMAGE-NT-SIGNATURE) &nbsp;&nbsp;</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; 　　 &nbsp; return &nbsp; FALSE; &nbsp;&nbsp;</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; 　　pImportDesc &nbsp; = &nbsp; (PIMAGE-IMPORT-DESCRIPTOR)((DWORD)hmodule＋(DWORD)pNTHeader－〉OptionalHeader.DataDirectory &nbsp;&nbsp;</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; 　　 &nbsp; [IMAGE-DIRECTORY-ENTRY-IMPORT].VirtualAddress); &nbsp;&nbsp;</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; 　　if &nbsp; (pImportDesc &nbsp; == &nbsp; (PIMAGE-IMPORT-DESCRIPTOR)pNTHeader) &nbsp;&nbsp;</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; return &nbsp; FALSE; &nbsp;&nbsp;</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; 　　while &nbsp; (pImportDesc－〉Name) &nbsp;&nbsp;</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; 　　&#123; &nbsp; PIMAGE-THUNK-DATA &nbsp; pThunk; &nbsp;&nbsp;</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; 　　strcpy(buffer,(char &nbsp; )((DWORD)hmodule+(DWORD)pImportDesc－〉Name)); &nbsp;&nbsp;</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; CharLower(buffer); &nbsp;&nbsp;</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; if(strcmp(buffer,&quot;gdi32.dll&quot;)) &nbsp;&nbsp;</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; &#123; &nbsp; pImportDesc++; &nbsp;&nbsp;</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; continue; &nbsp;&nbsp;</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; &#125;else &nbsp;&nbsp;</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; &#123; &nbsp; pThunk=(PIMAGE-THUNK-DATA)((DWORD)hmodule＋(DWORD)pImportDesc－〉FirstThunk); &nbsp;&nbsp;</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; while &nbsp; (pThunk－〉u1.Function) &nbsp;&nbsp;</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; &#123; &nbsp; if &nbsp; ((pThunk－〉u1.Function) &nbsp; == &nbsp; pSysFunc1) &nbsp;&nbsp;</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; &#123; &nbsp; VirtualProtect((LPVOID)(&amp;pThunk－〉u1.Function), &nbsp;&nbsp;</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; 　　 &nbsp; sizeof(DWORD),PAGE-EXECUTE-READWRITE,&amp;dwProtect); &nbsp;&nbsp;</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; 　　 &nbsp; (pThunk－〉u1.Function)=pMyFunc1; &nbsp;&nbsp;</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; 　　 &nbsp; VirtualProtect((LPVOID)(&amp;pThunk－〉u1.Function), &nbsp; sizeof(DWORD),dwProtect,&amp;temp); &nbsp; &#125; &nbsp;&nbsp;</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; pThunk++; &nbsp; &#125; &nbsp; return &nbsp; 1;&#125;&#125;&#125; &nbsp;&nbsp;</div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; 　　替换了输入地址表中TextOutA的入口为MyTextOutA后，截获系统函数调用的主要部分已经完成，当一个被注入进程调用TextOutA 时，其实调用的是MyTextOutA，只需在MyTextOutA中显示传进来的字符串，再交给TextOutA处理即可。&nbsp;</div><div>＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝</div><div>金山词霸抓词机理 -- HOOK消息功能的使用&nbsp;</div><div>Win32全局钩子在VC5中的实现　　&nbsp;</div><div>　　Windows系统是建立在事件驱动的机制上的，说穿了就是整个系统都是通过消息的传递来实现的。而钩子是Windows系统中非常重要的系统接口，用它可以截获并处理送给其他应用程序的消息，来完成普通应用程序难以实现的功能。钩子的种类很多，每种钩子可以截获并处理相应的消息，如键盘钩子可以截获键盘消息，外壳钩子可以截取、启动和关闭应用程序的消息等。本文在VC5编程环境下实现了一个简单的鼠标钩子程序，并对Win32全局钩子的运行机制、Win32 DLL的特点、VC5环境下的MFC DLL以及共享数据等相关知识进行了简单的阐述。&nbsp;</div><div>　　一．Win32全局钩子的运行机制&nbsp;</div><div><br /></div><div>　 　钩子实际上是一个处理消息的程序段，通过系统调用，把它挂入系统。每当特定的消息发出，在没有到达目的窗口前，钩子程序就先捕获该消息，亦即钩子函数先 得到控制权。这时钩子函数即可以加工处理（改变）该消息，也可以不作处理而继续传递该消息，还可以强制结束消息的传递。对每种类型的钩子由系统来维护一个 钩子链，最近安装的钩子放在链的开始，而最先安装的钩子放在最后，也就是后加入的先获得控制权。要实现Win32的系统钩子，必须调用SDK中的API函数SetWindowsHookEx来安装这个钩子函数，这个函数的原型是HHOOK SetWindowsHookEx(int idHook,HOOKPROC lpfn,HINSTANCE hMod,DWORD dwThreadId);，其中，第一个参数是钩子的类型；第二个参数是钩子函数的地址；第三个参数是包含钩子函数的模块句柄；第四个参数指定监视的线程。如果指定确定的线程，即为线程专用钩子；如果指定为空，即为全局钩子。其中，全局钩子函数必须包含在DLL（动态链接库）中，而线程专用钩子还可以包含在可执行文件中。得到控制权的钩子函数在完成对消息的处理后，如果想要该消息继续传递，那么它必须调用另外一个SDK中的API函数CallNextHookEx来传递它。钩子函数也可以通过直接返回TRUE来丢弃该消息，并阻止该消息的传递。&nbsp;</div><div><br /></div><div>　　二．Win32 DLL的特点&nbsp;</div><div><br /></div><div>　　Win32 DLL与 Win16 DLL有很大的区别，这主要是由操作系统的设计思想决定的。一方面，在Win16 DLL中程序入口点函数和出口点函数（LibMain和WEP）是分别实现的；而在Win32 DLL中却由同一函数DLLMain来实现。无论何时，当一个进程或线程载入和卸载DLL时，都要调用该函数，它的原型是BOOL WINAPI DllMain(HINSTANCE hinstDLL,DWORD fdwReason, LPVOID lpvReserved);，其中，第一个参数表示DLL的实例句柄；第三个参数系统保留；这里主要介绍一下第二个参数，它有四个可能的值：DLL_PROCESS_ATTACH（进程载入），DLL_THREAD_ATTACH（线程载入），DLL_THREAD_DETACH（线程卸载），DLL_PROCESS_DETACH（进程卸载），在DLLMain函数中可以对传递进来的这个参数的值进行判别，并根据不同的参数值对DLL进行必要的初始化或清理工作。举个例子来说，当有一个进程载入一个DLL时，系统分派给DLL的第二个参数为DLL_PROCESS_ATTACH，这时，你可以根据这个参数初始化特定的数据。另一方面，在Win16环境下，所有应用程序都在同一地址空间；而在Win32环境下，所有应用程序都有自己的私有空间，每个进程的空间都是相互独立的，这减少了应用程序间的相互影响，但同时也增加了编程的难度。大家知道，在Win16环境中，DLL的全局数据对每个载入它的进程来说都是相同的；而在Win32环境中，情况却发生了变化，当进程在载入DLL时，系统自动把DLL地址映射到该进程的私有空间，而且也复制该DLL的全局数据的一份拷贝到该进程空间，也就是说每个进程所拥有的相同的DLL的全局数据其值却并不一定是相同的。因此，在Win32环境下要想在多个进程中共享数据，就必须进行必要的设置。亦即把这些需要共享的数据分离出来，放置在一个独立的数据段里，并把该段的属性设置为共享。&nbsp;</div><div><br /></div><div>　　三．VC5中MFC DLL的分类及特点&nbsp;</div><div><br /></div><div>　　在VC5中有三种形式的MFC DLL（在该DLL中可以使用和继承已有的MFC类)可供选择，即Regular statically linked to MFC DLL（标准静态链接MFC DLL）和Regular using the shared MFC DLL（标准动态链接MFC DLL）以及Extension MFC DLL（扩展MFC DLL）。第一种DLL的特点是，在编译时把使用的MFC代码加入到DLL中，因此，在使用该程序时不需要其他MFC动态链接类库的存在，但占用磁盘空间比较大；第二种DLL的特点是，在运行时，动态链接到MFC类库，因此减少了空间的占用，但是在运行时却依赖于MFC动态链接类库；这两种DLL既可以被MFC程序使用也可以被Win32程序使用。第三种DLL的特点类似于第二种，做为MFC类库的扩展，只能被MFC程序使用。&nbsp;</div><div><br /></div><div>　　四．在VC5中全局共享数据的实现&nbsp;</div><div><br /></div><div>　　在主文件中，用#pragma data_seg建立一个新的数据段并定义共享数据，其具体格式为：&nbsp;</div><div><br /></div><div>　　#pragma data_seg （&quot;shareddata&quot;)&nbsp;</div><div><br /></div><div>　　HWND sharedwnd=NULL;//共享数据&nbsp;</div><div><br /></div><div>　　#pragma data_seg()&nbsp;</div><div><br /></div><div>　　仅定义一个数据段还不能达到共享数据的目的，还要告诉编译器该段的属性，有两种方法可以实现该目的（其效果是相同的），一种方法是在.DEF文件中加入如下语句：&nbsp;</div><div><br /></div><div>　　SETCTIONS&nbsp;</div><div><br /></div><div>　　shareddata READ WRITE SHARED&nbsp;</div><div><br /></div><div>　　另一种方法是在项目设置链接选项中加入如下语句：&nbsp;</div><div><br /></div><div>　　/SECTION:shareddata,rws&nbsp;</div><div><br /></div><div>　　五．具体实现步骤&nbsp;</div><div><br /></div><div>　　由于全局钩子函数必须包含在动态链接库中，所以本例由两个程序体来实现。&nbsp;</div><div><br /></div><div>　　1．建立钩子Mousehook.DLL&nbsp;</div><div><br /></div><div>　　(1)选择MFC AppWizard(DLL)创建项目Mousehook；&nbsp;</div><div><br /></div><div>　　(2)选择MFC Extension DLL（共享MFC拷贝）类型；&nbsp;</div><div><br /></div><div>　　(3)由于VC5没有现成的钩子类，所以要在项目目录中创建Mousehook.h文件，在其中建立钩子类：&nbsp;</div><div><br /></div><div>　　class AFX_EXT_CLASS Cmousehook:public CObject&nbsp;</div><div><br /></div><div>　　&#123;&nbsp;</div><div><br /></div><div>　　public:&nbsp;</div><div><br /></div><div>　　Cmousehook();&nbsp;</div><div><br /></div><div>　　//钩子类的构造函数&nbsp;</div><div><br /></div><div>　　~Cmousehook();&nbsp;</div><div><br /></div><div>　　//钩子类的析构函数&nbsp;</div><div><br /></div><div>　　BOOL starthook(HWND hWnd);&nbsp;</div><div><br /></div><div>　　//安装钩子函数&nbsp;</div><div><br /></div><div>　　BOOL stophook();&nbsp;</div><div><br /></div><div>　　卸载钩子函数&nbsp;</div><div><br /></div><div>　　&#125;;&nbsp;</div><div><br /></div><div>　　(4)在Mousehook.app文件的顶部加入#include&quot;Mousehook.h&quot;语句；&nbsp;</div><div><br /></div><div>　　(5)加入全局共享数据变量：&nbsp;</div><div><br /></div><div>　　#pragma data_seg(&quot;mydata&quot;)&nbsp;</div><div><br /></div><div>　　HWND glhPrevTarWnd=NULL;&nbsp;</div><div><br /></div><div>　　//上次鼠标所指的窗口句柄&nbsp;</div><div><br /></div><div>　　HWND glhDisplayWnd=NULL;&nbsp;</div><div><br /></div><div>　　//显示目标窗口标题编辑框的句柄&nbsp;</div><div><br /></div><div>　　HHOOK glhHook=NULL;&nbsp;</div><div><br /></div><div>　　//安装的鼠标勾子句柄&nbsp;</div><div><br /></div><div>　　HINSTANCE glhInstance=NULL;&nbsp;</div><div><br /></div><div>　　//DLL实例句柄&nbsp;</div><div><br /></div><div>　　#pragma data_seg()&nbsp;</div><div><br /></div><div>　　(6)在DEF文件中定义段属性：&nbsp;</div><div><br /></div><div>　　SECTIONS&nbsp;</div><div><br /></div><div>　　mydata READ WRITE SHARED&nbsp;</div><div><br /></div><div>　　(7)在主文件Mousehook.cpp的DllMain函数中加入保存DLL实例句柄的语句：&nbsp;</div><div><br /></div><div>　　DllMain(HINSTANCE hInstance, DWORD dwReason, LPVOID lpReserved)&nbsp;</div><div><br /></div><div>　　&#123;&nbsp;</div><div><br /></div><div>　　//如果使用lpReserved参数则删除下面这行&nbsp;</div><div><br /></div><div>　　UNREFERENCED_PARAMETER(lpReserved);&nbsp;</div><div><br /></div><div>　　if (dwReason == DLL_PROCESS_ATTACH)&nbsp;</div><div><br /></div><div>　　&#123;&nbsp;</div><div><br /></div><div>　　 TRACE0(&quot;MOUSEHOOK.DLL Initializing!&#92;n&quot;);&nbsp;</div><div><br /></div><div>　　 //扩展DLL仅初始化一次&nbsp;</div><div><br /></div><div>　　 if (!AfxInitExtensionModule(MousehookDLL, hInstance))&nbsp;</div><div><br /></div><div>　　 return 0;&nbsp;</div><div><br /></div><div>　　 new CDynLinkLibrary(MousehookDLL);&nbsp;</div><div><br /></div><div>　　 //把DLL加入动态MFC类库中&nbsp;</div><div><br /></div><div>　　 glhInstance=hInstance;&nbsp;</div><div><br /></div><div>　　 //插入保存DLL实例句柄&nbsp;</div><div><br /></div><div>　　&#125;&nbsp;</div><div><br /></div><div>　　else if (dwReason == DLL_PROCESS_DETACH)&nbsp;</div><div><br /></div><div>　　&#123;&nbsp;</div><div><br /></div><div>　　 TRACE0(&quot;MOUSEHOOK.DLL Terminating!&#92;n&quot;);&nbsp;</div><div><br /></div><div>　　 //终止这个链接库前调用它&nbsp;</div><div><br /></div><div>　　 AfxTermExtensionModule(MousehookDLL);&nbsp;</div><div><br /></div><div>　　&#125;&nbsp;</div><div><br /></div><div>　　return 1;&nbsp;</div><div><br /></div><div>　　&#125;&nbsp;</div><div><br /></div><div>　　(8)类Cmousehook的成员函数的具体实现：&nbsp;</div><div><br /></div><div>　　Cmousehook::Cmousehook()&nbsp;</div><div><br /></div><div>　　//类构造函数&nbsp;</div><div><br /></div><div>　　&#123;&nbsp;</div><div><br /></div><div>　　&#125;&nbsp;</div><div><br /></div><div>　　Cmousehook::~Cmousehook()&nbsp;</div><div><br /></div><div>　　//类析构函数&nbsp;</div><div><br /></div><div>　　&#123;&nbsp;</div><div><br /></div><div>　　stophook();&nbsp;</div><div><br /></div><div>　　&#125;&nbsp;</div><div><br /></div><div>　　BOOL Cmousehook::starthook(HWND hWnd)&nbsp;</div><div><br /></div><div>　　//安装钩子并设定接收显示窗口句柄&nbsp;</div><div><br /></div><div>　　&#123;&nbsp;</div><div><br /></div><div>　　BOOL bResult=FALSE;&nbsp;</div><div><br /></div><div>　　glhHook=SetWindowsHookEx(WH_MOUSE,MouseProc,glhInstance,0);&nbsp;</div><div><br /></div><div>　　if(glhHook!=NULL)&nbsp;</div><div><br /></div><div>　　 bResult=TRUE;&nbsp;</div><div><br /></div><div>　　glhDisplayWnd=hWnd;&nbsp;</div><div><br /></div><div>　　//设置显示目标窗口标题编辑框的句柄&nbsp;</div><div><br /></div><div>　　return bResult;&nbsp;</div><div><br /></div><div>　　&#125;&nbsp;</div><div><br /></div><div>　　BOOL Cmousehook::stophook()&nbsp;</div><div><br /></div><div>　　//卸载钩子&nbsp;</div><div><br /></div><div>　　&#123;&nbsp;</div><div><br /></div><div>　　BOOL bResult=FALSE;&nbsp;</div><div><br /></div><div>　　if(glhHook)&nbsp;</div><div><br /></div><div>　　&#123;&nbsp;</div><div><br /></div><div>　　 bResult= UnhookWindowsHookEx(glhHook);&nbsp;</div><div><br /></div><div>　　 if(bResult)&nbsp;</div><div><br /></div><div>　　 &#123;&nbsp;</div><div><br /></div><div>　　 glhPrevTarWnd=NULL;&nbsp;</div><div><br /></div><div>　　 glhDisplayWnd=NULL;//清变量&nbsp;</div><div><br /></div><div>　　 glhHook=NULL;&nbsp;</div><div><br /></div><div>　　 &#125;&nbsp;</div><div><br /></div><div>　　&#125;&nbsp;</div><div><br /></div><div>　　return bResult;&nbsp;</div><div><br /></div><div>　　&#125;&nbsp;</div><div><br /></div><div>　　(9)钩子函数的实现：&nbsp;</div><div><br /></div><div>　　LRESULT WINAPI MouseProc(int nCode,WPARAM wparam,LPARAM lparam)&nbsp;</div><div><br /></div><div>　　&#123;&nbsp;</div><div><br /></div><div>　　LPMOUSEHOOKSTRUCT pMouseHook=(MOUSEHOOKSTRUCT FAR *) lparam;&nbsp;</div><div><br /></div><div>　　 if (nCode&gt;=0)&nbsp;</div><div><br /></div><div>　　 &#123;&nbsp;</div><div><br /></div><div>　　HWND glhTargetWnd=pMouseHook-&gt;hwnd;&nbsp;</div><div><br /></div><div>　　//取目标窗口句柄&nbsp;</div><div><br /></div><div>　　 HWND ParentWnd=glhTargetWnd;&nbsp;</div><div><br /></div><div>　　 while (ParentWnd !=NULL)&nbsp;</div><div><br /></div><div>　　 &#123;&nbsp;</div><div><br /></div><div>　　 glhTargetWnd=ParentWnd;&nbsp;</div><div><br /></div><div>　　 ParentWnd=GetParent(glhTargetWnd);&nbsp;</div><div><br /></div><div>　　 //取应用程序主窗口句柄&nbsp;</div><div><br /></div><div>　　 &#125;&nbsp;</div><div><br /></div><div>　　 if(glhTargetWnd!=glhPrevTarWnd)&nbsp;</div><div><br /></div><div>　　 &#123;&nbsp;</div><div><br /></div><div>　　 char szCaption[100];&nbsp;</div><div><br /></div><div>　　 GetWindowText(glhTargetWnd,szCaption,100);&nbsp;</div><div><br /></div><div>　　 //取目标窗口标题&nbsp;</div><div><br /></div><div>　　 if(IsWindow(glhDisplayWnd))&nbsp;</div><div><br /></div><div>　　 SendMessage(glhDisplayWnd,WM_SETTEXT,0,(LPARAM)(LPCTSTR)szCaption);&nbsp;</div><div><br /></div><div>　　 glhPrevTarWnd=glhTargetWnd;&nbsp;</div><div><br /></div><div>　　 //保存目标窗口&nbsp;</div><div><br /></div><div>　　 &#125;&nbsp;</div><div><br /></div><div>　　 &#125;&nbsp;</div><div><br /></div><div>　　 return CallNextHookEx(glhHook,nCode,wparam,lparam);&nbsp;</div><div><br /></div><div>　　 //继续传递消息&nbsp;</div><div><br /></div><div>　　&#125;&nbsp;</div><div><br /></div><div>　　(10)编译项目生成mousehook.dll。&nbsp;</div><div><br /></div><div>　　2．创建钩子可执行程序&nbsp;</div><div><br /></div><div>　　(1)用MFC的AppWizard(EXE)创建项目Mouse；&nbsp;</div><div><br /></div><div>　　(2)选择&ldquo;基于对话应用&rdquo;并按下&ldquo;完成&rdquo;键；&nbsp;</div><div><br /></div><div>　　(3)编辑对话框，删除其中原有的两个按钮，加入静态文本框和编辑框，用鼠标右键点击静态文本框，在弹出的菜单中选择&ldquo;属性&rdquo;，设置其标题为&ldquo;鼠标所在的窗口标题&rdquo;；&nbsp;</div><div><br /></div><div>　　(4)在Mouse.h中加入对Mousehook.h的包含语句#Include&quot;..&#92;Mousehook&#92;Mousehook.h&quot;；&nbsp;</div><div><br /></div><div>　　(5)在CMouseDlg.h的CMouseDlg类定义中添加私有数据成员：&nbsp;</div><div><br /></div><div>　　CMouseHook m_hook;//加入钩子类作为数据成员&nbsp;</div><div><br /></div><div>　　(6)修改CmouseDlg::OnInitDialog()函数：&nbsp;</div><div><br /></div><div>　　BOOL CMouseDlg::OnInitDialog()&nbsp;</div><div><br /></div><div>　　&#123;&nbsp;</div><div><br /></div><div>　　CDialog::OnInitDialog();&nbsp;</div><div><br /></div><div>　　ASSERT((IDM_ABOUTBOX &amp; 0xFFF0) == IDM_ABOUTBOX);&nbsp;</div><div><br /></div><div>　　ASSERT(IDM_ABOUTBOX &lt; 0xF000);&nbsp;</div><div><br /></div><div>　　CMenu* pSysMenu = GetSystemMenu(FALSE);&nbsp;</div><div><br /></div><div>　　if (pSysMenu != NULL)&nbsp;</div><div><br /></div><div>　　&#123;&nbsp;</div><div><br /></div><div>　　 CString strAboutMenu;&nbsp;</div><div><br /></div><div>　　 strAboutMenu.LoadString(IDS_ABOUTBOX);&nbsp;</div><div><br /></div><div>　　 if (!strAboutMenu.IsEmpty())&nbsp;</div><div><br /></div><div>　　 &#123;&nbsp;</div><div><br /></div><div>　　 pSysMenu-&gt;AppendMenu(MF_SEPARATOR);&nbsp;</div><div><br /></div><div>　　 pSysMenu-&gt;AppendMenu(MF_STRING, IDM_ABOUTBOX, strAboutMenu);&nbsp;</div><div><br /></div><div>　　 &#125;&nbsp;</div><div><br /></div><div>　　&#125;&nbsp;</div><div><br /></div><div>　　SetIcon(m_hIcon, TRUE);//Set big icon&nbsp;</div><div><br /></div><div>　　SetIcon(m_hIcon, FALSE);//Set small icon&nbsp;</div><div><br /></div><div>　　//TODO: Add extra initialization here&nbsp;</div><div><br /></div><div>　　CWnd * pwnd=GetDlgItem(IDC_EDIT1);&nbsp;</div><div><br /></div><div>　　//取得编辑框的类指针&nbsp;</div><div><br /></div><div>　　m_hook.starthook(pwnd-&gt;GetSafeHwnd());&nbsp;</div><div><br /></div><div>　　//取得编辑框的窗口句柄并安装钩子&nbsp;</div><div><br /></div><div>　　return TRUE;&nbsp;</div><div><br /></div><div>　　//return TRUE unless you set the focus to a control&nbsp;</div><div><br /></div><div>　　&#125;&nbsp;</div><div><br /></div><div>　　(7)链接DLL库，即把..&#92;Mousehook&#92;debug&#92;Mousehook.lib加入到项目设置链接标签中；&nbsp;</div><div><br /></div><div>　　(8)编译项目生成可执行文件；&nbsp;</div><div><br /></div><div>　　(9)把Mousehook.DLL拷贝到..&#92;mouse&#92;debug目录中；&nbsp;</div><div><br /></div><div>　　(10)先运行几个可执行程序，然后运行Mouse.exe程序，把鼠标在不同窗口中移动，在Mouse.exe程序窗口中的编辑框内将显示出鼠标所在的应用程序主窗口的标题。</div><div>　</div><div><br /></div><div>&nbsp;</div><div><br /></div><div><br /></div><div>＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝</div><div>消息钩子函数入门篇&nbsp;</div><div>消息钩子函数入门篇&nbsp;</div><div>&nbsp;</div><div>Windows 系统是建立在事件驱动的机制上的，说穿了就是整个系统都是通过消息的传递来实现的。而钩子是Windows系统中非常重要的系统接口，用它可以截获并处理 送给其他应用程序的消息，来完成普通应用程序难以实现的功能。钩子可以监视系统或进程中的各种事件消息，截获发往目标窗口的消息并进行处理。这样，我们就 可以在系统中安装自定义的钩子，监视系统中特定事件的发生，完成特定的功能，比如截获键盘、鼠标的输入，屏幕取词，日志监视等等。可见，利用钩子可以实现 许多特殊而有用的功能。因此，对于高级编程人员来说，掌握钩子的编程方法是很有必要的。&nbsp;</div><div><br /></div><div>钩子的类型&nbsp;</div><div>　　一． 按事件分类，有如下的几种常用类型&nbsp;</div><div>　　（1） 键盘钩子和低级键盘钩子可以监视各种键盘消息。&nbsp;</div><div>　　（2） 鼠标钩子和低级鼠标钩子可以监视各种鼠标消息。&nbsp;</div><div>　　（3） 外壳钩子可以监视各种Shell事件消息。比如启动和关闭应用程序。&nbsp;</div><div>　　（4） 日志钩子可以记录从系统消息队列中取出的各种事件消息。&nbsp;</div><div>　　（5） 窗口过程钩子监视所有从系统消息队列发往目标窗口的消息。&nbsp;</div><div>　　此外，还有一些特定事件的钩子提供给我们使用，不一一列举。&nbsp;</div><div>下面描述常用的Hook类型：&nbsp;</div><div>1、WH_CALLWNDPROC和WH_CALLWNDPROCRET Hooks&nbsp;</div><div>WH_CALLWNDPROC和WH_CALLWNDPROCRET Hooks使你可以监视发送到窗口过程的消息。系统在消息发送到接收窗口过程之前调用WH_CALLWNDPROC Hook子程，并且在窗口过程处理完消息之后调用WH_CALLWNDPRO&nbsp;</div><div>CRET Hook子程。WH_CALLWNDPROCRET Hook传递指针到CWPRETSTRUCT结构，再传递到Hook子程。CWPRETSTRUCT结构包含了来自处理消息的窗口过程的返回值，同样也包括了与这个消息关联的消息参数。&nbsp;</div><div>2、WH_CBT Hook&nbsp;</div><div>在以下事件之前，系统都会调用WH_CBT Hook子程，这些事件包括：&nbsp;</div><div>1. 激活，建立，销毁，最小化，最大化，移动，改变尺寸等窗口事件；&nbsp;</div><div>2. 完成系统指令；&nbsp;</div><div>3. 来自系统消息队列中的移动鼠标，键盘事件；&nbsp;</div><div>4. 设置输入焦点事件；&nbsp;</div><div>5. 同步系统消息队列事件。&nbsp;</div><div>Hook子程的返回值确定系统是否允许或者防止这些操作中的一个。&nbsp;</div><div>3、WH_DEBUG Hook&nbsp;</div><div>在系统调用系统中与其他Hook关联的Hook子程之前，系统会调用WH_DEBUG Hook子程。你可以使用这个Hook来决定是否允许系统调用与其他Hook关联的Hook子程。&nbsp;</div><div>4、WH_FOREGROUNDIDLE Hook&nbsp;</div><div>当应用程序的前台线程处于空闲状态时，可以使用WH_FOREGROUNDIDLE Hook执行低优先级的任务。当应用程序的前台线程大概要变成空闲状态时，系统就会调用WH_FOREGROUNDIDLE Hook子程。&nbsp;</div><div>5、WH_GETMESSAGE Hook&nbsp;</div><div>应用程序使用WH_GETMESSAGE Hook来监视从GetMessage or PeekMessage函数返回的消息。你可以使用WH_GETMESSAGE Hook去监视鼠标和键盘输入，以及其他发送到消息队列中的消息。&nbsp;</div><div>6、WH_JOURNALPLAYBACK Hook&nbsp;</div><div>WH_JOURNALPLAYBACK Hook使应用程序可以插入消息到系统消息队列。可以使用这个Hook回放通过使用WH_JOURNALRECORD Hook记录下来的连续的鼠标和键盘事件。只要WH_JOURNALPLAYBACK Hook已经安装，正常的鼠标和键盘事件就是无效的。WH_JOURNALPLAYBACK Hook是全局Hook，它不能象线程特定Hook一样使用。WH_JOURNALPLAYBACK Hook返回超时值，这个值告诉系统在处理来自回放Hook当前消息之前需要等待多长时间（毫秒）。这就使Hook可以控制实时事件的回放。 WH_JOURNALPLAYBACK是system-wide local hooks，它們不會被注射到任何行程位址空間。（估计按键精灵是用这个hook做的）&nbsp;</div><div>7、WH_JOURNALRECORD Hook&nbsp;</div><div>WH_JOURNALRECORD Hook用来监视和记录输入事件。典型的，可以使用这个Hook记录连续的鼠标和键盘事件，然后通过使用WH_JOURNALPLAYBACK Hook来回放。WH_JOURNALRECORD Hook是全局Hook，它不能象线程特定Hook一样使用。WH_JOURNALRECORD是system-wide local hooks，它們不會被注射到任何行程位址空間。&nbsp;</div><div>8、WH_KEYBOARD Hook&nbsp;</div><div>在应用程序中，WH_KEYBOARD Hook用来监视WM_KEYDOWN and WM_KEYUP消息，这些消息通过GetMessage or PeekMessage function返回。可以使用这个Hook来监视输入到消息队列中的键盘消息。&nbsp;</div><div>9、WH_KEYBOARD_LL Hook&nbsp;</div><div>WH_KEYBOARD_LL Hook监视输入到线程消息队列中的键盘消息。&nbsp;</div><div>10、WH_MOUSE Hook&nbsp;</div><div>WH_MOUSE Hook监视从GetMessage 或者 PeekMessage 函数返回的鼠标消息。使用这个Hook监视输入到消息队列中的鼠标消息。&nbsp;</div><div>11、WH_MOUSE_LL Hook&nbsp;</div><div>WH_MOUSE_LL Hook监视输入到线程消息队列中的鼠标消息。&nbsp;</div><div>12、WH_MSGFILTER 和 WH_SYSMSGFILTER Hooks&nbsp;</div><div>WH_MSGFILTER 和 WH_SYSMSGFILTER Hooks使我们可以监视菜单，滚动条，消息框，对话框消息并且发现用户使用ALT+TAB or ALT+ESC 组合键切换窗口。WH_MSGFILTER Hook只能监视传递到菜单，滚动条，消息框的消息，以及传递到通过安装了Hook子程的应用程序建立的对话框的消息。WH_SYSMSGFILTER Hook监视所有应用程序消息。WH_MSGFILTER 和 WH_SYSMSGFILTER Hooks使我们可以在模式循环期间过滤消息，这等价于在主消息循环中过滤消息。通过调用CallMsgFilter function可以直接的调用WH_MSGFILTER Hook。通过使用这个函数，应用程序能够在模式循环期间使用相同的代码去过滤消息，如同在主消息循环里一样。&nbsp;</div><div>13、WH_SHELL Hook&nbsp;</div><div>外壳应用程序可以使用WH_SHELL Hook去接收重要的通知。当外壳应用程序是激活的并且当顶层窗口建立或者销毁时，系统调用WH_SHELL Hook子程。&nbsp;</div><div>WH_SHELL 共有５钟情況：&nbsp;</div><div>1. 只要有个top-level、unowned 窗口被产生、起作用、或是被摧毁；&nbsp;</div><div>2. 当Taskbar需要重画某个按钮；&nbsp;</div><div>3. 当系统需要显示关于Taskbar的一个程序的最小化形式；&nbsp;</div><div>4. 当目前的键盘布局状态改变；&nbsp;</div><div>5. 当使用者按Ctrl+Esc去执行Task Manager（或相同级别的程序）。&nbsp;</div><div>按照惯例，外壳应用程序都不接收WH_SHELL消息。所以，在应用程序能够接收WH_SHELL消息之前，应用程序必须调用SystemParametersInfo function注册它自己。&nbsp;</div><div>以上是13种常用的hook类型！&nbsp;</div><div>　　二． 按使用范围分类，主要有线程钩子和系统钩子&nbsp;</div><div>　　（1） 线程钩子监视指定线程的事件消息。&nbsp;</div><div>　　（2） 系统钩子监视系统中的所有线程的事件消息。因为系统钩子会影响系统中所有的应用程序，所以钩子函数必须放在独立的动态链接库(DLL)&nbsp;</div><div>中。这是系统钩子和线程钩子很大的不同之处。&nbsp;</div><div>　　 几点需要说明的地方：&nbsp;</div><div>　　（1） 如果对于同一事件（如鼠标消息）既安装了线程钩子又安装了系统钩子，那么系统会自动先调用线程钩子，然后调用系统钩子。&nbsp;</div><div>　　（2） 对同一事件消息可安装多个钩子处理过程，这些钩子处理过程形成了钩子链。当前钩子处理结束后应把钩子信息传递给下一个钩子函数。而且最近安装的钩子放在链的开始，而最早安装的钩子放在最后，也就是后加入的先获得控制权。&nbsp;</div><div>　　（3） 钩子特别是系统钩子会消耗消息处理时间，降低系统性能。只有在必要的时候才安装钩子，在使用完毕后要及时卸载。&nbsp;</div><div>编写钩子程序&nbsp;</div><div>　　 编写钩子程序的步骤分为三步：定义钩子函数、安装钩子和卸载钩子。&nbsp;</div><div>　　1．定义钩子函数&nbsp;</div><div>　　钩子函数是一种特殊的回调函数。钩子监视的特定事件发生后，系统会调用钩子函数进行处理。不同事件的钩子函数的形式是各不相同的。下面以鼠标钩子函数举例说明钩子函数的原型：&nbsp;</div><div>LRESULT CALLBACK HookProc(int nCode ,WPARAM wParam,LPARAM lParam)&nbsp;</div><div>参数wParam和 lParam包含所钩消息的信息，比如鼠标位置、状态，键盘按键等。nCode包含有关消息本身的信息，比如是否从消息队列中移出。&nbsp;</div><div>我们先在钩子函数中实现自定义的功能，然后调用函数 CallNextHookEx.把钩子信息传递给钩子链的下一个钩子函数。CallNextHookEx.的原型如下：&nbsp;</div><div>LRESULT CallNextHookEx( HHOOK hhk, int nCode, WPARAM wParam, LPARAM lParam )&nbsp;</div><div>参数 hhk是钩子句柄。nCode、wParam和lParam 是钩子函数。&nbsp;</div><div>当然也可以通过直接返回TRUE来丢弃该消息，就阻止了该消息的传递。&nbsp;</div><div>2．安装钩子&nbsp;</div><div>　　在程序初始化的时候，调用函数SetWindowsHookEx安装钩子。其函数原型为：&nbsp;</div><div>HHOOK SetWindowsHookEx( int idHook,HOOKPROC lpfn, INSTANCE hMod,DWORD dwThreadId )&nbsp;</div><div>参数idHook表示钩子类型，它是和钩子函数类型一一对应的。比如，WH_KEYBOARD表示安装的是键盘钩子，WH_MOUSE表示是鼠标钩子等等。&nbsp;</div><div>　　Lpfn是钩子函数的地址。&nbsp;</div><div>　　HMod是钩子函数所在的实例的句柄。对于线程钩子，该参数为NULL；对于系统钩子，该参数为钩子函数所在的DLL句柄。&nbsp;</div><div>　　 dwThreadId 指定钩子所监视的线程的线程号。对于全局钩子，该参数为NULL。&nbsp;</div><div>　　SetWindowsHookEx返回所安装的钩子句柄。&nbsp;</div><div>　　3．卸载钩子&nbsp;</div><div>　　 当不再使用钩子时，必须及时卸载。简单地调用函数 BOOL UnhookWindowsHookEx( HHOOK hhk)即可。&nbsp;</div><div>　　&nbsp;</div><div>值得注意的是线程钩子和系统钩子的钩子函数的位置有很大的差别。线程钩子一般在当前线程或者当前线程派生的线程内，而系统钩子必须放在独立的动态链接库中，实现起来要麻烦一些。&nbsp;</div><div><br /></div><div>线程钩子的编程实例：&nbsp;</div><div>　　按照上面介绍的方法实现一个线程级的鼠标钩子。钩子跟踪当前窗口鼠标移动的位置变化信息。并输出到窗口。&nbsp;</div><div>　　(1)在VC＋＋6.0中利用MFC&nbsp;</div><div>APPWizard（EXE）生成一个不使用文档/视结构的单文档应用mousehook。打开childview.cpp文件，加入全局变量：&nbsp;</div><div>HHOOK hHook;//鼠标钩子句柄&nbsp;</div><div>CPoint point;//鼠标位置信息&nbsp;</div><div>CChildView ＊pView;&nbsp;</div><div>// 鼠标钩子函数用到的输出窗口指针&nbsp;</div><div><br /></div><div>　　在CChildView::OnPaint()添加如下代码：&nbsp;</div><div>CPaintDC dc(this);&nbsp;</div><div>char str[256];&nbsp;</div><div>sprintf(str,&ldquo;x=％d,y=％d&quot;,point.x,point.y);&nbsp;</div><div>//构造字符串&nbsp;</div><div>dc.TextOut(0,0,str); //显示字符串&nbsp;</div><div><br /></div><div>　　(2)childview.cpp文件中定义全局的鼠标钩子函数。&nbsp;</div><div>LRESULT CALLBACK MouseProc&nbsp;</div><div>(int nCode, WPARAM wParam, LPARAM lParam)&nbsp;</div><div>&#123;//是鼠标移动消息&nbsp;</div><div>if(wParam==WM_MOUSEMOVE&#124;&#124;wParam&nbsp;</div><div>==WM_NCMOUSEMOVE)&nbsp;</div><div>&#123;&nbsp;</div><div>point=((MOUSEHOOKSTRUCT ＊)lParam)－&gt;pt;&nbsp;</div><div>//取鼠标信息&nbsp;</div><div>pView－&gt;Invalidate(); //窗口重画&nbsp;</div><div>&#125;&nbsp;</div><div>return CallNextHookEx(hHook,nCode,wParam,lParam);&nbsp;</div><div>//传递钩子信息&nbsp;</div><div>&#125;&nbsp;</div><div>(3)CChildView类的构造函数中安装钩子。&nbsp;</div><div>CChildView::CChildView()&nbsp;</div><div>&#123;&nbsp;</div><div>pView=this;//获得输出窗口指针&nbsp;</div><div>hHook=SetWindowsHookEx(WH_MOUSE,MouseProc,0,GetCurrentThreadId());&nbsp;</div><div>&#125;&nbsp;</div><div>(4)CChildView类的析构函数中卸载钩子。&nbsp;</div><div>CChildView::～CChildView()&nbsp;</div><div>&#123;&nbsp;</div><div>if(hHook)&nbsp;</div><div>UnhookWindowsHookEx(hHook);&nbsp;</div><div>&#125;&nbsp;</div><div><br /></div><div>系统钩子的编程实例：&nbsp;</div><div>由于系统钩子要用到dll，所以先介绍下win32 dll的特点：&nbsp;</div><div>Win32 DLL与 Win16 DLL有很大的区别，这主要是由操作系统的设计思想决定的。一方面，在Win16 DLL中程序入口点函数和出口点函数（LibMain和WEP）是分别实现的；而在Win32 DLL中却由同一函数DLLMain来实现。无论何时，当一个进程或线程载入和卸载DLL时，都要调用该函数，它的原型是BOOL WINAPI DllMain&nbsp;</div><div>(HINSTANCE hinstDLL,DWORD fdwReason, LPVOID lpvReserved);，其中，第一个参数表示DLL的实例句柄；第三个参数系统保留；这里主要介绍一下第二个参数，它有四个可能的值： DLL_PROCESS_ATTACH（进程载入），DLL_THREAD_ATTACH（线程载入），DLL_THREAD_DETACH（线程卸 载），DLL_PROCESS_DETACH（进程卸载），在DLLMain函数中可以对传递进来的这个参数的值进行判别，并根据不同的参数值对DLL进 行必要的初始化或清理工作。举个例子来说，当有一个进程载入一个DLL时，系统分派给DLL的第二个参数为DLL_PROCESS_ATTACH，这时， 你可以根据这个参数初始化特定的数据。另一方面，在Win16环境下，所有应用程序都在同一地址空间；而在Win32环境下，所有应用程序都有自己的私有 空间，每个进程的空间都是相互独立的，这减少了应用程序间的相互影响，但同时也增加了编程的难度。大家知道，在Win16环境中，DLL的全局数据对每个 载入它的进程来说都是相同的；而在Win32环境中，情况却发生了变化，当进程在载入DLL时，系统自动把DLL地址映射到该进程的私有空间，而且也复制 该DLL的全局数据的一份拷贝到该进程空间，也就是说每个进程所拥有的相同的DLL的全局数据其值却并不一定是相同的。因此，在Win32环境下要想在多 个进程中共享数据，就必须进行必要的设置。亦即把这些需要共享的数据分离出来，放置在一个独立的数据段里，并把该段的属性设置为共享。&nbsp;</div><div>在VC6 中有三种形式的MFC DLL（在该DLL中可以使用和继承已有的MFC类)可供选择，即Regular statically linked to MFC DLL（标准静态链接MFC DLL）和Regular using the shared MFC DLL（标准动态链接MFC DLL）以及Extension MFC DLL（扩展MFC DLL）。第一种DLL的特点是，在编译时把使用的MFC代码加入到DLL中，因此，在使用该程序时不需要其他MFC动态链接类库的存在，但占用磁盘空间 比较大；第二种DLL的特点是，在运行时，动态链接到MFC类库，因此减少了空间的占用，但是在运行时却依赖于MFC动态链接类库；这两种DLL既可以被 MFC程序使用也可以被Win32程序使用。第三种DLL的特点类似于第二种，做为MFC类库的扩展，只能被MFC程序使用。&nbsp;</div><div>下面说说在VC6中全局共享数据的实现&nbsp;</div><div>　　在主文件中，用#pragma data_seg建立一个新的数据段并定义共享数据，其具体格式为：&nbsp;</div><div>　　#pragma data_seg （&quot;shareddata&quot;)&nbsp;</div><div>　　HWND sharedwnd=NULL;//共享数据&nbsp;</div><div>　　#pragma data_seg()&nbsp;</div><div>　　仅定义一个数据段还不能达到共享数据的目的，还要告诉编译器该段的属性，有两种方法可以实现该目的（其效果是相同的），一种方法是在.DEF文件中加入如下语句：&nbsp;</div><div>SETCTIONS shareddata READ WRITE SHARED&nbsp;</div><div>　　另一种方法是在项目设置链接选项中加入如下语句：&nbsp;</div><div>　　/SECTION:shareddata,rws&nbsp;</div><div>好了，准备知识已经学完了，让我们开始编写个全局的钩子程序吧！&nbsp;</div><div><br /></div><div>由于全局钩子函数必须包含在动态链接库中，所以本例由两个程序体来实现。&nbsp;</div><div>1．建立钩子Mousehook.DLL&nbsp;</div><div>　　(1)选择MFC AppWizard(DLL)创建项目Mousehook；&nbsp;</div><div>　　(2)选择MFC Extension DLL（共享MFC拷贝）类型；&nbsp;</div><div>　　(3)由于VC5没有现成的钩子类，所以要在项目目录中创建Mousehook.h文件，在其中建立钩子类：&nbsp;</div><div>　　class AFX_EXT_CLASS Cmousehook:public CObject&nbsp;</div><div>　　&#123;&nbsp;</div><div>　　public:&nbsp;</div><div>　　Cmousehook();&nbsp;</div><div>　　//钩子类的构造函数&nbsp;</div><div>　　~Cmousehook();&nbsp;</div><div>　　//钩子类的析构函数&nbsp;</div><div>　　BOOL starthook(HWND hWnd);&nbsp;</div><div>　　//安装钩子函数&nbsp;</div><div>　　BOOL stophook();&nbsp;</div><div>　　卸载钩子函数&nbsp;</div><div>　　&#125;;&nbsp;</div><div>　　(4)在Mousehook.app文件的顶部加入#include&quot;Mousehook.h&quot;语句；&nbsp;</div><div>　　(5)加入全局共享数据变量：&nbsp;</div><div>　　#pragma data_seg(&quot;mydata&quot;)&nbsp;</div><div>　　HWND glhPrevTarWnd=NULL;&nbsp;</div><div>　　//上次鼠标所指的窗口句柄&nbsp;</div><div>　　HWND glhDisplayWnd=NULL;&nbsp;</div><div>　　//显示目标窗口标题编辑框的句柄&nbsp;</div><div>　　HHOOK glhHook=NULL;&nbsp;</div><div>　　//安装的鼠标钩子句柄&nbsp;</div><div>　　HINSTANCE glhInstance=NULL;&nbsp;</div><div>　　//DLL实例句柄&nbsp;</div><div>　　#pragma data_seg()&nbsp;</div><div>　　(6)在DEF文件中定义段属性：&nbsp;</div><div>　　SECTIONS&nbsp;</div><div>　　mydata READ WRITE SHARED&nbsp;</div><div>　　(7)在主文件Mousehook.cpp的DllMain函数中加入保存DLL实例句柄的语句：&nbsp;</div><div>　　DllMain(HINSTANCE hInstance, DWORD dwReason, LPVOID lpReserved)&nbsp;</div><div>　　&#123;&nbsp;</div><div>　　//如果使用lpReserved参数则删除下面这行&nbsp;</div><div>　　UNREFERENCED_PARAMETER(lpReserved);&nbsp;</div><div>　　if (dwReason == DLL_PROCESS_ATTACH)&nbsp;</div><div>　　&#123;&nbsp;</div><div>　　 TRACE0(&quot;MOUSEHOOK.DLL Initializing!&#92;n&quot;);&nbsp;</div><div>　　 //扩展DLL仅初始化一次&nbsp;</div><div>　　 if (!AfxInitExtensionModule(MousehookDLL, hInstance))&nbsp;</div><div>　　 return 0;&nbsp;</div><div>　　 new CDynLinkLibrary(MousehookDLL);&nbsp;</div><div>　　 //把DLL加入动态MFC类库中&nbsp;</div><div>　　 glhInstance=hInstance;&nbsp;</div><div>　　 //插入保存DLL实例句柄&nbsp;</div><div>　　&#125;&nbsp;</div><div>　　else if (dwReason == DLL_PROCESS_DETACH)&nbsp;</div><div>　　&#123;&nbsp;</div><div>　　 TRACE0(&quot;MOUSEHOOK.DLL Terminating!&#92;n&quot;);&nbsp;</div><div>　　 //终止这个链接库前调用它&nbsp;</div><div>　　 AfxTermExtensionModule(MousehookDLL);&nbsp;</div><div>　　&#125;&nbsp;</div><div>　　return 1;&nbsp;</div><div>　　&#125;&nbsp;</div><div>　　(8)类Cmousehook的成员函数的具体实现：&nbsp;</div><div>　　Cmousehook::Cmousehook()&nbsp;</div><div>　　//类构造函数&nbsp;</div><div>　　&#123;&nbsp;</div><div>　　&#125;&nbsp;</div><div>　　Cmousehook::~Cmousehook()&nbsp;</div><div>　　//类析构函数&nbsp;</div><div>　　&#123;&nbsp;</div><div>　　stophook();&nbsp;</div><div>　　&#125;&nbsp;</div><div>　　BOOL Cmousehook::starthook(HWND hWnd)&nbsp;</div><div>　　//安装钩子并设定接收显示窗口句柄&nbsp;</div><div>　　&#123;&nbsp;</div><div>　　BOOL bResult=FALSE;&nbsp;</div><div>　　glhHook=SetWindowsHookEx(WH_MOUSE,MouseProc,glhInstance,0);&nbsp;</div><div>　　if(glhHook!=NULL)&nbsp;</div><div>　　 bResult=TRUE;&nbsp;</div><div>　　glhDisplayWnd=hWnd;&nbsp;</div><div>　　//设置显示目标窗口标题编辑框的句柄&nbsp;</div><div>　　return bResult;&nbsp;</div><div>　　&#125;&nbsp;</div><div>　　BOOL Cmousehook::stophook()&nbsp;</div><div>　　//卸载钩子&nbsp;</div><div>　　&#123;&nbsp;</div><div>　　BOOL bResult=FALSE;&nbsp;</div><div>　　if(glhHook)&nbsp;</div><div>　　&#123;&nbsp;</div><div>　　 bResult= UnhookWindowsHookEx(glhHook);&nbsp;</div><div>　　 if(bResult)&nbsp;</div><div>　　 &#123;&nbsp;</div><div>　　 glhPrevTarWnd=NULL;&nbsp;</div><div>　　 glhDisplayWnd=NULL;//清变量&nbsp;</div><div>　　 glhHook=NULL;&nbsp;</div><div>　　 &#125;&nbsp;</div><div>　　&#125;&nbsp;</div><div>　　return bResult;&nbsp;</div><div>　　&#125;&nbsp;</div><div>　　(9)钩子函数的实现：&nbsp;</div><div>　　LRESULT WINAPI MouseProc(int nCode,WPARAM wparam,LPARAM lparam)&nbsp;</div><div>　　&#123;&nbsp;</div><div>　　LPMOUSEHOOKSTRUCT pMouseHook=(MOUSEHOOKSTRUCT FAR *) lparam;&nbsp;</div><div>　　 if (nCode&gt;=0)&nbsp;</div><div>　　 &#123;&nbsp;</div><div>　　HWND glhTargetWnd=pMouseHook-&gt;hwnd;&nbsp;</div><div>　　//取目标窗口句柄&nbsp;</div><div>　　 HWND ParentWnd=glhTargetWnd;&nbsp;</div><div>　　 while (ParentWnd !=NULL)&nbsp;</div><div>　　 &#123;&nbsp;</div><div>　　 glhTargetWnd=ParentWnd;&nbsp;</div><div>　　 ParentWnd=GetParent(glhTargetWnd);&nbsp;</div><div>　　 //取应用程序主窗口句柄&nbsp;</div><div>　　 &#125;&nbsp;</div><div>　　 if(glhTargetWnd!=glhPrevTarWnd)&nbsp;</div><div>　　 &#123;&nbsp;</div><div>　　 char szCaption[100];&nbsp;</div><div>　　 GetWindowText(glhTargetWnd,szCaption,100);&nbsp;</div><div>　　 //取目标窗口标题&nbsp;</div><div>　　 if(IsWindow(glhDisplayWnd))&nbsp;</div><div>　　 SendMessage(glhDisplayWnd,WM_SETTEXT,0,(LPARAM)(LPCTSTR)szCaption);&nbsp;</div><div>　　 glhPrevTarWnd=glhTargetWnd;&nbsp;</div><div>　　 //保存目标窗口&nbsp;</div><div>　　 &#125;&nbsp;</div><div>　　 &#125;&nbsp;</div><div>　　 return CallNextHookEx(glhHook,nCode,wparam,lparam);&nbsp;</div><div>　　 //继续传递消息&nbsp;</div><div>　　&#125;&nbsp;</div><div>　　(10)编译项目生成mousehook.dll。&nbsp;</div><div>　　2．创建钩子可执行程序&nbsp;</div><div>　　(1)用MFC的AppWizard(EXE)创建项目Mouse；&nbsp;</div><div>　　(2)选择&ldquo;基于对话应用&rdquo;并按下&ldquo;完成&rdquo;键；&nbsp;</div><div>　　(3)编辑对话框，删除其中原有的两个按钮，加入静态文本框和编辑框，用鼠标右键点击静态文本框，在弹出的菜单中选择&ldquo;属性&rdquo;，设置其标题为&ldquo;鼠标所在的窗口标题&rdquo;；&nbsp;</div><div><br /></div><div>　　(4)在Mouse.h中加入对Mousehook.h的包含语句#Include&quot;..&#92;Mousehook&#92;Mousehook.h&quot;；&nbsp;</div><div>　　(5)在CMouseDlg.h的CMouseDlg类定义中添加私有数据成员：&nbsp;</div><div>　　CMouseHook m_hook;//加入钩子类作为数据成员&nbsp;</div><div>　　(6)修改CmouseDlg::OnInitDialog()函数：&nbsp;</div><div>　　BOOL CMouseDlg::OnInitDialog()&nbsp;</div><div>　　&#123;&nbsp;</div><div>　　CDialog::OnInitDialog();&nbsp;</div><div>　　ASSERT((IDM_ABOUTBOX &amp; 0xFFF0) == IDM_ABOUTBOX);&nbsp;</div><div>　　ASSERT(IDM_ABOUTBOX &lt;0xF000);&nbsp;</div><div>　　CMenu* pSysMenu = GetSystemMenu(FALSE);&nbsp;</div><div>　　if (pSysMenu != NULL)&nbsp;</div><div>　　&#123;&nbsp;</div><div>　　 CString strAboutMenu;&nbsp;</div><div>　　 strAboutMenu.LoadString(IDS_ABOUTBOX);&nbsp;</div><div>　　 if (!strAboutMenu.IsEmpty())&nbsp;</div><div>　　 &#123;&nbsp;</div><div>　　 pSysMenu-&gt;AppendMenu(MF_SEPARATOR);&nbsp;</div><div>　　 pSysMenu-&gt;AppendMenu(MF_STRING, IDM_ABOUTBOX, strAboutMenu);&nbsp;</div><div>　　 &#125;&nbsp;</div><div>　　&#125;&nbsp;</div><div>　　SetIcon(m_hIcon, TRUE);//Set big icon&nbsp;</div><div>　　SetIcon(m_hIcon, FALSE);//Set small icon&nbsp;</div><div>　　//TODO: Add extra initialization here&nbsp;</div><div>　　CWnd * pwnd=GetDlgItem(IDC_EDIT1);&nbsp;</div><div>　　//取得编辑框的类指针&nbsp;</div><div>　　m_hook.starthook(pwnd-&gt;GetSafeHwnd());&nbsp;</div><div>　　//取得编辑框的窗口句柄并安装钩子&nbsp;</div><div>　　return TRUE;&nbsp;</div><div>　　//return TRUE unless you set the focus to a control&nbsp;</div><div>　　&#125;&nbsp;</div><div>　　(7)链接DLL库，即把..&#92;Mousehook&#92;debug&#92;Mousehook.lib加入到项目设置链接标签中；&nbsp;</div><div>　　(8)编译项目生成可执行文件；&nbsp;</div><div>　　(9)把Mousehook.DLL拷贝到..&#92;mouse&#92;debug目录中；&nbsp;</div><div>　　(10)先运行几个可执行程序，然后运行Mouse.exe程序，把鼠标在不同窗口中移动，在Mouse.exe程序窗口中的编辑框内将显示出鼠标所在的应用程序主窗口的标题。&nbsp;</div><div><br /></div><div>好了，终于写完了，累ing，这是钩子函数的入门知识，包括了线程钩子和全局钩子，希望高手们加以指点斧正！谢谢大家！&nbsp;</div><div>[附： 我有个疑问，希望高手们帮忙解决下，在编写线程钩子时，我用的是这个函数来安装钩子hHook=SetWindowsHookEx(WH_MOUSE, MouseProc,0,GetCurrentThreadId());第4个参数是GetCurrentThreadId()&nbsp;</div><div>是指此钩子函数监测的是自己的那个程序，那么如果我想监测其他一个特定程序的话，此参数该如何定义出来呢？比如想只监测mir3程序，该如何定义第4个参数呢？谢谢！]&nbsp;</div><div><br /></div><div><br /></div><div><br /></div><div>本文来自CSDN博客，转载请标明出处：http://blog.csdn.net/maliang1225/articles/1968784.aspx</div> 
	</div>
	<div class="textbox-bottom">
	</div>
	<div class="tags" style="display: none">  
	</div>
</div>
<div id="commentWrapper" class="comment-wrapper">
	<a name="topreply"></a>
	<div id="addnew"></div>	<div class="comment-pages">
	
	</div>
</div>

					<div class="article-bottom" style="display: none">
						<div class="pages">
							
						</div>
					</div>
				</div>
			</div>
		<div id="sidebar" class="sidebar">
			<div id="innerSidebar">
				<div id="innerSidebarSearch">
					<form method="post" action="http://i.renjihe.com/blog/visit.php">
	<input name="job" type="hidden" value="search"/>
	<input name="keyword" class="search-field" type="text"/>
	<select name="searchmethod"><option value="1">日志标题</option><option value="2">日志全文</option><option value="3">评论引用</option><option value="4">所有留言</option></select>
	<input value="搜索" class="button" type="submit"/>
	</form>
				</div>
				<div id="innerSidebarOne">
					<div id='panelCategory' class="panel">
<h5 style="cursor: pointer" onclick='showhidediv("sideblock_category");'>分类</h5>
<div class="panel-content" id="sideblock_category" style="display: block">
<ul><li><a href="index.php-go=category_1.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_1" title="硬件">硬件</a> [1] <a href="feed.php-go=category_1" tppabs="http://i.renjihe.com/blog/feed.php?go=category_1"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_6.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_6" title="fpga/cpld">fpga/cpld</a> [10] <a href="feed.php-go=category_6" tppabs="http://i.renjihe.com/blog/feed.php?go=category_6"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_66.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_66" title="模电与电路">模电与电路</a> [1] <a href="feed.php-go=category_66" tppabs="http://i.renjihe.com/blog/feed.php?go=category_66"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_7.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_7" title="DSP">DSP</a> [14] <a href="feed.php-go=category_7" tppabs="http://i.renjihe.com/blog/feed.php?go=category_7"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_27.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_27" title="硬件知识">硬件知识</a> [26] <a href="feed.php-go=category_27" tppabs="http://i.renjihe.com/blog/feed.php?go=category_27"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_73.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_73" title="3D打印">3D打印</a> [1] <a href="feed.php-go=category_73" tppabs="http://i.renjihe.com/blog/feed.php?go=category_73"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_64.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_64" title="资讯">资讯</a> [18] <a href="feed.php-go=category_64" tppabs="http://i.renjihe.com/blog/feed.php?go=category_64"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_78.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_78" title="树莓派">树莓派</a> [5] <a href="feed.php-go=category_78" tppabs="http://i.renjihe.com/blog/feed.php?go=category_78"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_2.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_2" title="软件">软件</a> [0] <a href="feed.php-go=category_2.htm" tppabs="http://i.renjihe.com/blog/feed.php?go=category_2"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_9.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_9" title="linux">linux</a> [912] <a href="feed.php-go=category_9" tppabs="http://i.renjihe.com/blog/feed.php?go=category_9"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_14.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_14" title="QT">QT</a> [131] <a href="feed.php-go=category_14" tppabs="http://i.renjihe.com/blog/feed.php?go=category_14"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_82.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_82" title="Lua">Lua</a> [15] <a href="feed.php-go=category_82" tppabs="http://i.renjihe.com/blog/feed.php?go=category_82"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_15.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_15" title="Android">Android</a> [261] <a href="feed.php-go=category_15" tppabs="http://i.renjihe.com/blog/feed.php?go=category_15"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_65.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_65" title="Iphone">Iphone</a> [48] <a href="feed.php-go=category_65" tppabs="http://i.renjihe.com/blog/feed.php?go=category_65"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_32.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_32" title="windows">windows</a> [61] <a href="feed.php-go=category_32" tppabs="http://i.renjihe.com/blog/feed.php?go=category_32"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_31.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_31" title="webkit">webkit</a> [79] <a href="feed.php-go=category_31" tppabs="http://i.renjihe.com/blog/feed.php?go=category_31"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_10.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_10" title="C/C++">C/C++</a> [98] <a href="feed.php-go=category_10" tppabs="http://i.renjihe.com/blog/feed.php?go=category_10"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_29.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_29" title="lisp、Erlang">Erlang、Lisp</a> [28] <a href="feed.php-go=category_29" tppabs="http://i.renjihe.com/blog/feed.php?go=category_29"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_46.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_46" title="Python">Python</a> [255] <a href="feed.php-go=category_46" tppabs="http://i.renjihe.com/blog/feed.php?go=category_46"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_18.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_18" title="Java">Java</a> [25] <a href="feed.php-go=category_18" tppabs="http://i.renjihe.com/blog/feed.php?go=category_18"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_13.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_13" title="web">web</a> [486] <a href="feed.php-go=category_13" tppabs="http://i.renjihe.com/blog/feed.php?go=category_13"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_50.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_50" title="测试">测试</a> [12] <a href="feed.php-go=category_50" tppabs="http://i.renjihe.com/blog/feed.php?go=category_50"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_23.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_23" title="源码分析">源码分析</a> [85] <a href="feed.php-go=category_23" tppabs="http://i.renjihe.com/blog/feed.php?go=category_23"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_19.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_19" title="编译原理">编译原理</a> [82] <a href="feed.php-go=category_19" tppabs="http://i.renjihe.com/blog/feed.php?go=category_19"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_83.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_83" title="黑客">黑客</a> [4] <a href="feed.php-go=category_83" tppabs="http://i.renjihe.com/blog/feed.php?go=category_83"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_39.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_39" title="GPU编程">GPU编程</a> [89] <a href="feed.php-go=category_39" tppabs="http://i.renjihe.com/blog/feed.php?go=category_39"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_48.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_48" title="OpenGL">OpenGL</a> [117] <a href="feed.php-go=category_48" tppabs="http://i.renjihe.com/blog/feed.php?go=category_48"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_52.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_52" title="OpenCV">OpenCV</a> [18] <a href="feed.php-go=category_52" tppabs="http://i.renjihe.com/blog/feed.php?go=category_52"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_20.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_20" title="音视频与流媒体">音视频与流媒体</a> [412] <a href="feed.php-go=category_20" tppabs="http://i.renjihe.com/blog/feed.php?go=category_20"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_62.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_62" title="游戏">游戏</a> [455] <a href="feed.php-go=category_62" tppabs="http://i.renjihe.com/blog/feed.php?go=category_62"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_54.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_54" title="FLEX&AS">FLEX&amp;AS</a> [124] <a href="feed.php-go=category_54" tppabs="http://i.renjihe.com/blog/feed.php?go=category_54"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_61.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_61" title="编程杂项">编程杂项</a> [55] <a href="feed.php-go=category_61" tppabs="http://i.renjihe.com/blog/feed.php?go=category_61"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_57.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_57" title="网络安全">网络安全</a> [43] <a href="feed.php-go=category_57" tppabs="http://i.renjihe.com/blog/feed.php?go=category_57"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_28.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_28" title="软件工程">软件工程</a> [40] <a href="feed.php-go=category_28" tppabs="http://i.renjihe.com/blog/feed.php?go=category_28"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_74.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_74" title="并行编程">并行编程</a> [4] <a href="feed.php-go=category_74" tppabs="http://i.renjihe.com/blog/feed.php?go=category_74"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_77.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_77" title="大数据">大数据</a> [10] <a href="feed.php-go=category_77" tppabs="http://i.renjihe.com/blog/feed.php?go=category_77"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_37.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_37" title="理论">理论</a> [0] <a href="feed.php-go=category_37.htm" tppabs="http://i.renjihe.com/blog/feed.php?go=category_37"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_38.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_38" title="数学">数学</a> [75] <a href="feed.php-go=category_38" tppabs="http://i.renjihe.com/blog/feed.php?go=category_38"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_43.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_43" title="物理">物理</a> [19] <a href="feed.php-go=category_43" tppabs="http://i.renjihe.com/blog/feed.php?go=category_43"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_24.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_24" title="算法">算法</a> [80] <a href="feed.php-go=category_24" tppabs="http://i.renjihe.com/blog/feed.php?go=category_24"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_40.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_40" title="音频处理">音频处理</a> [3] <a href="feed.php-go=category_40" tppabs="http://i.renjihe.com/blog/feed.php?go=category_40"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_36.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_36" title="CV&Graphic">CV&amp;Graphic</a> [183] <a href="feed.php-go=category_36" tppabs="http://i.renjihe.com/blog/feed.php?go=category_36"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_35.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_35" title="AR&AI&模式识别">AR&amp;AI&amp;模式识别</a> [127] <a href="feed.php-go=category_35" tppabs="http://i.renjihe.com/blog/feed.php?go=category_35"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_26.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_26" title="工具">工具</a> [56] <a href="feed.php-go=category_26" tppabs="http://i.renjihe.com/blog/feed.php?go=category_26"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_3.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_3" title="新鲜玩意">新鲜玩意</a> [446] <a href="feed.php-go=category_3" tppabs="http://i.renjihe.com/blog/feed.php?go=category_3"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_63.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_63" title="行业应用">行业应用</a> [6] <a href="feed.php-go=category_63" tppabs="http://i.renjihe.com/blog/feed.php?go=category_63"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_4.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_4" title="资讯">资讯</a> [137] <a href="feed.php-go=category_4" tppabs="http://i.renjihe.com/blog/feed.php?go=category_4"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_12.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_12" title="网文">网文</a> [622] <a href="feed.php-go=category_12" tppabs="http://i.renjihe.com/blog/feed.php?go=category_12"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_41.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_41" title="点子正传">点子正传</a> [20] <a href="feed.php-go=category_41" tppabs="http://i.renjihe.com/blog/feed.php?go=category_41"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_56.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_56" title="理财">理财</a> [24] <a href="feed.php-go=category_56" tppabs="http://i.renjihe.com/blog/feed.php?go=category_56"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_55.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_55" title="收集">收集</a> [157] <a href="feed.php-go=category_55" tppabs="http://i.renjihe.com/blog/feed.php?go=category_55"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_71.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_71" title="创业">创业</a> [405] <a href="feed.php-go=category_71" tppabs="http://i.renjihe.com/blog/feed.php?go=category_71"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_80.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_80" title="共享软件">共享软件</a> [12] <a href="feed.php-go=category_80" tppabs="http://i.renjihe.com/blog/feed.php?go=category_80"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_72.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_72" title="创意">创意</a> [20] <a href="feed.php-go=category_72" tppabs="http://i.renjihe.com/blog/feed.php?go=category_72"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_85.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_85" title="星象命理">星象命理</a> [40] <a href="feed.php-go=category_85" tppabs="http://i.renjihe.com/blog/feed.php?go=category_85"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_11.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_11" title="杂项">杂项</a> [50] <a href="feed.php-go=category_11" tppabs="http://i.renjihe.com/blog/feed.php?go=category_11"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_58.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_58" title="记录">记录</a> [26] <a href="feed.php-go=category_58" tppabs="http://i.renjihe.com/blog/feed.php?go=category_58"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_79.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_79" title="心灵鸡汤">心灵鸡汤</a> [78] <a href="feed.php-go=category_79" tppabs="http://i.renjihe.com/blog/feed.php?go=category_79"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_75.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_75" title="文学">文学</a> [9] <a href="feed.php-go=category_75" tppabs="http://i.renjihe.com/blog/feed.php?go=category_75"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_67.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_67" title="其它工程资料">其它工程资料</a> [2] <a href="feed.php-go=category_67" tppabs="http://i.renjihe.com/blog/feed.php?go=category_67"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_84.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_84" title="哲学">哲学</a> [24] <a href="feed.php-go=category_84" tppabs="http://i.renjihe.com/blog/feed.php?go=category_84"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_87.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_87" title="有言">有言</a> [9] <a href="feed.php-go=category_87" tppabs="http://i.renjihe.com/blog/feed.php?go=category_87"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_88.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_88" title="微语录">微语录</a> [15] <a href="feed.php-go=category_88" tppabs="http://i.renjihe.com/blog/feed.php?go=category_88"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_76.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_76" title="置顶">置顶</a> [440] <a href="feed.php-go=category_76" tppabs="http://i.renjihe.com/blog/feed.php?go=category_76"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_86.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_86" title="励志">励志</a> [10] <a href="feed.php-go=category_86" tppabs="http://i.renjihe.com/blog/feed.php?go=category_86"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_81.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_81" title="资源管理">资源管理</a> [1] <a href="feed.php-go=category_81" tppabs="http://i.renjihe.com/blog/feed.php?go=category_81"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li></ul>
</div>
</div><div class="panel">
<h5 onclick='showhidediv("sidebar_calendar");'>日历</h5>
<div class="panel-content" id="sidebar_calendar" style="display: block">
<table id="calendar" cellspacing="1" width="100%">
<tbody><tr><td colspan="7" class="calendar-top">
<a href="index.php-go=archive&cm=9&cy=2015.htm" tppabs="http://i.renjihe.com/blog/index.php?go=archive&cm=9&cy=2015" rel="noindex,nofollow">&lt;</a>
<a href="archive.php.htm" tppabs="http://i.renjihe.com/blog/archive.php" rel="noindex,nofollow"><span class="calendar-year">2016</span></a>
<a href="index.php-go=archive&cm=9&cy=2017.htm" tppabs="http://i.renjihe.com/blog/index.php?go=archive&cm=9&cy=2017" rel="noindex,nofollow">&gt;</a>
	&nbsp;&nbsp;
<a href="index.php-go=archive&cm=8&cy=2016.htm" tppabs="http://i.renjihe.com/blog/index.php?go=archive&cm=8&cy=2016" rel="noindex,nofollow">&lt;</a>
<a href="index.php-go=archive&cm=9&cy=2016.htm" tppabs="http://i.renjihe.com/blog/index.php?go=archive&cm=9&cy=2016" rel="noindex,nofollow"><span class="calendar-month">9</span></a>
<a href="index.php-go=archive&cm=10&cy=2016.htm" tppabs="http://i.renjihe.com/blog/index.php?go=archive&cm=10&cy=2016" rel="noindex,nofollow">&gt;</a>
</td></tr>
<tr class="calendar-weekdays">
	<td class="calendar-weekday-cell">日</td>
	<td class="calendar-weekday-cell">一</td>
	<td class="calendar-weekday-cell">二</td>
	<td class="calendar-weekday-cell">三</td>
	<td class="calendar-weekday-cell">四</td>
	<td class="calendar-weekday-cell">五</td>
	<td class="calendar-weekday-cell">六</td>
</tr>
<tr class="calendar-weekdays"><td class="calendar-sunday"></td><td class="calendar-day"></td><td class="calendar-day"></td><td class="calendar-day"></td><td id="cal1" class="calendar-day"><a href="index.php-go=showday_2016-9-1.htm" tppabs="http://i.renjihe.com/blog/index.php?go=showday_2016-9-1" rel="noindex,nofollow">1</a></td><td id="cal2" class="calendar-day">2</td><td id="cal3" class="calendar-today">3</td></tr><tr class="calendar-weekdays"><td id="cal4" class="calendar-sunday">4</td><td id="cal5" class="calendar-day">5</td><td id="cal6" class="calendar-day">6</td><td id="cal7" class="calendar-day">7</td><td id="cal8" class="calendar-day">8</td><td id="cal9" class="calendar-day">9</td><td id="cal10" class="calendar-saturday">10</td></tr><tr class="calendar-weekdays"><td id="cal11" class="calendar-sunday">11</td><td id="cal12" class="calendar-day">12</td><td id="cal13" class="calendar-day">13</td><td id="cal14" class="calendar-day">14</td><td id="cal15" class="calendar-day">15</td><td id="cal16" class="calendar-day">16</td><td id="cal17" class="calendar-saturday">17</td></tr><tr class="calendar-weekdays"><td id="cal18" class="calendar-sunday">18</td><td id="cal19" class="calendar-day">19</td><td id="cal20" class="calendar-day">20</td><td id="cal21" class="calendar-day">21</td><td id="cal22" class="calendar-day">22</td><td id="cal23" class="calendar-day">23</td><td id="cal24" class="calendar-saturday">24</td></tr><tr class="calendar-weekdays"><td id="cal25" class="calendar-sunday">25</td><td id="cal26" class="calendar-day">26</td><td id="cal27" class="calendar-day">27</td><td id="cal28" class="calendar-day">28</td><td id="cal29" class="calendar-day">29</td><td id="cal30" class="calendar-day">30</td><td class="calendar-saturday"></td></tr>
</tbody></table>
</div>
</div><div class="panel">
<h5 onclick='showhidediv("sidebar_statistics");'>统计</h5>
<div class="panel-content" id="sidebar_statistics" style="display: block">
访问次数 133640<br/>今日访问 1<br/>日志数量 7121<br/><a href="guestbook.php.htm" tppabs="http://i.renjihe.com/blog/guestbook.php">留言数量 2</a><br/>在线人数 1<br/>
</div>
</div><div class="panel">
<h5 onclick='showhidediv("sidebar_entries");'>最新日志</h5>
<div class="panel-content" id="sidebar_entries" style="display: block">
<ul><li class='rowcouple'><a href="read.php-7527.htm" tppabs="http://i.renjihe.com/blog/read.php?7527" title="mysql优化之索引优化">mysql优化之索引优化</a></li><li class='rowodd'><a href="read.php-7526.htm" tppabs="http://i.renjihe.com/blog/read.php?7526" title="Mysql limit 优化，百万至千万级快速分页，--复合索引的引用并应用于轻量级框架&nbsp;&nbsp;">Mysql limit ...</a></li><li class='rowcouple'><a href="read.php-7525.htm" tppabs="http://i.renjihe.com/blog/read.php?7525" title="mysql sql语句执行时间查询">mysql sql语句执...</a></li><li class='rowodd'><a href="read.php-7524.htm" tppabs="http://i.renjihe.com/blog/read.php?7524" title="GeoHash核心原理解析">GeoHash核心原理解...</a></li><li class='rowcouple'><a href="read.php-7523.htm" tppabs="http://i.renjihe.com/blog/read.php?7523" title="如何实现按距离排序、范围查找">如何实现按距离排序、范围...</a></li></ul>
</div>
</div>
				</div>
				<div id="innerSidebarTwo">
					<div class="panel">
<h5 onclick='showhidediv("sidebar_link");'>链接</h5>
<div class="panel-content" id="sidebar_link" style="display: block">
<ul><li><strong>协会</strong></li><li class="indent"><a href="javascript:if(confirm('http://www.siggraph.org/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.siggraph.org/'" tppabs="http://www.siggraph.org/" target="_blank" title="siggraph - ">siggraph</a></li><li class="indent"><a href="javascript:if(confirm('http://www.siggraph.org.cn/Pages/index.aspx  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.siggraph.org.cn/Pages/index.aspx'" tppabs="http://www.siggraph.org.cn/Pages/index.aspx" target="_blank" title="siggraph中国 - ">siggraph中国</a></li><li class="indent"><a href="javascript:if(confirm('http://www.igf.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.igf.com/'" tppabs="http://www.igf.com/" target="_blank" title="独立游戏节 - ">独立游戏节</a></li><li><strong>项目</strong></li><li class="indent"><a href="javascript:if(confirm('http://youyur.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://youyur.com/'" tppabs="http://youyur.com/" target="_blank" title="有鱼 - ">有鱼</a></li><li class="indent"><a href="javascript:if(confirm('http://codecanyon.net/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://codecanyon.net/'" tppabs="http://codecanyon.net/" target="_blank" title="codecanyon - ">codecanyon</a></li><li class="indent"><a href="javascript:if(confirm('http://www.sxsoft.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.sxsoft.com/'" tppabs="http://www.sxsoft.com/" target="_blank" title="软件项目交易网 - ">软件项目交易网</a></li><li class="indent"><a href="javascript:if(confirm('http://www.csto.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.csto.com/'" tppabs="http://www.csto.com/" target="_blank" title="csto - ">csto</a></li><li class="indent"><a href="javascript:if(confirm('http://themeforest.net/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://themeforest.net/'" tppabs="http://themeforest.net/" target="_blank" title="themeforest - ">themeforest</a></li><li class="indent"><a href="javascript:if(confirm('http://www.digitalriver.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.digitalriver.com/'" tppabs="http://www.digitalriver.com/" target="_blank" title="Digital River - ">Digital River</a></li><li class="indent"><a href="javascript:if(confirm('http://www.vworker.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.vworker.com/'" tppabs="http://www.vworker.com/" target="_blank" title="vworker - ">vworker</a></li><li class="indent"><a href="javascript:if(confirm('http://luexiao.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://luexiao.com/'" tppabs="http://luexiao.com/" target="_blank" title="略晓 - ">略晓</a></li><li class="indent"><a href="javascript:if(confirm('http://www.yateshi.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.yateshi.com/'" tppabs="http://www.yateshi.com/" target="_blank" title="雅特士外包网  - ">雅特士外包网 </a></li><li class="indent"><a href="javascript:if(confirm('http://wpappstore.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://wpappstore.com/'" tppabs="http://wpappstore.com/" target="_blank" title="WP App Store - ">WP App Store</a></li><li class="indent"><a href="javascript:if(confirm('http://store.steampowered.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://store.steampowered.com/'" tppabs="http://store.steampowered.com/" target="_blank" title="Steam - ">Steam</a></li><li class="indent"><a href="javascript:if(confirm('http://www.taskcity.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.taskcity.com/'" tppabs="http://www.taskcity.com/" target="_blank" title="TaskCity - ">TaskCity</a></li><li class="indent"><a href="javascript:if(confirm('http://www.istockphoto.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.istockphoto.com/'" tppabs="http://www.istockphoto.com/" target="_blank" title="iStockphoto - ">iStockphoto</a></li><li class="indent"><a href="javascript:if(confirm('http://envato.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://envato.com/'" tppabs="http://envato.com/" target="_blank" title="Envato - ">Envato</a></li><li class="indent"><a href="javascript:if(confirm('https://tutsplus.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='https://tutsplus.com/'" tppabs="https://tutsplus.com/" target="_blank" title="Tuts+ Premium - ">Tuts+ Premium</a></li><li class="indent"><a href="javascript:if(confirm('http://www.sharebank.com.cn/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.sharebank.com.cn/'" tppabs="http://www.sharebank.com.cn/" target="_blank" title="软行天下  - ">软行天下 </a></li><li class="indent"><a href="javascript:if(confirm('http://www.softreg.com.cn/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.softreg.com.cn/'" tppabs="http://www.softreg.com.cn/" target="_blank" title="中国共享软件注册中心 - ">中国共享软件注册中心</a></li><li class="indent"><a href="javascript:if(confirm('https://www.elance.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='https://www.elance.com/'" tppabs="https://www.elance.com/" target="_blank" title="Elance - ">Elance</a></li><li class="indent"><a href="javascript:if(confirm('http://www.freelancer.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.freelancer.com/'" tppabs="http://www.freelancer.com/" target="_blank" title="freelancer - ">freelancer</a></li><li class="indent"><a href="javascript:if(confirm('http://www.bizsofts.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.bizsofts.com/'" tppabs="http://www.bizsofts.com/" target="_blank" title="软件商务网 - ">软件商务网</a></li><li class="indent"><a href="javascript:if(confirm('https://www.odesk.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='https://www.odesk.com/'" tppabs="https://www.odesk.com/" target="_blank" title="oDesk - ">oDesk</a></li><li class="indent"><a href="javascript:if(confirm('http://store.raspberrypi.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://store.raspberrypi.com/'" tppabs="http://store.raspberrypi.com/" target="_blank" title="树莓派商店 - ">树莓派商店</a></li><li><strong>杂项</strong></li><li class="indent"><a href="javascript:if(confirm('http://www.codinghorror.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.codinghorror.com/'" tppabs="http://www.codinghorror.com/" target="_blank" title="codinghorror - ">codinghorror</a></li><li class="indent"><a href="javascript:if(confirm('http://www.fabiensanglard.net/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.fabiensanglard.net/'" tppabs="http://www.fabiensanglard.net/" target="_blank" title="fabiensanglard - ">fabiensanglard</a></li><li class="indent"><a href="javascript:if(confirm('http://www.intel.com/intelpress/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.intel.com/intelpress/'" tppabs="http://www.intel.com/intelpress/" target="_blank" title="英特尔出版社 - ">英特尔出版社</a></li><li class="indent"><a href="javascript:if(confirm('http://www.opencart.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.opencart.com/'" tppabs="http://www.opencart.com/" target="_blank" title="OpenCart - ">OpenCart</a></li><li class="indent"><a href="javascript:if(confirm('http://www.appinn.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.appinn.com/'" tppabs="http://www.appinn.com/" target="_blank" title="小众软件 - ">小众软件</a></li><li class="indent"><a href="javascript:if(confirm('http://renderhjs.net/shoebox/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://renderhjs.net/shoebox/'" tppabs="http://renderhjs.net/shoebox/" target="_blank" title="shoebox工具 - ">shoebox工具</a></li><li><strong>个人</strong></li><li><strong>阅读</strong></li><li class="indent"><a href="javascript:if(confirm('http://huaban.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://huaban.com/'" tppabs="http://huaban.com/" target="_blank" title="花瓣网 - ">花瓣网</a></li><li class="indent"><a href="javascript:if(confirm('http://www.oralstudy.cn/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.oralstudy.cn/'" tppabs="http://www.oralstudy.cn/" target="_blank" title="英语口语学习网 - ">英语口语学习网</a></li><li class="indent"><a href="javascript:if(confirm('http://www.dspguide.com/pdfbook.htm  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.dspguide.com/pdfbook.htm'" tppabs="http://www.dspguide.com/pdfbook.htm" target="_blank" title="DSP Guide - ">DSP Guide</a></li><li><strong>在线文档</strong></li><li class="indent"><a href="javascript:if(confirm('http://help.adobe.com/zh_CN/flex/mobileapps/index.html  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://help.adobe.com/zh_CN/flex/mobileapps/index.html'" tppabs="http://help.adobe.com/zh_CN/flex/mobileapps/index.html" target="_blank" title="Flex移动开发 - ">Flex移动开发</a></li><li class="indent"><a href="javascript:if(confirm('http://help.adobe.com/zh_CN/as3/learn/index.html  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://help.adobe.com/zh_CN/as3/learn/index.html'" tppabs="http://help.adobe.com/zh_CN/as3/learn/index.html" target="_blank" title="Flex AS3 - ">Flex AS3</a></li><li class="indent"><a href="javascript:if(confirm('http://www.adobe.com/cn/devnet.html  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.adobe.com/cn/devnet.html'" tppabs="http://www.adobe.com/cn/devnet.html" target="_blank" title="Adobe开发者中心 - ">Adobe开发者中心</a></li><li class="indent"><a href="javascript:if(confirm('http://help.adobe.com/zh_CN/FlashPlatform/reference/actionscript/3/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://help.adobe.com/zh_CN/FlashPlatform/reference/actionscript/3/'" tppabs="http://help.adobe.com/zh_CN/FlashPlatform/reference/actionscript/3/" target="_blank" title="ActionScript3.0参考 - ">ActionScript3.0参考</a></li><li class="indent"><a href="javascript:if(confirm('http://help.adobe.com/zh_CN/as3/dev/index.html  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://help.adobe.com/zh_CN/as3/dev/index.html'" tppabs="http://help.adobe.com/zh_CN/as3/dev/index.html" target="_blank" title="ActionScript 3.0 - ">ActionScript 3.0</a></li><li class="indent"><a href="javascript:if(confirm('http://help.adobe.com/zh_CN/air/build/index.html  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://help.adobe.com/zh_CN/air/build/index.html'" tppabs="http://help.adobe.com/zh_CN/air/build/index.html" target="_blank" title="AIR - ">AIR</a></li><li class="indent"><a href="javascript:if(confirm('http://www.ppurl.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.ppurl.com/'" tppabs="http://www.ppurl.com/" target="_blank" title="皮皮书屋 - ">皮皮书屋</a></li><li class="indent"><a href="javascript:if(confirm('http://science.scileaf.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://science.scileaf.com/'" tppabs="http://science.scileaf.com/" target="_blank" title="四叶科学百科 - ">四叶科学百科</a></li><li><strong>临时</strong></li><li class="indent"><a href="javascript:if(confirm('http://www.uisdc.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.uisdc.com/'" tppabs="http://www.uisdc.com/" target="_blank" title="优设 - ">优设</a></li><li class="indent"><a href="javascript:if(confirm('http://www.genesis-3d.com.cn/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.genesis-3d.com.cn/'" tppabs="http://www.genesis-3d.com.cn/" target="_blank" title="genesis-3d - ">genesis-3d</a></li><li class="indent"><a href="javascript:if(confirm('http://designlol.net/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://designlol.net/'" tppabs="http://designlol.net/" target="_blank" title="designlol - ">designlol</a></li></ul>
</div>
</div><div class="panel">
<h5 onclick='showhidediv("sidebar_misc");'>其他</h5>
<div class="panel-content" id="sidebar_misc" style="display: block">
<a href="login.php.htm" tppabs="http://i.renjihe.com/blog/login.php">登入</a><br/><a href="login.php-job=register.htm" tppabs="http://i.renjihe.com/blog/login.php?job=register">注册</a><br/>RSS： <a href="feed.php" tppabs="http://i.renjihe.com/blog/feed.php">日志</a> | <a href="feed.php-go=comment.htm" tppabs="http://i.renjihe.com/blog/feed.php?go=comment">评论</a><br/>编码：UTF-8<br/><a href="javascript:if(confirm('http://validator.w3.org/check?uri=referer  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://validator.w3.org/check?uri=referer'" tppabs="http://validator.w3.org/check?uri=referer" target="_blank">XHTML 1.0</a>
</div>
</div>
				</div>
				<div id="innerSidebarFooter">
				 Powered by <a href="javascript:if(confirm('http://www.bo-blog.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.bo-blog.com/'" tppabs="http://www.bo-blog.com/" target="_blank">Bo-Blog 2.1.1 Release</a><span id="footer-security"><a href="javascript:if(confirm('http://www.cnbct.org/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.cnbct.org/'" tppabs="http://www.cnbct.org/" target="_blank" title="Code detection by Bug.Center.Team"><img src="detect.gif" tppabs="http://i.renjihe.com/blog/images/others/detect.gif" alt="Code detection by Bug.Center.Team" border="0" /></a></span>
				<div id="processtime">
				</div>
				</div>
			</div>
		</div>
	</div>
		<div id="footer">
		</div>
	</div>
</div>
<script type="text/javascript">
loadSidebar();
</script>
<script type='text/javascript'>
//<![CDATA[
if (document.getElementById('processtime')) document.getElementById('processtime').innerHTML="<span class='runtimedisplay'>Run in 86 ms, 6 Queries.</span>";
//]]>
</script></body>
</html>