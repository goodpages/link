<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-cn">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="Content-Language" content="UTF-8" />
<meta content="all" name="robots" />
<meta name="author" content="流浪的龙－个人知识管理" />
<meta name="description" content="" />
<meta name="keywords" content="bo-blog" />
<xbasehref="http://i.renjihe.com/blog/" />
<link rel="alternate" title="流浪的龙－个人知识管理" href="feed.php" type="application/rss+xml" />
<link rel="stylesheet" rev="stylesheet" href="styles.css" tppabs="http://i.renjihe.com/blog/template/default/styles.css" type="text/css" media="all" />

<title>流浪的龙－个人知识管理 - </title>
<script type="text/javascript" src="common.js-jsver=2.1.1.3626.3" tppabs="http://i.renjihe.com/blog/images/js/common.js?jsver=2.1.1.3626.3"></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://i.renjihe.com/blog/inc/rsd.php" />
<script type="text/javascript" src="jslang.js-jsver=2.1.1.3626.3" tppabs="http://i.renjihe.com/blog/lang/zh-cn/jslang.js?jsver=2.1.1.3626.3"></script>
<script type="text/javascript" src="ajax.js-jsver=2.1.1.3626.3" tppabs="http://i.renjihe.com/blog/images/js/ajax.js?jsver=2.1.1.3626.3"></script>
<script type="text/javascript" src="swfobject.js-jsver=2.1.1.3626.3" tppabs="http://i.renjihe.com/blog/images/js/swfobject.js?jsver=2.1.1.3626.3"></script>
<script type="text/javascript">
//<![CDATA[
var moreimagepath="template/default/images";
var shutajax=0;
var absbaseurl='index.htm'/*tpa=http://i.renjihe.com/blog/*/;
//]]>
</script>
<link title="搜索 流浪的龙－个人知识管理" rel="search"  type="application/opensearchdescription+xml"  href="http://i.renjihe.com/blog/inc/opensearch.php" />



</head>
<body id="pagelocation-index">
<div id="wrapper">
	<div id="innerWrapper">
		<div id="header">
			<div id="innerHeader">
				<div id="blogLogo">
				</div>
				<div class="blog-header">
					<h1 class="blog-title"><a href="index.php.htm" tppabs="http://i.renjihe.com/blog/index.php">流浪的龙－个人知识管理</a></h1>
					<div class="blog-desc"></div>
				</div>
				<div id="menu">
					<ul>
					<li><span id="nav_index" class="activepage"><a href="index.php.htm" tppabs="http://i.renjihe.com/blog/index.php" ><span id="navitem_index" class="activepageitem">首页</span></a></span></li>
<li><span id="nav_http_3A_2F_2Fi.renjihe.com_2F"><a href="javascript:if(confirm('http://i.renjihe.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://i.renjihe.com/'" tppabs="http://i.renjihe.com/"  target="_blank"><span id="navitem_http_3A_2F_2Fi.renjihe.com_2F">个性首页</span></a></span></li>
<li><span id="nav_http_3A_2F_2Fi.renjihe.com_2Flink.html"><a href="javascript:if(confirm('http://i.renjihe.com/link.html  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://i.renjihe.com/link.html'" tppabs="http://i.renjihe.com/link.html"  target="_blank"><span id="navitem_http_3A_2F_2Fi.renjihe.com_2Flink.html">网址导航</span></a></span></li>
<li><span id="nav_tag"><a href="tag.php.htm" tppabs="http://i.renjihe.com/blog/tag.php" ><span id="navitem_tag">标签</span></a></span></li>
<li><span id="nav_guestbook"><a href="guestbook.php.htm" tppabs="http://i.renjihe.com/blog/guestbook.php" ><span id="navitem_guestbook">留言</span></a></span></li>
					</ul>
				</div>
			</div>
		</div>
		<div id="mainWrapper">
			<div id="content" class="content">
				<div id="innerContent">
					<div class="announce" style="display: none">
						<div class="announce-content">
						
						</div>
					</div>
					<div class="article-top" style="display: none">
						<div class="pages">
							<span class="pagebar-mainbody"> 分页： 8/713  <a href="index.php-mode=1&page=1.htm" tppabs="http://i.renjihe.com/blog/index.php?mode=1&page=1"><img src="doubleleft.gif" tppabs="http://i.renjihe.com/blog/template/default/images/arrows/doubleleft.gif" alt="第一页" title="第一页" border="0"/></a>  <a href="index.php-mode=1&page=7.htm" tppabs="http://i.renjihe.com/blog/index.php?mode=1&page=7"><img src="singleleft.gif" tppabs="http://i.renjihe.com/blog/template/default/images/arrows/singleleft.gif" alt="上页" title="上页" border="0"/></a> <span class="pagebar-selections"> <a href="index.php-mode=1&page=3.htm" tppabs="http://i.renjihe.com/blog/index.php?mode=1&page=3">3</a>  <a href="index.php-mode=1&page=4.htm" tppabs="http://i.renjihe.com/blog/index.php?mode=1&page=4">4</a>  <a href="index.php-mode=1&page=5.htm" tppabs="http://i.renjihe.com/blog/index.php?mode=1&page=5">5</a>  <a href="index.php-mode=1&page=6.htm" tppabs="http://i.renjihe.com/blog/index.php?mode=1&page=6">6</a>  <a href="index.php-mode=1&page=7.htm" tppabs="http://i.renjihe.com/blog/index.php?mode=1&page=7">7</a>  <span class="pagelink-current">8</span>  <a href="index.php-mode=1&page=9.htm" tppabs="http://i.renjihe.com/blog/index.php?mode=1&page=9">9</a>  <a href="index.php-mode=1&page=10.htm" tppabs="http://i.renjihe.com/blog/index.php?mode=1&page=10">10</a>  <a href="read.php-6791.htm" tppabs="http://i.renjihe.com/blog/index.php?mode=1&page=11">11</a>  <a href="read.php-6785.htm" tppabs="http://i.renjihe.com/blog/index.php?mode=1&page=12">12</a> </span> <a href="index.php-mode=1&page=9.htm" tppabs="http://i.renjihe.com/blog/index.php?mode=1&page=9"><img src="singleright.gif" tppabs="http://i.renjihe.com/blog/template/default/images/arrows/singleright.gif" alt="下页" title="下页" border="0"/></a>  <a href="index.php-mode=1&page=713.htm" tppabs="http://i.renjihe.com/blog/index.php?mode=1&page=713"><img src="doubleright.gif" tppabs="http://i.renjihe.com/blog/template/default/images/arrows/doubleright.gif" alt="最后页" title="最后页" border="0"/></a> </span> [ 显示模式： <a href="index.php-mode=1&page=1.htm" tppabs="http://i.renjihe.com/blog/index.php?mode=1&page=1" title="切换到摘要模式">摘要</a> | <a href="index.php-mode=2&page=1.htm" tppabs="http://i.renjihe.com/blog/index.php?mode=2&page=1" title="切换到列表模式">列表</a> ]
						</div>
					</div>
					<div class="textbox">
	<div class="textbox-calendar">
	<span class="textbox-calendar-month">Aug</span>
	<span class="textbox-calendar-day">31</span>
	</div>
	<div class="textbox-title">
		<h4>
		<a href="read.php-7522.htm" tppabs="http://i.renjihe.com/blog/read.php?7522">康托尔、哥德尔、图灵——永恒的金色对角线(rev#2)</a> <span id="starid7522"><img src="unstarred.gif" tppabs="http://i.renjihe.com/blog/template/default/images/others/unstarred.gif" alt="" title="未加星标" border="0"/></span> <img src="blank.gif" tppabs="http://i.renjihe.com/blog/images/weather/blank.gif" alt="不指定" title="不指定"/>
		</h4>
		<div class="textbox-label">
		<a href="view.php-go=user_1.htm" tppabs="http://i.renjihe.com/blog/view.php?go=user_1" target="_blank">renjihe1988</a> , 23:27 , <a href="index.php-go=category_2.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_2" title="查看分类： 软件">软件</a> &raquo; <a href="index.php-go=category_19.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_19" title="查看分类： 编译原理">编译原理</a> , <a href="read.php-7522.htm#reply" tppabs="http://i.renjihe.com/blog/read.php?7522#reply" title="发表您的评论">评论(0)</a> , <a href='javascript: void(0);' title="查看引用地址" onclick='showhidediv("tb7522");'>引用(0)</a> , <a href="read.php-7522.htm" tppabs="http://i.renjihe.com/blog/read.php?7522">阅读(2)</a> , Via 本站原创 
		</div>
	</div>
	<div id="tb7522" style="display: none;" class="textbox-tburl"><strong>引用功能被关闭了。</strong></div>
	
	<div class="textbox-content">
	<p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><em>我看到了它，却不敢相信它</em><sup>[1]</sup><em>。</em></p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><em>&mdash;&mdash;</em><em>康托尔</em></p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><em>计算机是数学家一次失败思考的产物。</em></p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><em>&mdash;&mdash;</em><em>无名氏</em></p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><a style="color: #313428" href="javascript:if(confirm('http://en.wikipedia.org/wiki/Kurt_Godel  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://en.wikipedia.org/wiki/Kurt_Godel'" tppabs="http://en.wikipedia.org/wiki/Kurt_Godel">哥德尔</a>的<a style="color: #313428" href="javascript:if(confirm('http://www.answers.com/topic/g-del-s-incompleteness-theorems  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.answers.com/topic/g-del-s-incompleteness-theorems'" tppabs="http://www.answers.com/topic/g-del-s-incompleteness-theorems">不完备性定理</a>震撼了20世纪数学界的天空，其数学意义颠覆了<a style="color: #313428" href="javascript:if(confirm('http://en.wikipedia.org/wiki/David_Hilbert  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://en.wikipedia.org/wiki/David_Hilbert'" tppabs="http://en.wikipedia.org/wiki/David_Hilbert">希尔伯特</a>的形式化数学的宏伟计划，其哲学意义直到21世纪的今天仍然不断被延伸到各个自然学科，深刻影响着人们的思维。<a style="color: #313428" href="javascript:if(confirm('http://www.alanturing.net/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.alanturing.net/'" tppabs="http://www.alanturing.net/">图灵</a>为了解决希尔伯特著名的<a style="color: #313428" href="javascript:if(confirm('http://en.wikipedia.org/wiki/Hilbert\'s_tenth_problem  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://en.wikipedia.org/wiki/Hilbert\'s_tenth_problem'" tppabs="http://en.wikipedia.org/wiki/Hilbert's_tenth_problem">第十问题</a>而提出有效计算模型，进而作出了<a style="color: #313428" href="javascript:if(confirm('http://en.wikipedia.org/wiki/Computability_theory_(computation)  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://en.wikipedia.org/wiki/Computability_theory_(computation)'" tppabs="http://en.wikipedia.org/wiki/Computability_theory_(computation)">可计算理论</a>和现代计算机的奠基性工作，著名的停机问题给出了机械计算模型的能力极限，其深刻的意义和漂亮的证明使它成为可计算理论中的标志性定理之一。<a style="color: #313428" href="javascript:if(confirm('http://en.wikipedia.org/wiki/Alonzo_Church  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://en.wikipedia.org/wiki/Alonzo_Church'" tppabs="http://en.wikipedia.org/wiki/Alonzo_Church">丘齐</a>，跟图灵同时代的天才，则从另一个抽象角度提出了<a style="color: #313428" href="javascript:if(confirm('http://en.wikipedia.org/wiki/Lambda_calculus  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://en.wikipedia.org/wiki/Lambda_calculus'" tppabs="http://en.wikipedia.org/wiki/Lambda_calculus">lambda算子</a>的思想，与<a style="color: #313428" href="javascript:if(confirm('http://en.wikipedia.org/wiki/Turing_machine  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://en.wikipedia.org/wiki/Turing_machine'" tppabs="http://en.wikipedia.org/wiki/Turing_machine">图灵机</a>抽象的倾向于硬件性不同，丘齐的lambda算子理论是从数学的角度进行抽象，不关心运算的机械过程而只关心运算的抽象性质，只用最简洁的几条公理便建立起了与图灵机<a style="color: #313428" href="javascript:if(confirm('http://en.wikipedia.org/wiki/Turing_machine  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://en.wikipedia.org/wiki/Turing_machine#Models_equivalent_to_the_Turing_machine_model'" tppabs="http://en.wikipedia.org/wiki/Turing_machine#Models_equivalent_to_the_Turing_machine_model">完全等价</a>的计算模型，其体现出来的数学抽象美开出了<a style="color: #313428" href="javascript:if(confirm('http://en.wikipedia.org/wiki/Functional_programming  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://en.wikipedia.org/wiki/Functional_programming'" tppabs="http://en.wikipedia.org/wiki/Functional_programming">函数式编程语言</a>这朵奇葩，<a style="color: #313428" href="javascript:if(confirm('http://en.wikipedia.org/wiki/Lisp_programming_language  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://en.wikipedia.org/wiki/Lisp_programming_language'" tppabs="http://en.wikipedia.org/wiki/Lisp_programming_language">Lisp</a>、<a style="color: #313428" href="javascript:if(confirm('http://en.wikipedia.org/wiki/Scheme_(programming_language)  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://en.wikipedia.org/wiki/Scheme_(programming_language)'" tppabs="http://en.wikipedia.org/wiki/Scheme_(programming_language)">Scheme</a>、<a style="color: #313428" href="javascript:if(confirm('http://www.haskell.org/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.haskell.org/'" tppabs="http://www.haskell.org/">Haskell</a>&hellip; 这些以抽象性和简洁美为特点的语言至今仍然活跃在计算机科学界，虽然由于其本质上源于lambda算子理论的抽象方式不符合人的思维习惯从而注定无法成为主流的编程语言<sup>[2]</sup>，然而这仍然无法妨碍它们成为编程理论乃至计算机学科的最佳教本。而诞生于函数式编程语言的神奇的<a style="color: #313428" href="javascript:if(confirm('http://en.wikipedia.org/wiki/Y_combinator  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://en.wikipedia.org/wiki/Y_combinator'" tppabs="http://en.wikipedia.org/wiki/Y_combinator">Y combinator</a>至今仍然让人们陷入深沉的震撼和反思当中&hellip;</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">然而，这一切的一切，看似不很相关却又有点相关，认真思考其关系却又有点一头雾水的背后，其实隐隐藏着一条线，这条线把它们从本质上串到了一起，而顺着时光的河流逆流而上，我们将会看到，这条线的尽头，不是别人，正是只手拨开被不严密性问题困扰的19世纪数学界阴沉天空的天才数学家<a style="color: #313428" href="javascript:if(confirm('http://en.wikipedia.org/wiki/Georg_Cantor  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://en.wikipedia.org/wiki/Georg_Cantor'" tppabs="http://en.wikipedia.org/wiki/Georg_Cantor">康托尔</a>，康托尔创造性地将一一对应和对角线方法运用到无穷集合理论的建立当中，这个被希尔伯特称为&ldquo;谁也无法将我们从康托尔为我们创造的乐园中驱逐出去&rdquo;、被罗素称为&ldquo;19世纪最伟大的智者之一&rdquo;的人，他在<a style="color: #313428" href="javascript:if(confirm('http://www.amazon.com/Contributions-Founding-Theory-Transfinite-Numbers/dp/0875481574/ref=sr_1_4/103-3576835-0834231?ie=UTF8&s=books&qid=1177237889&sr=8-4  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.amazon.com/Contributions-Founding-Theory-Transfinite-Numbers/dp/0875481574/ref=sr_1_4/103-3576835-0834231?ie=UTF8&s=books&qid=1177237889&sr=8-4'" tppabs="http://www.amazon.com/Contributions-Founding-Theory-Transfinite-Numbers/dp/0875481574/ref=sr_1_4/103-3576835-0834231?ie=UTF8&s=books&qid=1177237889&sr=8-4">集合论方面的工作</a>终于驱散了不严密性问题带来的阴霾，仿佛一道金色的阳光刺破乌云，19世纪的数学终于看到了真正严格化的曙光，数学终于得以站在了前所未有的坚固的基础之上；集合论至今仍是数学里最基础和最重要的理论之一。而康托尔当初在研究无穷集合时最具天才的方法之一&mdash;&mdash;对角线方法&mdash;&mdash;则带来了极其深远的影响，其纯粹而直指事物本质的思想如洪钟大吕般响彻数学和哲学的每一个角落<sup>[3]</sup>。随着本文的展开，你将会看到，刚才提到的一切，歌德尔的不完备性定理，图灵的停机问题，lambda算子理论中神奇的Y combinator、乃至著名的罗素悖论、理发师悖论等等，其实都源自这个简洁、纯粹而同时又是最优美的数学方法，反过来说，从康托尔的对角线方法出发，我们可以轻而易举地推导出哥德尔的不完备性定理，而由后者又可以轻易导出停机问题和Y combinator，实际上，我们将会看到，后两者也可以直接由康托尔的对角线方法导出。尤其是Y combinator，这个形式上绕来绕去，本质上捉摸不透，看上去神秘莫测的算子，其实只是一个非常自然而然的推论，如果从哥德尔的不完备性定理出发，它甚至比停机问题还要来得直接简单。总之，你将会看到这些看似深奥的理论是如何由一个至为简单而又至为深刻的数学方法得出的，你将会看到最纯粹的数学美。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><strong>图灵的停机问题</strong><strong>(The Halting Problem)</strong></p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><em>了解停机问题的可以直接跳过这一节，到下一节&ldquo;Y Combinator&rdquo;，了解后者的再跳到下一节&ldquo;哥德尔的不完备性定理&rdquo;</em></p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">我们还是从图灵著名的停机问题说起，一来它相对来说是我们要说的几个定理当中最简单的，二来它也最贴近程序员。实际上，我以前曾写过<a style="color: #313428" href="javascript:if(confirm('http://blog.csdn.net/pongba/archive/2006/03/11/621723.aspx  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://blog.csdn.net/pongba/archive/2006/03/11/621723.aspx'" tppabs="http://blog.csdn.net/pongba/archive/2006/03/11/621723.aspx">一篇关于图灵机的文章</a>，有兴趣的读者可以从那篇开始，那篇主要是从理论上阐述，所以这里我们打算避开抽象的理论，换一种符合程序员思维习惯的直观方式来加以解释。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><strong>停机问题</strong></p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><em>不存在这样一个程序（算法），它能够计算任何程序（算法）在给定输入上是否会结束（停机）。</em></p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">那么，如何来证明这个停机问题呢？反证。假设我们某一天真做出了这么一个极度聪明的万能算法（就叫God_algo吧），你只要给它一段程序（二进制描述），再给它这段程序的输入，它就能告诉你这段程序在这个输入上会不会结束（停机），我们来编写一下我们的这个算法吧：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">bool God_algo(char* program, char* input)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">&#123;</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">if(<em>&lt;program</em>&gt;&nbsp;<em>halts on&nbsp;</em>&lt;<em>input</em>&gt;)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">return true;</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">return false;</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">&#125;</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">这里我们假设if的判断语句里面是你天才思考的结晶，它能够像上帝一样洞察一切程序的宿命。现在，我们从这个God_algo出发导出一个新的算法：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">bool Satan_algo(char* program)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">&#123;</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">if(&nbsp;<em>God_algo</em>(program, program) )&#123;</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">while(1); // loop forever!</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">return false; // can never get here!</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">&#125;</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">else</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">return true;</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">&#125;</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">正如它的名字所暗示的那样，这个算法便是一切邪恶的根源了。当我们把这个算法运用到它自身身上时，会发生什么呢？</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">Satan_algo(Satan_algo);</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">我们来分析一下这行简单的调用：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">显然，Satan_algo(Satan_algo)这个调用要么能够运行结束返回（停机），要么不能返回（loop forever）。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><em>如果它能够结束</em>，那么Santa_algo算法里面的那个if判断就会成立（因为God_algo(Santa_algo,Santa_algo)将会返回true），从而程序便进入那个包含一个无穷循环while(1);的if分支，于是这个Satan_algo(Satan_algo)调用<em>便永远不会返回（结束）了</em>。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">而<em>如果</em><em>Satan_algo(Satan_algo)</em><em>不能结束（停机）呢</em>，则if判断就会失败，从而选择另一个if分支并返回true，即<em>Satan_algo(Satan_algo)</em><em>又</em><em>能够返回（停机）</em>。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">总之，我们有：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><em>Satan_algo(Satan_algo)</em><em>能够停机</em><em>&nbsp;</em><em>=&gt;&nbsp;</em><em>它不能停机</em></p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><em>Satan_algo(Satan_algo)</em><em>不能停机</em><em>&nbsp;</em><em>=&gt;&nbsp;</em><em>它能够停机</em></p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">所以它停也不是，不停也不是。左右矛盾。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">于是，我们的假设，即God_algo算法的存在性，便不成立了。正如<a style="color: #313428" href="javascript:if(confirm('http://en.wikipedia.org/wiki/Joseph_Louis_Lagrange  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://en.wikipedia.org/wiki/Joseph_Louis_Lagrange'" tppabs="http://en.wikipedia.org/wiki/Joseph_Louis_Lagrange">拉格朗日</a>所说：&ldquo;陛下，我们不需要（上帝）这个假设&rdquo;<sup>[4]</sup>。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">这个证明相信每个程序员都能够容易的看懂。然而，这个看似不可捉摸的技巧背后其实隐藏着深刻的数学原理（甚至是哲学原理）。在没有认识到这一数学原理之前，至少我当时是对于图灵如何想出这一绝妙证明感到无法理解。但后面，在介绍完了与图灵的停机问题&ldquo;同构&rdquo;的Y combinator之后，我们会深入哥德尔的不完备性定理，在理解了哥德尔不完备性定理之后，我们从这一同样绝妙的定理出发，就会突然发现，离停机问题和神奇的Y combinator只是咫尺之遥而已。当然，最后我们会回溯到一切的尽头，康托尔那里，看看停机问题、Y combinator、以及不完备性定理是如何自然而然地由康托尔的对角线方法推导出来的，我们将会看到这些看似神奇的构造性证明的背后，其实是一个简洁优美的数学方法在起作用。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><strong>Y Combinator</strong></p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><em>了解</em><em>Y combinator</em><em>的请直接跳过这一节，到下一节</em><em>&ldquo;</em><em>哥德尔的不完备性定理</em><em>&rdquo;</em><em>。</em></p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">让我们暂且搁下但记住绕人的图灵停机问题，走进函数式编程语言的世界，走进由跟图灵机理论等价的lambda算子发展出来的另一个平行的语言世界。让我们来看一看被人们一代一代吟唱着的神奇的Y Combinator&hellip;</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">关于Y Combinator的文章可谓数不胜数，这个由师从希尔伯特的著名逻辑学家<a style="color: #313428" href="javascript:if(confirm('http://en.wikipedia.org/wiki/Haskell_Curry  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://en.wikipedia.org/wiki/Haskell_Curry'" tppabs="http://en.wikipedia.org/wiki/Haskell_Curry">Haskell B.Curry</a>（Haskell语言就是以他命名的，而函数式编程语言里面的Curry手法也是以他命名）&ldquo;发明&rdquo;出来的组合算子（Haskell是研究<a style="color: #313428" href="javascript:if(confirm('http://en.wikipedia.org/wiki/Combinatory_logic  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://en.wikipedia.org/wiki/Combinatory_logic'" tppabs="http://en.wikipedia.org/wiki/Combinatory_logic">组合逻辑(combinatory logic)</a>的）仿佛有种神奇的魔力，它能够算出给定lambda表达式（函数）的<a style="color: #313428" href="javascript:if(confirm('http://en.wikipedia.org/wiki/Fixed_point  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://en.wikipedia.org/wiki/Fixed_point'" tppabs="http://en.wikipedia.org/wiki/Fixed_point">不动点</a>。从而使得递归成为可能。事实上，我们待会就会看到，Y Combinator在神奇的表面之下，其实隐藏着深刻的意义，其背后体现的意义，曾经开出过历史上最灿烂的数学之花，所以MIT的计算机科学系将它做成系徽也就不足为奇了<sup>[5]</sup>。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">当然，要了解这个神奇的算子，我们需要一点点lambda算子理论的基础知识，不过别担心，lambda算子理论是我目前见过的最简洁的公理系统，这个系统仅仅由三条非常简单的公理构成，而这三条公理里面我们又只需要关注前两条。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><em>以下小节</em><em>&mdash;&mdash;lambda calculus&mdash;&mdash;</em><em>纯粹是为了没有接触过</em><em>lambda</em><em>算子理论的读者准备的，并不属于本文重点讨论的东西，然而要讨论</em><em>Y combinator</em><em>就必须先了解一下</em><em>lambda</em><em>（当然，以编程语言来了解也行，但是你会看到，丘齐最初提出的</em><em>lambda</em><em>算子理论才是最最简洁和漂亮的，学起来也最省事。）所以我单独准备了一个小节来介绍它。如果你已经知道，可以跳过这一小节。不知道的读者也可以跳过这一小节去</em><em>wikipedia</em><em>上面看，这里的介绍使用了</em><em>wikipedia</em><em>上的方式</em></p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><strong>lambda calculus</strong></p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">先来看一下lambda表达式的基本语法(BNF)：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">&lt;expr&gt; ::= &lt;identifier&gt;</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">&lt;expr&gt; ::=&nbsp;<em>lambda</em>&nbsp;&lt;identifier-list&gt;. &lt;expr&gt;</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">&lt;expr&gt; ::= (&lt;expr&gt; &lt;expr&gt;)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">前两条语法用于生成lambda表达式（lambda函数），如：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><em>lambda</em>&nbsp;x y. x + y</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><em>haskell</em><em>里面为了简洁起见用</em><em>&ldquo;&#92;&rdquo;</em><em>来代替希腊字母</em><em>lambda</em><em>，它们形状比较相似。故而上面的定义也可以写成：</em></p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><em>&#92; x y. x + y</em></p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">这是一个匿名的加法函数，它接受两个参数，返回两值相加的结果。当然，这里我们为了方便起见赋予了lambda函数直观的计算意义，而实际上lambda calculus里面一切都只不过是文本替换，有点像C语言的宏。并且这里的&ldquo;+&rdquo;我们假设已经是一个具有原子语义的运算符<sup>[6]</sup>，此外，为了方便我们使用了中缀表达（按照lambda calculus系统的语法实际上应该写成&ldquo;(+ x y)&rdquo;才对&mdash;&mdash;参考第三条语法）。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">那么，函数定义出来了，怎么使用呢？最后一条规则就是用来调用一个lambda函数的：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">((<em>lambda</em>&nbsp;x y. x + y) 2 3)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">以上这一行就是把刚才定义的加法函数运用到2和3上（这个调用语法形式跟<a style="color: #313428" href="javascript:if(confirm('http://en.wikipedia.org/wiki/Imperative_programming  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://en.wikipedia.org/wiki/Imperative_programming'" tppabs="http://en.wikipedia.org/wiki/Imperative_programming">命令式语言(imperative language)</a>惯用的调用形式有点区别，后者是&ldquo;f(x, y)&rdquo;，而这里是&ldquo;(f x y)&rdquo;，不过好在顺序没变:) ）。为了表达简洁一点，我们可以给(<em>lambda</em>&nbsp;x y. x + y)起一个名字，像这样：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">let Add = (<em>lambda</em>&nbsp;x y. x + y)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">这样我们便可以使用Add来表示该lambda函数了：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">(Add 2 3)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">不过还是为了方便起见，后面调用的时候一般用&ldquo;Add(2, 3)&rdquo;，即我们熟悉的形式。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">有了语法规则之后，我们便可以看一看这个语言系统的两条简单至极的公理了：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><em>Alpha</em><em>转换公理</em>：例如，&ldquo;lambda x y. x + y&rdquo;转换为&ldquo;lambda a b. a + b&rdquo;。换句话说，函数的参数起什么名字没有关系，可以随意替换，只要函数体里面对参数的使用的地方也同时注意相应替换掉就是了。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><em>Beta</em><em>转换公理</em>：例如，&ldquo;(lambda x y. x + y) 2 3&rdquo;转换为&ldquo;2 + 3&rdquo;。这个就更简单了，也就是说，当把一个lambda函数用到参数身上时，只需用实际的参数来替换掉其函数体中的相应变量即可。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">就这些。是不是感觉有点太简单了？但事实就是如此，lambda算子系统从根本上其实就这些东西，然而你却能够从这几个简单的规则中推演出神奇无比的Y combinator来。我们这就开始！</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><strong>递归的迷思</strong></p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">敏锐的你可能会发现，就以上这两条公理，我们的lambda语言中无法表示递归函数，为什么呢？假设我们要计算经典的阶乘，递归描述肯定像这样：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">f(n):</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">if n == 0 return 1</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">return n*f(n-1)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">当然，上面这个程序是假定n为正整数。这个程序显示了一个特点，f在定义的过程中用到了它自身。那么如何在lambda算子系统中表达这一函数呢？理所当然的想法如下：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><em>lambda</em>&nbsp;n. If_Else n==0 1 n*&lt;<em>self</em>&gt;(n-1)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">当然，上面的程序假定了If_Else是一个已经定义好的三元操作符（你可以想象C的&ldquo;?:&rdquo;操作符，后面跟的三个参数分别是判断条件、成功后求值的表达式、失败后求值的表达式。那么很显然，这个定义里面有一个地方没法解决，那就是&lt;<em>self</em>&gt;那个地方我们应该填入什么呢？很显然，熟悉C这类命令式语言的人都知道应该填入这个函数本身的名字，然而lambda算子系统里面的lambda表达式（或称函数）是没有名字的。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">怎么办？难道就没有办法实现递归了？或者说，丘齐做出的这个lambda算子系统里面根本没法实现递归从而在计算能力上面有重大的缺陷？显然不是。马上你就会看到Y combinator是如何把一个看上去非递归的lambda表达式像变魔术那样变成一个递归版本的。在成功之前我们再失败一次，注意下面的尝试：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">let F =&nbsp;<em>lambda</em>&nbsp;n. IF_Else n==0 1 n*F(n-1)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">看上去不错，是吗？可惜还是不行。因为let F只是起到一个<a style="color: #313428" href="javascript:if(confirm('http://en.wikipedia.org/wiki/Syntactic_sugar  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://en.wikipedia.org/wiki/Syntactic_sugar'" tppabs="http://en.wikipedia.org/wiki/Syntactic_sugar">语法糖</a>的作用，在它所代表的lambda表达式还没有完全定义出来之前你是不可以使用F这个名字的。更何况实际上丘齐当初的lambda算子系统里面也并没有这个语法元素，这只是刚才为了简化代码而引入的语法糖。当然，了解这个let语句还是有意义的，后面还会用到。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><strong>一次成功的尝试</strong></p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">在上面几次失败的尝试之后，我们是不是就一筹莫展了呢？别忘了软件工程里面的一条黄金定律：&ldquo;任何问题都可以通过增加一个间接层来解决&rdquo;。不妨把它沿用到我们面临的递归问题上：没错，我们的确没办法在一个lambda函数的定义里面直接（按名字）来调用其自身。但是，可不可以间接调用呢？</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">我们回顾一下刚才不成功的定义：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><em>lambda</em>&nbsp;n. If_Else n==0 1 n*&lt;<em>self</em>&gt;(n-1)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">现在&lt;self&gt;处不是缺少&ldquo;这个函数自身&rdquo;嘛，既然不能直接填入&ldquo;这个函数自身&rdquo;，我们可以增加一个参数，也就是说，把&lt;self&gt;参数化：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><em>lambda</em>&nbsp;<strong>self</strong>&nbsp;n. If_Else n==0 1 n*<strong>self</strong>(n-1)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">上面这个lambda算子总是合法定义了吧。现在，我们调用这个函数的时候，只要加传一个参数self，这个参数不是别人，正是这个函数自身。还是为了简单起见，我们用let语句来给上面这个函数起个别名：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">let P =&nbsp;<em>lambda</em>&nbsp;self n. If_Else n==0 1 n*self(n-1)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">我们这样调用，比如说我们要计算3的阶乘：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><strong>P</strong>(<strong>P</strong>, 3)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">也就是说，把P自己作为P的第一个参数（注意，调用的时候P已经定义完毕了，所以我们当然可以使用它的名字了）。这样一来，P里面的self处不就等于是P本身了吗？自身调用自身，递归！</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">可惜这只是个美好的设想，还差一点点。我们分析一下P(P, 3)这个调用。利用前面讲的Beta转换规则，这个函数调用展开其实就是（你可以完全把P当成一个宏来进行展开！）：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">IF_Else n==0 1 n*<strong>P</strong>(n-1)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">看出问题了吗？这里的<strong>P</strong>(n-1)虽然调用到了P，然而只给出了一个参数；而从P的定义来看，它是需要两个参数的（分别为<strong>self</strong>和n）！也就是说，为了让<strong>P</strong>(n-1)变成良好的调用，我们得加一个参数才行，所以我们得稍微修改一下P的定义：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">let P =&nbsp;<em>lambda</em>&nbsp;<strong>self</strong>&nbsp;n. If_Else n==0 1 n*<strong>self</strong>(<strong>self</strong>, n-1)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">请注意，我们在P的函数体内调用self的时候增加了一个参数。现在当我们调用P(P, 3)的时候，展开就变成了：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">IF_Else 3==0 1 3*<strong>P</strong>(<strong>P</strong>, 3-1)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">而<strong>P</strong>(<strong>P</strong>, 3-1)是对P合法的递归调用。这次我们真的成功了！</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><strong>不动点原理</strong></p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">然而，看看我们的P的定义，是不是很丑陋？&ldquo;n*<strong>self</strong>(<strong>self</strong>, n-1)&rdquo;？什么玩意？为什么要多出一个多余的self？<a style="color: #313428" href="javascript:if(confirm('http://en.wikipedia.org/wiki/Don\'t_repeat_yourself  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://en.wikipedia.org/wiki/Don\'t_repeat_yourself'" tppabs="http://en.wikipedia.org/wiki/Don't_repeat_yourself">DRY</a>！怎么办呢？我们想起我们一开始定义的那个失败的P，虽然行不通，但最初的努力往往是大脑最先想到的最直观的做法，我们来回顾一下：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">let P =&nbsp;<em>lambda</em>&nbsp;self n. If_Else n==0 1 n*<strong>self</strong>(n-1)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">这个P的函数体就非常清晰，没有冗余成分，虽然参数列表里面多出一个self，但我们其实根本不用管它，看函数体就行了，self这个名字已经可以说明一切了对不对？但很可惜这个函数不能用。我们再来回想一下为什么不能用呢？因为当你调用P(P, n)的时候，里面的self(n-1)会展开为P(n-1)而P是需要两个参数的。唉，要是这里的self是一个&ldquo;真正&rdquo;的，只需要一个参数的递归阶乘函数，那该多好啊。为什么不呢？干脆我们假设出一个&ldquo;真正&rdquo;的递归阶乘函数：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">power(n):</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">if(n==0) return 1;</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">return n*power(n-1);</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">但是，前面不是说过了，这个理想的版本无法在lambda算子系统中定义出来吗（由于lambda函数都是没名字的，无法自己内部调用自己）？不急，我们并不需要它被定义出来，我们只需要在头脑中&ldquo;假设&rdquo;它以&ldquo;某种&rdquo;方式被定义出来了，现在我们把这个真正完美的power传给P，这样：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">P(<strong>power</strong>, 3)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">注意它跟P(P, 3)的不同，P(P, 3)我们传递的是一个有缺陷的P为参数。而P(power, 3)我们则是传递的一个真正的递归函数power。我们试着展开P(power, 3):</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">IF_Else 3==0 1 3*<strong>power</strong>(3-1)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">发生了什么？？power(3-1)将会计算出2的阶乘（别忘了，power是我们设想的完美递归函数），所以这个式子将会忠实地计算出3的阶乘！</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">回想一下我们是怎么完成这项任务的：我们设想了一个以某种方式构造出来的完美的能够内部自己调用自己的递归阶乘函数power，我们发现把这个power传给P的话，P(power, n)的展开式就是真正的递归计算n阶乘的代码了。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">你可能要说：废话！都有了power了我们还要费那事把它传给P来个P(power, n)干嘛？直接power(n)不就得了？! 别急，之所以设想出这个power只是为了引入不动点的概念，而不动点的概念将会带领我们发现Y combinator。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">什么是不动点？一点都不神秘。让我们考虑刚才的power与P之间的关系。一个是真正可递归的函数，一个呢，则是以一个额外的self参数来试图实现递归的伪递归函数，我们已经看到了把power交给P为参数发生了什么，对吧？不，似乎还没有，我们只是看到了，&ldquo;把power加上一个n一起交给P为参数&rdquo;能够实现真正的递归。现在我们想考虑power跟P之间的关系，直接把power交给P如何？</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">P(power)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">这是什么？这叫函数的<a style="color: #313428" href="javascript:if(confirm('http://en.wikipedia.org/wiki/Partial_evaluation  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://en.wikipedia.org/wiki/Partial_evaluation'" tppabs="http://en.wikipedia.org/wiki/Partial_evaluation"><em>部分求值</em>(<em>partial evaluation</em>)</a>。换句话说，第一个参数是给出来了，但第二个参数还悬在那里，等待给出。那么，光给一个参数得到的是什么呢？是&ldquo;还剩一个参数待给的一个新的函数&rdquo;。其实也很简单，只要按照Beta转换规则做就是了，把P的函数体里面的self出现处皆替换为power就可以了。我们得到：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">IF_Else n==0 1 n*power(n-1)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">当然，这个式子里面还有一个变量没有绑定，那就是n，所以这个式子还不能求值，你需要给它一个n才能具体求值，对吧。这么说，这可不就是一个以n为参数的函数么？实际上就是的。在lambda算子系统里面，如果给一个lambda函数的参数不足，则得到的就是一个新的lambda函数，这个新的lambda函数所接受的参数也就是你尚未给出的那些参数。换句话来说，调用一个lambda函数可以分若干步来进行，每次只给出一部分参数，而只有等所有参数都给齐了，函数的求值结果才能出来，否则你得到的就是一个&ldquo;中间函数&rdquo;。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">那么，这跟不动点定理有什么关系？关系大了，刚才不是说了，P(power)返回的是一个新的&ldquo;中间函数&rdquo;嘛？这个&ldquo;中间函数&rdquo;的函数体我们刚才已经看到了，就是简单地展开P(power)而已，回顾一遍：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">IF_Else n==0 1 n*power(n-1)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">我们已经知道，这是个函数，参数n待定。因此我们不妨给它加上一个&ldquo;lambda n&rdquo;的帽子，这样好看一点：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><em>lambda</em>&nbsp;n. IF_Else n==0 1 n*power(n-1)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">这是什么呢？这可不就是power本身的定义？（当然，如果我们能够定义power的话）。不信我们看看power如果能够定义出来像什么样子：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">let power =&nbsp;<em>lambda</em>&nbsp;n. IF_Else n==0 1 n*power(n-1)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">一模一样！也就是说，P(power)展开后跟power是一样的。即：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><strong>P(power) = power</strong></p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">以上就是所谓的<em>不动点</em>。即对于函数P来说power是这样一个&ldquo;点&rdquo;：当把P用到power身上的时候，得到的结果仍然还是power，也就是说，power这个&ldquo;点&rdquo;在P的作用下是&ldquo;不动&rdquo;的。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">可惜的是，这一切居然都是建立在一个不存在的power的基础上的，又有什么用呢？可别过早提&ldquo;不存在&rdquo;这个词，你觉得一样东西不存在或许只是你没有找到使它存在的正确方法。我们已经看到power是跟P有着密切联系的。密切到什么程度呢？对于伪递归的P，存在一个power，满足P(power)=power。注意，这里所说的&ldquo;伪递归&rdquo;的P，是指这样的形式：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">let P =&nbsp;<em>lambda</em>&nbsp;self n. If_Else n==0 1 n*<strong>self</strong>(n-1) // 注意，不是self(self,n-1)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">一般化的描述就是，对任一伪递归F（回想一下伪递归的F如何得到&mdash;&mdash;是我们为了解决lambda函数不能引用自身的问题，于是给理想的f加一个self参数从而得到的），必存在一个理想f（F就是从这个理想f演变而来的），满足F(f) = f。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">那么，现在的问题就归结为如何针对F找到它的f了。根据F和f之间的密切联系（F就比f多出一个self参数而已），我们可以从F得出f吗？假设我们可以（又是假设），也就是说假设我们找到了一根魔棒，把它朝任意一个伪递归的F一挥，眼前一花，它就变成了真正的f了。这根魔棒如果存在的话，它具有什么性质？我们假设这个神奇的函数叫做Y，把Y用到任何伪递归的函数F上就能够得到真正的f，也就是说：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">Y(F) = f</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">结合上面的F(f) = f，我们得到：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">Y(F) = f = F(f) = F(Y(F))</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">也就是说，Y具有性质：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><strong>Y(F) = F(Y(F))</strong></p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">性质倒是找出来了，怎么构造出这个Y却又成了难题。一个办法就是使用抽象法，这是从工程学的思想的角度，也就是通过不断迭代、重构，最终找到问题的解。然而对于这里的Y combinator，接近问题解的过程却显得复杂而费力，甚至过程中的有些点上的思维跳跃有点如羚羊挂角无迹可寻。然而，在这整个Y combinator介绍完了之后我们将会介绍著名的哥德尔不完备性定理，然后我们就会发现，通过哥德尔不完备性定理证明中的一个核心构造式，只需一步自然的推导就能得出我们的Y combinator。而且，最美妙的是，还可以再往下归约，把一切都归约到康托尔当初提出的对角线方法，到那时我们就会发现原来同样如羚羊挂角般的哥德尔的证明其实是对角线方法的一个自然推论。数学竟是如此奇妙，我们由简单得无法再简单的lambda calculus系统的两条公理居然能够导出如此复杂如此令人目眩神迷的Y Combinator，而这些复杂性其实也只是荡漾在定理海洋中的涟漪，拨开复杂性的迷雾我们重又发现它们居然寓于极度的简洁之中。这就是数学之美。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">让我们先来看一看Y combinator的费力而复杂的工程学构造法，我会尽量让这个过程显得自然而流畅<sup>[7]</sup>：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">我们再次回顾一下那个伪递归的求阶乘函数：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">let P =&nbsp;<em>lambda</em>&nbsp;self n. If_Else n==0 1 n*<strong>self</strong>(n-1)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">我们的目标是找出P的不动点power，根据不动点的性质，只要把power传给P，即P(power)，便能够得到真正的递归函数了。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">现在，关键的地方到了，由于：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">power = P(power) // 不动点原理</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">这就意味着，power作为一个函数（lambda calculus里面一切都是函数），它是自己调用了自己的。那么，我们如何实现这样一个能够自己调用自己的power呢？回顾我们当初成功的一次尝试，要实现递归，我们是通过增加一个间接层来进行的：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">let power_gen =&nbsp;<em>lambda</em>&nbsp;self. P(<strong>self</strong>(<strong>self</strong>))</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">还记得<strong>self</strong>(<strong>self</strong>)这个形式吗？我们在成功实现出求阶乘递归函数的时候不就是这么做的？那么对于现在这个power_gen，怎么递归调用？</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">power_gen(power_gen)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">不明白的话可以回顾一下前面我们调用P(P, n)的地方。这里power_gen(power_gen)展开后得到的是什么呢？我们根据刚才power_gen的定义展开看一看，原来是：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><strong>P</strong>(power_gen(power_gen))</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">看到了吗？也就是说：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">power_gen(power_gen) =&gt;&nbsp;<strong>P</strong>(power_gen(power_gen))</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"></p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">现在，我们把power_gen(power_gen)当成整体看，不妨令为power，就看得更清楚了：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">power =&gt;&nbsp;<strong>P</strong>(power)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">这不正是我们要的答案么？</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">OK，我们<em>总结一下</em>：对于给定的P，只要构造出一个相应的power_gen如下：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">let power_gen =&nbsp;<em>lambda</em>&nbsp;self. P(<strong>self</strong>(<strong>self</strong>))</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">我们就会发现，power_gen(power_gen)这个调用展开后正是P(power_gen(power_gen))。也就是说，我们的power_gen(power_gen)就是我们苦苦寻找的不动点了！</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><strong>铸造</strong><strong>Y Combinator</strong></p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">现在我们终于可以铸造我们的Y Combinator了，Y Combinator只要生成一个形如power_gen的lambda函数然后把它应用到自身，就大功告成：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">let&nbsp;<strong>Y</strong>&nbsp;=&nbsp;<em>lambda</em>&nbsp;F.</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">let&nbsp;<strong><em>f_gen</em></strong>&nbsp;=&nbsp;<em>lambda</em>&nbsp;self. F(<strong>self</strong>(<strong>self</strong>))</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">return&nbsp;<strong>f_gen</strong>(<strong>f_gen</strong>)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">稍微解释一下，Y是一个lambda函数，它接受一个伪递归F，在内部生成一个f_gen（还记得我们刚才看到的power_gen吧），然后把f_gen应用到它自身（记得power_gen(power_gen)吧），得到的这个f_gen(f_gen)也就是F的不动点了（因为f_gen(f_gen) = F(f_gen(f_gen))），而根据不动点的性质，F的不动点也就是那个对应于F的真正的递归函数！</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">如果你还觉得不相信，我们稍微展开一下看看，还是拿阶乘函数说事，首先我们定义阶乘函数的伪递归版本：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">let Pwr =&nbsp;<em>lambda</em>&nbsp;self n. If_Else n==0 1 n*self(n-1)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">让我们把这个Pwr交给<strong>Y</strong>，看会发生什么（根据刚才Y的定义展开吧）：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">Y(Pwr) =&gt;</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">let f_gen =&nbsp;<em>lambda</em>&nbsp;self.&nbsp;<strong>Pwr</strong>(self(self))</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">return f_gen(f_gen)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">Y(Pwr)的求值结果就是里面返回的那个f_gen(f_gen)，我们再根据f_gen的定义展开f_gen(f_gen)，得到：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">Pwr(f_gen(f_gen))</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">也就是说：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">Y(Pwr) =&gt; f_gen(f_gen) =&gt; Pwr(f_gen(f_gen))</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">我们来看看得到的这个Pwr(f_gen(f_gen))到底是不是真有递归的魔力。我们展开它（注意，因为Pwr需要两个参数，而我们这里只给出了一个，所以Pwr(f_gen(f_gen))得到的是一个单参（即n）的函数）：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">Pwr(<strong>f_gen</strong>(<strong>f_gen</strong>)) =&gt; If_Else n==0 1 n*<strong>f_gen</strong>(<strong>f_gen</strong>) (n-1)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">而里面的那个<strong>f_gen</strong>(<strong>f_gen</strong>)，根据f_gen的定义，又会展开为Pwr(f_gen(f_gen))，所以：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><strong>Pwr(f_gen(f_gen))</strong>&nbsp;=&gt; If_Else n==0 1 n*&nbsp;<strong>Pwr(f_gen(f_gen))</strong>&nbsp;(n-1)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">看到加粗的部分了吗？因为<strong>Pwr(f_gen(f_gen))</strong>是一个接受n为参数的函数，所以不妨把它令成f（f的参数是n），这样上面的式子就是：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><strong>f</strong>&nbsp;=&gt; If_Else n==0 1 n*<strong>f</strong>(n-1)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">完美的阶乘函数！</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><strong>哥德尔的不完备性定理</strong></p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><em>了解哥德尔不完备性定理的可以跳到下一节，</em><em>&ldquo;</em><em>大道至简</em><em>&mdash;&mdash;</em><em>康托尔的天才</em><em>&rdquo;</em></p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">然而，漫长的Y Combinator征途仍然并非本文的最终目的，对于Y combinator的构造和解释，只是给不了解lambda calculus或Y combinator的读者看的。关键是马上你会看到Y combinator可以由哥德尔不完备性定理证明的一个核心构造式一眼瞧出来！</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">让我们的思绪回到1931年，那个数学界风起云涌的年代，一个名不经传的20出头的学生，在他的博士论文中证明了一个惊天动地的结论。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">在那个年代，希尔伯特的数学天才就像太阳的光芒一般夺目，在关于数学严格化的大纷争中希尔伯特带领的形式主义派系技压群雄，得到许多当时有名望的数学家的支持。希尔伯特希望借助于形式化的手段，抽掉数学证明中的意义，把数学证明抽象成一堆无意义的符号转换，就连我们人类赖以自豪的逻辑推导，也不过只是一堆堆符号转换而已（想起lambda calculus系统了吧：）)。这样一来，一个我们日常所谓的，带有直观意义和解释的数学系统就变成了一个纯粹由无意义符号表达的、公理加上推导规则所构成的形式系统，而数学证明呢，只不过是在这个系统内玩的一个文字游戏。令人惊讶的是，这样一种做法，真的是可行的！数学的意义，似乎竟然真的可以被抽掉！另一方面，一个形式系统具有非常好的性质，平时人们证明一个定理所动用的推导，变成了纯粹机械的符号变换。希尔伯特希望能够证明，在任一个无矛盾的形式系统中所能表达的所有陈述都要么能够证明要么能够证伪。这看起来是个非常直观的结论，因为一个结论要么是真要么是假，而它在它所处的领域/系统中当然应该能够证明或证伪了（只要我们能够揭示出该系统中足够多的真理）。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">然而，哥德尔的证明无情的击碎了这一企图，哥德尔的证明揭示出，任何足够强到蕴含了皮亚诺算术系统（PA）的一致（即无矛盾）的系统都是不完备的，所谓不完备也就是说在系统内存在一个为真但无法在系统内推导出的命题。这在当时的数学界揭起了轩然大波，其证明不仅具有数学意义，而且蕴含了深刻的哲学意义。从那时起这一不完备性定理就被引申到自然科学乃至人文科学的各个角落&hellip;至今还没有任何一个数学定理居然能够产生这么广泛而深远的影响。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">哥德尔的证明非常的长，达到了200多页纸，但其中很大的成分是用在了一些辅助性的工作上面，比如占据超过1/3纸张的是关于一个形式系统如何映射到自然数，也就是说，如何把一个形式系统中的所有公式都表示为自然数，并可以从一自然数反过来得出相应的公式。这其实就是编码，在我们现在看来是很显然的，因为一个程序就可以被编码成二进制数，反过来也可以解码。但是在当时这是一个全新的思想，也是最关键的辅助性工作之一，另一方面，这正是&ldquo;程序即数据&rdquo;的最初想法。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">现在我们知道，要证明哥德尔的不完备性定理，只需在假定的形式系统T内表达出一个为真但无法在T内推导出（证明）的命题。于是哥德尔构造了这样一个命题，用自然语言表达就是：命题P说的是&ldquo;<em>P</em><em>不可在系统</em><em>T</em><em>内证明</em>&rdquo;（这里的系统T当然就是我们的命题P所处的形式系统了），也就是说&ldquo;<em>我不可以被证明</em>&rdquo;，跟著名的说谎者悖论非常相似，只是把&ldquo;说谎&rdquo;改成了&ldquo;不可以被证明&rdquo;。我们注意到，一旦这个命题能够在T内表达出来，我们就可以得出&ldquo;P为真但无法在T内推导出来&rdquo;的结论，从而证明T的不完备性。为什么呢？我们假设T可以证明出P，而因为P说的就是P不可在系统T内证明，于是我们又得到T无法证明出P，矛盾产生，说明我们的假设&ldquo;T可以证明P&rdquo;是错误的，根据排中律，我们得到T不可以证明P，而由于P说的正是&ldquo;T不可证明P&rdquo;，所以P就成了一个正确的命题，同时无法由T内证明！</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">如果你足够敏锐，你会发现上面这番推理本身不就是证明吗？其证明的结果不就是P是正确的？然而实际上这番证明是位于T系统之外的，它用到了一个关于T系统的假设&ldquo;T是一致（无矛盾）的&rdquo;，这个假设并非T系统里面的内容，所以我们刚才其实是在T系统<em>之外</em>推导出了P是正确的，这跟P不能在T<em>之</em><em>内</em>推导出来并不矛盾。所以别担心，一切都正常。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">那么，剩下来最关键的问题就是如何用形式语言在T内表达出这个P，上面的理论虽然漂亮，但若是P根本没法在T内表达出来，我们又如何能证明&ldquo;T内存在这个为真但无法被证明的P&rdquo;呢？那一切还不是白搭？</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">于是，就有了哥德尔证明里面最核心的构造，哥德尔构造了这样一个公式：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><strong>N(n) is unprovable in T</strong></p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">这个公式由两部分构成，n是这个公式的自由变量，它是一个自然数，一旦给定，那么这个公式就变成一个明确的命题。而N则是从n解码出的货真价实的（即我们常见的符号形式的）公式（记得哥德尔的证明第一部分就是把公式编码吗？）。&rdquo;is unprovable in T&rdquo;则是一个谓词，这里我们没有用形式语言而是用自然语言表达出来的，但哥德尔证明了它是可以用形式语言表达出来的，大致思路就是：一个形式系统中的符号数目是有限的，它们构成这个形式系统的符号表。于是，我们可以依次枚举出所有长度为1的串，长度为2的串，长度为3的串&hellip; 此外根据形式系统给出的语法规则，我们可以检查每个串是否是良构的公式（well formed formula，简称wff，其实也就是说，是否符合语法规则，前面我们在介绍lambda calculus的时候看到了，一个形式系统是需要语法规则的，比如逻辑语言形式化之后我们就会看到P-&gt;Q是一个wff，而-&gt;PQ则不是），因而我们就可以枚举出所有的wff来。最关键的是，我们观察到形式系统中的证明也不过就是由一个个的wff构成的序列（想想推导的过程，不就是一个公式接一个公式嘛）。而wff构成的序列本身同样也是由符号表内的符号构成的串。所以我们只需枚举所有的串，对每一个串检查它是否是一个由wff构成的序列（证明），如果是，则记录下这个wff序列（证明）的最后一个wff，也就是它的结论。这样我们便枚举出了所有的可由T推导出的定理。然后为了表达出&rdquo;X is unprovable in T&rdquo;，本质上我们只需说&ldquo;不存在这样一个自然数S，它所解码出来的wff序列以X为终结&rdquo;！这也就是说，我们表达出了&ldquo;is unprovable in T&rdquo;这个谓词。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">我们用UnPr(X)来表达&ldquo;X is unprovable in T&rdquo;，于是哥德尔的公式变成了：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">UnPr( N(n) )</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">现在，到了最关键的部分，首先我们把这个公式简记为G(n)&mdash;&mdash;别忘了G内有一个自由变量n，所以G现在还不是一个命题，而只是一个公式，所以谈不上真假：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">G(n): UnPr( N(n) )</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">又由于G也是个wff，所以它也有自己的编码g，当然g是一个自然数，现在我们把g作为G的参数，也就是说，把G里面的自由变量n替换为g，我们于是得到一个真正的命题：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">G(g): UnPr( G(g) )</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">用自然语言来说，这个命题G(g)说的就是&ldquo;<em>我是不可在</em><em>T</em><em>内证明的</em>&rdquo;。看，我们在形式系统T内表达出了&ldquo;我是不可在T内证明的&rdquo;这个命题。而我们一开始已经讲过了如何用这个命题来推断出G(g)为真但无法在T内证明，于是这就证明了哥德尔的不完备性定理<sup>[8]</sup>。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">哥德尔的不完备性定理被称为20世纪数学最重大的发现（不知道有没有&ldquo;之一&rdquo;:) ）现在我们知道为真但无法在系统内证明的命题不仅仅是这个诡异的&ldquo;哥德尔命题&rdquo;，还有很多真正有意义的明确命题，其中最著名的就是<a style="color: #313428" href="javascript:if(confirm('http://en.wikipedia.org/wiki/Continuum_hypothesis  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://en.wikipedia.org/wiki/Continuum_hypothesis'" tppabs="http://en.wikipedia.org/wiki/Continuum_hypothesis">连续统假设</a>，此外哥德巴赫猜想也有可能是个没法在数论系统中证明的真命题。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><strong>从哥德尔公式到</strong><strong>Y Combinator</strong></p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">哥德尔的不完备性定理证明了数学是一个未完结的学科，永远有需要我们以人的头脑从系统之外去用我们独有的直觉发现的东西。罗杰&middot;彭罗斯在<a style="color: #313428" href="javascript:if(confirm('http://www.amazon.com/Emperors-New-Mind-Roger-Penrose/dp/0140145346  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.amazon.com/Emperors-New-Mind-Roger-Penrose/dp/0140145346'" tppabs="http://www.amazon.com/Emperors-New-Mind-Roger-Penrose/dp/0140145346">《The Emperor&rsquo;s New Mind》</a>中用它来证明人工智能的不可实现。当然，这个结论是很受质疑的。但哥德尔的不完备性定理的确还有很多很多的有趣推论，数学的和哲学上的。哥德尔的不完备性定理最深刻的地方就是它揭示了自指（或称自引用，递归调用自身等等）结构的普遍存在性，我们再来看一看哥德尔命题的绝妙构造：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">G(n): UnPr( N(n) )</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">我们注意到，这里的UnPr其实是一个形式化的谓词，它不一定要说&ldquo;X在T内可证明&rdquo;，我们可以把它泛化为一个一般化的谓词，P：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><strong>G(n): P( N(n) )</strong></p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">也就是说，对于任意一个单参的谓词P，都存在上面这个哥德尔公式。然后我们算出这个哥德尔公式的自然数编码g，然后把它扔给G，就得到：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">G(g): P( G(g) )</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">是不是很熟悉这个结构？我们的Y Combinator的构造不就是这样一个形式？我们把G和P都看成一元函数，G(g)可不正是P这个函数的不动点么！于是，<strong>我们从哥德尔的证明里面直接看到了</strong><strong>Y Combinator</strong>！</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">至于如何从哥德尔的证明联系到停机问题，就留给你去解决吧:) 因为更重要的还在后面，我们看到，哥德尔的证明虽然巧妙至极，然而其背后的思维过程仍然飘逸而不可捉摸，至少我当时看到G(n)的时候，&ldquo;乃大惊&rdquo;&ldquo;不知所从出&rdquo;，他怎么想到的？难道是某一个瞬间&ldquo;灵光一现&rdquo;？一般我是不信这一说的，已经有越来越多的科学研究表明一瞬间的&ldquo;灵感&rdquo;往往是潜意识乃至表层意识长期思考的结果。哥德尔天才的证明也不例外，我们马上就会看到，在这个神秘的构造背后，其实隐藏着某种更深的东西，这就是康托尔在19世纪80年代研究无穷集合和超限数时引入的对角线方法。这个方法仿佛有种神奇的力量，能够揭示出某种自指的结构来，而同时，这又是一个极度简单的手法，通过它我们能够得到数学里面一些非常奇妙的性质。无论是哥德尔的不完备性定理还是再后来丘齐建立的lambda calculus，抑或我们非常熟悉的图灵机理论里的停机问题，其实都只是这个手法简单推演的结果！</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><strong>大道至简</strong><strong>&mdash;&mdash;</strong><strong>康托尔的天才</strong></p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">&ldquo;大道至简&rdquo;这个名词或许更多出现在文学和哲学里面，一般用在一些模模糊糊玄玄乎乎的哲学观点上。然而，用在这里，数学上，这个名词才终于适得其所。大道至简，看上去最复杂的理论其实建立在一个最简单最纯粹的道理之上。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">康托尔在无穷集合和超限数方面的工作主要集中在两篇突破性的论文上，这也是我所见过的最纯粹最美妙的数学论文，现代的数学理论充斥了太多复杂的符号和概念，很多时候让人看不到最本质的东西，当然，不否认这些东西很多也是有用的，然而，要领悟真正的数学美，像集合论和数论这种纯粹的东西，真的非常适合。不过这里就不过多谈论数学的细节了，只说康托尔引入对角线方法的动机和什么是对角线方法。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><strong>神奇的一一对应</strong></p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">康托尔在研究无穷集合的时候，富有洞察性地看到了对于无穷集合的大小问题，我们不能再使用直观的&ldquo;所含元素的个数&rdquo;来描述，于是他创造性地将一一对应引入进来，两个无穷集合&ldquo;大小&rdquo;一样当且仅当它们的元素之间能够构成一一对应。这是一个非常直观的概念，一一对应嘛，当然个数相等了，是不是呢？然而这同时就是它不直观的地方了。对于无穷集合，我们日常的所谓&ldquo;个数&rdquo;的概念不管用了，因为无穷集合里面的元素个数本就是无穷多个。不信我们来看一个小小的例子。我们说自然数集合能够跟偶数集合构成一一对应，从而<em>自然数集合跟偶数集合里面元素</em><em>&ldquo;</em><em>个数</em><em>&rdquo;</em><em>是一样多的</em>。怎么可能？偶数集合是自然数集合的真子集，所有偶数都是自然数，但自然数里面还包含奇数呢，说起来应该是二倍的关系不是？不是！我们只要这样来构造一一对应：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">1 2 3 4 &hellip;</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">2 4 6 8 &hellip;</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">用函数来描述就是 f(n) = 2n。检验一下是不是一一对应的？不可思议对吗？还有更不可思议的，<em>自然数集是跟有理数集一一对应的</em>！对应函数的构造就留给你解决吧，提示，按如下方式来挨个数所有的有理数：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">1/1 1/2 2/1 1/3 2/2 3/1 1/4 2/3 3/2 4/1 &hellip;</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">用这种一一对应的手法还可以得到很多惊人的结论，如<em>一条直线上所有的点跟一个平面上所有的点构成一一对应</em>（也就是说<em>复数集合跟实数集合构成一一对应</em>）。以致于连康托尔自己都不敢相信自己的眼睛了，这也就是为什么他在给戴得金的信中会说&ldquo;我看到了它，却不敢相信它&rdquo;的原因。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">然而，除了一一对应之外，还有没有不能构成一一对应的两个无穷集合呢？有。<em>实数集合就比自然数集合要</em><em>&ldquo;</em><em>大</em><em>&rdquo;</em>，它们之间实际上无法构成一一对应。这就是康托尔的对角线方法要解决的问题。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><strong>实数集和自然数集无法构成一一对应？！</strong></p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">我们只需将实数的小数位展开，并且我们假设实数集能够与自然数集一一对应，也就是说假设实数集<a style="color: #313428" href="javascript:if(confirm('http://en.wikipedia.org/wiki/Countable  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://en.wikipedia.org/wiki/Countable'" tppabs="http://en.wikipedia.org/wiki/Countable">可列</a>，所以我们把它们与自然数一一对应列出，如下：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">1 a<sub>10</sub>.a<sub>11</sub>a<sub>12</sub>a<sub>13</sub>&hellip;</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">2 a<sub>20</sub>.a<sub>21</sub>a<sub>22</sub>a<sub>23</sub>&hellip;</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">3 a<sub>30</sub>.a<sub>31</sub>a<sub>32</sub>a<sub>33</sub>&hellip;</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">4 &hellip;</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">5 &hellip;</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">（注：aij里面的ij是下标）</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">现在，我们构造一个新的实数，它的第i位小数不等于aii。也就是说，它跟上面列出的每一个实数都至少有一个对应的小数位不等，也就是说它不等于我们上面列出的所有实数，这跟我们上面假设已经列出了所有实数的说法相矛盾。所以实数集只能是不可列的，即不可与自然数集一一对应！这是对角线方法的最简单应用。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><strong>对角线方法</strong><strong>&mdash;&mdash;</strong><strong>停机问题的深刻含义</strong></p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">对角线方法有很多非常奇妙的结论。其中之一就是文章一开始提到的停机问题。我想绝大多数人刚接触停机问题的时候都有一个问题，图灵怎么能够想到这么诡异的证明，怎么能构造出那个诡异的&ldquo;说停机又不停机，说不停机又停机&rdquo;的悖论机器。马上我们就会看到，这其实只是对角线方法的一个直接结论。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">还是从反证开始，我们假设存在这样一个图灵机，他能够判断任何程序在任何输入上是否停机。由于所有图灵机构成的集合是一个可列集（也就是说，我们可以逐一列出所有的图灵机，严格证明见我以前的一篇文章《<a style="color: #313428" href="javascript:if(confirm('http://blog.csdn.net/pongba/archive/2006/03/11/621723.aspx  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://blog.csdn.net/pongba/archive/2006/03/11/621723.aspx'" tppabs="http://blog.csdn.net/pongba/archive/2006/03/11/621723.aspx">图灵机杂思</a>》），所以我们可以很自然地列出下表，它表示每个图灵机分别在每一个可能的输入（1,2,3,&hellip;）下的输出，N表示无法停机，其余数值则表示停机后的输出：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp; 2&nbsp; 3&nbsp; 4 &hellip;</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">M1&nbsp; N&nbsp; 1&nbsp; N&nbsp; N &hellip;</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">M2&nbsp; 2&nbsp; 0&nbsp; N&nbsp; 0 &hellip;</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">M3&nbsp; 0&nbsp; 1&nbsp; 2&nbsp; 0 &hellip;</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">M4&nbsp; N&nbsp; 0&nbsp; 5&nbsp; N &hellip;</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">&hellip;</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">M1，M2，M3 &hellip; 是逐一列出的图灵机，并且，注意，由于程序即数据，每个图灵机都有唯一编码，所以我们规定在枚举图灵机的时候Mi其实就代表编码为i的图灵机，当然这里很多图灵机将会是根本没用的玩意，但这不要紧。此外，最上面的一行1 2 3 4 &hellip; 是输入数据，如，矩阵的第一行代表M1分别在1，2，3，&hellip;上面的输出，不停机的话就是N。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">我们刚才假设存在这样一个图灵机H，它能够判断任何程序在任何输入上能否停机，换句话说，H(i,j)（i是Mi的编码）能够给出&ldquo;Mi(j)&rdquo;是N（不停）呢还是给出一个具体的结果（停）。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">我们现在来运用康托尔的对角线方法，我们构造一个新的图灵机P，P在1上的输出行为跟M1(1)&ldquo;不一样&rdquo;，在2上的输出行为跟M2(2)&ldquo;不一样&rdquo;，&hellip;总之P在输入i上的输出跟Mi(i)不一样。只需利用一下我们万能的H，这个图灵机P就不难构造出来，如下：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">P(i):</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">if(&nbsp;<strong>H</strong>(i, i) == 1 ) then // Mi(i) halts</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">&nbsp; return 1 + Mi(i)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">else // if H(i, i) == 0 (Mi(i) doesn&rsquo;t halt)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">&nbsp; return 0</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">也就是说，如果Mi(i)停机，那么P(i)的输出就是Mi(i)+1，如果Mi(i)不停机的话，P(i)就停机且输出0。这就保证了P(i)的输出行为跟Mi(i)反正不一样。现在，我们注意到P本身是一个图灵机，而我们上面已经列出了所有的图灵机，所以必然存在一个k，使得Mk = P。而两个图灵机相等当且仅当它们对于所有的输入都相等，也就是说对于任取的n，有Mk(n) = P(n)，现在令n=k，得到Mk(k)=P(k)，根据上面给出的P的定义，这实际上就是：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">Mk(k) = P(k) =</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">&nbsp; 1+Mk(k) if Mk(k) halts</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">&nbsp; 0 if Mk(k) doesn&rsquo;t halt</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">看到这个式子里蕴含的矛盾了吗？如果Mk(k)停机，那么Mk(k)=1+Mk(k)；如果Mk(k)不停机，则Mk(k)=0（给出结果0即意味着Mk(k)停机）；不管哪种情况都是矛盾。于是我们得出，不存在那样的H。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">这个对角线方法实际上说明了，无论多聪明的H，总存在一个图灵机的停机行为是它无法判断的。这跟哥德尔定理&ldquo;无论多&lsquo;完备&rsquo;的形式化公理系统，都存在一个&lsquo;哥德尔命题&rsquo;是无法在系统内推导出来的&rdquo;从本质上其实是一模一样的。只不过我们一般把图灵的停机问题称为&ldquo;可判定问题&rdquo;，而把数学的称为&ldquo;可证明问题&rdquo;。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">等等！如果我们把那个无法判定是否停机的图灵机作为算法的特例纳入到我们的H当中呢？我们把得到的新的判定算法记为H<sub>1</sub>。然而，可惜的是，在H<sub>1</sub>下，我们又可以相应地以同样的手法从H<sub>1</sub>构造出一个无法被它（H<sub>1</sub>）判定的图灵机来。你再加，我再构造，无论你加多少个特例进去，我都可以由同样的方式构造出来一个你无法够到的图灵机，以彼之矛，攻彼之盾。其实这也是哥德尔定理最深刻的结论之一，哥德尔定理其实就说明了无论你给出多少个公理，即无论你建立多么完备的公理体系，这个系统里面都有由你的那些公理出发所推导不到的地方，这些黑暗的角落，就是人类直觉之光才能照射到的地方！</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">本节我们从对角线方法证明了图灵的停机问题，我们看到，对角线方法能够揭示出某种自指结构，从而构造出一个&ldquo;悖论图灵机&rdquo;。实际上，对角线方法是一种有深远影响的方法，哥德尔的证明其实也是这个方法的一则应用。证明与上面的停机问题证明如出一辙，只不过把Mi换成了一个形式系统内的公式fi，具体的证明就留给聪明的你吧:)我们现在来简单的看一下这个奇妙方法的几个不那么明显的推论。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><strong>罗素悖论</strong></p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">学过逻辑的人大约肯定是知道著名的罗素悖论的，罗素悖论用数学的形式来描述就是：</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">R = &#123;X:X不属于X&#125;;</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">这个悖论最初是从康托尔的无穷集合论里面引申出来的。当初康托尔在思考无穷集合的时候发现可以称&ldquo;一切集合的集合&rdquo;，这样一个集合由于它本身也是一个集合，所以它就属于它自身。也就是说，我们现在可以称世界上存在一类属于自己的集合，除此之外当然就是不属于自己的集合了。而我们把所有不属于自己的集合收集起来做成一个集合R，这就是上面这个著名的罗素悖论了。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">我们来看R是否属于R，如果R属于R，根据R的定义，R就不应该属于R。而如果R不属于R，则再次根据R的定义，R就应该属于R。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">这个悖论促使了集合论的公理化。后来策梅罗公理化的集合论里面就不允许X属于X（不过可惜的是，尽管如此还是没法证明这样的集合论不可能产生出新的悖论。而且永远没法证明&mdash;&mdash;这就是哥德尔第二不完备性定理的结论&mdash;&mdash;一个包含了PA的形式化公理系统永远无法在内部证明其自身的一致（无矛盾）性。从而希尔伯特想从元数学推出所有数学系统的一致性的企图也就失败了，因为元数学的一致性又得由元元数学来证明，后者的一致性又得由元元元数学来证明&hellip;）。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">这里我们只关心罗素是如何想出这个绝妙的悖论的。还是对角线方法！我们罗列出所有的集合，S1,S2,S3 &hellip;</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; S1&nbsp; S2&nbsp; S3 &hellip;</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">S1&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp;&nbsp; 1 &hellip;</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">S2&nbsp; 1&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp;&nbsp; 0 &hellip;</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">S3&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp; 0 &hellip;</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">&hellip; &hellip;</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">右侧纵向列出所有集合，顶行横向列出所有集合。0/1矩阵的(i,j)处的元素表示Si是否包含Sj，记为Si(j)。现在我们只需构造一个新的0/1序列L，它的第i位与矩阵的(i,i)处的值恰恰相反：L(i) = 1-Si(i)。我们看到，这个新的序列其实对应了一个集合，不妨也记为L，L(i)表示L是否包含Si。根据L的定义，如果矩阵的(i,i)处值为0（也就是说，如果Si不包含Si），那么L这个集合就包含Si,否则就不包含。我们注意到这个新的集合L肯定等于某个Sk（因为我们已经列出了所有的集合），L = Sk。既然L与Sk是同一集合，那么它们肯定包含同样的元素，从而对于任意n，有L(n) = Sk(n)。于是通过令n=k，得到L(k) = Sk(k)，而根据L的定义，L(k) = 1- Sk(k)。这就有Sk(k) = 1-Sk(k)，矛盾。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">通过抽象简化以上过程，我们看到，我们构造的L其实是&ldquo;包含了所有不包含它自身的集合的集合&rdquo;，用数学的描述正是罗素悖论！</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">敏锐的你可能会注意到所有集合的数目是不可数的从而根本不能S1,S2&hellip;的一一列举出来。没错，但通过假设它们可以列举出来，我们发现了一个与可列性无关的悖论。所以这里的对角线方法其实可以说是一种启发式方法。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">同样的手法也可以用到证明P(A)（A的所有子集构成的集合，也叫幂集）无法跟A构成一一对应上面。证明就留给聪明的你了:)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><strong>希尔伯特第十问题结出的硕果</strong></p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">希尔伯特是在1900年巴黎数学家大会上提出著名的希尔伯特第十问题的，简言之就是<em>是否存在一个算法，能够计算任意</em><em><a style="color: #313428" href="javascript:if(confirm('http://en.wikipedia.org/wiki/Diophantine_equation  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://en.wikipedia.org/wiki/Diophantine_equation'" tppabs="http://en.wikipedia.org/wiki/Diophantine_equation">丢番图方程</a></em><em>是否有整根</em>。要解决这个问题，就得先严格定义&ldquo;算法&rdquo;这一概念。为此图灵和丘齐分别提出了图灵机和lambda calculus这两个概念，它们从不同的角度抽象出了&ldquo;有效（机械）计算&rdquo;的概念，著名的<a style="color: #313428" href="javascript:if(confirm('http://en.wikipedia.org/wiki/Church-Turing_thesis  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://en.wikipedia.org/wiki/Church-Turing_thesis'" tppabs="http://en.wikipedia.org/wiki/Church-Turing_thesis">图灵&mdash;&mdash;丘齐命题</a>就是说<em>所有可以有效计算出来的问题都可以由图灵机计算出来</em>。实际上我们已经看到，丘齐的lambda calculus其实就是数学推理系统的一个形式化。而图灵机则是把这个数学概念物理化了。而也正因为图灵机的概念隐含了实际的物理实现，所以冯&middot;诺依曼才据此提出了奠定现代计算机体系结构的<a style="color: #313428" href="javascript:if(confirm('http://en.wikipedia.org/wiki/Von_Neumann_architecture  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://en.wikipedia.org/wiki/Von_Neumann_architecture'" tppabs="http://en.wikipedia.org/wiki/Von_Neumann_architecture">冯&middot;诺依曼体系结构</a>，其遵循的，正是图灵机的概念。而&ldquo;程序即数据&rdquo;的理念，这个发端于数学家哥德尔的不完备性定理的证明之中的理念，则早就在黑暗中预示了可编程机器的必然问世。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><strong>对角线方法</strong><strong>&mdash;&mdash;</strong><strong>回顾</strong></p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">我们看到了对角线方法是如何简洁而深刻地揭示出自指或递归结构的。我们看到了著名的不完备性定理、停机问题、Y Combinator、罗素悖论等等等等如何通过这一简洁优美的方法推导出来。这一诞生于康托尔的天才的手法如同一条金色的丝线，把位于不同年代的伟大发现串联了起来，并且将一直延续下去&hellip;</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">P.S</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">1. lambda calculus里面的&ldquo;停机问题&rdquo;</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">实际上lambda calculus里面也是有&ldquo;停机问题&rdquo;的等价版本的。其描述就是：不存在一个算法能够判定任意两个lambda函数是否等价。所谓等价当然是对于所有的n,有f(n)=g(n)了。这个问题的证明更加能够体现对角线方法的运用。仍然留给你吧。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">2.&nbsp;<a style="color: #313428" href="javascript:if(confirm('http://blog.csdn.net/g9yuayon  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://blog.csdn.net/g9yuayon'" tppabs="http://blog.csdn.net/g9yuayon">负喧琐话</a>(<a style="color: #313428" href="javascript:if(confirm('http://blog.csdn.net/g9yuayon  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://blog.csdn.net/g9yuayon'" tppabs="http://blog.csdn.net/g9yuayon">http://blog.csdn.net/g9yuayon</a>)是个非常不错的blog:)。g9的文字轻松幽默，而且有很多名人八卦可以养眼，真的灰常&hellip;灰常&hellip;不错哦。此外g9老兄还是个理论功底非常扎实的牛。所以，anyway，看了他的blog就知道啦！最初这篇文章的动机也正是看了上面的一篇<a style="color: #313428" href="javascript:if(confirm('http://blog.csdn.net/g9yuayon/archive/2006/09/24/1271319.aspx  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://blog.csdn.net/g9yuayon/archive/2006/09/24/1271319.aspx'" tppabs="http://blog.csdn.net/g9yuayon/archive/2006/09/24/1271319.aspx">关于Y Combinator的铸造过程的介绍</a>，于是想揭示一些更深的东西，于是便有了本文。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">3. 文章起名《康托尔、哥德尔、图灵&mdash;&mdash;永恒的金色对角线》其实是为了纪念看过的一本好书GEB，即《Godel、Escher、Bach-An Eternal Golden Braid》中文译名《哥德尔、埃舍尔、巴赫&mdash;&mdash;集异璧之大成》&mdash;&mdash;商务印书馆出版。对于一本定价50元居然能够在douban上卖到100元的二手旧书，我想无需多说。另，幸福的是，电子版可以找到:)</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">4. 其实很久前想写的是一篇《从哥德尔到图灵》，但那篇写到1/3不到就搁下了，一是由于事务，二是总觉得少点什么。呵呵，如今把康托尔扯进来，也算是完成当时扔掉的那一篇吧。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">5. 这恐怕算是写得最曲折的一篇文章了。不仅自己被这些问题搞得有点晕头转向（还好总算走出来），更因为要把这些东西自然而然的串起来，也颇费周章。很多时候是利用吃饭睡觉前或走路的时间思考本质的问题以及如何表达等等，然后到纸上一气呵成。不过同时也锻炼了不拿纸笔思考数学的能力，呵呵。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">6. 关于图灵的停机问题、Y Combinator、哥德尔的不完备性定理以及其它种种与康托尔的对角线之间的本质联系，几乎查不到完整系统的深入介绍，一些书甚至如《The Emperor&rsquo;s New Mind》也只是介绍了与图灵停机问题之间的联系（已经非常的难得了），google和baidu的结果也是基本没有头绪。很多地方都是一带而过让人干着急。所以看到很多地方介绍这些定理和构造的时候都是弄得人晕头转向的，绝大部分人在面对如Y Combinator、不完备性定理、停机问题的时候都把注意力放在力图理解它是怎么运作的上面了，却使人看不到其本质上从何而来，于是人们便对这些东东大为惊叹。这使我感到很不痛快，如隔靴搔痒般。这也是写这篇文章的主要动机之一。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px"><strong>Reference</strong></p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">[1] 《数学&mdash;&mdash;确定性的丧失》</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">[2] 也有观点认为函数式编程语言之所以没有广泛流行起来是因为一些实际的商业因素。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">[3] Douglas R.Hofstadter的著作《Godel, Escher, Bach: An Eternal Golden Braid》（《哥德尔、艾舍尔、巴赫&mdash;&mdash;集异璧之大成》）就是围绕这一思想写出的一本奇书。非常建议一读。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">[4] 《数学&mdash;&mdash;确定性的丧失》</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">[5] 虽然我觉得那个系徽做得太复杂，要表达这一简洁优美的思想其实还能有更好的方式。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">[6] 关于如何在lambda calculus系统里实现&ldquo;+&rdquo;操作符以及自然数等等，可参见<a style="color: #313428" href="javascript:if(confirm('http://blog.csdn.net/g9yuayon/archive/2006/05/29/759778.aspx  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://blog.csdn.net/g9yuayon/archive/2006/05/29/759778.aspx'" tppabs="http://blog.csdn.net/g9yuayon/archive/2006/05/29/759778.aspx">这里</a>，<a style="color: #313428" href="javascript:if(confirm('http://blog.csdn.net/g9yuayon/archive/2006/06/12/790953.aspx  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://blog.csdn.net/g9yuayon/archive/2006/06/12/790953.aspx'" tppabs="http://blog.csdn.net/g9yuayon/archive/2006/06/12/790953.aspx">这里</a>，和<a style="color: #313428" href="javascript:if(confirm('http://blog.csdn.net/g9yuayon/archive/2006/08/14/1062514.aspx  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://blog.csdn.net/g9yuayon/archive/2006/08/14/1062514.aspx'" tppabs="http://blog.csdn.net/g9yuayon/archive/2006/08/14/1062514.aspx">这里</a>。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">[7] g9的blog（负暄琐话）<a style="color: #313428" href="javascript:if(confirm('http://blog.csdn.net/g9yuayon/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://blog.csdn.net/g9yuayon/'" tppabs="http://blog.csdn.net/g9yuayon/">http://blog.csdn.net/g9yuayon/</a>&nbsp;上有一系列介绍lambda calculus的文章（当然，还有其它好文章:)），非常不错，强烈推荐。最近的两篇就是介绍Y combinator的。其中有一篇以javaScript语言描述了迭代式逐步抽象出Y Combinator的过程。</p><p style="line-height: 21px; margin: 0px 0px 1.25em; padding: 0px; color: #333333; font-family: 'Lucida Grande', Arial, Helvetica, sans-serif; font-size: 14px">[8] 实际上这只是第一不完备性定理，它还有一个推论，被称为第二不完备性定理，说的是任一个系统T内无法证明这个系统本身的一致性。这个定理的证明核心思想如下：我们前面证明第一不完备性定理的时候用的推断其实就表明 Con/T -&gt; G(g) （自然语言描述就是，由系统T的无矛盾，可以推出G(g)成立），而这个&ldquo;Con/T -&gt; G(g)&rdquo;本身又是可以在T内表达且证明出来的（具体怎么表达就不再多说了）&mdash;&mdash;只需要用排中律即可。于是我们立即得到，T里面无法推出Con/T，因为一旦推出Con/T就立即推出G(g)从而推出UnPr(G(g))，这就矛盾了。所以，Con/T无法在T内推出（证明）。</p>
	</div>
	<div class="textbox-bottom">
	</div>
	<div class="tags" style="display: none"> 
	</div>
</div><div class="textbox">
	<div class="textbox-calendar">
	<span class="textbox-calendar-month">Aug</span>
	<span class="textbox-calendar-day">31</span>
	</div>
	<div class="textbox-title">
		<h4>
		<a href="read.php-7521.htm" tppabs="http://i.renjihe.com/blog/read.php?7521">lambda演算与函数式编程 </a> <span id="starid7521"><img src="unstarred.gif" tppabs="http://i.renjihe.com/blog/template/default/images/others/unstarred.gif" alt="" title="未加星标" border="0"/></span> <img src="blank.gif" tppabs="http://i.renjihe.com/blog/images/weather/blank.gif" alt="不指定" title="不指定"/>
		</h4>
		<div class="textbox-label">
		<a href="view.php-go=user_1.htm" tppabs="http://i.renjihe.com/blog/view.php?go=user_1" target="_blank">renjihe1988</a> , 23:26 , <a href="index.php-go=category_2.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_2" title="查看分类： 软件">软件</a> &raquo; <a href="index.php-go=category_19.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_19" title="查看分类： 编译原理">编译原理</a> , <a href="read.php-7521.htm#reply" tppabs="http://i.renjihe.com/blog/read.php?7521#reply" title="发表您的评论">评论(0)</a> , <a href='javascript: void(0);' title="查看引用地址" onclick='showhidediv("tb7521");'>引用(0)</a> , <a href="read.php-7521.htm" tppabs="http://i.renjihe.com/blog/read.php?7521">阅读(3)</a> , Via 本站原创 
		</div>
	</div>
	<div id="tb7521" style="display: none;" class="textbox-tburl"><strong>引用功能被关闭了。</strong></div>
	
	<div class="textbox-content">
	<span style="font-size: 14px; line-height: 21px; font-family: simsun; color: #494949; background-color: #eb735a">前几天开始看&lt;程序设计语言概念&gt;（&nbsp;</span><a style="text-decoration: none; color: #99481f; font-family: simsun; font-size: 14px; line-height: 21px; background-color: #eb735a" href="javascript:if(confirm('http://www.amazon.com/exec/obidos/ASIN/0521780985/qid=1129186290/sr=11-1/ref=sr_11_1/103-3929732-9947012  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.amazon.com/exec/obidos/ASIN/0521780985/qid=1129186290/sr=11-1/ref=sr_11_1/103-3929732-9947012'" tppabs="http://www.amazon.com/exec/obidos/ASIN/0521780985/qid=1129186290/sr=11-1/ref=sr_11_1/103-3929732-9947012" target="_blank"><strong>Concepts in Programming Languages</strong></a><span style="font-size: 14px; line-height: 21px; font-family: simsun; color: #494949; background-color: #eb735a">&nbsp;），里面一开始就讲了计算系统，但不是图灵机，而是&lambda;演算。以前看SICP的时候有一题Church计数，既在&lambda;演算中，计算系统用函数的嵌套次数来计数（以及对应的scheme定义）：</span><br /><table border="0" cellspacing="1" cellpadding="1" style="margin: 0px; padding: 0px; color: #494949; font-family: simsun; font-size: 14px; background-color: #eb735a"><tbody><tr><td style="margin: 0px; padding: 0px; font-size: 12px; font-family: Verdana, 宋体, sans-serif; line-height: 18px"><table border="0" cellspacing="1" cellpadding="1" style="margin: 0px; padding: 0px"><tbody><tr><td style="margin: 0px; padding: 0px; font-size: 12px; font-family: Verdana, 宋体, sans-serif; line-height: 18px; color: #787878"><span style="word-wrap: normal; word-break: normal; line-height: 19.5px; font-size: x-small"><strong>0</strong>&nbsp;&equiv;&nbsp;&lambda;f.&lambda;x. x</span></td><td style="margin: 0px; padding: 0px; font-size: 12px; font-family: Verdana, 宋体, sans-serif; line-height: 18px; color: #787878"><span style="word-wrap: normal; word-break: normal; line-height: 19.5px; font-size: x-small">(define&nbsp;zero&nbsp;(lambda&nbsp;(f) (lambda&nbsp;(x)&nbsp;x)))</span></td></tr><tr><td style="margin: 0px; padding: 0px; font-size: 12px; font-family: Verdana, 宋体, sans-serif; line-height: 18px; color: #787878"><span style="word-wrap: normal; word-break: normal; line-height: 19.5px; font-size: x-small"><strong>1</strong>&nbsp;&equiv;&nbsp;&lambda;f.&lambda;x. f x</span></td><td style="margin: 0px; padding: 0px; font-size: 12px; font-family: Verdana, 宋体, sans-serif; line-height: 18px; color: #787878"><span style="word-wrap: normal; word-break: normal; line-height: 19.5px; font-size: x-small">(define one (lambda (f) (lambda (x) (f x))))</span></td></tr><tr><td style="margin: 0px; padding: 0px; font-size: 12px; font-family: Verdana, 宋体, sans-serif; line-height: 18px; color: #787878"><span style="word-wrap: normal; word-break: normal; line-height: 19.5px; font-size: x-small"><strong>2</strong>&nbsp;&equiv;&nbsp;&lambda;f.&lambda;x. f (f x)</span></td><td style="margin: 0px; padding: 0px; font-size: 12px; font-family: Verdana, 宋体, sans-serif; line-height: 18px; color: #787878"><span style="word-wrap: normal; word-break: normal; line-height: 19.5px; font-size: x-small">(define two (lambda (f) (lambda (x) ( f (f x)))))</span></td></tr><tr><td style="margin: 0px; padding: 0px; font-size: 12px; font-family: Verdana, 宋体, sans-serif; line-height: 18px; color: #787878"><span style="word-wrap: normal; word-break: normal; line-height: 19.5px; font-size: x-small"><strong>3</strong>&nbsp;&equiv;&nbsp;&lambda;f.&lambda;x. f (f (f x))</span></td><td style="margin: 0px; padding: 0px; font-size: 12px; font-family: Verdana, 宋体, sans-serif; line-height: 18px; color: #787878"><span style="word-wrap: normal; word-break: normal; line-height: 19.5px; font-size: x-small">(define three (lambda (f) (lambda (x) (f (f (f x))))))</span></td></tr><tr><td style="margin: 0px; padding: 0px; font-size: 12px; font-family: Verdana, 宋体, sans-serif; line-height: 18px; color: #787878"><span style="word-wrap: normal; word-break: normal; line-height: 19.5px; font-size: x-small">...</span></td><td style="margin: 0px; padding: 0px; font-size: 12px; font-family: Verdana, 宋体, sans-serif; line-height: 18px; color: #787878"><span style="word-wrap: normal; word-break: normal; line-height: 19.5px; font-size: x-small">...<br /></span></td></tr><tr><td style="margin: 0px; padding: 0px; font-size: 12px; font-family: Verdana, 宋体, sans-serif; line-height: 18px; color: #787878"><span style="word-wrap: normal; word-break: normal; line-height: 19.5px; font-size: x-small"><strong>n</strong>&nbsp;&equiv;&nbsp;&lambda;f.&lambda;x. f<sup><em>n</em></sup>&nbsp;x</span></td><td style="margin: 0px; padding: 0px; font-size: 12px; font-family: Verdana, 宋体, sans-serif; line-height: 18px; color: #787878"><span style="word-wrap: normal; word-break: normal; line-height: 19.5px; font-size: x-small">...</span></td></tr></tbody></table><br />&nbsp;&nbsp;虽然计数看懂了，但是scheme的实现到现在还是没想通。。有人说对计数的lambda表达式人肉展开，我没展成功- -<br />&nbsp;&nbsp;也就是从那时候起，知道函数式编程的理论基础是&lambda;演算。正好这本书有专门的章节，在恶补了两天之后，终于知道了些皮毛。。。<br />&nbsp;<br />&nbsp;&nbsp;所谓&lambda;演算，是一套用于研究函数定义，函数应用和递归的形式系统。它包括一条变换规则（变量替换）和一条函数定义方式，Lambda演算之通用在于，任何一个可计算函数都能用这种形式来表达和求值。因而，它是等价于<a style="text-decoration: none; color: #99481f" href="javascript:if(confirm('http://zh.wikipedia.org/wiki/%E5%9B%BE%E7%81%B5%E6%9C%BA  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://zh.wikipedia.org/wiki/%E5%9B%BE%E7%81%B5%E6%9C%BA'" tppabs="http://zh.wikipedia.org/wiki/%E5%9B%BE%E7%81%B5%E6%9C%BA" title="图灵机">图灵机</a>的。尽管如此，Lambda演算强调的是变换规则的运用，而非实现它们的具体机器。可以认为这是一种更接近软件而 非硬件的方式。<br />&nbsp;&nbsp;（书上多次提到Lambda演算的计算能力已被证明等价于图灵机，就冲这点，我势必要把FP学好。。。）<br />&nbsp;&nbsp;对于Lambda演算的描述，wiki的非形式化定义：<br /><p style="margin: 0px 0px 5px; padding: 0px; border: 0px; list-style: none; word-wrap: normal; word-break: normal; color: #787878">在lambda演算中，每个表达式都代表一个只有单独参数的函数，这个函数的参数本身也是一个只有单一参数的函数，同时，函数的值是又一个只有单一 参数的函数。函数是通过lambda表达式匿名地定义的，这个表达式说明了此函数将对其参数进行什么操作。例如，&ldquo;加2&rdquo;函数f(x)= x + 2可以用lambda演算表示为&lambda;x.x + 2(&lambda;y.y + 2也是一样的，参数的取名无关紧要)而f(3)的值可以写作(&lambda;x.x + 2) 3。函数的作用（application）是<a style="text-decoration: none; color: #99481f" href="javascript:if(confirm('http://zh.wikipedia.org/w/index.php?title=%E5%B7%A6%E7%BB%93%E5%90%88&action=edit&redlink=1  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://zh.wikipedia.org/w/index.php?title=%E5%B7%A6%E7%BB%93%E5%90%88&action=edit&redlink=1'" tppabs="http://zh.wikipedia.org/w/index.php?title=%E5%B7%A6%E7%BB%93%E5%90%88&action=edit&redlink=1" title="左结合">左结合</a>的：f x y =(f x) y。考虑这么一个函数：它把一个函数作为参数，这个函数将被作用在3上：&lambda;f.f 3。如果把这个（用函数作参数的）函数作用于我们先前的&ldquo;加2&rdquo;函数上：(&lambda;f.f 3)(&lambda;x.x+2)，则明显地，下述三个表达式：</p><dl style="margin: 0px; padding: 0px; border: 0px; list-style: none; color: #787878"><dd style="margin: 0px; padding: 0px; border: 0px; list-style: none">(&lambda;f.f 3)(&lambda;x.x+2)与 (&lambda;x.x + 2) 3与3 + 2</dd></dl><p style="margin: 0px 0px 5px; padding: 0px; border: 0px; list-style: none; word-wrap: normal; word-break: normal; color: #787878">是等价的。有两个参数的函数可以通过lambda演算这么表达：一个单一参数的函数的返回值又是一个单一参数的函数（参见<a style="text-decoration: none; color: #99481f" href="javascript:if(confirm('http://zh.wikipedia.org/wiki/Currying  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://zh.wikipedia.org/wiki/Currying'" tppabs="http://zh.wikipedia.org/wiki/Currying" title="Currying">Currying</a>）。例如，函数f(x, y) = x - y可以写作&lambda;x.&lambda;y.x - y。下述三个表达式：</p><dl style="margin: 0px; padding: 0px; border: 0px; list-style: none; color: #787878"><dd style="margin: 0px; padding: 0px; border: 0px; list-style: none">(&lambda;x.&lambda;y.x - y) 7 2与 (&lambda;y.7 - y) 2与7 - 2</dd></dl><p style="margin: 0px 0px 5px; padding: 0px; border: 0px; list-style: none; word-wrap: normal; word-break: normal; color: #787878">也是等价的。然而这种lambda表达式之间的等价性无法找到一个通用的函数来判定。</p><p style="margin: 0px 0px 5px; padding: 0px; border: 0px; list-style: none; word-wrap: normal; word-break: normal; color: #787878">并非所有的lambda表达式都可以规约至上述那样的确定值，考虑</p><dl style="margin: 0px; padding: 0px; border: 0px; list-style: none; color: #787878"><dd style="margin: 0px; padding: 0px; border: 0px; list-style: none">(&lambda;x.x x)(&lambda;x.x x)</dd></dl><p style="margin: 0px 0px 5px; padding: 0px; border: 0px; list-style: none; word-wrap: normal; word-break: normal; color: #787878">或</p><dl style="margin: 0px; padding: 0px; border: 0px; list-style: none; color: #787878"><dd style="margin: 0px; padding: 0px; border: 0px; list-style: none">(&lambda;x.x x x)(&lambda;x.x x x)</dd></dl><p style="margin: 0px 0px 5px; padding: 0px; border: 0px; list-style: none; word-wrap: normal; word-break: normal; color: #787878">然后试图把第一个函数作用在它的参数上。 (&lambda;x.x x)被称为&omega;&nbsp;<a style="text-decoration: none; color: #99481f" href="javascript:if(confirm('http://zh.wikipedia.org/wiki/%E7%BB%84%E5%90%88%E5%AD%90%E9%80%BB%E8%BE%91  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://zh.wikipedia.org/wiki/%E7%BB%84%E5%90%88%E5%AD%90%E9%80%BB%E8%BE%91'" tppabs="http://zh.wikipedia.org/wiki/%E7%BB%84%E5%90%88%E5%AD%90%E9%80%BB%E8%BE%91" title="组合子逻辑">组合子</a>，((&lambda;x.x x)(&lambda;x.x x))被称为&Omega;，而((&lambda;x.x x x) (&lambda;x.x x x))被称为&Omega;<sub>2</sub>，以此类推。</p><p style="margin: 0px 0px 5px; padding: 0px; border: 0px; list-style: none; word-wrap: normal; word-break: normal; color: #787878">若仅形式化函数作用的概念而不允许lambda表达式，就得到了<a style="text-decoration: none; color: #99481f" href="javascript:if(confirm('http://zh.wikipedia.org/wiki/%E7%BB%84%E5%90%88%E5%AD%90%E9%80%BB%E8%BE%91  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://zh.wikipedia.org/wiki/%E7%BB%84%E5%90%88%E5%AD%90%E9%80%BB%E8%BE%91'" tppabs="http://zh.wikipedia.org/wiki/%E7%BB%84%E5%90%88%E5%AD%90%E9%80%BB%E8%BE%91" title="组合子逻辑">组合子逻辑</a>。</p><p style="margin: 0px 0px 5px; padding: 0px; border: 0px; list-style: none; word-wrap: normal; word-break: normal">&nbsp;&nbsp;形式化定义用巴科斯文法描述，我看不懂- -</p><p style="margin: 0px 0px 5px; padding: 0px; border: 0px; list-style: none; word-wrap: normal; word-break: normal">&nbsp;&nbsp;Lambda演算中有几个重要的法则，我的理解，它们分别成为了FP几个特性的理论基础：</p><h3 style="margin: 0px; padding: 0px; border: 0px; list-style: none"><span style="word-wrap: normal; word-break: normal; line-height: 21.0599994659424px">1，&alpha;-变换</span></h3><p style="margin: 0px 0px 5px; padding: 0px; border: 0px; list-style: none; word-wrap: normal; word-break: normal; color: #787878">Alpha-变换规则表达的是，被绑定变量的名称是不重要的。比如说&lambda;x.x和&lambda;y.y是同一个函数。尽管如此，这条规则并非像它看起来这么简单， 关于被绑定的变量能否由另一个替换有一系列的限制。</p>&nbsp;&nbsp;对应LISP中，函数参数本身的名字对函数没有任何影响，Lambda表达式的定义也很好的说明了这一点。比如以下两个函数是完全等价的。<br />&nbsp;&nbsp;(define (square x) (lambda(x) (* x x)))<br />&nbsp;&nbsp;(define (square y) (lambda(y) (* y y)))<br />&nbsp;&nbsp;另外，alpha变换涉及到变量的自由出现。即被一个函数绑定的变量不能与与另一个函数绑定的变量同时变换。例如&lambda;x.(&lambda;x.x) x这样的表达式将变换为&lambda;y.(&lambda;x.x) y。举个Scheme求平方和的例子~<br />&nbsp;&nbsp;(define (square-sum square x y)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(+ (square x) (square y)))<br />&nbsp;&nbsp;square函数在上面定义，其中有变量x，求平方和函数自身也有名为x的变量，但两者显然可以各自变换。并且这个例子用到了高阶函数（&beta;-归约和函数的curry化），下面马上说明。<br /><br /><h3 style="margin: 0px; padding: 0px; border: 0px; list-style: none"><span style="word-wrap: normal; word-break: normal; line-height: 21.0599994659424px">2，&beta;-归约</span></h3><p style="margin: 0px 0px 5px; padding: 0px; border: 0px; list-style: none; word-wrap: normal; word-break: normal; color: #787878">Beta-归约规则表达的是函数作用的概念。它陈述了若所有的E'的自由出现在E [V:=E']中仍然是自由的情况下，有</p><dl style="margin: 0px; padding: 0px; border: 0px; list-style: none; color: #787878"><dd style="margin: 0px; padding: 0px; border: 0px; list-style: none">((&lambda;V.E) E') == E [V:=E']</dd></dl><p style="margin: 0px 0px 5px; padding: 0px; border: 0px; list-style: none; word-wrap: normal; word-break: normal; color: #787878">成立。</p><p style="margin: 0px 0px 5px; padding: 0px; border: 0px; list-style: none; word-wrap: normal; word-break: normal; color: #787878">&nbsp;&nbsp;<span style="word-wrap: normal; word-break: normal; color: #000000">虽然还是巴科斯文法，不过这个大概能看明白。我觉得beta-变换是Lambda演算最重要的部分，也是函数式编程中最重要概念--<span style="word-wrap: normal; word-break: normal; font-weight: bold">高阶函数</span>的理论基础。由于Lambda演算中，函数可以接受的参数既可以是变量，也可以是另一个函数，因此可以对其进行归约，归约到只接受一个变量的函数（Lambda演算中只定义了一元函数）。举几个例子：</span></p><p style="margin: 0cm 0cm 0pt; padding: 0px; border: 0px; list-style: none; word-wrap: normal; word-break: normal; text-indent: 21pt"><u><span style="word-wrap: normal; word-break: normal; font-family: 宋体">(</span></u><u><span style="word-wrap: normal; word-break: normal; font-family: symbol">l</span></u><u><span style="word-wrap: normal; word-break: normal; font-family: 宋体">x.</span></u><u><span style="word-wrap: normal; word-break: normal; font-family: symbol">l</span></u><u><span style="word-wrap: normal; word-break: normal; font-family: 宋体">y.y x)(</span></u><u><span style="word-wrap: normal; word-break: normal; font-family: symbol">l</span></u><u><span style="word-wrap: normal; word-break: normal; font-family: 宋体">z.u)</span></u>&nbsp;<span style="word-wrap: normal; word-break: normal; font-family: symbol">&reg;</span>&nbsp;<span style="word-wrap: normal; word-break: normal; font-family: symbol">l</span><span style="word-wrap: normal; word-break: normal; font-family: 宋体">y.y(</span><span style="word-wrap: normal; word-break: normal; font-family: symbol">l</span><span style="word-wrap: normal; word-break: normal; font-family: 宋体">z.u)</span></p><p style="margin: 0cm 0cm 0pt; padding: 0px; border: 0px; list-style: none; word-wrap: normal; word-break: normal; text-indent: 21pt"><u><span style="word-wrap: normal; word-break: normal; font-family: 宋体">(</span></u><u><span style="word-wrap: normal; word-break: normal; font-family: symbol">l</span></u><u><span style="word-wrap: normal; word-break: normal; font-family: 宋体">x. x x)(</span></u><u><span style="word-wrap: normal; word-break: normal; font-family: symbol">l</span></u><u><span style="word-wrap: normal; word-break: normal; font-family: 宋体">z.u)</span></u>&nbsp;<span style="word-wrap: normal; word-break: normal; font-family: symbol">&reg;</span>&nbsp;<span style="word-wrap: normal; word-break: normal; font-family: 宋体">(</span><span style="word-wrap: normal; word-break: normal; font-family: symbol">l</span><span style="word-wrap: normal; word-break: normal; font-family: 宋体">z.u) (</span><span style="word-wrap: normal; word-break: normal; font-family: symbol">l</span><span style="word-wrap: normal; word-break: normal; font-family: 宋体">z.u)</span></p><p style="margin: 0cm 0cm 0pt; padding: 0px; border: 0px; list-style: none; word-wrap: normal; word-break: normal; text-indent: 21pt"><span style="word-wrap: normal; word-break: normal; font-family: 宋体">(</span><span style="word-wrap: normal; word-break: normal; font-family: symbol">l</span><span style="word-wrap: normal; word-break: normal; font-family: 宋体">y.y a)(<u>(</u></span><u><span style="word-wrap: normal; word-break: normal; font-family: symbol">l</span></u><u><span style="word-wrap: normal; word-break: normal; font-family: 宋体">x. x)(</span></u><u><span style="word-wrap: normal; word-break: normal; font-family: symbol">l</span></u><u><span style="word-wrap: normal; word-break: normal; font-family: 宋体">z.(</span></u><u><span style="word-wrap: normal; word-break: normal; font-family: symbol">l</span></u><u><span style="word-wrap: normal; word-break: normal; font-family: 宋体">u.u) z)</span></u><span style="word-wrap: normal; word-break: normal; font-family: 宋体">)</span>&nbsp;<span style="word-wrap: normal; word-break: normal; font-family: symbol">&reg;</span>&nbsp;<span style="word-wrap: normal; word-break: normal; font-family: 宋体">(</span><span style="word-wrap: normal; word-break: normal; font-family: symbol">l</span><span style="word-wrap: normal; word-break: normal; font-family: 宋体">y.y a)(</span><span style="word-wrap: normal; word-break: normal; font-family: symbol">l</span><span style="word-wrap: normal; word-break: normal; font-family: 宋体">z.(</span><span style="word-wrap: normal; word-break: normal; font-family: symbol">l</span><span style="word-wrap: normal; word-break: normal; font-family: 宋体">u.u) z)</span></p><p style="margin: 0cm 0cm 0pt; padding: 0px; border: 0px; list-style: none; word-wrap: normal; word-break: normal; text-indent: 21pt"><span style="word-wrap: normal; word-break: normal; font-family: 宋体">(</span><span style="word-wrap: normal; word-break: normal; font-family: symbol">l</span><span style="word-wrap: normal; word-break: normal; font-family: 宋体">y.y a)((</span><span style="word-wrap: normal; word-break: normal; font-family: symbol">l</span><span style="word-wrap: normal; word-break: normal; font-family: 宋体">x. x)(</span><span style="word-wrap: normal; word-break: normal; font-family: symbol">l</span><span style="word-wrap: normal; word-break: normal; font-family: 宋体">z.<u>(</u></span><u><span style="word-wrap: normal; word-break: normal; font-family: symbol">l</span></u><u><span style="word-wrap: normal; word-break: normal; font-family: 宋体">u.u) z</span></u><span style="word-wrap: normal; word-break: normal; font-family: 宋体">))</span>&nbsp;<span style="word-wrap: normal; word-break: normal; font-family: symbol">&reg;</span>&nbsp;<span style="word-wrap: normal; word-break: normal; font-family: 宋体">(</span><span style="word-wrap: normal; word-break: normal; font-family: symbol">l</span><span style="word-wrap: normal; word-break: normal; font-family: 宋体">y.y a)((</span><span style="word-wrap: normal; word-break: normal; font-family: symbol">l</span><span style="word-wrap: normal; word-break: normal; font-family: 宋体">x. x)(</span><span style="word-wrap: normal; word-break: normal; font-family: symbol">l</span><span style="word-wrap: normal; word-break: normal; font-family: 宋体">z. z))</span></p><span style="word-wrap: normal; word-break: normal; font-family: 宋体">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;<u><span style="word-wrap: normal; word-break: normal; font-family: 宋体">(</span></u><u><span style="word-wrap: normal; word-break: normal; font-family: symbol">l</span></u><u><span style="word-wrap: normal; word-break: normal; font-family: 宋体">y.y a)((</span></u><u><span style="word-wrap: normal; word-break: normal; font-family: symbol">l</span></u><u><span style="word-wrap: normal; word-break: normal; font-family: 宋体">x. x)(</span></u><u><span style="word-wrap: normal; word-break: normal; font-family: symbol">l</span></u><u><span style="word-wrap: normal; word-break: normal; font-family: 宋体">z.(</span></u><u><span style="word-wrap: normal; word-break: normal; font-family: symbol">l</span></u><u><span style="word-wrap: normal; word-break: normal; font-family: 宋体">u.u) z))</span></u>&nbsp;<span style="word-wrap: normal; word-break: normal; font-family: symbol">&reg;</span>&nbsp;<span style="word-wrap: normal; word-break: normal; font-family: 宋体">((</span><span style="word-wrap: normal; word-break: normal; font-family: symbol">l</span><span style="word-wrap: normal; word-break: normal; font-family: 宋体">x. x)(</span><span style="word-wrap: normal; word-break: normal; font-family: symbol">l</span><span style="word-wrap: normal; word-break: normal; font-family: 宋体">z.(</span><span style="word-wrap: normal; word-break: normal; font-family: symbol">l</span><span style="word-wrap: normal; word-break: normal; font-family: 宋体">u.u) z)) a<br /><br />这样的归约计算我到现在还不太适应- -，归约计算的每一步，就是代换，把最右边的函数/变量代入到次右边的参数，同时消去左边相应的</span>&lambda;，直到不能再归约为止。<br />&nbsp;&nbsp;显然，&beta;-归约自身结合Lambda演算的定义就可以自然而然地导出高阶函数的概念。所谓高阶函数，如果一个函数满足：<span style="word-wrap: normal; word-break: normal; color: #787878">1，接受一个或多个函数作为输入；2，输出一个函数。<span style="word-wrap: normal; word-break: normal; color: #000000">那么这就是一个高阶函数。数学中可以举个对应的例子：求导，如果这一过程作为一个函数，那么它就是一个高阶函数。它接受一个函数作为参数，输出了这个函数的导函数。在求平方和的例子中，square-sum接受了求平方函数square，输出了一个求平方和的函数，高阶函数的概念可以在这里体现。<br />&nbsp;&nbsp;另外，Lambda演算中只定义了一元函数，那么多元函数怎么办？<br />&nbsp;&nbsp;为了Lambda系统能更小，Church等人当初只定义了一元函数，并且利用&beta;-归约的定义，将多元函数化为只接受单一参数的函数，这就是<span style="word-wrap: normal; word-break: normal; font-weight: bold">函数的curry化</span>。</span></span><strong>curry化</strong>是把接受多个参数<a style="text-decoration: none; color: #99481f" href="javascript:if(confirm('http://zh.wikipedia.org/w/index.php?title=%E5%BD%A2%E5%BC%8F%E5%8F%82%E6%95%B0&action=edit&redlink=1  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://zh.wikipedia.org/w/index.php?title=%E5%BD%A2%E5%BC%8F%E5%8F%82%E6%95%B0&action=edit&redlink=1'" tppabs="http://zh.wikipedia.org/w/index.php?title=%E5%BD%A2%E5%BC%8F%E5%8F%82%E6%95%B0&action=edit&redlink=1" title="形式参数"></a>的函数变 换成接受一个单一参数（最初函数的第一个参数）的函数，并且返回接受余下的参数而且返回结果的新函数的技术。显然，curry化本身就是一个高阶函数，也用到了&beta;-归约。那么curry化如何演算呢？很简单<br />&nbsp;&nbsp;&lambda;xy.N ==&gt; &lambda;x.&lambda;y.N<br />&nbsp;&nbsp;这个文法有点抽象~~比如说有三元函数f(x,y,z)，由于只能接受一个参数，所以对它进行curry化：<br />&nbsp;&nbsp;1，接受x，并固定它，返回二元函数g(y,z)；<br />&nbsp;&nbsp;2，接受y，并固定它，返回一元函数h(z)，这样就把一个三元函数化为一元函数来处理。<br />&nbsp;&nbsp;&beta;-归约与curry化相互组合就能产生出各种复杂的过程，也产生了威力巨大的Lambda演算！<br /><br /><h3 style="margin: 0px; padding: 0px; border: 0px; list-style: none"><span style="word-wrap: normal; word-break: normal; line-height: 21.0599994659424px">3，&eta;-变换</span></h3><p style="margin: 0px 0px 5px; padding: 0px; border: 0px; list-style: none; word-wrap: normal; word-break: normal; color: #787878">&nbsp;&nbsp;前两条规则之后，还可以加入第三条规则，eta-变换，来形成一个新的等价关系。Eta-变换表达的是<a style="text-decoration: none; color: #99481f" href="javascript:if(confirm('http://zh.wikipedia.org/wiki/%E5%A4%96%E5%BB%B6%E6%80%A7  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://zh.wikipedia.org/wiki/%E5%A4%96%E5%BB%B6%E6%80%A7'" tppabs="http://zh.wikipedia.org/wiki/%E5%A4%96%E5%BB%B6%E6%80%A7" title="外延性">外延性</a>的概念，在这里外延性指的是，两个函数对于所有的参数得到的结果都一致，当且仅当它们是同一个函数。Eta-变换 可以令&lambda;x .f x和f相互转换，只要x不是f中的自由出现。下面说明了为何这条规则和外延性是等价的：</p><p style="margin: 0px 0px 5px; padding: 0px; border: 0px; list-style: none; word-wrap: normal; word-break: normal; color: #787878">若f与g外延地等价，即，f a == g a对所有的lambda表达式a成立，则当取a为在f中不是自由出现的变量x时，我们有f x == g x，因此&lambda;x .f x == &lambda;x .g x，由eta-变换f == g。所以只要eta-变换是有效的，会得到外延性也是有效的。</p><p style="margin: 0px 0px 5px; padding: 0px; border: 0px; list-style: none; word-wrap: normal; word-break: normal; color: #787878">相反地，若外延性是有效的，则由beta-归约，对所有的y有(&lambda;x .f x) y == f y，可得&lambda;x .f x == f，即eta-变换也是有效的。</p><p style="margin: 0px 0px 5px; padding: 0px; border: 0px; list-style: none; word-wrap: normal; word-break: normal; color: #787878">&nbsp;&nbsp;<span style="word-wrap: normal; word-break: normal; color: #000000">按照我的理解，eta-变换主要关于函数的等价性，这一点我在Scheme当中感触不深，倒是Python在函数之间可以直接赋值体现得更明显。</span>&nbsp;<br /></p></td><td style="margin: 0px; padding: 0px; font-size: 12px; font-family: Verdana, 宋体, sans-serif; line-height: 18px">&nbsp;</td></tr><tr><td style="margin: 0px; padding: 0px; font-size: 12px; font-family: Verdana, 宋体, sans-serif; line-height: 18px">&nbsp;</td><td style="margin: 0px; padding: 0px; font-size: 12px; font-family: Verdana, 宋体, sans-serif; line-height: 18px">&nbsp;</td></tr><tr><td style="margin: 0px; padding: 0px; font-size: 12px; font-family: Verdana, 宋体, sans-serif; line-height: 18px">&nbsp;<br />另外FP中的重要概念在Lambda演算中也有坚实的理论基础<br /><br /><span style="word-wrap: normal; word-break: normal; line-height: 27px; font-size: 18px"><span style="word-wrap: normal; word-break: normal; font-weight: bold">递归</span></span><br /></td><td style="margin: 0px; padding: 0px; font-size: 12px; font-family: Verdana, 宋体, sans-serif; line-height: 18px">&nbsp;</td></tr><tr><td style="margin: 0px; padding: 0px; font-size: 12px; font-family: Verdana, 宋体, sans-serif; line-height: 18px">&nbsp;&nbsp;由于纯函数式编程当中没有变量，所以没有循环，类似的过程全部由递归来实现，在Lambda演算中，不能定义包含自身的函数，因此递归通过<span style="word-wrap: normal; word-break: normal; font-weight: bold">不动点组合子</span>来实现。举个例子：<br /><p style="margin: 0px 0px 5px; padding: 0px; border: 0px; list-style: none; word-wrap: normal; word-break: normal">为了计算阶乘，可以开始于定义一个函数，这里叫g，它接受一个函数f作 为参数并返回接受n作为参数的另一个函数：</p><dl style="margin: 0px; padding: 0px; border: 0px; list-style: none"><dd style="margin: 0px; padding: 0px; border: 0px; list-style: none">g&nbsp;:= &lambda;f n.(if n = 0 then 1 else n&middot;f(n-1))。</dd></dl><p style="margin: 0px 0px 5px; padding: 0px; border: 0px; list-style: none; word-wrap: normal; word-break: normal">函数g返回要么常量1，要么函数f对n-1的n次应用。函数g可以用lambda演算来定义。</p><p style="margin: 0px 0px 5px; padding: 0px; border: 0px; list-style: none; word-wrap: normal; word-break: normal">但是，g自身仍然不是递归的；为了使用g来建立递归函数，作为参数传递给g的f函 数必须有特殊的性质。也就是说，作为参数传递的f函数必须展开为调用带有一个参数的函数g&nbsp;-- 并且这个参数必须再次f函数!</p>换句话说，f必须展开为g(f)。这个到g的调用将接着展开为上面的阶乘函数并计算下至另 一层递归。在这个展开中函数f将再次出现，并将被再次展开为g(f)并继续递归。这种函数，这裡的f = g(f)，叫做g的不动点。<br />&nbsp;&nbsp;在Lambda演算中，最常见最简单的不动点是Y组合子，它的定义为<br />&nbsp;&nbsp;Y = &lambda;g.(&lambda;x.g(x x))(&lambda;x.g(x x))<br />&nbsp;&nbsp;对于任意函数g，有Y g = g(Y g)。（我验算过了，这是真的- -~这是Curry发现的，您就是神）。对于阶乘函数，令n = 5<br /><dl style="margin: 0px; padding: 0px; border: 0px; list-style: none"><dd style="margin: 0px; padding: 0px; border: 0px; list-style: none">(&lambda;n.(if n = 0 then 1 else n&middot;((Y g)(n-1)))) 5</dd><dd style="margin: 0px; padding: 0px; border: 0px; list-style: none">if 5 = 0 then 1 else 5&middot;(g(Y g，5-1))</dd><dd style="margin: 0px; padding: 0px; border: 0px; list-style: none">5&middot;(g(Y g)4)</dd><dd style="margin: 0px; padding: 0px; border: 0px; list-style: none">5&middot;(&lambda;n.(if n = 0 then 1 else n&middot;((Y g)(n-1))) 4)</dd><dd style="margin: 0px; padding: 0px; border: 0px; list-style: none">5&middot;(if 4 = 0 then 1 else 4&middot;(g(Y g，4-1)))</dd><dd style="margin: 0px; padding: 0px; border: 0px; list-style: none">5&middot;(4&middot;(g(Y g)3))</dd><dd style="margin: 0px; padding: 0px; border: 0px; list-style: none">5&middot;(4&middot;(&lambda;n.(if n = 0 then 1 else n&middot;((Y g)(n-1))) 3))</dd><dd style="margin: 0px; padding: 0px; border: 0px; list-style: none">5&middot;(4&middot;(if 3 = 0 then 1 else 3&middot;(g(Y g，3-1))))</dd><dd style="margin: 0px; padding: 0px; border: 0px; list-style: none">5&middot;(4&middot;(3&middot;(g(Y g)2)))</dd><dt style="margin: 0px; padding: 0px; border: 0px; list-style: none">由于Y组合子的存在，函数反复调用自身，形成了递归。（神一般的存在。。。）</dt></dl>&nbsp;<br /><h2 style="margin: 0px; padding: 0px; border: 0px; list-style: none"><span style="word-wrap: normal; word-break: normal; line-height: 27px">逻辑与谓词</span></h2><p style="margin: 0px 0px 5px; padding: 0px; border: 0px; list-style: none; word-wrap: normal; word-break: normal">习惯上，下述两个定义（称为邱奇布尔值）被用作TRUE和FALSE这样的布尔值：</p><dl style="margin: 0px; padding: 0px; border: 0px; list-style: none"><dd style="margin: 0px; padding: 0px; border: 0px; list-style: none">TRUE&nbsp;:= &lambda;x y.x</dd><dd style="margin: 0px; padding: 0px; border: 0px; list-style: none">FALSE&nbsp;:= &lambda;x y.y<dl style="margin: 0px; padding: 0px; border: 0px; list-style: none"><dd style="margin: 0px; padding: 0px; border: 0px; list-style: none">(注意FALSE等价于前面定义邱奇数零)</dd></dl></dd></dl><p style="margin: 0px 0px 5px; padding: 0px; border: 0px; list-style: none; word-wrap: normal; word-break: normal">接着，通过这两个&lambda;-项，我们可以定义一些逻辑运算：</p><dl style="margin: 0px; padding: 0px; border: 0px; list-style: none"><dd style="margin: 0px; padding: 0px; border: 0px; list-style: none">AND&nbsp;:= &lambda;p q.p q FALSE</dd><dd style="margin: 0px; padding: 0px; border: 0px; list-style: none">OR&nbsp;:= &lambda;p q.p TRUE q</dd><dd style="margin: 0px; padding: 0px; border: 0px; list-style: none">NOT&nbsp;:= &lambda;p.p FALSE TRUE</dd><dd style="margin: 0px; padding: 0px; border: 0px; list-style: none">IFTHENELSE&nbsp;:= &lambda;p x y.p x y</dd></dl><p style="margin: 0px 0px 5px; padding: 0px; border: 0px; list-style: none; word-wrap: normal; word-break: normal">我们现在可以计算一些逻辑函数，比如：</p><dl style="margin: 0px; padding: 0px; border: 0px; list-style: none"><dd style="margin: 0px; padding: 0px; border: 0px; list-style: none">AND TRUE FALSE<dl style="margin: 0px; padding: 0px; border: 0px; list-style: none"><dd style="margin: 0px; padding: 0px; border: 0px; list-style: none">&equiv;(&lambda;p q.p q FALSE) TRUE FALSE &rarr;<sub>&beta;</sub>&nbsp;TRUE FALSE FALSE</dd><dd style="margin: 0px; padding: 0px; border: 0px; list-style: none">&equiv;(&lambda;x y.x) FALSE FALSE &rarr;<sub>&beta;</sub>&nbsp;FALSE</dd></dl></dd></dl><p style="margin: 0px 0px 5px; padding: 0px; border: 0px; list-style: none; word-wrap: normal; word-break: normal">我们见到AND TRUE FALSE等价于FALSE。</p><p style="margin: 0px 0px 5px; padding: 0px; border: 0px; list-style: none; word-wrap: normal; word-break: normal">&ldquo;谓词&rdquo;是指返回布尔值的函数。最基本的一个谓词是ISZERO，当且仅当其参数为零时返回真，否则返回假：</p><dl style="margin: 0px; padding: 0px; border: 0px; list-style: none"><dd style="margin: 0px; padding: 0px; border: 0px; list-style: none">ISZERO&nbsp;:= &lambda;n.n(&lambda;x.FALSE) TRUE</dd></dl><p style="margin: 0px 0px 5px; padding: 0px; border: 0px; list-style: none; word-wrap: normal; word-break: normal">运用谓词与上述TRUE和FALSE的定义，使得&quot;if-then-else&quot;这类语句很容易用lambda 演算写出。FP要以Lambda演算为基础,在这里谓词和逻辑语句也有了相应的Lambda定义.</p><h2 style="margin: 0px; padding: 0px; border: 0px; list-style: none"><span style="word-wrap: normal; word-break: normal; line-height: 27px">有序对</span></h2><p style="margin: 0px 0px 5px; padding: 0px; border: 0px; list-style: none; word-wrap: normal; word-break: normal">在逻辑谓词定义的基础上可以轻易的定义出有序对（2-元组）。</p><dl style="margin: 0px; padding: 0px; border: 0px; list-style: none"><dd style="margin: 0px; padding: 0px; border: 0px; list-style: none">CONS&nbsp;:= &lambda;x y.&lambda;p.IF p x y</dd><dd style="margin: 0px; padding: 0px; border: 0px; list-style: none">CAR&nbsp;:= &lambda;x.x TRUE</dd><dd style="margin: 0px; padding: 0px; border: 0px; list-style: none">CDR&nbsp;:= &lambda;x.x FALSE</dd></dl>对应Scheme程序：<br />(define (cons x y)<br />&nbsp;&nbsp;(define (dispatch m)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(if m x<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y)))<br />&nbsp;&nbsp;dispatch)<br /><br />(define (car z) (z #t))<br />(define (cdr z) (z #f))<br /><p style="margin: 0px 0px 5px; padding: 0px; border: 0px; list-style: none; word-wrap: normal; word-break: normal">链表数据类型可以定义为，要么是为空列表保留的值（e.g.FALSE），要么是CONS一个元素和一个更小的列表。这样,Lambda演算就定义出了LISP中唯一的数据结构.</p><p style="margin: 0px 0px 5px; padding: 0px; border: 0px; list-style: none; word-wrap: normal; word-break: normal"><br /></p><p style="margin: 0px 0px 5px; padding: 0px; border: 0px; list-style: none; word-wrap: normal; word-break: normal">&nbsp;&nbsp;LISP开发得非常早，当初完全是建立在Lambda演算的基础上，所以总结的这篇文章这里也看得到Lambda演算与LISP结合得非常紧密，LISP中的各个性质和元素在Lambda演算中都有对应的定义，当初接触Functional Programming的时候，完全没想到在它背后有这么一套简单，强大，完备的理论基础，LISP/Scheme也因此简单却强大。能够深入理解Lambda演算，对FP很有帮助。</p><p style="margin: 0px 0px 5px; padding: 0px; border: 0px; list-style: none; word-wrap: normal; word-break: normal">&nbsp;&nbsp;TT喜欢FP，TT要走的路还很长很长。。。。。</p></td></tr></tbody></table>
	</div>
	<div class="textbox-bottom">
	</div>
	<div class="tags" style="display: none"> 
	</div>
</div><div class="textbox">
	<div class="textbox-calendar">
	<span class="textbox-calendar-month">Aug</span>
	<span class="textbox-calendar-day">31</span>
	</div>
	<div class="textbox-title">
		<h4>
		<a href="read.php-7520.htm" tppabs="http://i.renjihe.com/blog/read.php?7520">DB主从一致性架构优化4种方法</a> <span id="starid7520"><img src="unstarred.gif" tppabs="http://i.renjihe.com/blog/template/default/images/others/unstarred.gif" alt="" title="未加星标" border="0"/></span> <img src="blank.gif" tppabs="http://i.renjihe.com/blog/images/weather/blank.gif" alt="不指定" title="不指定"/>
		</h4>
		<div class="textbox-label">
		<a href="view.php-go=user_1.htm" tppabs="http://i.renjihe.com/blog/view.php?go=user_1" target="_blank">renjihe1988</a> , 20:29 , <a href="index.php-go=category_2.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_2" title="查看分类： 软件">软件</a> &raquo; <a href="index.php-go=category_13.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_13" title="查看分类： web">web</a> , <a href="read.php-7520.htm#reply" tppabs="http://i.renjihe.com/blog/read.php?7520#reply" title="发表您的评论">评论(0)</a> , <a href='javascript: void(0);' title="查看引用地址" onclick='showhidediv("tb7520");'>引用(0)</a> , <a href="read.php-7520.htm" tppabs="http://i.renjihe.com/blog/read.php?7520">阅读(3)</a> , Via 本站原创 
		</div>
	</div>
	<div id="tb7520" style="display: none;" class="textbox-tburl"><strong>引用功能被关闭了。</strong></div>
	
	<div class="textbox-content">
	<p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">需求缘起</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">大部分互联网的业务都是&ldquo;读多写少&rdquo;的场景，数据库层面，读性能往往成为瓶颈。如下图：业界通常采用&ldquo;一主多从，读写分离，冗余多个读库&rdquo;的数据库架构来提升数据库的读性能。</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe" align="center"><img style="max-width: 96%; height: auto; vertical-align: middle; border: 0px none; margin: 0px auto 10px; display: block" class="alignCenter" src="3uUjaue.png!web" tppabs="http://img1.tuicool.com/3uUjaue.png!web" border="0" /></p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">这种架构的一个潜在缺点是，业务方有可能读取到并不是最新的旧数据：</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe" align="center"><img style="max-width: 96%; height: auto; vertical-align: middle; border: 0px none; margin: 0px auto 10px; display: block" class="alignCenter" src="RJbMna.png!web" tppabs="http://img1.tuicool.com/RJbMna.png!web" border="0" /></p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">（1）系统先对DB-master进行了一个写操作，写主库</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">（2）很短的时间内并发进行了一个读操作，读从库，此时主从同步没有完成，故读取到了一个旧数据</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">（3）主从同步完成</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">有没有办法解决或者缓解这类&ldquo;由于主从延时导致读取到旧数据&rdquo;的问题呢，这是本文要集中讨论的问题。</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">方案一（半同步复制）</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">不一致是因为写完成后，主从同步有一个时间差，假设是500ms，这个时间差有读请求落到从库上产生的。有没有办法做到，等主从同步完成之后，主库上的写请求再返回呢？答案是肯定的，就是大家常说的&ldquo;半同步复制&rdquo;semi-sync：</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe" align="center"><img style="max-width: 96%; height: auto; vertical-align: middle; border: 0px none; margin: 0px auto 10px; display: block" class="alignCenter" src="umEN7zR.png!web" tppabs="http://img0.tuicool.com/umEN7zR.png!web" border="0" /></p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">（1）系统先对DB-master进行了一个写操作，写主库</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">（2）等主从同步完成，写主库的请求才返回</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">（3）读从库，读到最新的数据（如果读请求先完成，写请求后完成，读取到的是&ldquo;当时&rdquo;最新的数据）</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">方案优点：利用数据库原生功能，比较简单</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">方案缺点：主库的写请求时延会增长，吞吐量会降低</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">方案二（强制读主库）</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">如果不使用&ldquo;增加从库&rdquo;的方式来增加提升系统的读性能，完全可以读写都落到主库，这样就不会出现不一致了：</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe" align="center"><img style="max-width: 96%; height: auto; vertical-align: middle; border: 0px none; margin: 0px auto 10px; display: block" class="alignCenter" src="umEN7zR.png!web" tppabs="http://img0.tuicool.com/umEN7zR.png!web" border="0" /></p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">方案优点：&ldquo;一致性&rdquo;上不需要进行系统改造</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">方案缺点：只能通过cache来提升系统的读性能，这里要进行系统改造</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">方案三（数据库中间件）</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">如果有了数据库中间件，所有的数据库请求都走中间件，这个主从不一致的问题可以这么解决：</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe" align="center"><img style="max-width: 96%; height: auto; vertical-align: middle; border: 0px none; margin: 0px auto 10px; display: block" class="alignCenter" src="ne6JFf7.png!web" tppabs="http://img1.tuicool.com/ne6JFf7.png!web" border="0" /></p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">（1）所有的读写都走数据库中间件，通常情况下，写请求路由到主库，读请求路由到从库</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">（2）记录所有路由到写库的key，在经验主从同步时间窗口内（假设是500ms），如果有读请求访问中间件，此时有可能从库还是旧数据，就把这个key上的读请求路由到主库</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">（3）经验主从同步时间过完后，对应key的读请求继续路由到从库</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">方案优点：能保证绝对一致</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">方案缺点：数据库中间件的成本比较高</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">方案四（缓存记录写key法）</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">既然数据库中间件的成本比较高，有没有更低成本的方案来记录某一个库的某一个key上发生了写请求呢？很容易想到使用缓存，当写请求发生的时候：</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe" align="center"><img style="max-width: 96%; height: auto; vertical-align: middle; border: 0px none; margin: 0px auto 10px; display: block" class="alignCenter" src="IrYBVjq.png!web" tppabs="http://img0.tuicool.com/IrYBVjq.png!web" border="0" /></p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">（1）将某个库上的某个key要发生写操作，记录在cache里，并设置&ldquo;经验主从同步时间&rdquo;的cache超时时间，例如500ms</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">（2）修改数据库</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">而读请求发生的时候：</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe" align="center"><img style="max-width: 96%; height: auto; vertical-align: middle; border: 0px none; margin: 0px auto 10px; display: block" class="alignCenter" src="iEZZJn6.png!web" tppabs="http://img1.tuicool.com/iEZZJn6.png!web" border="0" /></p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">（1）先到cache里查看，对应库的对应key有没有相关数据</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">（2）如果cache hit，有相关数据，说明这个key上刚发生过写操作，此时需要将请求路由到主库读最新的数据</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">（3）如果cache miss，说明这个key上近期没有发生过写操作，此时将请求路由到从库，继续读写分离</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">方案优点：相对数据库中间件，成本较低</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">方案缺点：为了保证&ldquo;一致性&rdquo;，引入了一个cache组件，并且读写数据库时都多了一步cache操作</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">总结</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">为了解决主从数据库读取旧数据的问题，常用的方案有四种：</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">（1）半同步复制</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">（2）强制读主</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">（3）数据库中间件</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">（4）缓存记录写key</p>
	</div>
	<div class="textbox-bottom">
	</div>
	<div class="tags" style="display: none"> 
	</div>
</div><div class="textbox">
	<div class="textbox-calendar">
	<span class="textbox-calendar-month">Aug</span>
	<span class="textbox-calendar-day">31</span>
	</div>
	<div class="textbox-title">
		<h4>
		<a href="read.php-7519.htm" tppabs="http://i.renjihe.com/blog/read.php?7519">DB主从一致性的几种解决方法</a> <span id="starid7519"><img src="unstarred.gif" tppabs="http://i.renjihe.com/blog/template/default/images/others/unstarred.gif" alt="" title="未加星标" border="0"/></span> <img src="blank.gif" tppabs="http://i.renjihe.com/blog/images/weather/blank.gif" alt="不指定" title="不指定"/>
		</h4>
		<div class="textbox-label">
		<a href="view.php-go=user_1.htm" tppabs="http://i.renjihe.com/blog/view.php?go=user_1" target="_blank">renjihe1988</a> , 20:29 , <a href="index.php-go=category_2.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_2" title="查看分类： 软件">软件</a> &raquo; <a href="index.php-go=category_13.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_13" title="查看分类： web">web</a> , <a href="read.php-7519.htm#reply" tppabs="http://i.renjihe.com/blog/read.php?7519#reply" title="发表您的评论">评论(0)</a> , <a href='javascript: void(0);' title="查看引用地址" onclick='showhidediv("tb7519");'>引用(0)</a> , <a href="read.php-7519.htm" tppabs="http://i.renjihe.com/blog/read.php?7519">阅读(3)</a> , Via 本站原创 
		</div>
	</div>
	<div id="tb7519" style="display: none;" class="textbox-tburl"><strong>引用功能被关闭了。</strong></div>
	
	<div class="textbox-content">
	<div class="skin_center_t" style="box-sizing: border-box; margin: 0px; padding: 0px; border: 0px; outline: 0px; font-size: 14px; vertical-align: baseline; color: #999999; font-family: Arial, sans-serif; line-height: 22px; background: transparent"><div class="skin_list" style="box-sizing: border-box; margin: 0px; padding: 0px 20px 0px 0px; border: 0px; outline: 0px; vertical-align: baseline; max-width: 1200px; background: transparent"><dl class="list_c clearfix detail_list" style="box-sizing: border-box; margin: 0px; padding: 0px 0px 5px; font-family: 'Microsoft YaHei'; list-style: none; border: 0px; outline: 0px; vertical-align: baseline; position: relative; background: transparent"><dd style="box-sizing: border-box; line-height: 1.42857; margin: 0px 0px 0px 95px; padding: 0px; list-style: none; border: 0px; outline: 0px; vertical-align: baseline; max-width: 1000px; background: transparent"><div id="article_content" class="skin_detail" style="box-sizing: border-box; margin: 0px; padding: 20px 0px; border: 0px; outline: 0px; vertical-align: baseline; word-break: break-word; background: transparent"><div class="markdown_views" style="box-sizing: border-box; margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; font-family: 'microsoft yahei'; background: transparent"><h1 style="box-sizing: border-box; margin: 0.8em 0px; font-size: 28px; font-family: 'Microsoft YaHei'; font-weight: 100; line-height: 30px; color: #666666; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background: transparent">DB主从一致性的几种解决方法</h1><h2 style="box-sizing: border-box; font-family: 'Microsoft YaHei'; font-weight: 100; line-height: 1.1; color: #666666; margin: 0.8em 0px; font-size: 22px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background: transparent">起源</h2><p style="box-sizing: border-box; margin: 0px 0px 1.1em; padding: 0px; font-family: 'Microsoft YaHei'; border: 0px; outline: 0px; font-size: 15px; vertical-align: baseline; color: #666666; line-height: 26px; background: transparent">现在基本所有的程序中都会用到数据库，而数据库其实就是对所有业务逻辑处理结果的保存，所以不论在什么情况下数据的丢失都不被允许的，最坏的情况也要最小化数据的丢失程度，所以一般情况下，数据源都会至少配有两个节点，一个业务处理使用的节点，一个甚至多个从节点，这些从节点就是我们常说的冷备，业务处理节点（主节点）和备份节点一定的时间间隔内进行数据同步，从而来保证当一个数据源坏掉之后，数据也不会丢失，或着丢失很少（主要看同步的时间间隔）。但是为了提高资源的使用效率，所以有人就提出了，可不可以让冷备也被利用起来，替主节点分担部分压力，所以就提出了读写分离的方案。</p><h2 style="box-sizing: border-box; font-family: 'Microsoft YaHei'; font-weight: 100; line-height: 1.1; color: #666666; margin: 0.8em 0px; font-size: 22px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background: transparent">读写分离</h2><p style="box-sizing: border-box; margin: 0px 0px 1.1em; padding: 0px; font-family: 'Microsoft YaHei'; border: 0px; outline: 0px; font-size: 15px; vertical-align: baseline; color: #666666; line-height: 26px; background: transparent"><img style="box-sizing: border-box; border: 0px; vertical-align: middle; outline: 0px; margin: 0px; padding: 0px; max-width: 100%; background: transparent" src="20160519201649725.jpg" tppabs="http://img.blog.csdn.net/20160519201649725" border="0" alt="这里写图片描述" />&nbsp;<br />读写分离提高了资源的利用效率的同时也引出了一个问题，就是由于延时（网络传输，操作）而引起的数据库主从不一致的问题，对于这个问题，给一下集中解决方案。</p><hr style="box-sizing: border-box; height: 1px; margin: 2em 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-top-style: solid; border-top-color: rgba(128, 128, 128, 0.0980392); width: 999.188px; background-color: #eeeeee" /><h3 style="box-sizing: border-box; font-family: 'Microsoft YaHei'; font-weight: 100; line-height: 1.1; color: inherit; margin: 0.8em 0px; font-size: 14px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background: transparent">1-半同步复制</h3><p style="box-sizing: border-box; margin: 0px 0px 1.1em; padding: 0px; font-family: 'Microsoft YaHei'; border: 0px; outline: 0px; font-size: 15px; vertical-align: baseline; color: #666666; line-height: 26px; background: transparent">主从不一致的原因是延时引起的,所以要消除这个延时的影响，可以从主库进行CUD操作时进行规避，办法就是等主从同步完成之后，主库上的写请求再返回，就是大家常说的&ldquo;半同步复制&rdquo;semi-sync。</p><div class="sequence-diagram" style="box-sizing: border-box; margin: 0px 0px 1.1em; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; text-align: center; background: transparent">请求请求主库主库从库从库CUD操作开始同步同步完成CUD操作完成</div><ul style="box-sizing: border-box; margin: 0px 0px 22px; padding: 0px; font-family: 'Microsoft YaHei'; list-style: square inside; border: 0px; outline: 0px; vertical-align: baseline; background: transparent"><li style="box-sizing: border-box; margin: 0px; padding: 0px; list-style: none; border: 0px; outline: 0px; vertical-align: baseline; background: transparent"><strong style="box-sizing: border-box; margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background: transparent">方案优点：利用数据库原生功能，比较简单</strong></li><li style="box-sizing: border-box; margin: 0px; padding: 0px; list-style: none; border: 0px; outline: 0px; vertical-align: baseline; background: transparent"><strong style="box-sizing: border-box; margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background: transparent">方案缺点：主库的写请求时延会增长，吞吐量会降低</strong></li></ul><hr style="box-sizing: border-box; height: 1px; margin: 2em 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-top-style: solid; border-top-color: rgba(128, 128, 128, 0.0980392); width: 999.188px; background-color: #eeeeee" /><h3 style="box-sizing: border-box; font-family: 'Microsoft YaHei'; font-weight: 100; line-height: 1.1; color: inherit; margin: 0.8em 0px; font-size: 14px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background: transparent">2-数据库中间件</h3><h4 style="box-sizing: border-box; font-family: 'Microsoft YaHei'; font-weight: 100; line-height: 1.1; color: inherit; margin: 0.8em 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background: transparent">CUD操作</h4><div class="sequence-diagram" style="box-sizing: border-box; margin: 0px 0px 1.1em; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; text-align: center; background: transparent">请求请求中间件中间件主库主库从库从库CUD操作路由同步</div><h4 style="box-sizing: border-box; font-family: 'Microsoft YaHei'; font-weight: 100; line-height: 1.1; color: inherit; margin: 0.8em 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background: transparent">R操作</h4><div class="sequence-diagram" style="box-sizing: border-box; margin: 0px 0px 1.1em; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; text-align: center; background: transparent">请求请求中间件中间件主库主库从库从库R操作同步未完成同步完成</div><ul style="box-sizing: border-box; margin: 0px 0px 22px; padding: 0px; font-family: 'Microsoft YaHei'; list-style: square inside; border: 0px; outline: 0px; vertical-align: baseline; background: transparent"><li style="box-sizing: border-box; margin: 0px; padding: 0px; list-style: none; border: 0px; outline: 0px; vertical-align: baseline; background: transparent"><strong style="box-sizing: border-box; margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background: transparent">方案优点：能保证绝对一致</strong></li><li style="box-sizing: border-box; margin: 0px; padding: 0px; list-style: none; border: 0px; outline: 0px; vertical-align: baseline; background: transparent"><strong style="box-sizing: border-box; margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background: transparent">方案缺点：数据库中间件的成本比较高</strong></li></ul><hr style="box-sizing: border-box; height: 1px; margin: 2em 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-top-style: solid; border-top-color: rgba(128, 128, 128, 0.0980392); width: 999.188px; background-color: #eeeeee" /><h3 style="box-sizing: border-box; font-family: 'Microsoft YaHei'; font-weight: 100; line-height: 1.1; color: inherit; margin: 0.8em 0px; font-size: 14px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background: transparent">3-缓存记录写key法</h3><h4 style="box-sizing: border-box; font-family: 'Microsoft YaHei'; font-weight: 100; line-height: 1.1; color: inherit; margin: 0.8em 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background: transparent">CUD操作</h4><p style="box-sizing: border-box; margin: 0px 0px 1.1em; padding: 0px; font-family: 'Microsoft YaHei'; border: 0px; outline: 0px; font-size: 15px; vertical-align: baseline; color: #666666; line-height: 26px; background: transparent">（1）将某个库上的某个key要发生写操作，记录在cache里，并设置&ldquo;经验主从同步时间&rdquo;的cache超时时间，例如500ms&nbsp;<br />（2）修改数据库</p><h4 style="box-sizing: border-box; font-family: 'Microsoft YaHei'; font-weight: 100; line-height: 1.1; color: inherit; margin: 0.8em 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background: transparent">R操作</h4><p style="box-sizing: border-box; margin: 0px 0px 1.1em; padding: 0px; font-family: 'Microsoft YaHei'; border: 0px; outline: 0px; font-size: 15px; vertical-align: baseline; color: #666666; line-height: 26px; background: transparent">（1）先到cache里查看，对应库的对应key有没有相关数据&nbsp;<br />（2）如果cache hit，有相关数据，说明这个key上刚发生过写操作，此时需要将请求路由到主库读最新的数据&nbsp;<br />（3）如果cache miss，说明这个key上近期没有发生过写操作，此时将请求路由到从库，继续读写分离</p><ul style="box-sizing: border-box; margin: 0px 0px 22px; padding: 0px; font-family: 'Microsoft YaHei'; list-style: square inside; border: 0px; outline: 0px; vertical-align: baseline; background: transparent"><li style="box-sizing: border-box; margin: 0px; padding: 0px; list-style: none; border: 0px; outline: 0px; vertical-align: baseline; background: transparent"><strong style="box-sizing: border-box; margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background: transparent">方案优点：相对数据库中间件，成本较低</strong></li><li style="box-sizing: border-box; margin: 0px; padding: 0px; list-style: none; border: 0px; outline: 0px; vertical-align: baseline; background: transparent"><strong style="box-sizing: border-box; margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background: transparent">方案缺点：方案缺点：为了保证&ldquo;一致性&rdquo;，引入了一个cache组件，并且读写数据库时都多了一步cache操作</strong></li></ul></div></div></dd></dl></div><div class="skin_nav" style="box-sizing: border-box; margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; position: fixed; right: 275px; top: 70px; background: transparent"><div class="skin_edit" style="box-sizing: border-box; margin: 0px 0px 10px; padding: 0px; border: 2px solid #2f2f2f; outline: 0px; vertical-align: baseline; width: 28px; height: 28px; line-height: 24px; text-align: center; cursor: pointer; position: relative; background-image: initial; background-attachment: initial; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial"></div></div><div class="rssFix" style="box-sizing: border-box; margin: 0px; padding: 0px; border: 2px solid #2f2f2f; outline: 0px; vertical-align: baseline; width: 28px; height: 28px; text-align: center; line-height: 24px; position: fixed; bottom: 70px; right: 275px; background-image: initial; background-attachment: initial; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial"><a style="box-sizing: border-box; color: #444444; text-decoration: none; margin: 0px; padding: 0px; font-family: 'Microsoft YaHei'; outline: none; background: transparent" href="javascript:if(confirm('http://blog.csdn.net/xidiancyp/rss/list  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://blog.csdn.net/xidiancyp/rss/list'" tppabs="http://blog.csdn.net/xidiancyp/rss/list" class="column"></a></div></div><div class="detail_b" style="box-sizing: border-box; margin: 0px 0px 0px 95px; padding: 0px 60px 0px 0px; border: 0px; outline: 0px; font-size: 14px; vertical-align: baseline; max-width: 1250px; color: #999999; font-family: Arial, sans-serif; line-height: 22px; background: transparent"><p style="box-sizing: border-box; margin: 0px 0px 22px; padding: 0px; font-family: 'Microsoft YaHei'; border: 0px; outline: 0px; vertical-align: baseline; color: #e96d5b; background: transparent" class="reprint_copy">版权声明：本文为博主原创文章，未经博主允许不得转载。</p></div>
	</div>
	<div class="textbox-bottom">
	</div>
	<div class="tags" style="display: none"> 
	</div>
</div><div class="textbox">
	<div class="textbox-calendar">
	<span class="textbox-calendar-month">Aug</span>
	<span class="textbox-calendar-day">30</span>
	</div>
	<div class="textbox-title">
		<h4>
		<a href="read.php-7518.htm" tppabs="http://i.renjihe.com/blog/read.php?7518">抽象：程序员必备的能力</a> <span id="starid7518"><img src="unstarred.gif" tppabs="http://i.renjihe.com/blog/template/default/images/others/unstarred.gif" alt="" title="未加星标" border="0"/></span> <img src="blank.gif" tppabs="http://i.renjihe.com/blog/images/weather/blank.gif" alt="不指定" title="不指定"/>
		</h4>
		<div class="textbox-label">
		<a href="view.php-go=user_1.htm" tppabs="http://i.renjihe.com/blog/view.php?go=user_1" target="_blank">renjihe1988</a> , 21:15 , <a href="index.php-go=category_76.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_76" title="查看分类： 置顶">置顶</a> , <a href="read.php-7518.htm#reply" tppabs="http://i.renjihe.com/blog/read.php?7518#reply" title="发表您的评论">评论(0)</a> , <a href='javascript: void(0);' title="查看引用地址" onclick='showhidediv("tb7518");'>引用(0)</a> , <a href="read.php-7518.htm" tppabs="http://i.renjihe.com/blog/read.php?7518">阅读(3)</a> , Via 本站原创 
		</div>
	</div>
	<div id="tb7518" style="display: none;" class="textbox-tburl"><strong>引用功能被关闭了。</strong></div>
	
	<div class="textbox-content">
	<p style="margin: 5px 0px; padding: 0px; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; color: #232323; line-height: 28px; background-color: #faffff">2015年大热的动画片《动脑特工队》中描述了这么一个场景， 冰棒带领乐乐和忧忧抄近路去乘坐思维列车，所谓的&ldquo;近路&rdquo;就是穿过抽象思维的房间，在这个房间里， 他们先是变成了变成3D的块，就像计算机图形学里展示的那样：</p><p style="margin: 5px 0px; padding: 0px; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; color: #232323; line-height: 28px; text-align: center; background-color: #faffff"><img style="margin: 0px; padding: 0px; font-size: 12px; border: none; max-width: 620px" src="1-20160702131650312-1378132761.jpg" tppabs="http://images2015.cnblogs.com/kb/1/201607/1-20160702131650312-1378132761.jpg" border="0" /></p><p style="margin: 5px 0px; padding: 0px; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; color: #232323; line-height: 28px; text-align: center; background-color: #faffff"><img style="margin: 0px; padding: 0px; font-size: 12px; border: none; max-width: 620px" src="1-20160702131734546-1114060500.jpg" tppabs="http://images2015.cnblogs.com/kb/1/201607/1-20160702131734546-1114060500.jpg" border="0" /></p><p style="margin: 5px 0px; padding: 0px; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; color: #232323; line-height: 28px; background-color: #faffff">　　然后变成平面的图形</p><p style="margin: 5px 0px; padding: 0px; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; color: #232323; line-height: 28px; text-align: center; background-color: #faffff"><img style="margin: 0px; padding: 0px; font-size: 12px; border: none; max-width: 620px" src="1-20160702131759437-822846547.jpg" tppabs="http://images2015.cnblogs.com/kb/1/201607/1-20160702131759437-822846547.jpg" border="0" /></p><p style="margin: 5px 0px; padding: 0px; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; color: #232323; line-height: 28px; background-color: #faffff">　　最后只剩下一些线条了 ！</p><p style="margin: 5px 0px; padding: 0px; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; color: #232323; line-height: 28px; text-align: center; background-color: #faffff"><img style="margin: 0px; padding: 0px; font-size: 12px; border: none; max-width: 620px" src="1-20160702131831656-122919176.jpg" tppabs="http://images2015.cnblogs.com/kb/1/201607/1-20160702131831656-122919176.jpg" border="0" /></p><p style="margin: 5px 0px; padding: 0px; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; color: #232323; line-height: 28px; background-color: #faffff"><br />　　真是非常生动的展示了人类做抽象活动的过程。</p><p style="margin: 5px 0px; padding: 0px; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; color: #232323; line-height: 28px; background-color: #faffff">　　在软件业，抽象能力的重要性怎么说都不为过，因为软件开发是一个高度复杂的智力活动，程序员经常需要面对、处理异常复杂的业务和逻辑，如果你不具备强大的抽象能力，无法把具体变成概念，进而驾驭概念进行思考， 你就很难降低问题的复杂度，从而陷入泥潭，无法自拔。无论你学会了多么强大的程序语言，你的编程能力也很难有质的提高。</p><p style="margin: 5px 0px; padding: 0px; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; color: #232323; line-height: 28px; background-color: #faffff">　　当然抽象不仅仅是软件开发的独有概念，在别的领域可以看到更多。在自然科学领域，抽象的例子更多，开普勒定律和万有引力就是很典型的例子。</p><p style="margin: 5px 0px; padding: 0px; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; color: #232323; line-height: 28px; background-color: #faffff">　　在16世纪很多人开始相信哥白尼提出的日心说，但一直搞不清楚围绕太阳的行星到底是怎么运动的，轨道是什么样子，著名天文学家开普勒仔细的研究了他的老师&mdash;&mdash;杰出的观测家&mdash;&mdash;第谷留下的大量天文观测数据以后， 提炼出了著名的开普勒三定律， 第一次给出了天体运行规律的解释：</p><p style="margin: 5px 0px; padding: 0px; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; color: #232323; line-height: 28px; background-color: #faffff">　　1. 所有行星分别是在大小不同的椭圆轨道上运行</p><p style="margin: 5px 0px; padding: 0px; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; color: #232323; line-height: 28px; background-color: #faffff">　　2. 在同样的时间里行星向径在轨道平面上所扫过的面积相等</p><p style="margin: 5px 0px; padding: 0px; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; color: #232323; line-height: 28px; background-color: #faffff">　　3. 行星公转周期的平方与它同太阳距离的立方成正比</p><p style="margin: 5px 0px; padding: 0px; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; color: #232323; line-height: 28px; text-align: center; background-color: #faffff"><img style="margin: 0px; padding: 0px; font-size: 12px; border: none; max-width: 620px" src="1-20160702132023218-1737809406.jpg" tppabs="http://images2015.cnblogs.com/kb/1/201607/1-20160702132023218-1737809406.jpg" border="0" /></p><p style="margin: 5px 0px; padding: 0px; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; color: #232323; line-height: 28px; background-color: #faffff">　　开普勒三定律从大量的数据中提炼出数学规律， 无疑是非常伟大的发现和抽象， 但这不是最终本质，当然也不是最终的抽象。</p><p style="margin: 5px 0px; padding: 0px; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; color: #232323; line-height: 28px; background-color: #faffff">　　行星运动的本质是万有引力定律。</p><p style="margin: 5px 0px; padding: 0px; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; color: #232323; line-height: 28px; background-color: #faffff">　　相比于开普勒定律，天才的牛顿所做的抽象向前迈进了一大步，万有引力几乎覆盖了所有大质量物体之间互相吸引和运动的规律， 即简单又优美， 配合牛顿（和莱布尼茨）发明的微积分，可以很容易推导开普勒定律。</p><p style="margin: 5px 0px; padding: 0px; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; color: #232323; line-height: 28px; text-align: center; background-color: #faffff"><img style="margin: 0px; padding: 0px; font-size: 12px; border: none; max-width: 620px" src="1-20160702132112640-1517045020.png" tppabs="http://images2015.cnblogs.com/kb/1/201607/1-20160702132112640-1517045020.png" border="0" /></p><p style="margin: 5px 0px; padding: 0px; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; color: #232323; line-height: 28px; background-color: #faffff">　　如果再加上牛顿力学三定律，尤其是F=ma，整个经典物理学的架子就建起来了，后人所有的工作只是在这座大厦上进行一些装修工作，直到爱因斯坦相对论的出现，才建立一座更宏伟的大厦。</p><p style="margin: 5px 0px; padding: 0px; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; color: #232323; line-height: 28px; background-color: #faffff">　　据说爱因斯坦在评价一个研究时，会用美和丑来作为判断标准，有人拿研究成果让爱因斯坦看， 爱因斯坦不说成果的好与坏，反而说&ldquo;这东西多丑陋啊&rdquo;， &ldquo;这东西真漂亮&rdquo;。</p><p style="margin: 5px 0px; padding: 0px; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; color: #232323; line-height: 28px; background-color: #faffff">　　其实一个抽象的东西形式优美，结构简单，很有可能是正确的，很可能抓住了事物的本质。相反如果连形式都丑陋不堪，十有八九不是好的成果。 以此作为标准，万有引力定律无疑是漂亮的，正确的，当然爱因斯坦的E=mc2更加漂亮和简单。</p><p style="margin: 5px 0px; padding: 0px; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; color: #232323; line-height: 28px; background-color: #faffff">　　<strong style="margin: 0px; padding: 0px; color: #333333">抽象的例子在软件业更是数不胜数：</strong></p><p style="margin: 5px 0px; padding: 0px; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; color: #232323; line-height: 28px; background-color: #faffff">　　文件是对I/O的抽象；虚拟存储器是对物理存储器的抽象；进程是对一个正在运行的程序的抽象；我们再增加一个新的抽象：虚拟机， 他提供了对整个计算机（包括操作系统，处理器，程序）的抽象。</p><p style="margin: 5px 0px; padding: 0px; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; color: #232323; line-height: 28px; background-color: #faffff">　　Andorid把一个移动应用程序抽象成Activity , Intent, Service, Provider......稍微注意一下就会发现：<strong style="margin: 0px; padding: 0px; color: #333333">抽象层次越高，接口的语意就越模糊，适用的范围就越广</strong>，到最后就会变成数学模型或者概念。</p><p style="margin: 5px 0px; padding: 0px; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; color: #232323; line-height: 28px; background-color: #faffff">　　<strong style="margin: 0px; padding: 0px; color: #333333">数学模型和算法</strong></p><p style="margin: 5px 0px; padding: 0px; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; color: #232323; line-height: 28px; background-color: #faffff">　　我认为把纷杂的事物抽象到数学层面是最高的抽象，也许会有人会说哲学层面才是:-) ，但到数学层面已经非常难了。尤其是重大的科学发现，身后必然有数学的影子。</p><p style="margin: 5px 0px; padding: 0px; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; color: #232323; line-height: 28px; background-color: #faffff">　　牛顿当年为了描述天体的轨道和运动，特别创立了新的数学表示： 微积分。麦克斯韦使用一组方程对电场和磁场行为进行描述。当年爱因斯坦脑海中已经有了广义相对论，但苦于找不到合适的数学形式来描述，他特别花了几年的时间来学习非欧几何和张量分析，最后才得以成功。海森堡用矩阵理论来解释量子力学。。。程序员在开发过程中， 也许能把一个实际的业务问题抽象成数学模型，或者抽象成特定的算法，这样会让程序实现变得非常简单和有趣。</p><p style="margin: 5px 0px; padding: 0px; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; color: #232323; line-height: 28px; background-color: #faffff">　　我在之前的公司有幸遇到过一次，把针对税务领域的一个Credit, Debit等概念抽象为在一个二维坐标下点的运动， 问题一下子简化了很多，实现简单，并且非常安全可靠。</p><p style="margin: 5px 0px; padding: 0px; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; color: #232323; line-height: 28px; background-color: #faffff">　　<strong style="margin: 0px; padding: 0px; color: #333333">正交的概念</strong></p><p style="margin: 5px 0px; padding: 0px; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; color: #232323; line-height: 28px; background-color: #faffff">　　但是抽象成数学模型和算法通常是可遇而不可求的， 这种情况下，我们需要退而求其次，试图抽象成若干个正交的概念，来降低复杂度。&ldquo;正交&rdquo;在数学上指的是线性无关，最常见的例子就是坐标系下的x轴和y轴，对于一个点来讲，它的x值的变化不会影响到y，y值得变化不会影响到x ，即x和y是正交的。</p><p style="margin: 5px 0px; padding: 0px; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; color: #232323; line-height: 28px; background-color: #faffff">　　正交的威力在于互不影响，扩展方便，单用一个坐标轴可以表示一个直线上的所有的点， 再加一个y轴就能表示平面上的所有的点， 再加一个z轴，3维空间中的所有点都能表示出来了！</p><p style="margin: 5px 0px; padding: 0px; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; color: #232323; line-height: 28px; background-color: #faffff">　　我们人类的大脑在思考问题的时候是有容量限制的， 难以同时驾驭太多复杂的概念， 如果我们的软件系统也能做成x,y,z坐标这样，就带来了无与伦比的好处，你在处理x轴相关的事情时，不用考虑其他的y和z相关的东西，因为你知道他们不会受到影响， 这样问题的复杂度就从3维一下子下降到1维！更容易把握了。如果单单x 轴仍然很复杂，你要做的就是再次分解成更小的概念，保证正交即可。</p><p style="margin: 5px 0px; padding: 0px; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; color: #232323; line-height: 28px; background-color: #faffff">　　<strong style="margin: 0px; padding: 0px; color: #333333">接口</strong></p><p style="margin: 5px 0px; padding: 0px; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; color: #232323; line-height: 28px; background-color: #faffff">　　如果你说了，我的整个系统还没法抽象成正交的概念， 那只好再退一步，在局部使用接口。</p><p style="margin: 5px 0px; padding: 0px; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; color: #232323; line-height: 28px; background-color: #faffff">　　在著名的《设计模式》一书中，其实在反复强调一点: 发现变化并且封装变化，针对接口编程而不是实现编程。 很多人看书是只关注具体的模式，而忽略了模式的本质目的。</p><p style="margin: 5px 0px; padding: 0px; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; color: #232323; line-height: 28px; background-color: #faffff">　　我们在开发的过程中要保持一种敏锐的感觉，发现可能的变化并且封装起来，只提供一个精心定义的接口让外界调用。这样你在接口后面所做的任何变化，外边就不受影响了。</p><p style="margin: 5px 0px; padding: 0px; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; color: #232323; line-height: 28px; background-color: #faffff">　　例如在JDK中Iterator就是一个很好的抽象， 它将集合本身和集合的遍历分开。 Stream抽象也不错，封装了对文件和网络操作，只是使用起来稍显麻烦。其实 一组定义良好的接口一定是正交的，不然的话接口之间的依赖就会让实现非常麻烦。</p><p style="margin: 5px 0px; padding: 0px; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; color: #232323; line-height: 28px; background-color: #faffff">　　<strong style="margin: 0px; padding: 0px; color: #333333">总结</strong></p><p style="margin: 5px 0px; padding: 0px; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; color: #232323; line-height: 28px; background-color: #faffff">　　说到底，软件设计和开发就是把现实中的问题映射成计算机的语言实现，但现实问题太复杂，细节太多，而且在不断的变化过程中，一般人很难同时对这么的细节进行思考 ，这时候就需要抽象。</p><p style="margin: 5px 0px; padding: 0px; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; color: #232323; line-height: 28px; background-color: #faffff">　　我们只有从纷繁复杂的现象中抽取事物的本质，从具体事物提炼出正交的概念，才能驾驭这些概念，才能在一个低复杂度的世界中进行思考。</p>
	</div>
	<div class="textbox-bottom">
	</div>
	<div class="tags" style="display: none"> 
	</div>
</div><div class="textbox">
	<div class="textbox-calendar">
	<span class="textbox-calendar-month">Aug</span>
	<span class="textbox-calendar-day">29</span>
	</div>
	<div class="textbox-title">
		<h4>
		<a href="read.php-7517.htm" tppabs="http://i.renjihe.com/blog/read.php?7517">windows查看端口占用以及关闭相应的进程</a> <span id="starid7517"><img src="unstarred.gif" tppabs="http://i.renjihe.com/blog/template/default/images/others/unstarred.gif" alt="" title="未加星标" border="0"/></span> <img src="blank.gif" tppabs="http://i.renjihe.com/blog/images/weather/blank.gif" alt="不指定" title="不指定"/>
		</h4>
		<div class="textbox-label">
		<a href="view.php-go=user_1.htm" tppabs="http://i.renjihe.com/blog/view.php?go=user_1" target="_blank">renjihe1988</a> , 19:46 , <a href="index.php-go=category_2.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_2" title="查看分类： 软件">软件</a> &raquo; <a href="index.php-go=category_32.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_32" title="查看分类： windows">windows</a> , <a href="read.php-7517.htm#reply" tppabs="http://i.renjihe.com/blog/read.php?7517#reply" title="发表您的评论">评论(0)</a> , <a href='javascript: void(0);' title="查看引用地址" onclick='showhidediv("tb7517");'>引用(0)</a> , <a href="read.php-7517.htm" tppabs="http://i.renjihe.com/blog/read.php?7517">阅读(3)</a> , Via 本站原创 
		</div>
	</div>
	<div id="tb7517" style="display: none;" class="textbox-tburl"><strong>引用功能被关闭了。</strong></div>
	
	<div class="textbox-content">
	<p style="margin: 10px auto; padding: 0px; color: #393939; font-size: 14px; line-height: 21px; background-color: #faf7ef">开始--运行--cmd 进入命令提示符 输入netstat -ano 即可看到所有连接的PID 之后在任务管理器中找到这个PID所对应的程序如果任务管理器中<strong style="margin: 0px; padding: 0px">没有PID</strong>这一项,可以在任务管理器中选&quot;查看&quot;-&quot;选择列&quot;&nbsp;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 经常，我们在启动应用的时候发现系统需要的端口被别的程序占用，如何知道谁占有了我们需要的端口，很多人都比较头疼，下面就介绍一种非常简单的方法，希望对大家有用&nbsp;<br /><br />假如我们需要确定谁占用了我们的9050端口&nbsp;<br /><br />1、Windows平台&nbsp;<br />在windows命令行窗口下执行：&nbsp;<br />1.查看所有的端口占用情况</p><p style="margin: 10px auto; padding: 0px; color: #393939; font-size: 14px; line-height: 21px; background-color: #faf7ef">C:&#92;&gt;<strong style="margin: 0px; padding: 0px">netstat -ano</strong></p><p style="margin: 10px auto; padding: 0px; color: #393939; font-size: 14px; line-height: 21px; background-color: #faf7ef">&nbsp; 协议&nbsp;&nbsp;&nbsp; 本地地址&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 外部地址&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 状态&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PID</p><p style="margin: 10px auto; padding: 0px; color: #393939; font-size: 14px; line-height: 21px; background-color: #faf7ef">&nbsp; TCP&nbsp;&nbsp;&nbsp; 127.0.0.1:1434&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.0.0.0:0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LISTENING&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3236<br />&nbsp; TCP&nbsp;&nbsp;&nbsp; 127.0.0.1:5679&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.0.0.0:0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LISTENING&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4168<br />&nbsp; TCP&nbsp;&nbsp;&nbsp; 127.0.0.1:7438&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.0.0.0:0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LISTENING&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4168<br />&nbsp; TCP&nbsp;&nbsp;&nbsp; 127.0.0.1:8015&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.0.0.0:0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LISTENING&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1456<br />&nbsp; TCP&nbsp;&nbsp;&nbsp; 192.168.3.230:139&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.0.0.0:0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LISTENING&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4<br />&nbsp; TCP&nbsp;&nbsp;&nbsp; 192.168.3.230:1957&nbsp;&nbsp;&nbsp;&nbsp; 220.181.31.225:443&nbsp;&nbsp;&nbsp;&nbsp; ESTABLISHED&nbsp;&nbsp;&nbsp;&nbsp; 3068<br />&nbsp; TCP&nbsp;&nbsp;&nbsp; 192.168.3.230:2020&nbsp;&nbsp;&nbsp;&nbsp; 183.62.96.189:1522&nbsp;&nbsp;&nbsp;&nbsp; ESTABLISHED&nbsp;&nbsp;&nbsp;&nbsp; 1456<br />&nbsp; TCP&nbsp;&nbsp;&nbsp; 192.168.3.230:2927&nbsp;&nbsp;&nbsp;&nbsp; 117.79.91.18:80&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ESTABLISHED&nbsp;&nbsp;&nbsp;&nbsp; 4732<br />&nbsp; TCP&nbsp;&nbsp;&nbsp; 192.168.3.230:2929&nbsp;&nbsp;&nbsp;&nbsp; 117.79.91.18:80&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ESTABLISHED&nbsp;&nbsp;&nbsp;&nbsp; 4732<br />&nbsp; TCP&nbsp;&nbsp;&nbsp; 192.168.3.230:2930&nbsp;&nbsp;&nbsp;&nbsp; 117.79.91.18:80&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ESTABLISHED&nbsp;&nbsp;&nbsp;&nbsp; 4732<br />&nbsp; TCP&nbsp;&nbsp;&nbsp; 192.168.3.230:2931&nbsp;&nbsp;&nbsp;&nbsp; 117.79.91.18:80&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ESTABLISHED&nbsp;&nbsp;&nbsp;&nbsp; 4732</p><p style="margin: 10px auto; padding: 0px; color: #393939; font-size: 14px; line-height: 21px; background-color: #faf7ef">&nbsp;</p><p style="margin: 10px auto; padding: 0px; color: #393939; font-size: 14px; line-height: 21px; background-color: #faf7ef">2.查看指定端口的占用情况<br />C:&#92;&gt;<strong style="margin: 0px; padding: 0px">netstat -aon&#124;findstr &quot;9050&quot;</strong></p><p style="margin: 10px auto; padding: 0px; color: #393939; font-size: 14px; line-height: 21px; background-color: #faf7ef">&nbsp; 协议&nbsp;&nbsp;&nbsp; 本地地址&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 外部地址&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 状态&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PID</p><p style="margin: 10px auto; padding: 0px; color: #393939; font-size: 14px; line-height: 21px; background-color: #faf7ef">&nbsp; TCP&nbsp;&nbsp;&nbsp; 127.0.0.1:9050&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.0.0.0:0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LISTENING&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2016</p><p style="margin: 10px auto; padding: 0px; color: #393939; font-size: 14px; line-height: 21px; background-color: #faf7ef">P: 看到了吗，端口被进程号为2016的进程占用，继续执行下面命令： （也可以去任务管理器中查看pid对应的进程）</p><p style="margin: 10px auto; padding: 0px; color: #393939; font-size: 14px; line-height: 21px; background-color: #faf7ef">3.查看PID对应的进程<br />C:&#92;&gt;<strong style="margin: 0px; padding: 0px">tasklist&#124;findstr &quot;2016&quot;</strong></p><p style="margin: 10px auto; padding: 0px; color: #393939; font-size: 14px; line-height: 21px; background-color: #faf7ef">&nbsp;映像名称&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PID 会话名&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 会话#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 内存使用<br />&nbsp;========================= ======== ================<br />&nbsp; tor.exe&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2016 Console&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp; 16,064 K&nbsp;<br /><br />P:很清楚吧，tor占用了你的端口。</p><p style="margin: 10px auto; padding: 0px; color: #393939; font-size: 14px; line-height: 21px; background-color: #faf7ef">&nbsp;</p><p style="margin: 10px auto; padding: 0px; color: #393939; font-size: 14px; line-height: 21px; background-color: #faf7ef">4.结束该进程</p><p style="margin: 10px auto; padding: 0px; color: #393939; font-size: 14px; line-height: 21px; background-color: #faf7ef">C:&#92;&gt;<strong style="margin: 0px; padding: 0px">taskkill /f /t /im tor.exe</strong></p>
	</div>
	<div class="textbox-bottom">
	</div>
	<div class="tags" style="display: none"> 
	</div>
</div><div class="textbox">
	<div class="textbox-calendar">
	<span class="textbox-calendar-month">Aug</span>
	<span class="textbox-calendar-day">29</span>
	</div>
	<div class="textbox-title">
		<h4>
		<a href="read.php-7516.htm" tppabs="http://i.renjihe.com/blog/read.php?7516">nodejs中Async库介绍</a> <span id="starid7516"><img src="unstarred.gif" tppabs="http://i.renjihe.com/blog/template/default/images/others/unstarred.gif" alt="" title="未加星标" border="0"/></span> <img src="blank.gif" tppabs="http://i.renjihe.com/blog/images/weather/blank.gif" alt="不指定" title="不指定"/>
		</h4>
		<div class="textbox-label">
		<a href="view.php-go=user_1.htm" tppabs="http://i.renjihe.com/blog/view.php?go=user_1" target="_blank">renjihe1988</a> , 14:36 , <a href="index.php-go=category_2.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_2" title="查看分类： 软件">软件</a> &raquo; <a href="index.php-go=category_13.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_13" title="查看分类： web">web</a> , <a href="read.php-7516.htm#reply" tppabs="http://i.renjihe.com/blog/read.php?7516#reply" title="发表您的评论">评论(0)</a> , <a href='javascript: void(0);' title="查看引用地址" onclick='showhidediv("tb7516");'>引用(0)</a> , <a href="read.php-7516.htm" tppabs="http://i.renjihe.com/blog/read.php?7516">阅读(3)</a> , Via 本站原创 
		</div>
	</div>
	<div id="tb7516" style="display: none;" class="textbox-tburl"><strong>引用功能被关闭了。</strong></div>
	
	<div class="textbox-content">
	<p style="margin: 0px 0px 10px; padding: 0px; font-size: 14px; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', 'Lucida Sans Unicode', 'Lucida Sans', 'Lucida Console', monospace; line-height: 20px">Async 地址：<a style="color: #999999; text-decoration: none; border-bottom-style: solid; border-bottom-width: 1px" href="javascript:if(confirm('https://github.com/caolan/async  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='https://github.com/caolan/async'" tppabs="https://github.com/caolan/async" target="_blank">https://github.com/caolan/async</a></p><p style="margin: 0px 0px 10px; padding: 0px; font-size: 14px; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', 'Lucida Sans Unicode', 'Lucida Sans', 'Lucida Console', monospace; line-height: 20px">Async的内容分为三部分：</p><ul style="font-size: 14px; padding: 0px; margin: 0px 0px 10px 25px; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', 'Lucida Sans Unicode', 'Lucida Sans', 'Lucida Console', monospace; line-height: 20px"><li>流程控制：简化十种常见流程的处理</li><li>集合处理：如何使用异步操作处理集合中的数据</li><li>工具类：个常用的工具类</li></ul><p style="margin: 0px 0px 10px; padding: 0px; font-size: 14px; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', 'Lucida Sans Unicode', 'Lucida Sans', 'Lucida Console', monospace; line-height: 20px">本文介绍其中最简单最常用的流程控制部分。<br />由于nodejs是异步编程模型，有一些在同步编程中很容易做到的事情，现在却变得很麻烦。Async的流程控制就是为了简化这些操作。</p><h2 style="margin: 10px 0px; padding: 0px; font-family: Monaco, Menlo, Consolas, 'Courier New', 'Lucida Sans Unicode', 'Lucida Sans', 'Lucida Console', monospace; line-height: 40px; color: #333333; font-size: 20.5px"><a style="color: #ff9900" name="t0"></a>series(tasks, [callback]) （多个函数依次执行，之间没有数据交换）</h2><p style="margin: 0px 0px 10px; padding: 0px; font-size: 14px; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', 'Lucida Sans Unicode', 'Lucida Sans', 'Lucida Console', monospace; line-height: 20px">有多个异步函数需要依次调用，一个完成之后才能执行下一个。各函数之间没有数据的交换，仅仅需要保证其执行顺序。这时可使用series。<br />纯js代：</p><pre style="white-space: pre-wrap; word-wrap: break-word; padding: 9.5px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 13px; color: #333333; margin-top: 0px; margin-bottom: 10px; line-height: 20px; word-break: break-all; background-color: #f5f5f5">step1(function(err, v1) &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; step2(function(err, v2) &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; step3(function(err, v3) &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // do somethig with the err or values v1/v2/v3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125; &#125;); </pre><p style="margin: 0px 0px 10px; padding: 0px; font-size: 14px; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', 'Lucida Sans Unicode', 'Lucida Sans', 'Lucida Console', monospace; line-height: 20px">从中可以看到这嵌套还是比较多深的，如果再多步，会更深。在代中忽略对了每一层err的处理，否则还都等上 if(err) return callback(err)，那就更麻烦了。<br />对于这种情况，使用async来处理，就是这的：</p><pre style="white-space: pre-wrap; word-wrap: break-word; padding: 9.5px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 13px; color: #333333; margin-top: 0px; margin-bottom: 10px; line-height: 20px; word-break: break-all; background-color: #f5f5f5">var async = require(&lsquo;async&rsquo;) async.series([step1, step2, step3], function(err, values) &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // do somethig with the err or values v1/v2/v3 &#125;); </pre><p style="margin: 0px 0px 10px; padding: 0px; font-size: 14px; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', 'Lucida Sans Unicode', 'Lucida Sans', 'Lucida Console', monospace; line-height: 20px">可以看到代简洁了很多，而且自动处理每个回调中的错误。当然，这里只给出来最最简单的例子，在实际中，我们常会在每个step中执行一些操作，这时可写成：</p><pre style="white-space: pre-wrap; word-wrap: break-word; padding: 9.5px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 13px; color: #333333; margin-top: 0px; margin-bottom: 10px; line-height: 20px; word-break: break-all; background-color: #f5f5f5">var async = require(&lsquo;async&rsquo;) async.series([function(cb) &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; step1(function(err, v1) &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // do something with v1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cb(err, v1);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125;),&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function(cb) &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; step2(...)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125;,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function(cb) &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; step3(...)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125;],&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function(err, values) &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // do somethig with the err or values v1/v2/v3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125;); </pre><p style="margin: 0px 0px 10px; padding: 0px; font-size: 14px; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', 'Lucida Sans Unicode', 'Lucida Sans', 'Lucida Console', monospace; line-height: 20px">该函数的详细解释为：<br />依次执行一个函数数组中的每个函数，每一个函数执行完成之后才能执行下一个函数。<br />如果任何一个函数向它的回调函数中了一个error，则后面的函数都不会被执行，并且将会立刻会将该error以及已经执行了的函数的结果，给series中最后那个callback。<br />当所有的函数执行完后（没有出错），则会把每个函数给其回调函数的结果合并为一个数组，给series最后的那个callback。<br />还可以json的形式来提供tasks。每一个属性都会被当作函数来执行，并且结果也会以json形式给series最后的那个callback。这种方式可读性更高一些。<br />具体例子可参考：https://github.com/freewind/async_demo/blob/master/series.js<br />其代中还包含了：<br />如果中间某个函数出错，series函数如何处理<br />如果某个函数给回调的值为undefined, null, &#123;&#125;, []等，series如何处理<br />另外还需要注意的是：多个series调用之间是不分先后的，为series本身也是异步调用。</p><h2 style="margin: 10px 0px; padding: 0px; font-family: Monaco, Menlo, Consolas, 'Courier New', 'Lucida Sans Unicode', 'Lucida Sans', 'Lucida Console', monospace; line-height: 40px; color: #333333; font-size: 20.5px"><a style="color: #ff9900" name="t1"></a>parallel(tasks, [callback]) （多个函数并行执行）</h2><p style="margin: 0px 0px 10px; padding: 0px; font-size: 14px; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', 'Lucida Sans Unicode', 'Lucida Sans', 'Lucida Console', monospace; line-height: 20px">并行执行多个函数，每个函数都是立即执行，不需要等待其它函数先执行。给最终callback的数组中的数据按照tasks中声明的顺序，而不是执行完成的顺序。<br />如果某个函数出错，则立刻将err和已经执行完的函数的结果值给parallel最终的callback。其它未执行完的函数的值不会到最终数据，但要个位置。<br />同时支持json形式的tasks，其最终callback的结果也为json形式。<br />示例代：</p><pre style="white-space: pre-wrap; word-wrap: break-word; padding: 9.5px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 13px; color: #333333; margin-top: 0px; margin-bottom: 10px; line-height: 20px; word-break: break-all; background-color: #f5f5f5">async.parallel([function(cb) &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; t.fire('a400', cb, 400) &#125;, function(cb) &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; t.fire('a200', cb, 200) &#125;, function(cb) &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; t.fire('a300', cb, 300) &#125;], function(err, results) &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; log(&rsquo;1 err: &lsquo;, err); // -&gt; undefined&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; log(&rsquo;1 results: &lsquo;, results); // -&gt;[ 'a400', 'a200', 'a300' ] &#125;); </pre><p style="margin: 0px 0px 10px; padding: 0px; font-size: 14px; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', 'Lucida Sans Unicode', 'Lucida Sans', 'Lucida Console', monospace; line-height: 20px">中途出错的示例：</p><pre style="white-space: pre-wrap; word-wrap: break-word; padding: 9.5px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 13px; color: #333333; margin-top: 0px; margin-bottom: 10px; line-height: 20px; word-break: break-all; background-color: #f5f5f5">async.parallel([function(cb) &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; log('1: ', 'start');&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; t.fire('a400', cb, 400) &#125;, // 该函数的值不会给最终callback，但要个位置 function(cb) &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; log('2: ', 'start');&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; t.err('e200', cb, 200) &#125;, function(cb) &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; log('3: ', 'start');&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; t.fire('a100', cb, 100) &#125;], function(err, results) &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; log(&rsquo;2 err: &lsquo;, err); // -&gt; e200&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; log(&rsquo;2 results: &lsquo;, results); // -&gt; [ , undefined, 'a100' ] &#125;); </pre><p style="margin: 0px 0px 10px; padding: 0px; font-size: 14px; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', 'Lucida Sans Unicode', 'Lucida Sans', 'Lucida Console', monospace; line-height: 20px">以json形式入tasks</p><pre style="white-space: pre-wrap; word-wrap: break-word; padding: 9.5px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 13px; color: #333333; margin-top: 0px; margin-bottom: 10px; line-height: 20px; word-break: break-all; background-color: #f5f5f5">async.parallel(&#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; a: function(cb) &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; t.fire(&lsquo;a400&prime;, cb, 400)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125;,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; b: function(cb) &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; t.fire(&lsquo;c300&prime;, cb, 300)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125; &#125;, function(err, results) &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; log(&rsquo;3 err: &lsquo;, err); // -&gt; undefined&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; log(&rsquo;3 results: &lsquo;, results); // -&gt; &#123; b: &lsquo;c300&prime;, a: &lsquo;a400&prime; &#125; &#125;); </pre><p style="margin: 0px 0px 10px; padding: 0px; font-size: 14px; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', 'Lucida Sans Unicode', 'Lucida Sans', 'Lucida Console', monospace; line-height: 20px">更详细示例参见：https://github.com/freewind/async_demo/blob/master/parallel.js</p><h2 style="margin: 10px 0px; padding: 0px; font-family: Monaco, Menlo, Consolas, 'Courier New', 'Lucida Sans Unicode', 'Lucida Sans', 'Lucida Console', monospace; line-height: 40px; color: #333333; font-size: 20.5px"><a style="color: #ff9900" name="t2"></a>waterfall(tasks, [callback]) （多个函数依次执行，且前一个的输出为后一个的输入）</h2><p style="margin: 0px 0px 10px; padding: 0px; font-size: 14px; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', 'Lucida Sans Unicode', 'Lucida Sans', 'Lucida Console', monospace; line-height: 20px">与seires相似，按顺序依次执行多个函数。不同之处，每一个函数产生的值，都将给下一个函数。如果中途出错，后面的函数将不会被执行。错误信息以及之前产生的结果，将给waterfall最终的callback。<br />这个函数名为waterfall(瀑布)，可以想像瀑布从上到下，中途冲过一层层突起的石头。注意，该函数不支持json式的tasks。</p><pre style="white-space: pre-wrap; word-wrap: break-word; padding: 9.5px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 13px; color: #333333; margin-top: 0px; margin-bottom: 10px; line-height: 20px; word-break: break-all; background-color: #f5f5f5">async.waterfall([function(cb) &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; log('1: ', 'start');&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cb(null, 3); &#125;, function(n, cb) &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; log('2: ', n);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; t.inc(n, cb); &#125;, function(n, cb) &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; log('3: ', n);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; t.fire(n * n, cb); &#125;], function(err, result) &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; log(&rsquo;1 err: &lsquo;, err); // -&gt; null&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; log(&rsquo;1 result: &lsquo;, result); // -&gt; 16 &#125;); </pre><p style="margin: 0px 0px 10px; padding: 0px; font-size: 14px; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', 'Lucida Sans Unicode', 'Lucida Sans', 'Lucida Console', monospace; line-height: 20px">更详细示例参见：https://github.com/freewind/async_demo/blob/master/waterfall.js</p><h2 style="margin: 10px 0px; padding: 0px; font-family: Monaco, Menlo, Consolas, 'Courier New', 'Lucida Sans Unicode', 'Lucida Sans', 'Lucida Console', monospace; line-height: 40px; color: #333333; font-size: 20.5px"><a style="color: #ff9900" name="t3"></a>auto(tasks, [callback]) （多个函数有依赖关系，有的并行执行，有的依次执行）</h2><p style="margin: 0px 0px 10px; padding: 0px; font-size: 14px; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', 'Lucida Sans Unicode', 'Lucida Sans', 'Lucida Console', monospace; line-height: 20px">用来处理有依赖关系的多个任务的执行。比如某些任务之间彼此独立，可以并行执行；但某些任务依赖于其它某些任务，只能等那些任务完成后才能执行。<br />虽然我们可以使用async.parallel和async.series结合起来实现该功能，但如果任务之间关系复杂，则代会相当复杂，以后如果想添一个新任务，也会很麻烦。这时使用async.auto，则会事半功倍。<br />如果有任务中途出错，则会把该错误给最终callback，所有任务（包括已经执行完的）产生的数据将被忽略。<br />这里假设我要写一个程序，它要完成以下件事：<br />从某处取得数据<br />在硬盘上建立一个新的目录<br />将数据写入到目录下某文件<br />发送邮件，将文件以附件形式发送给其它人。<br />分析该任务，可以知道1与2可以并行执行，3需要等1和2完成，4要等3完成。</p><pre style="white-space: pre-wrap; word-wrap: break-word; padding: 9.5px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 13px; color: #333333; margin-top: 0px; margin-bottom: 10px; line-height: 20px; word-break: break-all; background-color: #f5f5f5">async.auto(&#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; getData: function(callback) &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; setTimeout(function() &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; console.log(&rsquo;1 : got data&rsquo;);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; callback();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125;,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 300);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125;,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; makeFolder: function(callback) &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; setTimeout(function() &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; console.log(&rsquo;1 : made folder&rsquo;);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; callback();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125;,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 200);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125;,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; writeFile: ['getData', 'makeFolder',&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function(callback) &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; setTimeout(function() &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; console.log('1: wrote file');&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; callback(null, 'myfile');&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125;,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 300);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125;],&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; emailFiles: ['writeFile',&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function(callback, results) &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; log('1: emailed file: ', results.writeFile); // -&gt; myfile&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; callback(null, results.writeFile);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125;] &#125;, function(err, results) &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; log(&rsquo;1 : err: &lsquo;, err); // -&gt; null&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; log(&rsquo;1 : results: &lsquo;, results); // -&gt; &#123; makeFolder: undefined,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // getData: undefined,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // writeFile: &lsquo;myfile&rsquo;,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // emailFiles: &lsquo;myfile&rsquo; &#125; &#125;); </pre><p style="margin: 0px 0px 10px; padding: 0px; font-size: 14px; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', 'Lucida Sans Unicode', 'Lucida Sans', 'Lucida Console', monospace; line-height: 20px">更多详细示例参见：https://github.com/freewind/async_demo/blob/master/auto.js</p><h2 style="margin: 10px 0px; padding: 0px; font-family: Monaco, Menlo, Consolas, 'Courier New', 'Lucida Sans Unicode', 'Lucida Sans', 'Lucida Console', monospace; line-height: 40px; color: #333333; font-size: 20.5px"><a style="color: #ff9900" name="t4"></a>whilst(test, fn, callback)（用可于异步调用的while）</h2><p style="margin: 0px 0px 10px; padding: 0px; font-size: 14px; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', 'Lucida Sans Unicode', 'Lucida Sans', 'Lucida Console', monospace; line-height: 20px">相当于while，但其中的异步调用将在完成后才会进行下一次循环。举例如下：</p><pre style="white-space: pre-wrap; word-wrap: break-word; padding: 9.5px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 13px; color: #333333; margin-top: 0px; margin-bottom: 10px; line-height: 20px; word-break: break-all; background-color: #f5f5f5">var count1 = 0; async.whilst(function() &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return count1 &lt; 3 &#125;, function(cb) &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; log(&rsquo;1 count: &lsquo;, count1);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; count1++;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; setTimeout(cb, 1000); &#125;, function(err) &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 3s have passed&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; log(&rsquo;1 err: &lsquo;, err); // -&gt; undefined &#125;); </pre><p style="margin: 0px 0px 10px; padding: 0px; font-size: 14px; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', 'Lucida Sans Unicode', 'Lucida Sans', 'Lucida Console', monospace; line-height: 20px">它相当于：</p><pre style="white-space: pre-wrap; word-wrap: break-word; padding: 9.5px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 13px; color: #333333; margin-top: 0px; margin-bottom: 10px; line-height: 20px; word-break: break-all; background-color: #f5f5f5">try &#123;&nbsp;&nbsp;&nbsp;&nbsp; whilst(test) &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fn();&nbsp;&nbsp;&nbsp;&nbsp; &#125;&nbsp;&nbsp;&nbsp;&nbsp; callback(); &#125; catch(err) &#123;&nbsp;&nbsp;&nbsp;&nbsp; callback(err); &#125; </pre><p style="margin: 0px 0px 10px; padding: 0px; font-size: 14px; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', 'Lucida Sans Unicode', 'Lucida Sans', 'Lucida Console', monospace; line-height: 20px">该函数的功能比较简单，条件变量通常定义在外面，可供每个函数访问。在循环中，异步调用时产生的值实际上被丢弃了，为最后那个callback只能入错误信息。<br />另外，第二个函数fn需要能接受一个函数cb，这个cb最终必须被执行，用于表示出错或正常结束。<br />更详细示例参见：https://github.com/freewind/async_demo/blob/master/whilst_until.js</p><h2 style="margin: 10px 0px; padding: 0px; font-family: Monaco, Menlo, Consolas, 'Courier New', 'Lucida Sans Unicode', 'Lucida Sans', 'Lucida Console', monospace; line-height: 40px; color: #333333; font-size: 20.5px"><a style="color: #ff9900" name="t5"></a>until(test, fn, callback) （与while相似，但判断条件相反）</h2><pre style="white-space: pre-wrap; word-wrap: break-word; padding: 9.5px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 13px; color: #333333; margin-top: 0px; margin-bottom: 10px; line-height: 20px; word-break: break-all; background-color: #f5f5f5">var count4 = 0;&nbsp;&nbsp;async.until(function() &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return count4 &gt; 3&nbsp;&nbsp;&#125;,&nbsp;&nbsp;function(cb) &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log(&rsquo;4 count: &lsquo;, count4);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;count4++;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setTimeout(cb, 200);&nbsp;&nbsp;&#125;,&nbsp;&nbsp;function(err) &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// 4s have passed&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log(&rsquo;4 err: &lsquo;, err); // -&gt; undefined&nbsp;&nbsp;&#125;); </pre><p style="margin: 0px 0px 10px; padding: 0px; font-size: 14px; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', 'Lucida Sans Unicode', 'Lucida Sans', 'Lucida Console', monospace; line-height: 20px">当第一个函数条件为false时，继续执行第二个函数，否则跳出。</p><h2 style="margin: 10px 0px; padding: 0px; font-family: Monaco, Menlo, Consolas, 'Courier New', 'Lucida Sans Unicode', 'Lucida Sans', 'Lucida Console', monospace; line-height: 40px; color: #333333; font-size: 20.5px"><a style="color: #ff9900" name="t6"></a>queue （可设定worker数量的队列）</h2><p style="margin: 0px 0px 10px; padding: 0px; font-size: 14px; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', 'Lucida Sans Unicode', 'Lucida Sans', 'Lucida Console', monospace; line-height: 20px">queue相当于一个强版的parallel，主要是限制了worker数量，不再一次性全部执行。当worker数量不够用时，新入的任务将会排队等候，直到有新的worker可用。<br />该函数有多个点可供回调，如worker用完时、等候任务时、全部执行完时等。<br />定义一个queue，其worker数量为2，并在任务执行时，记录一下日志：</p><pre style="white-space: pre-wrap; word-wrap: break-word; padding: 9.5px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 13px; color: #333333; margin-top: 0px; margin-bottom: 10px; line-height: 20px; word-break: break-all; background-color: #f5f5f5">var q = async.queue(function(task, callback) &#123;&nbsp;&nbsp;&nbsp;&nbsp; log(&lsquo;worker is processing task: &lsquo;, task.name);&nbsp;&nbsp;&nbsp;&nbsp; task.run(callback); &#125;, 2); </pre><p style="margin: 0px 0px 10px; padding: 0px; font-size: 14px; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', 'Lucida Sans Unicode', 'Lucida Sans', 'Lucida Console', monospace; line-height: 20px">worker数量将用完时，会调用saturated函数：</p><pre style="white-space: pre-wrap; word-wrap: break-word; padding: 9.5px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 13px; color: #333333; margin-top: 0px; margin-bottom: 10px; line-height: 20px; word-break: break-all; background-color: #f5f5f5">q.saturated = function() &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log(&lsquo;all workers to be used&rsquo;);&nbsp;&nbsp;&nbsp;&nbsp;&#125; </pre><p style="margin: 0px 0px 10px; padding: 0px; font-size: 14px; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', 'Lucida Sans Unicode', 'Lucida Sans', 'Lucida Console', monospace; line-height: 20px">当最后一个任务交给worker执行时，会调用empty函数</p><pre style="white-space: pre-wrap; word-wrap: break-word; padding: 9.5px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 13px; color: #333333; margin-top: 0px; margin-bottom: 10px; line-height: 20px; word-break: break-all; background-color: #f5f5f5">q.empty = function() &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log(&lsquo;no more tasks wating&rsquo;);&nbsp;&nbsp;&nbsp;&nbsp;&#125; </pre><p style="margin: 0px 0px 10px; padding: 0px; font-size: 14px; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', 'Lucida Sans Unicode', 'Lucida Sans', 'Lucida Console', monospace; line-height: 20px">当所有任务都执行完时，会调用drain函数</p><pre style="white-space: pre-wrap; word-wrap: break-word; padding: 9.5px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 13px; color: #333333; margin-top: 0px; margin-bottom: 10px; line-height: 20px; word-break: break-all; background-color: #f5f5f5">q.drain = function() &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.log(&lsquo;all tasks have been processed&rsquo;);&nbsp;&nbsp;&nbsp;&nbsp;&#125; </pre><p style="margin: 0px 0px 10px; padding: 0px; font-size: 14px; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', 'Lucida Sans Unicode', 'Lucida Sans', 'Lucida Console', monospace; line-height: 20px">放入多个任务，可一次放一个，或一次放多个</p><pre style="white-space: pre-wrap; word-wrap: break-word; padding: 9.5px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 13px; color: #333333; margin-top: 0px; margin-bottom: 10px; line-height: 20px; word-break: break-all; background-color: #f5f5f5">q.push(&#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; name: &rsquo;t1&prime;,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; run: function(cb) &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; log(&lsquo;t1 is running, waiting tasks: &lsquo;, q.length());&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; t.fire(&lsquo;t1&prime;, cb, 400); // 400ms后执行&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125; &#125;, function(err) &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; log(&lsquo;t1 executed&rsquo;); &#125;);&nbsp;&nbsp;q.push([&#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; name: 't3',&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; run: function(cb) &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; log('t3 is running, waiting tasks: ', q.length());&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; t.fire('t3', cb, 300); // 300ms后执行&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125; &#125;, &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; name: 't4',&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; run: function(cb) &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; log('t4 is running, waiting tasks: ', q.length());&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; t.fire('t4', cb, 500); // 500ms后执行&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125; &#125;], function(err) &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; log(&lsquo;t3 / 4 executed&rsquo;); &#125;); </pre><p style="margin: 0px 0px 10px; padding: 0px; font-size: 14px; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', 'Lucida Sans Unicode', 'Lucida Sans', 'Lucida Console', monospace; line-height: 20px">更多详细示例参见：https://github.com/freewind/async_demo/blob/master/queue.js</p><h2 style="margin: 10px 0px; padding: 0px; font-family: Monaco, Menlo, Consolas, 'Courier New', 'Lucida Sans Unicode', 'Lucida Sans', 'Lucida Console', monospace; line-height: 40px; color: #333333; font-size: 20.5px"><a style="color: #ff9900" name="t7"></a>iterator(tasks) （将个函数包装为iterator）</h2><p style="margin: 0px 0px 10px; padding: 0px; font-size: 14px; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', 'Lucida Sans Unicode', 'Lucida Sans', 'Lucida Console', monospace; line-height: 20px">将一组函数包装成为一个iterator，可通过next()得到以下一个函数为起点的新的iterator。该函数通常由async在内部使用，但如果需要时，也可在我们的代中使用它。</p><pre style="white-space: pre-wrap; word-wrap: break-word; padding: 9.5px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 13px; color: #333333; margin-top: 0px; margin-bottom: 10px; line-height: 20px; word-break: break-all; background-color: #f5f5f5">var iter = async.iterator([function() &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; console.log('111') &#125;, function() &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; console.log('222') &#125;, function() &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; console.log('333') &#125;]); console.log(iter()); console.log(iter.next()); </pre><p style="margin: 0px 0px 10px; padding: 0px; font-size: 14px; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', 'Lucida Sans Unicode', 'Lucida Sans', 'Lucida Console', monospace; line-height: 20px">直接调用()，会执行当前函数，并返回一个由下个函数为起点的新的iterator。调用next()，不会执行当前函数，直接返回由下个函数为起点的新iterator。<br />对于同一个iterator，多次调用next()，不会影响自己。如果只剩下一个元，调用next()会返回null。<br />更详细示例参见：https://github.com/freewind/async_demo/blob/master/iterator.js</p><h2 style="margin: 10px 0px; padding: 0px; font-family: Monaco, Menlo, Consolas, 'Courier New', 'Lucida Sans Unicode', 'Lucida Sans', 'Lucida Console', monospace; line-height: 40px; color: #333333; font-size: 20.5px"><a style="color: #ff9900" name="t8"></a>apply(function, arguments..) （给函数预绑定参数）</h2><p style="margin: 0px 0px 10px; padding: 0px; font-size: 14px; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', 'Lucida Sans Unicode', 'Lucida Sans', 'Lucida Console', monospace; line-height: 20px">apply是一个非常好用的函数，可以让我们给一个函数预绑定多个参数并生成一个可直接调用的新函数，简化代。<br />对于函数：</p><pre style="white-space: pre-wrap; word-wrap: break-word; padding: 9.5px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 13px; color: #333333; margin-top: 0px; margin-bottom: 10px; line-height: 20px; word-break: break-all; background-color: #f5f5f5">function(callback) &#123; t.inc(3, callback); &#125; </pre><p style="margin: 0px 0px 10px; padding: 0px; font-size: 14px; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', 'Lucida Sans Unicode', 'Lucida Sans', 'Lucida Console', monospace; line-height: 20px">可以用apply改写为：</p><pre style="white-space: pre-wrap; word-wrap: break-word; padding: 9.5px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 13px; color: #333333; margin-top: 0px; margin-bottom: 10px; line-height: 20px; word-break: break-all; background-color: #f5f5f5">async.apply(t.inc, 3); </pre><p style="margin: 0px 0px 10px; padding: 0px; font-size: 14px; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', 'Lucida Sans Unicode', 'Lucida Sans', 'Lucida Console', monospace; line-height: 20px">还可以给某些函数预设值，得到一个新函数：</p><pre style="white-space: pre-wrap; word-wrap: break-word; padding: 9.5px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 13px; color: #333333; margin-top: 0px; margin-bottom: 10px; line-height: 20px; word-break: break-all; background-color: #f5f5f5">var log = async.apply(console.log, &quot;&gt;&quot;);&nbsp;&nbsp;&nbsp;&nbsp;log(&lsquo;hello&rsquo;);&nbsp;&nbsp;&nbsp;&nbsp;// &gt; hello </pre><p style="margin: 0px 0px 10px; padding: 0px; font-size: 14px; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', 'Lucida Sans Unicode', 'Lucida Sans', 'Lucida Console', monospace; line-height: 20px">更详细代参见：https://github.com/freewind/async_demo/blob/master/apply.js</p><h2 style="margin: 10px 0px; padding: 0px; font-family: Monaco, Menlo, Consolas, 'Courier New', 'Lucida Sans Unicode', 'Lucida Sans', 'Lucida Console', monospace; line-height: 40px; color: #333333; font-size: 20.5px"><a style="color: #ff9900" name="t9"></a>nextTick(callback) （在nodejs与浏览器两边行为一致）</h2><p style="margin: 0px 0px 10px; padding: 0px; font-size: 14px; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', 'Lucida Sans Unicode', 'Lucida Sans', 'Lucida Console', monospace; line-height: 20px">nextTick的作用与nodejs的nextTick一，都是把某个函数调用放在队列的尾部。但在浏览器端，只能使用setTimeout(callback,0)，但这个方法有时候会让其它高优先级的任务插到前面去。<br />所以提供了这个nextTick，让同的代在服务器端和浏览器端表现一致。</p><pre style="white-space: pre-wrap; word-wrap: break-word; padding: 9.5px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 13px; color: #333333; margin-top: 0px; margin-bottom: 10px; line-height: 20px; word-break: break-all; background-color: #f5f5f5">var calls = []; async.nextTick(function() &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; calls.push(&lsquo;two&rsquo;); &#125;); calls.push(&lsquo;one&rsquo;); async.nextTick(function() &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; console.log(calls); // -&gt; [ 'one', 'two' ] &#125;); </pre><p style="margin: 0px 0px 10px; padding: 0px; font-size: 14px; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', 'Lucida Sans Unicode', 'Lucida Sans', 'Lucida Console', monospace; line-height: 20px">更详细代参见：https://github.com/freewind/async_demo/blob/master/nextTick.js</p><blockquote style="font-size: 14px; padding: 0px 0px 0px 15px; margin: 0px 0px 20px; border-left-width: 5px; border-left-style: solid; border-left-color: #eeeeee; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', 'Lucida Sans Unicode', 'Lucida Sans', 'Lucida Console', monospace; line-height: 20px">文章出处:&nbsp;<a style="color: #999999; text-decoration: none; border-bottom-style: dotted; border-bottom-width: 1px" href="javascript:if(confirm('http://my.oschina.net/huangsz/blog/176203  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://my.oschina.net/huangsz/blog/176203'" tppabs="http://my.oschina.net/huangsz/blog/176203" target="_blank">开源中国</a>&nbsp;<br />文章地址:&nbsp;<a style="color: #999999; text-decoration: none; border-bottom-style: solid; border-bottom-width: 1px" href="javascript:if(confirm('http://my.oschina.net/huangsz/blog/176203  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://my.oschina.net/huangsz/blog/176203'" tppabs="http://my.oschina.net/huangsz/blog/176203" target="_blank">http://my.oschina.net/huangsz/blog/176203</a>&nbsp;<br />本文地址:&nbsp;<a style="color: #999999; text-decoration: none; border-bottom-style: solid; border-bottom-width: 1px" href="javascript:if(confirm('http://www.webrube.com/node.js-web_rube/1468  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.webrube.com/node.js-web_rube/1468'" tppabs="http://www.webrube.com/node.js-web_rube/1468" target="_blank">http://www.webrube.com/node.js-web_rube/1468</a>&nbsp;<br />本文由&nbsp;<a style="color: #999999; text-decoration: none; border-bottom-style: dotted; border-bottom-width: 1px" href="javascript:if(confirm('http://www.webrube.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.webrube.com/'" tppabs="http://www.webrube.com/" target="_blank" class="mini-icon">噜吧</a>&nbsp;整理，转载请保留以上信息; 如有侵犯您的版权, 请联系微信: 3715397 。</blockquote>
	</div>
	<div class="textbox-bottom">
	</div>
	<div class="tags" style="display: none"> 
	</div>
</div><div class="textbox">
	<div class="textbox-calendar">
	<span class="textbox-calendar-month">Aug</span>
	<span class="textbox-calendar-day">29</span>
	</div>
	<div class="textbox-title">
		<h4>
		<a href="read.php-7515.htm" tppabs="http://i.renjihe.com/blog/read.php?7515">JS魔法堂：ES6新特性——GeneratorFunction介绍</a> <span id="starid7515"><img src="unstarred.gif" tppabs="http://i.renjihe.com/blog/template/default/images/others/unstarred.gif" alt="" title="未加星标" border="0"/></span> <img src="blank.gif" tppabs="http://i.renjihe.com/blog/images/weather/blank.gif" alt="不指定" title="不指定"/>
		</h4>
		<div class="textbox-label">
		<a href="view.php-go=user_1.htm" tppabs="http://i.renjihe.com/blog/view.php?go=user_1" target="_blank">renjihe1988</a> , 14:35 , <a href="index.php-go=category_2.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_2" title="查看分类： 软件">软件</a> &raquo; <a href="index.php-go=category_13.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_13" title="查看分类： web">web</a> , <a href="read.php-7515.htm#reply" tppabs="http://i.renjihe.com/blog/read.php?7515#reply" title="发表您的评论">评论(0)</a> , <a href='javascript: void(0);' title="查看引用地址" onclick='showhidediv("tb7515");'>引用(0)</a> , <a href="read.php-7515.htm" tppabs="http://i.renjihe.com/blog/read.php?7515">阅读(2)</a> , Via 本站原创 
		</div>
	</div>
	<div id="tb7515" style="display: none;" class="textbox-tburl"><strong>引用功能被关闭了。</strong></div>
	
	<div class="textbox-content">
	<div id="cnblogs_post_body" style="margin: 0px 0px 20px; padding: 0px; word-break: break-word; color: #333333; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px"><p style="margin: 10px auto; padding: 0px"><span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 18px; background-color: #888888"><strong style="margin: 0px; padding: 0px">一、前言　　　　　　　　　　　　　　　　　　　　　　　　　　　&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br /></strong></span></p><p style="margin: 10px auto; padding: 0px">&nbsp; 第一次看koajs的示例时，发现该语句&nbsp;<span style="margin: 5px 0px; padding: 3px; border: 1px solid #cccccc; overflow: auto; line-height: 1.8; font-size: 12px !important; font-family: 'Courier New'; color: #000000; background-color: #f5f5f5" class="cnblogs_code">function *(next)&#123;...............&#125;</span>&nbsp;，这是啥啊？于是搜索一下，原来这是就是ES6的新特性Generator Function(生成器函数)。</p><p style="margin: 10px auto; padding: 0px">&nbsp; 那什么是生成器函数呢？其实就相当于C#2.0中通过yield关键字实现的迭代器的生成器（细节有所不同），那么理解的关键就在迭代器和yield关键字两部分了。下面将尝试从表象出发，逐步对生成器函数及利用它进行异步编程进行浅层的分析理解。</p><p style="margin: 10px auto; padding: 0px">&nbsp;</p><p style="margin: 10px auto; padding: 0px"><span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 18px; background-color: #888888"><strong style="margin: 0px; padding: 0px">二、表象&mdash;&mdash;语法及基本使用　　　　　　　　　　　　　　　　　　　&nbsp;&nbsp;&nbsp;<br /></strong></span></p><p style="margin: 10px auto; padding: 0px"><strong style="margin: 0px; padding: 0px">&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 15px">示例：</span></strong></p><div class="cnblogs_code" style="margin: 5px 0px; padding: 5px; border: 1px solid #cccccc; overflow: auto; color: #000000; font-family: 'Courier New' !important; font-size: 12px !important; background-color: #f5f5f5"><div class="cnblogs_code_toolbar" style="margin: 5px 0px 0px; padding: 0px"><span style="margin: 0px; padding: 0px 5px 0px 0px; line-height: 1.8" class="cnblogs_code_copy"><a style="margin: 0px; padding: 0px; border: none !important" title="复制代码"><img style="margin: 0px; padding: 0px; max-width: 900px; border: none !important" src="copycode.gif" tppabs="http://common.cnblogs.com/images/copycode.gif" border="0" alt="复制代码" /></a></span></div><pre style="margin-top: 0px; margin-bottom: 0px; padding: 0px; white-space: pre-wrap; word-wrap: break-word; font-family: 'Courier New' !important; font-size: 12px !important"><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> 定义生成器函数</span> function *<span style="margin: 0px; padding: 0px; line-height: 1.8">enumerable(msg)&#123;&nbsp;&nbsp; console.log(msg)&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> msg1 = <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">yield</span> msg + <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">&nbsp;&nbsp;after </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8">&nbsp;&nbsp; console.log(msg1)&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> msg2 = <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">yield</span> msg1 + <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000"> after</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span>&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">try</span><span style="margin: 0px; padding: 0px; line-height: 1.8">&#123;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> msg3 = <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">yield</span> msg2 + <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">after</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8">&nbsp;&nbsp;&nbsp;&nbsp; console.log(</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">ok</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8">)&nbsp;&nbsp; &#125;&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">catch</span><span style="margin: 0px; padding: 0px; line-height: 1.8">(e)&#123;&nbsp;&nbsp;&nbsp;&nbsp; console.log(e)&nbsp;&nbsp; &#125;&nbsp;&nbsp; console.log(msg2 </span>+ <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000"> over</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8">) &#125;&nbsp;&nbsp;</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> 初始化迭代器</span> <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> enumerator = enumerable(<span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">hello</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8">) </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> ret = enumerator.next() <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> 控制台显示 hello，ret的值&#123;value:'hello after',done:false&#125;</span> ret =&nbsp;&nbsp;enumerator.next(<span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">world</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span>) <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> 控制台显示 world，ret的值&#123;value:'world after',done:false&#125;</span> ret = enumerator.next(<span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">game</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span>) <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> 控制台显示game，ret的值&#123;value:'game after',done:false&#125; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> 抛出异常信息</span> ret = enumerator.<span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">throw</span>(<span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">new</span> Error(<span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">test</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span>)) <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> 控制台显示new Error('test')信息，然后显示game over。ret的值为&#123;done:true&#125;&nbsp;&nbsp;</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> for...of语句</span> enumerator = enumerable(<span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">hello</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8">) </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">for</span><span style="margin: 0px; padding: 0px; line-height: 1.8">(ret of enumerator)&nbsp;&nbsp; console.log(JSON.stringify(ret)); </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> 控制台依次显示 </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> hello </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> &#123;value:'hello after',done:false&#125; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> world </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> &#123;value:'world after',done:false&#125; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> &#123;value:'game after',done:false&#125; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> game over </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> &#123;done:true&#125;</span></pre><div class="cnblogs_code_toolbar" style="margin: 5px 0px 0px; padding: 0px"><span style="margin: 0px; padding: 0px 5px 0px 0px; line-height: 1.8" class="cnblogs_code_copy"><a style="margin: 0px; padding: 0px; border: none !important" title="复制代码"><img style="margin: 0px; padding: 0px; max-width: 900px; border: none !important" src="copycode.gif" tppabs="http://common.cnblogs.com/images/copycode.gif" border="0" alt="复制代码" /></a></span></div></div><p style="margin: 10px auto; padding: 0px">&nbsp;</p><p style="margin: 10px auto; padding: 0px"><strong style="margin: 0px; padding: 0px">&nbsp;<span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 15px">&nbsp;1. 生成器语函数定义</span></strong></p><div class="cnblogs_code" style="margin: 5px 0px; padding: 5px; border: 1px solid #cccccc; overflow: auto; color: #000000; font-family: 'Courier New' !important; font-size: 12px !important; background-color: #f5f5f5"><pre style="margin-top: 0px; margin-bottom: 0px; padding: 0px; white-space: pre-wrap; word-wrap: break-word; font-family: 'Courier New' !important; font-size: 12px !important">function*<span style="margin: 0px; padding: 0px; line-height: 1.8"> test()&#123;&#125; function </span>*<span style="margin: 0px; padding: 0px; line-height: 1.8"> test()&#123;&#125; function </span>*<span style="margin: 0px; padding: 0px; line-height: 1.8">test()&#123;&#125; test </span>= function*<span style="margin: 0px; padding: 0px; line-height: 1.8"> ()&#123;&#125;&nbsp;&nbsp;test </span>= function *()&#123;&#125;</pre></div><p style="margin: 10px auto; padding: 0px">&nbsp; 普通函数添加*号后则成为了成为了生成器函数了。</p><div class="cnblogs_code" style="margin: 5px 0px; padding: 5px; border: 1px solid #cccccc; overflow: auto; color: #000000; font-family: 'Courier New' !important; font-size: 12px !important; background-color: #f5f5f5"><pre style="margin-top: 0px; margin-bottom: 0px; padding: 0px; white-space: pre-wrap; word-wrap: break-word; font-family: 'Courier New' !important; font-size: 12px !important">Object.prototype.toString.call(test) <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> 显示[object GeneratorFunction]</span></pre></div><p style="margin: 10px auto; padding: 0px">&nbsp; 生成器函数的行为与普通函数并不相同，表现为如下3点：</p><p style="margin: 10px auto; padding: 0px">&nbsp; 1. 通过new运算符或函数调用的形式调用生成器函数，均会返回一个生成器实例；</p><p style="margin: 10px auto; padding: 0px">&nbsp; 2.&nbsp;通过new运算符或函数调用的形式调用生成器函数，均不会马上执行函数体的代码；</p><p style="margin: 10px auto; padding: 0px">&nbsp; 3. 必须调用生成器实例的next方法才会执行生成器函数体的代码。</p><div class="cnblogs_code" style="margin: 5px 0px; padding: 5px; border: 1px solid #cccccc; overflow: auto; color: #000000; font-family: 'Courier New' !important; font-size: 12px !important; background-color: #f5f5f5"><pre style="margin-top: 0px; margin-bottom: 0px; padding: 0px; white-space: pre-wrap; word-wrap: break-word; font-family: 'Courier New' !important; font-size: 12px !important">function *<span style="margin: 0px; padding: 0px; line-height: 1.8">say(msg)&#123;&nbsp;&nbsp; console.log(msg) &#125; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> gen = say(<span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">hello world</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span>) <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> 没有显示hello world</span> console.log(Object.prototype.toString.call(gen)) <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> 显示[object Generator]</span> gen.next() <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> 显示hello world</span></pre></div><p style="margin: 10px auto; padding: 0px"><span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 15px"><strong style="margin: 0px; padding: 0px">&nbsp; 2、 关键字yield&mdash;&mdash;迭代器生成器</strong></span></p><p style="margin: 10px auto; padding: 0px">&nbsp;&nbsp; 用于马上退出代码块并保留现场，当执行迭代器的next函数时，则能从退出点恢复现场并继续执行下去。下面有2点需要注意：</p><p style="margin: 10px auto; padding: 0px">&nbsp;&nbsp;&nbsp; 1. yield后面的表达式将作为迭代器next函数的返回值；</p><p style="margin: 10px auto; padding: 0px">&nbsp;&nbsp;&nbsp; 2. 迭代器next函数的入参将作为yield的返回值（有点像运算符）。</p><p style="margin: 10px auto; padding: 0px"><span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 15px"><strong style="margin: 0px; padding: 0px">&nbsp; 3、迭代器(Generator)</strong></span></p><p style="margin: 10px auto; padding: 0px">&nbsp; &nbsp; 迭代器是一个拥有&nbsp;<span style="margin: 5px 0px; padding: 3px; border: 1px solid #cccccc; overflow: auto; line-height: 1.8; font-size: 12px !important; font-family: 'Courier New'; color: #000000; background-color: #f5f5f5" class="cnblogs_code">&#123;value:&#123;*&#125;, done:&#123;Boolean&#125;&#125; next([*])方法</span>&nbsp;和&nbsp;<span style="margin: 5px 0px; padding: 3px; border: 1px solid #cccccc; overflow: auto; line-height: 1.8; font-size: 12px !important; font-family: 'Courier New'; color: #000000; background-color: #f5f5f5" class="cnblogs_code">&#123;undefined&#125;&nbsp;<span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">throw</span>([*])方法</span>&nbsp;的对象，通过next函数不断执行以关键字yield分割的代码段，通过throw函数令yield分割的代码段抛出异常。</p><p style="margin: 10px auto; padding: 0px">&nbsp;</p><p style="margin: 10px auto; padding: 0px"><span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 18px; background-color: #888888"><strong style="margin: 0px; padding: 0px">三、核心1&mdash;&mdash;迭代器　　　　　　　　　　　　　　　　　　　　　&nbsp;&nbsp;<br /></strong></span></p><p style="margin: 10px auto; padding: 0px">&nbsp; 迭代器更多的是指迭代器模式，迭代器模式是指通过一个名为迭代器的对象按一定的规则遍历集合元素，调用者只需告诉迭代器获取下一个元素即可，而集合的类型、如何获取元素等因素均由具体的迭代器自行处理。（又一次地关注点分离！）并且由于迭代器模式可以做到 按需执行/延迟执行 的效果，因此能降低遍历无限序列时内存/栈溢出的问题，也能作为异步编程模式使用。</p><p style="margin: 10px auto; padding: 0px"><strong style="margin: 0px; padding: 0px">&nbsp; 模式理解的注意点：</strong></p><p style="margin: 10px auto; padding: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1. 迭代器每次进访问集合的一个元素，并由调用者发起访问请求时迭代器才执行下一次访问操作</p><p style="margin: 10px auto; padding: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2. &ldquo;按一定的规则&rdquo;，意味着不一定遍历集合中所有的元素，并且规则可以内聚到迭代器的具体实现上，也可通过策略模式外移到其他模块中；</p><p style="margin: 10px auto; padding: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3. &ldquo;集合&rdquo;，集合可以是一开始就已经初始化好的有限序列集合（如[1,2,3,4,5,6,7]），也可以是按需生成的无限序列集合（如1到无限大）</p><p style="margin: 10px auto; padding: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4. &ldquo;集合元素&rdquo;，可以是整数集合、字符串集合等数据集合，也可以是函数等指令+数据的集合；</p><p style="margin: 10px auto; padding: 0px">&nbsp; 若触过C#、Java等服务端语句的朋友应该对迭代器有一定程度的了解，C#的IEnumrable、IEnumerator和Java的Iterable、Iterator就是跟迭代器相关的接口定义，继承上述接口的迭代器实现均可以通过foreach或for...in语句作循环操作。</p><p style="margin: 10px auto; padding: 0px"><strong style="margin: 0px; padding: 0px">&nbsp; 那么这里有2点是要注意的：</strong></p><p style="margin: 10px auto; padding: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1. 迭代器是指设计模式，跟具体的语言无关，因此所有语言均可根据该模式实现具体的迭代器；</p><p style="margin: 10px auto; padding: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2. foreach或for...in语句是语法层面的支持，跟迭代器模式没有必然联系。（若语法层面不支持，那函数式编程中的递归的效果是一样的，假如编译器/解析器支持尾递归则更好了，可以JS不支持）</p><p style="margin: 10px auto; padding: 0px">&nbsp; 下面我们通过迭代器来实现Python中的range函数，并通过range函数创建一个超大的有限序列正整数集合（直接用数组的话绝有可能导致栈溢出哦！）。</p><div class="cnblogs_code" style="margin: 5px 0px; padding: 5px; border: 1px solid #cccccc; overflow: auto; color: #000000; font-family: 'Courier New' !important; font-size: 12px !important; background-color: #f5f5f5"><div class="cnblogs_code_toolbar" style="margin: 5px 0px 0px; padding: 0px"><span style="margin: 0px; padding: 0px 5px 0px 0px; line-height: 1.8" class="cnblogs_code_copy"><a style="margin: 0px; padding: 0px; border: none !important" title="复制代码"><img style="margin: 0px; padding: 0px; max-width: 900px; border: none !important" src="copycode.gif" tppabs="http://common.cnblogs.com/images/copycode.gif" border="0" alt="复制代码" /></a></span></div><pre style="margin-top: 0px; margin-bottom: 0px; padding: 0px; white-space: pre-wrap; word-wrap: break-word; font-family: 'Courier New' !important; font-size: 12px !important"><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> 迭代器构造函数</span> <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> RangeIterator =<span style="margin: 0px; padding: 0px; line-height: 1.8"> function(start,end,scan)&#123;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">this</span>.start = arguments.length &gt;= <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800080">2</span> ? start : <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800080">0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">this</span>.end = end == undefined ?<span style="margin: 0px; padding: 0px; line-height: 1.8"> start : end&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">this</span>.scan = scan &#124;&#124; <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800080">1</span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">this</span>.idx = <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">this</span><span style="margin: 0px; padding: 0px; line-height: 1.8">.start &#125; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> 向迭代器发起访问下一个元素的请求 </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> FF和ES6下迭代器接口规范定义了迭代器必须通过名为next的函数发起访问下一个元素的请求</span> RangeIterator.prototype.next =<span style="margin: 0px; padding: 0px; line-height: 1.8"> function()&#123;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">if</span> (<span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">this</span>.idx &gt; <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">this</span><span style="margin: 0px; padding: 0px; line-height: 1.8">.end)&nbsp;&nbsp;　　　　</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">if</span> (!!<span style="margin: 0px; padding: 0px; line-height: 1.8">StopIteration) &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;　　</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">throw</span><span style="margin: 0px; padding: 0px; line-height: 1.8"> StopIteration&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125;</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">else</span><span style="margin: 0px; padding: 0px; line-height: 1.8">&#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">return</span> <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">void</span> <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800080">0</span><span style="margin: 0px; padding: 0px; line-height: 1.8">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> ret = <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">this</span><span style="margin: 0px; padding: 0px; line-height: 1.8">.idx&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">this</span>.idx += <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">this</span><span style="margin: 0px; padding: 0px; line-height: 1.8">.scan&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">return</span><span style="margin: 0px; padding: 0px; line-height: 1.8"> ret &#125; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> Python中的range函数</span> <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> range =<span style="margin: 0px; padding: 0px; line-height: 1.8"> function(start, end, scan)&#123;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> iterator = <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">new</span><span style="margin: 0px; padding: 0px; line-height: 1.8"> RangeIterator(start, end, scan)&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">return</span><span style="margin: 0px; padding: 0px; line-height: 1.8"> &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> FF下令for...in语句调用对象的迭代器的接口规范</span> <span style="margin: 0px; padding: 0px; line-height: 1.8">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;__iterator__: function()&#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">return</span><span style="margin: 0px; padding: 0px; line-height: 1.8"> iterator&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125;,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> 暴露迭代器的next函数</span> <span style="margin: 0px; padding: 0px; line-height: 1.8">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next: function()&#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">return</span><span style="margin: 0px; padding: 0px; line-height: 1.8"> iterator.next()&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125;,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; toString: function()&#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> 可能会导致栈溢出</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> array =<span style="margin: 0px; padding: 0px; line-height: 1.8"> []&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">for</span> (<span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> i = <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">this</span>.next(); i != <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">void</span> <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800080">0</span>; i = <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">this</span><span style="margin: 0px; padding: 0px; line-height: 1.8">.next())&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; array.push(i)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">return</span> array + <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">''</span><span style="margin: 0px; padding: 0px; line-height: 1.8">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125; &#125; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> r = range(<span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800080">1</span>, <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800080">100000000000000000000</span><span style="margin: 0px; padding: 0px; line-height: 1.8">) </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> FF下 </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> 参考：</span><span style="margin: 0px; padding: 0px; line-height: 1.8; text-decoration: underline; color: #008000">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Iterators_and_Generators</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">#.E5.AE.9A.E4.B9.89.E8.87.AA.E5.AE.9A.E4.B9.89.E8.BF.AD.E4.BB.A3.E5.99.A8</span> <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">for</span>(<span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> i <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">in</span><span style="margin: 0px; padding: 0px; line-height: 1.8"> r)&nbsp;&nbsp; console.log(i) </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> 显示1到99999999999999999999 </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> 所有浏览器</span> <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">for</span> (<span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> i = r.next(); i != <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">void</span> <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800080">0</span>; i =<span style="margin: 0px; padding: 0px; line-height: 1.8"> r.next())&nbsp;&nbsp; console.log(i) </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> 显示1到99999999999999999999</span></pre><div class="cnblogs_code_toolbar" style="margin: 5px 0px 0px; padding: 0px"><span style="margin: 0px; padding: 0px 5px 0px 0px; line-height: 1.8" class="cnblogs_code_copy"><a style="margin: 0px; padding: 0px; border: none !important" title="复制代码"><img style="margin: 0px; padding: 0px; max-width: 900px; border: none !important" src="copycode.gif" tppabs="http://common.cnblogs.com/images/copycode.gif" border="0" alt="复制代码" /></a></span></div></div><p style="margin: 10px auto; padding: 0px">&nbsp; 由于JS是单线程运行，并且当UI线程被阻塞N秒后，浏览器会询问是否停止脚本的执行，但上述代码并不会由于序列过大造成栈溢出的问题。假如预先生成1到<span style="margin: 0px; padding: 0px; line-height: 1.8; color: #000000">99999999999999999999或更大数字</span>的数组，那很有可能造成stack overflow。那是由于迭代器实质为一状态机，而调用next函数则是触发状态的转换，而状态机中同一时刻用于存放变量的存储空间固定，并不会出现无限增长的情况。</p><p style="margin: 10px auto; padding: 0px">&nbsp;</p><p style="margin: 10px auto; padding: 0px"><span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 18px; background-color: #888888"><strong style="margin: 0px; padding: 0px">四、核心2&mdash;&mdash;yield关键字　　　　　　　　　　　　　　　　　　&nbsp;&nbsp;<br /></strong></span></p><p style="margin: 10px auto; padding: 0px">&nbsp;&nbsp; 回到关键字yield上了，其实yield关键字就是以一种更直观、便捷的方式让我们创建用于遍历有限序列集合的迭代器，而yield则用于将生成器函数的代码切片作为有限序列集合的元素（元素的类型为指令+数据，而不仅仅是数据而已）。下面我们一起看看yield关键字是怎样对代码切片的吧！</p><div class="cnblogs_code" style="margin: 5px 0px; padding: 5px; border: 1px solid #cccccc; overflow: auto; color: #000000; font-family: 'Courier New' !important; font-size: 12px !important; background-color: #f5f5f5"><div class="cnblogs_code_toolbar" style="margin: 5px 0px 0px; padding: 0px"><span style="margin: 0px; padding: 0px 5px 0px 0px; line-height: 1.8" class="cnblogs_code_copy"><a style="margin: 0px; padding: 0px; border: none !important" title="复制代码"><img style="margin: 0px; padding: 0px; max-width: 900px; border: none !important" src="copycode.gif" tppabs="http://common.cnblogs.com/images/copycode.gif" border="0" alt="复制代码" /></a></span></div><pre style="margin-top: 0px; margin-bottom: 0px; padding: 0px; white-space: pre-wrap; word-wrap: break-word; font-family: 'Courier New' !important; font-size: 12px !important"><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> 定义生成器函数</span> function *<span style="margin: 0px; padding: 0px; line-height: 1.8">enumerable(msg)&#123;&nbsp;&nbsp; console.log(msg)&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> msg1 = <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">yield</span> msg + <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">&nbsp;&nbsp;after </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8">&nbsp;&nbsp; console.log(msg1)&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> msg2 = <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">yield</span> msg1 + <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000"> after</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8">&nbsp;&nbsp; console.log(msg2 </span>+ <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000"> over</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8">) &#125;</span></pre><div class="cnblogs_code_toolbar" style="margin: 5px 0px 0px; padding: 0px"><span style="margin: 0px; padding: 0px 5px 0px 0px; line-height: 1.8" class="cnblogs_code_copy"><a style="margin: 0px; padding: 0px; border: none !important" title="复制代码"><img style="margin: 0px; padding: 0px; max-width: 900px; border: none !important" src="copycode.gif" tppabs="http://common.cnblogs.com/images/copycode.gif" border="0" alt="复制代码" /></a></span></div></div><p style="margin: 10px auto; padding: 0px">&nbsp; 上述代码最终会被解析为下面的代码：</p><div class="cnblogs_code" style="margin: 5px 0px; padding: 5px; border: 1px solid #cccccc; overflow: auto; color: #000000; font-family: 'Courier New' !important; font-size: 12px !important; background-color: #f5f5f5"><div class="cnblogs_code_toolbar" style="margin: 5px 0px 0px; padding: 0px"><span style="margin: 0px; padding: 0px 5px 0px 0px; line-height: 1.8" class="cnblogs_code_copy"><a style="margin: 0px; padding: 0px; border: none !important" title="复制代码"><img style="margin: 0px; padding: 0px; max-width: 900px; border: none !important" src="copycode.gif" tppabs="http://common.cnblogs.com/images/copycode.gif" border="0" alt="复制代码" /></a></span></div><pre style="margin-top: 0px; margin-bottom: 0px; padding: 0px; white-space: pre-wrap; word-wrap: break-word; font-family: 'Courier New' !important; font-size: 12px !important"><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> enumerable =<span style="margin: 0px; padding: 0px; line-height: 1.8"> function(msg)&#123;&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> state = -<span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800080">1</span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">return</span><span style="margin: 0px; padding: 0px; line-height: 1.8"> &#123;&nbsp;&nbsp;&nbsp;&nbsp; next: function(val)&#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">switch</span>(++<span style="margin: 0px; padding: 0px; line-height: 1.8">state)&#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">case</span> <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800080">0</span><span style="margin: 0px; padding: 0px; line-height: 1.8">:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; console.log(msg </span>+ <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000"> after</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8">)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">break</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">case</span> <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800080">1</span><span style="margin: 0px; padding: 0px; line-height: 1.8">:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> msg1 =<span style="margin: 0px; padding: 0px; line-height: 1.8"> val&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; console.log(msg1 </span>+ <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000"> after</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8">)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">break</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">case</span> <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800080">2</span><span style="margin: 0px; padding: 0px; line-height: 1.8">:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> msg2 =<span style="margin: 0px; padding: 0px; line-height: 1.8"> val&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; console.log(msg2 </span>+ <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000"> over</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8">)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">break</span><span style="margin: 0px; padding: 0px; line-height: 1.8">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125;&nbsp;&nbsp;&nbsp;&nbsp; &#125;&nbsp;&nbsp; &#125; &#125;</span></pre><div class="cnblogs_code_toolbar" style="margin: 5px 0px 0px; padding: 0px"><span style="margin: 0px; padding: 0px 5px 0px 0px; line-height: 1.8" class="cnblogs_code_copy"><a style="margin: 0px; padding: 0px; border: none !important" title="复制代码"><img style="margin: 0px; padding: 0px; max-width: 900px; border: none !important" src="copycode.gif" tppabs="http://common.cnblogs.com/images/copycode.gif" border="0" alt="复制代码" /></a></span></div></div><p style="margin: 10px auto; padding: 0px">(注意：上述仅仅简单的分析，更复杂的情况（条件控制、循环、迭代、异常捕获处理等）可以参考@赵劼的<a style="margin: 0px; padding: 0px; text-decoration: none; color: #000000; border-bottom-width: 1px; border-bottom-style: dotted; border-bottom-color: #333333" href="javascript:if(confirm('http://blog.zhaojie.me/2010/01/decompile-methods-with-yield-manually.html  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://blog.zhaojie.me/2010/01/decompile-methods-with-yield-manually.html'" tppabs="http://blog.zhaojie.me/2010/01/decompile-methods-with-yield-manually.html" target="_blank">《人肉反编译使用关键字yield的方法》</a>)</p><p style="margin: 10px auto; padding: 0px">&nbsp;</p><p style="margin: 10px auto; padding: 0px">&nbsp;<span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 18px; background-color: #888888"><strong style="margin: 0px; padding: 0px">五、异步调用中的应用　　　　　　　　　　　　　　　　　　　 &nbsp; &nbsp;</strong></span></p><p style="margin: 10px auto; padding: 0px"><span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 15px">&nbsp; 由于迭代器模式实现 延迟执行/按需执行，因此可作为一种异步编程模式来应用。</span></p><div class="cnblogs_code" style="margin: 5px 0px; padding: 5px; border: 1px solid #cccccc; overflow: auto; color: #000000; font-family: 'Courier New' !important; font-size: 12px !important; background-color: #f5f5f5"><div class="cnblogs_code_toolbar" style="margin: 5px 0px 0px; padding: 0px"><span style="margin: 0px; padding: 0px 5px 0px 0px; line-height: 1.8" class="cnblogs_code_copy"><a style="margin: 0px; padding: 0px; border: none !important" title="复制代码"><img style="margin: 0px; padding: 0px; max-width: 900px; border: none !important" src="copycode.gif" tppabs="http://common.cnblogs.com/images/copycode.gif" border="0" alt="复制代码" /></a></span></div><pre style="margin-top: 0px; margin-bottom: 0px; padding: 0px; white-space: pre-wrap; word-wrap: break-word; font-family: 'Courier New' !important; font-size: 12px !important"><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> iterator = getArticles(<span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">dummy.json</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8">) </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> 开始执行</span> <span style="margin: 0px; padding: 0px; line-height: 1.8">iterator.next() </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> 异步任务模型</span> <span style="margin: 0px; padding: 0px; line-height: 1.8">function getData(src)&#123;&nbsp;&nbsp; setTimeout(function()&#123;&nbsp;&nbsp;&nbsp;&nbsp; iterator.next(&#123;tpl: </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">tpl.html</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span>, name: <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">fsjohnhuang</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8">&#125;)&nbsp;&nbsp; &#125;, </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800080">1000</span><span style="margin: 0px; padding: 0px; line-height: 1.8">) &#125; function getTpl(tpl)&#123;&nbsp;&nbsp; setTimeout(function()&#123;&nbsp;&nbsp;&nbsp;&nbsp; iterator.next(</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">hello $&#123;name&#125;</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8">)&nbsp;&nbsp; &#125;, </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800080">3000</span><span style="margin: 0px; padding: 0px; line-height: 1.8">) &#125;<br />// 同步任务 function render(data, tpl)&#123;&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">return</span> tpl.replace(/&#92;$&#92;&#123;(&#92;w+)&#92;&#125;/<span style="margin: 0px; padding: 0px; line-height: 1.8">, function()&#123;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">return</span> data[arguments[<span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800080">1</span>]] ==&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">void</span> <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800080">0</span> ? arguments[<span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800080">0</span>] : data[arguments[<span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800080">1</span><span style="margin: 0px; padding: 0px; line-height: 1.8">]]&nbsp;&nbsp; &#125;) &#125;&nbsp;&nbsp;</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> 主逻辑</span> function *<span style="margin: 0px; padding: 0px; line-height: 1.8">getAritcles(src)&#123;&nbsp;&nbsp; console.log(</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">begin</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8">)&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> data = <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">yield</span><span style="margin: 0px; padding: 0px; line-height: 1.8"> getData(src)&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> tpl = <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">yield</span><span style="margin: 0px; padding: 0px; line-height: 1.8"> getTpl(data.tpl)&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> res =<span style="margin: 0px; padding: 0px; line-height: 1.8"> render(data, tpl)&nbsp;&nbsp; console.log(rest) &#125;</span></pre><div class="cnblogs_code_toolbar" style="margin: 5px 0px 0px; padding: 0px"><span style="margin: 0px; padding: 0px 5px 0px 0px; line-height: 1.8" class="cnblogs_code_copy"><a style="margin: 0px; padding: 0px; border: none !important" title="复制代码"><img style="margin: 0px; padding: 0px; max-width: 900px; border: none !important" src="copycode.gif" tppabs="http://common.cnblogs.com/images/copycode.gif" border="0" alt="复制代码" /></a></span></div></div><p style="margin: 10px auto; padding: 0px">&nbsp; 主逻辑中异步调用的写法与同步调用的基本没差异了，爽了吧！但异步任务模型与生成器函数及其生成的迭代器耦合性太大，还是不太好用。下面我们通过实现了Promises/A+规范的Q来进一步解耦。</p><p style="margin: 10px auto; padding: 0px">&nbsp; 若执行引擎不支持关键字yield，那么上述代码不就无法执行了吗？还是那句话，yield关键字其实就是语法糖，最终还是会被解析为一个迭代器。因此我们自行实现一个迭代器也是能实现上述效果的，不过过程会繁琐很多（若如第2节的示例那样存在try...catch语句，就繁琐死了@~@），并且代码的整洁性、可维护性就全靠攻城狮来保证了。（语法糖从语法层面简化编程和维护难度，但理解底层的工作原理也十分重要哦！）</p><p style="margin: 10px auto; padding: 0px">&nbsp;</p><p style="margin: 10px auto; padding: 0px"><span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 18px; background-color: #888888"><strong style="margin: 0px; padding: 0px">六、与Q结合　　　　　　　　　　　　　　　　　　　　　　　　</strong></span></p><div class="cnblogs_code" style="margin: 5px 0px; padding: 5px; border: 1px solid #cccccc; overflow: auto; color: #000000; font-family: 'Courier New' !important; font-size: 12px !important; background-color: #f5f5f5"><div class="cnblogs_code_toolbar" style="margin: 5px 0px 0px; padding: 0px"><span style="margin: 0px; padding: 0px 5px 0px 0px; line-height: 1.8" class="cnblogs_code_copy"><a style="margin: 0px; padding: 0px; border: none !important" title="复制代码"><img style="margin: 0px; padding: 0px; max-width: 900px; border: none !important" src="copycode.gif" tppabs="http://common.cnblogs.com/images/copycode.gif" border="0" alt="复制代码" /></a></span></div><pre style="margin-top: 0px; margin-bottom: 0px; padding: 0px; white-space: pre-wrap; word-wrap: break-word; font-family: 'Courier New' !important; font-size: 12px !important"><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> 异步任务模型</span> <span style="margin: 0px; padding: 0px; line-height: 1.8">function getData(src)&#123;&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> deferred =<span style="margin: 0px; padding: 0px; line-height: 1.8"> Q.defer()&nbsp;&nbsp; setTimeout(function()&#123;&nbsp;&nbsp;&nbsp;&nbsp;defer.resolve(&#123;tpl: </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">tpl.html</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span>, name: <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">fsjohnhuang</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8">&#125;)&nbsp;&nbsp; &#125;, </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800080">1000</span><span style="margin: 0px; padding: 0px; line-height: 1.8">)&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">return</span><span style="margin: 0px; padding: 0px; line-height: 1.8"> deferred.promise &#125; function getTpl(tpl)&#123;&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> deferred =<span style="margin: 0px; padding: 0px; line-height: 1.8"> Q.defer()&nbsp;&nbsp; setTimeout(function()&#123;&nbsp;&nbsp;&nbsp;&nbsp;defer.resolve(</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">hello $&#123;name&#125;</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8">)&nbsp;&nbsp; &#125;, </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800080">3000</span><span style="margin: 0px; padding: 0px; line-height: 1.8">)&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">return</span><span style="margin: 0px; padding: 0px; line-height: 1.8"> deferred.promise &#125; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> 同步任务</span> <span style="margin: 0px; padding: 0px; line-height: 1.8">function render(data, tpl)&#123;&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">return</span> tpl.replace(/&#92;$&#92;&#123;(&#92;w+)&#92;&#125;/<span style="margin: 0px; padding: 0px; line-height: 1.8">, function()&#123;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">return</span> data[arguments[<span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800080">1</span>]] ==&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">void</span> <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800080">0</span> ? arguments[<span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800080">0</span>] : data[arguments[<span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800080">1</span><span style="margin: 0px; padding: 0px; line-height: 1.8">]]&nbsp;&nbsp; &#125;) &#125;&nbsp;&nbsp;</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> 主逻辑</span> Q.<span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">async</span>(function *<span style="margin: 0px; padding: 0px; line-height: 1.8">()&#123;&nbsp;&nbsp; console.log(</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">begin</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8">)&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> data = <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">yield</span> getData(<span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">dummy.json</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8">)&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> tpl = <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">yield</span><span style="margin: 0px; padding: 0px; line-height: 1.8"> getTpl(data.tpl)&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> res =<span style="margin: 0px; padding: 0px; line-height: 1.8"> render(data, tpl)&nbsp;&nbsp; console.log(rest) &#125;)</span></pre><div class="cnblogs_code_toolbar" style="margin: 5px 0px 0px; padding: 0px"><span style="margin: 0px; padding: 0px 5px 0px 0px; line-height: 1.8" class="cnblogs_code_copy"><a style="margin: 0px; padding: 0px; border: none !important" title="复制代码"><img style="margin: 0px; padding: 0px; max-width: 900px; border: none !important" src="copycode.gif" tppabs="http://common.cnblogs.com/images/copycode.gif" border="0" alt="复制代码" /></a></span></div></div><p style="margin: 10px auto; padding: 0px">&nbsp; 暂未阅读Q的源代码，暂不作详细分析。反正API就这样用，呵呵！</p><p style="margin: 10px auto; padding: 0px">&nbsp;</p><p style="margin: 10px auto; padding: 0px"><span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 18px; background-color: #888888"><strong style="margin: 0px; padding: 0px">七、与iPromise结合　　　　　　　　　　　　　　　　　　　　</strong></span></p><p style="margin: 10px auto; padding: 0px">&nbsp; iPromise是我开发的一个Promises/A+的完整实现，阅读源码你会发现它继承了jQuery.Deferred1.5~2.1、jsDeferred、mmDeferred和Promises/A官网实现示例的精妙设计，并且从v0.0.6开始支持ES6特性GeneratorFunction。使用示例如下：</p><div class="cnblogs_code" style="margin: 5px 0px; padding: 5px; border: 1px solid #cccccc; overflow: auto; color: #000000; font-family: 'Courier New' !important; font-size: 12px !important; background-color: #f5f5f5"><div class="cnblogs_code_toolbar" style="margin: 5px 0px 0px; padding: 0px"><span style="margin: 0px; padding: 0px 5px 0px 0px; line-height: 1.8" class="cnblogs_code_copy"><a style="margin: 0px; padding: 0px; border: none !important" title="复制代码"><img style="margin: 0px; padding: 0px; max-width: 900px; border: none !important" src="copycode.gif" tppabs="http://common.cnblogs.com/images/copycode.gif" border="0" alt="复制代码" /></a></span></div><pre style="margin-top: 0px; margin-bottom: 0px; padding: 0px; white-space: pre-wrap; word-wrap: break-word; font-family: 'Courier New' !important; font-size: 12px !important"><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> getData =<span style="margin: 0px; padding: 0px; line-height: 1.8"> function(dataSrc)&#123;&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">return</span><span style="margin: 0px; padding: 0px; line-height: 1.8"> iPromise(function(r)&#123;&nbsp;&nbsp;&nbsp;&nbsp; setTimeout(function()&#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; r(dataSrc </span>+ <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000"> has loaded</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8">)&nbsp;&nbsp;&nbsp;&nbsp; &#125;, </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800080">1000</span><span style="margin: 0px; padding: 0px; line-height: 1.8">)&nbsp;&nbsp; &#125;) &#125; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> getTpl =<span style="margin: 0px; padding: 0px; line-height: 1.8"> function(tplSrc)&#123;&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">return</span><span style="margin: 0px; padding: 0px; line-height: 1.8"> iPromise(function(r)&#123;&nbsp;&nbsp;&nbsp;&nbsp; setTimeout(function()&#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; r(tplStr </span>+ <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000"> has loaded</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8">)&nbsp;&nbsp;&nbsp;&nbsp; &#125;, </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800080">2000</span><span style="margin: 0px; padding: 0px; line-height: 1.8">)&nbsp;&nbsp; &#125;) &#125; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> render =<span style="margin: 0px; padding: 0px; line-height: 1.8"> function(data, tpl)&#123;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">throw</span> <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">new</span> Error(<span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">OMG!</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8">) &#125;<br /> iPromise(function </span>*<span style="margin: 0px; padding: 0px; line-height: 1.8">(dataSrc, tplSrc)&#123;&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">try</span><span style="margin: 0px; padding: 0px; line-height: 1.8">&#123;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> data = <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">yield</span><span style="margin: 0px; padding: 0px; line-height: 1.8"> getData(dataSrc)&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> tpl = <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">yield</span><span style="margin: 0px; padding: 0px; line-height: 1.8"> getTpl(tplSrc)&nbsp;&nbsp;&nbsp;&nbsp; render(data, tpl)&nbsp;&nbsp; &#125;&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">catch</span><span style="margin: 0px; padding: 0px; line-height: 1.8">(e)&#123;&nbsp;&nbsp;&nbsp;&nbsp; console.log(e)&nbsp;&nbsp; &#125;&nbsp;&nbsp; console.log(</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">over!</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8">) &#125;, </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">dummyData.json</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span>, <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">dummyTpl.json</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8">) </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">/*</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> 结果如下 </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">*/</span> <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> 等待1秒多显示 dummyData.json has loaded </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> 等待2秒多显示 dummyTpl.json has loaded </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> 显示 Error: OMG! </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">&nbsp;&nbsp;&nbsp;&nbsp; Stack trace: </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">&nbsp;&nbsp;&nbsp;&nbsp; test10/render/&lt;/&lt;@file:</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">/home/fsjohnhuang/repos/iPromise/test/v0.0.2.html:190:6 </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> 显示 over!</span></pre><div class="cnblogs_code_toolbar" style="margin: 5px 0px 0px; padding: 0px"><span style="margin: 0px; padding: 0px 5px 0px 0px; line-height: 1.8" class="cnblogs_code_copy"><a style="margin: 0px; padding: 0px; border: none !important" title="复制代码"><img style="margin: 0px; padding: 0px; max-width: 900px; border: none !important" src="copycode.gif" tppabs="http://common.cnblogs.com/images/copycode.gif" border="0" alt="复制代码" /></a></span></div></div><p style="margin: 10px auto; padding: 0px">v0.6.0的中通过递归来实现，具体如下（<a style="margin: 0px; padding: 0px; text-decoration: none; color: #000000; border-bottom-width: 1px; border-bottom-style: dotted; border-bottom-color: #333333" href="javascript:if(confirm('https://github.com/fsjohnhuang/iPromise/blob/master/src/iPromise.js  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='https://github.com/fsjohnhuang/iPromise/blob/master/src/iPromise.js#L76'" tppabs="https://github.com/fsjohnhuang/iPromise/blob/master/src/iPromise.js#L76" target="_blank">https://github.com/fsjohnhuang/iPromise/blob/master/src/iPromise.js#L76</a>）：</p><div class="cnblogs_code" style="margin: 5px 0px; padding: 5px; border: 1px solid #cccccc; overflow: auto; color: #000000; font-family: 'Courier New' !important; font-size: 12px !important; background-color: #f5f5f5"><div class="cnblogs_code_toolbar" style="margin: 5px 0px 0px; padding: 0px"><span style="margin: 0px; padding: 0px 5px 0px 0px; line-height: 1.8" class="cnblogs_code_copy"><a style="margin: 0px; padding: 0px; border: none !important" title="复制代码"><img style="margin: 0px; padding: 0px; max-width: 900px; border: none !important" src="copycode.gif" tppabs="http://common.cnblogs.com/images/copycode.gif" border="0" alt="复制代码" /></a></span></div><pre style="margin-top: 0px; margin-bottom: 0px; padding: 0px; white-space: pre-wrap; word-wrap: break-word; font-family: 'Courier New' !important; font-size: 12px !important"><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> FF下生成器函数的入参必须在创建迭代器时传递 </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> 若第一次调用迭代器的next函数传递参数，则会报TypeError: attempt to send 第一个入参值 to newborn generator</span> <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> iterator = mixin.apply(<span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">null</span>, toArray(arguments,<span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800080">1</span><span style="margin: 0px; padding: 0px; line-height: 1.8">)) </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> next =<span style="margin: 0px; padding: 0px; line-height: 1.8"> function()&#123; 　　</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> deferred =<span style="margin: 0px; padding: 0px; line-height: 1.8"> iPromise() 　　deferred.resolve.apply(deferred, arguments)&nbsp;&nbsp;　　</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">return</span><span style="margin: 0px; padding: 0px; line-height: 1.8"> deferred.then(function()&#123; 　　　　</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> yieldReturn =<span style="margin: 0px; padding: 0px; line-height: 1.8"> iterator.next.apply(iterator, arguments)&nbsp;&nbsp;&nbsp;&nbsp;　　</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">if</span>(yieldReturn.done) <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">throw</span> Error(<span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">StopIteration</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8">)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;　　&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">return</span><span style="margin: 0px; padding: 0px; line-height: 1.8"> yieldReturn.value 　　&#125;).then(next, function(e)&#123; 　　　　iterator.</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">throw</span><span style="margin: 0px; padding: 0px; line-height: 1.8">(e)<br />　　&#125;) &#125; deferred.resolve() deferred.then(next)</span></pre><div class="cnblogs_code_toolbar" style="margin: 5px 0px 0px; padding: 0px"><span style="margin: 0px; padding: 0px 5px 0px 0px; line-height: 1.8" class="cnblogs_code_copy"><a style="margin: 0px; padding: 0px; border: none !important" title="复制代码"><img style="margin: 0px; padding: 0px; max-width: 900px; border: none !important" src="copycode.gif" tppabs="http://common.cnblogs.com/images/copycode.gif" border="0" alt="复制代码" /></a></span></div></div><p style="margin: 10px auto; padding: 0px">&nbsp;</p><p style="margin: 10px auto; padding: 0px"><span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 18px; background-color: #888888"><strong style="margin: 0px; padding: 0px">八、总结　　　　　　　　　　　　　　　　　　　　　　　　　　</strong></span></p><p style="margin: 10px auto; padding: 0px">&nbsp; Generator Function并不是为异步编程而生，但可以将它结合Promise来实现良好的异步编程模型。本篇内容仅简单介绍Generator Function及相关的异步编程内容，若有纰漏请各位指正，谢谢！</p><p style="margin: 10px auto; padding: 0px">&nbsp; 尊重原创，转载请注明来自：<a id="Editor_Edit_hlEntryLink" style="margin: 0px; padding: 0px; text-decoration: none; color: #000000; border-bottom-width: 1px; border-bottom-style: dotted; border-bottom-color: #333333" href="javascript:if(confirm('http://www.cnblogs.com/fsjohnhuang/p/4166267.html  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.cnblogs.com/fsjohnhuang/p/4166267.html'" tppabs="http://www.cnblogs.com/fsjohnhuang/p/4166267.html" target="_blank" title="view: JS魔法堂：ES6新特性&mdash;&mdash;GeneratorFunction介绍">http://www.cnblogs.com/fsjohnhuang/p/4166267.html</a>&nbsp;^_^肥仔John</p><p style="margin: 10px auto; padding: 0px">&nbsp;</p><p style="margin: 10px auto; padding: 0px"><span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 18px; background-color: #888888"><strong style="margin: 0px; padding: 0px">九、 参考　　　　　　　　　　　　　　　　　　　　　　　　　　</strong></span></p><p style="margin: 10px auto; padding: 0px">http://huangj.in/765</p><p style="margin: 10px auto; padding: 0px">https://www.imququ.com/post/generator-function-in-es6.html</p><p style="margin: 10px auto; padding: 0px">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/The_Iterator_protocol</p><p style="margin: 10px auto; padding: 0px">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/function*</p><p style="margin: 10px auto; padding: 0px">http://www.cnblogs.com/yangecnu/archive/2012/03/17/2402432.html</p><p style="margin: 10px auto; padding: 0px">http://www.cnblogs.com/draem0507/p/3795189.html</p><p style="margin: 10px auto; padding: 0px">http://blog.zhaojie.me/2010/06/code-for-fun-iterator-generator-yield-in-javascript-answer-2-loop-and-interpreter.html</p><p style="margin: 10px auto; padding: 0px">http://blog.zhaojie.me/2010/06/code-for-fun-iterator-generator-yield-in-javascript.html</p><p style="margin: 10px auto; padding: 0px">http://blog.zhaojie.me/2010/07/why-java-sucks-and-csharp-rocks-6-yield.html</p></div><div id="MySignature" style="margin: 0px; padding: 0px; color: #333333; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px"><p style="margin: 12px 0px 0px; padding: 0px">如果您觉得本文的内容有趣就扫一下吧！捐赠互勉！</p></div>
	</div>
	<div class="textbox-bottom">
	</div>
	<div class="tags" style="display: none"> 
	</div>
</div><div class="textbox">
	<div class="textbox-calendar">
	<span class="textbox-calendar-month">Aug</span>
	<span class="textbox-calendar-day">29</span>
	</div>
	<div class="textbox-title">
		<h4>
		<a href="read.php-7514.htm" tppabs="http://i.renjihe.com/blog/read.php?7514">Node.js最新技术栈之Promise篇</a> <span id="starid7514"><img src="unstarred.gif" tppabs="http://i.renjihe.com/blog/template/default/images/others/unstarred.gif" alt="" title="未加星标" border="0"/></span> <img src="blank.gif" tppabs="http://i.renjihe.com/blog/images/weather/blank.gif" alt="不指定" title="不指定"/>
		</h4>
		<div class="textbox-label">
		<a href="view.php-go=user_1.htm" tppabs="http://i.renjihe.com/blog/view.php?go=user_1" target="_blank">renjihe1988</a> , 14:35 , <a href="index.php-go=category_2.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_2" title="查看分类： 软件">软件</a> &raquo; <a href="index.php-go=category_13.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_13" title="查看分类： web">web</a> , <a href="read.php-7514.htm#reply" tppabs="http://i.renjihe.com/blog/read.php?7514#reply" title="发表您的评论">评论(0)</a> , <a href='javascript: void(0);' title="查看引用地址" onclick='showhidediv("tb7514");'>引用(0)</a> , <a href="read.php-7514.htm" tppabs="http://i.renjihe.com/blog/read.php?7514">阅读(2)</a> , Via 本站原创 
		</div>
	</div>
	<div id="tb7514" style="display: none;" class="textbox-tburl"><strong>引用功能被关闭了。</strong></div>
	
	<div class="textbox-content">
	<p style="margin: 0px 0px 1em; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">时间原因，阉割了很多内容，其实内容少点应该更容易理解的，以下是直播的全部内容</p><h1 style="margin: 30px 0px 15px; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; line-height: 40px; color: #333333; text-rendering: optimizeLegibility; font-size: 32.5px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #eeeeee">前言</h1><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">大家好，我是桑世龙，github和cnodejs上的i5ting，目前在天津创业，公司目前使用技术主要是nodejs，算所谓的MEAN（mongodb&nbsp;&nbsp;+ express + angular + node），所有代码都部署在阿里云上</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">我的名字i5ting，原因是我媳妇叫张婷，哈哈</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">闲言少叙，下面开始正题 《Node.js最新技术栈之Promise篇》</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">js流程控制的演进过程，分以下5部分</p><ul style="padding: 0px; margin: 0px 0px 10px 25px; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; font-size: 14px; line-height: 28px"><li style="line-height: 2em"><ol style="padding: 0px; margin: 0px 0px 0px 25px"><li style="line-height: 2em">回调函数Callbacks</li></ol></li><li style="line-height: 2em"><ol style="padding: 0px; margin: 0px 0px 0px 25px"><li style="line-height: 2em">异步JavaScript</li></ol></li><li style="line-height: 2em"><ol style="padding: 0px; margin: 0px 0px 0px 25px"><li style="line-height: 2em">Promise/a+</li></ol></li><li style="line-height: 2em"><ol style="padding: 0px; margin: 0px 0px 0px 25px"><li style="line-height: 2em">生成器Generators/ yield</li></ol></li><li style="line-height: 2em"><ol style="padding: 0px; margin: 0px 0px 0px 25px"><li style="line-height: 2em">Async/ await</li></ol></li></ul><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif"><img style="height: auto; max-width: 100%; vertical-align: middle; border: 0px; cursor: pointer" src="FgKu20kvFqHrkgpjbQxXkV1DmrG1.png" tppabs="http://dn-cnode.qbox.me/FgKu20kvFqHrkgpjbQxXkV1DmrG1" border="0" alt="1.png" /></p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">首先回调和异步是大家常见的，这里跳过，本节课主要讲promise/a+原理、实现和实践，并展望下一代的Generators/yield和Async/await等。</p><h1 style="margin: 30px 0px 15px; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; line-height: 40px; color: #333333; text-rendering: optimizeLegibility; font-size: 32.5px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #eeeeee">0）痛点</h1><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">我们知道nodejs的最大的优点是高并发，适合适合I/O密集型应用</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif"><img style="height: auto; max-width: 100%; vertical-align: middle; border: 0px; cursor: pointer" src="FlPgjSEeYky4OEsdWokPlzTnQVln.png" tppabs="http://dn-cnode.qbox.me/FlPgjSEeYky4OEsdWokPlzTnQVln" border="0" alt="arch.png" /></p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">每一个函数都是异步，并发上去了，但痛苦也来了，比如</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">我现在要执行4个步骤，依次执行，于是就有下面的代码</p><pre class="prettyprint" style="line-height: 22px; white-space: pre-wrap; padding: 0px 15px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 14px; color: #333333; border-radius: 0px; margin: 20px -10px; word-break: break-all; word-wrap: break-word; border-width: 1px 0px; border-style: none; border-color: initial; background: #f7f7f7"><span style="color: #000000" class="pln">step1</span><span style="color: #666600" class="pun">(</span><span style="color: #000088" class="kwd">function</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">value1</span><span style="color: #666600" class="pun">)</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; step2</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">value1</span><span style="color: #666600" class="pun">,</span><span style="color: #000000" class="pln"> </span><span style="color: #000088" class="kwd">function</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">value2</span><span style="color: #666600" class="pun">)</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; step3</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">value2</span><span style="color: #666600" class="pun">,</span><span style="color: #000000" class="pln"> </span><span style="color: #000088" class="kwd">function</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">value3</span><span style="color: #666600" class="pun">)</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; step4</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">value3</span><span style="color: #666600" class="pun">,</span><span style="color: #000000" class="pln"> </span><span style="color: #000088" class="kwd">function</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">value4</span><span style="color: #666600" class="pun">)</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #880000" class="com">// Do something with value4</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #666600" class="pun">&#125;);</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #666600" class="pun">&#125;);</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #666600" class="pun">&#125;);</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#125;);</span></pre><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">这里只有4个，那如果更多呢？会不会崩溃，反正我会</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">有解决办法么？</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">答案是就是：promise/a+规范，下面我们看一下promise/a+规范</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">我们再来个伏笔，看一下链式写法</p><h1 style="margin: 30px 0px 15px; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; line-height: 40px; color: #333333; text-rendering: optimizeLegibility; font-size: 32.5px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #eeeeee">链式写法</h1><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">先举个jQuery的链式写法例子</p><pre class="prettyprint" style="line-height: 22px; white-space: pre-wrap; padding: 0px 15px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 14px; color: #333333; border-radius: 0px; margin: 20px -10px; word-break: break-all; word-wrap: break-word; border-width: 1px 0px; border-style: none; border-color: initial; background: #f7f7f7"><span style="color: #000000" class="pln">$</span><span style="color: #666600" class="pun">(</span><span style="color: #008800" class="str">'#tab'</span><span style="color: #666600" class="pun">).</span><span style="color: #000000" class="pln">eq</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">$</span><span style="color: #666600" class="pun">(</span><span style="color: #000088" class="kwd">this</span><span style="color: #666600" class="pun">).</span><span style="color: #000000" class="pln">index</span><span style="color: #666600" class="pun">()).</span><span style="color: #000000" class="pln">show</span><span style="color: #666600" class="pun">().</span><span style="color: #000000" class="pln">siblings</span><span style="color: #666600" class="pun">().</span><span style="color: #000000" class="pln">hide</span><span style="color: #666600" class="pun">();</span></pre><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">链式写法的核心是：每个方法都返回this（自己看jquery源码）</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">下面举一个this的简单例子</p><pre class="prettyprint" style="line-height: 22px; white-space: pre-wrap; padding: 0px 15px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 14px; color: #333333; border-radius: 0px; margin: 20px -10px; word-break: break-all; word-wrap: break-word; border-width: 1px 0px; border-style: none; border-color: initial; background: #f7f7f7"><span style="color: #000088" class="kwd">var</span><span style="color: #000000" class="pln"> obj </span><span style="color: #666600" class="pun">=</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp; step1</span><span style="color: #666600" class="pun">:</span><span style="color: #000088" class="kwd">function</span><span style="color: #666600" class="pun">()&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; console</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">log</span><span style="color: #666600" class="pun">(</span><span style="color: #008800" class="str">'a'</span><span style="color: #666600" class="pun">);</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #000088" class="kwd">return</span><span style="color: #000000" class="pln"> </span><span style="color: #000088" class="kwd">this</span><span style="color: #666600" class="pun">;</span><span style="color: #000000" class="pln">&nbsp;&nbsp; </span><span style="color: #666600" class="pun">&#125;,</span><span style="color: #000000" class="pln">&nbsp;&nbsp; step2</span><span style="color: #666600" class="pun">:</span><span style="color: #000088" class="kwd">function</span><span style="color: #666600" class="pun">()&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; console</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">log</span><span style="color: #666600" class="pun">(</span><span style="color: #008800" class="str">'b'</span><span style="color: #666600" class="pun">);</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #000088" class="kwd">return</span><span style="color: #000000" class="pln"> </span><span style="color: #000088" class="kwd">this</span><span style="color: #666600" class="pun">;</span><span style="color: #000000" class="pln">&nbsp;&nbsp; </span><span style="color: #666600" class="pun">&#125;,</span><span style="color: #000000" class="pln">&nbsp;&nbsp; step3</span><span style="color: #666600" class="pun">:</span><span style="color: #000088" class="kwd">function</span><span style="color: #666600" class="pun">()&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; console</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">log</span><span style="color: #666600" class="pun">(</span><span style="color: #008800" class="str">'c'</span><span style="color: #666600" class="pun">);</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #000088" class="kwd">return</span><span style="color: #000000" class="pln"> </span><span style="color: #000088" class="kwd">this</span><span style="color: #666600" class="pun">;</span><span style="color: #000000" class="pln">&nbsp;&nbsp; </span><span style="color: #666600" class="pun">&#125;,</span><span style="color: #000000" class="pln">&nbsp;&nbsp; step4</span><span style="color: #666600" class="pun">:</span><span style="color: #000088" class="kwd">function</span><span style="color: #666600" class="pun">()&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; console</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">log</span><span style="color: #666600" class="pun">(</span><span style="color: #008800" class="str">'d'</span><span style="color: #666600" class="pun">);</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #000088" class="kwd">return</span><span style="color: #000000" class="pln"> </span><span style="color: #000088" class="kwd">this</span><span style="color: #666600" class="pun">;</span><span style="color: #000000" class="pln">&nbsp;&nbsp; </span><span style="color: #666600" class="pun">&#125;</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#125;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;console</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">log</span><span style="color: #666600" class="pun">(</span><span style="color: #008800" class="str">'-----&#92;n'</span><span style="color: #666600" class="pun">);</span><span style="color: #000000" class="pln"> obj</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">step1</span><span style="color: #666600" class="pun">().</span><span style="color: #000000" class="pln">step2</span><span style="color: #666600" class="pun">().</span><span style="color: #000000" class="pln">step3</span><span style="color: #666600" class="pun">();</span><span style="color: #000000" class="pln"> console</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">log</span><span style="color: #666600" class="pun">(</span><span style="color: #008800" class="str">'-----&#92;n'</span><span style="color: #666600" class="pun">);</span><span style="color: #000000" class="pln"> obj</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">step4</span><span style="color: #666600" class="pun">().</span><span style="color: #000000" class="pln">step2</span><span style="color: #666600" class="pun">().</span><span style="color: #000000" class="pln">step1</span><span style="color: #666600" class="pun">();</span></pre><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">这只是一个简单返回this的链式写法而已</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">执行结果</p><pre class="prettyprint" style="line-height: 22px; white-space: pre-wrap; padding: 0px 15px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 14px; color: #333333; border-radius: 0px; margin: 20px -10px; word-break: break-all; word-wrap: break-word; border-width: 1px 0px; border-style: none; border-color: initial; background: #f7f7f7"><span style="color: #000000" class="pln">$ node doc</span><span style="color: #666600" class="pun">/</span><span style="color: #000088" class="kwd">this</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">js </span><span style="color: #666600" class="pun">-----</span><span style="color: #000000" class="pln">&nbsp;&nbsp;a b c </span><span style="color: #666600" class="pun">-----</span><span style="color: #000000" class="pln">&nbsp;&nbsp;c b a</span></pre><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">为啥要讲这个呢？先回到异步调用的场景，我们能这样调用么？如果每一个操作都可以连起来，是不是很爽</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">比如</p><pre class="prettyprint" style="line-height: 22px; white-space: pre-wrap; padding: 0px 15px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 14px; color: #333333; border-radius: 0px; margin: 20px -10px; word-break: break-all; word-wrap: break-word; border-width: 1px 0px; border-style: none; border-color: initial; background: #f7f7f7"><span style="color: #000088" class="kwd">return</span><span style="color: #000000" class="pln"> step1</span><span style="color: #666600" class="pun">().</span><span style="color: #000000" class="pln">step2</span><span style="color: #666600" class="pun">().</span><span style="color: #000000" class="pln">step3</span><span style="color: #666600" class="pun">().</span><span style="color: #000000" class="pln">step4</span><span style="color: #666600" class="pun">()</span></pre><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">这样做的好处</p><ul style="padding: 0px; margin: 0px 0px 10px 25px; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; font-size: 14px; line-height: 28px"><li style="line-height: 2em">1）每一个操作都是独立的函数</li><li style="line-height: 2em">2）可组装，拼就好了</li></ul><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">我们还可以再苛刻点</p><ul style="padding: 0px; margin: 0px 0px 10px 25px; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; font-size: 14px; line-height: 28px"><li style="line-height: 2em">1）如果要是上一步的结果作为下一步的输入就更好了（linux里的pipe：ps -ef&#124;grep node&#124;awk &lsquo;&#123;print $2&#125;&rsquo;&#124;xargs kill -9）</li><li style="line-height: 2em">2）如果出错能捕获异常就更好了</li><li style="line-height: 2em">3）如果能在函数里面也能控制流程就更好了</li></ul><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">会有人说：&ldquo;你要求的是不是太多了？&rdquo;</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">&ldquo;but，很好，我们来制定一个叫promisesaplus的规范吧，涵盖上面的所有内容&rdquo;</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">于是就有了promise/a+规范&hellip;</p><h1 style="margin: 30px 0px 15px; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; line-height: 40px; color: #333333; text-rendering: optimizeLegibility; font-size: 32.5px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #eeeeee">1）promise/a+规范</h1><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">这里面讲很多链式相关的东西，是我们异步操作里常见的问题，我们希望有更好的解决方案，promise/a+规范便应运而生</p><h2 style="margin: 30px 0px 15px; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; line-height: 40px; color: #333333; text-rendering: optimizeLegibility; font-size: 26px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #eeeeee">什么是promise/a+规范？</h2><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">Promise表示一个异步操作的最终结果。与Promise最主要的交互方法是通过将函数传入它的then方法从而获取得Promise最终的值或Promise最终最拒绝（reject）的原因。</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">想想我们刚才的那个例子，让我们来庖解一下</p><ul style="padding: 0px; margin: 0px 0px 10px 25px; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; font-size: 14px; line-height: 28px"><li style="line-height: 2em">a) 异步操作的最终结果</li></ul><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">简单点看，它也是一个链式操作,类似</p><pre class="prettyprint" style="line-height: 22px; white-space: pre-wrap; padding: 0px 15px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 14px; color: #333333; border-radius: 0px; margin: 20px -10px; word-break: break-all; word-wrap: break-word; border-width: 1px 0px; border-style: none; border-color: initial; background: #f7f7f7"><span style="color: #000088" class="kwd">return</span><span style="color: #000000" class="pln"> step1</span><span style="color: #666600" class="pun">().</span><span style="color: #000000" class="pln">step2</span><span style="color: #666600" class="pun">().</span><span style="color: #000000" class="pln">step3</span><span style="color: #666600" class="pun">().</span><span style="color: #000000" class="pln">step4</span><span style="color: #666600" class="pun">()</span></pre><ul style="padding: 0px; margin: 0px 0px 10px 25px; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; font-size: 14px; line-height: 28px"><li style="line-height: 2em">b) 与Promise最主要的交互方法是通过将函数传入它的then方法</li></ul><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">但它有点差别</p><pre class="prettyprint" style="line-height: 22px; white-space: pre-wrap; padding: 0px 15px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 14px; color: #333333; border-radius: 0px; margin: 20px -10px; word-break: break-all; word-wrap: break-word; border-width: 1px 0px; border-style: none; border-color: initial; background: #f7f7f7"><span style="color: #000088" class="kwd">return</span><span style="color: #000000" class="pln"> step1</span><span style="color: #666600" class="pun">().</span><span style="color: #000088" class="kwd">then</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">step2</span><span style="color: #666600" class="pun">).</span><span style="color: #000088" class="kwd">then</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">step3</span><span style="color: #666600" class="pun">).</span><span style="color: #000088" class="kwd">then</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">step4</span><span style="color: #666600" class="pun">)</span></pre><ul style="padding: 0px; margin: 0px 0px 10px 25px; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; font-size: 14px; line-height: 28px"><li style="line-height: 2em">c1) 从而获取得Promise最终的值或Promise最终最拒绝（reject）的原因</li></ul><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">比如step1执行成功了，那么就会执行step2，如果step2执行成功了就会执行下一个，以此类推</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">那么如果失败呢？于是应该改成这样：</p><pre class="prettyprint" style="line-height: 22px; white-space: pre-wrap; padding: 0px 15px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 14px; color: #333333; border-radius: 0px; margin: 20px -10px; word-break: break-all; word-wrap: break-word; border-width: 1px 0px; border-style: none; border-color: initial; background: #f7f7f7"><span style="color: #000088" class="kwd">return</span><span style="color: #000000" class="pln"> step1</span><span style="color: #666600" class="pun">().</span><span style="color: #000088" class="kwd">then</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">step2</span><span style="color: #666600" class="pun">).</span><span style="color: #000088" class="kwd">then</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">step3</span><span style="color: #666600" class="pun">).</span><span style="color: #000088" class="kwd">then</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">step4</span><span style="color: #666600" class="pun">).</span><span style="color: #000088" class="kwd">catch</span><span style="color: #666600" class="pun">(</span><span style="color: #000088" class="kwd">function</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">err</span><span style="color: #666600" class="pun">)&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp; </span><span style="color: #880000" class="com">// do something when err</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#125;);</span></pre><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">加了一个catch error回调，当出现异常就会直接到这个流程，会不会很好呢？</p><ul style="padding: 0px; margin: 0px 0px 10px 25px; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; font-size: 14px; line-height: 28px"><li style="line-height: 2em">c2) 从而获取得Promise最终的值或Promise最终最拒绝（reject）的原因</li></ul><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">这句话了有一个reject，其实还对应一个resolve方法</p><ul style="padding: 0px; margin: 0px 0px 10px 25px; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; font-size: 14px; line-height: 28px"><li style="line-height: 2em">reject 是拒绝，跳转到catch error</li><li style="line-height: 2em">resolve 是解决，下一步，即跳转到下一个promise操作</li></ul><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">我们还以上面的例子来说，如果step1失败了，走step3，step3失败了step4,如果step4出错就结束，报错，看一下代码</p><pre class="prettyprint" style="line-height: 22px; white-space: pre-wrap; padding: 0px 15px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 14px; color: #333333; border-radius: 0px; margin: 20px -10px; word-break: break-all; word-wrap: break-word; border-width: 1px 0px; border-style: none; border-color: initial; background: #f7f7f7"><span style="color: #000088" class="kwd">function</span><span style="color: #000000" class="pln"> step1</span><span style="color: #666600" class="pun">()&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp; </span><span style="color: #000088" class="kwd">if</span><span style="color: #666600" class="pun">(</span><span style="color: #000088" class="kwd">false</span><span style="color: #666600" class="pun">)&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #000088" class="kwd">return</span><span style="color: #000000" class="pln"> step3</span><span style="color: #666600" class="pun">().</span><span style="color: #000088" class="kwd">then</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">step4</span><span style="color: #666600" class="pun">).</span><span style="color: #000088" class="kwd">catch</span><span style="color: #666600" class="pun">(</span><span style="color: #000088" class="kwd">function</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">err</span><span style="color: #666600" class="pun">)&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #880000" class="com">// do something when err</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #666600" class="pun">&#125;);</span><span style="color: #000000" class="pln">&nbsp;&nbsp; </span><span style="color: #666600" class="pun">&#125;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #666600" class="pun">&#125;</span><span style="color: #000000" class="pln"> </span><span style="color: #000088" class="kwd">return</span><span style="color: #000000" class="pln"> step1</span><span style="color: #666600" class="pun">().</span><span style="color: #000088" class="kwd">then</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">step2</span><span style="color: #666600" class="pun">).</span><span style="color: #000088" class="kwd">then</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">step3</span><span style="color: #666600" class="pun">).</span><span style="color: #000088" class="kwd">then</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">step4</span><span style="color: #666600" class="pun">).</span><span style="color: #000088" class="kwd">catch</span><span style="color: #666600" class="pun">(</span><span style="color: #000088" class="kwd">function</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">err</span><span style="color: #666600" class="pun">)&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp; </span><span style="color: #880000" class="com">// do something when err</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#125;);</span></pre><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">总结一下：以上就是promise/a+规范的定义，我们拆解了一下，涵盖了上面我提出的几个痛点</p><h2 style="margin: 30px 0px 15px; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; line-height: 40px; color: #333333; text-rendering: optimizeLegibility; font-size: 26px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #eeeeee">术语</h2><h3 style="margin: 30px 0px 15px; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; line-height: 40px; color: #333333; text-rendering: optimizeLegibility; font-size: 24.5px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #eeeeee">promise</h3><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">是一个包含了兼容promise规范then方法的对象或函数</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">我们可以这样理解，每一个promise只要返回的可以then的都可以。就像上面举例返回的this一样，只要每一个都返回this，她就可以无限的链式下去，</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">这里的this约定为每一个对象或函数返回的都是兼容promise规范then方法。</p><h3 style="margin: 30px 0px 15px; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; line-height: 40px; color: #333333; text-rendering: optimizeLegibility; font-size: 24.5px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #eeeeee">thenable</h3><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">是一个包含了then方法的对象或函数。</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">这个可以这样理解，上面的例子，每个方法都返回this，比较麻烦，</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">那能不能只有then方法promise对象，每一个操作都返回一样的promise对象，是不是就可以无限链接下去了？</p><h3 style="margin: 30px 0px 15px; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; line-height: 40px; color: #333333; text-rendering: optimizeLegibility; font-size: 24.5px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #eeeeee">value</h3><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">是任何Javascript值。 (包括 undefined, thenable, promise等).</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">promise/a+规范约定的几个概念而已</p><h3 style="margin: 30px 0px 15px; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; line-height: 40px; color: #333333; text-rendering: optimizeLegibility; font-size: 24.5px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #eeeeee">exception</h3><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">是由throw表达式抛出来的值。</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">上面讲的，当流程出现异常的适合，把异常抛出来，由catch err处理。</p><h3 style="margin: 30px 0px 15px; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; line-height: 40px; color: #333333; text-rendering: optimizeLegibility; font-size: 24.5px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #eeeeee">reason</h3><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">是一个用于描述Promise被拒绝原因的值。</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">就是给你一个犯了错误，自我交待，争取宽大处理的机会。</p><h2 style="margin: 30px 0px 15px; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; line-height: 40px; color: #333333; text-rendering: optimizeLegibility; font-size: 26px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #eeeeee">参考</h2><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">还有一些promise里流程处理相关的东西，比较复杂，没啥大意义，有兴趣的可以看看官方网址</p><ul style="padding: 0px; margin: 0px 0px 10px 25px; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; font-size: 14px; line-height: 28px"><li style="line-height: 2em"><a style="color: #0088cc; text-decoration: none" href="javascript:if(confirm('https://promisesaplus.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='https://promisesaplus.com/'" tppabs="https://promisesaplus.com/" target="_blank">https://promisesaplus.com/</a></li></ul><h2 style="margin: 30px 0px 15px; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; line-height: 40px; color: #333333; text-rendering: optimizeLegibility; font-size: 26px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #eeeeee">总结一下</h2><ul style="padding: 0px; margin: 0px 0px 10px 25px; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; font-size: 14px; line-height: 28px"><li style="line-height: 2em"><ol style="padding: 0px; margin: 0px 0px 0px 25px"><li style="line-height: 2em">每个操作都返回一样的promise对象，保证链式操作</li></ol></li><li style="line-height: 2em"><ol style="padding: 0px; margin: 0px 0px 0px 25px"><li style="line-height: 2em">每个链式都通过then方法</li></ol></li><li style="line-height: 2em"><ol style="padding: 0px; margin: 0px 0px 0px 25px"><li style="line-height: 2em">每个操作内部允许犯错，出了错误，统一由catch error处理</li></ol></li><li style="line-height: 2em"><ol style="padding: 0px; margin: 0px 0px 0px 25px"><li style="line-height: 2em">操作内部，也可以是一个操作链，通过reject或resolve再造流程</li></ol></li></ul><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">理解这些，实际上nodejs里就没有啥难点了。当然我还要告诉更多好处，让你受益一生（吹吹牛）</p><h2 style="margin: 30px 0px 15px; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; line-height: 40px; color: #333333; text-rendering: optimizeLegibility; font-size: 26px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #eeeeee">八卦一下</h2><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">哪个语言不需要回调呢？callback并不是js所特有的，举个例子oc里的block（如果愿意扯，也可以扯扯函数指针），如果用asi或者afnetworking处理http请求，你都可以选择用block方式，那么你如果一个业务里有多个请求呢？</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">你也只能嵌套，因为嵌套没有太多层，因为可以有其他解耦方式，其实我最想表达的是，它也可以使用promise方式的。</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">这里展示一个例子</p><pre class="prettyprint" style="line-height: 22px; white-space: pre-wrap; padding: 0px 15px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 14px; color: #333333; border-radius: 0px; margin: 20px -10px; word-break: break-all; word-wrap: break-word; border-width: 1px 0px; border-style: none; border-color: initial; background: #f7f7f7"><span style="color: #666600" class="pun">[</span><span style="color: #000088" class="kwd">self</span><span style="color: #000000" class="pln"> login</span><span style="color: #666600" class="pun">].</span><span style="color: #000088" class="kwd">then</span><span style="color: #666600" class="pun">(^&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #880000" class="com">// our login method wrapped an async task in a promise</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #000088" class="kwd">return</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">[</span><span style="color: #000000" class="pln">API fetchKittens</span><span style="color: #666600" class="pun">];</span><span style="color: #000000" class="pln">&nbsp;&nbsp;</span><span style="color: #666600" class="pun">&#125;).</span><span style="color: #000088" class="kwd">then</span><span style="color: #666600" class="pun">(^(</span><span style="color: #660066" class="typ">NSArray</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">*</span><span style="color: #000000" class="pln">fetchedKittens</span><span style="color: #666600" class="pun">)&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #880000" class="com">// our API class wraps our API and returns promises</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #880000" class="com">// fetchKittens returned a promise that resolves with an array of kittens</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #000088" class="kwd">self</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">kittens </span><span style="color: #666600" class="pun">=</span><span style="color: #000000" class="pln"> fetchedKittens</span><span style="color: #666600" class="pun">;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #666600" class="pun">[</span><span style="color: #000088" class="kwd">self</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">tableView reloadData</span><span style="color: #666600" class="pun">];</span><span style="color: #000000" class="pln">&nbsp;&nbsp;</span><span style="color: #666600" class="pun">&#125;).</span><span style="color: #000088" class="kwd">catch</span><span style="color: #666600" class="pun">(^(</span><span style="color: #660066" class="typ">NSError</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">*</span><span style="color: #000000" class="pln">error</span><span style="color: #666600" class="pun">)&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #880000" class="com">// any errors in any of the above promises land here</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #666600" class="pun">[[[</span><span style="color: #660066" class="typ">UIAlertView</span><span style="color: #000000" class="pln"> alloc</span><span style="color: #666600" class="pun">]</span><span style="color: #000000" class="pln"> init</span><span style="color: #666600" class="pun">&hellip;]</span><span style="color: #000000" class="pln"> show</span><span style="color: #666600" class="pun">];</span><span style="color: #000000" class="pln">&nbsp;&nbsp;</span><span style="color: #666600" class="pun">&#125;);</span><span style="color: #000000" class="pln"> </span></pre><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">详见http://promisekit.org/introduction/</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">是不是很奇怪，咋和上面的promise写法一样呢？</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">官方解释是</p><pre class="prettyprint" style="line-height: 22px; white-space: pre-wrap; padding: 0px 15px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 14px; color: #333333; border-radius: 0px; margin: 20px -10px; word-break: break-all; word-wrap: break-word; border-width: 1px 0px; border-style: none; border-color: initial; background: #f7f7f7"><span style="color: #660066" class="typ">PromiseKit</span><span style="color: #000000" class="pln"> </span><span style="color: #000088" class="kwd">is</span><span style="color: #000000" class="pln"> </span><span style="color: #000088" class="kwd">not</span><span style="color: #000000" class="pln"> just a promises implementation</span></pre><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">好吧，这只是冰山一角</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">如果各位熟悉前端js，相信你一定了解</p><ul style="padding: 0px; margin: 0px 0px 10px 25px; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; font-size: 14px; line-height: 28px"><li style="line-height: 2em">jQuery（1.5+）的deferred</li><li style="line-height: 2em">Angularjs的$q对象</li></ul><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">nodejs里的实现</p><ul style="padding: 0px; margin: 0px 0px 10px 25px; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; font-size: 14px; line-height: 28px"><li style="line-height: 2em">bluebird （<a style="color: #0088cc; text-decoration: none" href="javascript:if(confirm('https://github.com/petkaantonov/bluebird  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='https://github.com/petkaantonov/bluebird'" tppabs="https://github.com/petkaantonov/bluebird" target="_blank">https://github.com/petkaantonov/bluebird</a>&nbsp;后面继续讲，保持神秘）</li><li style="line-height: 2em">q （<a style="color: #0088cc; text-decoration: none" href="javascript:if(confirm('https://github.com/kriskowal/q  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='https://github.com/kriskowal/q'" tppabs="https://github.com/kriskowal/q" target="_blank">https://github.com/kriskowal/q</a>&nbsp;Angularjs的$q对象是q的精简版）</li><li style="line-height: 2em">then （teambition作品&nbsp;<a style="color: #0088cc; text-decoration: none" href="javascript:if(confirm('https://github.com/teambition/then.js  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='https://github.com/teambition/then.js'" tppabs="https://github.com/teambition/then.js" target="_blank">https://github.com/teambition/then.js</a>&nbsp;没用过）</li><li style="line-height: 2em">when （<a style="color: #0088cc; text-decoration: none" href="javascript:if(confirm('https://github.com/cujojs/when  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='https://github.com/cujojs/when'" tppabs="https://github.com/cujojs/when" target="_blank">https://github.com/cujojs/when</a>&nbsp;没用过）</li><li style="line-height: 2em">async （<a style="color: #0088cc; text-decoration: none" href="javascript:if(confirm('https://github.com/caolan/async  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='https://github.com/caolan/async'" tppabs="https://github.com/caolan/async" target="_blank">https://github.com/caolan/async</a>&nbsp;最简单的）</li><li style="line-height: 2em">eventproxy（朴灵作品&nbsp;<a style="color: #0088cc; text-decoration: none" href="javascript:if(confirm('https://github.com/JacksonTian/eventproxy%EF%BC%8C%E4%BD%BF%E7%94%A8event%E6%9D%A5%E5%A4%84%E7%90%86%E6%B5%81%E7%A8%8B%EF%BC%8C%E4%B9%9F%E6%98%AF%E4%B8%8D%E9%94%99%E7%9A%84%E5%B0%9D%E8%AF%95%EF%BC%89  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='https://github.com/JacksonTian/eventproxy%EF%BC%8C%E4%BD%BF%E7%94%A8event%E6%9D%A5%E5%A4%84%E7%90%86%E6%B5%81%E7%A8%8B%EF%BC%8C%E4%B9%9F%E6%98%AF%E4%B8%8D%E9%94%99%E7%9A%84%E5%B0%9D%E8%AF%95%EF%BC%89'" tppabs="https://github.com/JacksonTian/eventproxy%EF%BC%8C%E4%BD%BF%E7%94%A8event%E6%9D%A5%E5%A4%84%E7%90%86%E6%B5%81%E7%A8%8B%EF%BC%8C%E4%B9%9F%E6%98%AF%E4%B8%8D%E9%94%99%E7%9A%84%E5%B0%9D%E8%AF%95%EF%BC%89" target="_blank">https://github.com/JacksonTian/eventproxy，使用event来处理流程，也是不错的尝试）</a></li></ul><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">其他语言实现，详见 <a style="color: #0088cc; text-decoration: none" href="javascript:if(confirm('https://promisesaplus.com/implementations  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='https://promisesaplus.com/implementations'" tppabs="https://promisesaplus.com/implementations" target="_blank">https://promisesaplus.com/implementations</a></p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">其实，只要掌握了promise/a+规范，你就可以在n种语言里使用了</p><h1 style="margin: 30px 0px 15px; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; line-height: 40px; color: #333333; text-rendering: optimizeLegibility; font-size: 32.5px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #eeeeee">2）如何实现</h1><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">promise/a+规范是一个通用解决方案，不只是对nodejs管用，只要你掌握了原理，就只是换个语言实现而已</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">下面我就带着大家看一下js里是如何实现的</p><pre class="prettyprint" style="line-height: 22px; white-space: pre-wrap; padding: 0px 15px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 14px; color: #333333; border-radius: 0px; margin: 20px -10px; word-break: break-all; word-wrap: break-word; border-width: 1px 0px; border-style: none; border-color: initial; background: #f7f7f7"><span style="color: #000088" class="kwd">var</span><span style="color: #000000" class="pln"> </span><span style="color: #660066" class="typ">Promise</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">=</span><span style="color: #000000" class="pln"> </span><span style="color: #000088" class="kwd">function</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">()</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#125;;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;</span><span style="color: #000088" class="kwd">var</span><span style="color: #000000" class="pln"> isPromise </span><span style="color: #666600" class="pun">=</span><span style="color: #000000" class="pln"> </span><span style="color: #000088" class="kwd">function</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">value</span><span style="color: #666600" class="pun">)</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #000088" class="kwd">return</span><span style="color: #000000" class="pln"> value </span><span style="color: #000088" class="kwd">instanceof</span><span style="color: #000000" class="pln"> </span><span style="color: #660066" class="typ">Promise</span><span style="color: #666600" class="pun">;</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#125;;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;</span><span style="color: #000088" class="kwd">var</span><span style="color: #000000" class="pln"> defer </span><span style="color: #666600" class="pun">=</span><span style="color: #000000" class="pln"> </span><span style="color: #000088" class="kwd">function</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">()</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #000088" class="kwd">var</span><span style="color: #000000" class="pln"> pending </span><span style="color: #666600" class="pun">=</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">[],</span><span style="color: #000000" class="pln"> value</span><span style="color: #666600" class="pun">;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #000088" class="kwd">var</span><span style="color: #000000" class="pln"> promise </span><span style="color: #666600" class="pun">=</span><span style="color: #000000" class="pln"> </span><span style="color: #000088" class="kwd">new</span><span style="color: #000000" class="pln"> </span><span style="color: #660066" class="typ">Promise</span><span style="color: #666600" class="pun">();</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; promise</span><span style="color: #666600" class="pun">.</span><span style="color: #000088" class="kwd">then</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">=</span><span style="color: #000000" class="pln"> </span><span style="color: #000088" class="kwd">function</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">callback</span><span style="color: #666600" class="pun">)</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #000088" class="kwd">if</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">pending</span><span style="color: #666600" class="pun">)</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pending</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">push</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">callback</span><span style="color: #666600" class="pun">);</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #666600" class="pun">&#125;</span><span style="color: #000000" class="pln"> </span><span style="color: #000088" class="kwd">else</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; callback</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">value</span><span style="color: #666600" class="pun">);</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #666600" class="pun">&#125;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #666600" class="pun">&#125;;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #000088" class="kwd">return</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; resolve</span><span style="color: #666600" class="pun">:</span><span style="color: #000000" class="pln"> </span><span style="color: #000088" class="kwd">function</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">_value</span><span style="color: #666600" class="pun">)</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #000088" class="kwd">if</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">pending</span><span style="color: #666600" class="pun">)</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; value </span><span style="color: #666600" class="pun">=</span><span style="color: #000000" class="pln"> _value</span><span style="color: #666600" class="pun">;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #000088" class="kwd">for</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">(</span><span style="color: #000088" class="kwd">var</span><span style="color: #000000" class="pln"> i </span><span style="color: #666600" class="pun">=</span><span style="color: #000000" class="pln"> </span><span style="color: #006666" class="lit">0</span><span style="color: #666600" class="pun">,</span><span style="color: #000000" class="pln"> ii </span><span style="color: #666600" class="pun">=</span><span style="color: #000000" class="pln"> pending</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">length</span><span style="color: #666600" class="pun">;</span><span style="color: #000000" class="pln"> i </span><span style="color: #666600" class="pun">&lt;</span><span style="color: #000000" class="pln"> ii</span><span style="color: #666600" class="pun">;</span><span style="color: #000000" class="pln"> i</span><span style="color: #666600" class="pun">++)</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #000088" class="kwd">var</span><span style="color: #000000" class="pln"> callback </span><span style="color: #666600" class="pun">=</span><span style="color: #000000" class="pln"> pending</span><span style="color: #666600" class="pun">[</span><span style="color: #000000" class="pln">i</span><span style="color: #666600" class="pun">];</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; callback</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">value</span><span style="color: #666600" class="pun">);</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #666600" class="pun">&#125;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pending </span><span style="color: #666600" class="pun">=</span><span style="color: #000000" class="pln"> </span><span style="color: #000088" class="kwd">undefined</span><span style="color: #666600" class="pun">;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #666600" class="pun">&#125;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #666600" class="pun">&#125;,</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; promise</span><span style="color: #666600" class="pun">:</span><span style="color: #000000" class="pln"> promise&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #666600" class="pun">&#125;;</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#125;;</span></pre><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">首先</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">1） 声明promise对象</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">var promise = new Promise();</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">2）给promise对象增加then方法</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">promise.then = function (callback) &#123;</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">3）给defer对象返回resolve和promise</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">4）value，在resolve事件里传参，是第几个就执行第几个</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">本来想讲的更多一点，但时间不允许啊（后面还有很多内容），此处暂时讲到这里</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">cnode里的William17写的挺好的，完整的实现可以参考</p><ul style="padding: 0px; margin: 0px 0px 10px 25px; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; font-size: 14px; line-height: 28px"><li style="line-height: 2em"><a style="color: #0088cc; text-decoration: none" href="javascript:if(confirm('https://cnodejs.org/topic/5603cb8a152fdd025f0f5014  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='https://cnodejs.org/topic/5603cb8a152fdd025f0f5014'" tppabs="https://cnodejs.org/topic/5603cb8a152fdd025f0f5014" target="_blank">https://cnodejs.org/topic/5603cb8a152fdd025f0f5014</a></li><li style="line-height: 2em"><a style="color: #0088cc; text-decoration: none" href="javascript:if(confirm('https://github.com/William17/taxi  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='https://github.com/William17/taxi'" tppabs="https://github.com/William17/taxi" target="_blank">https://github.com/William17/taxi</a></li></ul><h2 style="margin: 30px 0px 15px; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; line-height: 40px; color: #333333; text-rendering: optimizeLegibility; font-size: 26px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #eeeeee">关于Q</h2><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">q是一个不错的项目，也是比较早的promise实现，而且angularjs的$q就是它的精简版，如果掌握了q，学习angular和bluebird都会比较简单</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">当然它还有更棒的，它把q的7个版本是如何实现的都详细记录了，刚才我给出的v1实际上就q的早期版本</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif"><a style="color: #0088cc; text-decoration: none" href="javascript:if(confirm('https://github.com/kriskowal/q/tree/v1/design  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='https://github.com/kriskowal/q/tree/v1/design'" tppabs="https://github.com/kriskowal/q/tree/v1/design" target="_blank">https://github.com/kriskowal/q/tree/v1/design</a></p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">很多人都以为是跟着人学，但人有不确定性，而且互联网让世界是平的了，我们如果能够学会从开源项目里学习，这才是长久的学习力</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">曾经写过一篇《如何学习之善用github篇：向 <a style="color: #0088cc; text-decoration: none" href="javascript:if(confirm('http://cnodejs.org/user/Pana  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://cnodejs.org/user/Pana'" tppabs="http://cnodejs.org/user/Pana" target="_blank">@Pana</a> 学习》，有兴趣的可以去翻翻</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif"><a style="color: #0088cc; text-decoration: none" href="javascript:if(confirm('http://mp.weixin.qq.com/s?__biz=MzAxMTU0NTc4Nw==&mid=223428929&idx=1&sn=8296f5a96aa34f836ab83000f7ad995b  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://mp.weixin.qq.com/s?__biz=MzAxMTU0NTc4Nw==&mid=223428929&idx=1&sn=8296f5a96aa34f836ab83000f7ad995b#rd'" tppabs="http://mp.weixin.qq.com/s?__biz=MzAxMTU0NTc4Nw==&mid=223428929&idx=1&sn=8296f5a96aa34f836ab83000f7ad995b#rd" target="_blank">http://mp.weixin.qq.com/s?__biz=MzAxMTU0NTc4Nw==&amp;mid=223428929&amp;idx=1&amp;sn=8296f5a96aa34f836ab83000f7ad995b#rd</a></p><h1 style="margin: 30px 0px 15px; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; line-height: 40px; color: #333333; text-rendering: optimizeLegibility; font-size: 32.5px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #eeeeee">3）真实项目里的实践</h1><h2 style="margin: 30px 0px 15px; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; line-height: 40px; color: #333333; text-rendering: optimizeLegibility; font-size: 26px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #eeeeee">技术选项：先看基准测试</h2><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">2015-01-05 当时最新的模块，比较结果如下</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif"><img style="height: auto; max-width: 100%; vertical-align: middle; border: 0px; cursor: pointer" src="Fq-FM_N-zrlVEm-_7RS291Afo8dW.png" tppabs="http://dn-cnode.qbox.me/Fq-FM_N-zrlVEm-_7RS291Afo8dW" border="0" alt="benchmark.png" /></p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">对比一下结果</p><pre class="prettyprint" style="line-height: 22px; white-space: pre-wrap; padding: 0px 15px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 14px; color: #333333; border-radius: 0px; margin: 20px -10px; word-break: break-all; word-wrap: break-word; border-width: 1px 0px; border-style: none; border-color: initial; background: #f7f7f7"><span style="color: #666600" class="pun">顺序执行</span><span style="color: #000000" class="pln"> promises</span><span style="color: #666600" class="pun">-</span><span style="color: #000000" class="pln">bluebird</span><span style="color: #666600" class="pun">-</span><span style="color: #000000" class="pln">generator</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">js&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #006666" class="lit">235</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #006666" class="lit">38.04</span><span style="color: #000000" class="pln"> promises</span><span style="color: #666600" class="pun">-</span><span style="color: #000000" class="pln">bluebird</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">js&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #006666" class="lit">335</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #006666" class="lit">52.08</span><span style="color: #000000" class="pln">&nbsp;&nbsp;</span><span style="color: #666600" class="pun">并发执行</span><span style="color: #000000" class="pln"> promises</span><span style="color: #666600" class="pun">-</span><span style="color: #000000" class="pln">bluebird</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">js&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #006666" class="lit">389</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #006666" class="lit">53.49</span><span style="color: #000000" class="pln"> promises</span><span style="color: #666600" class="pun">-</span><span style="color: #000000" class="pln">bluebird</span><span style="color: #666600" class="pun">-</span><span style="color: #000000" class="pln">generator</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">js&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #006666" class="lit">491</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #006666" class="lit">55.52</span></pre><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">不管是哪种，bluebird都是前三名。然后扒一扒第一名的callbacks-baseline.js,其实就我们最讨厌的最基本的回调写法，也就说，bb实际比原生js稍慢，但比其他promise库都快</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">综合一下bb的特性</p><ul style="padding: 0px; margin: 0px 0px 10px 25px; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; font-size: 14px; line-height: 28px"><li style="line-height: 2em">速度最快</li><li style="line-height: 2em">api和文档完善，（对各个库支持都不错）</li><li style="line-height: 2em">支持generator等未来发展趋势</li><li style="line-height: 2em">github活跃</li><li style="line-height: 2em">还有让人眼前一亮的功能点（保密，下面会讲）</li></ul><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">我们的结论只有bb是目前最好的最好的选择</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">我个人的一个小喜好，对caolan的async挺喜欢的，我的选项</p><ul style="padding: 0px; margin: 0px 0px 10px 25px; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; font-size: 14px; line-height: 28px"><li style="line-height: 2em">公司项目是bb</li><li style="line-height: 2em">开源大点的还是bb</li><li style="line-height: 2em">小工具啥的我会选async</li></ul><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">其实when，then，eventproxy等也不错，只是懒得折腾</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">大家在直播过程中有任何不明白或者想提问的可以随时私信给小助手，我会在答疑阶段统一回答</p><h2 style="margin: 30px 0px 15px; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; line-height: 40px; color: #333333; text-rendering: optimizeLegibility; font-size: 26px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #eeeeee">场景</h2><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">下面举几个实际场景</p><h3 style="margin: 30px 0px 15px; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; line-height: 40px; color: #333333; text-rendering: optimizeLegibility; font-size: 24.5px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #eeeeee">神器，bluebird的promisify</h3><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">promisify原理</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">就是你给他传一个对象或者prototype，它去遍历，给他们加上async方法，此方法返回promise对象，你就可以为所欲为了</p><ul style="padding: 0px; margin: 0px 0px 10px 25px; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; font-size: 14px; line-height: 28px"><li style="line-height: 2em">优点：使用简单</li><li style="line-height: 2em">缺点：谨防对象过大，内存问题</li></ul><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">nodejs api支持</p><pre class="prettyprint" style="line-height: 22px; white-space: pre-wrap; padding: 0px 15px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 14px; color: #333333; border-radius: 0px; margin: 20px -10px; word-break: break-all; word-wrap: break-word; border-width: 1px 0px; border-style: none; border-color: initial; background: #f7f7f7"><span style="color: #880000" class="com">//Read more about promisification in the API Reference:</span><span style="color: #000000" class="pln"> </span><span style="color: #880000" class="com">//API.md</span><span style="color: #000000" class="pln"> </span><span style="color: #000088" class="kwd">var</span><span style="color: #000000" class="pln"> fs </span><span style="color: #666600" class="pun">=</span><span style="color: #000000" class="pln"> </span><span style="color: #660066" class="typ">Promise</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">promisifyAll</span><span style="color: #666600" class="pun">(</span><span style="color: #000088" class="kwd">require</span><span style="color: #666600" class="pun">(</span><span style="color: #008800" class="str">&quot;fs&quot;</span><span style="color: #666600" class="pun">));</span><span style="color: #000000" class="pln">&nbsp;&nbsp;fs</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">readFileAsync</span><span style="color: #666600" class="pun">(</span><span style="color: #008800" class="str">&quot;myfile.json&quot;</span><span style="color: #666600" class="pun">).</span><span style="color: #000088" class="kwd">then</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">JSON</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">parse</span><span style="color: #666600" class="pun">).</span><span style="color: #000088" class="kwd">then</span><span style="color: #666600" class="pun">(</span><span style="color: #000088" class="kwd">function</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">json</span><span style="color: #666600" class="pun">)</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; console</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">log</span><span style="color: #666600" class="pun">(</span><span style="color: #008800" class="str">&quot;Successful json&quot;</span><span style="color: #666600" class="pun">);</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#125;).</span><span style="color: #000088" class="kwd">catch</span><span style="color: #666600" class="pun">(</span><span style="color: #660066" class="typ">SyntaxError</span><span style="color: #666600" class="pun">,</span><span style="color: #000000" class="pln"> </span><span style="color: #000088" class="kwd">function</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">e</span><span style="color: #666600" class="pun">)</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; console</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">error</span><span style="color: #666600" class="pun">(</span><span style="color: #008800" class="str">&quot;file contains invalid json&quot;</span><span style="color: #666600" class="pun">);</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#125;).</span><span style="color: #000088" class="kwd">catch</span><span style="color: #666600" class="pun">(</span><span style="color: #660066" class="typ">Promise</span><span style="color: #666600" class="pun">.</span><span style="color: #660066" class="typ">OperationalError</span><span style="color: #666600" class="pun">,</span><span style="color: #000000" class="pln"> </span><span style="color: #000088" class="kwd">function</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">e</span><span style="color: #666600" class="pun">)</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; console</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">error</span><span style="color: #666600" class="pun">(</span><span style="color: #008800" class="str">&quot;unable to read file, because: &quot;</span><span style="color: #666600" class="pun">,</span><span style="color: #000000" class="pln"> e</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">message</span><span style="color: #666600" class="pun">);</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#125;);</span></pre><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">熟悉fs的API的都知道，fs有</p><ul style="padding: 0px; margin: 0px 0px 10px 25px; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; font-size: 14px; line-height: 28px"><li style="line-height: 2em">fs.readFile</li><li style="line-height: 2em">fs.readFileSync</li></ul><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">但没有</p><ul style="padding: 0px; margin: 0px 0px 10px 25px; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; font-size: 14px; line-height: 28px"><li style="line-height: 2em">fs.readFileAsync</li></ul><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">实际上fs.readFileAsync是bluebird加上去的</p><pre class="prettyprint" style="line-height: 22px; white-space: pre-wrap; padding: 0px 15px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 14px; color: #333333; border-radius: 0px; margin: 20px -10px; word-break: break-all; word-wrap: break-word; border-width: 1px 0px; border-style: none; border-color: initial; background: #f7f7f7"><span style="color: #000088" class="kwd">var</span><span style="color: #000000" class="pln"> fs </span><span style="color: #666600" class="pun">=</span><span style="color: #000000" class="pln"> </span><span style="color: #660066" class="typ">Promise</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">promisifyAll</span><span style="color: #666600" class="pun">(</span><span style="color: #000088" class="kwd">require</span><span style="color: #666600" class="pun">(</span><span style="color: #008800" class="str">&quot;fs&quot;</span><span style="color: #666600" class="pun">));</span></pre><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">其实也没什么神奇的，只是bb做的更多而已，让调用足够简便</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">下面我们来看一下mvc里的model层如何使用bb，我们先假定使用的是mongoose啊</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">先定义模型</p><pre class="prettyprint" style="line-height: 22px; white-space: pre-wrap; padding: 0px 15px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 14px; color: #333333; border-radius: 0px; margin: 20px -10px; word-break: break-all; word-wrap: break-word; border-width: 1px 0px; border-style: none; border-color: initial; background: #f7f7f7"><span style="color: #000088" class="kwd">var</span><span style="color: #000000" class="pln"> mongoose </span><span style="color: #666600" class="pun">=</span><span style="color: #000000" class="pln"> </span><span style="color: #000088" class="kwd">require</span><span style="color: #666600" class="pun">(</span><span style="color: #008800" class="str">'mongoose'</span><span style="color: #666600" class="pun">);</span><span style="color: #000000" class="pln"> </span><span style="color: #000088" class="kwd">var</span><span style="color: #000000" class="pln"> </span><span style="color: #660066" class="typ">Schema</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">=</span><span style="color: #000000" class="pln"> mongoose</span><span style="color: #666600" class="pun">.</span><span style="color: #660066" class="typ">Schema</span><span style="color: #666600" class="pun">;</span><span style="color: #000000" class="pln"> </span><span style="color: #000088" class="kwd">var</span><span style="color: #000000" class="pln"> </span><span style="color: #660066" class="typ">Promise</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">=</span><span style="color: #000000" class="pln"> </span><span style="color: #000088" class="kwd">require</span><span style="color: #666600" class="pun">(</span><span style="color: #008800" class="str">&quot;bluebird&quot;</span><span style="color: #666600" class="pun">);</span><span style="color: #000000" class="pln">&nbsp;&nbsp;</span><span style="color: #660066" class="typ">UserSchema</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">=</span><span style="color: #000000" class="pln"> </span><span style="color: #000088" class="kwd">new</span><span style="color: #000000" class="pln"> </span><span style="color: #660066" class="typ">Schema</span><span style="color: #666600" class="pun">(&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp; username</span><span style="color: #666600" class="pun">:</span><span style="color: #000000" class="pln"> </span><span style="color: #660066" class="typ">String</span><span style="color: #666600" class="pun">,</span><span style="color: #000000" class="pln">&nbsp;&nbsp; password</span><span style="color: #666600" class="pun">:</span><span style="color: #000000" class="pln"> </span><span style="color: #660066" class="typ">String</span><span style="color: #666600" class="pun">,</span><span style="color: #000000" class="pln">&nbsp;&nbsp; created_at</span><span style="color: #666600" class="pun">:</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; type</span><span style="color: #666600" class="pun">:</span><span style="color: #000000" class="pln"> </span><span style="color: #660066" class="typ">Date</span><span style="color: #666600" class="pun">,</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #008800" class="str">&quot;default&quot;</span><span style="color: #666600" class="pun">:</span><span style="color: #000000" class="pln"> </span><span style="color: #660066" class="typ">Date</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">now&nbsp;&nbsp; </span><span style="color: #666600" class="pun">&#125;</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#125;);</span><span style="color: #000000" class="pln">&nbsp;&nbsp;</span><span style="color: #000088" class="kwd">var</span><span style="color: #000000" class="pln"> </span><span style="color: #660066" class="typ">User</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">=</span><span style="color: #000000" class="pln"> mongoose</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">model</span><span style="color: #666600" class="pun">(</span><span style="color: #008800" class="str">'User'</span><span style="color: #666600" class="pun">,</span><span style="color: #000000" class="pln"> </span><span style="color: #660066" class="typ">UserSchema</span><span style="color: #666600" class="pun">);</span><span style="color: #000000" class="pln">&nbsp;&nbsp;</span><span style="color: #660066" class="typ">Promise</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">promisifyAll</span><span style="color: #666600" class="pun">(</span><span style="color: #660066" class="typ">User</span><span style="color: #666600" class="pun">);</span><span style="color: #000000" class="pln"> </span><span style="color: #660066" class="typ">Promise</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">promisifyAll</span><span style="color: #666600" class="pun">(</span><span style="color: #660066" class="typ">User</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">prototype</span><span style="color: #666600" class="pun">);</span></pre><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">利用上面定义好的User模型，我们就可以写业务逻辑了</p><pre class="prettyprint" style="line-height: 22px; white-space: pre-wrap; padding: 0px 15px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 14px; color: #333333; border-radius: 0px; margin: 20px -10px; word-break: break-all; word-wrap: break-word; border-width: 1px 0px; border-style: none; border-color: initial; background: #f7f7f7"><span style="color: #660066" class="typ">User</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">findAsync</span><span style="color: #666600" class="pun">(&#123;</span><span style="color: #000000" class="pln">username</span><span style="color: #666600" class="pun">:</span><span style="color: #000000" class="pln"> username</span><span style="color: #666600" class="pun">&#125;).</span><span style="color: #000088" class="kwd">then</span><span style="color: #666600" class="pun">(</span><span style="color: #000088" class="kwd">function</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">data</span><span style="color: #666600" class="pun">)</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #666600" class="pun">...</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#125;).</span><span style="color: #000088" class="kwd">catch</span><span style="color: #666600" class="pun">(</span><span style="color: #000088" class="kwd">function</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">err</span><span style="color: #666600" class="pun">)</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #666600" class="pun">...</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#125;);</span></pre><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">再来个复杂的</p><pre class="prettyprint" style="line-height: 22px; white-space: pre-wrap; padding: 0px 15px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 14px; color: #333333; border-radius: 0px; margin: 20px -10px; word-break: break-all; word-wrap: break-word; border-width: 1px 0px; border-style: none; border-color: initial; background: #f7f7f7"><span style="color: #660066" class="typ">TeamPartner</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">updateAsync</span><span style="color: #666600" class="pun">(&#123;</span><span style="color: #000000" class="pln"> &nbsp;&nbsp;</span><span style="color: #666600" class="pun">...</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#125;,</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln"> &nbsp;&nbsp;$set</span><span style="color: #666600" class="pun">:</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln"> &nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #666600" class="pun">...</span><span style="color: #000000" class="pln"> &nbsp;&nbsp;</span><span style="color: #666600" class="pun">&#125;</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#125;).</span><span style="color: #000088" class="kwd">then</span><span style="color: #666600" class="pun">(</span><span style="color: #000088" class="kwd">function</span><span style="color: #666600" class="pun">()</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln"> &nbsp;&nbsp;</span><span style="color: #000088" class="kwd">return</span><span style="color: #000000" class="pln"> </span><span style="color: #660066" class="typ">User</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">findByIdAsync</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">user_id</span><span style="color: #666600" class="pun">);</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#125;).</span><span style="color: #000088" class="kwd">then</span><span style="color: #666600" class="pun">(</span><span style="color: #000088" class="kwd">function</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">team_owner</span><span style="color: #666600" class="pun">)</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln"> &nbsp;&nbsp;</span><span style="color: #000088" class="kwd">if</span><span style="color: #666600" class="pun">(</span><span style="color: #000088" class="kwd">typeof</span><span style="color: #000000" class="pln"> team_owner</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">partner_count </span><span style="color: #666600" class="pun">!=</span><span style="color: #000000" class="pln"> </span><span style="color: #008800" class="str">'undefined'</span><span style="color: #666600" class="pun">)</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; team_new_count </span><span style="color: #666600" class="pun">=</span><span style="color: #000000" class="pln"> team_owner</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">partner_count </span><span style="color: #666600" class="pun">+</span><span style="color: #000000" class="pln"> </span><span style="color: #006666" class="lit">1</span><span style="color: #666600" class="pun">;</span><span style="color: #000000" class="pln">&nbsp;&nbsp; </span><span style="color: #666600" class="pun">&#125;</span><span style="color: #000088" class="kwd">else</span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; team_new_count </span><span style="color: #666600" class="pun">=</span><span style="color: #000000" class="pln"> </span><span style="color: #006666" class="lit">1</span><span style="color: #666600" class="pun">;</span><span style="color: #000000" class="pln">&nbsp;&nbsp; </span><span style="color: #666600" class="pun">&#125;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #880000" class="com">// 创始人成员+1</span><span style="color: #000000" class="pln">&nbsp;&nbsp; </span><span style="color: #000088" class="kwd">return</span><span style="color: #000000" class="pln"> </span><span style="color: #660066" class="typ">User</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">findByIdAndUpdateAsync</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">user_id</span><span style="color: #666600" class="pun">,</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; $set</span><span style="color: #666600" class="pun">:</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #666600" class="pun">...</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #666600" class="pun">&#125;</span><span style="color: #000000" class="pln">&nbsp;&nbsp; </span><span style="color: #666600" class="pun">&#125;,</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; upsert</span><span style="color: #666600" class="pun">:</span><span style="color: #000000" class="pln"> </span><span style="color: #000088" class="kwd">true</span><span style="color: #000000" class="pln">&nbsp;&nbsp; </span><span style="color: #666600" class="pun">&#125;);</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#125;).</span><span style="color: #000088" class="kwd">then</span><span style="color: #666600" class="pun">(</span><span style="color: #000088" class="kwd">function</span><span style="color: #666600" class="pun">()</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln"> &nbsp;&nbsp;</span><span style="color: #000088" class="kwd">return</span><span style="color: #000000" class="pln"> </span><span style="color: #660066" class="typ">Notify</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">findByIdAndUpdateAsync</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">notify_id</span><span style="color: #666600" class="pun">,</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln"> &nbsp;&nbsp;&nbsp;&nbsp;$set</span><span style="color: #666600" class="pun">:</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;read_status</span><span style="color: #666600" class="pun">:</span><span style="color: #000000" class="pln"> </span><span style="color: #000088" class="kwd">true</span><span style="color: #000000" class="pln"> &nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #666600" class="pun">&#125;</span><span style="color: #000000" class="pln"> &nbsp;&nbsp;</span><span style="color: #666600" class="pun">&#125;);</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#125;).</span><span style="color: #000088" class="kwd">then</span><span style="color: #666600" class="pun">(</span><span style="color: #000088" class="kwd">function</span><span style="color: #666600" class="pun">()</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp; </span><span style="color: #000088" class="kwd">var</span><span style="color: #000000" class="pln"> notifySave </span><span style="color: #666600" class="pun">=</span><span style="color: #000000" class="pln"> </span><span style="color: #000088" class="kwd">new</span><span style="color: #000000" class="pln"> </span><span style="color: #660066" class="typ">Notify</span><span style="color: #666600" class="pun">(&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #666600" class="pun">...</span><span style="color: #000000" class="pln">&nbsp;&nbsp; </span><span style="color: #666600" class="pun">&#125;);</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #000088" class="kwd">return</span><span style="color: #000000" class="pln"> notifySave</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">saveAsync</span><span style="color: #666600" class="pun">();</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#125;).</span><span style="color: #000088" class="kwd">then</span><span style="color: #666600" class="pun">(</span><span style="color: #000088" class="kwd">function</span><span style="color: #666600" class="pun">()</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln"> &nbsp;&nbsp;</span><span style="color: #000088" class="kwd">return</span><span style="color: #000000" class="pln"> </span><span style="color: #660066" class="typ">User</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">findByIdAsync</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">user_join</span><span style="color: #666600" class="pun">);</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#125;).</span><span style="color: #000088" class="kwd">then</span><span style="color: #666600" class="pun">(</span><span style="color: #000088" class="kwd">function</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">joiner</span><span style="color: #666600" class="pun">)</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp; </span><span style="color: #000088" class="kwd">var</span><span style="color: #000000" class="pln"> teamSave </span><span style="color: #666600" class="pun">=</span><span style="color: #000000" class="pln"> </span><span style="color: #000088" class="kwd">new</span><span style="color: #000000" class="pln"> </span><span style="color: #660066" class="typ">Team</span><span style="color: #666600" class="pun">(&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #666600" class="pun">...</span><span style="color: #000000" class="pln">&nbsp;&nbsp; </span><span style="color: #666600" class="pun">&#125;);</span><span style="color: #000000" class="pln">&nbsp;&nbsp; </span><span style="color: #000088" class="kwd">return</span><span style="color: #000000" class="pln"> teamSave</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">saveAsync</span><span style="color: #666600" class="pun">();</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#125;).</span><span style="color: #000088" class="kwd">then</span><span style="color: #666600" class="pun">(</span><span style="color: #000088" class="kwd">function</span><span style="color: #666600" class="pun">()</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln"> &nbsp;&nbsp;res</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">status</span><span style="color: #666600" class="pun">(</span><span style="color: #006666" class="lit">200</span><span style="color: #666600" class="pun">).</span><span style="color: #000000" class="pln">json</span><span style="color: #666600" class="pun">(&#123;</span><span style="color: #000000" class="pln"> &nbsp;&nbsp;&nbsp;&nbsp;data</span><span style="color: #666600" class="pun">:</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;&#125;,</span><span style="color: #000000" class="pln"> &nbsp;&nbsp;&nbsp;&nbsp;status</span><span style="color: #666600" class="pun">:</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;code</span><span style="color: #666600" class="pun">:</span><span style="color: #000000" class="pln"> </span><span style="color: #006666" class="lit">0</span><span style="color: #666600" class="pun">,</span><span style="color: #000000" class="pln"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;msg</span><span style="color: #666600" class="pun">:</span><span style="color: #000000" class="pln"> </span><span style="color: #008800" class="str">'success'</span><span style="color: #000000" class="pln"> &nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #666600" class="pun">&#125;</span><span style="color: #000000" class="pln"> &nbsp;&nbsp;</span><span style="color: #666600" class="pun">&#125;);</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#125;).</span><span style="color: #000088" class="kwd">catch</span><span style="color: #666600" class="pun">(</span><span style="color: #000088" class="kwd">function</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">err</span><span style="color: #666600" class="pun">)</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln"> &nbsp;&nbsp;console</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">log</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">err</span><span style="color: #666600" class="pun">);</span><span style="color: #000000" class="pln"> &nbsp;&nbsp;res</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">status</span><span style="color: #666600" class="pun">(</span><span style="color: #006666" class="lit">200</span><span style="color: #666600" class="pun">).</span><span style="color: #000000" class="pln">json</span><span style="color: #666600" class="pun">(&#123;</span><span style="color: #000000" class="pln"> &nbsp;&nbsp;&nbsp;&nbsp;data</span><span style="color: #666600" class="pun">:</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;&#125;,</span><span style="color: #000000" class="pln"> &nbsp;&nbsp;&nbsp;&nbsp;status</span><span style="color: #666600" class="pun">:</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;code</span><span style="color: #666600" class="pun">:</span><span style="color: #000000" class="pln"> err</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">code</span><span style="color: #666600" class="pun">,</span><span style="color: #000000" class="pln"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;msg</span><span style="color: #666600" class="pun">:</span><span style="color: #000000" class="pln"> err</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">name &nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #666600" class="pun">&#125;</span><span style="color: #000000" class="pln"> &nbsp;&nbsp;</span><span style="color: #666600" class="pun">&#125;);</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#125;);</span></pre><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">很抱歉，伤害大家了，但确切是有这样用，我想问，脑子抽么？</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">优化方案</p><ul style="padding: 0px; margin: 0px 0px 10px 25px; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; font-size: 14px; line-height: 28px"><li style="line-height: 2em">mongoose上的static和method上扩展，别暴漏太多细节在控制层</li><li style="line-height: 2em">面向promise，保证每个操作都是一个函数，让流程可以组装，不要忘了最初then的初衷</li></ul><pre class="prettyprint" style="line-height: 22px; white-space: pre-wrap; padding: 0px 15px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 14px; color: #333333; border-radius: 0px; margin: 20px -10px; word-break: break-all; word-wrap: break-word; border-width: 1px 0px; border-style: none; border-color: initial; background: #f7f7f7"><span style="color: #000088" class="kwd">function</span><span style="color: #000000" class="pln"> find_user</span><span style="color: #666600" class="pun">()</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln"> &nbsp;&nbsp;</span><span style="color: #000088" class="kwd">return</span><span style="color: #000000" class="pln"> </span><span style="color: #660066" class="typ">User</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">findByIdAsync</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">user_id</span><span style="color: #666600" class="pun">);</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#125;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;</span><span style="color: #000088" class="kwd">function</span><span style="color: #000000" class="pln"> find_user2</span><span style="color: #666600" class="pun">()</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln"> &nbsp;&nbsp;</span><span style="color: #000088" class="kwd">return</span><span style="color: #000000" class="pln"> </span><span style="color: #660066" class="typ">User</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">findByIdAsync</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">user_id</span><span style="color: #666600" class="pun">);</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#125;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;</span><span style="color: #000088" class="kwd">function</span><span style="color: #000000" class="pln"> error</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">ex</span><span style="color: #666600" class="pun">)&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp; console</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">log</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">ex</span><span style="color: #666600" class="pun">);</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#125;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;</span><span style="color: #660066" class="typ">TeamPartner</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">updateByXXAsync</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">a</span><span style="color: #666600" class="pun">,</span><span style="color: #000000" class="pln">b</span><span style="color: #666600" class="pun">,</span><span style="color: #000000" class="pln">c</span><span style="color: #666600" class="pun">).</span><span style="color: #000088" class="kwd">then</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">find_user</span><span style="color: #666600" class="pun">).</span><span style="color: #000088" class="kwd">then</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">find_user2</span><span style="color: #666600" class="pun">).</span><span style="color: #000088" class="kwd">catch</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">error</span><span style="color: #666600" class="pun">)</span></pre><h2 style="margin: 30px 0px 15px; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; line-height: 40px; color: #333333; text-rendering: optimizeLegibility; font-size: 26px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #eeeeee">开源项目里的promise</h2><ul style="padding: 0px; margin: 0px 0px 10px 25px; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; font-size: 14px; line-height: 28px"><li style="line-height: 2em">ioredis</li><li style="line-height: 2em">mongoose &amp;&amp; mongoskin</li></ul><h3 style="margin: 30px 0px 15px; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; line-height: 40px; color: #333333; text-rendering: optimizeLegibility; font-size: 24.5px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #eeeeee">ioredis</h3><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif"><a style="color: #0088cc; text-decoration: none" href="javascript:if(confirm('https://github.com/luin/ioredis  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='https://github.com/luin/ioredis'" tppabs="https://github.com/luin/ioredis" target="_blank">https://github.com/luin/ioredis</a></p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">ioredis是redis库里的首选，其实它是基于node_redis的，增加和优化了很多，其中关于promise的一点是</p><pre class="prettyprint" style="line-height: 22px; white-space: pre-wrap; padding: 0px 15px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 14px; color: #333333; border-radius: 0px; margin: 20px -10px; word-break: break-all; word-wrap: break-word; border-width: 1px 0px; border-style: none; border-color: initial; background: #f7f7f7"><span style="color: #660066" class="typ">Delightful</span><span style="color: #000000" class="pln"> API</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln"> </span><span style="color: #660066" class="typ">It</span><span style="color: #000000" class="pln"> works </span><span style="color: #000088" class="kwd">with</span><span style="color: #000000" class="pln"> </span><span style="color: #660066" class="typ">Node</span><span style="color: #000000" class="pln"> callbacks </span><span style="color: #000088" class="kwd">and</span><span style="color: #000000" class="pln"> </span><span style="color: #660066" class="typ">Bluebird</span><span style="color: #000000" class="pln"> promises</span><span style="color: #666600" class="pun">.</span></pre><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">用法</p><pre class="prettyprint" style="line-height: 22px; white-space: pre-wrap; padding: 0px 15px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 14px; color: #333333; border-radius: 0px; margin: 20px -10px; word-break: break-all; word-wrap: break-word; border-width: 1px 0px; border-style: none; border-color: initial; background: #f7f7f7"><span style="color: #000000" class="pln">redis</span><span style="color: #666600" class="pun">.</span><span style="color: #000088" class="kwd">get</span><span style="color: #666600" class="pun">(</span><span style="color: #008800" class="str">'foo'</span><span style="color: #666600" class="pun">).</span><span style="color: #000088" class="kwd">then</span><span style="color: #666600" class="pun">(</span><span style="color: #000088" class="kwd">function</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">result</span><span style="color: #666600" class="pun">)</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp; console</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">log</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">result</span><span style="color: #666600" class="pun">);</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#125;);</span></pre><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">真心比node_redis好用的多。</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">luin是《Redis入门指南》一书作者，90后，全栈+设计，写过不少nodejs模块，目前就在群里</p><h3 style="margin: 30px 0px 15px; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; line-height: 40px; color: #333333; text-rendering: optimizeLegibility; font-size: 24.5px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #eeeeee">mongoose &amp;&amp; mongoskin</h3><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">mongoose是nodejs处理mongodb的不二选择，简单说一下mongoskin</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">官方说</p><pre class="prettyprint" style="line-height: 22px; white-space: pre-wrap; padding: 0px 15px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 14px; color: #333333; border-radius: 0px; margin: 20px -10px; word-break: break-all; word-wrap: break-word; border-width: 1px 0px; border-style: none; border-color: initial; background: #f7f7f7"><span style="color: #660066" class="typ">The</span><span style="color: #000000" class="pln"> promise wrapper </span><span style="color: #000088" class="kwd">for</span><span style="color: #000000" class="pln"> node</span><span style="color: #666600" class="pun">-</span><span style="color: #000000" class="pln">mongodb</span><span style="color: #666600" class="pun">-</span><span style="color: #000088" class="kwd">native</span><span style="color: #666600" class="pun">.</span></pre><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">做了很多api上的优化，还是不错的，可是mongoose也出了promise</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">mongoose仿佛在喊：&ldquo;用我，我也可以then&rdquo;。。。。</p><h1 style="margin: 30px 0px 15px; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; line-height: 40px; color: #333333; text-rendering: optimizeLegibility; font-size: 32.5px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #eeeeee">4）最后给出未来展望</h1><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">未来主要是es6和es7上的实现</p><ul style="padding: 0px; margin: 0px 0px 10px 25px; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; font-size: 14px; line-height: 28px"><li style="line-height: 2em">es6上的Generators/yield</li><li style="line-height: 2em">es7上的Async/await</li></ul><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">都是好东西，可以尝试，毕竟早晚js还是要升级的，先做技术储备吧</p><h2 style="margin: 30px 0px 15px; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; line-height: 40px; color: #333333; text-rendering: optimizeLegibility; font-size: 26px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #eeeeee">生成器Generators/yield</h2><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">生成器是ES6（也被称为ES2015）的新特性。</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">想象下面这样的一个场景：</p><pre class="prettyprint" style="line-height: 22px; white-space: pre-wrap; padding: 0px 15px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 14px; color: #333333; border-radius: 0px; margin: 20px -10px; word-break: break-all; word-wrap: break-word; border-width: 1px 0px; border-style: none; border-color: initial; background: #f7f7f7"><span style="color: #666600" class="pun">当你在执行一个函数的时候，你可以在某个点暂停函数的执行，并且做一些其他工作，然后再返回这个函数继续执行，</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">甚至是携带一些新的值，然后继续执行。</span></pre><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">上面描述的场景正是JavaScript生成器函数所致力于解决的问题。</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">当我们调用一个生成器函数的时候，它并不会立即执行， 而是需要我们手动的去执行迭代操作（next方法）。也就是说，你调用生成器函数，它会返回给你一个迭代器。迭代器会遍历每个中断点。</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">看例子</p><pre class="prettyprint" style="line-height: 22px; white-space: pre-wrap; padding: 0px 15px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 14px; color: #333333; border-radius: 0px; margin: 20px -10px; word-break: break-all; word-wrap: break-word; border-width: 1px 0px; border-style: none; border-color: initial; background: #f7f7f7"><span style="color: #000088" class="kwd">function</span><span style="color: #666600" class="pun">*</span><span style="color: #000000" class="pln"> foo </span><span style="color: #666600" class="pun">()</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #000088" class="kwd">var</span><span style="color: #000000" class="pln"> index </span><span style="color: #666600" class="pun">=</span><span style="color: #000000" class="pln"> </span><span style="color: #006666" class="lit">0</span><span style="color: #666600" class="pun">;</span><span style="color: #000000" class="pln">&nbsp;&nbsp; </span><span style="color: #000088" class="kwd">while</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">index </span><span style="color: #666600" class="pun">&lt;</span><span style="color: #000000" class="pln"> </span><span style="color: #006666" class="lit">2</span><span style="color: #666600" class="pun">)</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #000088" class="kwd">yield</span><span style="color: #000000" class="pln"> index</span><span style="color: #666600" class="pun">++;</span><span style="color: #000000" class="pln"> </span><span style="color: #880000" class="com">//暂停函数执行，并执行yield后的操作</span><span style="color: #000000" class="pln">&nbsp;&nbsp; </span><span style="color: #666600" class="pun">&#125;</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#125;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;</span><span style="color: #000088" class="kwd">var</span><span style="color: #000000" class="pln"> bar </span><span style="color: #666600" class="pun">=</span><span style="color: #000000" class="pln">&nbsp;&nbsp;foo</span><span style="color: #666600" class="pun">();</span><span style="color: #000000" class="pln"> </span><span style="color: #880000" class="com">// 返回的其实是一个迭代器</span><span style="color: #000000" class="pln">&nbsp;&nbsp;console</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">log</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">bar</span><span style="color: #666600" class="pun">.</span><span style="color: #000088" class="kwd">next</span><span style="color: #666600" class="pun">());</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #880000" class="com">// &#123; value: 0, done: false &#125;&nbsp;&nbsp;</span><span style="color: #000000" class="pln"> console</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">log</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">bar</span><span style="color: #666600" class="pun">.</span><span style="color: #000088" class="kwd">next</span><span style="color: #666600" class="pun">());</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #880000" class="com">// &#123; value: 1, done: false &#125;&nbsp;&nbsp;</span><span style="color: #000000" class="pln"> console</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">log</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">bar</span><span style="color: #666600" class="pun">.</span><span style="color: #000088" class="kwd">next</span><span style="color: #666600" class="pun">());</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #880000" class="com">// &#123; value: undefined, done: true &#125;&nbsp;&nbsp;</span></pre><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">如果你想更轻松的使用生成器函数来编写异步JavaScript代码，我们可以使用 co 这个库，co是著名的tj大神写的，是一个为Node.js和浏览器打造的基于生成器的流程控制工具，借助于Promise，你可以使用更加优雅的方式编写非阻塞代码。</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">使用co，改写前面的示例代码：</p><pre class="prettyprint" style="line-height: 22px; white-space: pre-wrap; padding: 0px 15px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 14px; color: #333333; border-radius: 0px; margin: 20px -10px; word-break: break-all; word-wrap: break-word; border-width: 1px 0px; border-style: none; border-color: initial; background: #f7f7f7"><span style="color: #000000" class="pln">co</span><span style="color: #666600" class="pun">(</span><span style="color: #000088" class="kwd">function</span><span style="color: #666600" class="pun">*</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">()&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #000088" class="kwd">yield</span><span style="color: #000000" class="pln"> </span><span style="color: #660066" class="typ">Something</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">save</span><span style="color: #666600" class="pun">();</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#125;).</span><span style="color: #000088" class="kwd">then</span><span style="color: #666600" class="pun">(</span><span style="color: #000088" class="kwd">function</span><span style="color: #666600" class="pun">()</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp; </span><span style="color: #880000" class="com">// success</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#125;)</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">.</span><span style="color: #000088" class="kwd">catch</span><span style="color: #666600" class="pun">(</span><span style="color: #000088" class="kwd">function</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">err</span><span style="color: #666600" class="pun">)</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp; </span><span style="color: #880000" class="com">//error handling</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#125;);</span></pre><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">你可能会问：如何实现并行操作呢？答案可能比你想象的简单，如下</p><pre class="prettyprint" style="line-height: 22px; white-space: pre-wrap; padding: 0px 15px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 14px; color: #333333; border-radius: 0px; margin: 20px -10px; word-break: break-all; word-wrap: break-word; border-width: 1px 0px; border-style: none; border-color: initial; background: #f7f7f7"><span style="color: #000088" class="kwd">yield</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">[</span><span style="color: #000000" class="pln">a</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">save</span><span style="color: #666600" class="pun">(),</span><span style="color: #000000" class="pln"> b</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">save</span><span style="color: #666600" class="pun">()];</span><span style="color: #000000" class="pln">&nbsp;&nbsp;</span></pre><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">其实它就是Promise.all，换种写法而已</p><h2 style="margin: 30px 0px 15px; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; line-height: 40px; color: #333333; text-rendering: optimizeLegibility; font-size: 26px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #eeeeee">Async/await</h2><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">在ES7（还未正式标准化）中引入了Async函数的概念，目前如果你想要使用的话，只能借助于babel 这样的语法转换器将其转为ES5代码。</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">使用async关键字，可以轻松地达成之前使用生成器和co函数所做到的工作。当然，hack除外</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">可以这样理解，async函数实际使用的是Promise，然后使用await来执行异步操作，这里的await类似于上面讲的yield</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">因此，使用async重写上面的代码：</p><pre class="prettyprint" style="line-height: 22px; white-space: pre-wrap; padding: 0px 15px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 14px; color: #333333; border-radius: 0px; margin: 20px -10px; word-break: break-all; word-wrap: break-word; border-width: 1px 0px; border-style: none; border-color: initial; background: #f7f7f7"><span style="color: #000000" class="pln">async </span><span style="color: #000088" class="kwd">function</span><span style="color: #000000" class="pln"> save</span><span style="color: #666600" class="pun">(</span><span style="color: #660066" class="typ">Something</span><span style="color: #666600" class="pun">)</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #000088" class="kwd">try</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; await </span><span style="color: #660066" class="typ">Something</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">save</span><span style="color: #666600" class="pun">();</span><span style="color: #000000" class="pln"> </span><span style="color: #880000" class="com">// 等待await后面的代码执行完，类似于yield</span><span style="color: #000000" class="pln">&nbsp;&nbsp; </span><span style="color: #666600" class="pun">&#125;</span><span style="color: #000000" class="pln"> </span><span style="color: #000088" class="kwd">catch</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">err</span><span style="color: #666600" class="pun">)</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #880000" class="com">//error handling</span><span style="color: #000000" class="pln">&nbsp;&nbsp; </span><span style="color: #666600" class="pun">&#125;</span><span style="color: #000000" class="pln">&nbsp;&nbsp; console</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">log</span><span style="color: #666600" class="pun">(</span><span style="color: #008800" class="str">'success'</span><span style="color: #666600" class="pun">);</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#125;</span></pre><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">下一代web框架Koa也支持async函数，如果你也在使用koa，那么你现在就可以借助babel使用这一特性了</p><pre class="prettyprint" style="line-height: 22px; white-space: pre-wrap; padding: 0px 15px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 14px; color: #333333; border-radius: 0px; margin: 20px -10px; word-break: break-all; word-wrap: break-word; border-width: 1px 0px; border-style: none; border-color: initial; background: #f7f7f7"><span style="color: #000088" class="kwd">import</span><span style="color: #000000" class="pln"> koa </span><span style="color: #000088" class="kwd">from</span><span style="color: #000000" class="pln"> koa</span><span style="color: #666600" class="pun">;</span><span style="color: #000000" class="pln">&nbsp;&nbsp; let app </span><span style="color: #666600" class="pun">=</span><span style="color: #000000" class="pln"> koa</span><span style="color: #666600" class="pun">();</span><span style="color: #000000" class="pln">&nbsp;&nbsp;app</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">experimental </span><span style="color: #666600" class="pun">=</span><span style="color: #000000" class="pln"> </span><span style="color: #000088" class="kwd">true</span><span style="color: #666600" class="pun">;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;app</span><span style="color: #666600" class="pun">.</span><span style="color: #000088" class="kwd">use</span><span style="color: #666600" class="pun">(</span><span style="color: #000000" class="pln">async </span><span style="color: #000088" class="kwd">function</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">()&#123;</span><span style="color: #000000" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #000088" class="kwd">this</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">body </span><span style="color: #666600" class="pun">=</span><span style="color: #000000" class="pln"> await </span><span style="color: #660066" class="typ">Promise</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">resolve</span><span style="color: #666600" class="pun">(</span><span style="color: #008800" class="str">'Hello Reader!'</span><span style="color: #666600" class="pun">)</span><span style="color: #000000" class="pln"> </span><span style="color: #666600" class="pun">&#125;)</span><span style="color: #000000" class="pln">&nbsp;&nbsp;app</span><span style="color: #666600" class="pun">.</span><span style="color: #000000" class="pln">listen</span><span style="color: #666600" class="pun">(</span><span style="color: #006666" class="lit">3000</span><span style="color: #666600" class="pun">);</span><span style="color: #000000" class="pln">&nbsp;&nbsp;</span></pre><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">这里报个料，群里<a style="color: #0088cc; text-decoration: none" href="javascript:if(confirm('https://github.com/fundon  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='https://github.com/fundon'" tppabs="https://github.com/fundon" target="_blank">fundon</a> 大神写的https://github.com/trekjs/trek 是基于koa的，使用babel编译，并有更多相当棒的特性。爱折腾的可以试试</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">最后还是要归纳总结一下，</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">先复习promise/a+的四个要点</p><ul style="padding: 0px; margin: 0px 0px 10px 25px; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; font-size: 14px; line-height: 28px"><li style="line-height: 2em">a) 异步操作的最终结果，尽可能每一个异步操作都是独立操作单元</li><li style="line-height: 2em">b) 与Promise最主要的交互方法是通过将函数传入它的then方法（thenable）</li><li style="line-height: 2em">c) 捕获异常catch error</li><li style="line-height: 2em">d) 根据reject和resolve重塑流程</li></ul><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">已经第三遍，该记住了！</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">继续看第一个图</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif"><img style="height: auto; max-width: 100%; vertical-align: middle; border: 0px; cursor: pointer" src="FgKu20kvFqHrkgpjbQxXkV1DmrG1.png" tppabs="http://dn-cnode.qbox.me/FgKu20kvFqHrkgpjbQxXkV1DmrG1" border="0" alt="1.png" /></p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">再来看这张图，从callback到promose是历史的必然产物</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">generator是一种新的定义方式，定义操作单元，尤其在迭代器的情况，搭配yield来执行，可读性上差了很多，好处是真的解耦了</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">co是一个中间产品，可以说是给generator增加了promise实现，可读性和易用性是愿意好于generator + yield的</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">最后我们看看async，它实际上是通过async这个关键词，定义的函数就可以返回promise对象，可以说async就是能返回promise对象的generator。yield关键词以及被generator绑架了，那它就换个名字，叫await</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">其实从这段历史来看，反复就是promise上的折腾，只是加了generator这个别名，只是async是能返回promise的generator</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">这样理解是不是更简单呢？</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">万变不离其宗，想精通js或者nodejs，promise是大家必须迈过去的坑。</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">谢谢大家，今天讲的内容就到这里，如果有什么讲的不对的、不合理的，请不吝赐教，共同学习</p><p style="margin: 1em 0px; font-size: 15px; word-break: break-word; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7em; overflow: auto; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif">大家有任何不明白或者想提问的可以随时私信给小助手，我会在答疑阶段统一回答</p><h2 style="margin: 30px 0px 15px; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; line-height: 40px; color: #333333; text-rendering: optimizeLegibility; font-size: 26px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #eeeeee">推荐资料</h2><ul style="padding: 0px; margin: 0px 0px 10px 25px; color: #333333; font-family: 'Helvetica Neue', 'Luxi Sans', 'DejaVu Sans', Tahoma, 'Hiragino Sans GB', STHeiti, sans-serif; font-size: 14px; line-height: 28px"><li style="line-height: 2em"><a style="color: #0088cc; text-decoration: none" href="javascript:if(confirm('http://liubin.github.io/promises-book/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://liubin.github.io/promises-book/#introduction'" tppabs="http://liubin.github.io/promises-book/#introduction" target="_blank">http://liubin.github.io/promises-book/#introduction</a></li><li style="line-height: 2em"><a style="color: #0088cc; text-decoration: none" href="javascript:if(confirm('http://www.mattgreer.org/articles/promises-in-wicked-detail/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.mattgreer.org/articles/promises-in-wicked-detail/'" tppabs="http://www.mattgreer.org/articles/promises-in-wicked-detail/" target="_blank">http://www.mattgreer.org/articles/promises-in-wicked-detail/</a></li></ul>
	</div>
	<div class="textbox-bottom">
	</div>
	<div class="tags" style="display: none"> 
	</div>
</div><div class="textbox">
	<div class="textbox-calendar">
	<span class="textbox-calendar-month">Aug</span>
	<span class="textbox-calendar-day">29</span>
	</div>
	<div class="textbox-title">
		<h4>
		<a href="read.php-7513.htm" tppabs="http://i.renjihe.com/blog/read.php?7513">nodejs异步控制利器Async</a> <span id="starid7513"><img src="unstarred.gif" tppabs="http://i.renjihe.com/blog/template/default/images/others/unstarred.gif" alt="" title="未加星标" border="0"/></span> <img src="blank.gif" tppabs="http://i.renjihe.com/blog/images/weather/blank.gif" alt="不指定" title="不指定"/>
		</h4>
		<div class="textbox-label">
		<a href="view.php-go=user_1.htm" tppabs="http://i.renjihe.com/blog/view.php?go=user_1" target="_blank">renjihe1988</a> , 14:34 , <a href="index.php-go=category_2.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_2" title="查看分类： 软件">软件</a> &raquo; <a href="index.php-go=category_13.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_13" title="查看分类： web">web</a> , <a href="read.php-7513.htm#reply" tppabs="http://i.renjihe.com/blog/read.php?7513#reply" title="发表您的评论">评论(0)</a> , <a href='javascript: void(0);' title="查看引用地址" onclick='showhidediv("tb7513");'>引用(0)</a> , <a href="read.php-7513.htm" tppabs="http://i.renjihe.com/blog/read.php?7513">阅读(2)</a> , Via 本站原创 
		</div>
	</div>
	<div id="tb7513" style="display: none;" class="textbox-tburl"><strong>引用功能被关闭了。</strong></div>
	
	<div class="textbox-content">
	<p style="margin: 0px 0px 1.1em; padding: 0px; box-sizing: border-box; color: #555555; font-family: 'microsoft yahei'; font-size: 14px; line-height: 35px">Node.js 是一个基于 Chrome V8 引擎的 JavaScript 运行环境。Node.js 使用了一个事件驱动、非阻塞式 I/O 的模型，使其轻量又高效。&nbsp;<br />因为是js语言，也就是说，凡是懂得一点js或者jquery，对nodejs入手相当的快，而且没过多久你就会爱上nodejs！</p><h3 style="margin: 0.8em 0px; padding: 0px; box-sizing: border-box; font-weight: 100; color: #555555; font-family: 'microsoft yahei'; line-height: 35px"><a style="box-sizing: border-box; color: #0c89cf" name="t0"></a>但是！但是！但是！</h3><p style="margin: 0px 0px 1.1em; padding: 0px; box-sizing: border-box; color: #555555; font-family: 'microsoft yahei'; font-size: 14px; line-height: 35px">nodejs是基于异步的写法，有时一个函数需要上一个函数的返回值做参数，这样下来一不小心就会陷入回调地狱的陷阱中。（一把辛酸泪-_-!!!）&nbsp;<br />下面的一个相当简单的需求</p><pre class="prettyprint" style="white-space: nowrap; word-wrap: break-word; box-sizing: border-box; position: relative; overflow-y: hidden; overflow-x: auto; margin-top: 0px; margin-bottom: 1.1em; font-family: 'Source Code Pro', monospace; padding: 5px 5px 5px 60px; font-size: 14px; line-height: 1.45; word-break: break-all; color: #333333; border: 1px solid rgba(128, 128, 128, 0.0745098); border-radius: 0px; background-color: rgba(128, 128, 128, 0.0470588)">将A、B、<span style="box-sizing: border-box; color: #000088" class="hljs-keyword">C</span>文件里面的内容读取出来存到<span style="box-sizing: border-box; color: #000088" class="hljs-keyword">D</span>文件中<ul class="pre-numbering" style="box-sizing: border-box; position: absolute; width: 50px; top: 0px; left: 0px; margin: 0px; padding: 6px 0px 40px; border-right-width: 1px; border-right-style: solid; border-right-color: #dddddd; list-style: none; text-align: right; background-color: #eeeeee"><li style="box-sizing: border-box; padding: 0px 5px">1</li></ul><ul class="pre-numbering" style="box-sizing: border-box; position: absolute; width: 50px; top: 0px; left: 0px; margin: 0px; padding: 6px 0px 40px; border-right-width: 1px; border-right-style: solid; border-right-color: #dddddd; list-style: none; text-align: right; background-color: #eeeeee"><li style="box-sizing: border-box; padding: 0px 5px">1</li></ul></pre><p style="margin: 0px 0px 1.1em; padding: 0px; box-sizing: border-box; color: #555555; font-family: 'microsoft yahei'; font-size: 14px; line-height: 35px">普通的写法如下</p><pre class="prettyprint" style="white-space: nowrap; word-wrap: break-word; box-sizing: border-box; position: relative; overflow-y: hidden; overflow-x: auto; margin-top: 0px; margin-bottom: 1.1em; font-family: 'Source Code Pro', monospace; padding: 5px 5px 5px 60px; font-size: 14px; line-height: 1.45; word-break: break-all; color: #333333; border: 1px solid rgba(128, 128, 128, 0.0745098); border-radius: 0px; background-color: rgba(128, 128, 128, 0.0470588)"><span style="box-sizing: border-box; color: #000088" class="hljs-keyword">var</span> fs = <span style="box-sizing: border-box; color: #660066" class="hljs-built_in">require</span>(<span style="box-sizing: border-box; color: #008800" class="hljs-string">'fs'</span>); fs.readFile(<span style="box-sizing: border-box; color: #008800" class="hljs-string">'D:&#92;&#92;test&#92;&#92;A.txt'</span>,<span style="box-sizing: border-box" class="hljs-function"><span style="box-sizing: border-box; color: #000088" class="hljs-keyword">function</span><span style="box-sizing: border-box; color: #660066" class="hljs-params">(err,data1)</span>&#123;</span>&nbsp;&nbsp; fs.readFile(<span style="box-sizing: border-box; color: #008800" class="hljs-string">'D:&#92;&#92;test&#92;&#92;B.txt'</span>,<span style="box-sizing: border-box" class="hljs-function"><span style="box-sizing: border-box; color: #000088" class="hljs-keyword">function</span><span style="box-sizing: border-box; color: #660066" class="hljs-params">(err,data2)</span>&#123;</span>&nbsp;&nbsp;&nbsp;&nbsp; fs.readFile(<span style="box-sizing: border-box; color: #008800" class="hljs-string">'D:&#92;&#92;test&#92;&#92;C.txt'</span>,<span style="box-sizing: border-box" class="hljs-function"><span style="box-sizing: border-box; color: #000088" class="hljs-keyword">function</span><span style="box-sizing: border-box; color: #660066" class="hljs-params">(err,data3)</span>&#123;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; console.log(data1+<span style="box-sizing: border-box; color: #008800" class="hljs-string">'&gt;&gt;&gt;'</span>+data2+<span style="box-sizing: border-box; color: #008800" class="hljs-string">'&gt;&gt;&gt;'</span>+data3);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fs.writeFile(<span style="box-sizing: border-box; color: #008800" class="hljs-string">'D:&#92;&#92;test&#92;&#92;D.txt'</span>,data1+<span style="box-sizing: border-box; color: #008800" class="hljs-string">'&gt;&gt;&gt;'</span>+data2+<span style="box-sizing: border-box; color: #008800" class="hljs-string">'&gt;&gt;&gt;'</span>+data3,<span style="box-sizing: border-box" class="hljs-function"><span style="box-sizing: border-box; color: #000088" class="hljs-keyword">function</span><span style="box-sizing: border-box; color: #660066" class="hljs-params">(err)</span>&#123;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; console.log(err);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125;);&nbsp;&nbsp;&nbsp;&nbsp; &#125;);&nbsp;&nbsp; &#125;); &#125;);<ul class="pre-numbering" style="box-sizing: border-box; position: absolute; width: 50px; top: 0px; left: 0px; margin: 0px; padding: 6px 0px 40px; border-right-width: 1px; border-right-style: solid; border-right-color: #dddddd; list-style: none; text-align: right; background-color: #eeeeee"><li style="box-sizing: border-box; padding: 0px 5px">1</li><li style="box-sizing: border-box; padding: 0px 5px">2</li><li style="box-sizing: border-box; padding: 0px 5px">3</li><li style="box-sizing: border-box; padding: 0px 5px">4</li><li style="box-sizing: border-box; padding: 0px 5px">5</li><li style="box-sizing: border-box; padding: 0px 5px">6</li><li style="box-sizing: border-box; padding: 0px 5px">7</li><li style="box-sizing: border-box; padding: 0px 5px">8</li><li style="box-sizing: border-box; padding: 0px 5px">9</li><li style="box-sizing: border-box; padding: 0px 5px">10</li><li style="box-sizing: border-box; padding: 0px 5px">11</li></ul><ul class="pre-numbering" style="box-sizing: border-box; position: absolute; width: 50px; top: 0px; left: 0px; margin: 0px; padding: 6px 0px 40px; border-right-width: 1px; border-right-style: solid; border-right-color: #dddddd; list-style: none; text-align: right; background-color: #eeeeee"><li style="box-sizing: border-box; padding: 0px 5px">1</li><li style="box-sizing: border-box; padding: 0px 5px">2</li><li style="box-sizing: border-box; padding: 0px 5px">3</li><li style="box-sizing: border-box; padding: 0px 5px">4</li><li style="box-sizing: border-box; padding: 0px 5px">5</li><li style="box-sizing: border-box; padding: 0px 5px">6</li><li style="box-sizing: border-box; padding: 0px 5px">7</li><li style="box-sizing: border-box; padding: 0px 5px">8</li><li style="box-sizing: border-box; padding: 0px 5px">9</li><li style="box-sizing: border-box; padding: 0px 5px">10</li><li style="box-sizing: border-box; padding: 0px 5px">11</li></ul></pre><p style="margin: 0px 0px 1.1em; padding: 0px; box-sizing: border-box; color: #555555; font-family: 'microsoft yahei'; font-size: 14px; line-height: 35px">如果再来个a，b，c等等文件，各种嵌套，一是看起来很凌乱，二是后来维护起来是相当的困难！&nbsp;<br />那么为了避免这样的问题，也有一些模块来解决，比如Promise，Async，co等等，使用哪种来控制异步流程，我也纠结了许久，最终选择使用Async，有人说Asunc是一代，promise是二代，co是三代。于是毫不犹豫的选择了Async.&nbsp;<br />在此推荐相当详细的demo地址&nbsp;<br /><a style="text-decoration: none; box-sizing: border-box; color: #0c89cf" href="javascript:if(confirm('https://github.com/bsspirit/async_demo  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='https://github.com/bsspirit/async_demo'" tppabs="https://github.com/bsspirit/async_demo">GitHub地址</a>&nbsp;<br />里面把asunc所有的方法重新讲解了一遍，很详细。&nbsp;<br />我下面要介绍的是四种控制流程&nbsp;<br />* 串行无关联&nbsp;<br />* 串行有关联&nbsp;<br />* 并行无关联&nbsp;<br />* 只能控制</p><p style="margin: 0px 0px 1.1em; padding: 0px; box-sizing: border-box; color: #555555; font-family: 'microsoft yahei'; font-size: 14px; line-height: 35px">下载async模块</p><pre class="prettyprint" style="white-space: nowrap; word-wrap: break-word; box-sizing: border-box; position: relative; overflow-y: hidden; overflow-x: auto; margin-top: 0px; margin-bottom: 1.1em; font-family: 'Source Code Pro', monospace; padding: 5px 5px 5px 60px; font-size: 14px; line-height: 1.45; word-break: break-all; color: #333333; border: 1px solid rgba(128, 128, 128, 0.0745098); border-radius: 0px; background-color: rgba(128, 128, 128, 0.0470588)">npm install async<ul class="pre-numbering" style="box-sizing: border-box; position: absolute; width: 50px; top: 0px; left: 0px; margin: 0px; padding: 6px 0px 40px; border-right-width: 1px; border-right-style: solid; border-right-color: #dddddd; list-style: none; text-align: right; background-color: #eeeeee"><li style="box-sizing: border-box; padding: 0px 5px">1</li></ul><ul class="pre-numbering" style="box-sizing: border-box; position: absolute; width: 50px; top: 0px; left: 0px; margin: 0px; padding: 6px 0px 40px; border-right-width: 1px; border-right-style: solid; border-right-color: #dddddd; list-style: none; text-align: right; background-color: #eeeeee"><li style="box-sizing: border-box; padding: 0px 5px">1</li></ul></pre><h3 style="margin: 0.8em 0px; padding: 0px; box-sizing: border-box; font-weight: 100; color: #555555; font-family: 'microsoft yahei'; line-height: 35px"><a style="box-sizing: border-box; color: #0c89cf" name="t1"></a>串行无关联</h3><p style="margin: 0px 0px 1.1em; padding: 0px; box-sizing: border-box; color: #555555; font-family: 'microsoft yahei'; font-size: 14px; line-height: 35px">多个函数或方法要依次执行，但是他们之间并没有什么联系，只有先后的顺序，比如我要写一个文件，写完之后像用户发送邮件，这两者之间没有必然的联系，但是发邮件必须在写文件完成之后。&nbsp;<br />async里有一个方法series可以实现这一流程,代码实现如下：</p><pre class="prettyprint" style="white-space: nowrap; word-wrap: break-word; box-sizing: border-box; position: relative; overflow-y: hidden; overflow-x: auto; margin-top: 0px; margin-bottom: 1.1em; font-family: 'Source Code Pro', monospace; padding: 5px 5px 5px 60px; font-size: 14px; line-height: 1.45; word-break: break-all; color: #333333; border: 1px solid rgba(128, 128, 128, 0.0745098); border-radius: 0px; background-color: rgba(128, 128, 128, 0.0470588)"><span style="box-sizing: border-box; color: #000088" class="hljs-keyword">var</span> async = <span style="box-sizing: border-box; color: #660066" class="hljs-built_in">require</span>(<span style="box-sizing: border-box; color: #008800" class="hljs-string">'async'</span>); console.time(<span style="box-sizing: border-box; color: #008800" class="hljs-string">'series'</span>); async.series(&#123;&nbsp;&nbsp;&nbsp;&nbsp; one: <span style="box-sizing: border-box" class="hljs-function"><span style="box-sizing: border-box; color: #000088" class="hljs-keyword">function</span><span style="box-sizing: border-box; color: #660066" class="hljs-params">(callback)</span> &#123;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; callback(<span style="box-sizing: border-box; color: #006666" class="hljs-literal">null</span>, <span style="box-sizing: border-box; color: #008800" class="hljs-string">'one'</span>);<span style="box-sizing: border-box; color: #880000" class="hljs-comment">//callback('i am err','one');异常处理</span>&nbsp;&nbsp;&nbsp;&nbsp; &#125;,&nbsp;&nbsp;&nbsp;&nbsp; two: <span style="box-sizing: border-box" class="hljs-function"><span style="box-sizing: border-box; color: #000088" class="hljs-keyword">function</span><span style="box-sizing: border-box; color: #660066" class="hljs-params">(callback)</span> &#123;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; callback(<span style="box-sizing: border-box; color: #006666" class="hljs-literal">null</span>, <span style="box-sizing: border-box; color: #008800" class="hljs-string">'two'</span>);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125;, &#125;, <span style="box-sizing: border-box" class="hljs-function"><span style="box-sizing: border-box; color: #000088" class="hljs-keyword">function</span><span style="box-sizing: border-box; color: #660066" class="hljs-params">(error, result)</span> &#123;</span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="box-sizing: border-box; color: #880000" class="hljs-comment">//最后结果</span>&nbsp;&nbsp;&nbsp;&nbsp; console.log(<span style="box-sizing: border-box; color: #008800" class="hljs-string">'error: '</span> + error);&nbsp;&nbsp;&nbsp;&nbsp; console.log(<span style="box-sizing: border-box; color: #008800" class="hljs-string">'result: '</span> + result);&nbsp;&nbsp;&nbsp;&nbsp; console.timeEnd(<span style="box-sizing: border-box; color: #008800" class="hljs-string">'series'</span>); &#125;);<ul class="pre-numbering" style="box-sizing: border-box; position: absolute; width: 50px; top: 0px; left: 0px; margin: 0px; padding: 6px 0px 40px; border-right-width: 1px; border-right-style: solid; border-right-color: #dddddd; list-style: none; text-align: right; background-color: #eeeeee"><li style="box-sizing: border-box; padding: 0px 5px">1</li><li style="box-sizing: border-box; padding: 0px 5px">2</li><li style="box-sizing: border-box; padding: 0px 5px">3</li><li style="box-sizing: border-box; padding: 0px 5px">4</li><li style="box-sizing: border-box; padding: 0px 5px">5</li><li style="box-sizing: border-box; padding: 0px 5px">6</li><li style="box-sizing: border-box; padding: 0px 5px">7</li><li style="box-sizing: border-box; padding: 0px 5px">8</li><li style="box-sizing: border-box; padding: 0px 5px">9</li><li style="box-sizing: border-box; padding: 0px 5px">10</li><li style="box-sizing: border-box; padding: 0px 5px">11</li><li style="box-sizing: border-box; padding: 0px 5px">12</li><li style="box-sizing: border-box; padding: 0px 5px">13</li><li style="box-sizing: border-box; padding: 0px 5px">14</li><li style="box-sizing: border-box; padding: 0px 5px">15</li><li style="box-sizing: border-box; padding: 0px 5px">16</li></ul><ul class="pre-numbering" style="box-sizing: border-box; position: absolute; width: 50px; top: 0px; left: 0px; margin: 0px; padding: 6px 0px 40px; border-right-width: 1px; border-right-style: solid; border-right-color: #dddddd; list-style: none; text-align: right; background-color: #eeeeee"><li style="box-sizing: border-box; padding: 0px 5px">1</li><li style="box-sizing: border-box; padding: 0px 5px">2</li><li style="box-sizing: border-box; padding: 0px 5px">3</li><li style="box-sizing: border-box; padding: 0px 5px">4</li><li style="box-sizing: border-box; padding: 0px 5px">5</li><li style="box-sizing: border-box; padding: 0px 5px">6</li><li style="box-sizing: border-box; padding: 0px 5px">7</li><li style="box-sizing: border-box; padding: 0px 5px">8</li><li style="box-sizing: border-box; padding: 0px 5px">9</li><li style="box-sizing: border-box; padding: 0px 5px">10</li><li style="box-sizing: border-box; padding: 0px 5px">11</li><li style="box-sizing: border-box; padding: 0px 5px">12</li><li style="box-sizing: border-box; padding: 0px 5px">13</li><li style="box-sizing: border-box; padding: 0px 5px">14</li><li style="box-sizing: border-box; padding: 0px 5px">15</li><li style="box-sizing: border-box; padding: 0px 5px">16</li></ul></pre><p style="margin: 0px 0px 1.1em; padding: 0px; box-sizing: border-box; color: #555555; font-family: 'microsoft yahei'; font-size: 14px; line-height: 35px">结果</p><pre class="prettyprint" style="white-space: nowrap; word-wrap: break-word; box-sizing: border-box; position: relative; overflow-y: hidden; overflow-x: auto; margin-top: 0px; margin-bottom: 1.1em; font-family: 'Source Code Pro', monospace; padding: 5px 5px 5px 60px; font-size: 14px; line-height: 1.45; word-break: break-all; color: #333333; border: 1px solid rgba(128, 128, 128, 0.0745098); border-radius: 0px; background-color: rgba(128, 128, 128, 0.0470588)">error: null result: [object Object] series: <span style="box-sizing: border-box; color: #006666" class="hljs-number">4.472</span>ms<ul class="pre-numbering" style="box-sizing: border-box; position: absolute; width: 50px; top: 0px; left: 0px; margin: 0px; padding: 6px 0px 40px; border-right-width: 1px; border-right-style: solid; border-right-color: #dddddd; list-style: none; text-align: right; background-color: #eeeeee"><li style="box-sizing: border-box; padding: 0px 5px">1</li><li style="box-sizing: border-box; padding: 0px 5px">2</li><li style="box-sizing: border-box; padding: 0px 5px">3</li></ul><ul class="pre-numbering" style="box-sizing: border-box; position: absolute; width: 50px; top: 0px; left: 0px; margin: 0px; padding: 6px 0px 40px; border-right-width: 1px; border-right-style: solid; border-right-color: #dddddd; list-style: none; text-align: right; background-color: #eeeeee"><li style="box-sizing: border-box; padding: 0px 5px">1</li><li style="box-sizing: border-box; padding: 0px 5px">2</li><li style="box-sizing: border-box; padding: 0px 5px">3</li></ul></pre><p style="margin: 0px 0px 1.1em; padding: 0px; box-sizing: border-box; color: #555555; font-family: 'microsoft yahei'; font-size: 14px; line-height: 35px">串行流程，one执行完再执行two，如果有three、four等方法，依次写下去，callback(arg1,arg2),两个参数，arg1是异常，arg2是方法的返回值，如果某个函数中arg1不为空，则程序到此终止，之后的不再执行，可自行测试！&nbsp;<br /><strong style="box-sizing: border-box">注意:waterfall不能使用对象表示法来传递(json格式)</strong></p><h3 style="margin: 0.8em 0px; padding: 0px; box-sizing: border-box; font-weight: 100; color: #555555; font-family: 'microsoft yahei'; line-height: 35px"><a style="box-sizing: border-box; color: #0c89cf" name="t2"></a>串行有关联</h3><p style="margin: 0px 0px 1.1em; padding: 0px; box-sizing: border-box; color: #555555; font-family: 'microsoft yahei'; font-size: 14px; line-height: 35px">多个函数或方法执行，每一步执行时都需要上一步执行的结果当参数，所以就会有串行等待。async里有waterfall可以实现此场景：</p><pre class="prettyprint" style="white-space: nowrap; word-wrap: break-word; box-sizing: border-box; position: relative; overflow-y: hidden; overflow-x: auto; margin-top: 0px; margin-bottom: 1.1em; font-family: 'Source Code Pro', monospace; padding: 5px 5px 5px 60px; font-size: 14px; line-height: 1.45; word-break: break-all; color: #333333; border: 1px solid rgba(128, 128, 128, 0.0745098); border-radius: 0px; background-color: rgba(128, 128, 128, 0.0470588)"><span style="box-sizing: border-box; color: #000088" class="hljs-keyword">var</span> async = <span style="box-sizing: border-box; color: #660066" class="hljs-built_in">require</span>(<span style="box-sizing: border-box; color: #008800" class="hljs-string">'async'</span>); console.time(<span style="box-sizing: border-box; color: #008800" class="hljs-string">'waterfall'</span>); async.waterfall([&nbsp;&nbsp;&nbsp;&nbsp; <span style="box-sizing: border-box" class="hljs-function"><span style="box-sizing: border-box; color: #000088" class="hljs-keyword">function</span><span style="box-sizing: border-box; color: #660066" class="hljs-params">(callback)</span> &#123;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; callback(<span style="box-sizing: border-box; color: #006666" class="hljs-literal">null</span>, <span style="box-sizing: border-box; color: #008800" class="hljs-string">'one'</span>);&nbsp;&nbsp;&nbsp;&nbsp; &#125;,&nbsp;&nbsp;&nbsp;&nbsp; <span style="box-sizing: border-box" class="hljs-function"><span style="box-sizing: border-box; color: #000088" class="hljs-keyword">function</span><span style="box-sizing: border-box; color: #660066" class="hljs-params">(onearg, callback)</span> &#123;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; callback(<span style="box-sizing: border-box; color: #006666" class="hljs-literal">null</span>, onearg + <span style="box-sizing: border-box; color: #008800" class="hljs-string">'&gt;&gt;&gt;two'</span>);&nbsp;&nbsp;&nbsp;&nbsp; &#125;,&nbsp;&nbsp;&nbsp;&nbsp; <span style="box-sizing: border-box" class="hljs-function"><span style="box-sizing: border-box; color: #000088" class="hljs-keyword">function</span><span style="box-sizing: border-box; color: #660066" class="hljs-params">(twoarg, callback)</span> &#123;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; callback(<span style="box-sizing: border-box; color: #006666" class="hljs-literal">null</span>, twoarg + <span style="box-sizing: border-box; color: #008800" class="hljs-string">'&gt;&gt;&gt;three'</span>);&nbsp;&nbsp;&nbsp;&nbsp; &#125;,&nbsp;&nbsp;&nbsp;&nbsp; <span style="box-sizing: border-box" class="hljs-function"><span style="box-sizing: border-box; color: #000088" class="hljs-keyword">function</span><span style="box-sizing: border-box; color: #660066" class="hljs-params">(threearg, callback)</span> &#123;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; callback(<span style="box-sizing: border-box; color: #006666" class="hljs-literal">null</span>, threearg + <span style="box-sizing: border-box; color: #008800" class="hljs-string">'&gt;&gt;&gt;four'</span>);&nbsp;&nbsp;&nbsp;&nbsp; &#125; ], <span style="box-sizing: border-box" class="hljs-function"><span style="box-sizing: border-box; color: #000088" class="hljs-keyword">function</span><span style="box-sizing: border-box; color: #660066" class="hljs-params">(error, result)</span> &#123;</span>&nbsp;&nbsp;&nbsp;&nbsp; console.log(<span style="box-sizing: border-box; color: #008800" class="hljs-string">'error: '</span> + error);&nbsp;&nbsp;&nbsp;&nbsp; console.log(<span style="box-sizing: border-box; color: #008800" class="hljs-string">'result: '</span> + result);&nbsp;&nbsp;&nbsp;&nbsp; console.timeEnd(<span style="box-sizing: border-box; color: #008800" class="hljs-string">'waterfall'</span>); &#125;);<ul class="pre-numbering" style="box-sizing: border-box; position: absolute; width: 50px; top: 0px; left: 0px; margin: 0px; padding: 6px 0px 40px; border-right-width: 1px; border-right-style: solid; border-right-color: #dddddd; list-style: none; text-align: right; background-color: #eeeeee"><li style="box-sizing: border-box; padding: 0px 5px">1</li><li style="box-sizing: border-box; padding: 0px 5px">2</li><li style="box-sizing: border-box; padding: 0px 5px">3</li><li style="box-sizing: border-box; padding: 0px 5px">4</li><li style="box-sizing: border-box; padding: 0px 5px">5</li><li style="box-sizing: border-box; padding: 0px 5px">6</li><li style="box-sizing: border-box; padding: 0px 5px">7</li><li style="box-sizing: border-box; padding: 0px 5px">8</li><li style="box-sizing: border-box; padding: 0px 5px">9</li><li style="box-sizing: border-box; padding: 0px 5px">10</li><li style="box-sizing: border-box; padding: 0px 5px">11</li><li style="box-sizing: border-box; padding: 0px 5px">12</li><li style="box-sizing: border-box; padding: 0px 5px">13</li><li style="box-sizing: border-box; padding: 0px 5px">14</li><li style="box-sizing: border-box; padding: 0px 5px">15</li><li style="box-sizing: border-box; padding: 0px 5px">16</li><li style="box-sizing: border-box; padding: 0px 5px">17</li><li style="box-sizing: border-box; padding: 0px 5px">18</li><li style="box-sizing: border-box; padding: 0px 5px">19</li><li style="box-sizing: border-box; padding: 0px 5px">20</li></ul><ul class="pre-numbering" style="box-sizing: border-box; position: absolute; width: 50px; top: 0px; left: 0px; margin: 0px; padding: 6px 0px 40px; border-right-width: 1px; border-right-style: solid; border-right-color: #dddddd; list-style: none; text-align: right; background-color: #eeeeee"><li style="box-sizing: border-box; padding: 0px 5px">1</li><li style="box-sizing: border-box; padding: 0px 5px">2</li><li style="box-sizing: border-box; padding: 0px 5px">3</li><li style="box-sizing: border-box; padding: 0px 5px">4</li><li style="box-sizing: border-box; padding: 0px 5px">5</li><li style="box-sizing: border-box; padding: 0px 5px">6</li><li style="box-sizing: border-box; padding: 0px 5px">7</li><li style="box-sizing: border-box; padding: 0px 5px">8</li><li style="box-sizing: border-box; padding: 0px 5px">9</li><li style="box-sizing: border-box; padding: 0px 5px">10</li><li style="box-sizing: border-box; padding: 0px 5px">11</li><li style="box-sizing: border-box; padding: 0px 5px">12</li><li style="box-sizing: border-box; padding: 0px 5px">13</li><li style="box-sizing: border-box; padding: 0px 5px">14</li><li style="box-sizing: border-box; padding: 0px 5px">15</li><li style="box-sizing: border-box; padding: 0px 5px">16</li><li style="box-sizing: border-box; padding: 0px 5px">17</li><li style="box-sizing: border-box; padding: 0px 5px">18</li><li style="box-sizing: border-box; padding: 0px 5px">19</li><li style="box-sizing: border-box; padding: 0px 5px">20</li></ul></pre><p style="margin: 0px 0px 1.1em; padding: 0px; box-sizing: border-box; color: #555555; font-family: 'microsoft yahei'; font-size: 14px; line-height: 35px">结果</p><pre class="prettyprint" style="white-space: nowrap; word-wrap: break-word; box-sizing: border-box; position: relative; overflow-y: hidden; overflow-x: auto; margin-top: 0px; margin-bottom: 1.1em; font-family: 'Source Code Pro', monospace; padding: 5px 5px 5px 60px; font-size: 14px; line-height: 1.45; word-break: break-all; color: #333333; border: 1px solid rgba(128, 128, 128, 0.0745098); border-radius: 0px; background-color: rgba(128, 128, 128, 0.0470588)">error: null result: one&gt;&gt;&gt;two&gt;&gt;&gt;three&gt;&gt;&gt;four waterfall: <span style="box-sizing: border-box; color: #006666" class="hljs-number">4.516</span>ms<ul class="pre-numbering" style="box-sizing: border-box; position: absolute; width: 50px; top: 0px; left: 0px; margin: 0px; padding: 6px 0px 40px; border-right-width: 1px; border-right-style: solid; border-right-color: #dddddd; list-style: none; text-align: right; background-color: #eeeeee"><li style="box-sizing: border-box; padding: 0px 5px">1</li><li style="box-sizing: border-box; padding: 0px 5px">2</li><li style="box-sizing: border-box; padding: 0px 5px">3</li></ul><ul class="pre-numbering" style="box-sizing: border-box; position: absolute; width: 50px; top: 0px; left: 0px; margin: 0px; padding: 6px 0px 40px; border-right-width: 1px; border-right-style: solid; border-right-color: #dddddd; list-style: none; text-align: right; background-color: #eeeeee"><li style="box-sizing: border-box; padding: 0px 5px">1</li><li style="box-sizing: border-box; padding: 0px 5px">2</li><li style="box-sizing: border-box; padding: 0px 5px">3</li></ul></pre><p style="margin: 0px 0px 1.1em; padding: 0px; box-sizing: border-box; color: #555555; font-family: 'microsoft yahei'; font-size: 14px; line-height: 35px">这个比较series换了个方法名之外，每个函数多了个参数第二个函数中onearg则是第一个函数的值，以此类推，callback中没变，如果有异常，立即终止可自行验证;</p><h3 style="margin: 0.8em 0px; padding: 0px; box-sizing: border-box; font-weight: 100; color: #555555; font-family: 'microsoft yahei'; line-height: 35px"><a style="box-sizing: border-box; color: #0c89cf" name="t3"></a>并行无关联</h3><p style="margin: 0px 0px 1.1em; padding: 0px; box-sizing: border-box; color: #555555; font-family: 'microsoft yahei'; font-size: 14px; line-height: 35px">多个函数执行，之间没有任何的关系，也就是说谁执行都行，为了节约时间就可以使用并行流程来解决，如下：</p><pre class="prettyprint" style="white-space: nowrap; word-wrap: break-word; box-sizing: border-box; position: relative; overflow-y: hidden; overflow-x: auto; margin-top: 0px; margin-bottom: 1.1em; font-family: 'Source Code Pro', monospace; padding: 5px 5px 5px 60px; font-size: 14px; line-height: 1.45; word-break: break-all; color: #333333; border: 1px solid rgba(128, 128, 128, 0.0745098); border-radius: 0px; background-color: rgba(128, 128, 128, 0.0470588)"><span style="box-sizing: border-box; color: #000088" class="hljs-keyword">var</span> async = <span style="box-sizing: border-box; color: #660066" class="hljs-built_in">require</span>(<span style="box-sizing: border-box; color: #008800" class="hljs-string">'async'</span>); console.time(<span style="box-sizing: border-box; color: #008800" class="hljs-string">'parallel'</span>); async.parallel(&#123;&nbsp;&nbsp;&nbsp;&nbsp; one: <span style="box-sizing: border-box" class="hljs-function"><span style="box-sizing: border-box; color: #000088" class="hljs-keyword">function</span><span style="box-sizing: border-box; color: #660066" class="hljs-params">(callback)</span> &#123;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="box-sizing: border-box; color: #880000" class="hljs-comment">//处理逻辑</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; callback(<span style="box-sizing: border-box; color: #006666" class="hljs-literal">null</span>, <span style="box-sizing: border-box; color: #008800" class="hljs-string">'one'</span>);&nbsp;&nbsp;&nbsp;&nbsp; &#125;,&nbsp;&nbsp;&nbsp;&nbsp; two: <span style="box-sizing: border-box" class="hljs-function"><span style="box-sizing: border-box; color: #000088" class="hljs-keyword">function</span><span style="box-sizing: border-box; color: #660066" class="hljs-params">(callback)</span> &#123;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="box-sizing: border-box; color: #880000" class="hljs-comment">//处理逻辑</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; callback(<span style="box-sizing: border-box; color: #006666" class="hljs-literal">null</span>, <span style="box-sizing: border-box; color: #008800" class="hljs-string">'tow'</span>);&nbsp;&nbsp;&nbsp;&nbsp; &#125;,&nbsp;&nbsp;&nbsp;&nbsp; three: <span style="box-sizing: border-box" class="hljs-function"><span style="box-sizing: border-box; color: #000088" class="hljs-keyword">function</span><span style="box-sizing: border-box; color: #660066" class="hljs-params">(callback)</span> &#123;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="box-sizing: border-box; color: #880000" class="hljs-comment">//处理逻辑</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; callback(<span style="box-sizing: border-box; color: #006666" class="hljs-literal">null</span>, <span style="box-sizing: border-box; color: #008800" class="hljs-string">'three'</span>);&nbsp;&nbsp;&nbsp;&nbsp; &#125;,&nbsp;&nbsp;&nbsp;&nbsp; four: <span style="box-sizing: border-box" class="hljs-function"><span style="box-sizing: border-box; color: #000088" class="hljs-keyword">function</span><span style="box-sizing: border-box; color: #660066" class="hljs-params">(callback)</span> &#123;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="box-sizing: border-box; color: #880000" class="hljs-comment">//处理逻辑</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; callback(<span style="box-sizing: border-box; color: #006666" class="hljs-literal">null</span>, <span style="box-sizing: border-box; color: #008800" class="hljs-string">'four'</span>);&nbsp;&nbsp;&nbsp;&nbsp; &#125; &#125;, <span style="box-sizing: border-box" class="hljs-function"><span style="box-sizing: border-box; color: #000088" class="hljs-keyword">function</span><span style="box-sizing: border-box; color: #660066" class="hljs-params">(error, result)</span> &#123;</span>&nbsp;&nbsp;&nbsp;&nbsp; console.log(<span style="box-sizing: border-box; color: #008800" class="hljs-string">'one:'</span>, result.one);&nbsp;&nbsp;&nbsp;&nbsp; console.log(<span style="box-sizing: border-box; color: #008800" class="hljs-string">'two:'</span>, result.two);&nbsp;&nbsp;&nbsp;&nbsp; console.log(<span style="box-sizing: border-box; color: #008800" class="hljs-string">'three:'</span>, result.three);&nbsp;&nbsp;&nbsp;&nbsp; console.log(<span style="box-sizing: border-box; color: #008800" class="hljs-string">'four:'</span>, result.four);&nbsp;&nbsp;&nbsp;&nbsp; console.log(<span style="box-sizing: border-box; color: #008800" class="hljs-string">'error: '</span> + error);&nbsp;&nbsp;&nbsp;&nbsp; console.log(<span style="box-sizing: border-box; color: #008800" class="hljs-string">'result: '</span> + <span style="box-sizing: border-box; color: #660066" class="hljs-built_in">JSON</span>.stringify(result));&nbsp;&nbsp;&nbsp;&nbsp; console.timeEnd(<span style="box-sizing: border-box; color: #008800" class="hljs-string">'parallel'</span>); &#125;);<ul class="pre-numbering" style="box-sizing: border-box; position: absolute; width: 50px; top: 0px; left: 0px; margin: 0px; padding: 6px 0px 40px; border-right-width: 1px; border-right-style: solid; border-right-color: #dddddd; list-style: none; text-align: right; background-color: #eeeeee"><li style="box-sizing: border-box; padding: 0px 5px">1</li><li style="box-sizing: border-box; padding: 0px 5px">2</li><li style="box-sizing: border-box; padding: 0px 5px">3</li><li style="box-sizing: border-box; padding: 0px 5px">4</li><li style="box-sizing: border-box; padding: 0px 5px">5</li><li style="box-sizing: border-box; padding: 0px 5px">6</li><li style="box-sizing: border-box; padding: 0px 5px">7</li><li style="box-sizing: border-box; padding: 0px 5px">8</li><li style="box-sizing: border-box; padding: 0px 5px">9</li><li style="box-sizing: border-box; padding: 0px 5px">10</li><li style="box-sizing: border-box; padding: 0px 5px">11</li><li style="box-sizing: border-box; padding: 0px 5px">12</li><li style="box-sizing: border-box; padding: 0px 5px">13</li><li style="box-sizing: border-box; padding: 0px 5px">14</li><li style="box-sizing: border-box; padding: 0px 5px">15</li><li style="box-sizing: border-box; padding: 0px 5px">16</li><li style="box-sizing: border-box; padding: 0px 5px">17</li><li style="box-sizing: border-box; padding: 0px 5px">18</li><li style="box-sizing: border-box; padding: 0px 5px">19</li><li style="box-sizing: border-box; padding: 0px 5px">20</li><li style="box-sizing: border-box; padding: 0px 5px">21</li><li style="box-sizing: border-box; padding: 0px 5px">22</li><li style="box-sizing: border-box; padding: 0px 5px">23</li><li style="box-sizing: border-box; padding: 0px 5px">24</li><li style="box-sizing: border-box; padding: 0px 5px">25</li><li style="box-sizing: border-box; padding: 0px 5px">26</li><li style="box-sizing: border-box; padding: 0px 5px">27</li><li style="box-sizing: border-box; padding: 0px 5px">28</li></ul><ul class="pre-numbering" style="box-sizing: border-box; position: absolute; width: 50px; top: 0px; left: 0px; margin: 0px; padding: 6px 0px 40px; border-right-width: 1px; border-right-style: solid; border-right-color: #dddddd; list-style: none; text-align: right; background-color: #eeeeee"><li style="box-sizing: border-box; padding: 0px 5px">1</li><li style="box-sizing: border-box; padding: 0px 5px">2</li><li style="box-sizing: border-box; padding: 0px 5px">3</li><li style="box-sizing: border-box; padding: 0px 5px">4</li><li style="box-sizing: border-box; padding: 0px 5px">5</li><li style="box-sizing: border-box; padding: 0px 5px">6</li><li style="box-sizing: border-box; padding: 0px 5px">7</li><li style="box-sizing: border-box; padding: 0px 5px">8</li><li style="box-sizing: border-box; padding: 0px 5px">9</li><li style="box-sizing: border-box; padding: 0px 5px">10</li><li style="box-sizing: border-box; padding: 0px 5px">11</li><li style="box-sizing: border-box; padding: 0px 5px">12</li><li style="box-sizing: border-box; padding: 0px 5px">13</li><li style="box-sizing: border-box; padding: 0px 5px">14</li><li style="box-sizing: border-box; padding: 0px 5px">15</li><li style="box-sizing: border-box; padding: 0px 5px">16</li><li style="box-sizing: border-box; padding: 0px 5px">17</li><li style="box-sizing: border-box; padding: 0px 5px">18</li><li style="box-sizing: border-box; padding: 0px 5px">19</li><li style="box-sizing: border-box; padding: 0px 5px">20</li><li style="box-sizing: border-box; padding: 0px 5px">21</li><li style="box-sizing: border-box; padding: 0px 5px">22</li><li style="box-sizing: border-box; padding: 0px 5px">23</li><li style="box-sizing: border-box; padding: 0px 5px">24</li><li style="box-sizing: border-box; padding: 0px 5px">25</li><li style="box-sizing: border-box; padding: 0px 5px">26</li><li style="box-sizing: border-box; padding: 0px 5px">27</li><li style="box-sizing: border-box; padding: 0px 5px">28</li></ul></pre><p style="margin: 0px 0px 1.1em; padding: 0px; box-sizing: border-box; color: #555555; font-family: 'microsoft yahei'; font-size: 14px; line-height: 35px">结果</p><pre class="prettyprint" style="white-space: nowrap; word-wrap: break-word; box-sizing: border-box; position: relative; overflow-y: hidden; overflow-x: auto; margin-top: 0px; margin-bottom: 1.1em; font-family: 'Source Code Pro', monospace; padding: 5px 5px 5px 60px; font-size: 14px; line-height: 1.45; word-break: break-all; color: #333333; border: 1px solid rgba(128, 128, 128, 0.0745098); border-radius: 0px; background-color: rgba(128, 128, 128, 0.0470588)">one: one two: tow three: three four: four error: null result: &#123;<span style="box-sizing: border-box; color: #008800" class="hljs-string">&quot;one&quot;</span>:<span style="box-sizing: border-box; color: #008800" class="hljs-string">&quot;one&quot;</span>,<span style="box-sizing: border-box; color: #008800" class="hljs-string">&quot;two&quot;</span>:<span style="box-sizing: border-box; color: #008800" class="hljs-string">&quot;tow&quot;</span>,<span style="box-sizing: border-box; color: #008800" class="hljs-string">&quot;three&quot;</span>:<span style="box-sizing: border-box; color: #008800" class="hljs-string">&quot;three&quot;</span>,<span style="box-sizing: border-box; color: #008800" class="hljs-string">&quot;four&quot;</span>:<span style="box-sizing: border-box; color: #008800" class="hljs-string">&quot;four&quot;</span>&#125; parallel: <span style="box-sizing: border-box; color: #006666" class="hljs-number">4.237</span>ms<ul class="pre-numbering" style="box-sizing: border-box; position: absolute; width: 50px; top: 0px; left: 0px; margin: 0px; padding: 6px 0px 40px; border-right-width: 1px; border-right-style: solid; border-right-color: #dddddd; list-style: none; text-align: right; background-color: #eeeeee"><li style="box-sizing: border-box; padding: 0px 5px">1</li><li style="box-sizing: border-box; padding: 0px 5px">2</li><li style="box-sizing: border-box; padding: 0px 5px">3</li><li style="box-sizing: border-box; padding: 0px 5px">4</li><li style="box-sizing: border-box; padding: 0px 5px">5</li><li style="box-sizing: border-box; padding: 0px 5px">6</li><li style="box-sizing: border-box; padding: 0px 5px">7</li></ul><ul class="pre-numbering" style="box-sizing: border-box; position: absolute; width: 50px; top: 0px; left: 0px; margin: 0px; padding: 6px 0px 40px; border-right-width: 1px; border-right-style: solid; border-right-color: #dddddd; list-style: none; text-align: right; background-color: #eeeeee"><li style="box-sizing: border-box; padding: 0px 5px">1</li><li style="box-sizing: border-box; padding: 0px 5px">2</li><li style="box-sizing: border-box; padding: 0px 5px">3</li><li style="box-sizing: border-box; padding: 0px 5px">4</li><li style="box-sizing: border-box; padding: 0px 5px">5</li><li style="box-sizing: border-box; padding: 0px 5px">6</li><li style="box-sizing: border-box; padding: 0px 5px">7</li></ul></pre><p style="margin: 0px 0px 1.1em; padding: 0px; box-sizing: border-box; color: #555555; font-family: 'microsoft yahei'; font-size: 14px; line-height: 35px">并行无关联和串行无关联唯一的差异就是名称不同，但也都是见名知意，主要看执行的时间！！！</p><h3 style="margin: 0.8em 0px; padding: 0px; box-sizing: border-box; font-weight: 100; color: #555555; font-family: 'microsoft yahei'; line-height: 35px"><a style="box-sizing: border-box; color: #0c89cf" name="t4"></a>智能控制</h3><p style="margin: 0px 0px 1.1em; padding: 0px; box-sizing: border-box; color: #555555; font-family: 'microsoft yahei'; font-size: 14px; line-height: 35px">以上都是纯串行传并行，但是当一个场景里，需要使用串行也需要使用并行的时候，虽然分别写能解决，但是效率不是很高，维护性也不是很好，auto可以解决这一问题。如下场景，<a style="text-decoration: none; box-sizing: border-box; color: #0c89cf" href="javascript:if(confirm('https://github.com/bsspirit/async_demo/blob/master/auto.js  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='https://github.com/bsspirit/async_demo/blob/master/auto.js'" tppabs="https://github.com/bsspirit/async_demo/blob/master/auto.js">参见github示例</a>&nbsp;<br />需求如下：</p><ul style="box-sizing: border-box; color: #555555; font-family: 'microsoft yahei'; font-size: 14px; line-height: 35px"><li style="box-sizing: border-box"><ol style="box-sizing: border-box"><li style="box-sizing: border-box">从某处取得数据</li></ol></li><li style="box-sizing: border-box"><ol style="box-sizing: border-box"><li style="box-sizing: border-box">在硬盘上建立一个新的目录</li></ol></li><li style="box-sizing: border-box"><ol style="box-sizing: border-box"><li style="box-sizing: border-box">将数据写入到目录下某文件</li></ol></li><li style="box-sizing: border-box"><ol style="box-sizing: border-box"><li style="box-sizing: border-box">发送邮件，将文件以附件形式发送给其它人。</li></ol></li></ul><p style="margin: 0px 0px 1.1em; padding: 0px; box-sizing: border-box; color: #555555; font-family: 'microsoft yahei'; font-size: 14px; line-height: 35px">可以知道1与2可以并行执行，3需要等1和2完成，4要等3完成。&nbsp;<br />使用auto来解决</p><pre class="prettyprint" style="white-space: nowrap; word-wrap: break-word; box-sizing: border-box; position: relative; overflow-y: hidden; overflow-x: auto; margin-top: 0px; margin-bottom: 1.1em; font-family: 'Source Code Pro', monospace; padding: 5px 5px 5px 60px; font-size: 14px; line-height: 1.45; word-break: break-all; color: #333333; border: 1px solid rgba(128, 128, 128, 0.0745098); border-radius: 0px; background-color: rgba(128, 128, 128, 0.0470588)"><span style="box-sizing: border-box; color: #000088" class="hljs-keyword">var</span> async = <span style="box-sizing: border-box; color: #660066" class="hljs-built_in">require</span>(<span style="box-sizing: border-box; color: #008800" class="hljs-string">'async'</span>); console.time(<span style="box-sizing: border-box; color: #008800" class="hljs-string">'auto'</span>); async.auto(&#123;&nbsp;&nbsp;&nbsp;&nbsp; getData: <span style="box-sizing: border-box" class="hljs-function"><span style="box-sizing: border-box; color: #000088" class="hljs-keyword">function</span><span style="box-sizing: border-box; color: #660066" class="hljs-params">(callback)</span> &#123;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; setTimeout(<span style="box-sizing: border-box" class="hljs-function"><span style="box-sizing: border-box; color: #000088" class="hljs-keyword">function</span><span style="box-sizing: border-box; color: #660066" class="hljs-params">()</span> &#123;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; console.log(<span style="box-sizing: border-box; color: #008800" class="hljs-string">'1.1: got data'</span>);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; callback(<span style="box-sizing: border-box; color: #006666" class="hljs-literal">null</span>, <span style="box-sizing: border-box; color: #008800" class="hljs-string">'mydata'</span>);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125;, <span style="box-sizing: border-box; color: #006666" class="hljs-number">300</span>);&nbsp;&nbsp;&nbsp;&nbsp; &#125;,&nbsp;&nbsp;&nbsp;&nbsp; makeFolder: <span style="box-sizing: border-box" class="hljs-function"><span style="box-sizing: border-box; color: #000088" class="hljs-keyword">function</span><span style="box-sizing: border-box; color: #660066" class="hljs-params">(callback)</span> &#123;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; setTimeout(<span style="box-sizing: border-box" class="hljs-function"><span style="box-sizing: border-box; color: #000088" class="hljs-keyword">function</span><span style="box-sizing: border-box; color: #660066" class="hljs-params">()</span> &#123;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; console.log(<span style="box-sizing: border-box; color: #008800" class="hljs-string">'1.1: made folder'</span>);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; callback(<span style="box-sizing: border-box; color: #006666" class="hljs-literal">null</span>, <span style="box-sizing: border-box; color: #008800" class="hljs-string">'myfolder'</span>);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125;, <span style="box-sizing: border-box; color: #006666" class="hljs-number">200</span>);&nbsp;&nbsp;&nbsp;&nbsp; &#125;,&nbsp;&nbsp;&nbsp;&nbsp; writeFile: [<span style="box-sizing: border-box; color: #008800" class="hljs-string">'getData'</span>, <span style="box-sizing: border-box; color: #008800" class="hljs-string">'makeFolder'</span>, <span style="box-sizing: border-box" class="hljs-function"><span style="box-sizing: border-box; color: #000088" class="hljs-keyword">function</span><span style="box-sizing: border-box; color: #660066" class="hljs-params">(callback)</span> &#123;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; setTimeout(<span style="box-sizing: border-box" class="hljs-function"><span style="box-sizing: border-box; color: #000088" class="hljs-keyword">function</span><span style="box-sizing: border-box; color: #660066" class="hljs-params">()</span> &#123;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; console.log(<span style="box-sizing: border-box; color: #008800" class="hljs-string">'1.1: wrote file'</span>);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; callback(<span style="box-sizing: border-box; color: #006666" class="hljs-literal">null</span>, <span style="box-sizing: border-box; color: #008800" class="hljs-string">'myfile'</span>);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125;, <span style="box-sizing: border-box; color: #006666" class="hljs-number">300</span>);&nbsp;&nbsp;&nbsp;&nbsp; &#125;],&nbsp;&nbsp;&nbsp;&nbsp; emailFiles: [<span style="box-sizing: border-box; color: #008800" class="hljs-string">'writeFile'</span>, <span style="box-sizing: border-box" class="hljs-function"><span style="box-sizing: border-box; color: #000088" class="hljs-keyword">function</span><span style="box-sizing: border-box; color: #660066" class="hljs-params">(callback, results)</span> &#123;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; console.log(<span style="box-sizing: border-box; color: #008800" class="hljs-string">'emailed file: '</span>, results.writeFile);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; callback(<span style="box-sizing: border-box; color: #006666" class="hljs-literal">null</span>, results.writeFile);&nbsp;&nbsp;&nbsp;&nbsp; &#125;] &#125;, <span style="box-sizing: border-box" class="hljs-function"><span style="box-sizing: border-box; color: #000088" class="hljs-keyword">function</span><span style="box-sizing: border-box; color: #660066" class="hljs-params">(err, results)</span> &#123;</span>&nbsp;&nbsp;&nbsp;&nbsp; console.log(<span style="box-sizing: border-box; color: #008800" class="hljs-string">'err: '</span>, err);&nbsp;&nbsp;&nbsp;&nbsp; console.log(<span style="box-sizing: border-box; color: #008800" class="hljs-string">'results: '</span>, results);&nbsp;&nbsp;&nbsp;&nbsp; console.timeEnd(<span style="box-sizing: border-box; color: #008800" class="hljs-string">'auto'</span>); &#125;);<ul class="pre-numbering" style="box-sizing: border-box; position: absolute; width: 50px; top: 0px; left: 0px; margin: 0px; padding: 6px 0px 40px; border-right-width: 1px; border-right-style: solid; border-right-color: #dddddd; list-style: none; text-align: right; background-color: #eeeeee"><li style="box-sizing: border-box; padding: 0px 5px">1</li><li style="box-sizing: border-box; padding: 0px 5px">2</li><li style="box-sizing: border-box; padding: 0px 5px">3</li><li style="box-sizing: border-box; padding: 0px 5px">4</li><li style="box-sizing: border-box; padding: 0px 5px">5</li><li style="box-sizing: border-box; padding: 0px 5px">6</li><li style="box-sizing: border-box; padding: 0px 5px">7</li><li style="box-sizing: border-box; padding: 0px 5px">8</li><li style="box-sizing: border-box; padding: 0px 5px">9</li><li style="box-sizing: border-box; padding: 0px 5px">10</li><li style="box-sizing: border-box; padding: 0px 5px">11</li><li style="box-sizing: border-box; padding: 0px 5px">12</li><li style="box-sizing: border-box; padding: 0px 5px">13</li><li style="box-sizing: border-box; padding: 0px 5px">14</li><li style="box-sizing: border-box; padding: 0px 5px">15</li><li style="box-sizing: border-box; padding: 0px 5px">16</li><li style="box-sizing: border-box; padding: 0px 5px">17</li><li style="box-sizing: border-box; padding: 0px 5px">18</li><li style="box-sizing: border-box; padding: 0px 5px">19</li><li style="box-sizing: border-box; padding: 0px 5px">20</li><li style="box-sizing: border-box; padding: 0px 5px">21</li><li style="box-sizing: border-box; padding: 0px 5px">22</li><li style="box-sizing: border-box; padding: 0px 5px">23</li><li style="box-sizing: border-box; padding: 0px 5px">24</li><li style="box-sizing: border-box; padding: 0px 5px">25</li><li style="box-sizing: border-box; padding: 0px 5px">26</li><li style="box-sizing: border-box; padding: 0px 5px">27</li><li style="box-sizing: border-box; padding: 0px 5px">28</li><li style="box-sizing: border-box; padding: 0px 5px">29</li><li style="box-sizing: border-box; padding: 0px 5px">30</li></ul><ul class="pre-numbering" style="box-sizing: border-box; position: absolute; width: 50px; top: 0px; left: 0px; margin: 0px; padding: 6px 0px 40px; border-right-width: 1px; border-right-style: solid; border-right-color: #dddddd; list-style: none; text-align: right; background-color: #eeeeee"><li style="box-sizing: border-box; padding: 0px 5px">1</li><li style="box-sizing: border-box; padding: 0px 5px">2</li><li style="box-sizing: border-box; padding: 0px 5px">3</li><li style="box-sizing: border-box; padding: 0px 5px">4</li><li style="box-sizing: border-box; padding: 0px 5px">5</li><li style="box-sizing: border-box; padding: 0px 5px">6</li><li style="box-sizing: border-box; padding: 0px 5px">7</li><li style="box-sizing: border-box; padding: 0px 5px">8</li><li style="box-sizing: border-box; padding: 0px 5px">9</li><li style="box-sizing: border-box; padding: 0px 5px">10</li><li style="box-sizing: border-box; padding: 0px 5px">11</li><li style="box-sizing: border-box; padding: 0px 5px">12</li><li style="box-sizing: border-box; padding: 0px 5px">13</li><li style="box-sizing: border-box; padding: 0px 5px">14</li><li style="box-sizing: border-box; padding: 0px 5px">15</li><li style="box-sizing: border-box; padding: 0px 5px">16</li><li style="box-sizing: border-box; padding: 0px 5px">17</li><li style="box-sizing: border-box; padding: 0px 5px">18</li><li style="box-sizing: border-box; padding: 0px 5px">19</li><li style="box-sizing: border-box; padding: 0px 5px">20</li><li style="box-sizing: border-box; padding: 0px 5px">21</li><li style="box-sizing: border-box; padding: 0px 5px">22</li><li style="box-sizing: border-box; padding: 0px 5px">23</li><li style="box-sizing: border-box; padding: 0px 5px">24</li><li style="box-sizing: border-box; padding: 0px 5px">25</li><li style="box-sizing: border-box; padding: 0px 5px">26</li><li style="box-sizing: border-box; padding: 0px 5px">27</li><li style="box-sizing: border-box; padding: 0px 5px">28</li><li style="box-sizing: border-box; padding: 0px 5px">29</li><li style="box-sizing: border-box; padding: 0px 5px">30</li></ul></pre><p style="margin: 0px 0px 1.1em; padding: 0px; box-sizing: border-box; color: #555555; font-family: 'microsoft yahei'; font-size: 14px; line-height: 35px">结果</p><pre class="prettyprint" style="white-space: nowrap; word-wrap: break-word; box-sizing: border-box; position: relative; overflow-y: hidden; overflow-x: auto; margin-top: 0px; margin-bottom: 1.1em; font-family: 'Source Code Pro', monospace; padding: 5px 5px 5px 60px; font-size: 14px; line-height: 1.45; word-break: break-all; color: #333333; border: 1px solid rgba(128, 128, 128, 0.0745098); border-radius: 0px; background-color: rgba(128, 128, 128, 0.0470588)"><span style="box-sizing: border-box; color: #006666" class="hljs-number">1.1</span>: made folder <span style="box-sizing: border-box; color: #006666" class="hljs-number">1.1</span>: got data <span style="box-sizing: border-box; color: #006666" class="hljs-number">1.1</span>: wrote file emailed file:&nbsp;&nbsp;myfile err:&nbsp;&nbsp;null results:&nbsp;&nbsp;&#123; makeFolder: <span style="box-sizing: border-box; color: #008800" class="hljs-string">'myfolder'</span>,&nbsp;&nbsp; getData: <span style="box-sizing: border-box; color: #008800" class="hljs-string">'mydata'</span>,&nbsp;&nbsp; writeFile: <span style="box-sizing: border-box; color: #008800" class="hljs-string">'myfile'</span>,&nbsp;&nbsp; emailFiles: <span style="box-sizing: border-box; color: #008800" class="hljs-string">'myfile'</span> &#125; auto: <span style="box-sizing: border-box; color: #006666" class="hljs-number">650.972</span>ms<ul class="pre-numbering" style="box-sizing: border-box; position: absolute; width: 50px; top: 0px; left: 0px; margin: 0px; padding: 6px 0px 40px; border-right-width: 1px; border-right-style: solid; border-right-color: #dddddd; list-style: none; text-align: right; background-color: #eeeeee"><li style="box-sizing: border-box; padding: 0px 5px">1</li><li style="box-sizing: border-box; padding: 0px 5px">2</li><li style="box-sizing: border-box; padding: 0px 5px">3</li><li style="box-sizing: border-box; padding: 0px 5px">4</li><li style="box-sizing: border-box; padding: 0px 5px">5</li><li style="box-sizing: border-box; padding: 0px 5px">6</li><li style="box-sizing: border-box; padding: 0px 5px">7</li><li style="box-sizing: border-box; padding: 0px 5px">8</li><li style="box-sizing: border-box; padding: 0px 5px">9</li><li style="box-sizing: border-box; padding: 0px 5px">10</li></ul><ul class="pre-numbering" style="box-sizing: border-box; position: absolute; width: 50px; top: 0px; left: 0px; margin: 0px; padding: 6px 0px 40px; border-right-width: 1px; border-right-style: solid; border-right-color: #dddddd; list-style: none; text-align: right; background-color: #eeeeee"><li style="box-sizing: border-box; padding: 0px 5px">1</li><li style="box-sizing: border-box; padding: 0px 5px">2</li><li style="box-sizing: border-box; padding: 0px 5px">3</li><li style="box-sizing: border-box; padding: 0px 5px">4</li><li style="box-sizing: border-box; padding: 0px 5px">5</li><li style="box-sizing: border-box; padding: 0px 5px">6</li><li style="box-sizing: border-box; padding: 0px 5px">7</li><li style="box-sizing: border-box; padding: 0px 5px">8</li><li style="box-sizing: border-box; padding: 0px 5px">9</li><li style="box-sizing: border-box; padding: 0px 5px">10</li></ul></pre><p style="margin: 0px 0px 1.1em; padding: 0px; box-sizing: border-box; color: #555555; font-family: 'microsoft yahei'; font-size: 14px; line-height: 35px">通过这样的写法，就可以实现串行并行组合写法，这些方法需要多多练习才能熟练使用。。。</p>
	</div>
	<div class="textbox-bottom">
	</div>
	<div class="tags" style="display: none"> 
	</div>
</div>
					<div class="article-bottom" style="display: block">
						<div class="pages">
							<span class="pagebar-mainbody"> 分页： 8/713  <a href="index.php-mode=1&page=1.htm" tppabs="http://i.renjihe.com/blog/index.php?mode=1&page=1"><img src="doubleleft.gif" tppabs="http://i.renjihe.com/blog/template/default/images/arrows/doubleleft.gif" alt="第一页" title="第一页" border="0"/></a>  <a href="index.php-mode=1&page=7.htm" tppabs="http://i.renjihe.com/blog/index.php?mode=1&page=7"><img src="singleleft.gif" tppabs="http://i.renjihe.com/blog/template/default/images/arrows/singleleft.gif" alt="上页" title="上页" border="0"/></a> <span class="pagebar-selections"> <a href="index.php-mode=1&page=3.htm" tppabs="http://i.renjihe.com/blog/index.php?mode=1&page=3">3</a>  <a href="index.php-mode=1&page=4.htm" tppabs="http://i.renjihe.com/blog/index.php?mode=1&page=4">4</a>  <a href="index.php-mode=1&page=5.htm" tppabs="http://i.renjihe.com/blog/index.php?mode=1&page=5">5</a>  <a href="index.php-mode=1&page=6.htm" tppabs="http://i.renjihe.com/blog/index.php?mode=1&page=6">6</a>  <a href="index.php-mode=1&page=7.htm" tppabs="http://i.renjihe.com/blog/index.php?mode=1&page=7">7</a>  <span class="pagelink-current">8</span>  <a href="index.php-mode=1&page=9.htm" tppabs="http://i.renjihe.com/blog/index.php?mode=1&page=9">9</a>  <a href="index.php-mode=1&page=10.htm" tppabs="http://i.renjihe.com/blog/index.php?mode=1&page=10">10</a>  <a href="read.php-6791.htm" tppabs="http://i.renjihe.com/blog/index.php?mode=1&page=11">11</a>  <a href="read.php-6785.htm" tppabs="http://i.renjihe.com/blog/index.php?mode=1&page=12">12</a> </span> <a href="index.php-mode=1&page=9.htm" tppabs="http://i.renjihe.com/blog/index.php?mode=1&page=9"><img src="singleright.gif" tppabs="http://i.renjihe.com/blog/template/default/images/arrows/singleright.gif" alt="下页" title="下页" border="0"/></a>  <a href="index.php-mode=1&page=713.htm" tppabs="http://i.renjihe.com/blog/index.php?mode=1&page=713"><img src="doubleright.gif" tppabs="http://i.renjihe.com/blog/template/default/images/arrows/doubleright.gif" alt="最后页" title="最后页" border="0"/></a> </span> [ 显示模式： <a href="index.php-mode=1&page=1.htm" tppabs="http://i.renjihe.com/blog/index.php?mode=1&page=1" title="切换到摘要模式">摘要</a> | <a href="index.php-mode=2&page=1.htm" tppabs="http://i.renjihe.com/blog/index.php?mode=2&page=1" title="切换到列表模式">列表</a> ]
						</div>
					</div>
				</div>
			</div>
		<div id="sidebar" class="sidebar">
			<div id="innerSidebar">
				<div id="innerSidebarSearch">
					<form method="post" action="http://i.renjihe.com/blog/visit.php">
	<input name="job" type="hidden" value="search"/>
	<input name="keyword" class="search-field" type="text"/>
	<select name="searchmethod"><option value="1">日志标题</option><option value="2">日志全文</option><option value="3">评论引用</option><option value="4">所有留言</option></select>
	<input value="搜索" class="button" type="submit"/>
	</form>
				</div>
				<div id="innerSidebarOne">
					<div id='panelCategory' class="panel">
<h5 style="cursor: pointer" onclick='showhidediv("sideblock_category");'>分类</h5>
<div class="panel-content" id="sideblock_category" style="display: block">
<ul><li><a href="index.php-go=category_1.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_1" title="硬件">硬件</a> [1] <a href="feed.php-go=category_1" tppabs="http://i.renjihe.com/blog/feed.php?go=category_1"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_6.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_6" title="fpga/cpld">fpga/cpld</a> [10] <a href="feed.php-go=category_6" tppabs="http://i.renjihe.com/blog/feed.php?go=category_6"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_66.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_66" title="模电与电路">模电与电路</a> [1] <a href="feed.php-go=category_66" tppabs="http://i.renjihe.com/blog/feed.php?go=category_66"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_7.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_7" title="DSP">DSP</a> [14] <a href="feed.php-go=category_7" tppabs="http://i.renjihe.com/blog/feed.php?go=category_7"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_27.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_27" title="硬件知识">硬件知识</a> [26] <a href="feed.php-go=category_27" tppabs="http://i.renjihe.com/blog/feed.php?go=category_27"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_73.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_73" title="3D打印">3D打印</a> [1] <a href="feed.php-go=category_73" tppabs="http://i.renjihe.com/blog/feed.php?go=category_73"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_64.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_64" title="资讯">资讯</a> [18] <a href="feed.php-go=category_64" tppabs="http://i.renjihe.com/blog/feed.php?go=category_64"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_78.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_78" title="树莓派">树莓派</a> [5] <a href="feed.php-go=category_78" tppabs="http://i.renjihe.com/blog/feed.php?go=category_78"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_2.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_2" title="软件">软件</a> [0] <a href="feed.php-go=category_2.htm" tppabs="http://i.renjihe.com/blog/feed.php?go=category_2"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_9.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_9" title="linux">linux</a> [912] <a href="feed.php-go=category_9" tppabs="http://i.renjihe.com/blog/feed.php?go=category_9"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_14.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_14" title="QT">QT</a> [131] <a href="feed.php-go=category_14" tppabs="http://i.renjihe.com/blog/feed.php?go=category_14"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_82.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_82" title="Lua">Lua</a> [15] <a href="feed.php-go=category_82" tppabs="http://i.renjihe.com/blog/feed.php?go=category_82"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_15.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_15" title="Android">Android</a> [261] <a href="feed.php-go=category_15" tppabs="http://i.renjihe.com/blog/feed.php?go=category_15"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_65.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_65" title="Iphone">Iphone</a> [48] <a href="feed.php-go=category_65" tppabs="http://i.renjihe.com/blog/feed.php?go=category_65"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_32.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_32" title="windows">windows</a> [61] <a href="feed.php-go=category_32" tppabs="http://i.renjihe.com/blog/feed.php?go=category_32"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_31.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_31" title="webkit">webkit</a> [79] <a href="feed.php-go=category_31" tppabs="http://i.renjihe.com/blog/feed.php?go=category_31"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_10.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_10" title="C/C++">C/C++</a> [98] <a href="feed.php-go=category_10" tppabs="http://i.renjihe.com/blog/feed.php?go=category_10"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_29.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_29" title="lisp、Erlang">Erlang、Lisp</a> [28] <a href="feed.php-go=category_29" tppabs="http://i.renjihe.com/blog/feed.php?go=category_29"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_46.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_46" title="Python">Python</a> [255] <a href="feed.php-go=category_46" tppabs="http://i.renjihe.com/blog/feed.php?go=category_46"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_18.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_18" title="Java">Java</a> [25] <a href="feed.php-go=category_18" tppabs="http://i.renjihe.com/blog/feed.php?go=category_18"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_13.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_13" title="web">web</a> [486] <a href="feed.php-go=category_13" tppabs="http://i.renjihe.com/blog/feed.php?go=category_13"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_50.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_50" title="测试">测试</a> [12] <a href="feed.php-go=category_50" tppabs="http://i.renjihe.com/blog/feed.php?go=category_50"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_23.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_23" title="源码分析">源码分析</a> [85] <a href="feed.php-go=category_23" tppabs="http://i.renjihe.com/blog/feed.php?go=category_23"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_19.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_19" title="编译原理">编译原理</a> [82] <a href="feed.php-go=category_19" tppabs="http://i.renjihe.com/blog/feed.php?go=category_19"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_83.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_83" title="黑客">黑客</a> [4] <a href="feed.php-go=category_83" tppabs="http://i.renjihe.com/blog/feed.php?go=category_83"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_39.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_39" title="GPU编程">GPU编程</a> [89] <a href="feed.php-go=category_39" tppabs="http://i.renjihe.com/blog/feed.php?go=category_39"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_48.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_48" title="OpenGL">OpenGL</a> [117] <a href="feed.php-go=category_48" tppabs="http://i.renjihe.com/blog/feed.php?go=category_48"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_52.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_52" title="OpenCV">OpenCV</a> [18] <a href="feed.php-go=category_52" tppabs="http://i.renjihe.com/blog/feed.php?go=category_52"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_20.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_20" title="音视频与流媒体">音视频与流媒体</a> [412] <a href="feed.php-go=category_20" tppabs="http://i.renjihe.com/blog/feed.php?go=category_20"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_62.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_62" title="游戏">游戏</a> [455] <a href="feed.php-go=category_62" tppabs="http://i.renjihe.com/blog/feed.php?go=category_62"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_54.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_54" title="FLEX&AS">FLEX&amp;AS</a> [124] <a href="feed.php-go=category_54" tppabs="http://i.renjihe.com/blog/feed.php?go=category_54"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_61.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_61" title="编程杂项">编程杂项</a> [55] <a href="feed.php-go=category_61" tppabs="http://i.renjihe.com/blog/feed.php?go=category_61"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_57.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_57" title="网络安全">网络安全</a> [43] <a href="feed.php-go=category_57" tppabs="http://i.renjihe.com/blog/feed.php?go=category_57"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_28.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_28" title="软件工程">软件工程</a> [40] <a href="feed.php-go=category_28" tppabs="http://i.renjihe.com/blog/feed.php?go=category_28"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_74.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_74" title="并行编程">并行编程</a> [4] <a href="feed.php-go=category_74" tppabs="http://i.renjihe.com/blog/feed.php?go=category_74"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_77.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_77" title="大数据">大数据</a> [10] <a href="feed.php-go=category_77" tppabs="http://i.renjihe.com/blog/feed.php?go=category_77"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_37.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_37" title="理论">理论</a> [0] <a href="feed.php-go=category_37.htm" tppabs="http://i.renjihe.com/blog/feed.php?go=category_37"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_38.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_38" title="数学">数学</a> [75] <a href="feed.php-go=category_38" tppabs="http://i.renjihe.com/blog/feed.php?go=category_38"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_43.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_43" title="物理">物理</a> [19] <a href="feed.php-go=category_43" tppabs="http://i.renjihe.com/blog/feed.php?go=category_43"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_24.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_24" title="算法">算法</a> [80] <a href="feed.php-go=category_24" tppabs="http://i.renjihe.com/blog/feed.php?go=category_24"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_40.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_40" title="音频处理">音频处理</a> [3] <a href="feed.php-go=category_40" tppabs="http://i.renjihe.com/blog/feed.php?go=category_40"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_36.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_36" title="CV&Graphic">CV&amp;Graphic</a> [183] <a href="feed.php-go=category_36" tppabs="http://i.renjihe.com/blog/feed.php?go=category_36"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_35.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_35" title="AR&AI&模式识别">AR&amp;AI&amp;模式识别</a> [127] <a href="feed.php-go=category_35" tppabs="http://i.renjihe.com/blog/feed.php?go=category_35"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_26.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_26" title="工具">工具</a> [56] <a href="feed.php-go=category_26" tppabs="http://i.renjihe.com/blog/feed.php?go=category_26"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_3.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_3" title="新鲜玩意">新鲜玩意</a> [446] <a href="feed.php-go=category_3" tppabs="http://i.renjihe.com/blog/feed.php?go=category_3"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_63.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_63" title="行业应用">行业应用</a> [6] <a href="feed.php-go=category_63" tppabs="http://i.renjihe.com/blog/feed.php?go=category_63"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_4.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_4" title="资讯">资讯</a> [137] <a href="feed.php-go=category_4" tppabs="http://i.renjihe.com/blog/feed.php?go=category_4"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_12.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_12" title="网文">网文</a> [622] <a href="feed.php-go=category_12" tppabs="http://i.renjihe.com/blog/feed.php?go=category_12"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_41.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_41" title="点子正传">点子正传</a> [20] <a href="feed.php-go=category_41" tppabs="http://i.renjihe.com/blog/feed.php?go=category_41"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_56.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_56" title="理财">理财</a> [24] <a href="feed.php-go=category_56" tppabs="http://i.renjihe.com/blog/feed.php?go=category_56"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_55.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_55" title="收集">收集</a> [157] <a href="feed.php-go=category_55" tppabs="http://i.renjihe.com/blog/feed.php?go=category_55"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_71.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_71" title="创业">创业</a> [405] <a href="feed.php-go=category_71" tppabs="http://i.renjihe.com/blog/feed.php?go=category_71"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_80.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_80" title="共享软件">共享软件</a> [12] <a href="feed.php-go=category_80" tppabs="http://i.renjihe.com/blog/feed.php?go=category_80"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_72.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_72" title="创意">创意</a> [20] <a href="feed.php-go=category_72" tppabs="http://i.renjihe.com/blog/feed.php?go=category_72"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_85.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_85" title="星象命理">星象命理</a> [40] <a href="feed.php-go=category_85" tppabs="http://i.renjihe.com/blog/feed.php?go=category_85"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_11.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_11" title="杂项">杂项</a> [50] <a href="feed.php-go=category_11" tppabs="http://i.renjihe.com/blog/feed.php?go=category_11"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_58.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_58" title="记录">记录</a> [26] <a href="feed.php-go=category_58" tppabs="http://i.renjihe.com/blog/feed.php?go=category_58"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_79.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_79" title="心灵鸡汤">心灵鸡汤</a> [78] <a href="feed.php-go=category_79" tppabs="http://i.renjihe.com/blog/feed.php?go=category_79"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_75.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_75" title="文学">文学</a> [9] <a href="feed.php-go=category_75" tppabs="http://i.renjihe.com/blog/feed.php?go=category_75"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_67.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_67" title="其它工程资料">其它工程资料</a> [2] <a href="feed.php-go=category_67" tppabs="http://i.renjihe.com/blog/feed.php?go=category_67"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_84.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_84" title="哲学">哲学</a> [24] <a href="feed.php-go=category_84" tppabs="http://i.renjihe.com/blog/feed.php?go=category_84"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_87.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_87" title="有言">有言</a> [9] <a href="feed.php-go=category_87" tppabs="http://i.renjihe.com/blog/feed.php?go=category_87"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_88.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_88" title="微语录">微语录</a> [15] <a href="feed.php-go=category_88" tppabs="http://i.renjihe.com/blog/feed.php?go=category_88"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_76.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_76" title="置顶">置顶</a> [440] <a href="feed.php-go=category_76" tppabs="http://i.renjihe.com/blog/feed.php?go=category_76"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_86.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_86" title="励志">励志</a> [10] <a href="feed.php-go=category_86" tppabs="http://i.renjihe.com/blog/feed.php?go=category_86"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_81.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_81" title="资源管理">资源管理</a> [1] <a href="feed.php-go=category_81" tppabs="http://i.renjihe.com/blog/feed.php?go=category_81"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li></ul>
</div>
</div><div class="panel">
<h5 onclick='showhidediv("sidebar_calendar");'>日历</h5>
<div class="panel-content" id="sidebar_calendar" style="display: block">
<table id="calendar" cellspacing="1" width="100%">
<tbody><tr><td colspan="7" class="calendar-top">
<a href="index.php-go=archive&cm=9&cy=2015.htm" tppabs="http://i.renjihe.com/blog/index.php?go=archive&cm=9&cy=2015" rel="noindex,nofollow">&lt;</a>
<a href="archive.php.htm" tppabs="http://i.renjihe.com/blog/archive.php" rel="noindex,nofollow"><span class="calendar-year">2016</span></a>
<a href="index.php-go=archive&cm=9&cy=2017.htm" tppabs="http://i.renjihe.com/blog/index.php?go=archive&cm=9&cy=2017" rel="noindex,nofollow">&gt;</a>
	&nbsp;&nbsp;
<a href="index.php-go=archive&cm=8&cy=2016.htm" tppabs="http://i.renjihe.com/blog/index.php?go=archive&cm=8&cy=2016" rel="noindex,nofollow">&lt;</a>
<a href="index.php-go=archive&cm=9&cy=2016.htm" tppabs="http://i.renjihe.com/blog/index.php?go=archive&cm=9&cy=2016" rel="noindex,nofollow"><span class="calendar-month">9</span></a>
<a href="index.php-go=archive&cm=10&cy=2016.htm" tppabs="http://i.renjihe.com/blog/index.php?go=archive&cm=10&cy=2016" rel="noindex,nofollow">&gt;</a>
</td></tr>
<tr class="calendar-weekdays">
	<td class="calendar-weekday-cell">日</td>
	<td class="calendar-weekday-cell">一</td>
	<td class="calendar-weekday-cell">二</td>
	<td class="calendar-weekday-cell">三</td>
	<td class="calendar-weekday-cell">四</td>
	<td class="calendar-weekday-cell">五</td>
	<td class="calendar-weekday-cell">六</td>
</tr>
<tr class="calendar-weekdays"><td class="calendar-sunday"></td><td class="calendar-day"></td><td class="calendar-day"></td><td class="calendar-day"></td><td id="cal1" class="calendar-day"><a href="index.php-go=showday_2016-9-1.htm" tppabs="http://i.renjihe.com/blog/index.php?go=showday_2016-9-1" rel="noindex,nofollow">1</a></td><td id="cal2" class="calendar-day">2</td><td id="cal3" class="calendar-today">3</td></tr><tr class="calendar-weekdays"><td id="cal4" class="calendar-sunday">4</td><td id="cal5" class="calendar-day">5</td><td id="cal6" class="calendar-day">6</td><td id="cal7" class="calendar-day">7</td><td id="cal8" class="calendar-day">8</td><td id="cal9" class="calendar-day">9</td><td id="cal10" class="calendar-saturday">10</td></tr><tr class="calendar-weekdays"><td id="cal11" class="calendar-sunday">11</td><td id="cal12" class="calendar-day">12</td><td id="cal13" class="calendar-day">13</td><td id="cal14" class="calendar-day">14</td><td id="cal15" class="calendar-day">15</td><td id="cal16" class="calendar-day">16</td><td id="cal17" class="calendar-saturday">17</td></tr><tr class="calendar-weekdays"><td id="cal18" class="calendar-sunday">18</td><td id="cal19" class="calendar-day">19</td><td id="cal20" class="calendar-day">20</td><td id="cal21" class="calendar-day">21</td><td id="cal22" class="calendar-day">22</td><td id="cal23" class="calendar-day">23</td><td id="cal24" class="calendar-saturday">24</td></tr><tr class="calendar-weekdays"><td id="cal25" class="calendar-sunday">25</td><td id="cal26" class="calendar-day">26</td><td id="cal27" class="calendar-day">27</td><td id="cal28" class="calendar-day">28</td><td id="cal29" class="calendar-day">29</td><td id="cal30" class="calendar-day">30</td><td class="calendar-saturday"></td></tr>
</tbody></table>
</div>
</div><div class="panel">
<h5 onclick='showhidediv("sidebar_statistics");'>统计</h5>
<div class="panel-content" id="sidebar_statistics" style="display: block">
访问次数 133640<br/>今日访问 1<br/>日志数量 7121<br/><a href="guestbook.php.htm" tppabs="http://i.renjihe.com/blog/guestbook.php">留言数量 2</a><br/>在线人数 1<br/>
</div>
</div><div class="panel">
<h5 onclick='showhidediv("sidebar_entries");'>最新日志</h5>
<div class="panel-content" id="sidebar_entries" style="display: block">
<ul><li class='rowcouple'><a href="read.php-7527.htm" tppabs="http://i.renjihe.com/blog/read.php?7527" title="mysql优化之索引优化">mysql优化之索引优化</a></li><li class='rowodd'><a href="read.php-7526.htm" tppabs="http://i.renjihe.com/blog/read.php?7526" title="Mysql limit 优化，百万至千万级快速分页，--复合索引的引用并应用于轻量级框架&nbsp;&nbsp;">Mysql limit ...</a></li><li class='rowcouple'><a href="read.php-7525.htm" tppabs="http://i.renjihe.com/blog/read.php?7525" title="mysql sql语句执行时间查询">mysql sql语句执...</a></li><li class='rowodd'><a href="read.php-7524.htm" tppabs="http://i.renjihe.com/blog/read.php?7524" title="GeoHash核心原理解析">GeoHash核心原理解...</a></li><li class='rowcouple'><a href="read.php-7523.htm" tppabs="http://i.renjihe.com/blog/read.php?7523" title="如何实现按距离排序、范围查找">如何实现按距离排序、范围...</a></li></ul>
</div>
</div>
				</div>
				<div id="innerSidebarTwo">
					<div class="panel">
<h5 onclick='showhidediv("sidebar_link");'>链接</h5>
<div class="panel-content" id="sidebar_link" style="display: block">
<ul><li><strong>协会</strong></li><li class="indent"><a href="javascript:if(confirm('http://www.siggraph.org/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.siggraph.org/'" tppabs="http://www.siggraph.org/" target="_blank" title="siggraph - ">siggraph</a></li><li class="indent"><a href="javascript:if(confirm('http://www.siggraph.org.cn/Pages/index.aspx  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.siggraph.org.cn/Pages/index.aspx'" tppabs="http://www.siggraph.org.cn/Pages/index.aspx" target="_blank" title="siggraph中国 - ">siggraph中国</a></li><li class="indent"><a href="javascript:if(confirm('http://www.igf.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.igf.com/'" tppabs="http://www.igf.com/" target="_blank" title="独立游戏节 - ">独立游戏节</a></li><li><strong>项目</strong></li><li class="indent"><a href="javascript:if(confirm('http://youyur.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://youyur.com/'" tppabs="http://youyur.com/" target="_blank" title="有鱼 - ">有鱼</a></li><li class="indent"><a href="javascript:if(confirm('http://codecanyon.net/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://codecanyon.net/'" tppabs="http://codecanyon.net/" target="_blank" title="codecanyon - ">codecanyon</a></li><li class="indent"><a href="javascript:if(confirm('http://www.sxsoft.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.sxsoft.com/'" tppabs="http://www.sxsoft.com/" target="_blank" title="软件项目交易网 - ">软件项目交易网</a></li><li class="indent"><a href="javascript:if(confirm('http://www.csto.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.csto.com/'" tppabs="http://www.csto.com/" target="_blank" title="csto - ">csto</a></li><li class="indent"><a href="javascript:if(confirm('http://themeforest.net/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://themeforest.net/'" tppabs="http://themeforest.net/" target="_blank" title="themeforest - ">themeforest</a></li><li class="indent"><a href="javascript:if(confirm('http://www.digitalriver.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.digitalriver.com/'" tppabs="http://www.digitalriver.com/" target="_blank" title="Digital River - ">Digital River</a></li><li class="indent"><a href="javascript:if(confirm('http://www.vworker.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.vworker.com/'" tppabs="http://www.vworker.com/" target="_blank" title="vworker - ">vworker</a></li><li class="indent"><a href="javascript:if(confirm('http://luexiao.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://luexiao.com/'" tppabs="http://luexiao.com/" target="_blank" title="略晓 - ">略晓</a></li><li class="indent"><a href="javascript:if(confirm('http://www.yateshi.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.yateshi.com/'" tppabs="http://www.yateshi.com/" target="_blank" title="雅特士外包网  - ">雅特士外包网 </a></li><li class="indent"><a href="javascript:if(confirm('http://wpappstore.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://wpappstore.com/'" tppabs="http://wpappstore.com/" target="_blank" title="WP App Store - ">WP App Store</a></li><li class="indent"><a href="javascript:if(confirm('http://store.steampowered.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://store.steampowered.com/'" tppabs="http://store.steampowered.com/" target="_blank" title="Steam - ">Steam</a></li><li class="indent"><a href="javascript:if(confirm('http://www.taskcity.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.taskcity.com/'" tppabs="http://www.taskcity.com/" target="_blank" title="TaskCity - ">TaskCity</a></li><li class="indent"><a href="javascript:if(confirm('http://www.istockphoto.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.istockphoto.com/'" tppabs="http://www.istockphoto.com/" target="_blank" title="iStockphoto - ">iStockphoto</a></li><li class="indent"><a href="javascript:if(confirm('http://envato.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://envato.com/'" tppabs="http://envato.com/" target="_blank" title="Envato - ">Envato</a></li><li class="indent"><a href="javascript:if(confirm('https://tutsplus.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='https://tutsplus.com/'" tppabs="https://tutsplus.com/" target="_blank" title="Tuts+ Premium - ">Tuts+ Premium</a></li><li class="indent"><a href="javascript:if(confirm('http://www.sharebank.com.cn/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.sharebank.com.cn/'" tppabs="http://www.sharebank.com.cn/" target="_blank" title="软行天下  - ">软行天下 </a></li><li class="indent"><a href="javascript:if(confirm('http://www.softreg.com.cn/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.softreg.com.cn/'" tppabs="http://www.softreg.com.cn/" target="_blank" title="中国共享软件注册中心 - ">中国共享软件注册中心</a></li><li class="indent"><a href="javascript:if(confirm('https://www.elance.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='https://www.elance.com/'" tppabs="https://www.elance.com/" target="_blank" title="Elance - ">Elance</a></li><li class="indent"><a href="javascript:if(confirm('http://www.freelancer.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.freelancer.com/'" tppabs="http://www.freelancer.com/" target="_blank" title="freelancer - ">freelancer</a></li><li class="indent"><a href="javascript:if(confirm('http://www.bizsofts.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.bizsofts.com/'" tppabs="http://www.bizsofts.com/" target="_blank" title="软件商务网 - ">软件商务网</a></li><li class="indent"><a href="javascript:if(confirm('https://www.odesk.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='https://www.odesk.com/'" tppabs="https://www.odesk.com/" target="_blank" title="oDesk - ">oDesk</a></li><li class="indent"><a href="javascript:if(confirm('http://store.raspberrypi.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://store.raspberrypi.com/'" tppabs="http://store.raspberrypi.com/" target="_blank" title="树莓派商店 - ">树莓派商店</a></li><li><strong>杂项</strong></li><li class="indent"><a href="javascript:if(confirm('http://www.codinghorror.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.codinghorror.com/'" tppabs="http://www.codinghorror.com/" target="_blank" title="codinghorror - ">codinghorror</a></li><li class="indent"><a href="javascript:if(confirm('http://www.fabiensanglard.net/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.fabiensanglard.net/'" tppabs="http://www.fabiensanglard.net/" target="_blank" title="fabiensanglard - ">fabiensanglard</a></li><li class="indent"><a href="javascript:if(confirm('http://www.intel.com/intelpress/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.intel.com/intelpress/'" tppabs="http://www.intel.com/intelpress/" target="_blank" title="英特尔出版社 - ">英特尔出版社</a></li><li class="indent"><a href="javascript:if(confirm('http://www.opencart.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.opencart.com/'" tppabs="http://www.opencart.com/" target="_blank" title="OpenCart - ">OpenCart</a></li><li class="indent"><a href="javascript:if(confirm('http://www.appinn.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.appinn.com/'" tppabs="http://www.appinn.com/" target="_blank" title="小众软件 - ">小众软件</a></li><li class="indent"><a href="javascript:if(confirm('http://renderhjs.net/shoebox/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://renderhjs.net/shoebox/'" tppabs="http://renderhjs.net/shoebox/" target="_blank" title="shoebox工具 - ">shoebox工具</a></li><li><strong>个人</strong></li><li><strong>阅读</strong></li><li class="indent"><a href="javascript:if(confirm('http://huaban.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://huaban.com/'" tppabs="http://huaban.com/" target="_blank" title="花瓣网 - ">花瓣网</a></li><li class="indent"><a href="javascript:if(confirm('http://www.oralstudy.cn/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.oralstudy.cn/'" tppabs="http://www.oralstudy.cn/" target="_blank" title="英语口语学习网 - ">英语口语学习网</a></li><li class="indent"><a href="javascript:if(confirm('http://www.dspguide.com/pdfbook.htm  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.dspguide.com/pdfbook.htm'" tppabs="http://www.dspguide.com/pdfbook.htm" target="_blank" title="DSP Guide - ">DSP Guide</a></li><li><strong>在线文档</strong></li><li class="indent"><a href="javascript:if(confirm('http://help.adobe.com/zh_CN/flex/mobileapps/index.html  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://help.adobe.com/zh_CN/flex/mobileapps/index.html'" tppabs="http://help.adobe.com/zh_CN/flex/mobileapps/index.html" target="_blank" title="Flex移动开发 - ">Flex移动开发</a></li><li class="indent"><a href="javascript:if(confirm('http://help.adobe.com/zh_CN/as3/learn/index.html  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://help.adobe.com/zh_CN/as3/learn/index.html'" tppabs="http://help.adobe.com/zh_CN/as3/learn/index.html" target="_blank" title="Flex AS3 - ">Flex AS3</a></li><li class="indent"><a href="javascript:if(confirm('http://www.adobe.com/cn/devnet.html  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.adobe.com/cn/devnet.html'" tppabs="http://www.adobe.com/cn/devnet.html" target="_blank" title="Adobe开发者中心 - ">Adobe开发者中心</a></li><li class="indent"><a href="javascript:if(confirm('http://help.adobe.com/zh_CN/FlashPlatform/reference/actionscript/3/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://help.adobe.com/zh_CN/FlashPlatform/reference/actionscript/3/'" tppabs="http://help.adobe.com/zh_CN/FlashPlatform/reference/actionscript/3/" target="_blank" title="ActionScript3.0参考 - ">ActionScript3.0参考</a></li><li class="indent"><a href="javascript:if(confirm('http://help.adobe.com/zh_CN/as3/dev/index.html  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://help.adobe.com/zh_CN/as3/dev/index.html'" tppabs="http://help.adobe.com/zh_CN/as3/dev/index.html" target="_blank" title="ActionScript 3.0 - ">ActionScript 3.0</a></li><li class="indent"><a href="javascript:if(confirm('http://help.adobe.com/zh_CN/air/build/index.html  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://help.adobe.com/zh_CN/air/build/index.html'" tppabs="http://help.adobe.com/zh_CN/air/build/index.html" target="_blank" title="AIR - ">AIR</a></li><li class="indent"><a href="javascript:if(confirm('http://www.ppurl.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.ppurl.com/'" tppabs="http://www.ppurl.com/" target="_blank" title="皮皮书屋 - ">皮皮书屋</a></li><li class="indent"><a href="javascript:if(confirm('http://science.scileaf.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://science.scileaf.com/'" tppabs="http://science.scileaf.com/" target="_blank" title="四叶科学百科 - ">四叶科学百科</a></li><li><strong>临时</strong></li><li class="indent"><a href="javascript:if(confirm('http://www.uisdc.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.uisdc.com/'" tppabs="http://www.uisdc.com/" target="_blank" title="优设 - ">优设</a></li><li class="indent"><a href="javascript:if(confirm('http://www.genesis-3d.com.cn/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.genesis-3d.com.cn/'" tppabs="http://www.genesis-3d.com.cn/" target="_blank" title="genesis-3d - ">genesis-3d</a></li><li class="indent"><a href="javascript:if(confirm('http://designlol.net/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://designlol.net/'" tppabs="http://designlol.net/" target="_blank" title="designlol - ">designlol</a></li></ul>
</div>
</div><div class="panel">
<h5 onclick='showhidediv("sidebar_misc");'>其他</h5>
<div class="panel-content" id="sidebar_misc" style="display: block">
<a href="login.php.htm" tppabs="http://i.renjihe.com/blog/login.php">登入</a><br/><a href="login.php-job=register.htm" tppabs="http://i.renjihe.com/blog/login.php?job=register">注册</a><br/>RSS： <a href="feed.php" tppabs="http://i.renjihe.com/blog/feed.php">日志</a> | <a href="feed.php-go=comment.htm" tppabs="http://i.renjihe.com/blog/feed.php?go=comment">评论</a><br/>编码：UTF-8<br/><a href="javascript:if(confirm('http://validator.w3.org/check?uri=referer  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://validator.w3.org/check?uri=referer'" tppabs="http://validator.w3.org/check?uri=referer" target="_blank">XHTML 1.0</a>
</div>
</div>
				</div>
				<div id="innerSidebarFooter">
				 Powered by <a href="javascript:if(confirm('http://www.bo-blog.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.bo-blog.com/'" tppabs="http://www.bo-blog.com/" target="_blank">Bo-Blog 2.1.1 Release</a><span id="footer-security"><a href="javascript:if(confirm('http://www.cnbct.org/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.cnbct.org/'" tppabs="http://www.cnbct.org/" target="_blank" title="Code detection by Bug.Center.Team"><img src="detect.gif" tppabs="http://i.renjihe.com/blog/images/others/detect.gif" alt="Code detection by Bug.Center.Team" border="0" /></a></span>
				<div id="processtime">
				</div>
				</div>
			</div>
		</div>
	</div>
		<div id="footer">
		</div>
	</div>
</div>
<script type="text/javascript">
loadSidebar();
</script>
<script type='text/javascript'>
//<![CDATA[
if (document.getElementById('processtime')) document.getElementById('processtime').innerHTML="<span class='runtimedisplay'>Run in 312 ms, 4 Queries.</span>";
//]]>
</script></body>
</html>