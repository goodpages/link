<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0">
<channel>
<title><![CDATA[流浪的龙－个人知识管理]]></title> 
<link>http://i.renjihe.com/blog/index.php</link> 
<description><![CDATA[]]></description> 
<language>zh-cn</language> 
<copyright><![CDATA[流浪的龙－个人知识管理]]></copyright>
<item>
<link>http://i.renjihe.com/blog/read.php?</link>
<title><![CDATA[JS魔法堂：ES6新特性——GeneratorFunction介绍]]></title> 
<author>renjihe1988 &lt;admin@yourname.com&gt;</author>
<category><![CDATA[web]]></category>
<pubDate>Mon, 29 Aug 2016 06:35:39 +0000</pubDate> 
<guid>http://i.renjihe.com/blog/read.php?</guid> 
<description>
<![CDATA[ 
	<div id="cnblogs_post_body" style="margin: 0px 0px 20px; padding: 0px; word-break: break-word; color: #333333; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px"><p style="margin: 10px auto; padding: 0px"><span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 18px; background-color: #888888"><strong style="margin: 0px; padding: 0px">一、前言　　　　　　　　　　　　　　　　　　　　　　　　　　　&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br /></strong></span></p><p style="margin: 10px auto; padding: 0px">&nbsp; 第一次看koajs的示例时，发现该语句&nbsp;<span style="margin: 5px 0px; padding: 3px; border: 1px solid #cccccc; overflow: auto; line-height: 1.8; font-size: 12px !important; font-family: 'Courier New'; color: #000000; background-color: #f5f5f5" class="cnblogs_code">function *(next)&#123;...............&#125;</span>&nbsp;，这是啥啊？于是搜索一下，原来这是就是ES6的新特性Generator Function(生成器函数)。</p><p style="margin: 10px auto; padding: 0px">&nbsp; 那什么是生成器函数呢？其实就相当于C#2.0中通过yield关键字实现的迭代器的生成器（细节有所不同），那么理解的关键就在迭代器和yield关键字两部分了。下面将尝试从表象出发，逐步对生成器函数及利用它进行异步编程进行浅层的分析理解。</p><p style="margin: 10px auto; padding: 0px">&nbsp;</p><p style="margin: 10px auto; padding: 0px"><span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 18px; background-color: #888888"><strong style="margin: 0px; padding: 0px">二、表象&mdash;&mdash;语法及基本使用　　　　　　　　　　　　　　　　　　　&nbsp;&nbsp;&nbsp;<br /></strong></span></p><p style="margin: 10px auto; padding: 0px"><strong style="margin: 0px; padding: 0px">&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 15px">示例：</span></strong></p><div class="cnblogs_code" style="margin: 5px 0px; padding: 5px; border: 1px solid #cccccc; overflow: auto; color: #000000; font-family: 'Courier New' !important; font-size: 12px !important; background-color: #f5f5f5"><div class="cnblogs_code_toolbar" style="margin: 5px 0px 0px; padding: 0px"><span style="margin: 0px; padding: 0px 5px 0px 0px; line-height: 1.8" class="cnblogs_code_copy"><a style="margin: 0px; padding: 0px; border: none !important" title="复制代码"><img style="margin: 0px; padding: 0px; max-width: 900px; border: none !important" src="http://common.cnblogs.com/images/copycode.gif" border="0" alt="复制代码" /></a></span></div><pre style="margin-top: 0px; margin-bottom: 0px; padding: 0px; white-space: pre-wrap; word-wrap: break-word; font-family: 'Courier New' !important; font-size: 12px !important"><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> 定义生成器函数</span> function *<span style="margin: 0px; padding: 0px; line-height: 1.8">enumerable(msg)&#123;&nbsp;&nbsp; console.log(msg)&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> msg1 = <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">yield</span> msg + <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">&nbsp;&nbsp;after </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8">&nbsp;&nbsp; console.log(msg1)&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> msg2 = <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">yield</span> msg1 + <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000"> after</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span>&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">try</span><span style="margin: 0px; padding: 0px; line-height: 1.8">&#123;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> msg3 = <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">yield</span> msg2 + <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">after</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8">&nbsp;&nbsp;&nbsp;&nbsp; console.log(</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">ok</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8">)&nbsp;&nbsp; &#125;&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">catch</span><span style="margin: 0px; padding: 0px; line-height: 1.8">(e)&#123;&nbsp;&nbsp;&nbsp;&nbsp; console.log(e)&nbsp;&nbsp; &#125;&nbsp;&nbsp; console.log(msg2 </span>+ <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000"> over</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8">) &#125;&nbsp;&nbsp;</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> 初始化迭代器</span> <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> enumerator = enumerable(<span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">hello</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8">) </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> ret = enumerator.next() <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> 控制台显示 hello，ret的值&#123;value:'hello after',done:false&#125;</span> ret =&nbsp;&nbsp;enumerator.next(<span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">world</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span>) <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> 控制台显示 world，ret的值&#123;value:'world after',done:false&#125;</span> ret = enumerator.next(<span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">game</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span>) <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> 控制台显示game，ret的值&#123;value:'game after',done:false&#125; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> 抛出异常信息</span> ret = enumerator.<span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">throw</span>(<span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">new</span> Error(<span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">test</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span>)) <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> 控制台显示new Error('test')信息，然后显示game over。ret的值为&#123;done:true&#125;&nbsp;&nbsp;</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> for...of语句</span> enumerator = enumerable(<span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">hello</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8">) </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">for</span><span style="margin: 0px; padding: 0px; line-height: 1.8">(ret of enumerator)&nbsp;&nbsp; console.log(JSON.stringify(ret)); </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> 控制台依次显示 </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> hello </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> &#123;value:'hello after',done:false&#125; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> world </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> &#123;value:'world after',done:false&#125; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> &#123;value:'game after',done:false&#125; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> game over </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> &#123;done:true&#125;</span></pre><div class="cnblogs_code_toolbar" style="margin: 5px 0px 0px; padding: 0px"><span style="margin: 0px; padding: 0px 5px 0px 0px; line-height: 1.8" class="cnblogs_code_copy"><a style="margin: 0px; padding: 0px; border: none !important" title="复制代码"><img style="margin: 0px; padding: 0px; max-width: 900px; border: none !important" src="http://common.cnblogs.com/images/copycode.gif" border="0" alt="复制代码" /></a></span></div></div><p style="margin: 10px auto; padding: 0px">&nbsp;</p><p style="margin: 10px auto; padding: 0px"><strong style="margin: 0px; padding: 0px">&nbsp;<span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 15px">&nbsp;1. 生成器语函数定义</span></strong></p><div class="cnblogs_code" style="margin: 5px 0px; padding: 5px; border: 1px solid #cccccc; overflow: auto; color: #000000; font-family: 'Courier New' !important; font-size: 12px !important; background-color: #f5f5f5"><pre style="margin-top: 0px; margin-bottom: 0px; padding: 0px; white-space: pre-wrap; word-wrap: break-word; font-family: 'Courier New' !important; font-size: 12px !important">function*<span style="margin: 0px; padding: 0px; line-height: 1.8"> test()&#123;&#125; function </span>*<span style="margin: 0px; padding: 0px; line-height: 1.8"> test()&#123;&#125; function </span>*<span style="margin: 0px; padding: 0px; line-height: 1.8">test()&#123;&#125; test </span>= function*<span style="margin: 0px; padding: 0px; line-height: 1.8"> ()&#123;&#125;&nbsp;&nbsp;test </span>= function *()&#123;&#125;</pre></div><p style="margin: 10px auto; padding: 0px">&nbsp; 普通函数添加*号后则成为了成为了生成器函数了。</p><div class="cnblogs_code" style="margin: 5px 0px; padding: 5px; border: 1px solid #cccccc; overflow: auto; color: #000000; font-family: 'Courier New' !important; font-size: 12px !important; background-color: #f5f5f5"><pre style="margin-top: 0px; margin-bottom: 0px; padding: 0px; white-space: pre-wrap; word-wrap: break-word; font-family: 'Courier New' !important; font-size: 12px !important">Object.prototype.toString.call(test) <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> 显示[object GeneratorFunction]</span></pre></div><p style="margin: 10px auto; padding: 0px">&nbsp; 生成器函数的行为与普通函数并不相同，表现为如下3点：</p><p style="margin: 10px auto; padding: 0px">&nbsp; 1. 通过new运算符或函数调用的形式调用生成器函数，均会返回一个生成器实例；</p><p style="margin: 10px auto; padding: 0px">&nbsp; 2.&nbsp;通过new运算符或函数调用的形式调用生成器函数，均不会马上执行函数体的代码；</p><p style="margin: 10px auto; padding: 0px">&nbsp; 3. 必须调用生成器实例的next方法才会执行生成器函数体的代码。</p><div class="cnblogs_code" style="margin: 5px 0px; padding: 5px; border: 1px solid #cccccc; overflow: auto; color: #000000; font-family: 'Courier New' !important; font-size: 12px !important; background-color: #f5f5f5"><pre style="margin-top: 0px; margin-bottom: 0px; padding: 0px; white-space: pre-wrap; word-wrap: break-word; font-family: 'Courier New' !important; font-size: 12px !important">function *<span style="margin: 0px; padding: 0px; line-height: 1.8">say(msg)&#123;&nbsp;&nbsp; console.log(msg) &#125; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> gen = say(<span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">hello world</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span>) <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> 没有显示hello world</span> console.log(Object.prototype.toString.call(gen)) <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> 显示[object Generator]</span> gen.next() <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> 显示hello world</span></pre></div><p style="margin: 10px auto; padding: 0px"><span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 15px"><strong style="margin: 0px; padding: 0px">&nbsp; 2、 关键字yield&mdash;&mdash;迭代器生成器</strong></span></p><p style="margin: 10px auto; padding: 0px">&nbsp;&nbsp; 用于马上退出代码块并保留现场，当执行迭代器的next函数时，则能从退出点恢复现场并继续执行下去。下面有2点需要注意：</p><p style="margin: 10px auto; padding: 0px">&nbsp;&nbsp;&nbsp; 1. yield后面的表达式将作为迭代器next函数的返回值；</p><p style="margin: 10px auto; padding: 0px">&nbsp;&nbsp;&nbsp; 2. 迭代器next函数的入参将作为yield的返回值（有点像运算符）。</p><p style="margin: 10px auto; padding: 0px"><span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 15px"><strong style="margin: 0px; padding: 0px">&nbsp; 3、迭代器(Generator)</strong></span></p><p style="margin: 10px auto; padding: 0px">&nbsp; &nbsp; 迭代器是一个拥有&nbsp;<span style="margin: 5px 0px; padding: 3px; border: 1px solid #cccccc; overflow: auto; line-height: 1.8; font-size: 12px !important; font-family: 'Courier New'; color: #000000; background-color: #f5f5f5" class="cnblogs_code">&#123;value:&#123;*&#125;, done:&#123;Boolean&#125;&#125; next([*])方法</span>&nbsp;和&nbsp;<span style="margin: 5px 0px; padding: 3px; border: 1px solid #cccccc; overflow: auto; line-height: 1.8; font-size: 12px !important; font-family: 'Courier New'; color: #000000; background-color: #f5f5f5" class="cnblogs_code">&#123;undefined&#125;&nbsp;<span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">throw</span>([*])方法</span>&nbsp;的对象，通过next函数不断执行以关键字yield分割的代码段，通过throw函数令yield分割的代码段抛出异常。</p><p style="margin: 10px auto; padding: 0px">&nbsp;</p><p style="margin: 10px auto; padding: 0px"><span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 18px; background-color: #888888"><strong style="margin: 0px; padding: 0px">三、核心1&mdash;&mdash;迭代器　　　　　　　　　　　　　　　　　　　　　&nbsp;&nbsp;<br /></strong></span></p><p style="margin: 10px auto; padding: 0px">&nbsp; 迭代器更多的是指迭代器模式，迭代器模式是指通过一个名为迭代器的对象按一定的规则遍历集合元素，调用者只需告诉迭代器获取下一个元素即可，而集合的类型、如何获取元素等因素均由具体的迭代器自行处理。（又一次地关注点分离！）并且由于迭代器模式可以做到 按需执行/延迟执行 的效果，因此能降低遍历无限序列时内存/栈溢出的问题，也能作为异步编程模式使用。</p><p style="margin: 10px auto; padding: 0px"><strong style="margin: 0px; padding: 0px">&nbsp; 模式理解的注意点：</strong></p><p style="margin: 10px auto; padding: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1. 迭代器每次进访问集合的一个元素，并由调用者发起访问请求时迭代器才执行下一次访问操作</p><p style="margin: 10px auto; padding: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2. &ldquo;按一定的规则&rdquo;，意味着不一定遍历集合中所有的元素，并且规则可以内聚到迭代器的具体实现上，也可通过策略模式外移到其他模块中；</p><p style="margin: 10px auto; padding: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3. &ldquo;集合&rdquo;，集合可以是一开始就已经初始化好的有限序列集合（如[1,2,3,4,5,6,7]），也可以是按需生成的无限序列集合（如1到无限大）</p><p style="margin: 10px auto; padding: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4. &ldquo;集合元素&rdquo;，可以是整数集合、字符串集合等数据集合，也可以是函数等指令+数据的集合；</p><p style="margin: 10px auto; padding: 0px">&nbsp; 若触过C#、Java等服务端语句的朋友应该对迭代器有一定程度的了解，C#的IEnumrable、IEnumerator和Java的Iterable、Iterator就是跟迭代器相关的接口定义，继承上述接口的迭代器实现均可以通过foreach或for...in语句作循环操作。</p><p style="margin: 10px auto; padding: 0px"><strong style="margin: 0px; padding: 0px">&nbsp; 那么这里有2点是要注意的：</strong></p><p style="margin: 10px auto; padding: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1. 迭代器是指设计模式，跟具体的语言无关，因此所有语言均可根据该模式实现具体的迭代器；</p><p style="margin: 10px auto; padding: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2. foreach或for...in语句是语法层面的支持，跟迭代器模式没有必然联系。（若语法层面不支持，那函数式编程中的递归的效果是一样的，假如编译器/解析器支持尾递归则更好了，可以JS不支持）</p><p style="margin: 10px auto; padding: 0px">&nbsp; 下面我们通过迭代器来实现Python中的range函数，并通过range函数创建一个超大的有限序列正整数集合（直接用数组的话绝有可能导致栈溢出哦！）。</p><div class="cnblogs_code" style="margin: 5px 0px; padding: 5px; border: 1px solid #cccccc; overflow: auto; color: #000000; font-family: 'Courier New' !important; font-size: 12px !important; background-color: #f5f5f5"><div class="cnblogs_code_toolbar" style="margin: 5px 0px 0px; padding: 0px"><span style="margin: 0px; padding: 0px 5px 0px 0px; line-height: 1.8" class="cnblogs_code_copy"><a style="margin: 0px; padding: 0px; border: none !important" title="复制代码"><img style="margin: 0px; padding: 0px; max-width: 900px; border: none !important" src="http://common.cnblogs.com/images/copycode.gif" border="0" alt="复制代码" /></a></span></div><pre style="margin-top: 0px; margin-bottom: 0px; padding: 0px; white-space: pre-wrap; word-wrap: break-word; font-family: 'Courier New' !important; font-size: 12px !important"><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> 迭代器构造函数</span> <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> RangeIterator =<span style="margin: 0px; padding: 0px; line-height: 1.8"> function(start,end,scan)&#123;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">this</span>.start = arguments.length &gt;= <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800080">2</span> ? start : <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800080">0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">this</span>.end = end == undefined ?<span style="margin: 0px; padding: 0px; line-height: 1.8"> start : end&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">this</span>.scan = scan &#124;&#124; <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800080">1</span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">this</span>.idx = <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">this</span><span style="margin: 0px; padding: 0px; line-height: 1.8">.start &#125; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> 向迭代器发起访问下一个元素的请求 </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> FF和ES6下迭代器接口规范定义了迭代器必须通过名为next的函数发起访问下一个元素的请求</span> RangeIterator.prototype.next =<span style="margin: 0px; padding: 0px; line-height: 1.8"> function()&#123;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">if</span> (<span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">this</span>.idx &gt; <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">this</span><span style="margin: 0px; padding: 0px; line-height: 1.8">.end)&nbsp;&nbsp;　　　　</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">if</span> (!!<span style="margin: 0px; padding: 0px; line-height: 1.8">StopIteration) &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;　　</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">throw</span><span style="margin: 0px; padding: 0px; line-height: 1.8"> StopIteration&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125;</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">else</span><span style="margin: 0px; padding: 0px; line-height: 1.8">&#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">return</span> <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">void</span> <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800080">0</span><span style="margin: 0px; padding: 0px; line-height: 1.8">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> ret = <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">this</span><span style="margin: 0px; padding: 0px; line-height: 1.8">.idx&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">this</span>.idx += <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">this</span><span style="margin: 0px; padding: 0px; line-height: 1.8">.scan&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">return</span><span style="margin: 0px; padding: 0px; line-height: 1.8"> ret &#125; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> Python中的range函数</span> <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> range =<span style="margin: 0px; padding: 0px; line-height: 1.8"> function(start, end, scan)&#123;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> iterator = <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">new</span><span style="margin: 0px; padding: 0px; line-height: 1.8"> RangeIterator(start, end, scan)&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">return</span><span style="margin: 0px; padding: 0px; line-height: 1.8"> &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> FF下令for...in语句调用对象的迭代器的接口规范</span> <span style="margin: 0px; padding: 0px; line-height: 1.8">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;__iterator__: function()&#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">return</span><span style="margin: 0px; padding: 0px; line-height: 1.8"> iterator&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125;,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> 暴露迭代器的next函数</span> <span style="margin: 0px; padding: 0px; line-height: 1.8">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next: function()&#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">return</span><span style="margin: 0px; padding: 0px; line-height: 1.8"> iterator.next()&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125;,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; toString: function()&#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> 可能会导致栈溢出</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> array =<span style="margin: 0px; padding: 0px; line-height: 1.8"> []&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">for</span> (<span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> i = <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">this</span>.next(); i != <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">void</span> <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800080">0</span>; i = <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">this</span><span style="margin: 0px; padding: 0px; line-height: 1.8">.next())&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; array.push(i)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">return</span> array + <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">''</span><span style="margin: 0px; padding: 0px; line-height: 1.8">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125; &#125; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> r = range(<span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800080">1</span>, <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800080">100000000000000000000</span><span style="margin: 0px; padding: 0px; line-height: 1.8">) </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> FF下 </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> 参考：</span><span style="margin: 0px; padding: 0px; line-height: 1.8; text-decoration: underline; color: #008000">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Iterators_and_Generators</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">#.E5.AE.9A.E4.B9.89.E8.87.AA.E5.AE.9A.E4.B9.89.E8.BF.AD.E4.BB.A3.E5.99.A8</span> <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">for</span>(<span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> i <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">in</span><span style="margin: 0px; padding: 0px; line-height: 1.8"> r)&nbsp;&nbsp; console.log(i) </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> 显示1到99999999999999999999 </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> 所有浏览器</span> <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">for</span> (<span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> i = r.next(); i != <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">void</span> <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800080">0</span>; i =<span style="margin: 0px; padding: 0px; line-height: 1.8"> r.next())&nbsp;&nbsp; console.log(i) </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> 显示1到99999999999999999999</span></pre><div class="cnblogs_code_toolbar" style="margin: 5px 0px 0px; padding: 0px"><span style="margin: 0px; padding: 0px 5px 0px 0px; line-height: 1.8" class="cnblogs_code_copy"><a style="margin: 0px; padding: 0px; border: none !important" title="复制代码"><img style="margin: 0px; padding: 0px; max-width: 900px; border: none !important" src="http://common.cnblogs.com/images/copycode.gif" border="0" alt="复制代码" /></a></span></div></div><p style="margin: 10px auto; padding: 0px">&nbsp; 由于JS是单线程运行，并且当UI线程被阻塞N秒后，浏览器会询问是否停止脚本的执行，但上述代码并不会由于序列过大造成栈溢出的问题。假如预先生成1到<span style="margin: 0px; padding: 0px; line-height: 1.8; color: #000000">99999999999999999999或更大数字</span>的数组，那很有可能造成stack overflow。那是由于迭代器实质为一状态机，而调用next函数则是触发状态的转换，而状态机中同一时刻用于存放变量的存储空间固定，并不会出现无限增长的情况。</p><p style="margin: 10px auto; padding: 0px">&nbsp;</p><p style="margin: 10px auto; padding: 0px"><span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 18px; background-color: #888888"><strong style="margin: 0px; padding: 0px">四、核心2&mdash;&mdash;yield关键字　　　　　　　　　　　　　　　　　　&nbsp;&nbsp;<br /></strong></span></p><p style="margin: 10px auto; padding: 0px">&nbsp;&nbsp; 回到关键字yield上了，其实yield关键字就是以一种更直观、便捷的方式让我们创建用于遍历有限序列集合的迭代器，而yield则用于将生成器函数的代码切片作为有限序列集合的元素（元素的类型为指令+数据，而不仅仅是数据而已）。下面我们一起看看yield关键字是怎样对代码切片的吧！</p><div class="cnblogs_code" style="margin: 5px 0px; padding: 5px; border: 1px solid #cccccc; overflow: auto; color: #000000; font-family: 'Courier New' !important; font-size: 12px !important; background-color: #f5f5f5"><div class="cnblogs_code_toolbar" style="margin: 5px 0px 0px; padding: 0px"><span style="margin: 0px; padding: 0px 5px 0px 0px; line-height: 1.8" class="cnblogs_code_copy"><a style="margin: 0px; padding: 0px; border: none !important" title="复制代码"><img style="margin: 0px; padding: 0px; max-width: 900px; border: none !important" src="http://common.cnblogs.com/images/copycode.gif" border="0" alt="复制代码" /></a></span></div><pre style="margin-top: 0px; margin-bottom: 0px; padding: 0px; white-space: pre-wrap; word-wrap: break-word; font-family: 'Courier New' !important; font-size: 12px !important"><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> 定义生成器函数</span> function *<span style="margin: 0px; padding: 0px; line-height: 1.8">enumerable(msg)&#123;&nbsp;&nbsp; console.log(msg)&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> msg1 = <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">yield</span> msg + <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">&nbsp;&nbsp;after </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8">&nbsp;&nbsp; console.log(msg1)&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> msg2 = <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">yield</span> msg1 + <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000"> after</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8">&nbsp;&nbsp; console.log(msg2 </span>+ <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000"> over</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8">) &#125;</span></pre><div class="cnblogs_code_toolbar" style="margin: 5px 0px 0px; padding: 0px"><span style="margin: 0px; padding: 0px 5px 0px 0px; line-height: 1.8" class="cnblogs_code_copy"><a style="margin: 0px; padding: 0px; border: none !important" title="复制代码"><img style="margin: 0px; padding: 0px; max-width: 900px; border: none !important" src="http://common.cnblogs.com/images/copycode.gif" border="0" alt="复制代码" /></a></span></div></div><p style="margin: 10px auto; padding: 0px">&nbsp; 上述代码最终会被解析为下面的代码：</p><div class="cnblogs_code" style="margin: 5px 0px; padding: 5px; border: 1px solid #cccccc; overflow: auto; color: #000000; font-family: 'Courier New' !important; font-size: 12px !important; background-color: #f5f5f5"><div class="cnblogs_code_toolbar" style="margin: 5px 0px 0px; padding: 0px"><span style="margin: 0px; padding: 0px 5px 0px 0px; line-height: 1.8" class="cnblogs_code_copy"><a style="margin: 0px; padding: 0px; border: none !important" title="复制代码"><img style="margin: 0px; padding: 0px; max-width: 900px; border: none !important" src="http://common.cnblogs.com/images/copycode.gif" border="0" alt="复制代码" /></a></span></div><pre style="margin-top: 0px; margin-bottom: 0px; padding: 0px; white-space: pre-wrap; word-wrap: break-word; font-family: 'Courier New' !important; font-size: 12px !important"><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> enumerable =<span style="margin: 0px; padding: 0px; line-height: 1.8"> function(msg)&#123;&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> state = -<span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800080">1</span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">return</span><span style="margin: 0px; padding: 0px; line-height: 1.8"> &#123;&nbsp;&nbsp;&nbsp;&nbsp; next: function(val)&#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">switch</span>(++<span style="margin: 0px; padding: 0px; line-height: 1.8">state)&#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">case</span> <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800080">0</span><span style="margin: 0px; padding: 0px; line-height: 1.8">:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; console.log(msg </span>+ <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000"> after</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8">)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">break</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">case</span> <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800080">1</span><span style="margin: 0px; padding: 0px; line-height: 1.8">:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> msg1 =<span style="margin: 0px; padding: 0px; line-height: 1.8"> val&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; console.log(msg1 </span>+ <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000"> after</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8">)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">break</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">case</span> <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800080">2</span><span style="margin: 0px; padding: 0px; line-height: 1.8">:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> msg2 =<span style="margin: 0px; padding: 0px; line-height: 1.8"> val&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; console.log(msg2 </span>+ <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000"> over</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8">)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">break</span><span style="margin: 0px; padding: 0px; line-height: 1.8">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125;&nbsp;&nbsp;&nbsp;&nbsp; &#125;&nbsp;&nbsp; &#125; &#125;</span></pre><div class="cnblogs_code_toolbar" style="margin: 5px 0px 0px; padding: 0px"><span style="margin: 0px; padding: 0px 5px 0px 0px; line-height: 1.8" class="cnblogs_code_copy"><a style="margin: 0px; padding: 0px; border: none !important" title="复制代码"><img style="margin: 0px; padding: 0px; max-width: 900px; border: none !important" src="http://common.cnblogs.com/images/copycode.gif" border="0" alt="复制代码" /></a></span></div></div><p style="margin: 10px auto; padding: 0px">(注意：上述仅仅简单的分析，更复杂的情况（条件控制、循环、迭代、异常捕获处理等）可以参考@赵劼的<a style="margin: 0px; padding: 0px; text-decoration: none; color: #000000; border-bottom-width: 1px; border-bottom-style: dotted; border-bottom-color: #333333" href="http://blog.zhaojie.me/2010/01/decompile-methods-with-yield-manually.html" target="_blank">《人肉反编译使用关键字yield的方法》</a>)</p><p style="margin: 10px auto; padding: 0px">&nbsp;</p><p style="margin: 10px auto; padding: 0px">&nbsp;<span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 18px; background-color: #888888"><strong style="margin: 0px; padding: 0px">五、异步调用中的应用　　　　　　　　　　　　　　　　　　　 &nbsp; &nbsp;</strong></span></p><p style="margin: 10px auto; padding: 0px"><span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 15px">&nbsp; 由于迭代器模式实现 延迟执行/按需执行，因此可作为一种异步编程模式来应用。</span></p><div class="cnblogs_code" style="margin: 5px 0px; padding: 5px; border: 1px solid #cccccc; overflow: auto; color: #000000; font-family: 'Courier New' !important; font-size: 12px !important; background-color: #f5f5f5"><div class="cnblogs_code_toolbar" style="margin: 5px 0px 0px; padding: 0px"><span style="margin: 0px; padding: 0px 5px 0px 0px; line-height: 1.8" class="cnblogs_code_copy"><a style="margin: 0px; padding: 0px; border: none !important" title="复制代码"><img style="margin: 0px; padding: 0px; max-width: 900px; border: none !important" src="http://common.cnblogs.com/images/copycode.gif" border="0" alt="复制代码" /></a></span></div><pre style="margin-top: 0px; margin-bottom: 0px; padding: 0px; white-space: pre-wrap; word-wrap: break-word; font-family: 'Courier New' !important; font-size: 12px !important"><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> iterator = getArticles(<span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">dummy.json</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8">) </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> 开始执行</span> <span style="margin: 0px; padding: 0px; line-height: 1.8">iterator.next() </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> 异步任务模型</span> <span style="margin: 0px; padding: 0px; line-height: 1.8">function getData(src)&#123;&nbsp;&nbsp; setTimeout(function()&#123;&nbsp;&nbsp;&nbsp;&nbsp; iterator.next(&#123;tpl: </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">tpl.html</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span>, name: <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">fsjohnhuang</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8">&#125;)&nbsp;&nbsp; &#125;, </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800080">1000</span><span style="margin: 0px; padding: 0px; line-height: 1.8">) &#125; function getTpl(tpl)&#123;&nbsp;&nbsp; setTimeout(function()&#123;&nbsp;&nbsp;&nbsp;&nbsp; iterator.next(</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">hello $&#123;name&#125;</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8">)&nbsp;&nbsp; &#125;, </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800080">3000</span><span style="margin: 0px; padding: 0px; line-height: 1.8">) &#125;<br />// 同步任务 function render(data, tpl)&#123;&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">return</span> tpl.replace(/&#92;$&#92;&#123;(&#92;w+)&#92;&#125;/<span style="margin: 0px; padding: 0px; line-height: 1.8">, function()&#123;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">return</span> data[arguments[<span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800080">1</span>]] ==&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">void</span> <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800080">0</span> ? arguments[<span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800080">0</span>] : data[arguments[<span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800080">1</span><span style="margin: 0px; padding: 0px; line-height: 1.8">]]&nbsp;&nbsp; &#125;) &#125;&nbsp;&nbsp;</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> 主逻辑</span> function *<span style="margin: 0px; padding: 0px; line-height: 1.8">getAritcles(src)&#123;&nbsp;&nbsp; console.log(</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">begin</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8">)&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> data = <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">yield</span><span style="margin: 0px; padding: 0px; line-height: 1.8"> getData(src)&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> tpl = <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">yield</span><span style="margin: 0px; padding: 0px; line-height: 1.8"> getTpl(data.tpl)&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> res =<span style="margin: 0px; padding: 0px; line-height: 1.8"> render(data, tpl)&nbsp;&nbsp; console.log(rest) &#125;</span></pre><div class="cnblogs_code_toolbar" style="margin: 5px 0px 0px; padding: 0px"><span style="margin: 0px; padding: 0px 5px 0px 0px; line-height: 1.8" class="cnblogs_code_copy"><a style="margin: 0px; padding: 0px; border: none !important" title="复制代码"><img style="margin: 0px; padding: 0px; max-width: 900px; border: none !important" src="http://common.cnblogs.com/images/copycode.gif" border="0" alt="复制代码" /></a></span></div></div><p style="margin: 10px auto; padding: 0px">&nbsp; 主逻辑中异步调用的写法与同步调用的基本没差异了，爽了吧！但异步任务模型与生成器函数及其生成的迭代器耦合性太大，还是不太好用。下面我们通过实现了Promises/A+规范的Q来进一步解耦。</p><p style="margin: 10px auto; padding: 0px">&nbsp; 若执行引擎不支持关键字yield，那么上述代码不就无法执行了吗？还是那句话，yield关键字其实就是语法糖，最终还是会被解析为一个迭代器。因此我们自行实现一个迭代器也是能实现上述效果的，不过过程会繁琐很多（若如第2节的示例那样存在try...catch语句，就繁琐死了@~@），并且代码的整洁性、可维护性就全靠攻城狮来保证了。（语法糖从语法层面简化编程和维护难度，但理解底层的工作原理也十分重要哦！）</p><p style="margin: 10px auto; padding: 0px">&nbsp;</p><p style="margin: 10px auto; padding: 0px"><span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 18px; background-color: #888888"><strong style="margin: 0px; padding: 0px">六、与Q结合　　　　　　　　　　　　　　　　　　　　　　　　</strong></span></p><div class="cnblogs_code" style="margin: 5px 0px; padding: 5px; border: 1px solid #cccccc; overflow: auto; color: #000000; font-family: 'Courier New' !important; font-size: 12px !important; background-color: #f5f5f5"><div class="cnblogs_code_toolbar" style="margin: 5px 0px 0px; padding: 0px"><span style="margin: 0px; padding: 0px 5px 0px 0px; line-height: 1.8" class="cnblogs_code_copy"><a style="margin: 0px; padding: 0px; border: none !important" title="复制代码"><img style="margin: 0px; padding: 0px; max-width: 900px; border: none !important" src="http://common.cnblogs.com/images/copycode.gif" border="0" alt="复制代码" /></a></span></div><pre style="margin-top: 0px; margin-bottom: 0px; padding: 0px; white-space: pre-wrap; word-wrap: break-word; font-family: 'Courier New' !important; font-size: 12px !important"><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> 异步任务模型</span> <span style="margin: 0px; padding: 0px; line-height: 1.8">function getData(src)&#123;&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> deferred =<span style="margin: 0px; padding: 0px; line-height: 1.8"> Q.defer()&nbsp;&nbsp; setTimeout(function()&#123;&nbsp;&nbsp;&nbsp;&nbsp;defer.resolve(&#123;tpl: </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">tpl.html</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span>, name: <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">fsjohnhuang</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8">&#125;)&nbsp;&nbsp; &#125;, </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800080">1000</span><span style="margin: 0px; padding: 0px; line-height: 1.8">)&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">return</span><span style="margin: 0px; padding: 0px; line-height: 1.8"> deferred.promise &#125; function getTpl(tpl)&#123;&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> deferred =<span style="margin: 0px; padding: 0px; line-height: 1.8"> Q.defer()&nbsp;&nbsp; setTimeout(function()&#123;&nbsp;&nbsp;&nbsp;&nbsp;defer.resolve(</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">hello $&#123;name&#125;</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8">)&nbsp;&nbsp; &#125;, </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800080">3000</span><span style="margin: 0px; padding: 0px; line-height: 1.8">)&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">return</span><span style="margin: 0px; padding: 0px; line-height: 1.8"> deferred.promise &#125; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> 同步任务</span> <span style="margin: 0px; padding: 0px; line-height: 1.8">function render(data, tpl)&#123;&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">return</span> tpl.replace(/&#92;$&#92;&#123;(&#92;w+)&#92;&#125;/<span style="margin: 0px; padding: 0px; line-height: 1.8">, function()&#123;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">return</span> data[arguments[<span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800080">1</span>]] ==&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">void</span> <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800080">0</span> ? arguments[<span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800080">0</span>] : data[arguments[<span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800080">1</span><span style="margin: 0px; padding: 0px; line-height: 1.8">]]&nbsp;&nbsp; &#125;) &#125;&nbsp;&nbsp;</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> 主逻辑</span> Q.<span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">async</span>(function *<span style="margin: 0px; padding: 0px; line-height: 1.8">()&#123;&nbsp;&nbsp; console.log(</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">begin</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8">)&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> data = <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">yield</span> getData(<span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">dummy.json</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8">)&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> tpl = <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">yield</span><span style="margin: 0px; padding: 0px; line-height: 1.8"> getTpl(data.tpl)&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> res =<span style="margin: 0px; padding: 0px; line-height: 1.8"> render(data, tpl)&nbsp;&nbsp; console.log(rest) &#125;)</span></pre><div class="cnblogs_code_toolbar" style="margin: 5px 0px 0px; padding: 0px"><span style="margin: 0px; padding: 0px 5px 0px 0px; line-height: 1.8" class="cnblogs_code_copy"><a style="margin: 0px; padding: 0px; border: none !important" title="复制代码"><img style="margin: 0px; padding: 0px; max-width: 900px; border: none !important" src="http://common.cnblogs.com/images/copycode.gif" border="0" alt="复制代码" /></a></span></div></div><p style="margin: 10px auto; padding: 0px">&nbsp; 暂未阅读Q的源代码，暂不作详细分析。反正API就这样用，呵呵！</p><p style="margin: 10px auto; padding: 0px">&nbsp;</p><p style="margin: 10px auto; padding: 0px"><span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 18px; background-color: #888888"><strong style="margin: 0px; padding: 0px">七、与iPromise结合　　　　　　　　　　　　　　　　　　　　</strong></span></p><p style="margin: 10px auto; padding: 0px">&nbsp; iPromise是我开发的一个Promises/A+的完整实现，阅读源码你会发现它继承了jQuery.Deferred1.5~2.1、jsDeferred、mmDeferred和Promises/A官网实现示例的精妙设计，并且从v0.0.6开始支持ES6特性GeneratorFunction。使用示例如下：</p><div class="cnblogs_code" style="margin: 5px 0px; padding: 5px; border: 1px solid #cccccc; overflow: auto; color: #000000; font-family: 'Courier New' !important; font-size: 12px !important; background-color: #f5f5f5"><div class="cnblogs_code_toolbar" style="margin: 5px 0px 0px; padding: 0px"><span style="margin: 0px; padding: 0px 5px 0px 0px; line-height: 1.8" class="cnblogs_code_copy"><a style="margin: 0px; padding: 0px; border: none !important" title="复制代码"><img style="margin: 0px; padding: 0px; max-width: 900px; border: none !important" src="http://common.cnblogs.com/images/copycode.gif" border="0" alt="复制代码" /></a></span></div><pre style="margin-top: 0px; margin-bottom: 0px; padding: 0px; white-space: pre-wrap; word-wrap: break-word; font-family: 'Courier New' !important; font-size: 12px !important"><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> getData =<span style="margin: 0px; padding: 0px; line-height: 1.8"> function(dataSrc)&#123;&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">return</span><span style="margin: 0px; padding: 0px; line-height: 1.8"> iPromise(function(r)&#123;&nbsp;&nbsp;&nbsp;&nbsp; setTimeout(function()&#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; r(dataSrc </span>+ <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000"> has loaded</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8">)&nbsp;&nbsp;&nbsp;&nbsp; &#125;, </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800080">1000</span><span style="margin: 0px; padding: 0px; line-height: 1.8">)&nbsp;&nbsp; &#125;) &#125; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> getTpl =<span style="margin: 0px; padding: 0px; line-height: 1.8"> function(tplSrc)&#123;&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">return</span><span style="margin: 0px; padding: 0px; line-height: 1.8"> iPromise(function(r)&#123;&nbsp;&nbsp;&nbsp;&nbsp; setTimeout(function()&#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; r(tplStr </span>+ <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000"> has loaded</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8">)&nbsp;&nbsp;&nbsp;&nbsp; &#125;, </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800080">2000</span><span style="margin: 0px; padding: 0px; line-height: 1.8">)&nbsp;&nbsp; &#125;) &#125; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> render =<span style="margin: 0px; padding: 0px; line-height: 1.8"> function(data, tpl)&#123;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">throw</span> <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">new</span> Error(<span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">OMG!</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8">) &#125;<br /> iPromise(function </span>*<span style="margin: 0px; padding: 0px; line-height: 1.8">(dataSrc, tplSrc)&#123;&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">try</span><span style="margin: 0px; padding: 0px; line-height: 1.8">&#123;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> data = <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">yield</span><span style="margin: 0px; padding: 0px; line-height: 1.8"> getData(dataSrc)&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> tpl = <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">yield</span><span style="margin: 0px; padding: 0px; line-height: 1.8"> getTpl(tplSrc)&nbsp;&nbsp;&nbsp;&nbsp; render(data, tpl)&nbsp;&nbsp; &#125;&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">catch</span><span style="margin: 0px; padding: 0px; line-height: 1.8">(e)&#123;&nbsp;&nbsp;&nbsp;&nbsp; console.log(e)&nbsp;&nbsp; &#125;&nbsp;&nbsp; console.log(</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">over!</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8">) &#125;, </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">dummyData.json</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span>, <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">dummyTpl.json</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8">) </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">/*</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> 结果如下 </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">*/</span> <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> 等待1秒多显示 dummyData.json has loaded </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> 等待2秒多显示 dummyTpl.json has loaded </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> 显示 Error: OMG! </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">&nbsp;&nbsp;&nbsp;&nbsp; Stack trace: </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">&nbsp;&nbsp;&nbsp;&nbsp; test10/render/&lt;/&lt;@file:</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">/home/fsjohnhuang/repos/iPromise/test/v0.0.2.html:190:6 </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> 显示 over!</span></pre><div class="cnblogs_code_toolbar" style="margin: 5px 0px 0px; padding: 0px"><span style="margin: 0px; padding: 0px 5px 0px 0px; line-height: 1.8" class="cnblogs_code_copy"><a style="margin: 0px; padding: 0px; border: none !important" title="复制代码"><img style="margin: 0px; padding: 0px; max-width: 900px; border: none !important" src="http://common.cnblogs.com/images/copycode.gif" border="0" alt="复制代码" /></a></span></div></div><p style="margin: 10px auto; padding: 0px">v0.6.0的中通过递归来实现，具体如下（<a style="margin: 0px; padding: 0px; text-decoration: none; color: #000000; border-bottom-width: 1px; border-bottom-style: dotted; border-bottom-color: #333333" href="https://github.com/fsjohnhuang/iPromise/blob/master/src/iPromise.js#L76" target="_blank">https://github.com/fsjohnhuang/iPromise/blob/master/src/iPromise.js#L76</a>）：</p><div class="cnblogs_code" style="margin: 5px 0px; padding: 5px; border: 1px solid #cccccc; overflow: auto; color: #000000; font-family: 'Courier New' !important; font-size: 12px !important; background-color: #f5f5f5"><div class="cnblogs_code_toolbar" style="margin: 5px 0px 0px; padding: 0px"><span style="margin: 0px; padding: 0px 5px 0px 0px; line-height: 1.8" class="cnblogs_code_copy"><a style="margin: 0px; padding: 0px; border: none !important" title="复制代码"><img style="margin: 0px; padding: 0px; max-width: 900px; border: none !important" src="http://common.cnblogs.com/images/copycode.gif" border="0" alt="复制代码" /></a></span></div><pre style="margin-top: 0px; margin-bottom: 0px; padding: 0px; white-space: pre-wrap; word-wrap: break-word; font-family: 'Courier New' !important; font-size: 12px !important"><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> FF下生成器函数的入参必须在创建迭代器时传递 </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000">//</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #008000"> 若第一次调用迭代器的next函数传递参数，则会报TypeError: attempt to send 第一个入参值 to newborn generator</span> <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> iterator = mixin.apply(<span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">null</span>, toArray(arguments,<span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800080">1</span><span style="margin: 0px; padding: 0px; line-height: 1.8">)) </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> next =<span style="margin: 0px; padding: 0px; line-height: 1.8"> function()&#123; 　　</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> deferred =<span style="margin: 0px; padding: 0px; line-height: 1.8"> iPromise() 　　deferred.resolve.apply(deferred, arguments)&nbsp;&nbsp;　　</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">return</span><span style="margin: 0px; padding: 0px; line-height: 1.8"> deferred.then(function()&#123; 　　　　</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">var</span> yieldReturn =<span style="margin: 0px; padding: 0px; line-height: 1.8"> iterator.next.apply(iterator, arguments)&nbsp;&nbsp;&nbsp;&nbsp;　　</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">if</span>(yieldReturn.done) <span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">throw</span> Error(<span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">StopIteration</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #800000">'</span><span style="margin: 0px; padding: 0px; line-height: 1.8">)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;　　&nbsp;&nbsp; </span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">return</span><span style="margin: 0px; padding: 0px; line-height: 1.8"> yieldReturn.value 　　&#125;).then(next, function(e)&#123; 　　　　iterator.</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: #0000ff">throw</span><span style="margin: 0px; padding: 0px; line-height: 1.8">(e)<br />　　&#125;) &#125; deferred.resolve() deferred.then(next)</span></pre><div class="cnblogs_code_toolbar" style="margin: 5px 0px 0px; padding: 0px"><span style="margin: 0px; padding: 0px 5px 0px 0px; line-height: 1.8" class="cnblogs_code_copy"><a style="margin: 0px; padding: 0px; border: none !important" title="复制代码"><img style="margin: 0px; padding: 0px; max-width: 900px; border: none !important" src="http://common.cnblogs.com/images/copycode.gif" border="0" alt="复制代码" /></a></span></div></div><p style="margin: 10px auto; padding: 0px">&nbsp;</p><p style="margin: 10px auto; padding: 0px"><span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 18px; background-color: #888888"><strong style="margin: 0px; padding: 0px">八、总结　　　　　　　　　　　　　　　　　　　　　　　　　　</strong></span></p><p style="margin: 10px auto; padding: 0px">&nbsp; Generator Function并不是为异步编程而生，但可以将它结合Promise来实现良好的异步编程模型。本篇内容仅简单介绍Generator Function及相关的异步编程内容，若有纰漏请各位指正，谢谢！</p><p style="margin: 10px auto; padding: 0px">&nbsp; 尊重原创，转载请注明来自：<a id="Editor_Edit_hlEntryLink" style="margin: 0px; padding: 0px; text-decoration: none; color: #000000; border-bottom-width: 1px; border-bottom-style: dotted; border-bottom-color: #333333" href="http://www.cnblogs.com/fsjohnhuang/p/4166267.html" target="_blank" title="view: JS魔法堂：ES6新特性&mdash;&mdash;GeneratorFunction介绍">http://www.cnblogs.com/fsjohnhuang/p/4166267.html</a>&nbsp;^_^肥仔John</p><p style="margin: 10px auto; padding: 0px">&nbsp;</p><p style="margin: 10px auto; padding: 0px"><span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 18px; background-color: #888888"><strong style="margin: 0px; padding: 0px">九、 参考　　　　　　　　　　　　　　　　　　　　　　　　　　</strong></span></p><p style="margin: 10px auto; padding: 0px">http://huangj.in/765</p><p style="margin: 10px auto; padding: 0px">https://www.imququ.com/post/generator-function-in-es6.html</p><p style="margin: 10px auto; padding: 0px">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/The_Iterator_protocol</p><p style="margin: 10px auto; padding: 0px">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/function*</p><p style="margin: 10px auto; padding: 0px">http://www.cnblogs.com/yangecnu/archive/2012/03/17/2402432.html</p><p style="margin: 10px auto; padding: 0px">http://www.cnblogs.com/draem0507/p/3795189.html</p><p style="margin: 10px auto; padding: 0px">http://blog.zhaojie.me/2010/06/code-for-fun-iterator-generator-yield-in-javascript-answer-2-loop-and-interpreter.html</p><p style="margin: 10px auto; padding: 0px">http://blog.zhaojie.me/2010/06/code-for-fun-iterator-generator-yield-in-javascript.html</p><p style="margin: 10px auto; padding: 0px">http://blog.zhaojie.me/2010/07/why-java-sucks-and-csharp-rocks-6-yield.html</p></div><div id="MySignature" style="margin: 0px; padding: 0px; color: #333333; font-family: verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px"><p style="margin: 12px 0px 0px; padding: 0px">如果您觉得本文的内容有趣就扫一下吧！捐赠互勉！</p></div>
]]>
</description>
</item><item>
<link>http://i.renjihe.com/blog/read.php?#blogcomment</link>
<title><![CDATA[[评论] JS魔法堂：ES6新特性——GeneratorFunction介绍]]></title> 
<author> &lt;user@domain.com&gt;</author>
<category><![CDATA[评论]]></category>
<pubDate>Thu, 01 Jan 1970 00:00:00 +0000</pubDate> 
<guid>http://i.renjihe.com/blog/read.php?#blogcomment</guid> 
<description>
<![CDATA[ 
	
]]>
</description>
</item>
</channel>
</rss>