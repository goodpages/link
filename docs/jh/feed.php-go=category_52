<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0">
<channel>
<title><![CDATA[流浪的龙－个人知识管理]]></title> 
<link>http://i.renjihe.com/blog/index.php</link> 
<description><![CDATA[]]></description> 
<language>zh-cn</language> 
<copyright><![CDATA[流浪的龙－个人知识管理]]></copyright>
<item>
<link>http://i.renjihe.com/blog/read.php?7442</link>
<title><![CDATA[双目测距与三维重建的OpenCV实现问题集锦（四）三维重建与OpenGL显示]]></title> 
<author>renjihe1988 &lt;admin@yourname.com&gt;</author>
<category><![CDATA[OpenCV]]></category>
<pubDate>Fri, 29 Jul 2016 07:03:59 +0000</pubDate> 
<guid>http://i.renjihe.com/blog/read.php?7442</guid> 
<description>
<![CDATA[ 
	<p style="margin: 0cm 0cm 0pt; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px" class="MsoNormal"><span style="font-size: large"><strong><span style="font-family: 宋体; color: blue">五、三维重建与</span>&nbsp;</strong><strong><span style="color: blue">OpenGL</span>&nbsp;</strong><strong><span style="font-family: 宋体; color: blue">显示</span></strong></span></p><p style="margin: 0cm 0cm 0pt; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px" class="MsoNormal"><span style="font-size: large"><strong><span style="font-family: 宋体; color: blue">.</span></strong></span></p><p style="margin: 0cm 0cm 0pt; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px" class="MsoNormal"><span style="font-size: small"></span></p><p style="margin: 0cm 0cm 0pt; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px; text-indent: 0cm" class="MsoListParagraph"><span style="font-size: small"><span style="font-family: 宋体">在获取到视差数据后，利用</span>&nbsp;<span><span style="font-family: Calibri">OpenCV</span>&nbsp;</span><span style="font-family: 宋体">的</span>&nbsp;<span><span style="font-family: Calibri">reProjectImageTo3D&nbsp;</span></span><span style="font-family: 宋体">函数结合</span>&nbsp;<span><span style="font-family: Calibri">Bouquet</span>&nbsp;</span><span style="font-family: 宋体">校正方法得到的</span>&nbsp;<span><span style="font-family: Calibri">Q</span>&nbsp;</span><span style="font-family: 宋体">矩阵就可以得到环境的三维坐标数据，然后利用</span>&nbsp;<span><span style="font-family: Calibri">OpenGL</span>&nbsp;</span><span style="font-family: 宋体">来实现三维重构。</span>&nbsp;<span><span style="font-family: Calibri">OpenCV</span>&nbsp;</span><span style="font-family: 宋体">与</span>&nbsp;<span><span style="font-family: Calibri">OpenGL</span>&nbsp;</span><span style="font-family: 宋体">的编程范例，我在</span>&nbsp;<span><a style="color: #ff9900; text-decoration: none" href="http://blog.csdn.net/chenyusiyuan/archive/2010/06/24/5691481.aspx"><span style="font-family: 宋体"><span>学习笔记（</span>&nbsp;</span><span style="font-family: Calibri">15</span>&nbsp;<span style="font-family: 宋体"><span>）</span>&nbsp;</span></a></span><span style="font-family: 宋体">中有详细的讨论，这里就不重复了，下面补充一些细节问题：</span></span></p><p style="margin: 0cm 0cm 0pt; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px; text-indent: 0cm" class="MsoListParagraph"><span style="font-size: small"><span style="font-family: 宋体">.</span></span></p><p style="margin: 0cm 0cm 0pt; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px; text-indent: 0cm" class="MsoListParagraph"><span><span style="font-size: small; font-family: Calibri">.&nbsp;</span></span></p><p style="margin: 0cm 0cm 0pt 18pt; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px; text-indent: -18pt" class="MsoListParagraph"><span style="font-size: medium"><strong><span>1．<span style="line-height: normal; font-weight: normal; font-family: 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></strong><strong><span>reProjectImageTo3D</span>&nbsp;</strong><strong><span style="font-family: 宋体">是怎样计算出三维坐标数据的？</span></strong></span></p><p style="margin: 0cm 0cm 0pt 18pt; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px; text-indent: -18pt" class="MsoListParagraph"></p><p style="margin: 0cm 0cm 0pt; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px; text-indent: 0cm" class="MsoListParagraph">&nbsp;</p><p style="margin: 0cm 0cm 0pt; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px; text-indent: 0cm" class="MsoListParagraph"><span style="font-size: small"><span style="font-family: 宋体"><img style="border: none; max-width: 100%" src="http://hi.csdn.net/attachment/201010/27/0_1288219953ER8q.gif" border="0" /></span></span></p><p style="margin: 0cm 0cm 0pt; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px; text-indent: 0cm" class="MsoListParagraph"><span style="font-size: small"><span style="font-family: 宋体">图</span>&nbsp;<span><span style="font-family: Calibri">22</span></span></span></p><p style="margin: 0cm 0cm 0pt; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px; text-indent: 0cm" class="MsoListParagraph"><span style="font-size: small"><span><span style="font-family: Calibri">.</span></span></span></p><p style="margin: 0cm 0cm 0pt; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px; text-indent: 0cm" class="MsoListParagraph">&nbsp;</p><p style="margin: 0cm 0cm 0pt; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px; text-indent: 0cm" class="MsoListParagraph"><span style="font-size: small"><span style="font-family: 宋体">相信看过</span>&nbsp;<span><span style="font-family: Calibri">OpenCV</span>&nbsp;</span><span style="font-family: 宋体">第</span>&nbsp;<span><span style="font-family: Calibri">12</span>&nbsp;</span><span style="font-family: 宋体">章的朋友对上图中的</span>&nbsp;<span><span style="font-family: Calibri">Q</span>&nbsp;</span><span style="font-family: 宋体">矩阵不会陌生，根据以上变换公式，按理说</span>&nbsp;<span><span style="font-family: Calibri">OpenCV</span>&nbsp;</span><span style="font-family: 宋体">应该也是通过矩阵运算的方式来计算出三维坐标数据的，但实际上仔细查看源代码，会发现</span>&nbsp;<span><span style="font-family: Calibri">cvReprojectImageTo3D</span>&nbsp;</span><span style="font-family: 宋体">用了比较奇怪的方法来实现，主要代码如下：</span></span></p><p style="margin: 0cm 0cm 0pt; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px; text-indent: 0cm" class="MsoListParagraph">&nbsp;</p><p style="margin: 0cm 0cm 0pt; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px; text-indent: 0cm" class="MsoListParagraph"><span style="font-size: small"><span></span></span></p><div class="dp-highlighter bg_cpp" style="font-family: Consolas, 'Courier New', Courier, mono, serif; width: 936.531px; overflow-y: hidden; overflow-x: auto; padding-top: 1px; position: relative; margin: 18px 0px !important; background-color: #e7e5dc"><div class="bar" style="padding-left: 45px"><div class="tools" style="padding: 3px 8px 10px 10px; font-stretch: normal; font-size: 9px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; color: silver; border-left-width: 3px; border-left-style: solid; border-left-color: #6ce26c; background-color: #f8f8f8"><strong>[cpp]</strong>&nbsp;<a style="color: #a0a0a0; text-decoration: none; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; display: inline-block; width: 16px; height: 16px; text-indent: -2000px; background-image: url('http://static.blog.csdn.net/scripts/SyntaxHighlighter/styles/images/default/ico_plain.gif'); background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat" href="http://blog.csdn.net/chenyusiyuan/article/details/5970799#" title="view plain" class="ViewSource">view plain</a><span>&nbsp;<a style="color: #a0a0a0; text-decoration: none; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; display: inline-block; width: 16px; height: 16px; text-indent: -2000px; background-image: url('http://static.blog.csdn.net/scripts/SyntaxHighlighter/styles/images/default/ico_copy.gif'); background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat" href="http://blog.csdn.net/chenyusiyuan/article/details/5970799#" title="copy" class="CopyToClipboard">copy</a></span></div></div><ol class="dp-cpp" style="padding: 0px; border: none; color: #5c5c5c; margin: 0px 0px 1px 45px !important; background-color: #ffffff"><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">02737&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">for</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">(&nbsp;y&nbsp;=&nbsp;0;&nbsp;y&nbsp;&lt;&nbsp;rows;&nbsp;y++&nbsp;)&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">02738&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#123;&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">02739&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">const</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #2e8b57; background-color: inherit" class="datatypes">float</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">*&nbsp;sptr&nbsp;=&nbsp;(</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">const</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #2e8b57; background-color: inherit" class="datatypes">float</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">*)(src-&gt;data.ptr&nbsp;+&nbsp;src-&gt;step*y);&nbsp;&nbsp;&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">//&nbsp;视差矩阵指针</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">02740&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #2e8b57; background-color: inherit" class="datatypes">float</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">*&nbsp;dptr0&nbsp;=&nbsp;(</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #2e8b57; background-color: inherit" class="datatypes">float</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">*)(dst-&gt;data.ptr&nbsp;+&nbsp;dst-&gt;step*y),&nbsp;*dptr&nbsp;=&nbsp;dptr0;&nbsp;&nbsp;&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">//&nbsp;三维坐标矩阵指针</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">//&nbsp;每一行运算开始时，用&nbsp;当前行号y&nbsp;乘以Q阵第2列、再加上Q阵第4列，作为初始值</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">//&nbsp;记&nbsp;qq=[qx,&nbsp;qy,&nbsp;qz,&nbsp;qw]&rsquo;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">02741&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #2e8b57; background-color: inherit" class="datatypes">double</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;qx&nbsp;=&nbsp;q[0][1]*y&nbsp;+&nbsp;q[0][3],&nbsp;qy&nbsp;=&nbsp;q[1][1]*y&nbsp;+&nbsp;q[1][3];&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">02742&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #2e8b57; background-color: inherit" class="datatypes">double</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;qz&nbsp;=&nbsp;q[2][1]*y&nbsp;+&nbsp;q[2][3],&nbsp;qw&nbsp;=&nbsp;q[3][1]*y&nbsp;+&nbsp;q[3][3];&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&hellip;&nbsp;&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">//&nbsp;每算完一个像素的三维坐标，向量qq&nbsp;累加一次q阵第1列</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">//&nbsp;即：qq&nbsp;=&nbsp;qq&nbsp;+&nbsp;q(:,1)</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">02769&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">for</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">(&nbsp;x&nbsp;=&nbsp;0;&nbsp;x&nbsp;&lt;&nbsp;cols;&nbsp;x++,&nbsp;qx&nbsp;+=&nbsp;q[0][0],&nbsp;qy&nbsp;+=&nbsp;q[1][0],&nbsp;qz&nbsp;+=&nbsp;q[2][0],&nbsp;qw&nbsp;+=&nbsp;q[3][0]&nbsp;)&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">02770&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#123;&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">02771&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #2e8b57; background-color: inherit" class="datatypes">double</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;d&nbsp;=&nbsp;sptr[x];&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">//&nbsp;计算当前像素三维坐标</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">//&nbsp;将向量qq&nbsp;加上&nbsp;Q阵第3列与当前像素视差d的乘积，用所得结果的第4元素除前三位元素即可</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">//&nbsp;[X,Y,Z,W]&rsquo;&nbsp;=&nbsp;qq&nbsp;+&nbsp;q(:,3)&nbsp;*&nbsp;d;&nbsp;&nbsp;&nbsp;iW&nbsp;=&nbsp;1/W;&nbsp;X=X*iW;&nbsp;Y=Y*iW;&nbsp;Z=Z*iW;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">02772&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #2e8b57; background-color: inherit" class="datatypes">double</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;iW&nbsp;=&nbsp;1./(qw&nbsp;+&nbsp;q[3][2]*d);&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">02773&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #2e8b57; background-color: inherit" class="datatypes">double</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;X&nbsp;=&nbsp;(qx&nbsp;+&nbsp;q[0][2]*d)*iW;&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">02774&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #2e8b57; background-color: inherit" class="datatypes">double</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;Y&nbsp;=&nbsp;(qy&nbsp;+&nbsp;q[1][2]*d)*iW;&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">02775&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #2e8b57; background-color: inherit" class="datatypes">double</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;Z&nbsp;=&nbsp;(qz&nbsp;+&nbsp;q[2][2]*d)*iW;&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">02776&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">if</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">(&nbsp;fabs(d-minDisparity)&nbsp;&lt;=&nbsp;FLT_EPSILON&nbsp;)&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">02777&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Z&nbsp;=&nbsp;bigZ;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">//&nbsp;02713&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;double&nbsp;bigZ&nbsp;=&nbsp;10000.;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">02778&nbsp;&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">02779&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dptr[x*3]&nbsp;=&nbsp;(<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #2e8b57; background-color: inherit" class="datatypes">float</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">)X;&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">02780&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dptr[x*3+1]&nbsp;=&nbsp;(<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #2e8b57; background-color: inherit" class="datatypes">float</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">)Y;&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">02781&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dptr[x*3+2]&nbsp;=&nbsp;(<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #2e8b57; background-color: inherit" class="datatypes">float</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">)Z;&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">02782&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125;&nbsp;&nbsp;</span></li></ol></div><p>&nbsp;</p><p style="margin: 0cm 0cm 0pt; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px; text-indent: 0cm" class="MsoListParagraph">&nbsp;</p><p style="margin: 0cm 0cm 0pt; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px; text-indent: 0cm" class="MsoListParagraph"><span style="font-size: small"><span><span style="font-family: Calibri">OpenCV</span>&nbsp;</span><span style="font-family: 宋体">的这种计算方式比较令人费解，我的理解是可能这种方式的计算速度比较快。理论上，直接通过矩阵</span>&nbsp;<span><span style="font-family: Calibri">Q</span>&nbsp;</span><span style="font-family: 宋体">与向量</span>&nbsp;<span><span style="font-family: Calibri">[x,y,d,1]&rsquo;</span>&nbsp;</span><span style="font-family: 宋体">的乘积就可以得到相同的结果，下面用</span>&nbsp;<span><span style="font-family: Calibri">Matlab</span>&nbsp;</span><span style="font-family: 宋体">来验证一下两种方式是异曲同工的，用</span>&nbsp;<span><span style="font-family: Calibri">Matlab</span>&nbsp;</span><span style="font-family: 宋体">按照</span>&nbsp;<span><span style="font-family: Calibri">OpenCV</span>&nbsp;</span><span style="font-family: 宋体">计算方式得到的结果称为&ldquo;</span>&nbsp;<span><span style="font-family: Calibri">OpenCV method</span>&nbsp;</span><span style="font-family: 宋体">&rdquo;，直接按公式计算得到的结果称为&ldquo;</span>&nbsp;<span><span style="font-family: Calibri">Equation method</span>&nbsp;</span><span style="font-family: 宋体">&rdquo;，用</span>&nbsp;<span><span style="font-family: Calibri">OpenCV</span>&nbsp;</span><span style="font-family: 宋体">本身算出的三维坐标作为参考，程序代码如下&nbsp;：</span>&nbsp;</span><span><span style="font-size: small; font-family: Calibri">&nbsp;</span></span></p><p style="margin: 0cm 0cm 0pt; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px; text-indent: 0cm" class="MsoListParagraph">&nbsp;</p><p style="margin: 0cm 0cm 0pt; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px; text-indent: 0cm" class="MsoListParagraph">&nbsp;</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: small"></span></p><div class="dp-highlighter bg_c-sharp" style="font-family: Consolas, 'Courier New', Courier, mono, serif; width: 936.531px; overflow-y: hidden; overflow-x: auto; padding-top: 1px; position: relative; margin: 18px 0px !important; background-color: #e7e5dc"><div class="bar" style="padding-left: 45px"><div class="tools" style="padding: 3px 8px 10px 10px; font-stretch: normal; font-size: 9px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; color: silver; border-left-width: 3px; border-left-style: solid; border-left-color: #6ce26c; background-color: #f8f8f8"><strong>[c-sharp]</strong>&nbsp;<a style="color: #a0a0a0; text-decoration: none; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; display: inline-block; width: 16px; height: 16px; text-indent: -2000px; background-image: url('http://static.blog.csdn.net/scripts/SyntaxHighlighter/styles/images/default/ico_plain.gif'); background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat" href="http://blog.csdn.net/chenyusiyuan/article/details/5970799#" title="view plain" class="ViewSource">view plain</a><span>&nbsp;<a style="color: #a0a0a0; text-decoration: none; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; display: inline-block; width: 16px; height: 16px; text-indent: -2000px; background-image: url('http://static.blog.csdn.net/scripts/SyntaxHighlighter/styles/images/default/ico_copy.gif'); background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat" href="http://blog.csdn.net/chenyusiyuan/article/details/5970799#" title="copy" class="CopyToClipboard">copy</a></span></div></div><ol class="dp-c" style="padding: 0px; border: none; color: #5c5c5c; margin: 0px 0px 1px 45px !important; background-color: #ffffff"><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">close&nbsp;all;clear&nbsp;all;clc&nbsp;&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">im&nbsp;=&nbsp;imread(<span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">'C:/Stereo&nbsp;IO&nbsp;Data/lfFrame_01.jpg'</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">);&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">data&nbsp;=&nbsp;importdata(<span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">'C:/Stereo&nbsp;IO&nbsp;Data/disparity_01.txt'</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">);&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">r&nbsp;=&nbsp;data(1);&nbsp;&nbsp;&nbsp;&nbsp;%&nbsp;行数&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">c&nbsp;=&nbsp;data(2);&nbsp;&nbsp;&nbsp;&nbsp;%&nbsp;列数&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">disp&nbsp;=&nbsp;data(3:end);&nbsp;%&nbsp;视差&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">vmin&nbsp;=&nbsp;min(disp);&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">vmax&nbsp;=&nbsp;max(disp);&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">disp&nbsp;=&nbsp;reshape(disp,&nbsp;[c,r])';&nbsp;%&nbsp;将列向量形式的&nbsp;disp&nbsp;重构为&nbsp;矩阵形式&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">%&nbsp;&nbsp;OpenCV&nbsp;是行扫描存储图像，Matlab&nbsp;是列扫描存储图像&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">%&nbsp;&nbsp;故对&nbsp;disp&nbsp;的重新排列是首先变成&nbsp;c&nbsp;行&nbsp;r&nbsp;列的矩阵，然后再转置回&nbsp;r&nbsp;行&nbsp;c&nbsp;列&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">img&nbsp;=&nbsp;uint8(&nbsp;255&nbsp;*&nbsp;(&nbsp;disp&nbsp;-&nbsp;vmin&nbsp;)&nbsp;/&nbsp;(&nbsp;vmax&nbsp;-&nbsp;vmin&nbsp;)&nbsp;);&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">q&nbsp;=&nbsp;[1.&nbsp;0.&nbsp;0.&nbsp;-1.5690376663208008e+002;...&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;0.&nbsp;1.&nbsp;0.&nbsp;-1.4282237243652344e+002;...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;0.&nbsp;0.&nbsp;0.&nbsp;5.2004731331639300e+002;...&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;0.&nbsp;0.&nbsp;1.0945105843175637e-002&nbsp;0.];&nbsp;%&nbsp;q(4,3)&nbsp;原为负值，现修正为正值&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">big_z&nbsp;=&nbsp;1e5;&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">pos1&nbsp;=&nbsp;zeros(r,c,3);&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">pos2&nbsp;=&nbsp;zeros(r,c,3);&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">for</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;i&nbsp;=&nbsp;1:r&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;qq&nbsp;=&nbsp;q*[0&nbsp;i&nbsp;0&nbsp;1]';&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">for</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;j&nbsp;=&nbsp;1:c&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">if</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;disp(i,j)&gt;0&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%&nbsp;OpenCV&nbsp;method&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vec&nbsp;=&nbsp;qq&nbsp;+&nbsp;q(:,3)*disp(i,j);&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vec&nbsp;=&nbsp;vec/vec(4);&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pos1(i,j,:)&nbsp;=&nbsp;vec(1:3);&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%&nbsp;Textbook&nbsp;method&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tmp&nbsp;=&nbsp;q*[j,i,disp(i,j),1]';&nbsp;%&nbsp;j&nbsp;是列数，i&nbsp;是行数，分别对应公式中的&nbsp;x&nbsp;和&nbsp;y&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pos2(i,j,:)&nbsp;=&nbsp;tmp(1:3)/tmp(4);&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">else</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pos1(i,j,3)&nbsp;=&nbsp;big_z;&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pos2(i,j,3)&nbsp;=&nbsp;big_z;&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;qq&nbsp;=&nbsp;qq&nbsp;+&nbsp;q(:,1);&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;end&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">end&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">subplot(221);&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">imshow(im);&nbsp;title(<span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">'Left&nbsp;Frame'</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">);&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">subplot(222);&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">imshow(img);&nbsp;title(<span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">'Disparity&nbsp;map'</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">);&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">%&nbsp;Matlab按OpenCV计算方式得到的三维坐标&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">x&nbsp;=&nbsp;pos1(:,:,1);&nbsp;&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">y&nbsp;=&nbsp;-pos1(:,:,2);&nbsp;&nbsp;%&nbsp;图像坐标系Y轴是向下为正方向，因此需添加负号来修正&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">z&nbsp;=&nbsp;pos1(:,:,3);&nbsp;&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">ind&nbsp;=&nbsp;find(z&gt;10000);&nbsp;&nbsp;%&nbsp;以毫米为量纲&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">x(ind)=NaN;&nbsp;y(ind)=NaN;&nbsp;z(ind)=NaN;&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">subplot(234);&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">mesh(x,z,y,<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">double</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">(im),</span><span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">'FaceColor'</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">,</span><span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">'texturemap'</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">);&nbsp;&nbsp;%&nbsp;Matlab&nbsp;的&nbsp;mesh、surf&nbsp;函数支持纹理映射&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">colormap(gray);&nbsp;&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">axis&nbsp;equal;&nbsp;&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">axis([-1000&nbsp;1000&nbsp;0&nbsp;9000&nbsp;-500&nbsp;2000]);&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">xlabel(<span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">'Horizonal'</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">);ylabel(</span><span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">'Depth'</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">);zlabel(</span><span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">'Vertical'</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">);&nbsp;title(</span><span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">'OpenCV&nbsp;method'</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">);&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">view([0&nbsp;0]);&nbsp;&nbsp;%&nbsp;正视图&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">%&nbsp;view([0&nbsp;90]);&nbsp;&nbsp;&nbsp;%&nbsp;俯视图&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">%&nbsp;view([90&nbsp;0]);&nbsp;&nbsp;&nbsp;%&nbsp;侧视图&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">%&nbsp;Matlab&nbsp;按公式直接计算得到的三维坐标&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">x&nbsp;=&nbsp;pos2(:,:,1);&nbsp;&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">y&nbsp;=&nbsp;-pos2(:,:,2);&nbsp;&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">z&nbsp;=&nbsp;pos2(:,:,3);&nbsp;&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">ind&nbsp;=&nbsp;find(z&gt;10000);&nbsp;&nbsp;%&nbsp;以毫米为量纲&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">x(ind)=NaN;&nbsp;y(ind)=NaN;&nbsp;z(ind)=NaN;&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">subplot(235);&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">mesh(x,z,y,<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">double</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">(im),</span><span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">'FaceColor'</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">,</span><span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">'texturemap'</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">);&nbsp;&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">colormap(gray);&nbsp;&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">axis&nbsp;equal;&nbsp;&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">axis([-1000&nbsp;1000&nbsp;0&nbsp;9000&nbsp;-500&nbsp;2000]);&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">xlabel(<span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">'Horizonal'</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">);ylabel(</span><span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">'Depth'</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">);zlabel(</span><span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">'Vertical'</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">);&nbsp;title(</span><span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">'Equation&nbsp;method'</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">);&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">view([0&nbsp;0]);&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">%&nbsp;读入OpenCV计算保存到本地的三维坐标作为参考&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">data=importdata(<span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">'C:/Stereo&nbsp;IO&nbsp;Data/xyz.txt'</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">);&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">x=data(:,1);&nbsp;y=data(:,2);&nbsp;z=data(:,3);&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">ind=find(z&gt;1000);&nbsp;&nbsp;%&nbsp;以厘米为量纲&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">x(ind)=NaN;&nbsp;y(ind)=NaN;&nbsp;z(ind)=NaN;&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">x=reshape(x,[352&nbsp;288])';&nbsp;%&nbsp;数据写入时是逐行进行的，而Matlab是逐列读取&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">y=-reshape(y,[352&nbsp;288])';&nbsp;&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">z=reshape(z,[352&nbsp;288])';&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">subplot(236)&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">mesh(x,z,&nbsp;y,<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">double</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">(im),</span><span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">'FaceColor'</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">,</span><span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">'texturemap'</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">);&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">colormap(gray);&nbsp;&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">axis&nbsp;equal;axis([-100&nbsp;100&nbsp;0&nbsp;900&nbsp;-50&nbsp;200]);&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">xlabel(<span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">'Horizonal'</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">);ylabel(</span><span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">'Depth'</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">);zlabel(</span><span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">'Vertical'</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">);&nbsp;title(</span><span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">'OpenCV&nbsp;result'</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">);&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">view([0&nbsp;0]);&nbsp;&nbsp;</span></li></ol></div><p>&nbsp;</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">&nbsp;</p><p style="margin: 0cm 0cm 0pt; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px; text-indent: 0cm" class="MsoListParagraph">&nbsp;</p><p style="margin: 0cm 0cm 0pt; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px; text-indent: 0cm" class="MsoListParagraph"><span style="font-size: small"><span style="font-family: 宋体"><img style="border: none; max-width: 100%" src="http://hi.csdn.net/attachment/201010/27/0_1288219959ByRr.gif" border="0" /></span></span></p><p style="margin: 0cm 0cm 0pt; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px; text-indent: 0cm" class="MsoListParagraph"><span style="font-size: small"><span style="font-family: 宋体">图</span>&nbsp;<span><span style="font-family: Calibri">23</span></span></span></p><p style="margin: 0cm 0cm 0pt; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px; text-indent: 0cm" class="MsoListParagraph"><span><span style="font-size: small; font-family: Calibri">.</span></span></p><p style="margin: 0cm 0cm 0pt; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px; text-indent: 0cm" class="MsoListParagraph"><span><span style="font-size: small; font-family: Calibri">.</span>&nbsp;&nbsp;</span></p><p style="margin: 0cm 0cm 0pt 18pt; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px; text-indent: -18pt" class="MsoListParagraph"><span style="font-size: medium"><strong><span>2．<span style="line-height: normal; font-weight: normal; font-family: 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></strong><strong><span style="font-family: 宋体">为什么利用修正了的</span>&nbsp;</strong><strong><span>Q</span>&nbsp;</strong><strong><span style="font-family: 宋体">矩阵所计算得到的三维数据中，</span>&nbsp;</strong><strong><span>Y</span>&nbsp;</strong><strong><span style="font-family: 宋体">坐标数据是正负颠倒的？</span></strong></span></p><p style="margin: 0cm 0cm 0pt; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px; text-indent: 0cm" class="MsoListParagraph">&nbsp;</p><p style="margin: 0cm 0cm 0pt; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px; text-indent: 0cm" class="MsoListParagraph">&nbsp;</p><p style="margin: 0cm 0cm 0pt; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px; text-indent: 0cm" class="MsoListParagraph"><span style="font-size: small"><span style="font-family: 宋体"><img style="border: none; max-width: 100%" src="http://hi.csdn.net/attachment/201010/27/0_1288219968OsQ2.gif" border="0" /></span></span></p><p style="margin: 0cm 0cm 0pt; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px; text-indent: 0cm" class="MsoListParagraph"><span style="font-size: small"><span style="font-family: 宋体">图</span>&nbsp;<span><span style="font-family: Calibri">24</span></span></span></p><p style="margin: 0cm 0cm 0pt; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px; text-indent: 0cm" class="MsoListParagraph"><span style="font-size: small"><span><span style="font-family: Calibri">.</span></span></span></p><p style="margin: 0cm 0cm 0pt; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px; text-indent: 0cm" class="MsoListParagraph">&nbsp;</p><p style="margin: 0cm 0cm 0pt; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px; text-indent: 0cm" class="MsoListParagraph"><span style="font-size: small"><span style="font-family: 宋体">这个问题我觉得可以从图像坐标系与摄像机坐标系的关系这一角度来解释。如上图所示，<strong><span style="color: red">一般图像坐标系和摄像机坐标系都是以从左至右为</span>&nbsp;</strong></span><strong><span style="color: red"><span style="font-family: Calibri">X</span>&nbsp;</span></strong><strong><span style="font-family: 宋体; color: red">轴正方向，从上至下为</span>&nbsp;<span style="color: red"><span style="font-family: Calibri">Y</span>&nbsp;</span></strong><strong><span style="font-family: 宋体; color: red">轴正方向</span>&nbsp;</strong><span style="font-family: 宋体">，摄像机坐标系的</span>&nbsp;<span><span style="font-family: Calibri">Z</span>&nbsp;</span><span style="font-family: 宋体">轴正方向则是从光心到成像平面的垂线方向。因此，我们得到的三维坐标数据中</span>&nbsp;<span><span style="font-family: Calibri">Y</span>&nbsp;</span><span style="font-family: 宋体">轴数据的正负与实际是相反的，在<strong><span style="color: red">应用时要添加负号来修正。</span></strong></span></span></p><p style="margin: 0cm 0cm 0pt; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px; text-indent: 0cm" class="MsoListParagraph"><span style="font-size: small"><span style="font-family: 宋体"><strong><span style="color: red">.</span></strong></span></span></p><p style="margin: 0cm 0cm 0pt; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px; text-indent: 0cm" class="MsoListParagraph"><span><span style="font-size: small; font-family: Calibri">.&nbsp;</span></span></p><p style="margin: 0cm 0cm 0pt 18pt; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px; text-indent: -18pt" class="MsoListParagraph"><span style="font-size: medium"><strong><span>3．<span style="line-height: normal; font-weight: normal; font-family: 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></strong><strong><span style="font-family: 宋体">如何画出三维重建图像和景深图像？</span></strong></span></p><p style="margin: 0cm 0cm 0pt; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px; text-indent: 0cm" class="MsoListParagraph">&nbsp;</p><p style="margin: 0cm 0cm 0pt; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px; text-indent: 0cm" class="MsoListParagraph"><span style="font-size: small"><span style="font-family: 宋体">.</span></span></p><p style="margin: 0cm 0cm 0pt; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px; text-indent: 0cm" class="MsoListParagraph"><span style="font-size: small"><span style="font-family: 宋体">利用</span>&nbsp;<span><span style="font-family: Calibri">cvReprojectImageTo3D</span>&nbsp;</span><span style="font-family: 宋体">计算出的三维坐标数据矩阵一般是三通道浮点型的，需要注意的是这个矩阵存储的是三维坐标数据，而不是</span>&nbsp;<span><span style="font-family: Calibri">RGB</span>&nbsp;</span><span style="font-family: 宋体">颜色值，所以是不能调用</span><span><span style="font-family: Calibri">cvShowImage()</span>&nbsp;</span><span style="font-family: 宋体">或者</span>&nbsp;<span><span style="font-family: Calibri">OpenCV2.1</span>&nbsp;</span><span style="font-family: 宋体">版的</span>&nbsp;<span><span style="font-family: Calibri">imshow()</span>&nbsp;</span><span style="font-family: 宋体">等函数来显示这个矩阵，否则就会看到这种图像：</span></span></p><p style="margin: 0cm 0cm 0pt; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px; text-indent: 0cm" class="MsoListParagraph"><span style="font-size: small"><span style="font-family: 宋体">.</span></span></p><p style="margin: 0cm 0cm 0pt; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px; text-indent: 0cm" class="MsoListParagraph"><span></span></p><p style="margin: 0cm 0cm 0pt; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px; text-indent: 0cm" class="MsoListParagraph">&nbsp;</p><p style="margin: 0cm 0cm 0pt; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px; text-indent: 0cm" class="MsoListParagraph"><span style="font-size: small"><span style="font-family: 宋体"><img style="border: none; max-width: 100%" src="http://hi.csdn.net/attachment/201010/27/0_1288219976Sl33.gif" border="0" /></span></span></p><p style="margin: 0cm 0cm 0pt; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px; text-indent: 0cm" class="MsoListParagraph"><span style="font-size: small"><span style="font-family: 宋体">图</span>&nbsp;<span><span style="font-family: Calibri">25</span></span></span></p><p style="margin: 0cm 0cm 0pt; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px; text-indent: 0cm" class="MsoListParagraph"><span style="font-size: small"><span><span style="font-family: Calibri">.</span></span></span></p><p style="margin: 0cm 0cm 0pt; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px; text-indent: 0cm" class="MsoListParagraph">&nbsp;</p><p style="margin: 0cm 0cm 0pt; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px; text-indent: 0cm" class="MsoListParagraph"><span style="font-size: small"><span style="font-family: 宋体">这里出现的明显的四个色块，其实应该是由三维坐标数据中的</span>&nbsp;<span><span style="font-family: Calibri">X</span>&nbsp;</span><span style="font-family: 宋体">轴和</span>&nbsp;<span><span style="font-family: Calibri">Y</span>&nbsp;</span><span style="font-family: 宋体">轴数据造成，不同象限的数据形成相应的色块。</span></span></p><p style="margin: 0cm 0cm 0pt; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px; text-indent: 0cm" class="MsoListParagraph"><span style="font-size: small"><span style="font-family: 宋体">要画出正确的三维重建图像，可以结合</span>&nbsp;<span><span style="font-family: Calibri">OpenGL</span>&nbsp;</span><span style="font-family: 宋体">（可参考我的</span>&nbsp;<span><a style="color: #ff9900; text-decoration: none" href="http://blog.csdn.net/chenyusiyuan/archive/2010/06/24/5691481.aspx"><span style="font-family: 宋体"><span>学习笔记（</span>&nbsp;</span><span style="font-family: Calibri">15</span>&nbsp;<span style="font-family: 宋体"><span>）</span>&nbsp;</span></a></span><span style="font-family: 宋体">）或者</span>&nbsp;<span><span style="font-family: Calibri">Matlab</span>&nbsp;</span><span style="font-family: 宋体">（例如保存三维数据到本地然后用</span>&nbsp;<span><span style="font-family: Calibri">Matlab</span>&nbsp;</span><span style="font-family: 宋体">的</span>&nbsp;<span><span style="font-family: Calibri">mesh</span>&nbsp;</span><span style="font-family: 宋体">函数画出，例程见本文问题</span>&nbsp;<span><span style="font-family: Calibri">1</span>&nbsp;</span><span style="font-family: 宋体">；也可以考虑在</span>&nbsp;<span><span style="font-family: Calibri">OpenCV</span>&nbsp;</span><span style="font-family: 宋体">中调用</span>&nbsp;<span><span style="font-family: Calibri">Matlab</span>&nbsp;</span><span style="font-family: 宋体">混合编程）来实现。</span></span></p><p style="margin: 0cm 0cm 0pt; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px; text-indent: 0cm" class="MsoListParagraph"><span style="font-size: small"><span style="font-family: 宋体">深度图像的显示相对比较简单，只要从三维坐标数据中分离出来（可用</span>&nbsp;<span><span style="font-family: Calibri">cvSplit()&nbsp;</span></span><span style="font-family: 宋体">函数），经过适当的格式转换（例如转换为</span>&nbsp;<span><span style="font-family: Calibri">CV_8U</span>&nbsp;</span><span style="font-family: 宋体">格式），就可用</span>&nbsp;<span><span style="font-family: Calibri">cvShowImage()&nbsp;</span></span><span style="font-family: 宋体">或者</span>&nbsp;<span><span style="font-family: Calibri">OpenCV2.1</span>&nbsp;</span><span style="font-family: 宋体">版的</span>&nbsp;<span><span style="font-family: Calibri">imshow()</span>&nbsp;</span><span style="font-family: 宋体">等函数来显示了，<strong>伪彩色的深度图</strong>&nbsp;也可以参考我的</span>&nbsp;<span><a style="color: #ff9900; text-decoration: none" href="http://blog.csdn.net/chenyusiyuan/archive/2010/10/26/5967291.aspx"><span style="font-family: 宋体"><span>学习笔记（</span>&nbsp;</span><span style="font-family: Calibri">18</span>&nbsp;<span style="font-family: 宋体"><span>）</span>&nbsp;</span></a></span><strong><span style="font-family: 宋体">问题</span>&nbsp;<span><span style="font-family: Calibri">6</span>&nbsp;</span></strong><strong><span style="font-family: 宋体">给出的例程</span>&nbsp;</strong><span style="font-family: 宋体">稍作修改即可实现。</span></span></p><p style="margin: 0cm 0cm 0pt; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px; text-indent: 0cm" class="MsoListParagraph"><span style="font-size: small"><span style="font-family: 宋体">.</span></span></p><p style="margin: 0cm 0cm 0pt; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px; text-indent: 0cm" class="MsoListParagraph"><strong><span style="color: red"><span style="font-size: small; font-family: Calibri">.&nbsp;</span></span></strong></p><p style="margin: 0cm 0cm 0pt 18pt; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px; text-indent: -18pt" class="MsoListParagraph"><span style="font-size: medium"><strong><span>4．<span style="line-height: normal; font-weight: normal; font-family: 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></strong><strong><span style="font-family: 宋体">怎样把</span>&nbsp;</strong><strong><span>OpenGL</span>&nbsp;</strong><strong><span style="font-family: 宋体">窗口的图像复制到</span>&nbsp;</strong><strong><span>OpenCV</span>&nbsp;</strong><strong><span style="font-family: 宋体">中用</span>&nbsp;</strong><strong><span>IplImage</span>&nbsp;</strong><strong><span style="font-family: 宋体">格式显示和保存？</span></strong></span></p><p style="margin: 0cm 0cm 0pt; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px" class="MsoNormal">&nbsp;</p><p style="margin: 0cm 0cm 0pt; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px" class="MsoNormal"><span style="font-size: small"><span style="font-family: 宋体">.</span></span></p><p style="margin: 0cm 0cm 0pt; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px" class="MsoNormal"><span style="font-size: small"><span style="font-family: 宋体">在</span>&nbsp;<span><a style="color: #ff9900; text-decoration: none" href="http://blog.csdn.net/chenyusiyuan/archive/2010/06/24/5691481.aspx"><span style="font-family: 宋体"><span>学习笔记（</span>&nbsp;</span><span style="font-family: Calibri">15</span>&nbsp;<span style="font-family: 宋体"><span>）</span>&nbsp;</span></a></span><span style="font-family: 宋体">中详细给出了将</span>&nbsp;<span><span style="font-family: Calibri">OpenCV</span>&nbsp;</span><span style="font-family: 宋体">生成的</span>&nbsp;<span><span style="font-family: Calibri">IplImage</span>&nbsp;</span><span style="font-family: 宋体">图像和三维坐标数据复制到</span>&nbsp;<span><span style="font-family: Calibri">OpenGL</span>&nbsp;</span><span style="font-family: 宋体">中显示的例程，而在应用中，我们有时候也需要把</span>&nbsp;<span><span style="font-family: Calibri">OpenGL</span>&nbsp;</span><span style="font-family: 宋体">实时显示的三维图像复制到</span>&nbsp;<span><span style="font-family: Calibri">OpenCV</span>&nbsp;</span><span style="font-family: 宋体">中，用</span>&nbsp;<span><span style="font-family: Calibri">IplImage</span>&nbsp;</span><span style="font-family: 宋体">格式保存，以便和其它图像组合起来显示或保存为视频文件。这里给出相应的例程以供参考：</span></span></p><p style="margin: 0cm 0cm 0pt; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px" class="MsoNormal"><span style="font-size: small"><span style="font-family: 宋体">首先在创建</span>&nbsp;<span><span style="font-family: Calibri">OpenGL</span>&nbsp;</span><span style="font-family: 宋体">窗口时，显示模式要如下设置：</span></span></p><p style="margin: 0cm 0cm 0pt; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px" class="MsoNormal"><span><span style="font-size: small; font-family: Calibri">&nbsp;</span></span></p><p style="margin: 0cm 0cm 0pt; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px" class="MsoNormal"><span></span></p><div class="dp-highlighter bg_c-sharp" style="font-family: Consolas, 'Courier New', Courier, mono, serif; width: 936.531px; overflow-y: hidden; overflow-x: auto; padding-top: 1px; position: relative; margin: 18px 0px !important; background-color: #e7e5dc"><div class="bar" style="padding-left: 45px"><div class="tools" style="padding: 3px 8px 10px 10px; font-stretch: normal; font-size: 9px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; color: silver; border-left-width: 3px; border-left-style: solid; border-left-color: #6ce26c; background-color: #f8f8f8"><strong>[c-sharp]</strong>&nbsp;<a style="color: #a0a0a0; text-decoration: none; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; display: inline-block; width: 16px; height: 16px; text-indent: -2000px; background-image: url('http://static.blog.csdn.net/scripts/SyntaxHighlighter/styles/images/default/ico_plain.gif'); background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat" href="http://blog.csdn.net/chenyusiyuan/article/details/5970799#" title="view plain" class="ViewSource">view plain</a><span>&nbsp;<a style="color: #a0a0a0; text-decoration: none; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; display: inline-block; width: 16px; height: 16px; text-indent: -2000px; background-image: url('http://static.blog.csdn.net/scripts/SyntaxHighlighter/styles/images/default/ico_copy.gif'); background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat" href="http://blog.csdn.net/chenyusiyuan/article/details/5970799#" title="copy" class="CopyToClipboard">copy</a></span></div></div><ol class="dp-c" style="padding: 0px; border: none; color: #5c5c5c; margin: 0px 0px 1px 45px !important; background-color: #ffffff"><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">//***OpenGL&nbsp;Window</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">glutInit(&amp;argc,&nbsp;argv);&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">glutInitDisplayMode(GLUT_DEPTH&nbsp;&#124;&nbsp;GLUT_DOUBLE&nbsp;&#124;&nbsp;GLUT_RGB);&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">glutInitWindowPosition(10,420);&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">glutInitWindowSize(glWinWidth,&nbsp;glWinHeight);&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">glutCreateWindow(<span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">&quot;3D&nbsp;disparity&nbsp;image&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">);&nbsp;&nbsp;</span></span></li></ol></div><p>&nbsp;</p><p style="margin: 0cm 0cm 0pt; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px" class="MsoNormal"><span>&nbsp;</span></p><p style="margin: 0cm 0cm 0pt; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px" class="MsoNormal"><span style="font-family: 宋体"><span style="font-size: small">在循环中的调用：</span></span></p><p style="margin: 0cm 0cm 0pt; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px" class="MsoNormal"><span><span style="font-size: small; font-family: Calibri">&nbsp;</span></span></p><p style="margin: 0cm 0cm 0pt; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px" class="MsoNormal"><span><span style="font-family: Calibri"></span></span></p><div class="dp-highlighter bg_c-sharp" style="font-family: Consolas, 'Courier New', Courier, mono, serif; width: 936.531px; overflow-y: hidden; overflow-x: auto; padding-top: 1px; position: relative; margin: 18px 0px !important; background-color: #e7e5dc"><div class="bar" style="padding-left: 45px"><div class="tools" style="padding: 3px 8px 10px 10px; font-stretch: normal; font-size: 9px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; color: silver; border-left-width: 3px; border-left-style: solid; border-left-color: #6ce26c; background-color: #f8f8f8"><strong>[c-sharp]</strong>&nbsp;<a style="color: #a0a0a0; text-decoration: none; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; display: inline-block; width: 16px; height: 16px; text-indent: -2000px; background-image: url('http://static.blog.csdn.net/scripts/SyntaxHighlighter/styles/images/default/ico_plain.gif'); background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat" href="http://blog.csdn.net/chenyusiyuan/article/details/5970799#" title="view plain" class="ViewSource">view plain</a><span>&nbsp;<a style="color: #a0a0a0; text-decoration: none; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; display: inline-block; width: 16px; height: 16px; text-indent: -2000px; background-image: url('http://static.blog.csdn.net/scripts/SyntaxHighlighter/styles/images/default/ico_copy.gif'); background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat" href="http://blog.csdn.net/chenyusiyuan/article/details/5970799#" title="copy" class="CopyToClipboard">copy</a></span></div></div><ol class="dp-c" style="padding: 0px; border: none; color: #5c5c5c; margin: 0px 0px 1px 45px !important; background-color: #ffffff"><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">//////////////////////////////////////////////////////////////////////////</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">//&nbsp;OpenGL显示</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;img3dIpl&nbsp;=&nbsp;img3d;&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">load3dDataToGL(&amp;img3dIpl);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">//&nbsp;载入需要显示的图像（视差数据）</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">loadTextureToGL(&amp;img1roi);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">//&nbsp;显示纹理</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">glutReshapeFunc&nbsp;(reshape);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">//&nbsp;窗口变化时重绘图像</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">glutDisplayFunc(renderScene);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">//&nbsp;显示三维图像</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">glutPostRedisplay();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">//&nbsp;刷新画面（不用此语句则不能动态更新图像）</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">loadPixel2IplImage(imgGL);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">//&nbsp;将&nbsp;OpenGL&nbsp;生成的像素值存储到&nbsp;IplImage&nbsp;中</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li></ol></div>&nbsp;&nbsp;<p>&nbsp;</p><p style="margin: 0cm 0cm 0pt; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px" class="MsoNormal"><span><span style="font-size: small; font-family: Calibri">&nbsp;</span></span></p><p style="margin: 0cm 0cm 0pt; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px" class="MsoNormal"><span style="font-family: 宋体"><span style="font-size: small"><span style="font-family: Calibri">loadGLPixelToIplImage&nbsp;</span>函数定义：</span></span></p><p style="margin: 0cm 0cm 0pt; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px" class="MsoNormal"><span><span style="font-size: small; font-family: Calibri">&nbsp;</span></span></p><p style="margin: 0cm 0cm 0pt; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px" class="MsoNormal">&nbsp;</p><p style="margin: 0cm 0cm 0pt; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px" class="MsoNormal"><span style="font-family: 宋体"></span></p><div class="dp-highlighter bg_c-sharp" style="font-family: Consolas, 'Courier New', Courier, mono, serif; width: 936.531px; overflow-y: hidden; overflow-x: auto; padding-top: 1px; position: relative; margin: 18px 0px !important; background-color: #e7e5dc"><div class="bar" style="padding-left: 45px"><div class="tools" style="padding: 3px 8px 10px 10px; font-stretch: normal; font-size: 9px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; color: silver; border-left-width: 3px; border-left-style: solid; border-left-color: #6ce26c; background-color: #f8f8f8"><strong>[c-sharp]</strong>&nbsp;<a style="color: #a0a0a0; text-decoration: none; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; display: inline-block; width: 16px; height: 16px; text-indent: -2000px; background-image: url('http://static.blog.csdn.net/scripts/SyntaxHighlighter/styles/images/default/ico_plain.gif'); background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat" href="http://blog.csdn.net/chenyusiyuan/article/details/5970799#" title="view plain" class="ViewSource">view plain</a><span>&nbsp;<a style="color: #a0a0a0; text-decoration: none; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; display: inline-block; width: 16px; height: 16px; text-indent: -2000px; background-image: url('http://static.blog.csdn.net/scripts/SyntaxHighlighter/styles/images/default/ico_copy.gif'); background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat" href="http://blog.csdn.net/chenyusiyuan/article/details/5970799#" title="copy" class="CopyToClipboard">copy</a></span></div></div><ol class="dp-c" style="padding: 0px; border: none; color: #5c5c5c; margin: 0px 0px 1px 45px !important; background-color: #ffffff"><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">//////////////////////////////////////////////////////////////////////////</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">//&nbsp;将OpenGL窗口像素存储到&nbsp;IplImage&nbsp;中</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">void</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;loadGLPixelToIplImage(IplImage*&nbsp;img)&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&#123;&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">const</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">int</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;n&nbsp;=&nbsp;3*glWinWidth*glWinHeight;&nbsp;&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">float</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;*pixels&nbsp;=&nbsp;(</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">float</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;*)malloc(n&nbsp;*&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">sizeof</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">(GL_FLOAT));&nbsp;&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;IplImage&nbsp;*tmp&nbsp;=&nbsp;cvCreateImage(cvSize(glWinWidth,&nbsp;glWinHeight),&nbsp;8,&nbsp;3);&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;tmp-&gt;origin&nbsp;=&nbsp;CV_ORIGIN_BL;&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">/*&nbsp;后台缓存的图像数据才是我们需要复制的，若复制前台缓存会把可能的叠加在OpenGL窗口上的对象（其它窗口或者鼠标指针）也复制进去*/</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;glReadBuffer(GL_BACK);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;glReadPixels(0,&nbsp;0,&nbsp;glWinWidth,&nbsp;glWinHeight,&nbsp;GL_RGB,&nbsp;GL_FLOAT,&nbsp;pixels);&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">int</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;k&nbsp;=&nbsp;0;&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">for</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">(</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">int</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;i&nbsp;=&nbsp;0&nbsp;;&nbsp;i&nbsp;&lt;&nbsp;glWinHeight;&nbsp;i++)&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&#123;&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">for</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">(</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">int</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;j&nbsp;=&nbsp;0&nbsp;;&nbsp;j&nbsp;&lt;&nbsp;glWinWidth;&nbsp;j++,k+=3)&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#123;&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CvPoint&nbsp;pt&nbsp;=&nbsp;&#123;j,&nbsp;glWinHeight&nbsp;-&nbsp;i&nbsp;-&nbsp;1&#125;;&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uchar*&nbsp;temp_ptr&nbsp;=&nbsp;&amp;((uchar*)(tmp-&gt;imageData&nbsp;+&nbsp;tmp-&gt;widthStep*pt.y))[pt.x*3];&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">//OpenGL采用的是BGR格式，所以,读出来以后,还要换一下R&lt;-&gt;B,才能得到RGB</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;temp_ptr[0]&nbsp;=&nbsp;pixels[k+2]&nbsp;*&nbsp;255;&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">//blue&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;temp_ptr[1]&nbsp;=&nbsp;pixels[k+1]&nbsp;*&nbsp;255;&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">//green</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;temp_ptr[2]&nbsp;=&nbsp;pixels[k]&nbsp;*&nbsp;255;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">//red</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125;&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&#125;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;cvResize(tmp,&nbsp;img);&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">//&nbsp;释放内存</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;free(pixels);&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;cvReleaseImage(&amp;tmp);&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&#125;&nbsp;&nbsp;</span></li></ol></div><p>&nbsp;</p><p style="margin: 0cm 0cm 0pt; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px" class="MsoNormal">&nbsp;</p><p style="margin: 0cm 0cm 0pt; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px" class="MsoNormal">&nbsp;</p><p style="margin: 0cm 0cm 0pt; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px" class="MsoNormal"><span style="font-family: 宋体"><span style="font-size: small">显示效果如下：</span></span></p><p style="margin: 0cm 0cm 0pt; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px" class="MsoNormal"><span><span style="font-size: small; font-family: Calibri">&nbsp;</span></span></p><p style="margin: 0cm 0cm 0pt; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px" class="MsoNormal"><span><img style="border: none; max-width: 100%" src="http://hi.csdn.net/attachment/201010/27/0_1288219983K3tB.gif" border="0" /></span></p><p style="margin: 0cm 0cm 0pt; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px" class="MsoNormal"><span style="font-family: Calibri"><span style="font-size: small"><span>图26&nbsp;</span></span></span></p><p style="margin: 0cm 0cm 0pt; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px" class="MsoNormal">&nbsp;</p>
]]>
</description>
</item><item>
<link>http://i.renjihe.com/blog/read.php?7441</link>
<title><![CDATA[双目测距与三维重建的OpenCV实现问题集锦（三）立体匹配与视差计算]]></title> 
<author>renjihe1988 &lt;admin@yourname.com&gt;</author>
<category><![CDATA[OpenCV]]></category>
<pubDate>Fri, 29 Jul 2016 07:03:34 +0000</pubDate> 
<guid>http://i.renjihe.com/blog/read.php?7441</guid> 
<description>
<![CDATA[ 
	<p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><strong><span style="font-size: large">四、双目匹配与视差计算</span></strong></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">立体匹配主要是通过找出每对图像间的对应关系，根据三角测量原理，得到视差图；在获得了视差信息后，根据投影模型很容易地可以得到原始图像的深度信息和三维信息。立体匹配技术被普遍认为是立体视觉中最困难也是最关键的问题，主要是以下因素的影响：</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">&nbsp;</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><strong>（1）&nbsp;</strong><strong>光学失真和噪声（亮度、色调、饱和度等失衡）</strong></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><img style="border: none; max-width: 100%" src="http://hi.csdn.net/attachment/201010/26/0_128808555546yB.gif" border="0" /></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><a style="color: #ff9900; text-decoration: none" href="file:///C:/Documents%20and%20Settings/ZouYuhua/Local%20Settings/Temp/WindowsLiveWriter-429641856/supfiles11C939/clip_image00210.jpg"></a></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><strong>（2）&nbsp;</strong><strong>平滑表面的镜面反射</strong></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><strong><img style="border: none; max-width: 100%" src="http://hi.csdn.net/attachment/201010/26/0_12880855628YUv.gif" border="0" /></strong></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><a style="color: #ff9900; text-decoration: none" href="file:///C:/Documents%20and%20Settings/ZouYuhua/Local%20Settings/Temp/WindowsLiveWriter-429641856/supfiles11C939/clip_image0046.jpg"></a></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><strong>（3）&nbsp;</strong><strong>投影缩减（Foreshortening</strong><strong>）</strong></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><strong><img style="border: none; max-width: 100%" src="http://hi.csdn.net/attachment/201010/26/0_1288085569qzrj.gif" border="0" /></strong></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><a style="color: #ff9900; text-decoration: none" href="file:///C:/Documents%20and%20Settings/ZouYuhua/Local%20Settings/Temp/WindowsLiveWriter-429641856/supfiles11C939/clip_image0066.jpg"></a></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><strong>（4）&nbsp;</strong><strong>透视失真（Perspective distortions</strong><strong>）</strong></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><strong><img style="border: none; max-width: 100%" src="http://hi.csdn.net/attachment/201010/26/0_128808557997cC.gif" border="0" /></strong></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><a style="color: #ff9900; text-decoration: none" href="file:///C:/Documents%20and%20Settings/ZouYuhua/Local%20Settings/Temp/WindowsLiveWriter-429641856/supfiles11C939/clip_image0086.jpg"></a></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><strong>（5）&nbsp;</strong><strong>低纹理（Low texture</strong><strong>）</strong></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><strong><img style="border: none; max-width: 100%" src="http://hi.csdn.net/attachment/201010/26/0_1288085586CO9f.gif" border="0" /></strong></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><a style="color: #ff9900; text-decoration: none" href="file:///C:/Documents%20and%20Settings/ZouYuhua/Local%20Settings/Temp/WindowsLiveWriter-429641856/supfiles11C939/clip_image0106.jpg"></a></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><strong>（6）&nbsp;</strong><strong>重复纹理（Repetitive/ambiguous patterns</strong><strong>）</strong></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><strong><img style="border: none; max-width: 100%" src="http://hi.csdn.net/attachment/201010/26/0_1288085592Y3Ny.gif" border="0" /></strong></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><a style="color: #ff9900; text-decoration: none" href="file:///C:/Documents%20and%20Settings/ZouYuhua/Local%20Settings/Temp/WindowsLiveWriter-429641856/supfiles11C939/clip_image0126.jpg"></a></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><strong>（7）&nbsp;</strong><strong>透明物体</strong></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><strong><img style="border: none; max-width: 100%" src="http://hi.csdn.net/attachment/201010/26/0_1288085599HDQa.gif" border="0" /></strong></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><a style="color: #ff9900; text-decoration: none" href="file:///C:/Documents%20and%20Settings/ZouYuhua/Local%20Settings/Temp/WindowsLiveWriter-429641856/supfiles11C939/clip_image0146.jpg"></a></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><strong>（8）&nbsp;</strong><strong>重叠和非连续</strong></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><strong><img style="border: none; max-width: 100%" src="http://hi.csdn.net/attachment/201010/26/0_1288085608FwLf.gif" border="0" /></strong></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><a style="color: #ff9900; text-decoration: none" href="file:///C:/Documents%20and%20Settings/ZouYuhua/Local%20Settings/Temp/WindowsLiveWriter-429641856/supfiles11C939/clip_image0166.jpg"></a></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">&nbsp;</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">&nbsp;</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">目前立体匹配算法是计算机视觉中的一个难点和热点，算法很多，但是一般的步骤是：</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">&nbsp;</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><strong>A、</strong><strong>匹配代价计算</strong></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">匹配代价计算是整个立体匹配算法的基础，实际是对不同视差下进行灰度相似性测量。常见的方法有灰度差的平方SD（squared intensity differences），灰度差的绝对值AD（absolute intensity differences）等。另外，在求原始匹配代价时可以设定一个上限值，来减弱叠加过程中的误匹配的影响。以AD法求匹配代价为例，可用下式进行计算，其中T为设定的阈值。</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><img style="border: none; max-width: 100%" src="http://hi.csdn.net/attachment/201010/26/0_1288085621pPNo.gif" border="0" /></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><a style="color: #ff9900; text-decoration: none" href="file:///C:/Documents%20and%20Settings/ZouYuhua/Local%20Settings/Temp/WindowsLiveWriter-429641856/supfiles11C939/clip_image0189.jpg"></a></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">图18</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><strong>B、&nbsp;</strong><strong>匹配代价叠加</strong></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">一般来说，全局算法基于原始匹配代价进行后续算法计算。而区域算法则需要通过窗口叠加来增强匹配代价的可靠性，根据原始匹配代价不同，可分为：</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><img style="border: none; max-width: 100%" src="http://hi.csdn.net/attachment/201010/26/0_1288085627U1Fq.gif" border="0" /></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><a style="color: #ff9900; text-decoration: none" href="file:///C:/Documents%20and%20Settings/ZouYuhua/Local%20Settings/Temp/WindowsLiveWriter-429641856/supfiles11C939/clip_image0208.jpg"></a></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">图19</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">&nbsp;</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><strong>C、&nbsp;</strong><strong>视差获取</strong></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">对于区域算法来说，在完成匹配代价的叠加以后，视差的获取就很容易了，只需在一定范围内选取叠加匹配代价最优的点（SAD和SSD取最小值，NCC取最大值）作为对应匹配点，如胜者为王算法WTA（Winner-take-all）。而全局算法则直接对原始匹配代价进行处理，一般会先给出一个能量评价函数，然后通过不同的优化算法来求得能量的最小值，同时每个点的视差值也就计算出来了。</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">&nbsp;</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><strong>D、</strong><strong>视差细化（亚像素级）</strong></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">大多数立体匹配算法计算出来的视差都是一些离散的特定整数值，可满足一般应用的精度要求。但在一些精度要求比较高的场合，如精确的三维重构中，就需要在初始视差获取后采用一些措施对视差进行细化，如匹配代价的曲线拟合、图像滤波、图像分割等。</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">&nbsp;</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><strong><span style="color: #ff0000">有关立体匹配的介绍和常见匹配算法的比较，推荐大家看看</span><a style="color: #ff9900; text-decoration: none" href="http://www.vision.deis.unibo.it/smatt/stereo.htm"><span style="color: #ff0000">Stefano Mattoccia</span></a><span style="color: #ff0000">&nbsp;</span></strong><strong><span style="color: #ff0000">的讲义&nbsp;</span><a style="color: #ff9900; text-decoration: none" href="http://www.vision.deis.unibo.it/smatt/Seminars/StereoVision.pdf"><span style="color: #ff0000">Stereo Vision: algorithms and applications</span></a></strong><span style="color: #ff0000"><strong>，190</strong><strong>页的ppt</strong><strong>，讲解得非常形象详尽。</strong></span></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: medium"></span></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: medium"></span></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: medium"><strong>1．&nbsp;</strong><strong>opencv2.1</strong><strong>和</strong><strong>opencv2.0</strong><strong>在做</strong><strong>stereo vision</strong><strong>方面有什么区别了？</strong></span></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">2.1版增强了Stereo Vision方面的功能：</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">(1) 新增了 SGBM 立体匹配算法（源自Heiko Hirschmuller的《<a style="color: #ff9900; text-decoration: none" href="http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.88.8897&amp;rep=rep1&amp;type=pdf">Stereo Processing by Semi-global Matching and Mutual Information</a>》），可以获得比 BM 算法物体轮廓更清晰的视差图（但低纹理区域容易出现横/斜纹路，在 GCstate-&gt;fullDP 选项使能时可消减这种异常纹路，但对应区域视差变为0，且运行速度会有所下降），速度比 BM 稍慢， 352*288的帧处理速度大约是 5 帧/秒；</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">(2) 视差效果：BM &lt; SGBM &lt; GC；处理速度：BM &gt; SGBM &gt; GC ；</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">(3) BM 算法比2.0版性能有所提升，其状态参数新增了对左右视图感兴趣区域 ROI 的支持（roi1 和 roi2，由stereoRectify函数产生）；</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">(4) BM 算法和 GC 算法的核心代码改动不大，主要是面向多线程运算方面的（由 OpenMP 转向 Intel TBB）；</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">(5) cvFindStereoCorrespondenceBM 函数的disparity参数的数据格式新增了 CV_32F 的支持，这种格式的数据给出实际视差，而 2.0 版只支持 CV_16S，需要除以 16.0 才能得到实际的视差数值。</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">&nbsp;</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">&nbsp;</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: medium"><strong>2．&nbsp;</strong><strong>用于立体匹配的图像可以是彩色的吗？</strong></span></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">在OpenCV2.1中，BM和GC算法只能对8位灰度图像计算视差，SGBM算法则可以处理24位（8bits*3）彩色图像。所以在读入图像时，应该根据采用的算法来处理图像：</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">&nbsp;</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"></p><div id="scid:DFDE9937-D816-47f4-A306-7B60D5CE5AC0:acefbe3c-29c8-4364-83d5-36320aaaa09f" class="wlWriterEditableSmartContent" style="font-family: Arial; font-size: 14px; line-height: 26px; margin: 0px; display: inline; float: none; padding: 0px">int color_mode = alg == STEREO_SGBM ? 1 : 0;<br />//////////////////////////////////////////////////////////////////////////<br />// 载入图像<br />cvGrabFrame( lfCam );<br />cvGrabFrame( riCam );<br />frame1 = cvRetrieveFrame( lfCam );<br />frame2 = cvRetrieveFrame( riCam );<br />if(frame1.empty()) break;<br />resize(frame1, img1, img_size, 0, 0);<br />resize(frame2, img2, img_size, 0, 0);<br />// 选择彩色或灰度格式作为双目匹配的处理图像<br />if (!color_mode &amp;&amp; cn&gt;1)<br />&#123;<br />cvtColor(img1, img1gray, CV_BGR2GRAY);<br />cvtColor(img2, img2gray, CV_BGR2GRAY);<br />img1p = img1gray;<br />img2p = img2gray;<br />&#125;<br />else<br />&#123;<br />img1p = img1;<br />img2p = img2;<br />&#125;<br /></div><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">&nbsp;</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">&nbsp;</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: medium"><strong>3．&nbsp;</strong><strong>怎样获取与原图像有效像素区域相同的视差图？</strong></span></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">在<strong>OpenCV2.0</strong><strong>及以前的版本中，所获取的视差图总是在左侧和右侧有明显的黑色区域</strong>，这些区域没有有效的视差数据。视差图有效像素区域<strong>与视差窗口（</strong><strong>ndisp</strong><strong>，一般取正值且能被16</strong><strong>整除）和最小视差值（mindisp</strong><strong>，一般取0</strong><strong>或负值）相关</strong>，视差窗口越大，视差图左侧的黑色区域越大，最小视差值越小，视差图右侧的黑色区域越大。其原因是为了保证参考图像（一般是左视图）的像素点能在目标图像（右视图）中按照设定的视差匹配窗口匹配对应点，<strong>OpenCV&nbsp;</strong><strong>只从参考图像的第 (ndisp - 1 + mindisp)&nbsp;</strong><strong>列开始向右计算视差，第 0&nbsp;</strong><strong>列到第 (ndisp - 1 + mindisp)&nbsp;</strong><strong>列的区域视差统一设置为 (mindisp - 1) *16</strong><strong>；视差计算到第 width + mindisp&nbsp;</strong><strong>列时停止，余下的右侧区域视差值也统一设置为 (mindisp - 1) *16</strong>。&nbsp;&nbsp;</p><div id="scid:DFDE9937-D816-47f4-A306-7B60D5CE5AC0:619f7758-c28c-40c6-85d3-75e0fa33aa6b" class="wlWriterEditableSmartContent" style="font-family: Arial; font-size: 14px; line-height: 26px; margin: 0px; display: inline; float: none; padding: 0px"><pre class=" csharp" style="white-space: pre-wrap; word-wrap: break-word">00177 static const int DISPARITY_SHIFT = 4; &hellip; 00411&nbsp;&nbsp;&nbsp;&nbsp; int ndisp = state-&gt;numberOfDisparities; 00412&nbsp;&nbsp;&nbsp;&nbsp; int mindisp = state-&gt;minDisparity; 00413&nbsp;&nbsp;&nbsp;&nbsp; int lofs = MAX(ndisp - 1 + mindisp, 0); 00414&nbsp;&nbsp;&nbsp;&nbsp; int rofs = -MIN(ndisp - 1 + mindisp, 0); 00415&nbsp;&nbsp;&nbsp;&nbsp; int width = left-&gt;cols, height = left-&gt;rows; 00416&nbsp;&nbsp;&nbsp;&nbsp; int width1 = width - rofs - ndisp + 1; &hellip; 00420&nbsp;&nbsp;&nbsp;&nbsp; short FILTERED = (short)((mindisp - 1) &lt;&lt; DISPARITY_SHIFT); &hellip; 00466&nbsp;&nbsp;&nbsp;&nbsp; // initialize the left and right borders of the disparity map 00467&nbsp;&nbsp;&nbsp;&nbsp; for( y = 0; y &lt; height; y++ ) 00468&nbsp;&nbsp;&nbsp;&nbsp; &#123; 00469&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for( x = 0; x &lt; lofs; x++ ) 00470&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dptr[y*dstep + x] = FILTERED; 00471&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for( x = lofs + width1; x &lt; width; x++ ) 00472&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dptr[y*dstep + x] = FILTERED; 00473&nbsp;&nbsp;&nbsp;&nbsp; &#125; 00474&nbsp;&nbsp;&nbsp;&nbsp; dptr += lofs; 00475 00476&nbsp;&nbsp;&nbsp;&nbsp; for( x = 0; x &lt; width1; x++, dptr++ )&nbsp;&nbsp;&hellip; </pre></div><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">&nbsp;</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">这样的设置很明显是不符合实际应用的需求的，它相当于把摄像头的视场范围缩窄了。因此，<strong>OpenCV2.1</strong>&nbsp;做了明显的改进，不再要求左右视图和视差图的大小（size）一致，<strong>允许对视差图进行左右边界延拓</strong>，这样，虽然计算视差时还是按上面的代码思路来处理左右边界，但是视差图的边界得到延拓后，有效视差的范围就能够与对应视图完全对应。具体的实现代码范例如下：</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">&nbsp;</p><div id="scid:DFDE9937-D816-47f4-A306-7B60D5CE5AC0:374e0d2c-3707-4692-9b6e-88349d8e29c8" class="wlWriterEditableSmartContent" style="font-family: Arial; font-size: 14px; line-height: 26px; margin: 0px; display: inline; float: none; padding: 0px"><pre class=" csharp" style="white-space: pre-wrap; word-wrap: break-word">////////////////////////////////////////////////////////////////////////// // 对左右视图的左边进行边界延拓，以获取与原始视图相同大小的有效视差区域 copyMakeBorder(img1r, img1b, 0, 0, m_nMaxDisp, 0, IPL_BORDER_REPLICATE); copyMakeBorder(img2r, img2b, 0, 0, m_nMaxDisp, 0, IPL_BORDER_REPLICATE);&nbsp;&nbsp;////////////////////////////////////////////////////////////////////////// // 计算视差 if( alg == STEREO_BM ) &#123; &nbsp;&nbsp;bm(img1b, img2b, dispb); &nbsp;&nbsp;// 截取与原始画面对应的视差区域（舍去加宽的部分） &nbsp;&nbsp;displf = dispb.colRange(m_nMaxDisp, img1b.cols);&nbsp;&nbsp; &#125; else if(alg == STEREO_SGBM) &#123; &nbsp;&nbsp;sgbm(img1b, img2b, dispb); &nbsp;&nbsp;displf = dispb.colRange(m_nMaxDisp, img1b.cols); &#125; </pre></div><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">&nbsp;</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: medium"></span></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: medium"></span></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: medium"><strong>4．&nbsp;</strong><strong>cvFindStereoCorrespondenceBM</strong><strong>的输出结果好像不是以像素点为单位的视差？</strong></span></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">&ldquo;<a style="color: #ff9900; text-decoration: none" href="http://blog.csdn.net/scyscyao/archive/2010/05/06/5562024.aspx">@scyscyao</a>：在OpenCV2.0中，BM函数得出的结果是以16位符号数的形式的存储的，出于精度需要，所有的视差在输出时都扩大了16倍(2^4)。其具体代码表示如下：</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">dptr[y*dstep] = (short)(((ndisp - mind - 1 + mindisp)*256 + (d != 0 ? (p-n)*128/d : 0) + 15) &gt;&gt; 4);</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">可以看到，原始视差在左移8位(256)并且加上一个修正值之后又右移了4位，最终的结果就是左移4位。</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">因此，在实际求距离时，cvReprojectTo3D出来的X/W,Y/W,Z/W都要乘以16 (也就是W除以16)，才能得到正确的三维坐标信息。&rdquo;</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">&nbsp;</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">在<strong>OpenCV2.1</strong><strong>中，BM</strong><strong>算法可以用 CV_16S&nbsp;</strong><strong>或者 CV_32F&nbsp;</strong><strong>的方式输出视差数据</strong>，使用32位float格式可以得到真实的视差值，而CV_16S 格式得到的视差矩阵则需要 除以16 才能得到正确的视差。另外，OpenCV2.1另外两种立体匹配算法&nbsp;<strong>SGBM&nbsp;</strong><strong>和 GC&nbsp;</strong><strong>只支持 CV_16S&nbsp;</strong><strong>格式的 disparity&nbsp;</strong><strong>矩阵</strong>。</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">&nbsp;</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">&nbsp;</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: medium"></span></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: medium"><strong>5．&nbsp;</strong><strong>如何设置</strong><strong>BM</strong><strong>、</strong><strong>SGBM</strong><strong>和</strong><strong>GC</strong><strong>算法的状态参数？</strong></span></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><strong>（</strong><strong>1</strong><strong>）</strong><strong>StereoBMState</strong></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">// 预处理滤波参数</p><ul style="font-family: Arial; font-size: 14px; line-height: 26px"><li><strong>preFilterType</strong><strong>：预处理滤波器的类型</strong>，主要是用于降低亮度失真（photometric distortions）、消除噪声和增强纹理等, 有两种可选类型：CV_STEREO_BM_NORMALIZED_RESPONSE（归一化响应） 或者&nbsp;<strong>CV_STEREO_BM_XSOBEL</strong><strong>（水平方向Sobel</strong><strong>算子，默认类型）</strong>, 该参数为 int 型；</li><li><strong>preFilterSize</strong><strong>：预处理滤波器窗口大小</strong>，容许范围是[5,255]，一般<strong>应该在</strong><strong>&nbsp;5x5..21x21&nbsp;</strong><strong>之间</strong>，参数必须为<strong>奇数</strong>值, int 型</li><li><strong>preFilterCap</strong><strong>：预处理滤波器的截断</strong>值，预处理的输出值仅保留[-preFilterCap, preFilterCap]范围内的值，<strong>参数范围：</strong><strong>1 - 31</strong><strong>（文档中是31</strong><strong>，但代码中是 63</strong><strong>）</strong>, int</li></ul><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">// SAD 参数</p><ul style="font-family: Arial; font-size: 14px; line-height: 26px"><li><strong>SADWindowSize</strong><strong>：SAD</strong><strong>窗口大小</strong>，容许范围是[5,255]，一般<strong>应该在</strong><strong>&nbsp;5x5&nbsp;</strong><strong>至 21x21&nbsp;</strong><strong>之间</strong>，参数必须是<strong>奇数</strong>，int 型</li><li><strong>minDisparity</strong><strong>：最小视差</strong>，<strong>默认值为</strong><strong>&nbsp;0</strong>, 可以是负值，int 型</li><li><strong>numberOfDisparities</strong><strong>：视差窗口</strong>，即最大视差值与最小视差值之差, 窗口大小<strong>必须是</strong><strong>&nbsp;16&nbsp;</strong><strong>的整数倍</strong>，int 型</li></ul><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">// 后处理参数</p><ul style="font-family: Arial; font-size: 14px; line-height: 26px"><li><strong>textureThreshold</strong><strong>：低纹理区域的判断阈值</strong>。如果当前SAD窗口内所有邻居像素点的x导数绝对值之和小于指定阈值，则该窗口对应的像素点的视差值为 0（That is, if the sum of absolute values of x-derivatives computed over SADWindowSize by SADWindowSize pixel neighborhood is smaller than the parameter, no disparity is computed at the pixel），该参数不能为负值，int 型</li><li><strong>uniquenessRatio</strong><strong>：视差唯一性百分比</strong>， 视差窗口范围内最低代价是次低代价的(1 + uniquenessRatio/100)倍时，最低代价对应的视差值才是该像素点的视差，否则该像素点的视差为 0 （the minimum margin in percents between the best (minimum) cost function value and the second best value to accept the computed disparity, that is, accept the computed disparity d^ only if SAD(d) &gt;= SAD(d^) x (1 + uniquenessRatio/100.) for any d != d*+/-1 within the search range ），该参数不能为负值，<strong>一般</strong><strong>5-15</strong><strong>左右的值比较合适，</strong>int 型</li><li><strong>speckleWindowSize</strong><strong>：检查视差连通区域变化度的窗口大小</strong>, 值为 0 时取消 speckle 检查，int 型</li><li><strong>speckleRange</strong><strong>：视差变化阈值</strong>，当窗口内视差变化大于阈值时，该窗口内的视差清零，int 型</li></ul><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">// OpenCV2.1 新增的状态参数</p><ul style="font-family: Arial; font-size: 14px; line-height: 26px"><li><strong>roi1, roi2</strong><strong>：左右视图的有效像素区域</strong>，一般<strong>由双目校正阶段的</strong><strong>&nbsp;cvStereoRectify&nbsp;</strong><strong>函数传递</strong>，也可以自行设定。一旦在状态参数中设定了 roi1 和 roi2，OpenCV 会通过cvGetValidDisparityROI 函数计算出视差图的有效区域，在有效区域外的视差值将被清零。</li><li><strong>disp12MaxDiff</strong><strong>：左视差图（直接计算得出）和右视差图（通过cvValidateDisparity</strong><strong>计算得出）之间的最大容许差异</strong>。超过该阈值的视差值将被清零。该参数<strong>默认为</strong><strong>&nbsp;-1</strong>，即不执行左右视差检查。int 型。注意在程序调试阶段最好保持该值为 -1，以便查看不同视差窗口生成的视差效果。具体请参见《<a style="color: #ff9900; text-decoration: none" href="http://www.opencv.org.cn/forum/viewtopic.php?f=1&amp;t=10757">使用OpenGL动态显示双目视觉三维重构效果示例</a>》一文中的讨论。</li></ul><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">在上述参数中，对视差生成效果影响较大的<strong>主要参数是</strong><strong>&nbsp;SADWindowSize</strong><strong>、numberOfDisparities&nbsp;</strong><strong>和 uniquenessRatio&nbsp;</strong><strong>三个，一般只需对这三个参数进行调整，其余参数按默认设置即可</strong>。</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">在OpenCV2.1中，BM算法有C和C++ 两种实现模块。</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">&nbsp;</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><strong>（</strong><strong>2</strong><strong>）</strong><strong>StereoSGBMState</strong></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">SGBM算法的状态参数大部分与BM算法的一致，下面只解释不同的部分：</p><ul style="font-family: Arial; font-size: 14px; line-height: 26px"><li><strong>SADWindowSize</strong><strong>：SAD</strong><strong>窗口大小</strong>，容许范围是[1,11]，<strong>一般应该在</strong><strong>&nbsp;3x3&nbsp;</strong><strong>至 11x11&nbsp;</strong><strong>之间</strong>，参数必须是奇数，int 型</li><li><strong>P1, P2</strong><strong>：控制视差变化平滑性的参数</strong>。P1、P2的值越大，视差越平滑。P1是相邻像素点视差增/减 1 时的惩罚系数；P2是相邻像素点视差变化值大于1时的惩罚系数。<strong>P2</strong><strong>必须大于P1</strong>。OpenCV2.1提供的例程&nbsp;<strong>stereo_match.cpp&nbsp;</strong><strong>给出了 P1&nbsp;</strong><strong>和 P2&nbsp;</strong><strong>比较合适的数值</strong>。</li><li><strong>fullDP</strong><strong>：布尔值</strong>，当设置为 TRUE 时，运行双通道动态编程算法（full-scale 2-pass dynamic programming algorithm），会占用O(W*H*numDisparities)个字节，对于高分辨率图像将占用较大的内存空间。<strong>一般设置为</strong><strong>&nbsp;FALSE</strong>。</li></ul><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><strong>注意OpenCV2.1</strong><strong>的SGBM</strong><strong>算法是用C++&nbsp;</strong><strong>语言编写的，没有C</strong><strong>实现模块</strong>。与H. Hirschmuller提出的原算法相比，主要有如下变化：</p><ol style="font-family: Arial; font-size: 14px; line-height: 26px"><li>算法默认运行单通道DP算法，只用了5个方向，而fullDP使能时则使用8个方向（可能需要占用大量内存）。</li><li>算法在计算匹配代价函数时，采用块匹配方法而非像素匹配（不过SADWindowSize=1时就等于像素匹配了）。</li><li>匹配代价的计算采用BT算法（&quot;<a style="color: #ff9900; text-decoration: none" href="http://www.ces.clemson.edu/~stb/publications/p2p_iccv1998.pdf">Depth Discontinuities by Pixel-to-Pixel Stereo</a>&quot; by S. Birchfield and C. Tomasi），并没有实现基于互熵信息的匹配代价计算。</li><li>增加了一些BM算法中的预处理和后处理程序。</li></ol><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><strong>（</strong><strong>3</strong><strong>）</strong><strong>StereoGCState</strong></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">GC算法的状态参数只有两个：<strong>numberOfDisparities&nbsp;</strong><strong>和 maxIters</strong>&nbsp;，并且<strong>只能通过</strong><strong>&nbsp;cvCreateStereoGCState&nbsp;</strong><strong>在创建算法状态结构体时一次性确定</strong>，不能在循环中更新状态信息。GC算法并不是一种实时算法，但可以得到物体轮廓清晰准确的视差图，适用于静态环境物体的深度重构。</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">注意<strong>GC</strong><strong>算法只能在C</strong><strong>语言模式下运行，并且不能对视差图进行预先的边界延拓</strong>，左右视图和左右视差矩阵的大小必须一致。</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">&nbsp;</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">&nbsp;</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: medium"><strong>6．&nbsp;</strong><strong>如何实现视差图的伪彩色显示？</strong></span></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">首先要将16位符号整形的视差矩阵转换为8位无符号整形矩阵，然后按照一定的变换关系进行伪彩色处理。我的实现代码如下：&nbsp;</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">&nbsp;</p><div id="scid:DFDE9937-D816-47f4-A306-7B60D5CE5AC0:247819d5-dbda-42cf-9517-12caab1763fc" class="wlWriterEditableSmartContent" style="font-family: Arial; font-size: 14px; line-height: 26px; margin: 0px; display: inline; float: none; padding: 0px"><pre class=" csharp" style="white-space: pre-wrap; word-wrap: break-word">// 转换为 CV_8U 格式，彩色显示 dispLfcv = displf, dispRicv = dispri, disp8cv = disp8; if (alg == STEREO_GC) &#123; &nbsp;&nbsp;cvNormalize( &amp;dispLfcv, &amp;disp8cv, 0, 256, CV_MINMAX ); &#125;&nbsp;&nbsp;else &#123; &nbsp;&nbsp;displf.convertTo(disp8, CV_8U, 255/(m_nMaxDisp*16.)); &#125; F_Gray2Color(&amp;disp8cv, vdispRGB); </pre></div><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">&nbsp;</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">&nbsp;</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">灰度图转伪彩色图的代码，主要功能是使灰度图中 亮度越高的像素点，在伪彩色图中对应的点越趋向于 红色；亮度越低，则对应的伪彩色越趋向于 蓝色；总体上按照灰度值高低，由红渐变至蓝，中间色为绿色。其对应关系如下图所示：</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><img style="border: none; max-width: 100%" src="http://hi.csdn.net/attachment/201010/26/0_1288085635u1Qh.gif" border="0" />&nbsp;</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><a style="color: #ff9900; text-decoration: none" href="file:///C:/Documents%20and%20Settings/ZouYuhua/Local%20Settings/Temp/WindowsLiveWriter-429641856/supfiles11C939/clip_image0213.jpg"></a></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">图20</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">&nbsp;</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">&nbsp;</p><div id="scid:DFDE9937-D816-47f4-A306-7B60D5CE5AC0:5daf1184-f764-4c95-9f29-09d89ce0caf8" class="wlWriterEditableSmartContent" style="font-family: Arial; font-size: 14px; line-height: 26px; margin: 0px; display: inline; float: none; padding: 0px"><pre class=" csharp" style="white-space: pre-wrap; word-wrap: break-word">void F_Gray2Color(CvMat* gray_mat, CvMat* color_mat) &#123; &nbsp;&nbsp;if(color_mat) &nbsp;&nbsp;&nbsp;&nbsp;cvZero(color_mat); &nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;int stype = CV_MAT_TYPE(gray_mat-&gt;type), dtype = CV_MAT_TYPE(color_mat-&gt;type); &nbsp;&nbsp;int rows = gray_mat-&gt;rows, cols = gray_mat-&gt;cols;&nbsp;&nbsp;&nbsp;&nbsp;// 判断输入的灰度图和输出的伪彩色图是否大小相同、格式是否符合要求 &nbsp;&nbsp;if (CV_ARE_SIZES_EQ(gray_mat, color_mat) &amp;&amp; stype == CV_8UC1 &amp;&amp; dtype == CV_8UC3) &nbsp;&nbsp;&#123; &nbsp;&nbsp;&nbsp;&nbsp;CvMat* red = cvCreateMat(gray_mat-&gt;rows, gray_mat-&gt;cols, CV_8U); &nbsp;&nbsp;&nbsp;&nbsp;CvMat* green = cvCreateMat(gray_mat-&gt;rows, gray_mat-&gt;cols, CV_8U); &nbsp;&nbsp;&nbsp;&nbsp;CvMat* blue = cvCreateMat(gray_mat-&gt;rows, gray_mat-&gt;cols, CV_8U); &nbsp;&nbsp;&nbsp;&nbsp;CvMat* mask = cvCreateMat(gray_mat-&gt;rows, gray_mat-&gt;cols, CV_8U);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// 计算各彩色通道的像素值 &nbsp;&nbsp;&nbsp;&nbsp;cvSubRS(gray_mat, cvScalar(255), blue);&nbsp;&nbsp;// blue(I) = 255 - gray(I) &nbsp;&nbsp;&nbsp;&nbsp;cvCopy(gray_mat, red);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// red(I) = gray(I) &nbsp;&nbsp;&nbsp;&nbsp;cvCopy(gray_mat, green);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// green(I) = gray(I),if gray(I) &lt; 128 &nbsp;&nbsp;&nbsp;&nbsp;cvCmpS(green, 128, mask, CV_CMP_GE );&nbsp;&nbsp;// green(I) = 255 - gray(I), if gray(I) &gt;= 128 &nbsp;&nbsp;&nbsp;&nbsp;cvSubRS(green, cvScalar(255), green, mask); &nbsp;&nbsp;&nbsp;&nbsp;cvConvertScale(green, green, 2.0, 0.0);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// 合成伪彩色图 &nbsp;&nbsp;&nbsp;&nbsp;cvMerge(blue, green, red, NULL, color_mat);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cvReleaseMat( &amp;red ); &nbsp;&nbsp;&nbsp;&nbsp;cvReleaseMat( &amp;green ); &nbsp;&nbsp;&nbsp;&nbsp;cvReleaseMat( &amp;blue ); &nbsp;&nbsp;&nbsp;&nbsp;cvReleaseMat( &amp;mask ); &nbsp;&nbsp;&#125; &#125; </pre></div><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">&nbsp;</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: medium"></span></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: medium"><strong>7．&nbsp;</strong><strong>如何将视差数据保存为</strong><strong>&nbsp;txt&nbsp;</strong><strong>数据文件以便在</strong><strong>&nbsp;Matlab&nbsp;</strong><strong>中读取分析？</strong></span></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">由于OpenCV本身只支持 xml、yml 的数据文件读写功能，并且其xml文件与构建网页数据所用的xml文件格式不一致，在Matlab中无法读取。我们可以通过以下方式将视差数据保存为txt文件，再导入到Matlab中。&nbsp;</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">&nbsp;</p><div id="scid:DFDE9937-D816-47f4-A306-7B60D5CE5AC0:1781763a-b781-41b5-ad7a-243c9f4500dc" class="wlWriterEditableSmartContent" style="font-family: Arial; font-size: 14px; line-height: 26px; margin: 0px; display: inline; float: none; padding: 0px"><pre class=" csharp" style="white-space: pre-wrap; word-wrap: break-word">void saveDisp(const char* filename, const Mat&amp; mat)&nbsp;&nbsp;&nbsp;&nbsp; &#123; &nbsp;&nbsp;FILE* fp = fopen(filename, &quot;wt&quot;); &nbsp;&nbsp;fprintf(fp, &quot;%02d/n&quot;, mat.rows); &nbsp;&nbsp;fprintf(fp, &quot;%02d/n&quot;, mat.cols); &nbsp;&nbsp;for(int y = 0; y &lt; mat.rows; y++) &nbsp;&nbsp;&#123; &nbsp;&nbsp;&nbsp;&nbsp;for(int x = 0; x &lt; mat.cols; x++) &nbsp;&nbsp;&nbsp;&nbsp;&#123; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;short disp = mat.at&lt;short&gt;(y, x); // 这里视差矩阵是CV_16S 格式的，故用 short 类型读取 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fprintf(fp, &quot;%d/n&quot;, disp); // 若视差矩阵是 CV_32F 格式，则用 float 类型读取 &nbsp;&nbsp;&nbsp;&nbsp;&#125; &nbsp;&nbsp;&#125; &nbsp;&nbsp;fclose(fp); &#125; </pre></div><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">&nbsp;</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">相应的Matlab代码为：</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">&nbsp;&nbsp;</p><div id="scid:DFDE9937-D816-47f4-A306-7B60D5CE5AC0:8aefb0a5-4e67-47bb-8a62-013de182f2f0" class="wlWriterEditableSmartContent" style="font-family: Arial; font-size: 14px; line-height: 26px; margin: 0px; display: inline; float: none; padding: 0px"><pre class=" csharp" style="white-space: pre-wrap; word-wrap: break-word">function img = txt2img(filename) data = importdata(filename); r = data(1);&nbsp;&nbsp;&nbsp;&nbsp;% 行数 c = data(2);&nbsp;&nbsp;&nbsp;&nbsp;% 列数 disp = data(3:end); % 视差 vmin = min(disp); vmax = max(disp); disp = reshape(disp, [c,r])'; % 将列向量形式的 disp 重构为 矩阵形式 %&nbsp;&nbsp;OpenCV 是行扫描存储图像，Matlab 是列扫描存储图像 %&nbsp;&nbsp;故对 disp 的重新排列是首先变成 c 行 r 列的矩阵，然后再转置回 r 行 c 列 img = uint8( 255 * ( disp - vmin ) / ( vmax - vmin ) ); mesh(disp); set(gca,'YDir','reverse');&nbsp;&nbsp;% 通过 mesh 方式绘图时，需倒置 Y 轴方向 axis tight; % 使坐标轴显示范围与数据范围相贴合，去除空白显示区 </pre></div><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">&nbsp;</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">显示效果如下：</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><img style="border: none; max-width: 100%" src="http://hi.csdn.net/attachment/201010/26/0_1288085642ULuG.gif" border="0" />&nbsp;</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><a style="color: #ff9900; text-decoration: none" href="file:///C:/Documents%20and%20Settings/ZouYuhua/Local%20Settings/Temp/WindowsLiveWriter-429641856/supfiles11C939/clip_image0238.jpg"></a></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">图21</p>
]]>
</description>
</item><item>
<link>http://i.renjihe.com/blog/read.php?7440</link>
<title><![CDATA[双目测距与三维重建的OpenCV实现问题集锦（二）双目定标与双目校正]]></title> 
<author>renjihe1988 &lt;admin@yourname.com&gt;</author>
<category><![CDATA[OpenCV]]></category>
<pubDate>Fri, 29 Jul 2016 07:03:09 +0000</pubDate> 
<guid>http://i.renjihe.com/blog/read.php?7440</guid> 
<description>
<![CDATA[ 
	<p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: medium; color: #0000ff"><strong>三、双目定标和双目校正</strong></span></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">双目摄像头定标不仅要得出每个摄像头的内部参数，还需要通过标定来测量两个摄像头之间的相对位置（即右摄像头相对于左摄像头的三维平移 t 和旋转 R 参数）。</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><a style="color: #ff9900; text-decoration: none" href="http://hi.csdn.net/attachment/201010/24/0_12879406777m1Z.gif"><img style="border: 0px; max-width: 100%; display: block; float: none; margin-left: auto; margin-right: auto" src="http://hi.csdn.net/attachment/201010/24/0_1287940677jw3N.gif" border="0" alt="clip_image002" title="clip_image002" width="547" height="347" /></a></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px" align="center">图6</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">要计算目标点在左右两个视图上形成的视差，首先要把该点在左右视图上两个对应的像点匹配起来。然而，在二维空间上匹配对应点是非常耗时的，为了减少匹配搜索范围，我们可以利用极线约束使得对应点的匹配由二维搜索降为一维搜索。</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a style="color: #ff9900; text-decoration: none" href="http://hi.csdn.net/attachment/201010/24/0_1287940677Z3z6.gif"><img style="border: 0px; max-width: 100%; display: inline" src="http://hi.csdn.net/attachment/201010/24/0_1287940677sflZ.gif" border="0" alt="clip_image004" title="clip_image004" width="257" height="354" /></a>&nbsp;&nbsp;<a style="color: #ff9900; text-decoration: none" href="http://hi.csdn.net/attachment/201010/24/0_1287940677KkBU.gif"><img style="border: 0px; max-width: 100%; display: inline" src="http://hi.csdn.net/attachment/201010/24/0_12879406786NNe.gif" border="0" alt="clip_image006" title="clip_image006" width="483" height="330" /></a></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px" align="center">图7</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">而双目校正的作用就是要把消除畸变后的两幅图像严格地行对应，使得两幅图像的对极线恰好在同一水平线上，这样一幅图像上任意一点与其在另一幅图像上的对应点就必然具有相同的行号，只需在该行进行一维搜索即可匹配到对应点。</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><a style="color: #ff9900; text-decoration: none" href="http://hi.csdn.net/attachment/201010/24/0_12879406782ZaA.gif"><img style="border: 0px; max-width: 100%; display: block; float: none; margin-left: auto; margin-right: auto" src="http://hi.csdn.net/attachment/201010/24/0_1287940678FuNI.gif" border="0" alt="clip_image008" title="clip_image008" width="380" height="413" /></a></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px" align="center">图8</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px" align="center">&nbsp;</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><strong><span style="font-size: medium">1． 关于cvStereoCalibrate的使用</span></strong></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">如果按照 Learning OpenCV 的例程，直接通过cvStereoCalibrate来实现双目定标，很容易产生比较大的图像畸变，边角处的变形较厉害。最好先通过cvCalibrateCamera2() 对每个摄像头单独进行定标，再利用cvStereoCalibrate进行双目定标。这样定标所得参数才比较准确，随后的校正也不会有明显的畸变。我使用的程序主要基于Learning OpenCV 的例程ch12_ex12_3.cpp，其中主要部分如下：</p><div id="scid:57F11A72-B0E5-49c7-9094-E3A15BD5B5E6:7e5dbc63-381a-4c49-b336-86c9940bb8f8" class="wlWriterEditableSmartContent" style="font-family: Arial; font-size: 14px; line-height: 26px; padding: 0px; margin: 0px; display: inline; float: none"><pre style="white-space: pre-wrap; word-wrap: break-word; overflow: auto">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #808080">////////////////////////////////////////////////////////////////////////</span><span style="color: #008000">//</span><span style="color: #808080"> </span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000">//</span><span style="color: #008000"> 是否首先进行单目定标？</span><span style="color: #008000"> </span>&nbsp;&nbsp;&nbsp;&nbsp;cvCalibrateCamera2(&amp;_objectPoints, &amp;_imagePoints1, &amp;_npoints, imageSize,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &amp;t_M1, &amp;t_D1, NULL, NULL, CV_CALIB_FIX_K3);&nbsp;&nbsp;&nbsp;&nbsp; cvCalibrateCamera2(&amp;_objectPoints, &amp;_imagePoints2, &amp;_npoints, imageSize,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &amp;t_M2, &amp;t_D2, NULL, NULL, CV_CALIB_FIX_K3);&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #808080">////////////////////////////////////////////////////////////////////////</span><span style="color: #008000">//</span><span style="color: #808080"> </span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000">//</span><span style="color: #008000"> 进行双目定标</span><span style="color: #008000"> </span>&nbsp;&nbsp;&nbsp;&nbsp;cvStereoCalibrate( &amp;_objectPoints, &amp;_imagePoints1,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &amp;_imagePoints2, &amp;_npoints,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &amp;t_M1, &amp;t_D1, &amp;t_M2, &amp;t_D2,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; imageSize, &amp;t_R, &amp;t_T, &amp;t_E, &amp;t_F,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cvTermCriteria(CV_TERMCRIT_ITER+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CV_TERMCRIT_EPS, <span style="color: #800080">100</span>, 1e-<span style="color: #800080">5</span>));&nbsp;&nbsp;<span style="color: #008000">//</span><span style="color: #008000"> flags为默认的CV_CALIB_FIX_INTRINSIC</span></pre></div><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">上面的t_M1(2), t_D1(2) 分别是单目定标后获得的左（右）摄像头的内参矩阵<a style="color: #ff9900" name="OLE_LINK14"></a><a style="color: #ff9900" name="OLE_LINK13"></a>（3*3）和畸变参数向量（1*5）；t_R, t_T 分别是右摄像头相对于左摄像头的旋转矩阵（3*3）和平移向量（3*1）, t_E是包含了两个摄像头相对位置关系的Essential Matrix（3*3），t_F 则是既包含两个摄像头相对位置关系、也包含摄像头各自内参信息的Fundamental Matrix（3*3）。</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><a style="color: #ff9900; text-decoration: none" href="http://hi.csdn.net/attachment/201010/24/0_12879406782A0V.gif"><img style="border: 0px; max-width: 100%; display: inline; margin-left: 0px; margin-right: 0px" src="http://hi.csdn.net/attachment/201010/24/0_12879406789Jjr.gif" border="0" alt="clip_image010" title="clip_image010" width="410" height="244" /></a></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px" align="left">图9</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px" align="center">&nbsp;</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: medium"><strong>2． cvStereoCalibrate 是怎样计算 Essential Matrix 和 Fundamental Matrix 的？</strong></span></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">首先我们以Learning OpenCV第422页为基础，讨论下 Essential Matrix 和 Fundamental Matrix 的构造过程，再看看 OpenCV 是如何进行计算的。</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><a style="color: #ff9900; text-decoration: none" href="http://hi.csdn.net/attachment/201010/24/0_128794067944O4.gif"><img style="border: 0px; max-width: 100%; display: block; float: none; margin-left: auto; margin-right: auto" src="http://hi.csdn.net/attachment/201010/24/0_1287940679GpmE.gif" border="0" alt="clip_image012" title="clip_image012" width="479" height="311" /></a></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px" align="center">图10</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">&nbsp;<span style="color: #ff0000"><strong>注：原文中对p<sub>l</sub>、p<sub>r&nbsp;</sub>和q<sub>l</sub>、q<sub>r&nbsp;</sub>物理意义和计算公式的表述有误，已修正。（2011-04-12）</strong></span></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><strong>（1）Essential Matrix</strong></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">如上图所示，给定一个目标点P，以左摄像头光心O<sub>l</sub>为原点。点P相对于光心O<sub>l</sub>的观察位置为P<sub>l</sub>，相对于光心O<sub>r</sub>的观察位置为P<sub>r</sub>。点P在左摄像头成像平面上的位置为p<sub>l</sub>，在右摄像头成像平面上的位置为p<sub>r</sub>。<span style="color: #ff0000"><strong>注意</strong><strong>P</strong><sub>l</sub><strong>、P</strong><sub>r</sub><strong>、p</strong><sub>l</sub><strong>、p</strong><sub>r&nbsp;</sub><strong>都处于摄像机坐标系，其量纲是与平移向量T相同的（p</strong><sub>l</sub><strong>、p</strong><sub>r&nbsp;</sub><strong>在图像坐标系中对应的像素坐标为 q</strong><sub>l</sub><strong>、q</strong><sub>r&nbsp;</sub><strong>）。</strong></span></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">假设右摄像头相对于左摄像头的相对位置关系由旋转矩阵R和平移向量T表示，则可得：P<sub>r</sub>&nbsp;= R(P<sub>l</sub>-T)。</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">现在我们要寻找由点P、O<sub>l</sub>和O<sub>r</sub>确定的对极平面的表达式。注意到平面上任意一点x与点a的连线垂直于平面法向量n，即向量 (x-a) 与向量 n 的点积为0：(x-a)&middot;n = 0。在Ol坐标系中，光心Or的位置为T，则P、O<sub>l</sub>和O<sub>r</sub>确定的对极平面可由下式表示：(P<sub>l</sub>-T)<sup>T</sup>&middot;(P<sub>l</sub>&times;T) = 0。</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">由<a style="color: #ff9900" name="OLE_LINK2"></a><a style="color: #ff9900" name="OLE_LINK1"></a>P<sub>r</sub>&nbsp;= R(P<sub>l</sub>-T) 和 R<sup>T</sup>=R<sup>-1</sup>&nbsp;可得：(R<sup>T</sup>P<sub>r</sub>)<sup>T</sup>&middot;(P<sub>l</sub>&times;T) = 0。</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">另一方面，向量的叉积又可表示为矩阵与向量的乘积，记向量T的矩阵表示为S，得：P<sub>l</sub>&times;T = SP<sub>l</sub>。</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><a style="color: #ff9900; text-decoration: none" href="http://hi.csdn.net/attachment/201010/24/0_12879406797T87.gif"><img style="border: 0px; max-width: 100%; display: inline" src="http://hi.csdn.net/attachment/201010/24/0_1287940679RgU5.gif" border="0" alt="clip_image014" title="clip_image014" width="140" height="82" /></a></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">图11</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">那么就得到：(P<sub>r</sub>)<sup>T</sup>RSP<sub>l</sub>&nbsp;= 0。这样，我们就得到Essential Matrix：E = RS。</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">通过矩阵E我们知道P<sub>l</sub>和P<sub>r</sub>的关系满足：(P<sub>r</sub>)<sup>T</sup>EP<sub>l</sub>&nbsp;= 0。进一步地，由 p<sub>l</sub>&nbsp;= f<sub>l</sub>*P<sub>l</sub>/Z<sub>l</sub>&nbsp;和 p<sub>r</sub>&nbsp;= f<sub>r</sub>*P<sub>r</sub>/Z<sub>r</sub>&nbsp;我们可以得到点P在左右两个摄像机坐标系中的观察点 p<sub>l</sub>和 p<sub>r&nbsp;</sub>应满足的极线约束关系为：(p<sub>r</sub>)<sup>T</sup>Ep<sub>l</sub>&nbsp;= 0。</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">注意到 E 是不满秩的，它的秩为2，那么 (p<sub>r</sub>)<sup>T</sup>Ep<sub>l</sub>&nbsp;= 0 表示的实际上是一条直线，也就是对极线。</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><strong>（2）Fundamental Matrix</strong></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">由于矩阵E并不包含摄像头内参信息，且E是面向摄像头坐标系的。实际上我们更感兴趣的是在图像像素坐标系上去研究一个像素点在另一视图上的对极线，这就需要用到摄像机的内参信息将摄像头坐标系和图像像素坐标系联系起来。在（1）中，p<sub>l</sub>和p<sub>r</sub>是物理坐标值，对应的像素坐标值为q<sub>l</sub>和q<sub>r</sub>，摄像头内参矩阵为M，则有：p=M<sup>-1</sup>q。从而：(p<sub>r</sub>)<sup>T</sup>Ep<sub>l</sub>&nbsp;= 0 &agrave; q<sub>r</sub><sup>T</sup>(M<sub>r</sub><sup>-1</sup>)<sup>T</sup>E M<sub>l</sub><sup>-1</sup>q<sub>l</sub>&nbsp;= 0。这里，我们就得到Fundamental Matrix：F = (M<sub>r</sub><sup>-1</sup>)<sup>T</sup>E M<sub>l</sub><sup>-1</sup>。并有 q<sub>r</sub><sup>T</sup>Fq<sub>l</sub>&nbsp;= 0。</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><strong>（3）OpenCV的相关计算</strong></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">由上面的分析可见，求取矩阵E和F关键在于旋转矩阵R和平移向量T的计算，而<a style="color: #ff9900" name="OLE_LINK6"></a><a style="color: #ff9900" name="OLE_LINK5"></a><a style="color: #ff9900" name="OLE_LINK10"></a><a style="color: #ff9900" name="OLE_LINK9"></a>cvStereoCalibrate的代码中大部分（cvcalibration.cpp的第1886-2180行）也是计算和优化R和T的。在<a style="color: #ff9900" name="OLE_LINK4"></a><a style="color: #ff9900" name="OLE_LINK3"></a>cvcalibration.cpp的第1913-1925行给出了计算R和T初始估计值的基本方法：</p><div id="scid:57F11A72-B0E5-49c7-9094-E3A15BD5B5E6:0e8d0c64-f6ce-432d-9fb3-7a14652c7874" class="wlWriterEditableSmartContent" style="font-family: Arial; font-size: 14px; line-height: 26px; padding: 0px; margin: 0px; display: inline; float: none"><pre style="white-space: pre-wrap; word-wrap: break-word; overflow: auto">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000">/*</span><span style="color: #008000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Compute initial estimate of pose&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; For each image, compute:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; R(om) is the rotation matrix of om&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; om(R) is the rotation vector of R&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; R_ref = R(om_right) * R(om_left)'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; T_ref_list = [T_ref_list; T_right - R_ref * T_left]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; om_ref_list = &#123;om_ref_list; om(R_ref)]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; om = median(om_ref_list)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T = median(T_ref_list)&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #008000">*/</span></pre></div><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">具体的计算过程比较繁杂，不好理解，这里就不讨论了，下面是计算矩阵E和F的代码：</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">&nbsp;</p><div id="scid:57F11A72-B0E5-49c7-9094-E3A15BD5B5E6:63ce3206-0407-4ca7-9de2-ab1bda1cf7ec" class="wlWriterEditableSmartContent" style="font-family: Arial; font-size: 14px; line-height: 26px; padding: 0px; margin: 0px; display: inline; float: none"><pre style="white-space: pre-wrap; word-wrap: break-word; overflow: auto">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff">if</span>( matE &#124;&#124; matF )&nbsp;&nbsp;&nbsp;&nbsp; &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #0000ff">double</span>* t = T_LR.data.db;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #0000ff">double</span> tx[] =&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #800080">0</span>, -t[<span style="color: #800080">2</span>], t[<span style="color: #800080">1</span>],&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; t[<span style="color: #800080">2</span>], <span style="color: #800080">0</span>, -t[<span style="color: #800080">0</span>],&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -t[<span style="color: #800080">1</span>], t[<span style="color: #800080">0</span>], <span style="color: #800080">0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125;;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CvMat Tx = cvMat(<span style="color: #800080">3</span>, <span style="color: #800080">3</span>, CV_64F, tx);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #0000ff">double</span> e[<span style="color: #800080">9</span>], f[<span style="color: #800080">9</span>];&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CvMat E = cvMat(<span style="color: #800080">3</span>, <span style="color: #800080">3</span>, CV_64F, e);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CvMat F = cvMat(<span style="color: #800080">3</span>, <span style="color: #800080">3</span>, CV_64F, f);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cvMatMul( &amp;Tx, &amp;R_LR, &amp;E );&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #0000ff">if</span>( matE )&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cvConvert( &amp;E, matE );&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #0000ff">if</span>( matF )&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #0000ff">double</span> ik[<span style="color: #800080">9</span>];&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CvMat iK = cvMat(<span style="color: #800080">3</span>, <span style="color: #800080">3</span>, CV_64F, ik);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cvInvert(&amp;K[<span style="color: #800080">1</span>], &amp;iK);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cvGEMM( &amp;iK, &amp;E, <span style="color: #800080">1</span>, <span style="color: #800080">0</span>, <span style="color: #800080">0</span>, &amp;E, CV_GEMM_A_T );&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cvInvert(&amp;K[<span style="color: #800080">0</span>], &amp;iK);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cvMatMul(&amp;E, &amp;iK, &amp;F);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cvConvertScale( &amp;F, matF, fabs(f[<span style="color: #800080">8</span>]) &gt; <span style="color: #800080">0</span> ? <span style="color: #800080">1</span>./f[<span style="color: #800080">8</span>] : <span style="color: #800080">1</span> );&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125;&nbsp;&nbsp;&nbsp;&nbsp; &#125;</pre></div><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">&nbsp;</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><strong><span style="font-size: medium">3． 通过双目定标得出的向量T中，Tx符号为什么是负的？</span></strong></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">&ldquo;<a style="color: #ff9900" name="OLE_LINK20"></a><a style="color: #ff9900" name="OLE_LINK19"></a><a style="color: #ff9900; text-decoration: none" href="http://blog.csdn.net/scyscyao/archive/2010/05/06/5562024.aspx">@scyscyao</a>：这个其实我也不是很清楚。个人的解释是，双目定标得出的T向量指向是从右摄像头指向左摄像头(也就是Tx为负)，而在OpenCV坐标系中，坐标的原点是在左摄像头的。因此，用作校准的时候，要把这个向量的三个分量符号都要换一下，最后求出的距离才会是正的。</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><a style="color: #ff9900; text-decoration: none" href="http://hi.csdn.net/attachment/201010/24/0_1287940679g4Gg.gif"><img style="border: 0px; max-width: 100%; display: block; float: none; margin-left: auto; margin-right: auto" src="http://hi.csdn.net/attachment/201010/24/0_1287940679Fuq7.gif" border="0" alt="clip_image016" title="clip_image016" width="318" height="237" /></a></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px" align="center">图12</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">但是这里还有一个问题，就是Learning OpenCV中Q的表达式，第四行第三列元素是-1/Tx，而在具体实践中，求出来的实际值是1/Tx。这里我和maxwellsdemon讨论下来的结果是，估计书上Q表达式里的这个负号就是为了抵消T向量的反方向所设的，但在实际写OpenCV代码的过程中，那位朋友却没有把这个负号加进去。&rdquo;</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><a style="color: #ff9900; text-decoration: none" href="http://hi.csdn.net/attachment/201010/24/0_1287940680ztqt.gif"><img style="border: 0px; max-width: 100%; display: block; float: none; margin-left: auto; margin-right: auto" src="http://hi.csdn.net/attachment/201010/24/0_12879406804RX0.gif" border="0" alt="clip_image018" title="clip_image018" width="530" height="242" /></a></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px" align="center">图13</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">scyscyao 的分析有一定道理，不过我觉得还有另外一种解释：如上图所示，摄像机C<sub>1</sub>（C<sub>2</sub>）与世界坐标系相对位置的外部参数为旋转矩阵R<sub>1</sub>（R<sub>2</sub>）和平移向量 t<sub>1</sub>（t<sub>2</sub>），如果下标1代表左摄像机，2代表右摄像机，显然在平移向量的水平分量上有&nbsp;<a style="color: #ff9900" name="OLE_LINK8"></a><a style="color: #ff9900" name="OLE_LINK7"></a><strong><span style="color: #ff0000">t<sub>1x&nbsp;</sub>&gt; t<sub>2</sub></span></strong><strong><sub><span style="color: #ff0000">x</span></sub></strong>；若以左摄像机C<sub>1</sub>为坐标原点，则可得到如上图所示的旋转矩阵R和平移向量t，由于<strong>t<sub>1x&nbsp;</sub>&gt; t<sub>2x</sub></strong>，则有 t<sub>x</sub>&nbsp;&lt; 0。</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">为了抵消T<sub>x</sub>为负，在矩阵Q中元素(4,3)应该加上负号，但在cvStereoRectify代码中并没有添加上，这就使得我们通过 cvReprojectImageTo3D 计算得到的三维数据都与实际值反号了。</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">&nbsp;</p><div id="scid:57F11A72-B0E5-49c7-9094-E3A15BD5B5E6:bab37bb2-21ea-449a-9062-d622094de445" class="wlWriterEditableSmartContent" style="font-family: Arial; font-size: 14px; line-height: 26px; padding: 0px; margin: 0px; display: inline; float: none"><pre style="white-space: pre-wrap; word-wrap: break-word; overflow: auto">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff">if</span>( matQ )&nbsp;&nbsp;&nbsp;&nbsp; &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #0000ff">double</span> q[] =&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #800080">1</span>, <span style="color: #800080">0</span>, <span style="color: #800080">0</span>, -cc_new[<span style="color: #800080">0</span>].x,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #800080">0</span>, <span style="color: #800080">1</span>, <span style="color: #800080">0</span>, -cc_new[<span style="color: #800080">0</span>].y,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #800080">0</span>, <span style="color: #800080">0</span>, <span style="color: #800080">0</span>, fc_new,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #800080">0</span>, <span style="color: #800080">0</span>, <span style="color: #800080">1</span>./_t[idx],&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (idx == <span style="color: #800080">0</span> ? cc_new[<span style="color: #800080">0</span>].x - cc_new[<span style="color: #800080">1</span>].x : cc_new[<span style="color: #800080">0</span>].y - cc_new[<span style="color: #800080">1</span>].y)/_t[idx]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125;;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CvMat Q = cvMat(<span style="color: #800080">4</span>, <span style="color: #800080">4</span>, CV_64F, q);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cvConvert( &amp;Q, matQ );&nbsp;&nbsp;&nbsp;&nbsp; &#125;</pre></div><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">&nbsp;</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">为了避免上述反号的情况，可以在计算得到Q矩阵后，添加以下代码更改 Q[3][2] 的值。</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">&nbsp;</p><div id="scid:57F11A72-B0E5-49c7-9094-E3A15BD5B5E6:fb1efb66-4d64-4cfa-9bc9-1bae7419c9dd" class="wlWriterEditableSmartContent" style="font-family: Arial; font-size: 14px; line-height: 26px; padding: 0px; margin: 0px; display: inline; float: none"><pre style="white-space: pre-wrap; word-wrap: break-word; overflow: auto"><span style="color: #008000">//</span><span style="color: #008000"> Q 是 Mat 类型矩阵，OpenCV2.1 C++ 模式</span><span style="color: #008000"> </span>&nbsp;&nbsp;&nbsp;&nbsp;Q.at&lt;<span style="color: #0000ff">double</span>&gt;(<span style="color: #800080">3</span>, <span style="color: #800080">2</span>) = -Q.at&lt;<span style="color: #0000ff">double</span>&gt;(<span style="color: #800080">3</span>, <span style="color: #800080">2</span>);&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #008000">//</span><span style="color: #008000"> Q 是 double 数组定义时</span><span style="color: #008000"> </span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff">double</span> Q[<span style="color: #800080">4</span>][<span style="color: #800080">4</span>];&nbsp;&nbsp;&nbsp;&nbsp; CvMat t_Q = cvMat(<span style="color: #800080">4</span>, <span style="color: #800080">4</span>, CV_64F, Q );&nbsp;&nbsp;&nbsp;&nbsp; cvStereoRectify(&hellip;);&nbsp;&nbsp;&nbsp;&nbsp; Q[<span style="color: #800080">3</span>][<span style="color: #800080">2</span>]=-Q[<span style="color: #800080">3</span>][<span style="color: #800080">2</span>];</pre></div><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">&nbsp;</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><a style="color: #ff9900" name="OLE_LINK16"></a><span style="font-size: medium"></span><a style="color: #ff9900" name="OLE_LINK15"></a><span style="font-size: medium"><strong>4． 双目校正</strong></span><span style="font-size: medium"><strong>原理及cvStereoRectify 的应用。</strong></span></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><a style="color: #ff9900; text-decoration: none" href="http://hi.csdn.net/attachment/201010/24/0_1287940680b5jr.gif"><img style="border: 0px; max-width: 100%; display: block; float: none; margin-left: auto; margin-right: auto" src="http://hi.csdn.net/attachment/201010/24/0_12879406809j06.gif" border="0" alt="clip_image020" title="clip_image020" width="671" height="391" /></a></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px" align="center">图14</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">如图14所示，双目校正是根据摄像头定标后获得的单目内参数据（焦距、成像原点、畸变系数）和双目相对位置关系（旋转矩阵和平移向量），分别对左右视图进行消除畸变和行对准，使得左右视图的成像原点坐标一致（CV_CALIB_ZERO_DISPARITY 标志位设置时发生作用）、两摄像头光轴平行、左右成像平面共面、对极线行对齐。在OpenCV2.1版之前，cvStereoRectify 的主要工作就是完成上述操作，校正后的显示效果如图14(c) 所示。可以看到校正后左右视图的边角区域是不规则的，而且对后续的双目匹配求取视差会产生影响，因为这些边角区域也参与到匹配操作中，其对应的视差值是无用的、而且一般数值比较大，在三维重建和机器人避障导航等应用中会产生不利影响。</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">因此，OpenCV2.1 版中<a style="color: #ff9900" name="OLE_LINK18"></a><a style="color: #ff9900" name="OLE_LINK17"></a>cvStereoRectify新增了4个参数用于调整双目校正后图像的显示效果，分别是 double alpha, CvSize newImgSize, CvRect* roi1, CvRect* roi2。下面结合图15-17简要介绍这4个参数的作用：</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">（1）newImgSize：校正后remap图像的分辨率。如果输入为(0,0)，则是与原图像大小一致。对于图像畸变系数比较大的，可以把newImgSize 设得大一些，以保留图像细节。</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">（2）alpha：图像剪裁系数，取值范围是-1、0~1。当<strong>取值为&nbsp;</strong><strong>0&nbsp;</strong>时，OpenCV会对校正后的图像进行缩放和平移，使得remap图像只显示有效像素（即去除不规则的边角区域），如图17所示，<strong>适用于机器人避障导航等应用</strong>；当alpha取值为1时，remap图像将显示所有原图像中包含的像素，该取值适用于畸变系数极少的高端摄像头；alpha取值在0-1之间时，OpenCV按对应比例保留原图像的边角区域像素。Alpha取值为-1时，OpenCV自动进行缩放和平移，其显示效果如图16所示。</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">（3）roi1, roi2：用于标记remap图像中包含有效像素的矩形区域。对应代码如下：</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">&nbsp;</p><div id="scid:57F11A72-B0E5-49c7-9094-E3A15BD5B5E6:51a7850a-6b54-4c17-aa28-59b779397f11" class="wlWriterEditableSmartContent" style="font-family: Arial; font-size: 14px; line-height: 26px; padding: 0px; margin: 0px; display: inline; float: none"><pre style="white-space: pre-wrap; word-wrap: break-word; overflow: auto"><span style="color: #800080">02433</span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #0000ff">if</span>(roi1) <span style="color: #800080">02434</span>&nbsp;&nbsp;&nbsp;&nbsp; &#123; <span style="color: #800080">02435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *roi1 = cv::Rect(cvCeil((inner1.x - cx1_0)*s + cx1), <span style="color: #800080">02436</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cvCeil((inner1.y - cy1_0)*s + cy1), <span style="color: #800080">02437</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cvFloor(inner1.width*s), cvFloor(inner1.height*s)) <span style="color: #800080">02438</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &amp; cv::Rect(<span style="color: #800080">0</span>, <span style="color: #800080">0</span>, newImgSize.width, newImgSize.height); <span style="color: #800080">02439</span>&nbsp;&nbsp;&nbsp;&nbsp; &#125; <span style="color: #800080">02440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #800080">02441</span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #0000ff">if</span>(roi2) <span style="color: #800080">02442</span>&nbsp;&nbsp;&nbsp;&nbsp; &#123; <span style="color: #800080">02443</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *roi2 = cv::Rect(cvCeil((inner2.x - cx2_0)*s + cx2), <span style="color: #800080">02444</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cvCeil((inner2.y - cy2_0)*s + cy2), <span style="color: #800080">02445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cvFloor(inner2.width*s), cvFloor(inner2.height*s)) <span style="color: #800080">02446</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &amp; cv::Rect(<span style="color: #800080">0</span>, <span style="color: #800080">0</span>, newImgSize.width, newImgSize.height); <span style="color: #800080">02447</span>&nbsp;&nbsp;&nbsp;&nbsp; &#125; </pre></div><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">&nbsp;</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><a style="color: #ff9900; text-decoration: none" href="http://hi.csdn.net/attachment/201010/24/0_1287940680s8WL.gif"><img style="border: 0px; max-width: 100%; display: inline" src="http://hi.csdn.net/attachment/201010/24/0_1287940680aC1I.gif" border="0" alt="clip_image022" title="clip_image022" width="675" height="277" /></a></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">图15</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><a style="color: #ff9900; text-decoration: none" href="http://hi.csdn.net/attachment/201010/24/0_1287940681s0Ep.gif"><img style="border: 0px; max-width: 100%; display: inline" src="http://hi.csdn.net/attachment/201010/24/0_1287940681TEIU.gif" border="0" alt="clip_image024" title="clip_image024" width="674" height="273" /></a></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">图16</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><a style="color: #ff9900; text-decoration: none" href="http://hi.csdn.net/attachment/201010/24/0_1287940681EXd4.gif"><img style="border: 0px; max-width: 100%; display: inline" src="http://hi.csdn.net/attachment/201010/24/0_1287940681UU9Y.gif" border="0" alt="clip_image026" title="clip_image026" width="674" height="274" /></a></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">图17</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">在cvStereoRectify 之后，一般紧接着使用 cvInitUndistortRectifyMap 来产生校正图像所需的变换参数（mapx, mapy）。</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">&nbsp;</p><div id="scid:57F11A72-B0E5-49c7-9094-E3A15BD5B5E6:12ab2575-2fc0-4ec4-b37b-e9379639607e" class="wlWriterEditableSmartContent" style="font-family: Arial; font-size: 14px; line-height: 26px; padding: 0px; margin: 0px; display: inline; float: none"><pre style="white-space: pre-wrap; word-wrap: break-word; overflow: auto"><span style="color: #808080">////////////////////////////////////////////////////////////////////////</span><span style="color: #008000">//</span><span style="color: #808080"> </span><span style="color: #008000">//</span><span style="color: #008000"> 执行双目校正 </span><span style="color: #008000">//</span><span style="color: #008000"> 利用BOUGUET方法或HARTLEY方法来校正图像</span><span style="color: #008000"> </span>&nbsp;&nbsp;&nbsp;&nbsp;mx1 = cvCreateMat( imageSize.height, imageSize.width, CV_32F );&nbsp;&nbsp;&nbsp;&nbsp; my1 = cvCreateMat( imageSize.height, imageSize.width, CV_32F );&nbsp;&nbsp;&nbsp;&nbsp; mx2 = cvCreateMat( imageSize.height, imageSize.width, CV_32F );&nbsp;&nbsp;&nbsp;&nbsp; my2 = cvCreateMat( imageSize.height, imageSize.width, CV_32F );&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #0000ff">double</span> R1[<span style="color: #800080">3</span>][<span style="color: #800080">3</span>], R2[<span style="color: #800080">3</span>][<span style="color: #800080">3</span>], P1[<span style="color: #800080">3</span>][<span style="color: #800080">4</span>], P2[<span style="color: #800080">3</span>][<span style="color: #800080">4</span>], Q[<span style="color: #800080">4</span>][<span style="color: #800080">4</span>];&nbsp;&nbsp;&nbsp;&nbsp; CvMat t_R1 = cvMat(<span style="color: #800080">3</span>, <span style="color: #800080">3</span>, CV_64F, R1);&nbsp;&nbsp;&nbsp;&nbsp; CvMat t_R2 = cvMat(<span style="color: #800080">3</span>, <span style="color: #800080">3</span>, CV_64F, R2);&nbsp;&nbsp;&nbsp;&nbsp; CvMat t_Q = cvMat(<span style="color: #800080">4</span>, <span style="color: #800080">4</span>, CV_64F, Q );&nbsp;&nbsp;&nbsp;&nbsp; CvRect roi1, roi2;&nbsp;&nbsp;<span style="color: #008000">//</span><span style="color: #008000"> IF BY CALIBRATED (BOUGUET'S METHOD)&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #008000"> </span>&nbsp;&nbsp;&nbsp;&nbsp;CvMat t_P1 = cvMat(<span style="color: #800080">3</span>, <span style="color: #800080">4</span>, CV_64F, P1);&nbsp;&nbsp;&nbsp;&nbsp; CvMat t_P2 = cvMat(<span style="color: #800080">3</span>, <span style="color: #800080">4</span>, CV_64F, P2);&nbsp;&nbsp;&nbsp;&nbsp; cvStereoRectify( &amp;t_M1, &amp;t_M2, &amp;t_D1, &amp;t_D2, imageSize,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &amp;t_R, &amp;t_T, &amp;t_R1, &amp;t_R2, &amp;t_P1, &amp;t_P2, &amp;t_Q,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CV_CALIB_ZERO_DISPARITY,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #800080">0</span>, imageSize, &amp;roi1, &amp;roi2);&nbsp;&nbsp;<span style="color: #008000">//</span><span style="color: #008000"> Precompute maps for cvRemap()</span><span style="color: #008000"> </span>&nbsp;&nbsp;&nbsp;&nbsp;cvInitUndistortRectifyMap(&amp;t_M1,&amp;t_D1,&amp;t_R1,&amp;t_P1, mx1, my1);&nbsp;&nbsp;&nbsp;&nbsp; cvInitUndistortRectifyMap(&amp;t_M2,&amp;t_D2,&amp;t_R2,&amp;t_P2, mx2, my2); </pre></div><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">&nbsp;</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: medium"><strong>5． 为什么cvStereoRectify求出的Q矩阵cx, cy, f都与原来的不同？</strong></span></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">&ldquo;<a style="color: #ff9900; text-decoration: none" href="http://blog.csdn.net/scyscyao/archive/2010/05/06/5562024.aspx">@scyscyao</a>：在实际测量中，由于摄像头摆放的关系，左右摄像头的f, cx, cy都是不相同的。而为了使左右视图达到完全平行对准的理想形式从而达到数学上运算的方便，立体校准所做的工作事实上就是在左右像重合区域最大的情况下，让两个摄像头光轴的前向平行，并且让左右摄像头的f, cx, cy相同。因此，Q矩阵中的值与两个instrinsic矩阵的值不一样就可以理解了。&rdquo;</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">注：校正后得到的变换矩阵Q，Q[0][3]、Q[1][3]存储的是校正后左摄像头的原点坐标（principal point）cx和cy，Q[2][3]是焦距f。</p>
]]>
</description>
</item><item>
<link>http://i.renjihe.com/blog/read.php?7439</link>
<title><![CDATA[双目测距与三维重建的OpenCV实现问题集锦（一）图像获取与单目定标]]></title> 
<author>renjihe1988 &lt;admin@yourname.com&gt;</author>
<category><![CDATA[OpenCV]]></category>
<pubDate>Fri, 29 Jul 2016 07:02:43 +0000</pubDate> 
<guid>http://i.renjihe.com/blog/read.php?7439</guid> 
<description>
<![CDATA[ 
	<p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><span style="color: #0000ff"><strong><span style="font-size: medium">双目测距的基本原理</span></strong></span></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><a style="color: #ff9900; text-decoration: none" href="http://hi.csdn.net/attachment/201010/24/0_1287878649g0L5.gif"><img style="border: 0px; max-width: 100%; display: block; float: none; margin-left: auto; margin-right: auto" src="http://hi.csdn.net/attachment/201010/24/0_1287878650Yncc.gif" border="0" alt="clip_image002[10]" title="clip_image002[10]" width="675" height="357" /></a></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">如上图所示，双目测距主要是利用了目标点在左右两幅视图上成像的横向坐标直接存在的差异（即视差<a style="color: #ff9900; text-decoration: none" href="http://hi.csdn.net/attachment/201010/24/0_1287878650lBRZ.gif"><img style="border: 0px; max-width: 100%; display: inline" src="http://hi.csdn.net/attachment/201010/24/0_1287878650L8zp.gif" border="0" alt="clip_image004" title="clip_image004" width="64" height="19" />&nbsp;</a>）与目标点到成像平面的距离Z存在着反比例的关系：Z=fT/d。&ldquo;<a style="color: #ff9900; text-decoration: none" href="http://blog.csdn.net/scyscyao/archive/2010/05/06/5562024.aspx">@scyscyao</a>&nbsp;：<strong><span style="color: #ff0000">在OpenCV中，f的量纲是像素点，T的量纲由定标板棋盘格的实际尺寸和用户输入值确定，一般是以毫米为单位（当然为了精度提高也可以设置为0.1毫米量级），d=xl-xr的量纲也是像素点。因此分子分母约去，Z的量纲与T相同。</span>&nbsp;</strong>&rdquo;</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><a style="color: #ff9900; text-decoration: none" href="http://hi.csdn.net/attachment/201010/24/0_1287878650Aa0A.gif"><img style="border: 0px; max-width: 100%; display: block; float: none; margin-left: auto; margin-right: auto" src="http://hi.csdn.net/attachment/201010/24/0_1287878650MiGT.gif" border="0" alt="clip_image006" title="clip_image006" width="318" height="237" /></a></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">假设目标点在左视图中的坐标为（x,y），在左右视图上形成的视差为d，目标点在以左摄像头光心为原点的世界坐标系中的坐标为（X,Y,Z），则存在上图所示的变换矩阵Q，使得 Q*[x y d 1]&rsquo; = [X Y Z W]&rsquo;。</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">&ldquo;<a style="color: #ff9900; text-decoration: none" href="http://blog.csdn.net/scyscyao/archive/2010/05/06/5562024.aspx">@scyscyao</a>&nbsp;：为了精确地求得某个点在三维空间里的距离Z，我们需要获得的参数有焦距f、视差d、摄像头中心距Tx。如果还需要获得X坐标和Y坐标的话，那么还需要额外知道左右像平面的坐标系与立体坐标系中原点的偏移cx和cy。其中f, Tx, cx和cy可以通过立体标定获得初始值，并通过立体校准优化，使得两个摄像头在数学上完全平行放置，并且左右摄像头的cx, cy和f相同(也就是实现图2中左右视图完全平行对准的理想形式)。而立体匹配所做的工作，就是在之前的基础上，求取最后一个变量：视差d(这个d一般需要达到亚像素精度)。从而最终完成求一个点三维坐标所需要的准备工作。<strong>在清楚了上述原理之后，我们也就知道了，所有的这几步：<span style="color: #ff0000">标定、校准和匹配，都是围绕着如何更精确地获得</span>&nbsp;</strong><span style="color: #ff0000"><strong>f, d, Tx, cx</strong>&nbsp;<strong>和cy</strong>&nbsp;</span><strong><span style="color: #ff0000">而设计的</span>&nbsp;。</strong>&nbsp;&rdquo;</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">&nbsp;</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><span style="color: #0000ff"><strong><span style="font-size: medium">一、图像的获取</span></strong></span></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: small"><strong>1． 如何打开两个或多个摄像头？</strong></span></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">可以通过OpenCV的capture类函数或者结合DirectShow来实现双摄像头的捕获，具体可见我的读书笔记《<a style="color: #ff9900; text-decoration: none" href="http://blog.csdn.net/chenyusiyuan/archive/2009/10/08/4643313.aspx">OpenCV学习笔记（6）基于 VC+OpenCV+DirectShow 的多个摄像头同步工作</a>&nbsp;》。文中曾提及不能用cvCreateCameraCapture 同时读取两个摄像头，不过后来一位研友来信讨论说<span style="color: #ff0000"><strong>只要把摄像头指针的创建代码按照摄像头序号降序执行，就可以顺利打开多个摄像头</strong>&nbsp;</span>，例如：</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">&nbsp;</p><div id="scid:57F11A72-B0E5-49c7-9094-E3A15BD5B5E6:0bb61c53-3930-485a-b7dd-53355ef90f33" class="wlWriterEditableSmartContent" style="font-family: Arial; font-size: 14px; line-height: 26px; padding: 0px; margin: 0px; display: inline; float: none"><pre style="white-space: pre-wrap; word-wrap: break-word; overflow: auto"><div class="dp-highlighter bg_c-sharp" style="font-family: Consolas, 'Courier New', Courier, mono, serif; width: 936.531px; overflow-y: hidden; overflow-x: auto; padding-top: 1px; position: relative; margin: 18px 0px !important; background-color: #e7e5dc"><div class="bar" style="padding-left: 45px"><div class="tools" style="padding: 3px 8px 10px 10px; font-stretch: normal; font-size: 9px; line-height: normal; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; color: silver; border-left-width: 3px; border-left-style: solid; border-left-color: #6ce26c; background-color: #f8f8f8"><strong>[c-sharp]</strong> <a style="color: #a0a0a0; text-decoration: none; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; display: inline-block; width: 16px; height: 16px; text-indent: -2000px; background-image: url('http://static.blog.csdn.net/scripts/SyntaxHighlighter/styles/images/default/ico_plain.gif'); background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat" href="http://blog.csdn.net/chenyusiyuan/article/details/5961769#" title="view plain" class="ViewSource">view plain</a><span> <a style="color: #a0a0a0; text-decoration: none; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; display: inline-block; width: 16px; height: 16px; text-indent: -2000px; background-image: url('http://static.blog.csdn.net/scripts/SyntaxHighlighter/styles/images/default/ico_copy.gif'); background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat" href="http://blog.csdn.net/chenyusiyuan/article/details/5961769#" title="copy" class="CopyToClipboard">copy</a></span><span> </span></div></div><ol class="dp-c" style="padding: 0px; border: none; color: #5c5c5c; margin: 0px 0px 1px 45px !important; background-color: #ffffff"><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">CvCapture*&nbsp;capture2&nbsp;=&nbsp;cvCreateCameraCapture(&nbsp;1&nbsp;);&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">CvCapture*&nbsp;capture1&nbsp;=&nbsp;cvCreateCameraCapture(&nbsp;0&nbsp;);&nbsp;&nbsp;</span></li></ol></div> <br /> <br /> <br />&nbsp;&nbsp; <br /> </pre></div><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">采用DirectShow的方式读入时：</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">&nbsp;</p><div id="scid:57F11A72-B0E5-49c7-9094-E3A15BD5B5E6:ccfe1f6e-8db1-4855-8855-e8847847bef0" class="wlWriterEditableSmartContent" style="font-family: Arial; font-size: 14px; line-height: 26px; padding: 0px; margin: 0px; display: inline; float: none"><pre style="white-space: pre-wrap; word-wrap: break-word; overflow: auto"><div class="dp-highlighter bg_c-sharp" style="font-family: Consolas, 'Courier New', Courier, mono, serif; width: 936.531px; overflow-y: hidden; overflow-x: auto; padding-top: 1px; position: relative; margin: 18px 0px !important; background-color: #e7e5dc"><div class="bar" style="padding-left: 45px"><div class="tools" style="padding: 3px 8px 10px 10px; font-stretch: normal; font-size: 9px; line-height: normal; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; color: silver; border-left-width: 3px; border-left-style: solid; border-left-color: #6ce26c; background-color: #f8f8f8"><strong>[c-sharp]</strong> <a style="color: #a0a0a0; text-decoration: none; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; display: inline-block; width: 16px; height: 16px; text-indent: -2000px; background-image: url('http://static.blog.csdn.net/scripts/SyntaxHighlighter/styles/images/default/ico_plain.gif'); background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat" href="http://blog.csdn.net/chenyusiyuan/article/details/5961769#" title="view plain" class="ViewSource">view plain</a><span> <a style="color: #a0a0a0; text-decoration: none; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; display: inline-block; width: 16px; height: 16px; text-indent: -2000px; background-image: url('http://static.blog.csdn.net/scripts/SyntaxHighlighter/styles/images/default/ico_copy.gif'); background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat" href="http://blog.csdn.net/chenyusiyuan/article/details/5961769#" title="copy" class="CopyToClipboard">copy</a></span><span> </span></div></div><ol class="dp-c" style="padding: 0px; border: none; color: #5c5c5c; margin: 0px 0px 1px 45px !important; background-color: #ffffff"><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">camera2.OpenCamera(1,&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">false</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">,&nbsp;640,480);&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">camera1.OpenCamera(0,&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">false</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">,&nbsp;640,480);&nbsp;&nbsp;</span></span></li></ol></div> <br />&nbsp;&nbsp;<br /> </pre></div><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">&nbsp;</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">这样就可以同时采集两个摄像头。我也验证过这种方法确实有效，而且还解决了我遇到的cvSetCaptureProperty调整帧画面大小速度过慢的问题。当摄像头的打开或创建代码按照摄像头序号从0开始以升序编写执行时，使用cvSetCaptureProperty就会出现第一个摄像头（序号为0）的显示窗口为灰色（即无图像）、且程序运行速度缓慢的现象。而改为降序编写执行后，则能正常、实时地显示各摄像头的画面。具体原因有待分析讨论。</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">&nbsp;</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: small"><strong>2． 如何实现多个摄像头帧画面的同步抓取？</strong></span></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">在单摄像头情况下用 cvQueryFrame 即可抓取一帧画面，实际上这个函数是由两个routine组成的：cvGrabFrame和cvRetrieveFrame（详见Learning OpenCV第103页）。cvGrabFrame将摄像头帧画面即时复制到内部缓存中，然后通过cvRetrieveFrame把我们预定义的一个IplImage型空指针指向缓存内的帧数据。注意这时我们并没有真正把帧数据取出来，它还保存在OpenCV的内部缓存中，下一次读取操作就会被覆盖掉。所以一般我们要另外定义一个IplImage来复制所抓取的帧数据，然后对这个新IplImage进行操作。</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">由上面的解释也可以看出，cvGrabFrame的作用就是尽可能快的将摄像头画面数据复制到计算机缓存，这个功能就方便我们实现对多个摄像头的同步抓取，即首先用cvGrabFrame依次抓取各个CvCapture*，然后再用cvRetrieveFrame把帧数据取出来。例如：</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">&nbsp;</p><div id="scid:57F11A72-B0E5-49c7-9094-E3A15BD5B5E6:5f77bfed-4496-4a87-8f57-8627523a53e2" class="wlWriterEditableSmartContent" style="font-family: Arial; font-size: 14px; line-height: 26px; padding: 0px; margin: 0px; display: inline; float: none"><pre style="white-space: pre-wrap; word-wrap: break-word; overflow: auto"><div class="dp-highlighter bg_c-sharp" style="font-family: Consolas, 'Courier New', Courier, mono, serif; width: 936.531px; overflow-y: hidden; overflow-x: auto; padding-top: 1px; position: relative; margin: 18px 0px !important; background-color: #e7e5dc"><div class="bar" style="padding-left: 45px"><div class="tools" style="padding: 3px 8px 10px 10px; font-stretch: normal; font-size: 9px; line-height: normal; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; color: silver; border-left-width: 3px; border-left-style: solid; border-left-color: #6ce26c; background-color: #f8f8f8"><strong>[c-sharp]</strong> <a style="color: #a0a0a0; text-decoration: none; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; display: inline-block; width: 16px; height: 16px; text-indent: -2000px; background-image: url('http://static.blog.csdn.net/scripts/SyntaxHighlighter/styles/images/default/ico_plain.gif'); background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat" href="http://blog.csdn.net/chenyusiyuan/article/details/5961769#" title="view plain" class="ViewSource">view plain</a><span> <a style="color: #a0a0a0; text-decoration: none; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; display: inline-block; width: 16px; height: 16px; text-indent: -2000px; background-image: url('http://static.blog.csdn.net/scripts/SyntaxHighlighter/styles/images/default/ico_copy.gif'); background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat" href="http://blog.csdn.net/chenyusiyuan/article/details/5961769#" title="copy" class="CopyToClipboard">copy</a></span><span> </span></div></div><ol class="dp-c" style="padding: 0px; border: none; color: #5c5c5c; margin: 0px 0px 1px 45px !important; background-color: #ffffff"><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">cvGrabFrame(&nbsp;lfCam&nbsp;);&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">cvGrabFrame(&nbsp;riCam&nbsp;);&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">frame1&nbsp;=&nbsp;cvRetrieveFrame(&nbsp;lfCam&nbsp;);&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">frame2&nbsp;=&nbsp;cvRetrieveFrame(&nbsp;riCam&nbsp;);&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">if</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">(&nbsp;!frame1&#124;&#124;&nbsp;!frame2)&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">break</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">;&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">cvCopyImage(frame1,&nbsp;image1);&nbsp;&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">cvCopyImage(frame2,&nbsp;image2);&nbsp;&nbsp;</span></li></ol></div> <br /> <br /> <br />&nbsp;&nbsp; <br /> <br /> <br /> </pre></div><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: medium"><span style="color: #0000ff"><strong>二、摄像头定标</strong></span></span></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">摄像头定标一般都需要一个放在摄像头前的特制的标定参照物（棋盘纸），摄像头获取该物体的图像，并由此计算摄像头的内外参数。标定参照物上的每一个特征点相对于世界坐标系的位置在制作时应精确测定，世界坐标系可选为参照物的物体坐标系。在得到这些已知点在图像上的投影位置后，可计算出摄像头的内外参数。</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><a style="color: #ff9900; text-decoration: none" href="http://hi.csdn.net/attachment/201010/24/0_1287878651oVd3.gif"><img style="border: 0px; max-width: 100%; display: block; float: none; margin-left: auto; margin-right: auto" src="http://hi.csdn.net/attachment/201010/24/0_1287878651vDSH.gif" border="0" alt="clip_image008" title="clip_image008" width="442" height="285" /></a></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">如上图所示，摄像头由于光学透镜的特性使得成像存在着径向畸变，可由三个参数k1,k2,k3确定；由于装配方面的误差，传感器与光学镜头之间并非完全平行，因此成像存在切向畸变，可由两个参数p1,p2确定。单个摄像头的定标主要是计算出摄像头的内参（焦距f和成像原点cx,cy、五个畸变参数（一般只需要计算出k1,k2,p1,p2，对于鱼眼镜头等径向畸变特别大的才需要计算k3））以及外参（标定物的世界坐标）。&nbsp;<span style="font-size: x-small"><span style="font-size: medium"><span style="font-family: Calibri, sans-serif">OpenCV</span>&nbsp;<span style="font-family: 宋体">中使用的求解焦距和成像原点的算法是基于张正友的方法（</span>&nbsp;<span style="font-family: Calibri, sans-serif"><a style="color: #ff9900; text-decoration: none" href="http://research.microsoft.com/~zhang/Papers/TR98-71.pdf">pdf</a>&nbsp;</span><span style="font-family: 宋体">），而求解畸变参数是基于</span>&nbsp;<span style="font-family: Calibri, sans-serif">Brown</span>&nbsp;<span style="font-family: 宋体">的方法（</span>&nbsp;<span style="font-family: Calibri, sans-serif"><a style="color: #ff9900; text-decoration: none" href="http://www.ifp.uni-stuttgart.de/lehre/vorlesungen/Aero/Brown71.pdf">pdf</a>&nbsp;</span><span style="font-family: 宋体">）。</span></span></span></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: small"><strong><br /></strong></span></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: small"><strong>1． 图像坐标系、摄像头坐标系和世界坐标系的关系</strong></span></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><a style="color: #ff9900; text-decoration: none" href="http://hi.csdn.net/attachment/201010/24/0_1287878651LYLT.gif"><img style="border: 0px; max-width: 100%; display: inline" src="http://hi.csdn.net/attachment/201010/24/0_1287878651orgZ.gif" border="0" alt="clip_image010" title="clip_image010" width="423" height="262" />&nbsp;</a><a style="color: #ff9900; text-decoration: none" href="http://hi.csdn.net/attachment/201010/24/0_1287878651Nh9T.gif"><img style="border: 0px; max-width: 100%; display: inline" src="http://hi.csdn.net/attachment/201010/24/0_12878786516hvL.gif" border="0" alt="clip_image012" title="clip_image012" width="446" height="267" /></a></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">摄像头成像几何关系，其中O<sub>c</sub>&nbsp;点称为摄像头（透镜）的光心，X<sub>c</sub>&nbsp;轴和Y<sub>c</sub>&nbsp;轴与图像的x轴和Y轴平行，Z<sub>c</sub>&nbsp;轴为摄像头的光轴，它与图像平面垂直。光轴与图像平面的交点O<sub>1</sub>&nbsp;，即为图像坐标系的原点。由点O<sub>c</sub>&nbsp;与X<sub>c</sub>&nbsp;、Y<sub>c</sub>&nbsp;、Z<sub>c</sub>&nbsp;轴组成的坐标系称为摄像头坐标系，O<sub>c</sub>&nbsp;O<sub>1</sub>&nbsp;的距离为摄像头焦距，用f表示。</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">图像坐标系是一个二维平面，又称为像平面，&ldquo;<a style="color: #ff9900; text-decoration: none" href="http://blog.csdn.net/scyscyao/archive/2010/05/06/5562024.aspx">@scyscyao</a>&nbsp;：实际上就是摄像头的CCD传感器的表面。每个CCD传感器都有一定的尺寸，也有一定的分辨率，这个就确定了毫米与像素点之间的转换关系。举个例子，CCD的尺寸是8mm X 6mm，帧画面的分辨率设置为640X480，那么毫米与像素点之间的转换关系就是80pixel/mm。&rdquo;设CCD传感器每个像素点的物理大小为dx*dy，相应地，就有 dx=dy=1/80。</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><strong><span style="font-size: small"><br /></span></strong></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><strong><span style="font-size: small">2． 进行摄像头定标时，棋盘方格的实际大小 square_size （默认为 1.0f ）的设置对定标参数是否有影响？</span></strong></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">&ldquo;<a style="color: #ff9900; text-decoration: none" href="http://blog.csdn.net/scyscyao/archive/2010/05/06/5562024.aspx">@scyscyao</a>&nbsp;：当然有。在标定时，需要指定一个棋盘方格的长度，这个长度(一般以毫米为单位，如果需要更精确可以设为0.1毫米量级)与实际长度相同，标<a style="color: #ff9900; text-decoration: none" href="mailto:"></a>&nbsp;定得出的结果才能用于实际距离测量。一般如果尺寸设定准确的话，通过立体标定得出的Translation向量的第一个分量Tx的绝对值就是左右摄像头的中心距。一般可以用这个来验证立体标定的准确度。比如我设定的棋盘格大小为270 (27mm)，最终得出的Tx大小就是602.8 (60.28mm)，相当精确。&rdquo;</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">&nbsp;</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: small"><strong>3． 定标所得的摄像头内参数，即焦距和原点坐标，其数值单位都是一致的吗？怎么把焦距数值换算为实际的物理量？</strong></span></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">&ldquo;<a style="color: #ff9900; text-decoration: none" href="http://blog.csdn.net/chenyusiyuan/archive/2009/12/25/5072597.aspx">@wobject</a>&nbsp;：是的，都是以像素为单位。假设像素点的大小为k x l，单位为mm，则fx = f / k， fy = f / (l * sinA)， A一般假设为 90&deg;，是指摄像头坐标系的偏斜度（就是镜头坐标和CCD是否垂直）。摄像头矩阵（内参）的目的是把图像的点从图像坐标转换成实际物理的三维坐标。因此其中的fx, fy, cx, cy 都是使用类似上面的纲量。同样，Q 中的变量 f，cx, cy 也应该是一样的。&rdquo;</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">&nbsp;</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: small"><strong>4． 棋盘图像数目应该取多少对摄像头定标比较适宜？</strong></span></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">OpenCV中文论坛上piao的帖子《<a style="color: #ff9900; text-decoration: none" href="http://www.opencv.org.cn/forum/viewtopic.php?f=1&amp;t=4603#p16571">在OpenCV中用cvCalibrateCamera2进行相机标定(附程序)</a>&nbsp;》中指出影响摄像头定标结果的准确性和稳定性的因素主要有三个：</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">（1） 标定板所在平面与成像平面(image plane)之间的夹角；</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">（2） 标定时拍摄的图片数目（棋盘图像数目）；</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">（3） 图像上角点提取的不准确。</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">感觉OpenCV1.2以后对图像角点的提取准确度是比较高的，cvFindChessboardCorners 和 cvFindCornerSubPix结合可以获得很好的角点检测效果（hqhuang1在《<a style="color: #ff9900; text-decoration: none" href="http://www.opencv.org.cn/forum/viewtopic.php?f=1&amp;t=8777">[HQ]角点检测(Corner Detection) cvFindCornerSubPix 使用范例</a>&nbsp;》中给出了相关的应用范例）。因此，影响定标结果较大的就是标定板与镜头的夹角和棋盘图像数目，在实际定标过程中，我感觉<strong><span style="color: #ff0000">棋盘图像数目应该大于20张，每成功检测一次完整的棋盘角点就要变换一下标定板的姿态（包括角度、距离）</span>&nbsp;</strong>。</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">&nbsp;</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: small"><strong>5． 单目定标函数cvCalibrateCamera2采用怎样的 flags 比较合适？</strong></span></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">由于一般镜头只需要计算k1,k2,p1,p2四个参数，所以我们首先要设置 CV_CALIB_FIX_K3；其次，如果所用的摄像头不是高端的、切向畸变系数非常少的，则不要设置 CV_CALIB_ZERO_TANGENT_DIST，否则单目校正误差会很大；如果事先知道摄像头内参的大概数值，并且cvCalibrateCamera2函数的第五个参数intrinsic_matrix非空，则也可设置 CV_CALIB_USE_INTRINSIC_GUESS ，以输入的intrinsic_matrix为初始估计值来加快内参的计算；其它的 flag 一般都不需要设置，对单目定标的影响不大。</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">&nbsp;</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">P.S. 使用OpenCV进行摄像机定标虽然方便，但是定标结果往往不够准确和稳定，最好是使用&nbsp;<a style="color: #ff9900; text-decoration: none" href="http://www.vision.caltech.edu/bouguetj/calib_doc/" target="_blank">Matlab标定工具箱</a>&nbsp;来进行定标，再将定标结果取回来用于立体匹配和视差计算。工具箱的使用<a style="color: #ff9900; text-decoration: none" href="http://www.vision.caltech.edu/bouguetj/calib_doc/" target="_blank">官方主页</a>&nbsp;有图文并茂的详细说明，此外，有两篇博文也进行了不错的总结，推荐阅读：</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">（1）<a style="color: #ff9900; text-decoration: none" href="http://blog.csdn.net/scyscyao/archive/2010/04/02/5443341.aspx" target="_blank">分享一些OpenCV实现立体视觉的经验</a></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">（2）<a style="color: #ff9900; text-decoration: none" href="http://blog.csdn.net/liliemily/archive/2010/08/05/5790314.aspx" target="_blank">Matlab标定工具箱使用的一些注意事项</a></p>
]]>
</description>
</item><item>
<link>http://i.renjihe.com/blog/read.php?6375</link>
<title><![CDATA[OpenGL与OpenCV实现增强现实]]></title> 
<author>renjihe1988 &lt;admin@yourname.com&gt;</author>
<category><![CDATA[OpenCV]]></category>
<pubDate>Mon, 09 Feb 2015 08:31:18 +0000</pubDate> 
<guid>http://i.renjihe.com/blog/read.php?6375</guid> 
<description>
<![CDATA[ 
	http://www.itnose.net/detail/6162169.html<br /><br /><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px">很久没有写博客了，最近在学习计算机视觉的相关知识，于是写了一个AR的小Demo。</p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px">该程序通过OpenCV实现对Marker的识别和定位，然后通过OpenGL将虚拟物体叠加到摄像头图像下，实现增强现实。首先来看看我们使用的Marker：</p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px"><img style="border: 0px; max-width: 720px" src="http://www.itnose.net/img/20141129/10163064.png" border="0" alt="OpenGL与OpenCV实现增强现实0" /><br /></p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px">这是众多Marker中的一个，它们都被一圈的黑色边框所包围，边框之中是编码信息，白色代表1，黑色代表0。将每一行作为一个字，那么每个字有5bits。其中，1、3、5位为校验位，2、4位为信息位。也就是说，整个Marker的信息位只有10bits，所以最多可表示1024个数（0~1023）。这种编码方式实际上是汉明码的变种，唯一区别在于它的首位是对应汉明码首位的反（比如汉明码是00000，那么Marker中的编码为10000）。这么做的目的是防止某一行全黑，从而提高识别率。汉明码还有另一大优势??不具有旋转对称性，因此程序能通过汉明码确定Marker的方向，因此从Marker中解码的信息是唯一的。</p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px"><br /></p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px"><strong>一、Marker的检测与识别</strong></p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px">我们首先实现一个类，用于检测图像中的Marker，解码信息，并计算Marker相对于摄像头的坐标位置。</p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px">检测部分比较简单。首先将输入图像进行灰度变换，然后对灰度图像进行自适应二值化。之所以使用自适应二值化，是因为它能更好的适应光照的变化。但有一点要注意，很多朋友使用自适应二值化后表示得到的结果很像边缘检测的结果，那是因为自适应窗口过小造成的。使用自适应二值化时，窗口的大小应大于二值化目标的大小，否则得到的阈值不具有适应性。在自适应二值化之后，为了消除噪音或小块，可以加以形态学开运算。以上几部可分别得到下列图像（其中二值化的结果经过了反色处理，方便以后的轮廓提取）。</p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px"><img style="border: 0px; max-width: 720px" src="http://www.itnose.net/img/20141129/10163065.png" border="0" alt="OpenGL与OpenCV实现增强现实1" /></p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px"><img style="border: 0px; max-width: 720px" src="http://www.itnose.net/img/20141129/10163066.png" border="0" alt="OpenGL与OpenCV实现增强现实2" /></p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px"><img style="border: 0px; max-width: 720px" src="http://www.itnose.net/img/20141129/10163067.png" border="0" alt="OpenGL与OpenCV实现增强现实3" /><br /></p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px"><br /></p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px">得到二值图像后，就可以使用OpenCV中的findContours来提取轮廓了。一副二值图像当中的轮廓有很多，其中有一些轮廓很小，我们通过一个阈值将这些过小的轮廓排除。排除过小轮廓后，就可以对轮廓进行多边形近似了。由于我们的Marker是正方形，其多边形近似结果应该满足以下条件：</p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px">1、只有4个顶点</p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px">2、一定是凸多边形</p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px">3、每一个边的长度不能过小</p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px">通过以上几个条件，我们可以排除绝大部分轮廓，从而找到最有可能为Marker的部分。找到这样的候选轮廓后，我们将它的多边形四个顶点保存下来，并做适当的调整，使所有顶点逆时针排序。代码如下：</p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px"></p><pre class="sycode" style="white-space: pre-wrap; word-wrap: break-word; margin-top: 10px; margin-bottom: 10px; padding: 5px; font-family: 'Courier New', Arial; color: #333333; letter-spacing: 1px; font-size: 10pt; border-color: rgb(221, 221, 221) rgb(221, 221, 221) rgb(221, 221, 221) rgb(108, 226, 108); border-style: solid; border-width: 1px 1px 1px 4px; border-image-source: none; line-height: 18px; background: none 0px 0px repeat scroll #f6f6f6">void MarkerRecognizer::markerDetect(Mat&amp; img_gray, vector&lt;Marker&gt;&amp; possible_markers, int min_size, int min_side_length) &#123; &nbsp;&nbsp;Mat img_bin;&nbsp;&nbsp;&nbsp;&nbsp;int thresh_size = (min_size/4)*2 + 1; &nbsp;&nbsp;adaptiveThreshold(img_gray, img_bin, 255, ADAPTIVE_THRESH_GAUSSIAN_C, THRESH_BINARY_INV, thresh_size, thresh_size/3); &nbsp;&nbsp;//threshold(img_gray, img_bin, 125, 255, THRESH_BINARY_INV&#124;THRESH_OTSU); &nbsp;&nbsp;morphologyEx(img_bin, img_bin, MORPH_OPEN, Mat());&nbsp;&nbsp;//use open operator to eliminate small patch&nbsp;&nbsp;&nbsp;&nbsp;vector&lt;vector&lt;Point&gt;&gt; all_contours; &nbsp;&nbsp;vector&lt;vector&lt;Point&gt;&gt; contours; &nbsp;&nbsp;findContours(img_bin, all_contours, CV_RETR_LIST, CV_CHAIN_APPROX_NONE);&nbsp;&nbsp;&nbsp;&nbsp;for (int i = 0; i &lt; all_contours.size(); ++i) &nbsp;&nbsp;&#123; &nbsp;&nbsp;&nbsp;&nbsp;if (all_contours[i].size() &gt; min_size) &nbsp;&nbsp;&nbsp;&nbsp;&#123; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;contours.push_back(all_contours[i]); &nbsp;&nbsp;&nbsp;&nbsp;&#125; &nbsp;&nbsp;&#125;&nbsp;&nbsp;&nbsp;&nbsp;vector&lt;Point&gt; approx_poly; &nbsp;&nbsp;for (int i = 0; i &lt; contours.size(); ++i) &nbsp;&nbsp;&#123; &nbsp;&nbsp;&nbsp;&nbsp;double eps = contours[i].size()*APPROX_POLY_EPS; &nbsp;&nbsp;&nbsp;&nbsp;approxPolyDP(contours[i], approx_poly, eps, true);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (approx_poly.size() != 4) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (!isContourConvex(approx_poly)) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Ensure that the distance between consecutive points is large enough &nbsp;&nbsp;&nbsp;&nbsp;float min_side = FLT_MAX; &nbsp;&nbsp;&nbsp;&nbsp;for (int j = 0; j &lt; 4; ++j) &nbsp;&nbsp;&nbsp;&nbsp;&#123; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Point side = approx_poly[j] - approx_poly[(j+1)%4]; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;min_side = min(min_size, side.dot(side)); &nbsp;&nbsp;&nbsp;&nbsp;&#125; &nbsp;&nbsp;&nbsp;&nbsp;if (min_side &lt; min_side_length*min_side_length) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Sort the points in anti-clockwise &nbsp;&nbsp;&nbsp;&nbsp;Marker marker = Marker(0, approx_poly[0], approx_poly[1], approx_poly[2], approx_poly[3]); &nbsp;&nbsp;&nbsp;&nbsp;Point2f v1 = marker.m_corners[1] - marker.m_corners[0]; &nbsp;&nbsp;&nbsp;&nbsp;Point2f v2 = marker.m_corners[2] - marker.m_corners[0]; &nbsp;&nbsp;&nbsp;&nbsp;if (v1.cross(v2) &gt; 0)&nbsp;&nbsp;//由于图像坐标的Y轴向下，所以大于零才代表逆时针 &nbsp;&nbsp;&nbsp;&nbsp;&#123; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;swap(marker.m_corners[1], marker.m_corners[3]); &nbsp;&nbsp;&nbsp;&nbsp;&#125; &nbsp;&nbsp;&nbsp;&nbsp;possible_markers.push_back(marker); &nbsp;&nbsp;&#125; &#125;</pre><br /><span style="font-size: 14px; letter-spacing: 1px; line-height: 24px; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; color: #333333">下一步，从这些候选区域中进一步筛选出真正的Marker。首先，由于摄像机视角的关系，图像中的Marker是经过透视变换的。为了方便提取Marker中的信息，要使用warpPerspective方法对候选区域进行透视变换，得到Marker的正视图。之后，由于Marker只有黑白两种颜色，其直方图分布是双峰的，所以用大津法（OTSU）对透视变换后的图像做二值化。</span><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px"></p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px"><img style="border: 0px; max-width: 720px" src="http://www.itnose.net/img/20141129/10163068.png" border="0" alt="OpenGL与OpenCV实现增强现实4" /><br /></p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px"><br /></p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px">由于Marker都有一圈黑色的轮廓，这成为了我们进一步判定Marker的标准。获取正确的Marker图像后，可能有4个不同方向。这时我们就可以通过Marker中的汉明码确定Marker的正确朝向了，正确朝向的Marker，其汉明距离一定为零。得到Marker的朝向后，就可以提取Marker的信息（即ID），还可以调整Marker的4个顶点顺序，使其不随视角的变换而变换。在Demo中，我将正向放置的Marker的左上角作为1号顶点，逆时针旋转依次为2号、3号和4号。</p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px"><img style="border: 0px; max-width: 720px" src="http://www.itnose.net/img/20141129/10163069.png" border="0" alt="OpenGL与OpenCV实现增强现实5" /><br /></p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px">代码如下：</p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px"></p><pre class="sycode" style="white-space: pre-wrap; word-wrap: break-word; margin-top: 10px; margin-bottom: 10px; padding: 5px; font-family: 'Courier New', Arial; color: #333333; letter-spacing: 1px; font-size: 10pt; border-color: rgb(221, 221, 221) rgb(221, 221, 221) rgb(221, 221, 221) rgb(108, 226, 108); border-style: solid; border-width: 1px 1px 1px 4px; border-image-source: none; line-height: 18px; background: none 0px 0px repeat scroll #f6f6f6">void MarkerRecognizer::markerRecognize(cv::Mat&amp; img_gray, vector&lt;Marker&gt;&amp; possible_markers, vector&lt;Marker&gt;&amp; final_markers) &#123; &nbsp;&nbsp;final_markers.clear();&nbsp;&nbsp;&nbsp;&nbsp;Mat marker_image; &nbsp;&nbsp;Mat bit_matrix(5, 5, CV_8UC1); &nbsp;&nbsp;for (int i = 0; i &lt; possible_markers.size(); ++i) &nbsp;&nbsp;&#123; &nbsp;&nbsp;&nbsp;&nbsp;Mat M = getPerspectiveTransform(possible_markers[i].m_corners, m_marker_coords); &nbsp;&nbsp;&nbsp;&nbsp;warpPerspective(img_gray, marker_image, M, Size(MARKER_SIZE, MARKER_SIZE)); &nbsp;&nbsp;&nbsp;&nbsp;threshold(marker_image, marker_image, 125, 255, THRESH_BINARY&#124;THRESH_OTSU); //OTSU determins threshold automatically.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//A marker must has a whole black border. &nbsp;&nbsp;&nbsp;&nbsp;for (int y = 0; y &lt; 7; ++y) &nbsp;&nbsp;&nbsp;&nbsp;&#123; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int inc = (y == 0 &#124;&#124; y == 6) ? 1 : 6; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int cell_y = y*MARKER_CELL_SIZE;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (int x = 0; x &lt; 7; x += inc) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#123; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int cell_x = x*MARKER_CELL_SIZE; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int none_zero_count = countNonZero(marker_image(Rect(cell_x, cell_y, MARKER_CELL_SIZE, MARKER_CELL_SIZE))); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (none_zero_count &gt; MARKER_CELL_SIZE*MARKER_CELL_SIZE/4) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;goto __wrongMarker; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125; &nbsp;&nbsp;&nbsp;&nbsp;&#125;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Decode the marker &nbsp;&nbsp;&nbsp;&nbsp;for (int y = 0; y &lt; 5; ++y) &nbsp;&nbsp;&nbsp;&nbsp;&#123; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int cell_y = (y+1)*MARKER_CELL_SIZE;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (int x = 0; x &lt; 5; ++x) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#123; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int cell_x = (x+1)*MARKER_CELL_SIZE; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int none_zero_count = countNonZero(marker_image(Rect(cell_x, cell_y, MARKER_CELL_SIZE, MARKER_CELL_SIZE))); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (none_zero_count &gt; MARKER_CELL_SIZE*MARKER_CELL_SIZE/2) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bit_matrix.at&lt;uchar&gt;(y, x) = 1; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bit_matrix.at&lt;uchar&gt;(y, x) = 0; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125; &nbsp;&nbsp;&nbsp;&nbsp;&#125;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Find the right marker orientation &nbsp;&nbsp;&nbsp;&nbsp;bool good_marker = false; &nbsp;&nbsp;&nbsp;&nbsp;int rotation_idx;&nbsp;&nbsp;//逆时针旋转的次数 &nbsp;&nbsp;&nbsp;&nbsp;for (rotation_idx = 0; rotation_idx &lt; 4; ++rotation_idx) &nbsp;&nbsp;&nbsp;&nbsp;&#123; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (hammingDistance(bit_matrix) == 0) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#123; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;good_marker = true; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bit_matrix = bitMatrixRotate(bit_matrix); &nbsp;&nbsp;&nbsp;&nbsp;&#125; &nbsp;&nbsp;&nbsp;&nbsp;if (!good_marker) goto __wrongMarker;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Store the final marker &nbsp;&nbsp;&nbsp;&nbsp;Marker&amp; final_marker = possible_markers[i]; &nbsp;&nbsp;&nbsp;&nbsp;final_marker.m_id = bitMatrixToId(bit_matrix); &nbsp;&nbsp;&nbsp;&nbsp;std::rotate(final_marker.m_corners.begin(), final_marker.m_corners.begin() + rotation_idx, final_marker.m_corners.end()); &nbsp;&nbsp;&nbsp;&nbsp;final_markers.push_back(final_marker);&nbsp;&nbsp;__wrongMarker: &nbsp;&nbsp;&nbsp;&nbsp;continue; &nbsp;&nbsp;&#125; &#125;</pre><br /><span style="font-size: 14px; letter-spacing: 1px; line-height: 24px; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; color: #333333">得到最终的Marker后，为了之后计算精确的摄像机位置，还需对Marker四个顶点的坐标进行子像素提取，这一步很简单，直接使用cornerSubPix即可。</span><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px"></p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px"></p><pre class="sycode" style="white-space: pre-wrap; word-wrap: break-word; margin-top: 10px; margin-bottom: 10px; padding: 5px; font-family: 'Courier New', Arial; color: #333333; letter-spacing: 1px; font-size: 10pt; border-color: rgb(221, 221, 221) rgb(221, 221, 221) rgb(221, 221, 221) rgb(108, 226, 108); border-style: solid; border-width: 1px 1px 1px 4px; border-image-source: none; line-height: 18px; background: none 0px 0px repeat scroll #f6f6f6">void MarkerRecognizer::markerRefine(cv::Mat&amp; img_gray, vector&lt;Marker&gt;&amp; final_markers) &#123; &nbsp;&nbsp;for (int i = 0; i &lt; final_markers.size(); ++i) &nbsp;&nbsp;&#123; &nbsp;&nbsp;&nbsp;&nbsp;vector&lt;Point2f&gt;&amp; corners = final_markers[i].m_corners; &nbsp;&nbsp;&nbsp;&nbsp;cornerSubPix(img_gray, corners, Size(5,5), Size(-1,-1), TermCriteria(CV_TERMCRIT_ITER, 30, 0.1)); &nbsp;&nbsp;&#125; &#125;</pre><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px"></p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px"><br /></p><span style="font-size: 14px; letter-spacing: 1px; line-height: 24px; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; color: #333333">为了检查算法的结果，将Marker的提取结果画到了图像上。其中蓝色边框标记了Marker的区域，空心圆圈代表Marker的1号顶点（正向放置时的左上角），较小的实心原点代表2号顶点，数字代表Marker的ID。</span><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px"><img style="border: 0px; max-width: 720px" src="http://www.itnose.net/img/20141129/10163070.png" border="0" alt="OpenGL与OpenCV实现增强现实6" /><br /></p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px"><br /><strong>2、计算摄像机位置</strong></p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px">计算摄像机的位置，首先需要对摄像机进行标定，标定是确定摄像机内参矩阵K的过程，一般用棋盘进行标定，这已经是一个很成熟的方法了，在这就不细说了。得到相机的内参矩阵K后，就可以使用solvePnP方法求取摄像机关于某个Marker的位置。摄像机成像使用小孔模型，如下：</p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px">x = K[R&#124;T]X</p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px">其中，X是空间某点的坐标（相对于世界坐标系），[R&#124;T]是摄像机外参矩阵，用于将某点的世界坐标变换为摄像机坐标，K是摄像机内参，用于将摄像机坐标中的某点投影的像平面上，x即为投影后的像素坐标。</p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px">对于一个确定的Marker，x是已知的，K是已知的，使用solvePnP求取相机位置实际上就是求取相机相对于Marker的外参矩阵[R&#124;T]，但现在X还不知道，如何确定呢？</p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px">外参矩阵与世界坐标系的选取有关，而世界坐标系的选取是任意的，因此我们可以将世界坐标系直接设定在Marker上，如下图：</p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px"><img style="border: 0px; max-width: 720px" src="http://www.itnose.net/img/20141129/10163071.png" border="0" alt="OpenGL与OpenCV实现增强现实7" /><br /></p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px">我们想象Marker位于世界坐标系的XY平面上（Z分量为零），且原点位于Marker的中心。由此，我们就确定了四个点的X坐标，将四个点的X坐标以及对应的像素坐标x传入solvePnP方法，即可得到相机关于该Marker的外参了。为了方便之后的使用，使用Rodrigues方法将旋转向量变为对应的旋转矩阵。</p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px"></p><pre class="sycode" style="white-space: pre-wrap; word-wrap: break-word; margin-top: 10px; margin-bottom: 10px; padding: 5px; font-family: 'Courier New', Arial; color: #333333; letter-spacing: 1px; font-size: 10pt; border-color: rgb(221, 221, 221) rgb(221, 221, 221) rgb(221, 221, 221) rgb(108, 226, 108); border-style: solid; border-width: 1px 1px 1px 4px; border-image-source: none; line-height: 18px; background: none 0px 0px repeat scroll #f6f6f6">void Marker::estimateTransformToCamera(vector&lt;Point3f&gt; corners_3d, cv::Mat&amp; camera_matrix, cv::Mat&amp; dist_coeff, cv::Mat&amp; rmat, cv::Mat&amp; tvec) &#123; &nbsp;&nbsp;Mat rot_vec; &nbsp;&nbsp;bool res = solvePnP(corners_3d, m_corners, camera_matrix, dist_coeff, rot_vec, tvec); &nbsp;&nbsp;Rodrigues(rot_vec, rmat); &#125;</pre><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px"></p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px">那么现在问题来了！我们设定世界坐标系时，只设定了X轴与Y轴的方向，由于Z分量为零，它的方向并不影响求得的外参矩阵。但之后将虚拟物体放入该世界坐标时，却需要知道Z轴的方向，那么我们的Z轴方向到底是什么呢？</p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px">首先，solvePnP返回的结果是一个旋转向量和一个平移向量，两者构成一个刚体运动，刚体运动不会改变坐标系的手性（即右手坐标系经过刚体运动后还是右手坐标系），所以世界坐标系的手性应该和相机坐标系的手性一致。从相机的小孔成像模型中可以知道，相机坐标系的Z轴是指向像平面的，因此，通过下图我们可以断定，世界坐标系的Z轴是垂直于Marker向下的。</p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px"><img style="border: 0px; max-width: 720px" src="http://www.itnose.net/img/20141129/10163072.png" border="0" alt="OpenGL与OpenCV实现增强现实8" /><br /></p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px"><strong>二、从OpenCV到OpenGL</strong></p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px">得到摄像机的内参K和相对于每个Marker的外参[R&#124;T]后，就可以开始考虑将虚拟物体添加进来了。老惯例，我还是使用OpenFrameworks。OpenFrameworks是在OpenGL基础上构建的一套框架，所以3D显示上，其本质还是OpenGL。</p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px">OpenGL的投影模型和普通相机的小孔投影模型是类似的，其PROJECTION矩阵对应与相机的内参K，MODELVIEW矩阵对应与相机的外参。但是，我们之前求得的K和[R&#124;T]还不能直接使用，原因有二，其一，OpenGL投影模型使用的坐标系与OpenCV的不同；其二，OpenGL为了进行Clipping，其投影矩阵需要将点投影到NDC空间中。</p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px"><img style="border: 0px; max-width: 720px" src="http://www.itnose.net/img/20141129/10163073.png" border="0" alt="OpenGL与OpenCV实现增强现实9" /><br /></p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px">Perspective Frustum and Normalized Device Coordinates (NDC)<br /></p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px">由上图（左边）可知，OpenGL的相机坐标系相当于OpenCV的相机坐标系绕着X轴旋转了180度，因此，我们使用外参矩阵[R&#124;T]对世界坐标系中的某点进行变换后，还需要左乘一个旋转矩阵才能得到该点在OpenGL坐标系中的坐标。绕X轴旋转180度的旋转矩阵很简单，如下：</p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px">[ 1, &nbsp;0, &nbsp;0,</p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px">&nbsp; 0, -1, &nbsp;0,</p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px">&nbsp; 0, &nbsp;0, -1 ]</p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px">总之，外参矩阵[R&#124;T]左乘以上矩阵后，即得OpenGL中的MODELVIEW矩阵，代码如下，注意OpenGL的矩阵元素是以列主序存储的。</p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px"></p><pre class="sycode" style="white-space: pre-wrap; word-wrap: break-word; margin-top: 10px; margin-bottom: 10px; padding: 5px; font-family: 'Courier New', Arial; color: #333333; letter-spacing: 1px; font-size: 10pt; border-color: rgb(221, 221, 221) rgb(221, 221, 221) rgb(221, 221, 221) rgb(108, 226, 108); border-style: solid; border-width: 1px 1px 1px 4px; border-image-source: none; line-height: 18px; background: none 0px 0px repeat scroll #f6f6f6">void ofApp::extrinsicMatrix2ModelViewMatrix(cv::Mat&amp; rotation, cv::Mat&amp; translation, float* model_view_matrix) &#123; &nbsp;&nbsp;//绕X轴旋转180度，从OpenCV坐标系变换为OpenGL坐标系 &nbsp;&nbsp;static double d[] =&nbsp;&nbsp;&nbsp;&nbsp;&#123; &nbsp;&nbsp;&nbsp;&nbsp;1,&nbsp;&nbsp;0,&nbsp;&nbsp;0, &nbsp;&nbsp;&nbsp;&nbsp;0, -1,&nbsp;&nbsp;0, &nbsp;&nbsp;&nbsp;&nbsp;0,&nbsp;&nbsp;0, -1 &nbsp;&nbsp;&#125;; &nbsp;&nbsp;Mat_&lt;double&gt; rx(3, 3, d);&nbsp;&nbsp;&nbsp;&nbsp;rotation = rx*rotation; &nbsp;&nbsp;translation = rx*translation;&nbsp;&nbsp;&nbsp;&nbsp;model_view_matrix[0] = rotation.at&lt;double&gt;(0,0); &nbsp;&nbsp;model_view_matrix[1] = rotation.at&lt;double&gt;(1,0); &nbsp;&nbsp;model_view_matrix[2] = rotation.at&lt;double&gt;(2,0); &nbsp;&nbsp;model_view_matrix[3] = 0.0f;&nbsp;&nbsp;&nbsp;&nbsp;model_view_matrix[4] = rotation.at&lt;double&gt;(0,1); &nbsp;&nbsp;model_view_matrix[5] = rotation.at&lt;double&gt;(1,1); &nbsp;&nbsp;model_view_matrix[6] = rotation.at&lt;double&gt;(2,1); &nbsp;&nbsp;model_view_matrix[7] = 0.0f;&nbsp;&nbsp;&nbsp;&nbsp;model_view_matrix[8] = rotation.at&lt;double&gt;(0,2); &nbsp;&nbsp;model_view_matrix[9] = rotation.at&lt;double&gt;(1,2); &nbsp;&nbsp;model_view_matrix[10] = rotation.at&lt;double&gt;(2,2); &nbsp;&nbsp;model_view_matrix[11] = 0.0f;&nbsp;&nbsp;&nbsp;&nbsp;model_view_matrix[12] = translation.at&lt;double&gt;(0, 0); &nbsp;&nbsp;model_view_matrix[13] = translation.at&lt;double&gt;(1, 0); &nbsp;&nbsp;model_view_matrix[14] = translation.at&lt;double&gt;(2, 0); &nbsp;&nbsp;model_view_matrix[15] = 1.0f; &#125;</pre><br /><span style="font-size: 14px; letter-spacing: 1px; line-height: 24px; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; color: #333333">下一步是求PROJECTION矩阵。由于OpenGL要做Clipping，要求所有在透视椎体中的点都投影到NDC中，在NDC中的点能够显示在屏幕上，之外的点则不能。因此，我们的PROJECTION矩阵不仅要有与内参矩阵K相同的透视效果，还得把点投影到NDC中。</span><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px"></p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px">首先先看看内参矩阵K的形式：</p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px"><img style="border: 0px; max-width: 720px" src="http://www.itnose.net/img/20141129/10163074.png" border="0" alt="OpenGL与OpenCV实现增强现实10" /><br /></p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px">首先假设OpenGL的投影椎体是对称的，那么PROJECTION矩阵的形式如下：</p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px"><img style="border: 0px; max-width: 720px" src="http://www.itnose.net/img/20141129/10163075.png" border="0" alt="OpenGL与OpenCV实现增强现实11" /><br /></p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px">使用以上矩阵对某一点（X, Y, Z, 1）投影后，可以得到如下关系：</p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px"><img style="border: 0px; max-width: 720px" src="http://www.itnose.net/img/20141129/10163076.png" border="0" alt="OpenGL与OpenCV实现增强现实12" /><br /></p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px">接下来，OpenGL会对该结果进行Clipping，具体方法是将四个分量都除以-Z，那么，要使我们的点最终显示到屏幕上，前三个分量在除以-Z后其变化范围必须在[-1, 1]内。如下：</p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px"><img style="border: 0px; max-width: 720px" src="http://www.itnose.net/img/20141129/10163077.png" border="0" alt="OpenGL与OpenCV实现增强现实13" /><br /></p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px">由摄像机投影模型（相似三角形）知：</p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px"><img style="border: 0px; max-width: 720px" src="http://www.itnose.net/img/20141129/10163078.png" border="0" alt="OpenGL与OpenCV实现增强现实14" /><br /></p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px"><img style="border: 0px; max-width: 720px" src="http://www.itnose.net/img/20141129/10163079.png" border="0" alt="OpenGL与OpenCV实现增强现实15" /><br /></p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px">其中由于OpenGL相机的相面在Z轴负方向上，所以是-fx和-fy。xp和yp分别为某点在相面上的横坐标和纵坐标，这两个坐标的原点在图像的中心，图像的宽度和高度分别为w和h，因此xp和yp的取值范围分别为[-w/2, w/2]和[-h/2, h/2]，可得：</p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px"><img style="border: 0px; max-width: 720px" src="http://www.itnose.net/img/20141129/10163080.png" border="0" alt="OpenGL与OpenCV实现增强现实16" /><br /></p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px">于是</p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px"><img style="border: 0px; max-width: 720px" src="http://www.itnose.net/img/20141129/10163081.png" border="0" alt="OpenGL与OpenCV实现增强现实17" /><br /></p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px">接下来，我们为OpenGL相机设定两个面，near和far，只有处于这两个面之间的点才能投影到NDC空间中，所以当 Z=-n 时，(AZ+B)/-Z = -1，当 Z=-f 时，(AZ+B)/-Z = 1，由此我们可以得到关于A和B的二元一次方程，从而解出A、B：</p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px"><img style="border: 0px; max-width: 720px" src="http://www.itnose.net/img/20141129/10163082.png" border="0" alt="OpenGL与OpenCV实现增强现实18" /><br /></p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px">现在再来考虑OpenGL投影椎体不对称的情况，这种情况下，PROJECTION矩阵的形式为：</p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px"><img style="border: 0px; max-width: 720px" src="http://www.itnose.net/img/20141129/10163083.png" border="0" alt="OpenGL与OpenCV实现增强现实19" /><br /></p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px">由于椎体不对称，这时xp和yp的变化范围分别为[l, r]和[b, t]，代表图像左侧（left）右侧（right），以及底部（bottom）顶部（top），用同样的方法，我们有：</p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px"><img style="border: 0px; max-width: 720px" src="http://www.itnose.net/img/20141129/10163084.png" border="0" alt="OpenGL与OpenCV实现增强现实20" /><br /></p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px">可得：</p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px"><img style="border: 0px; max-width: 720px" src="http://www.itnose.net/img/20141129/10163085.png" border="0" alt="OpenGL与OpenCV实现增强现实21" />&nbsp; ， &nbsp;<img style="border: 0px; max-width: 720px" src="http://www.itnose.net/img/20141129/10163086.png" border="0" alt="OpenGL与OpenCV实现增强现实22" /><br /></p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px">于是：</p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px"><img style="border: 0px; max-width: 720px" src="http://www.itnose.net/img/20141129/10163087.png" border="0" alt="OpenGL与OpenCV实现增强现实23" /><br /></p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px">关于l+r和b+t是怎么计算的，可以参考下图：</p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px"><img style="border: 0px; max-width: 720px" src="http://www.itnose.net/img/20141129/10163088.png" border="0" alt="OpenGL与OpenCV实现增强现实24" /><br /></p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px">综上所述，我们可以得到OpenGL投影矩阵的最终形式：</p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px"><img style="border: 0px; max-width: 720px" src="http://www.itnose.net/img/20141129/10163089.png" border="0" alt="OpenGL与OpenCV实现增强现实25" /><br /></p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px">到此，我们就可以将这个矩阵的数据传递给PROJECTION矩阵了：</p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px"></p><pre class="sycode" style="white-space: pre-wrap; word-wrap: break-word; margin-top: 10px; margin-bottom: 10px; padding: 5px; font-family: 'Courier New', Arial; color: #333333; letter-spacing: 1px; font-size: 10pt; border-color: rgb(221, 221, 221) rgb(221, 221, 221) rgb(221, 221, 221) rgb(108, 226, 108); border-style: solid; border-width: 1px 1px 1px 4px; border-image-source: none; line-height: 18px; background: none 0px 0px repeat scroll #f6f6f6">void ofApp::intrinsicMatrix2ProjectionMatrix(cv::Mat&amp; camera_matrix, float width, float height, float near_plane, float far_plane, float* projection_matrix) &#123; &nbsp;&nbsp;float f_x = camera_matrix.at&lt;float&gt;(0,0); &nbsp;&nbsp;float f_y = camera_matrix.at&lt;float&gt;(1,1);&nbsp;&nbsp;&nbsp;&nbsp;float c_x = camera_matrix.at&lt;float&gt;(0,2); &nbsp;&nbsp;float c_y = camera_matrix.at&lt;float&gt;(1,2); &nbsp;&nbsp; &nbsp;&nbsp;projection_matrix[0] = 2*f_x/width; &nbsp;&nbsp;projection_matrix[1] = 0.0f; &nbsp;&nbsp;projection_matrix[2] = 0.0f; &nbsp;&nbsp;projection_matrix[3] = 0.0f;&nbsp;&nbsp;&nbsp;&nbsp;projection_matrix[4] = 0.0f; &nbsp;&nbsp;projection_matrix[5] = 2*f_y/height; &nbsp;&nbsp;projection_matrix[6] = 0.0f; &nbsp;&nbsp;projection_matrix[7] = 0.0f;&nbsp;&nbsp;&nbsp;&nbsp;projection_matrix[8] = 1.0f - 2*c_x/width; &nbsp;&nbsp;projection_matrix[9] = 2*c_y/height - 1.0f; &nbsp;&nbsp;projection_matrix[10] = -(far_plane + near_plane)/(far_plane - near_plane); &nbsp;&nbsp;projection_matrix[11] = -1.0f;&nbsp;&nbsp;&nbsp;&nbsp;projection_matrix[12] = 0.0f; &nbsp;&nbsp;projection_matrix[13] = 0.0f; &nbsp;&nbsp;projection_matrix[14] = -2.0f*far_plane*near_plane/(far_plane - near_plane); &nbsp;&nbsp;projection_matrix[15] = 0.0f; &#125;</pre><br /><span style="font-size: 14px; letter-spacing: 1px; line-height: 24px; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; color: #333333">现在是时候放一些虚拟物体进来了，为了简单，我就放了几个立方体，由于OpenFrameworks绘制立方体时以立方体在中心为原点，所以为了使立方体的底面贴在Marker上，必须在Marker上方二分之一立方体边长的地方绘制，也就是绘制立方体的坐标为（0, 0, -0.5*size），为什么是负0.5呢？还记得之前所说的世界坐标系的Z轴是垂直于Marker并朝下的吗？所以要画在Marker上方，必须向Z轴负方向移动！</span><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px"></p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px"></p><pre class="sycode" style="white-space: pre-wrap; word-wrap: break-word; margin-top: 10px; margin-bottom: 10px; padding: 5px; font-family: 'Courier New', Arial; color: #333333; letter-spacing: 1px; font-size: 10pt; border-color: rgb(221, 221, 221) rgb(221, 221, 221) rgb(221, 221, 221) rgb(108, 226, 108); border-style: solid; border-width: 1px 1px 1px 4px; border-image-source: none; line-height: 18px; background: none 0px 0px repeat scroll #f6f6f6">void ofApp::draw()&#123;&nbsp;&nbsp;&nbsp;&nbsp;ofSetColor(255); &nbsp;&nbsp;float view_width = ofGetViewportWidth(); &nbsp;&nbsp;float view_height = ofGetViewportHeight(); &nbsp;&nbsp;m_video.draw(0, 0, view_width, view_height);&nbsp;&nbsp;&nbsp;&nbsp;//Set camera matrix to the opengl projection matrix; &nbsp;&nbsp;intrinsicMatrix2ProjectionMatrix(m_camera_matrix, 640, 480, 0.01f, 100.0f, m_projection_matrix); &nbsp;&nbsp;ofSetMatrixMode(OF_MATRIX_PROJECTION); &nbsp;&nbsp;//Openframeworks里将(-1, -1)映射到屏幕左上角，而非一般的左下角，所以需要一个矩阵进行垂直镜像 &nbsp;&nbsp;static float reflect[] =&nbsp;&nbsp;&nbsp;&nbsp;&#123; &nbsp;&nbsp;&nbsp;&nbsp;1,&nbsp;&nbsp;0, 0, 0, &nbsp;&nbsp;&nbsp;&nbsp;0, -1, 0, 0, &nbsp;&nbsp;&nbsp;&nbsp;0,&nbsp;&nbsp;0, 1, 0, &nbsp;&nbsp;&nbsp;&nbsp;0,&nbsp;&nbsp;0, 0, 1 &nbsp;&nbsp;&#125;; &nbsp;&nbsp;ofLoadMatrix(reflect); &nbsp;&nbsp;//OpenGL默认为右乘 &nbsp;&nbsp;ofMultMatrix(m_projection_matrix);&nbsp;&nbsp;&nbsp;&nbsp;//Reset model view matrix to identity; &nbsp;&nbsp;ofSetMatrixMode(OF_MATRIX_MODELVIEW); &nbsp;&nbsp;ofLoadIdentityMatrix();&nbsp;&nbsp;&nbsp;&nbsp;//Set opengl parameters &nbsp;&nbsp;ofSetColor(255);&nbsp;&nbsp;&nbsp;&nbsp; &lt;span style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&lt;/span&gt;ofEnableBlendMode(OF_BLENDMODE_ALPHA); &nbsp;&nbsp;ofEnableDepthTest();&nbsp;&nbsp;&nbsp;&nbsp; &lt;span style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&lt;/span&gt;glShadeModel(GL_SMOOTH); //some model / light stuff&nbsp;&nbsp;&nbsp;&nbsp; &lt;span style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&lt;/span&gt;m_light.enable();&nbsp;&nbsp;&nbsp;&nbsp; &lt;span style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&lt;/span&gt;ofEnableSeparateSpecularLight();&nbsp;&nbsp;&nbsp;&nbsp;vector&lt;Marker&gt;&amp; markers = m_recognizer.getMarkers(); &nbsp;&nbsp;Mat r, t; &nbsp;&nbsp;for (int i = 0; i &lt; markers.size(); ++i) &nbsp;&nbsp;&#123; &nbsp;&nbsp;&nbsp;&nbsp;//求出的旋转矩阵r的行列式为+1，即为刚体变换，所以不改变坐标系的手性 &nbsp;&nbsp;&nbsp;&nbsp;markers[i].estimateTransformToCamera(m_corners_3d, m_camera_matrix, m_dist_coeff, r, t); &nbsp;&nbsp;&nbsp;&nbsp;extrinsicMatrix2ModelViewMatrix(r, t, m_model_view_matrix); &nbsp;&nbsp;&nbsp;&nbsp;ofLoadMatrix(m_model_view_matrix);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ofSetColor(0x66,0xcc,0xff); &nbsp;&nbsp;&nbsp;&nbsp;//由于Marker坐标系与OpenCV坐标系的手性一致，所以Marker坐标系的Z轴垂直于Marker向下 &nbsp;&nbsp;&nbsp;&nbsp;//绘制Box时的Anchor在Box中心，所以需要-0.5*size的偏移才能使Box的底面在Marker上！！ &nbsp;&nbsp;&nbsp;&nbsp;ofDrawBox(0, 0, -0.4f, 0.8f); &nbsp;&nbsp;&#125;&nbsp;&nbsp;&nbsp;&nbsp;//Reset parameters &nbsp;&nbsp;ofDisableDepthTest();&nbsp;&nbsp;&nbsp;&nbsp; &lt;span style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&lt;/span&gt;m_light.disable();&nbsp;&nbsp;&nbsp;&nbsp; &lt;span style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&lt;/span&gt;ofDisableLighting();&nbsp;&nbsp;&nbsp;&nbsp;&lt;span style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&lt;/span&gt; ofDisableSeparateSpecularLight();&nbsp;&nbsp;&nbsp;&nbsp;ofSetMatrixMode(OF_MATRIX_MODELVIEW); &nbsp;&nbsp;ofLoadIdentityMatrix(); &nbsp;&nbsp;ofSetMatrixMode(OF_MATRIX_PROJECTION); &nbsp;&nbsp;ofLoadIdentityMatrix(); &#125;</pre><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px"></p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px"><br /></p><span style="font-size: 14px; letter-spacing: 1px; line-height: 24px; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; color: #333333">注意，我在设置投影矩阵时，左乘了一个垂直方向的镜像矩阵，这是因为，我发现OpenFrameworks将NDC空间中（-1, -1）点映射到屏幕的左上角，而非一般OpenGL所映射的左下角，如果不乘这个镜像矩阵，得到的图像就是上下颠倒的。至于为什么OpenFrameworks是这样，由于没仔细研究它的代码，我只能猜测是其在初始化时对OpenGL做了一些设置所致。所以，如果我的理解或猜测有错误，还请大家指出^_^</span><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px"><img style="border: 0px; max-width: 720px" src="http://www.itnose.net/img/20141129/10163090.png" border="0" alt="OpenGL与OpenCV实现增强现实26" /></p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px"><br /></p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px">最后给出代码的下载地址，程序用VS2012开发，解压后放到&rdquo;OpenFrameworks安装目录&#92;apps&#92;myApps&ldquo;下打开编译：</p><p style="margin: 0px 0px 10px; padding: 0px; color: #333333; font-family: arial, 宋体, sans-serif, 'Microsoft YaHei', tahoma; font-size: 14px; letter-spacing: 1px; line-height: 24px">http://download.csdn.net/detail/aichipmunk/8207875</p>
]]>
</description>
</item><item>
<link>http://i.renjihe.com/blog/read.php?6333</link>
<title><![CDATA[OpenTLD在VS2012和opencv246编译通过]]></title> 
<author>renjihe1988 &lt;admin@yourname.com&gt;</author>
<category><![CDATA[OpenCV]]></category>
<pubDate>Fri, 23 Jan 2015 15:38:06 +0000</pubDate> 
<guid>http://i.renjihe.com/blog/read.php?6333</guid> 
<description>
<![CDATA[ 
	<p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2000007629395px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">http://www.tuicool.com/articles/Yv6ruyq<br />最近看到了TLD的跟踪视频，觉得很有意思，刚好最近在看行人检测所以就打算下载源码玩一玩，因为源码是Linux版本的（原作者写的是C++和MATLAB的混合编程）C++源码可以在我的博客 <a style="text-decoration: none; outline: none; color: #949494; transition: 0.25s; -webkit-transition: 0.25s; border-bottom-width: 1px; border-bottom-style: dashed; border-bottom-color: #949494; font-style: italic; font-weight: bold" rel="nofollow,noindex" href="http://www.cnblogs.com/lxy2017/p/3927456.html" target="_blank">TLD（一种目标跟踪算法中）</a> 下载到。在编译过程中遇到一些问题，在网上找了些资料后顺利解决了。</p><ol style="padding: 0px; margin: 0px 0px 0.75em 25px; font-size: 16px; line-height: 27.2000007629395px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe"><li style="line-height: 1.7em">下载源码，然后解压，新建VS工程，配置好opencv，把C++源码下的src,include文件夹下的代码cope到新建工程下并在工程中添加</li><li style="line-height: 1.7em">将代码中的所有包含目录下的.h文件的&lt;&gt;改成&rdquo;&ldquo;&nbsp;&nbsp;比如#include &lt;tld_utils.h&gt;改成#include &quot;tld_utils.h&quot;</li><li style="line-height: 1.7em">opencv246中需要在TLD.h中添加#include &lt;opencv2/legacy/legacy.hpp&gt; //原作者没有添加这个所以出错，定义了PatchGenerator类</li><li style="line-height: 1.7em">Vs中没有round函数，所以要自己写一个，<pre class="prettyprint cs" style="padding: 0.3em; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; border-radius: 4px; margin-top: 0px; margin-bottom: 1.5em; font-size: 13px; line-height: 1.5em; word-break: break-all; word-wrap: break-word; white-space: pre-wrap; border: 1px solid rgba(0, 0, 0, 0.14902); overflow-y: auto; background-color: #f6f6f6"><span style="font-size: 16px"><span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">int</span></span> round(<span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">float</span></span><span style="color: #000000"> f) &#123;&nbsp;&nbsp;</span><span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">if</span></span> ((<span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">int</span></span>)f+<span style="color: #800080"><span style="color: #009999" class="number">0.5</span></span>&gt;<span style="color: #000000">f)&nbsp;&nbsp;</span><span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">return</span></span> (<span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">int</span></span><span style="color: #000000">)f;&nbsp;&nbsp;</span><span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">else</span></span>&nbsp;&nbsp;<span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">return</span></span> (<span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">int</span></span>)f + <span style="color: #800080"><span style="color: #009999" class="number">1</span></span><span style="color: #000000">;&nbsp;&nbsp;&#125;</span></span></pre></li><li style="line-height: 1.7em"><div style="line-height: 1.7em"><p style="margin: 0px 0px 0.75em; line-height: 1.7em; text-indent: 1em">TLD::clusterBB函数中，vs不支持这种动态数组分配。</p><p style="margin: 0px 0px 0.75em; line-height: 1.7em; text-indent: 1em"></p></div><pre class="prettyprint cpp" style="padding: 0.3em; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; border-radius: 4px; margin-top: 0px; margin-bottom: 1.5em; font-size: 13px; line-height: 1.5em; word-break: break-all; word-wrap: break-word; white-space: pre-wrap; border: 1px solid rgba(0, 0, 0, 0.14902); overflow-y: auto; background-color: #f6f6f6"><span style="font-size: 16px"><span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">float</span></span> L[c-<span style="color: #800080"><span style="color: #009999" class="number">1</span></span>]; <span style="color: #008000"><span style="font-style: italic; color: #999988" class="comment">//</span></span><span style="font-style: italic; color: #999988" class="comment"><span style="color: #008000">Level</span></span> <span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">int</span></span> nodes[c-<span style="color: #800080"><span style="color: #009999" class="number">1</span></span>][<span style="color: #800080"><span style="color: #009999" class="number">2</span></span><span style="color: #000000">]; </span><span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">int</span></span><span style="color: #000000"> belongs[c]; <span style="font-style: italic; color: #999988" class="comment">//改成指针和动态分配内存</span> </span><span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">float</span></span> *L = <span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">new</span></span> <span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">float</span></span> [c-<span style="color: #800080"><span style="color: #009999" class="number">1</span></span>]; <span style="color: #008000"><span style="font-style: italic; color: #999988" class="comment">//</span></span><span style="font-style: italic; color: #999988" class="comment"><span style="color: #008000">Level</span></span> <span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">int</span></span> **nodes = <span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">new</span></span> <span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">int</span></span> *[c-<span style="color: #800080"><span style="color: #009999" class="number">1</span></span><span style="color: #000000">]; </span><span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">for</span></span>(<span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">int</span></span> i = <span style="color: #800080"><span style="color: #009999" class="number">0</span></span>; i &lt; <span style="color: #800080"><span style="color: #009999" class="number">2</span></span> ;i ++<span style="color: #000000">) nodes[i] </span>= <span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">new</span></span> <span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">int</span></span> [c-<span style="color: #800080"><span style="color: #009999" class="number">1</span></span><span style="color: #000000">]; </span><span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">int</span></span> *belongs = <span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">new</span></span> <span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">int</span></span><span style="color: #000000"> [c]; <span style="font-style: italic; color: #999988" class="comment">//记得在函数末释放分配的内存</span> <span style="font-weight: bold; color: #333333" class="keyword">delete</span> [] L; L </span>=<span style="color: #000000"> NULL; </span><span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">for</span></span> (<span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">int</span></span> i = <span style="color: #800080"><span style="color: #009999" class="number">0</span></span>; i &lt; <span style="color: #800080"><span style="color: #009999" class="number">2</span></span>; ++<span style="color: #000000">i) &#123; <span style="font-weight: bold; color: #333333" class="keyword">delete</span> [] nodes[i]; nodes[i] </span>=<span style="color: #000000"> NULL; &#125; <span style="font-weight: bold; color: #333333" class="keyword">delete</span> []nodes; nodes </span>=<span style="color: #000000"> NULL; <span style="font-weight: bold; color: #333333" class="keyword">delete</span> [] belongs; belongs </span>= NULL;</span></pre></li><li style="line-height: 1.7em">上面完成之后，程序编译可以通过，摄像头也可以打开，但是一选定boundingbox程序就运行不下去了。看了一下代码才发现run_tld.cpp中有一个print_help函数。 <br />看了之后，明白了原来运行需要传递参数。见下面cmd命令：<pre class="prettyprint ruby" style="padding: 0.3em; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; border-radius: 4px; margin-top: 0px; margin-bottom: 1.5em; font-size: 13px; line-height: 1.5em; word-break: break-all; word-wrap: break-word; white-space: pre-wrap; border: 1px solid rgba(0, 0, 0, 0.14902); overflow-y: auto; background-color: #f6f6f6"><span style="font-size: 16px">%<span class="constant">To</span> run <span style="color: #0000ff">from</span><span style="color: #000000"> camera .</span><span style="color: #009926" class="regexp">/run_tld -p ../<span style="color: #000000">parameters</span></span><span style="color: #000000">.yml </span>%<span class="constant">To</span> run <span style="color: #0000ff">from</span><span style="color: #000000"> file .</span><span style="color: #009926" class="regexp">/run_tld -p ../parameters</span>.yml -s ..<span style="color: #009926" class="regexp">/datasets/</span><span style="color: #009999" class="number">06_</span>car/<span style="color: #000000">car.mpg </span>%<span class="constant">To</span> init bounding box <span style="color: #0000ff">from</span><span style="color: #000000"> file .</span><span style="color: #009926" class="regexp">/run_tld -p ../parameters</span>.yml -s ..<span style="color: #009926" class="regexp">/datasets/</span><span style="color: #009999" class="number">06_</span>car/car.mpg -b ..<span style="color: #009926" class="regexp">/datasets/</span><span style="color: #009999" class="number">06_</span>car/<span style="color: #000000">init.txt </span>%<span class="constant">To</span> train only <span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">in</span></span><span style="color: #000000"> the first frame (no tracking, no learning) .</span><span style="color: #009926" class="regexp">/run_tld -p ../parameters</span>.yml -s ..<span style="color: #009926" class="regexp">/datasets/</span><span style="color: #009999" class="number">06_</span>car/car.mpg -b ..<span style="color: #009926" class="regexp">/datasets/</span><span style="color: #009999" class="number">06_</span>car/init.txt -<span style="color: #000000">no_tl&nbsp;&nbsp;</span>%<span style="color: #000000"><span class="constant">To</span> test the final detector (<span class="constant">Repeat</span> the video, first time learns, second time detects) .</span><span style="color: #009926" class="regexp">/run_tld -p ../parameters</span>.yml -s ..<span style="color: #009926" class="regexp">/datasets/</span><span style="color: #009999" class="number">06_</span>car/car.mpg -b ..<span style="color: #009926" class="regexp">/datasets/</span><span style="color: #009999" class="number">06_</span>car/init.txt -r</span></pre><p style="margin: 0px 0px 0.75em; line-height: 1.7em; text-indent: 1em">这样就可以运行了</p></li></ol>
]]>
</description>
</item><item>
<link>http://i.renjihe.com/blog/read.php?6331</link>
<title><![CDATA[OpenTLD配置VS2010+OpenCV2.4,无须CMake]]></title> 
<author>renjihe1988 &lt;admin@yourname.com&gt;</author>
<category><![CDATA[OpenCV]]></category>
<pubDate>Fri, 23 Jan 2015 14:46:53 +0000</pubDate> 
<guid>http://i.renjihe.com/blog/read.php?6331</guid> 
<description>
<![CDATA[ 
	<p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px" align="left"><span style="font-family: 'Microsoft YaHei'">有很多大牛已经写过OpenTLD在VS中的配置，但是有些细节让我等小弱不甚明白，所以写这篇文章。</span></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px" align="left"><span style="font-family: 'Microsoft YaHei'">OpenTLD在VS2010和OpenCV2.4中的配置，OpenCV2.4是exe版本的，直接解压得到，大小约为2.29G，已经测试过，该方法也可以在OpenCV2.2运行；VS2010安装了SP1，单是在没有SP1版本的情况下依旧可以运行。OpenTLD是AlanTorresC++实现的<a style="text-decoration: none; outline: none; color: #336699" href="https://github.com/alantrrs/OpenTLD/archive/master.zip">OpenTLD zip包</a>。</span></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px" align="left"><strong><span style="font-family: 'Microsoft YaHei'">1、下载软件</span></strong></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px" align="left"><span style="font-family: 'Microsoft YaHei'">　　下载OpenCV-2.4.0，双击解压到C:&#92;OpenCV2.4。</span></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px" align="left"><span style="font-family: 'Microsoft YaHei'">　　下载VS2010，安装。</span></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px" align="left"><strong><span style="font-family: 'Microsoft YaHei'">2、配置OpenCV环境变量</span></strong></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px" align="left"><span style="font-family: 'Microsoft YaHei'">计算机-&gt;（右键）属性-&gt;高级系统设置-&gt;高级（标签）-&gt;环境变量-&gt;（双击）path（用户，系统里面的path任选其一）-&gt;在变量值里面添加</span></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px" align="left"></p><div class="dp-highlighter bg_cpp" style="font-family: Consolas, 'Courier New', Courier, mono, serif; width: 700.90625px; overflow: auto; padding-top: 1px; color: #333333; line-height: 26px; margin: 18px 0px !important; background-color: #e7e5dc"><div class="bar" style="padding-left: 45px"><div class="tools" style="padding: 3px 8px 10px 10px; font-stretch: normal; font-size: 9px; line-height: normal; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; color: silver; border-left-width: 3px; border-left-style: solid; border-left-color: #6ce26c; background-color: #f8f8f8"><strong>[cpp]</strong>&nbsp;<a style="text-decoration: none; outline: none; color: #a0a0a0; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; display: inline-block; width: 16px; height: 16px; text-indent: -2000px; background-image: url('http://static.blog.csdn.net/scripts/SyntaxHighlighter/styles/images/default/ico_plain.gif'); background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat" href="http://blog.csdn.net/lemolemac/article/details/9043961#" title="view plain" class="ViewSource">view plain</a><a style="text-decoration: none; outline: none; color: #a0a0a0; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; display: inline-block; width: 16px; height: 16px; text-indent: -2000px; background-image: url('http://static.blog.csdn.net/scripts/SyntaxHighlighter/styles/images/default/ico_copy.gif'); background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat" href="http://blog.csdn.net/lemolemac/article/details/9043961#" title="copy" class="CopyToClipboard">copy</a></div></div><ol class="dp-cpp" style="padding: 0px; border: none; list-style-position: initial; list-style-image: initial; color: #5c5c5c; margin: 0px 0px 1px 45px !important; background-color: #ffffff"><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">C:&#92;OpenCV2.4&#92;build&#92;x86&#92;vc10&#92;bin&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">C:&#92;OpenCV2.4&#92;build&#92;common&#92;tbb&#92;ia32&#92;vc10&nbsp;&nbsp;</span></li></ol></div><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px" align="left"><strong><span style="font-family: 'Microsoft YaHei'">3、配置工程的opencv依赖（每次新建工程都要重新配置，要执行此步骤请先跳到第4步建立工程）</span></strong></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px" align="left"><span style="font-family: 'Microsoft YaHei'">1）、项目（菜单项）-&gt;&hellip;属性-&gt;VC++目录：需要配置&ldquo;<strong>包含目录</strong>&rdquo;和&ldquo;<strong>库目录</strong>&rdquo;两项。</span></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px" align="left"><span style="font-family: 'Microsoft YaHei'">2）、配置&ldquo;包含目录&rdquo;项：添加以下四行，最后一行是tld中自带的include，也要加进去。</span></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px" align="left"></p><div class="dp-highlighter bg_cpp" style="font-family: Consolas, 'Courier New', Courier, mono, serif; width: 700.90625px; overflow: auto; padding-top: 1px; color: #333333; line-height: 26px; margin: 18px 0px !important; background-color: #e7e5dc"><div class="bar" style="padding-left: 45px"><div class="tools" style="padding: 3px 8px 10px 10px; font-stretch: normal; font-size: 9px; line-height: normal; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; color: silver; border-left-width: 3px; border-left-style: solid; border-left-color: #6ce26c; background-color: #f8f8f8"><strong>[cpp]</strong>&nbsp;<a style="text-decoration: none; outline: none; color: #a0a0a0; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; display: inline-block; width: 16px; height: 16px; text-indent: -2000px; background-image: url('http://static.blog.csdn.net/scripts/SyntaxHighlighter/styles/images/default/ico_plain.gif'); background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat" href="http://blog.csdn.net/lemolemac/article/details/9043961#" title="view plain" class="ViewSource">view plain</a><a style="text-decoration: none; outline: none; color: #a0a0a0; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; display: inline-block; width: 16px; height: 16px; text-indent: -2000px; background-image: url('http://static.blog.csdn.net/scripts/SyntaxHighlighter/styles/images/default/ico_copy.gif'); background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat" href="http://blog.csdn.net/lemolemac/article/details/9043961#" title="copy" class="CopyToClipboard">copy</a></div></div><ol class="dp-cpp" style="padding: 0px; border: none; list-style-position: initial; list-style-image: initial; color: #5c5c5c; margin: 0px 0px 1px 45px !important; background-color: #ffffff"><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">C:&#92;OpenCV2.4&#92;build&#92;include&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">C:&#92;OpenCV2.4&#92;build&#92;include&#92;opencv&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">C:&#92;OpenCV2.4&#92;build&#92;include&#92;opencv2&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">E:&#92;leProjects&#92;tld&#92;tld&#92;include&nbsp;&nbsp;</span></li></ol></div><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px" align="left"><span style="font-family: 'Microsoft YaHei'">3）、配置&ldquo;库目录&rdquo;项：添加行</span></p><div class="dp-highlighter bg_cpp" style="font-family: Consolas, 'Courier New', Courier, mono, serif; width: 700.90625px; overflow: auto; padding-top: 1px; color: #333333; line-height: 26px; margin: 18px 0px !important; background-color: #e7e5dc"><div class="bar" style="padding-left: 45px"><div class="tools" style="padding: 3px 8px 10px 10px; font-stretch: normal; font-size: 9px; line-height: normal; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; color: silver; border-left-width: 3px; border-left-style: solid; border-left-color: #6ce26c; background-color: #f8f8f8"><strong>[cpp]</strong>&nbsp;<a style="text-decoration: none; outline: none; color: #a0a0a0; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; display: inline-block; width: 16px; height: 16px; text-indent: -2000px; background-image: url('http://static.blog.csdn.net/scripts/SyntaxHighlighter/styles/images/default/ico_plain.gif'); background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat" href="http://blog.csdn.net/lemolemac/article/details/9043961#" title="view plain" class="ViewSource">view plain</a><a style="text-decoration: none; outline: none; color: #a0a0a0; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; display: inline-block; width: 16px; height: 16px; text-indent: -2000px; background-image: url('http://static.blog.csdn.net/scripts/SyntaxHighlighter/styles/images/default/ico_copy.gif'); background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat" href="http://blog.csdn.net/lemolemac/article/details/9043961#" title="copy" class="CopyToClipboard">copy</a></div></div><ol class="dp-cpp" style="padding: 0px; border: none; list-style-position: initial; list-style-image: initial; color: #5c5c5c; margin: 0px 0px 1px 45px !important; background-color: #ffffff"><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">C:&#92;OpenCV2.4&#92;build&#92;x86&#92;vc10&#92;lib&nbsp;&nbsp;</span></span></li></ol></div><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px" align="left"><span style="font-family: 'Microsoft YaHei'">4）、配置连接器：项目（菜单项）-&gt;&hellip;属性-&gt;连接器-&gt;输入-&gt;附加依赖项</span></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px" align="left"><strong><span style="font-family: 'Microsoft YaHei'">针对debug配置添加以下库：</span></strong></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px" align="left"></p><div class="dp-highlighter bg_cpp" style="font-family: Consolas, 'Courier New', Courier, mono, serif; width: 700.90625px; overflow: auto; padding-top: 1px; color: #333333; line-height: 26px; margin: 18px 0px !important; background-color: #e7e5dc"><div class="bar" style="padding-left: 45px"><div class="tools" style="padding: 3px 8px 10px 10px; font-stretch: normal; font-size: 9px; line-height: normal; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; color: silver; border-left-width: 3px; border-left-style: solid; border-left-color: #6ce26c; background-color: #f8f8f8"><strong>[cpp]</strong>&nbsp;<a style="text-decoration: none; outline: none; color: #a0a0a0; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; display: inline-block; width: 16px; height: 16px; text-indent: -2000px; background-image: url('http://static.blog.csdn.net/scripts/SyntaxHighlighter/styles/images/default/ico_plain.gif'); background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat" href="http://blog.csdn.net/lemolemac/article/details/9043961#" title="view plain" class="ViewSource">view plain</a><a style="text-decoration: none; outline: none; color: #a0a0a0; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; display: inline-block; width: 16px; height: 16px; text-indent: -2000px; background-image: url('http://static.blog.csdn.net/scripts/SyntaxHighlighter/styles/images/default/ico_copy.gif'); background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat" href="http://blog.csdn.net/lemolemac/article/details/9043961#" title="copy" class="CopyToClipboard">copy</a></div></div><ol class="dp-cpp" style="padding: 0px; border: none; list-style-position: initial; list-style-image: initial; color: #5c5c5c; margin: 0px 0px 1px 45px !important; background-color: #ffffff"><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">opencv_calib3d240d.lib&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">opencv_contrib240d.lib&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">opencv_core240d.lib&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">opencv_features2d240d.lib&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">opencv_flann240d.lib&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">opencv_gpu240d.lib&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">opencv_highgui240d.lib&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">opencv_imgproc240d.lib&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">opencv_legacy240d.lib&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">opencv_ml240d.lib&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">opencv_objdetect240d.lib&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">opencv_ts240d.lib&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">opencv_video240d.lib&nbsp;&nbsp;</span></li></ol></div><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px" align="left"><strong><span style="font-family: 'Microsoft YaHei'">如果是release配置则添加：</span></strong></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px" align="left"></p><div class="dp-highlighter bg_cpp" style="font-family: Consolas, 'Courier New', Courier, mono, serif; width: 700.90625px; overflow: auto; padding-top: 1px; color: #333333; line-height: 26px; margin: 18px 0px !important; background-color: #e7e5dc"><div class="bar" style="padding-left: 45px"><div class="tools" style="padding: 3px 8px 10px 10px; font-stretch: normal; font-size: 9px; line-height: normal; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; color: silver; border-left-width: 3px; border-left-style: solid; border-left-color: #6ce26c; background-color: #f8f8f8"><strong>[cpp]</strong>&nbsp;<a style="text-decoration: none; outline: none; color: #a0a0a0; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; display: inline-block; width: 16px; height: 16px; text-indent: -2000px; background-image: url('http://static.blog.csdn.net/scripts/SyntaxHighlighter/styles/images/default/ico_plain.gif'); background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat" href="http://blog.csdn.net/lemolemac/article/details/9043961#" title="view plain" class="ViewSource">view plain</a><a style="text-decoration: none; outline: none; color: #a0a0a0; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; display: inline-block; width: 16px; height: 16px; text-indent: -2000px; background-image: url('http://static.blog.csdn.net/scripts/SyntaxHighlighter/styles/images/default/ico_copy.gif'); background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat" href="http://blog.csdn.net/lemolemac/article/details/9043961#" title="copy" class="CopyToClipboard">copy</a></div></div><ol class="dp-cpp" style="padding: 0px; border: none; list-style-position: initial; list-style-image: initial; color: #5c5c5c; margin: 0px 0px 1px 45px !important; background-color: #ffffff"><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">opencv_calib3d240.lib&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">opencv_contrib240.lib&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">opencv_core240.lib&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">opencv_features2d240.lib&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">opencv_flann240.lib&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">opencv_gpu240.lib&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">opencv_highgui240.lib&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">opencv_imgproc240.lib&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">opencv_legacy240.lib&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">opencv_ml240.lib&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">opencv_objdetect240.lib&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">opencv_ts240.lib&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">opencv_video240.lib&nbsp;&nbsp;</span></li></ol></div><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-family: 'Microsoft YaHei'"><strong>4、用VS2010新建控制台工程测试：</strong></span></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-family: 'Microsoft YaHei'">OpenTLD在VS2010编译运行包括如下步骤：</span></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px" align="left"></p><ul style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><li><span style="font-family: 'Microsoft YaHei'">新建空工程（我是vs2010)，取名TLD,并将解压缩下include的文件导入到TLD头head file中;并将解压缩下src的文件导入到TLD头sorcefile中。</span></li><li><span style="font-family: 'Microsoft YaHei'">round错误；解决办法：改成cvRound；</span></li><li><span style="font-family: 'Microsoft YaHei'">编译成功后，运行，摄像头一直亮着，将run_tld.cpp中的 capture.open(0)注释掉；</span></li><li><span style="font-family: 'Microsoft YaHei'">看了之后，明白了原来运行需要传递参数。见下面cmd命令：</span><div class="dp-highlighter bg_cpp" style="font-family: Consolas, 'Courier New', Courier, mono, serif; font-size: 12px; width: 661.3125px; overflow: auto; padding-top: 1px; margin: 18px 0px !important; background-color: #e7e5dc"><div class="bar" style="padding-left: 45px"><div class="tools" style="padding: 3px 8px 10px 10px; font-stretch: normal; font-size: 9px; line-height: normal; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; color: silver; border-left-width: 3px; border-left-style: solid; border-left-color: #6ce26c; background-color: #f8f8f8"><strong>[cpp]</strong>&nbsp;<a style="text-decoration: none; outline: none; color: #a0a0a0; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; display: inline-block; width: 16px; height: 16px; text-indent: -2000px; background-image: url('http://static.blog.csdn.net/scripts/SyntaxHighlighter/styles/images/default/ico_plain.gif'); background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat" href="http://blog.csdn.net/lemolemac/article/details/9043961#" title="view plain" class="ViewSource">view plain</a><a style="text-decoration: none; outline: none; color: #a0a0a0; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; display: inline-block; width: 16px; height: 16px; text-indent: -2000px; background-image: url('http://static.blog.csdn.net/scripts/SyntaxHighlighter/styles/images/default/ico_copy.gif'); background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat" href="http://blog.csdn.net/lemolemac/article/details/9043961#" title="copy" class="CopyToClipboard">copy</a></div></div><ol class="dp-cpp" style="padding: 0px; border: none; list-style-position: initial; list-style-image: initial; color: #5c5c5c; margin: 0px 0px 1px 45px !important; background-color: #ffffff"><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">-p&nbsp;parameters.yml&nbsp;-s&nbsp;datasets&#92;01_david&#92;david.mpg&nbsp;-b&nbsp;datasets&#92;01_david&#92;init.txt&nbsp;&ndash;tl&nbsp;&nbsp;</span></span></li></ol></div></li><li><span style="font-family: 'Microsoft YaHei'">TLD::bbPoints函数调用的ceil和floor函数强制把参数类型转换为double。</span></li><li><span style="font-family: 'Microsoft YaHei'">TLD::clusterBB函数中，vs不支持这种动态数组分配。</span><div class="dp-highlighter bg_cpp" style="font-family: Consolas, 'Courier New', Courier, mono, serif; font-size: 12px; width: 661.3125px; overflow: auto; padding-top: 1px; margin: 18px 0px !important; background-color: #e7e5dc"><div class="bar" style="padding-left: 45px"><div class="tools" style="padding: 3px 8px 10px 10px; font-stretch: normal; font-size: 9px; line-height: normal; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; color: silver; border-left-width: 3px; border-left-style: solid; border-left-color: #6ce26c; background-color: #f8f8f8"><strong>[cpp]</strong>&nbsp;<a style="text-decoration: none; outline: none; color: #a0a0a0; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; display: inline-block; width: 16px; height: 16px; text-indent: -2000px; background-image: url('http://static.blog.csdn.net/scripts/SyntaxHighlighter/styles/images/default/ico_plain.gif'); background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat" href="http://blog.csdn.net/lemolemac/article/details/9043961#" title="view plain" class="ViewSource">view plain</a><a style="text-decoration: none; outline: none; color: #a0a0a0; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; display: inline-block; width: 16px; height: 16px; text-indent: -2000px; background-image: url('http://static.blog.csdn.net/scripts/SyntaxHighlighter/styles/images/default/ico_copy.gif'); background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat" href="http://blog.csdn.net/lemolemac/article/details/9043961#" title="copy" class="CopyToClipboard">copy</a></div></div><ol class="dp-cpp" style="padding: 0px; border: none; list-style-position: initial; list-style-image: initial; color: #5c5c5c; margin: 0px 0px 1px 45px !important; background-color: #ffffff"><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #2e8b57; background-color: inherit" class="datatypes">float</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;L[c-1];&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">//Level</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #2e8b57; background-color: inherit" class="datatypes">int</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;nodes[c-1][2];&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #2e8b57; background-color: inherit" class="datatypes">int</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;belongs[c];&nbsp;&nbsp;</span></span></li></ol></div></li></ul><ul style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><li><span style="font-family: 'Microsoft YaHei'">改成指针和动态分配内存</span><div class="dp-highlighter bg_cpp" style="font-family: Consolas, 'Courier New', Courier, mono, serif; font-size: 12px; width: 661.3125px; overflow: auto; padding-top: 1px; margin: 18px 0px !important; background-color: #e7e5dc"><div class="bar" style="padding-left: 45px"><div class="tools" style="padding: 3px 8px 10px 10px; font-stretch: normal; font-size: 9px; line-height: normal; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; color: silver; border-left-width: 3px; border-left-style: solid; border-left-color: #6ce26c; background-color: #f8f8f8"><strong>[cpp]</strong>&nbsp;<a style="text-decoration: none; outline: none; color: #a0a0a0; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; display: inline-block; width: 16px; height: 16px; text-indent: -2000px; background-image: url('http://static.blog.csdn.net/scripts/SyntaxHighlighter/styles/images/default/ico_plain.gif'); background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat" href="http://blog.csdn.net/lemolemac/article/details/9043961#" title="view plain" class="ViewSource">view plain</a><a style="text-decoration: none; outline: none; color: #a0a0a0; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; display: inline-block; width: 16px; height: 16px; text-indent: -2000px; background-image: url('http://static.blog.csdn.net/scripts/SyntaxHighlighter/styles/images/default/ico_copy.gif'); background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat" href="http://blog.csdn.net/lemolemac/article/details/9043961#" title="copy" class="CopyToClipboard">copy</a></div></div><ol class="dp-cpp" style="padding: 0px; border: none; list-style-position: initial; list-style-image: initial; color: #5c5c5c; margin: 0px 0px 1px 45px !important; background-color: #ffffff"><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #2e8b57; background-color: inherit" class="datatypes">float</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;*L&nbsp;=&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">new</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #2e8b57; background-color: inherit" class="datatypes">float</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;[c-1];&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">//Level</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #2e8b57; background-color: inherit" class="datatypes">int</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;**nodes&nbsp;=&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">new</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #2e8b57; background-color: inherit" class="datatypes">int</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;*[c-1];&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">for</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">(</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #2e8b57; background-color: inherit" class="datatypes">int</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;2&nbsp;;i&nbsp;++)&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">nodes[i]&nbsp;=&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">new</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #2e8b57; background-color: inherit" class="datatypes">int</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;[c-1];&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #2e8b57; background-color: inherit" class="datatypes">int</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;*belongs&nbsp;=&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">new</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #2e8b57; background-color: inherit" class="datatypes">int</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;[c];&nbsp;&nbsp;</span></span></li></ol></div></li></ul><ul style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><li><span style="font-family: 'Microsoft YaHei'">记得在函数末释放分配的内存,有两个return的地方，这两个地方之前需要加上这一段。</span><div class="dp-highlighter bg_cpp" style="font-family: Consolas, 'Courier New', Courier, mono, serif; font-size: 12px; width: 661.3125px; overflow: auto; padding-top: 1px; margin: 18px 0px !important; background-color: #e7e5dc"><div class="bar" style="padding-left: 45px"><div class="tools" style="padding: 3px 8px 10px 10px; font-stretch: normal; font-size: 9px; line-height: normal; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; color: silver; border-left-width: 3px; border-left-style: solid; border-left-color: #6ce26c; background-color: #f8f8f8"><strong>[cpp]</strong>&nbsp;<a style="text-decoration: none; outline: none; color: #a0a0a0; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; display: inline-block; width: 16px; height: 16px; text-indent: -2000px; background-image: url('http://static.blog.csdn.net/scripts/SyntaxHighlighter/styles/images/default/ico_plain.gif'); background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat" href="http://blog.csdn.net/lemolemac/article/details/9043961#" title="view plain" class="ViewSource">view plain</a><a style="text-decoration: none; outline: none; color: #a0a0a0; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; display: inline-block; width: 16px; height: 16px; text-indent: -2000px; background-image: url('http://static.blog.csdn.net/scripts/SyntaxHighlighter/styles/images/default/ico_copy.gif'); background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat" href="http://blog.csdn.net/lemolemac/article/details/9043961#" title="copy" class="CopyToClipboard">copy</a></div></div><ol class="dp-cpp" style="padding: 0px; border: none; list-style-position: initial; list-style-image: initial; color: #5c5c5c; margin: 0px 0px 1px 45px !important; background-color: #ffffff"><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">delete</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;[]&nbsp;L;&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">L&nbsp;=&nbsp;NULL;&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">for</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;(</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #2e8b57; background-color: inherit" class="datatypes">int</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;2;&nbsp;++i)&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&#123;&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">delete</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;[]&nbsp;nodes[i];&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">nodes[i]&nbsp;=&nbsp;NULL;&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&#125;&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">delete</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;[]nodes;&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">nodes&nbsp;=&nbsp;NULL;&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">delete</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;[]&nbsp;belongs;&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">belongs&nbsp;=&nbsp;NULL;&nbsp;&nbsp;</span></li></ol></div><br /></li></ul><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px" align="left"><span style="color: #00b050"><span style="font-family: 'Microsoft YaHei'">注意：第一个视频运行起来貌似有问题，可以改换其他组的视频。</span></span></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-family: 'Microsoft YaHei'">可以做的事情：摆脱opencv的函数库，和加入多线程、directx、cpu增强指令集以及gpu的支持。以提高程序的执行效率。</span></p>
]]>
</description>
</item><item>
<link>http://i.renjihe.com/blog/read.php?6301</link>
<title><![CDATA[用Python和OpenCV创建一个图片搜索引擎的完整指南]]></title> 
<author>renjihe1988 &lt;admin@yourname.com&gt;</author>
<category><![CDATA[OpenCV]]></category>
<pubDate>Sun, 18 Jan 2015 06:12:49 +0000</pubDate> 
<guid>http://i.renjihe.com/blog/read.php?6301</guid> 
<description>
<![CDATA[ 
	http://python.jobbole.com/80860/<br /><br /><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">大家都知道，<strong style="border: 0px; margin: 0px; padding: 0px">通过文本或标签来搜索图片的体验非常糟糕。</strong></p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">无论你是将个人照片贴标签并分类，或是在公司的网站上搜索一堆照片，还是在为下一篇博客寻找合适的图片。在用文本和关键字来描述图片是非常痛苦的事。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">我就遇到了这样的痛苦的事情，上周二我打开了一个很老的家庭相册，其中的照片是9年前扫描成电子档的。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">我想找到我家在夏威夷海滩拍的照片。我用iPhoto打开相册，慢慢的浏览。这个过程非常辛苦，每个JPEG图像的元信息中的日期都是错的。我已经不记得文件夹中的图片是如何排列的，我绝望的搜索海滩的照片，但还是找不到。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">也许是运气，我跌跌撞撞的找到了其中一幅海滩上的照片。多美的一幅照片啊。蓝天中飘着棉花糖般的白云。晶莹透彻的海水，像丝绸一样掠过在金色的沙滩上。我几乎可以感觉微风轻抚着面庞，呼吸着海边湿润的空气。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px"><strong style="border: 0px; margin: 0px; padding: 0px">找到这幅照片后，我停止了手动搜索，打开一个代码编辑器。</strong></p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">虽然iPhoto这样的应用能让你将相片分组，甚至可以检测人脸，但我们可以做的更多。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">注意，我并不是介绍如何手动给图片添加标签。我是在介绍更强大的东西。比如通过一幅图片来搜索一组相似的图片。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">这是不是很酷？只需鼠标点击一次就可以可视化搜索图片。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">这就是我的工作内容。我用半个小时写好代码，完成了一个针对家庭假期相册的图片搜索引擎。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">然后用上面找到的那张海滩图片作为搜索源。几秒后我就找到了相册中其他的海滩图片，其中没有任何<strong style="border: 0px; margin: 0px; padding: 0px">为某张图片添加标签的动作</strong>。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">感兴趣吗，我们继续。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">在本文的其他部分，我将介绍如何自己创建一个图像搜索引擎。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">想要文本中的代码？</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">直接跳到文本中的最后的&ldquo;下载&rdquo;一节。</p><h2 style="border: 0px; margin: -9px 0px 20px; padding: 0px; font-size: 24px; font-weight: normal; font-stretch: normal; line-height: 36px; font-family: 'Microsoft YaHei', 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif">什么是图像搜索引擎？</h2><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">读者也许会问，什么才是一个真正的图像搜素引擎？</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">我的意思是，我们都熟悉基于文本的搜索引擎，如Google、Bing、Baidu等。用户只需输入几个与内容相关的关键字，接着就会获得搜索结果。但对于图像搜索引擎，其工作方式就有点区别。搜索时使用的不是文字，而是图片。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">听起来很困难，我的意思是，如何量化图像的内容，让其可搜索呢？</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">本文将逐步回答这个问题。首先，先了解一下图像搜索引擎的内容。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">一般来说，有三种类型的图像搜索引擎：<strong style="border: 0px; margin: 0px; padding: 0px">基于元数据</strong>、<strong style="border: 0px; margin: 0px; padding: 0px">基于例子</strong>、<strong style="border: 0px; margin: 0px; padding: 0px">混合模式</strong>。</p><h2 style="border: 0px; margin: -9px 0px 20px; padding: 0px; font-size: 24px; font-weight: normal; font-stretch: normal; line-height: 36px; font-family: 'Microsoft YaHei', 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif">基于元数据</h2><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px"><img style="border: 0px; margin: 0px; padding: 0px; font-size: 0px; color: transparent; vertical-align: middle; max-width: 100%; height: auto" src="http://ww1.sinaimg.cn/mw690/6941baebjw1enxaoyyl8cj20rs0gdacs.jpg" border="0" /></p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">图1：基于元数据的图像搜索引擎的例子。注意其中关键字和标签是手动关联到图像上的。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">通过元数据搜索与标准的关键字搜索引擎没有本质的不同。这种方式很少检测图像本身的内容。而是用相关的文本信息：如手动注释或添加标签；以及自动上下文提示（如网页中该图片附近的文字信息）。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">当用户在基于元数据的系统上进行搜索时，与传统的文本搜索引擎其实差点不多的。得到的是含有类似标签或注释的图片。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">再次说明，使用基于元数据系统的工具进行搜索，基本上是不查找图像本身的。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">用基于元数据进行搜索的应用中，一个比较好的例子就是<a style="text-decoration: none; outline: none; border: 0px; margin: 0px; padding: 0px; color: #0099cc" href="http://www.flickr.com/">Flickr</a>。将图像上传到Flickr后，输入一些文本作为标签描述这幅图像。接着Flickr会使用这些关键字进行搜索，查找并推荐其他相关的图像。</p><h3 style="border: 0px; margin: -8px 0px 20px; padding: 0px; font-size: 20px; font-weight: normal; font-stretch: normal; line-height: 30px; font-family: 'Microsoft YaHei', 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif">基于例子搜索</h3><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px"><img style="border: 0px; margin: 0px; padding: 0px; font-size: 0px; color: transparent; vertical-align: middle; max-width: 100%; height: auto" src="http://ww3.sinaimg.cn/mw690/6941baebjw1enxaoyoi03j20rs0gdjts.jpg" border="0" /></p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">图2：TinEye就是一个基于例子的图像搜索引擎。该搜索引擎会使用图像本身的内容进行搜索，而不是使用文本搜索。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">另一方面，基于例子搜索仅仅依赖于图像的内容，不需要提供关键字。引擎会分析、量化并存储图像，然后返回其他相关的图像。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">图像搜索引擎量化图像内容的过程称为<strong style="border: 0px; margin: 0px; padding: 0px">基于内容的图像信息获取（Content-Based Image Retrieval，CBIR）</strong>系统。术语CBIR通常用在学术文献中，但在实际上，这是&ldquo;图像搜索引擎&rdquo;的另一种表述，并特意指明该搜索引擎是严格基于图像的内容的，没有任何关于图像的文本的信息。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">基于例子系统的一个比较好的例子就是<a style="text-decoration: none; outline: none; border: 0px; margin: 0px; padding: 0px; color: #0099cc" href="https://www.tineye.com/">TinEye</a>。向TinEyet提交待查找图像时，TinEye实际上是一个逆向图像搜索引擎，TinEye返回该图像最相近的匹配，以及该图像位于的原始网页地址。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">看下本节刚开始的示例图像。我上传了一个Google logo图像。TinEye检测了图像的内容，在搜索了超过60亿幅图片后，返回了1.3万个含有Google logo图片的网页。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">所以仔细想一下：你需要为TinEye中的60亿幅图像收到添加标签吗？<strong style="border: 0px; margin: 0px; padding: 0px">当然不需要，</strong>为这么多图片手动添加标签需要庞大的人力物力。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">取而代之，使用某些算法从图像本身中提取&ldquo;特征&rdquo;（如用一组数字来量化并抽象表示图像）。接着，当用户提交了需要查找的图像，从这幅图像中提取特征，将其与数据库中的特征进行比较，尝试返回相似的图像。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">同样，依然需要强调，基于例子的搜索系统非常依赖图像的内容。这种类型的系统很难构建并扩展，但可以用算法全自动的搜索，无需人工干预。</p><h3 style="border: 0px; margin: -8px 0px 20px; padding: 0px; font-size: 20px; font-weight: normal; font-stretch: normal; line-height: 30px; font-family: 'Microsoft YaHei', 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif">混合方式</h3><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px"><img style="border: 0px; margin: 0px; padding: 0px; font-size: 0px; color: transparent; vertical-align: middle; max-width: 100%; height: auto" src="http://ww3.sinaimg.cn/mw690/6941baebjw1enxaoybmwpj20rs0gdwh2.jpg" border="0" /></p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">图3：混合式图像搜索引擎可以同时基于图像和文本描述搜索。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">当然，除了前面介绍的两种方式，还有一种介于两者之间的方式，如Twitter使用的。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">在Twitter上，可以与推文一起上传图像。这样就可以即使用提取图像本身的特征，也可以使用推文中的文本，从而诞生一种混合方式。基于这种方式可以可以构建一个即使用上下文关系，又使用基于例子搜索的策略的图像搜索引擎。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">提示：有兴趣阅读更多关于不同类型的图像搜索引擎的资料？我有一篇完整的博客介绍比较这些搜索引擎的，链接<a style="text-decoration: none; outline: none; border: 0px; margin: 0px; padding: 0px; color: #0099cc" href="http://www.pyimagesearch.com/2014/01/15/the-3-types-of-image-search-engines-search-by-meta-data-search-by-example-and-hybrid/">在此</a>。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">在进一步描述和构建图像搜索引擎之前，让我们先来了解一些重要的术语。</p><h3 style="border: 0px; margin: -8px 0px 20px; padding: 0px; font-size: 20px; font-weight: normal; font-stretch: normal; line-height: 30px; font-family: 'Microsoft YaHei', 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif">一些重要的术语</h3><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">在深入了解之前，先花点时间了解一些重要的术语。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">在构建图像搜索引擎时，首先要对<strong style="border: 0px; margin: 0px; padding: 0px">数据集编列索引</strong>。索引化数据集是量化数据集的过程，即通过<strong style="border: 0px; margin: 0px; padding: 0px">图像描述符</strong>（image descriptor，也称描述子）提取每幅图像的<strong style="border: 0px; margin: 0px; padding: 0px">特征</strong>。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px"><strong style="border: 0px; margin: 0px; padding: 0px">图像描述符</strong>就是用来描述图像的算法。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">例如：</p><ul style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; list-style-position: inside; list-style-image: initial; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px"><li style="border: 0px; margin: 0px; padding: 0px">R、G、B三色通道的均值和标准差。</li><li style="border: 0px; margin: 0px; padding: 0px">图像特征形状的统计矩.</li><li style="border: 0px; margin: 0px; padding: 0px">形状和纹理的梯度和朝向。</li></ul><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">这里最重要的是图像描述符确定了图像是如何量化的。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">另一方面，<strong style="border: 0px; margin: 0px; padding: 0px">特征</strong>是图像描述符的输出。当将一幅图像放入图像描述符中时，就会获得这幅图像的特征。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">以基本的术语来说。<strong style="border: 0px; margin: 0px; padding: 0px">特征</strong>（或<strong style="border: 0px; margin: 0px; padding: 0px">特征向量</strong>）仅仅是一个用来抽象表示或量化的图像的数字列表。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">来看下面这幅示例图像：</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px"><img style="border: 0px; margin: 0px; padding: 0px; font-size: 0px; color: transparent; vertical-align: middle; max-width: 100%; height: auto" src="http://ww4.sinaimg.cn/mw690/6941baebjw1enxaoxz5gcj20m805kglp.jpg" border="0" /></p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">图4：图像描述符的管道。描述符中有一幅输入图像，使用图像描述符会返回一个特征向量（一个数字列表），</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">这里对一幅输入图像使用图像描述符，输出是一组用来量化图像的数字。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">通过距离量测或其他相似度比较函数，特征向量可以用来表示比较的相似度。<strong style="border: 0px; margin: 0px; padding: 0px">距离量测</strong>和<strong style="border: 0px; margin: 0px; padding: 0px">相似度函数</strong>采用两个特征向量作为输入，返回一个数值来描述着两个特征向量的相似度。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">下图以可视化的方式比较了两幅图的比较过程：</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px"><img style="border: 0px; margin: 0px; padding: 0px; font-size: 0px; color: transparent; vertical-align: middle; max-width: 100%; height: auto" src="http://ww4.sinaimg.cn/mw690/6941baebjw1enxaoxqh6uj20iw06oaa8.jpg" border="0" /></p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">图5：为了比较两幅图，必须将对应的特征向量输入进距离量测/相似度比较函数。输出结果是一个数值，量化地描述两幅图下的相似度。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">给定两个特征向量，使用距离函数来确定这两个特征向量的相似度。距离函数的输出是一个浮点数，用来描述两幅图像的相似度。</p><h2 style="border: 0px; margin: -9px 0px 20px; padding: 0px; font-size: 24px; font-weight: normal; font-stretch: normal; line-height: 36px; font-family: 'Microsoft YaHei', 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif">CBIR系统的4个步骤</h2><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">无论构建的是什么样的CBIR系统，最终都可以分解成4个不同的步骤。</p><ol style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; list-style-position: inside; list-style-image: initial; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px"><li style="border: 0px; margin: 0px; padding: 0px"><strong style="border: 0px; margin: 0px; padding: 0px">定义图像描述符</strong>：在这一阶段，需要决定描述图像的哪一方面。是关注图像的颜色，还是图像中的物体形状，或是图像中的纹理？</li><li style="border: 0px; margin: 0px; padding: 0px"><strong style="border: 0px; margin: 0px; padding: 0px">索引化数据集</strong>：现在有了图像描述符，接着就是将这个图像描述符应用得到数据集中的每幅图像，提取这些图像的特征，将其存储起来（如CSV文件、RDBMS、Redis数据库中，等），这样后续步骤就能使用以便比较。</li><li style="border: 0px; margin: 0px; padding: 0px"><strong style="border: 0px; margin: 0px; padding: 0px">定义相似矩阵</strong>：很好，现在有了许多特征向量。但如何比较这些特征向量呢？流行的方式是比较欧几里德距离、余弦距离、或卡方距离。但实际中取决于两点：1、数据集；2、提取的特征类型。</li><li style="border: 0px; margin: 0px; padding: 0px"><strong style="border: 0px; margin: 0px; padding: 0px">搜索</strong>：最后一步是进行实际的搜索。用户会向系统提交一幅需要搜索的图片（例如从上传窗口或通过移动App提交），而你的任务是：1、提取这幅图像的特征；2、使用相似度函数将这幅图像的特征与已经索引化的特征进行比较。这样，只需根据相似度函数的结果，返回相关的图像就可以了。</li></ol><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">再次强调，这是所有CBIR系统中最基本的4步。如果使用的特征表示不同，则步骤数会增加，也会为每个步骤增加一定数量的子步骤。就目前而言，让我们关注并使用这4步。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">下面通过图像来具体了解这4个大步骤。下图表述的是步骤1和2：</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px"><img style="border: 0px; margin: 0px; padding: 0px; font-size: 0px; color: transparent; vertical-align: middle; max-width: 100%; height: auto" src="http://ww2.sinaimg.cn/mw690/6941baebjw1enxaoxhm7qj20k005kq32.jpg" border="0" /></p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">图6：处理并提取数据集中的每幅图像的流程图。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">首先提取数据集中每幅图像的特征，将这些特征存入一个数据库。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">接着可以执行搜索（步骤3和4）：</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px"><img style="border: 0px; margin: 0px; padding: 0px; font-size: 0px; color: transparent; vertical-align: middle; max-width: 100%; height: auto" src="http://ww3.sinaimg.cn/mw690/6941baebjw1enxaox7pzej20qo0akq3l.jpg" border="0" /></p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">图7：在CBIR系统中执行搜索。用户提交一个搜索请求，系统对搜索图像进行描述，其特征会与数据集中已有的特征进行比较，并对结果根据相关度进行排序，返回给用户。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">首先，用户必须像搜索引擎提交一幅需要查找的图像。接着对这幅图像提取特征信息。将这些特征信息与数据集中已有的图像的特征信息进行比较。最后，对结果根据相关度进行排序并返回给用户。</p><h3 style="border: 0px; margin: -8px 0px 20px; padding: 0px; font-size: 20px; font-weight: normal; font-stretch: normal; line-height: 30px; font-family: 'Microsoft YaHei', 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif">数据集&mdash;&mdash;假期相册</h3><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">这里将<a style="text-decoration: none; outline: none; border: 0px; margin: 0px; padding: 0px; color: #0099cc" href="http://lear.inrialpes.fr/people/jegou/data.php">INRIA假期数据集</a>作为图像搜索的数据集。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">这个数据集含有全世界许多地方的假期旅行，包括埃及金字塔、潜水、山区的森林、餐桌上的瓶子和盘子、游艇、海面上的日落。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">下面是数据集中的一些图片：</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px"><img style="border: 0px; margin: 0px; padding: 0px; font-size: 0px; color: transparent; vertical-align: middle; max-width: 100%; height: auto" src="http://ww1.sinaimg.cn/mw690/6941baebjw1enxaowj8l5j20rs0ciwie.jpg" border="0" /></p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">图8：数据集中的示例图像。我们将使用这些图像构建自己的图像搜索引擎。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">在本例中，对于我们希望从旅行相册中找到某种景色的相片来说，用这幅数据集作为示例来说非常好。</p><h3 style="border: 0px; margin: -8px 0px 20px; padding: 0px; font-size: 20px; font-weight: normal; font-stretch: normal; line-height: 30px; font-family: 'Microsoft YaHei', 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif">目标</h3><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">我们的目标是构建一个个人图像搜索引擎。将假期照片作为数据集，我们希望将这个数据集变成可搜索的，即一个&ldquo;基于例子&rdquo;的图像搜索引擎。例如，如果我提交了一幅在河中航行的帆船的照片，图像搜索引擎应该能找到并返回相册中码头和船坞拍摄的照片。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">看下面的图，其中有我提交的照片，即一幅在水里的船。得到了假期照片集合中相关的图像。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px"><img style="border: 0px; margin: 0px; padding: 0px; font-size: 0px; color: transparent; vertical-align: middle; max-width: 100%; height: auto" src="http://ww2.sinaimg.cn/mw690/6941baebjw1enxaowc7aij20m81hcqa1.jpg" border="0" /></p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">图9：图像搜索引擎的例子。提交了一幅含有海中船只的图像。返回相关的图像，这些图像都是在海中的船。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">为了构建这个系统，将使用一个简单且有效的图像描述符：<strong style="border: 0px; margin: 0px; padding: 0px">颜色直方图</strong>。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">通过将颜色直方图作为我们的图像描述符，可以根据图像的色彩分布提取特征。由于这一点，我们可以对我们的图像搜索引擎做个重要的假设：</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px"><strong style="border: 0px; margin: 0px; padding: 0px">假设</strong>：如果图像含有相似的色彩分布，那么这两幅图像就认为是相似的。即使图像的内容差别非常大，依然会根据色彩分布而被认为是相近的。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px"><strong style="border: 0px; margin: 0px; padding: 0px">这个假设非常重要</strong>，在使用颜色直方图作为图像描述符时，这是个公平且合理的假设。</p><h3 style="border: 0px; margin: -8px 0px 20px; padding: 0px; font-size: 20px; font-weight: normal; font-stretch: normal; line-height: 30px; font-family: 'Microsoft YaHei', 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif">第一步1：定义图像描述符</h3><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">这里不使用标准的颜色直方图，而是对其进行一些修改，使其更加健壮和强大。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">这个图像描述符是HSV颜色空间的3D颜色直方图（色相、饱和度、明度）。一般来说，图像由RGB构成的元组表示。通常将RGB色彩空间想象成一个立方体，如下图所示。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px"><img style="border: 0px; margin: 0px; padding: 0px; font-size: 0px; color: transparent; vertical-align: middle; max-width: 100%; height: auto" src="http://ww4.sinaimg.cn/mw690/6941baebjw1enxaosty2pj20m80jkjso.jpg" border="0" /></p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">图10：RGB立方体的例子。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">然而，虽然RGB值很容易理解，但RGB色彩空间无法模拟人眼接受到的色彩。取而代之，我们使用HSV色彩空间将像素点的映射到圆bin体上。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px"><img style="border: 0px; margin: 0px; padding: 0px; font-size: 0px; color: transparent; vertical-align: middle; max-width: 100%; height: auto" src="http://ww1.sinaimg.cn/mw690/6941baebjw1enxaosjlfaj20dw0ao74m.jpg" border="0" /></p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">图11：HSV圆bin体的例子。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">还有其他颜色空间能够更好的模拟人眼接收的颜色，如CIE L*a*b*和CIE XYZ颜色空间，但作为第一个图像搜索引擎的实现，先简化使用的色彩模型。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">现在选定了颜色空间，接着需要定义直方图中bin的数量。直方图用来粗略的表示图像中各强度像素的密度。本质上，<span style="border: 0px; margin: 0px; padding: 0px; color: #ff0000">直方图会估计底层函数的<span style="border: 0px; margin: 0px; padding: 0px; font-size: 12.8000001907349px">概率<span style="border: 0px; margin: 0px; padding: 0px">密度。在本例中<span style="border: 0px; margin: 0px; padding: 0px; color: #000000">，<span style="border: 0px; margin: 0px; padding: 0px">P是图像I中像素色彩C出现的概率。</span></span></span></span></span></p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">主要注意的是，为直方图选取bin的数目需要不断的权衡。如果选择的bin数目过少，那么直方图含有的数据量就不够，无法区分某些不同颜色分布的图像。反之，如果直方图选取的bin的数目过多，那么其中的组件就过多，导致内容很相近的图片也会判断成不相似。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">下面是直方图bin过少的例子。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px"><img style="border: 0px; margin: 0px; padding: 0px; font-size: 0px; color: transparent; vertical-align: middle; max-width: 100%; height: auto" src="http://ww4.sinaimg.cn/mw690/6941baebjw1enxaos8sjij20m80go3z3.jpg" border="0" /></p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">图12：9个bin直方图的例子。注意其中bin的数量很少，只有少数给定的像素值位列其中。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">注意其中只有少数几个bin及相应的像素值。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">下面是直方图bin过多的例子。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px"><img style="border: 0px; margin: 0px; padding: 0px; font-size: 0px; color: transparent; vertical-align: middle; max-width: 100%; height: auto" src="http://ww2.sinaimg.cn/mw690/6941baebjw1enxaoro7fxj20m80got9p.jpg" border="0" /></p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">图13：128 bin直方图的例子。注意其中含有许多的柱和相应的像素值。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">在上面的的例子中使用了许多bin，bin的数目过多，由于需要直方图中每个&ldquo;山峰&rdquo;和&ldquo;山谷&rdquo;都需要匹配才能认为图像是&ldquo;相似的&rdquo;，所以就失去了&ldquo;概括&rdquo;图像的能力。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">就我个人而言，我喜欢用迭代、实验性的方式来调整bin的数目。迭代方法一般基于数据集的大小调整。数据集越小，使用的bin的数目就越少。如果数据集非常大，则会使用更多的bin，这样可以让直方图更大，更能区分图像。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">一般来说，读者需要为颜色直方图描述符实验bin的个数，具体取决于数据集的大小和数据集中图像之间色彩分布的差异。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">对于我们的假期照片图像搜索引擎，将在HSV色彩空间中使用3D颜色直方图，8个bin用于色相通道、12个bin用于饱和度通道、3个bin用于明度通道，总共的特征向量有8 &times; 12 &times; 3=288。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">这意味着数据集中的每幅图像，无论其像素数目是36 &times; 36，还是2000 &times; 1800。最终都会用288个浮点数构成的列表抽象并量化表示。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px"><span style="border: 0px; margin: 0px; padding: 0px">我认为解释3D直方图最好的方式是用连接词AND。一个3D HSV颜色描述符将查找指定图像中1号bin有多少像素含有<strong style="border: 0px; margin: 0px; padding: 0px">色相</strong>值，AND有多少像素有<strong style="border: 0px; margin: 0px; padding: 0px">饱和度</strong>值，AND有多少像素有<strong style="border: 0px; margin: 0px; padding: 0px">明度</strong>值。计算出符合条件的像素值。虽然需要对每个bin重复这个操作，但可以非常高效的完成这个任务。</span></p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">很酷，是吧！</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">理论讲解的够多了，下面来开始编码。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">用你最喜欢的编辑器打开一个新文件，命名为colordescriptor.py。加入下面代码：</p><div style="border: 0px; margin: 0px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px"><div id="highlighter_496250" class="syntaxhighlighter notranslate python" style="border: 0px; width: 620px; margin: 1em 0px !important; padding: 1px !important; font-size: 12px !important; position: relative !important; overflow-y: hidden !important; overflow-x: auto !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important"><table border="0" cellspacing="0" cellpadding="0" style="border-collapse: collapse; border-spacing: 0px; width: 620px; border: 0px !important; margin: 0px !important; padding: 0px !important; font-size: 12px !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; box-sizing: content-box !important; min-height: inherit !important; background: none !important"><tbody><tr style="border: 0px !important; margin: 0px !important; padding: 0px !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; background: none !important"><td class="gutter" style="border: 0px !important; margin: 0px !important; padding: 0px !important; font-size: 12px !important; vertical-align: baseline !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; min-height: inherit !important; color: #afafaf !important; background: none !important"><div class="line number1 index0 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">1</div><div class="line number2 index1 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">2</div><div class="line number3 index2 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">3</div><div class="line number4 index3 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">4</div><div class="line number5 index4 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">5</div><div class="line number6 index5 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">6</div><div class="line number7 index6 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">7</div><div class="line number8 index7 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">8</div><div class="line number9 index8 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">9</div><div class="line number10 index9 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">10</div><div class="line number11 index10 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">11</div><div class="line number12 index11 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">12</div><div class="line number13 index12 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">13</div><div class="line number14 index13 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">14</div><div class="line number15 index14 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">15</div><div class="line number16 index15 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">16</div><div class="line number17 index16 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">17</div><div class="line number18 index17 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">18</div></td><td class="code" style="width: 585px; border: 0px !important; margin: 0px !important; padding: 0px !important; font-size: 12px !important; vertical-align: baseline !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; box-sizing: content-box !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; min-height: inherit !important; background: none !important"><div class="container" style="margin-left: -10px; width: 640px; border: 0px !important; margin-top: 0px !important; margin-right: 0px !important; margin-bottom: 0px !important; padding: 0px !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: relative !important; right: auto !important; top: auto !important; vertical-align: baseline !important; box-sizing: content-box !important; min-height: inherit !important; background: none !important"><div class="line number1 index0 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important"># import the necessary packages</div><div class="line number2 index1 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">import numpy as np</div><div class="line number3 index2 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">import cv2</div><div class="line number4 index3 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;</div><div class="line number5 index4 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">class ColorDescriptor:</div><div class="line number6 index5 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;def __init__(self, bins):</div><div class="line number7 index6 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# store the number of bins for the 3D histogram</div><div class="line number8 index7 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.bins = bins</div><div class="line number9 index8 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;</div><div class="line number10 index9 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;def describe(self, image):</div><div class="line number11 index10 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# convert the image to the HSV color space and initialize</div><div class="line number12 index11 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# the features used to quantify the image</div><div class="line number13 index12 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image = cv2.cvtColor(image, cv2.COLOR_BGR2HSV)</div><div class="line number14 index13 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;features = []</div><div class="line number15 index14 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;</div><div class="line number16 index15 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# grab the dimensions and compute the center of the image</div><div class="line number17 index16 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(h, w) = image.shape[:2]</div><div class="line number18 index17 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(cX, cY) = (int(w * 0.5), int(h * 0.5))</div></div></td></tr></tbody></table></div></div><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">首先导入所需的Python模块。用NumPy进行数值处理，用cv2使用OpenCV的Python绑定。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">在第五行定义了ColorDescriptor类。该类用来封装所有用于提取图像中3D HSV颜色直方图的逻辑。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">ColorDescriptor的__init__方法只有一个参数&mdash;&mdash;bins，即颜色直方图中bin的数目。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">在第10行定义describe方法，用于描述指定的图像。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">在describe方法中，将图像从RGB颜色空间（或是BGR颜色空间，OpenCV以NumPy数组的形式反序表示RGB图像）转成HSV颜色空间。接着初始化用于量化图像的特征列表features。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">17和18行获取图像的维度，并计算图像中心(x, y)的位置。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">现在遇到难点。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">这里不计算<strong style="border: 0px; margin: 0px; padding: 0px">整个</strong>图像的3D HSV颜色直方图，而是计算图像中<strong style="border: 0px; margin: 0px; padding: 0px">不同区域</strong>的3D HSV颜色直方图。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">使用<strong style="border: 0px; margin: 0px; padding: 0px">基于区域</strong>的直方图，而不是<strong style="border: 0px; margin: 0px; padding: 0px">全局</strong>直方图的好处是：这样我们可以模拟各个区域的颜色分布。例如看下面的这幅图像：</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px"><img style="border: 0px; margin: 0px; padding: 0px; font-size: 0px; color: transparent; vertical-align: middle; max-width: 100%; height: auto" src="http://ww2.sinaimg.cn/mw690/6941baebjw1enxaorec6pj20b408c75i.jpg" border="0" /></p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">图14：待搜索的图像。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">在这幅图像中，很明显，蓝天在图像的上部，而沙滩在底部。使用全局搜索的话，就无法确定图像中&ldquo;蓝色&rdquo;区域和&ldquo;棕色&rdquo;沙子区域的位置。而是仅仅知道图像中有多少比例是蓝色，有多少比例是棕色。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">为了消除这个问题，可以对图像中的不同区域计算颜色直方图：</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px"><img style="border: 0px; margin: 0px; padding: 0px; font-size: 0px; color: transparent; vertical-align: middle; max-width: 100%; height: auto" src="http://ww2.sinaimg.cn/mw690/6941baebjw1enxaor3j1yj20b408cwf3.jpg" border="0" /></p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">图15：将图像分为5个不同区域的例子。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">对于我们的图像描述符，将图像分为5个不停的区域：1、左上角；2、右上角；3、右下角；4、左下角；以及图像的中央。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">使用这些区域，可以粗略模拟出不同的区域。能够表示出蓝天在左上角和右上角，沙滩在左下角和右下角。图像的中央是沙滩和蓝天的结合处。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">下面的代码是创建基于区域的颜色描述符：</p><div style="border: 0px; margin: 0px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px"><div id="highlighter_160132" class="syntaxhighlighter notranslate python" style="border: 0px; width: 620px; margin: 1em 0px !important; padding: 1px !important; font-size: 12px !important; position: relative !important; overflow-y: hidden !important; overflow-x: auto !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important"><table border="0" cellspacing="0" cellpadding="0" style="border-collapse: collapse; border-spacing: 0px; width: 620px; border: 0px !important; margin: 0px !important; padding: 0px !important; font-size: 12px !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; box-sizing: content-box !important; min-height: inherit !important; background: none !important"><tbody><tr style="border: 0px !important; margin: 0px !important; padding: 0px !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; background: none !important"><td class="gutter" style="border: 0px !important; margin: 0px !important; padding: 0px !important; font-size: 12px !important; vertical-align: baseline !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; min-height: inherit !important; color: #afafaf !important; background: none !important"><div class="line number1 index0 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">1</div><div class="line number2 index1 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">2</div><div class="line number3 index2 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">3</div><div class="line number4 index3 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">4</div><div class="line number5 index4 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">5</div><div class="line number6 index5 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">6</div><div class="line number7 index6 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">7</div><div class="line number8 index7 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">8</div><div class="line number9 index8 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">9</div><div class="line number10 index9 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">10</div><div class="line number11 index10 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">11</div><div class="line number12 index11 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">12</div><div class="line number13 index12 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">13</div><div class="line number14 index13 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">14</div><div class="line number15 index14 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">15</div><div class="line number16 index15 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">16</div><div class="line number17 index16 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">17</div><div class="line number18 index17 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">18</div><div class="line number19 index18 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">19</div><div class="line number20 index19 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">20</div><div class="line number21 index20 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">21</div><div class="line number22 index21 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">22</div><div class="line number23 index22 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">23</div><div class="line number24 index23 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">24</div><div class="line number25 index24 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">25</div><div class="line number26 index25 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">26</div><div class="line number27 index26 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">27</div><div class="line number28 index27 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">28</div><div class="line number29 index28 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">29</div><div class="line number30 index29 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">30</div><div class="line number31 index30 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">31</div><div class="line number32 index31 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">32</div><div class="line number33 index32 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">33</div><div class="line number34 index33 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">34</div><div class="line number35 index34 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">35</div><div class="line number36 index35 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">36</div><div class="line number37 index36 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">37</div><div class="line number38 index37 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">38</div><div class="line number39 index38 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">39</div><div class="line number40 index39 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">40</div><div class="line number41 index40 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">41</div><div class="line number42 index41 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">42</div><div class="line number43 index42 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">43</div><div class="line number44 index43 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">44</div><div class="line number45 index44 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">45</div><div class="line number46 index45 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">46</div><div class="line number47 index46 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">47</div><div class="line number48 index47 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">48</div><div class="line number49 index48 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">49</div><div class="line number50 index49 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">50</div></td><td class="code" style="width: 585px; border: 0px !important; margin: 0px !important; padding: 0px !important; font-size: 12px !important; vertical-align: baseline !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; box-sizing: content-box !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; min-height: inherit !important; background: none !important"><div class="container" style="margin-left: -10px; width: 640px; border: 0px !important; margin-top: 0px !important; margin-right: 0px !important; margin-bottom: 0px !important; padding: 0px !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: relative !important; right: auto !important; top: auto !important; vertical-align: baseline !important; box-sizing: content-box !important; min-height: inherit !important; background: none !important"><div class="line number1 index0 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important"># import the necessary packages</div><div class="line number2 index1 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">import numpy as np</div><div class="line number3 index2 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">import cv2</div><div class="line number4 index3 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;</div><div class="line number5 index4 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">class ColorDescriptor:</div><div class="line number6 index5 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;def __init__(self, bins):</div><div class="line number7 index6 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# store the number of bins for the 3D histogram</div><div class="line number8 index7 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.bins = bins</div><div class="line number9 index8 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;</div><div class="line number10 index9 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;def describe(self, image):</div><div class="line number11 index10 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# convert the image to the HSV color space and initialize</div><div class="line number12 index11 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# the features used to quantify the image</div><div class="line number13 index12 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image = cv2.cvtColor(image, cv2.COLOR_BGR2HSV)</div><div class="line number14 index13 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;features = []</div><div class="line number15 index14 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;</div><div class="line number16 index15 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# grab the dimensions and compute the center of the image</div><div class="line number17 index16 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(h, w) = image.shape[:2]</div><div class="line number18 index17 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(cX, cY) = (int(w * 0.5), int(h * 0.5))</div><div class="line number19 index18 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;</div><div class="line number20 index19 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# divide the image into four rectangles/segments (top-left,</div><div class="line number21 index20 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# top-right, bottom-right, bottom-left)</div><div class="line number22 index21 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;segments = [(0, cX, 0, cY), (cX, w, 0, cY), (cX, w, cY, h),</div><div class="line number23 index22 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(0, cX, cY, h)]</div><div class="line number24 index23 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;</div><div class="line number25 index24 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# construct an elliptical mask representing the center of the</div><div class="line number26 index25 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# image</div><div class="line number27 index26 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(axesX, axesY) = (int(w * 0.75) / 2, int(h * 0.75) / 2)</div><div class="line number28 index27 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ellipMask = np.zeros(image.shape[:2], dtype = &quot;uint8&quot;)</div><div class="line number29 index28 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cv2.ellipse(ellipMask, (cX, cY), (axesX, axesY), 0, 0, 360, 255, -1)</div><div class="line number30 index29 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;</div><div class="line number31 index30 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# loop over the segments</div><div class="line number32 index31 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (startX, endX, startY, endY) in segments:</div><div class="line number33 index32 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# construct a mask for each corner of the image, subtracting</div><div class="line number34 index33 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# the elliptical center from it</div><div class="line number35 index34 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cornerMask = np.zeros(image.shape[:2], dtype = &quot;uint8&quot;)</div><div class="line number36 index35 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cv2.rectangle(cornerMask, (startX, startY), (endX, endY), 255, -1)</div><div class="line number37 index36 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cornerMask = cv2.subtract(cornerMask, ellipMask)</div><div class="line number38 index37 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;</div><div class="line number39 index38 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# extract a color histogram from the image, then update the</div><div class="line number40 index39 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# feature vector</div><div class="line number41 index40 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hist = self.histogram(image, cornerMask)</div><div class="line number42 index41 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;features.extend(hist)</div><div class="line number43 index42 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;</div><div class="line number44 index43 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# extract a color histogram from the elliptical region and</div><div class="line number45 index44 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# update the feature vector</div><div class="line number46 index45 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hist = self.histogram(image, ellipMask)</div><div class="line number47 index46 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;features.extend(hist)</div><div class="line number48 index47 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;</div><div class="line number49 index48 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# return the feature vector</div><div class="line number50 index49 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return features</div></div></td></tr></tbody></table></div></div><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">22和23行用于分别定义左上、右上、右下、和左下区域。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">这里，我们需要构建一个椭圆用来表示图像的中央区域。在代码的27行，定义一个长短轴分别为图像长宽75%的椭圆。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">接着初始化一个空白图像（将图像填充0，表示黑色的背景），该图像与需要描述的图像大小相同，见28行。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">最后，在29行使用cv2.ellipse函数绘制实际的椭圆。该函数需要8个不同的参数：</p><ol style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; list-style-position: inside; list-style-image: initial; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px"><li style="border: 0px; margin: 0px; padding: 0px">需要绘制椭圆的图像。这里使用了下面会介绍的&ldquo;掩模&rdquo;的概念。</li><li style="border: 0px; margin: 0px; padding: 0px">两个元素的元组，用来表示图像的中心坐标。</li><li style="border: 0px; margin: 0px; padding: 0px">两个元组的元组，表示椭圆的两个轴。在这里，椭圆的长短轴长度为图像长宽的75%。</li><li style="border: 0px; margin: 0px; padding: 0px">椭圆的旋转角度。在本例中，椭圆无需旋转，所以值为0。</li><li style="border: 0px; margin: 0px; padding: 0px">椭圆的起始角。</li><li style="border: 0px; margin: 0px; padding: 0px">椭圆的终止角。看上一个参数，这意味着绘制的是完整的椭圆。</li><li style="border: 0px; margin: 0px; padding: 0px">椭圆的颜色，255表示的绘制的是白色椭圆。</li><li style="border: 0px; margin: 0px; padding: 0px">椭圆边框的大小。传递正数比会以相应的像素数目绘制椭圆边框。负数表示椭圆是填充模式。</li></ol><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">在35行为每个角的掩模分配内存，在36行为图像的每个角绘制白色矩形，接着在37行将矩形减去中间的椭圆。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">如果将这个过程用图像动态表示，看上去应该是这样的：</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px"><img style="border: 0px; margin: 0px; padding: 0px; font-size: 0px; color: transparent; vertical-align: middle; max-width: 100%; height: auto" src="http://ww1.sinaimg.cn/large/6941baebjw1enxaoqtwk7g20m808cqdw.gif" border="0" /></p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">图16：为图像中每个需要提取特征的区域构建掩模。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">如这个动画所示，我们独立检测每块区域，在迭代中移除每个矩形与图像中间的椭圆重叠的部分。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">读者也许会奇怪，&ldquo;我们不是要提取图像的颜色直方图吗？为什么要做这些掩模的事情？&rdquo;</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">问得好！</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">原因是因为我们需要告诉OpenCV直方图函数我们要提取的颜色直方图的区域。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">记住，我们的目标是分开描述图像的每个区域。表述不同区域最高效的方法是使用掩模。对于图像中某个点(x, y)，只有掩模中该点位白色(255)时，该像素点才会用于计算直方图。如果该像素点对应的位置在掩模中是黑色(0)，将会被忽略。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">通过下图可以更加深刻的了解这个概念。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px"><img style="border: 0px; margin: 0px; padding: 0px; font-size: 0px; color: transparent; vertical-align: middle; max-width: 100%; height: auto" src="http://ww1.sinaimg.cn/large/6941baebjw1enxaoqhe8ag20m808cgo5.gif" border="0" /></p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">图17：对图像使用掩模。注意左图中只有右图掩模中对应的区域为白色才会显示。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">可以看到，只有掩模的区域才会用于直方图的计算中。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">很合理，是吧。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">所以现在在41行针对每个区域都调用直方图方法。第一个参数是需要提取特征的图像，第二个参数是掩模区域，这样来提取颜色直方图。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">histogram方法会返回当前区域的颜色直方图表示，我们将其添加到特征列表中。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">46和47行提取图像中间（椭圆）区域的颜色直方图并更新features列表。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">最后，在50行像调用函数返回特征向量。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">现在来快速浏览下实际的histogram方法：</p><div style="border: 0px; margin: 0px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px"><div id="highlighter_115886" class="syntaxhighlighter notranslate actionscript3" style="border: 0px; width: 620px; margin: 1em 0px !important; padding: 1px !important; font-size: 12px !important; position: relative !important; overflow-y: hidden !important; overflow-x: auto !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important"><table border="0" cellspacing="0" cellpadding="0" style="border-collapse: collapse; border-spacing: 0px; width: 620px; border: 0px !important; margin: 0px !important; padding: 0px !important; font-size: 12px !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; box-sizing: content-box !important; min-height: inherit !important; background: none !important"><tbody><tr style="border: 0px !important; margin: 0px !important; padding: 0px !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; background: none !important"><td class="gutter" style="border: 0px !important; margin: 0px !important; padding: 0px !important; font-size: 12px !important; vertical-align: baseline !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; min-height: inherit !important; color: #afafaf !important; background: none !important"><div class="line number1 index0 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">1</div><div class="line number2 index1 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">2</div><div class="line number3 index2 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">3</div><div class="line number4 index3 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">4</div><div class="line number5 index4 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">5</div><div class="line number6 index5 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">6</div><div class="line number7 index6 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">7</div><div class="line number8 index7 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">8</div><div class="line number9 index8 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">9</div><div class="line number10 index9 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">10</div></td><td class="code" style="width: 585px; border: 0px !important; margin: 0px !important; padding: 0px !important; font-size: 12px !important; vertical-align: baseline !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; box-sizing: content-box !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; min-height: inherit !important; background: none !important"><div class="container" style="margin-left: -10px; width: 640px; border: 0px !important; margin-top: 0px !important; margin-right: 0px !important; margin-bottom: 0px !important; padding: 0px !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: relative !important; right: auto !important; top: auto !important; vertical-align: baseline !important; box-sizing: content-box !important; min-height: inherit !important; background: none !important"><div class="line number1 index0 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">def histogram(self, image, mask):</div><div class="line number2 index1 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;# extract a 3D color histogram from the masked region of the</div><div class="line number3 index2 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;# image, using the supplied number of bins per channel; then</div><div class="line number4 index3 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;# normalize the histogram</div><div class="line number5 index4 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;hist = cv2.calcHist([image], [0, 1, 2], mask, self.bins,</div><div class="line number6 index5 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[0, 180, 0, 256, 0, 256])</div><div class="line number7 index6 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;hist = cv2.normalize(hist).flatten()</div><div class="line number8 index7 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;</div><div class="line number9 index8 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;# return the histogram</div><div class="line number10 index9 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;return hist.</div></div></td></tr></tbody></table></div></div><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">这里的histogram方法需要两个参数，第一个是需要描述的图像，第二个是mask，描述需要描述的图像区域。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">在5和6行，通过调用cv2.calcHist计算图像掩模区域的直方图，使用构造器中的bin数目作为参数。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px"><span style="border: 0px; margin: 0px; padding: 0px">在7行对直方图归一化。这意味着如果我们计算两幅相同的图像，其中一幅比另一幅大50%，直方图会是相同的。对直方图进行归一化非常重要，这样每个直方图表示的就是图像中每个bin的所占的比例，而不是每个bin的个数。同样，归一化能保证不同尺寸但内容近似的图像也会在比较函数中认为是相似的。</span></p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">最后，在10行向调用函数返回归一化后的3D HSV颜色直方图。</p><h3 style="border: 0px; margin: -8px 0px 20px; padding: 0px; font-size: 20px; font-weight: normal; font-stretch: normal; line-height: 30px; font-family: 'Microsoft YaHei', 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif">步骤2：从数据集提取特征</h3><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">现在有了定义好的图像描述符，进入第二步，对数据集中的每幅图像提取特征（如颜色直方图）。提取特征并将其持久保存起来的过程一般称为&ldquo;索引化&rdquo;。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">继续来看对假期照片数据集进行索引化的代码。创建一个新文件，命名为index.py，添加索引化所需的代码：</p><div style="border: 0px; margin: 0px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px"><div id="highlighter_432987" class="syntaxhighlighter notranslate python" style="border: 0px; width: 620px; margin: 1em 0px !important; padding: 1px !important; font-size: 12px !important; position: relative !important; overflow-y: hidden !important; overflow-x: auto !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important"><table border="0" cellspacing="0" cellpadding="0" style="border-collapse: collapse; border-spacing: 0px; width: 620px; border: 0px !important; margin: 0px !important; padding: 0px !important; font-size: 12px !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; box-sizing: content-box !important; min-height: inherit !important; background: none !important"><tbody><tr style="border: 0px !important; margin: 0px !important; padding: 0px !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; background: none !important"><td class="gutter" style="border: 0px !important; margin: 0px !important; padding: 0px !important; font-size: 12px !important; vertical-align: baseline !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; min-height: inherit !important; color: #afafaf !important; background: none !important"><div class="line number1 index0 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">1</div><div class="line number2 index1 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">2</div><div class="line number3 index2 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">3</div><div class="line number4 index3 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">4</div><div class="line number5 index4 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">5</div><div class="line number6 index5 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">6</div><div class="line number7 index6 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">7</div><div class="line number8 index7 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">8</div><div class="line number9 index8 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">9</div><div class="line number10 index9 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">10</div><div class="line number11 index10 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">11</div><div class="line number12 index11 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">12</div><div class="line number13 index12 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">13</div><div class="line number14 index13 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">14</div><div class="line number15 index14 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">15</div><div class="line number16 index15 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">16</div></td><td class="code" style="width: 585px; border: 0px !important; margin: 0px !important; padding: 0px !important; font-size: 12px !important; vertical-align: baseline !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; box-sizing: content-box !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; min-height: inherit !important; background: none !important"><div class="container" style="margin-left: -10px; width: 640px; border: 0px !important; margin-top: 0px !important; margin-right: 0px !important; margin-bottom: 0px !important; padding: 0px !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: relative !important; right: auto !important; top: auto !important; vertical-align: baseline !important; box-sizing: content-box !important; min-height: inherit !important; background: none !important"><div class="line number1 index0 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important"># import the necessary packages</div><div class="line number2 index1 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">from pyimagesearch.colordescriptor import ColorDescriptor</div><div class="line number3 index2 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">import argparse</div><div class="line number4 index3 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">import glob</div><div class="line number5 index4 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">import cv2</div><div class="line number6 index5 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;</div><div class="line number7 index6 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important"># construct the argument parser and parse the arguments</div><div class="line number8 index7 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">ap = argparse.ArgumentParser()</div><div class="line number9 index8 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">ap.add_argument(&quot;-d&quot;, &quot;--dataset&quot;, required = True,</div><div class="line number10 index9 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;help = &quot;Path to the directory that contains the images to be indexed&quot;)</div><div class="line number11 index10 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">ap.add_argument(&quot;-i&quot;, &quot;--index&quot;, required = True,</div><div class="line number12 index11 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;help = &quot;Path to where the computed index will be stored&quot;)</div><div class="line number13 index12 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">args = vars(ap.parse_args())</div><div class="line number14 index13 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;</div><div class="line number15 index14 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important"># initialize the color descriptor</div><div class="line number16 index15 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">cd = ColorDescriptor((8, 12, 3))</div></div></td></tr></tbody></table></div></div><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">首先导入所需的模块。注意第一步中的ColorDescriptor类，这里将其放入pyimagesearch模块，以便更好的组织代码。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">还需要argparse模块来处理命令行参数、glob来获取图像的文件路径，以及cv2来使用OpenCV的接口。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">7-12行用来处理命令行指令。这里需要两个指令，&ndash;dataset，表示假期相册的路径。&ndash;index，表示输出的CSV文件含有图像文件名和对应的特征。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">最后，在16行初始化ColorDescriptor，8 bin拥有色相、12 bin用于饱和度、3 bin用于明度。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">现在所有内容都初始化了，可以从数据集提取特征了：</p><div style="border: 0px; margin: 0px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px"><div id="highlighter_937949" class="syntaxhighlighter notranslate actionscript3" style="border: 0px; width: 620px; margin: 1em 0px !important; padding: 1px !important; font-size: 12px !important; position: relative !important; overflow-y: hidden !important; overflow-x: auto !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important"><table border="0" cellspacing="0" cellpadding="0" style="border-collapse: collapse; border-spacing: 0px; width: 620px; border: 0px !important; margin: 0px !important; padding: 0px !important; font-size: 12px !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; box-sizing: content-box !important; min-height: inherit !important; background: none !important"><tbody><tr style="border: 0px !important; margin: 0px !important; padding: 0px !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; background: none !important"><td class="gutter" style="border: 0px !important; margin: 0px !important; padding: 0px !important; font-size: 12px !important; vertical-align: baseline !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; min-height: inherit !important; color: #afafaf !important; background: none !important"><div class="line number1 index0 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">1</div><div class="line number2 index1 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">2</div><div class="line number3 index2 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">3</div><div class="line number4 index3 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">4</div><div class="line number5 index4 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">5</div><div class="line number6 index5 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">6</div><div class="line number7 index6 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">7</div><div class="line number8 index7 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">8</div><div class="line number9 index8 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">9</div><div class="line number10 index9 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">10</div><div class="line number11 index10 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">11</div><div class="line number12 index11 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">12</div><div class="line number13 index12 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">13</div><div class="line number14 index13 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">14</div><div class="line number15 index14 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">15</div><div class="line number16 index15 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">16</div><div class="line number17 index16 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">17</div><div class="line number18 index17 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">18</div><div class="line number19 index18 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">19</div></td><td class="code" style="width: 585px; border: 0px !important; margin: 0px !important; padding: 0px !important; font-size: 12px !important; vertical-align: baseline !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; box-sizing: content-box !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; min-height: inherit !important; background: none !important"><div class="container" style="margin-left: -10px; width: 640px; border: 0px !important; margin-top: 0px !important; margin-right: 0px !important; margin-bottom: 0px !important; padding: 0px !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: relative !important; right: auto !important; top: auto !important; vertical-align: baseline !important; box-sizing: content-box !important; min-height: inherit !important; background: none !important"><div class="line number1 index0 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important"># open the output index file for writing</div><div class="line number2 index1 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">output = open(args[&quot;index&quot;], &quot;w&quot;)</div><div class="line number3 index2 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;</div><div class="line number4 index3 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important"># use glob to grab the image paths and loop over them</div><div class="line number5 index4 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">for imagePath in glob.glob(args[&quot;dataset&quot;] + &quot;/*.png&quot;):</div><div class="line number6 index5 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;# extract the image ID (i.e. the unique filename) from the image</div><div class="line number7 index6 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;# path and load the image itself</div><div class="line number8 index7 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;imageID = imagePath[imagePath.rfind(&quot;/&quot;) + 1:]</div><div class="line number9 index8 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;image = cv2.imread(imagePath)</div><div class="line number10 index9 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;</div><div class="line number11 index10 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;# describe the image</div><div class="line number12 index11 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;features = cd.describe(image)</div><div class="line number13 index12 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;</div><div class="line number14 index13 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;# write the features to file</div><div class="line number15 index14 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;features = [str(f) for f in features]</div><div class="line number16 index15 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;output.write(&quot;%s,%sn&quot; % (imageID, &quot;,&quot;.join(features)))</div><div class="line number17 index16 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;</div><div class="line number18 index17 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important"># close the index file</div><div class="line number19 index18 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">output.close()</div></div></td></tr></tbody></table></div></div><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">在2行代开输出文件，在5行遍历数据集中的所有图像。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">对于每幅图像，可以提取一个imageID，即图像的文件名。对于这个作为示例的搜索引擎，我们假定每个文件名都是唯一的，也可以针对每幅图像生产一个UUID。在9行将从磁盘上读取图像。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">现在图像载入内存了，在12行对图像使用图像描述符并提取特征。ColorDescriptor的describe方法返回由浮点数构成的列表，用来量化并表示图像。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">这个数字列表，或者说特征向量，含有第一步中图像的5个区域的描述。每个区域由一个直方图表示，含有8 &times; 12 &times; 3 = 288项。5个区域总共有5 &times; 288 = 1440维度。。。因此每个图像使用1440个数字量化并表示。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">15和16行简单的将图像的文件名和管理的特征向量写入文件。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">为了索引化我们的相册数据集，打开一个命令行输入下面的命令：</p><div style="border: 0px; margin: 0px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px"><div id="highlighter_144104" class="syntaxhighlighter notranslate shell" style="border: 0px; width: 620px; margin: 1em 0px !important; padding: 1px !important; font-size: 12px !important; position: relative !important; overflow-y: hidden !important; overflow-x: auto !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important"><table border="0" cellspacing="0" cellpadding="0" style="border-collapse: collapse; border-spacing: 0px; width: 620px; border: 0px !important; margin: 0px !important; padding: 0px !important; font-size: 12px !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; box-sizing: content-box !important; min-height: inherit !important; background: none !important"><tbody><tr style="border: 0px !important; margin: 0px !important; padding: 0px !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; background: none !important"><td class="gutter" style="border: 0px !important; margin: 0px !important; padding: 0px !important; font-size: 12px !important; vertical-align: baseline !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; min-height: inherit !important; color: #afafaf !important; background: none !important"><div class="line number1 index0 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">1</div></td><td class="code" style="width: 592px; border: 0px !important; margin: 0px !important; padding: 0px !important; font-size: 12px !important; vertical-align: baseline !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; box-sizing: content-box !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; min-height: inherit !important; background: none !important"><div class="container" style="margin-left: -10px; width: 640px; border: 0px !important; margin-top: 0px !important; margin-right: 0px !important; margin-bottom: 0px !important; padding: 0px !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: relative !important; right: auto !important; top: auto !important; vertical-align: baseline !important; box-sizing: content-box !important; min-height: inherit !important; background: none !important"><div class="line number1 index0 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">$ python index.py --dataset dataset --index index.csv</div></div></td></tr></tbody></table></div></div><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">这个脚本运行的很快，完成后将会获得一个名为index.csv的新文件。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">使用你最喜欢的文本编辑器打开并查看该文件。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">可以看到在.csv文件的每一行，第一项是文件名，第二项是一个数字列表。这个数字列表就是用来表示并量化图像的特征向量。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">对index文件运行wc命令，可以看到已经成功对数据集中805幅图像索引化了：</p><div style="border: 0px; margin: 0px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px"><div id="highlighter_473999" class="syntaxhighlighter notranslate shell" style="border: 0px; width: 620px; margin: 1em 0px !important; padding: 1px !important; font-size: 12px !important; position: relative !important; overflow-y: hidden !important; overflow-x: auto !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important"><table border="0" cellspacing="0" cellpadding="0" style="border-collapse: collapse; border-spacing: 0px; width: 620px; border: 0px !important; margin: 0px !important; padding: 0px !important; font-size: 12px !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; box-sizing: content-box !important; min-height: inherit !important; background: none !important"><tbody><tr style="border: 0px !important; margin: 0px !important; padding: 0px !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; background: none !important"><td class="gutter" style="border: 0px !important; margin: 0px !important; padding: 0px !important; font-size: 12px !important; vertical-align: baseline !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; min-height: inherit !important; color: #afafaf !important; background: none !important"><div class="line number1 index0 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">1</div><div class="line number2 index1 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">2</div></td><td class="code" style="width: 592px; border: 0px !important; margin: 0px !important; padding: 0px !important; font-size: 12px !important; vertical-align: baseline !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; box-sizing: content-box !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; min-height: inherit !important; background: none !important"><div class="container" style="margin-left: -10px; width: 640px; border: 0px !important; margin-top: 0px !important; margin-right: 0px !important; margin-bottom: 0px !important; padding: 0px !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: relative !important; right: auto !important; top: auto !important; vertical-align: baseline !important; box-sizing: content-box !important; min-height: inherit !important; background: none !important"><div class="line number1 index0 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">$ wc -l index.csv</div><div class="line number2 index1 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;805 index.csv</div></div></td></tr></tbody></table></div></div><h3 style="border: 0px; margin: -8px 0px 20px; padding: 0px; font-size: 20px; font-weight: normal; font-stretch: normal; line-height: 30px; font-family: 'Microsoft YaHei', 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif">第3步：搜索</h3><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">现在已经从数据集提取了特征了，接下来需要一个方法来比较这些特征，获取相似度。这就是第三步的内容，创建一个类来定义两幅图像的相似矩阵。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">创建一个新文件，命名为searcher.py，让我们在这里做点神奇的事情：</p><div style="border: 0px; margin: 0px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px"><div id="highlighter_145508" class="syntaxhighlighter notranslate python" style="border: 0px; width: 620px; margin: 1em 0px !important; padding: 1px !important; font-size: 12px !important; position: relative !important; overflow-y: hidden !important; overflow-x: auto !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important"><table border="0" cellspacing="0" cellpadding="0" style="border-collapse: collapse; border-spacing: 0px; width: 620px; border: 0px !important; margin: 0px !important; padding: 0px !important; font-size: 12px !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; box-sizing: content-box !important; min-height: inherit !important; background: none !important"><tbody><tr style="border: 0px !important; margin: 0px !important; padding: 0px !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; background: none !important"><td class="gutter" style="border: 0px !important; margin: 0px !important; padding: 0px !important; font-size: 12px !important; vertical-align: baseline !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; min-height: inherit !important; color: #afafaf !important; background: none !important"><div class="line number1 index0 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">1</div><div class="line number2 index1 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">2</div><div class="line number3 index2 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">3</div><div class="line number4 index3 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">4</div><div class="line number5 index4 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">5</div><div class="line number6 index5 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">6</div><div class="line number7 index6 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">7</div><div class="line number8 index7 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">8</div><div class="line number9 index8 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">9</div><div class="line number10 index9 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">10</div><div class="line number11 index10 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">11</div><div class="line number12 index11 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">12</div></td><td class="code" style="width: 585px; border: 0px !important; margin: 0px !important; padding: 0px !important; font-size: 12px !important; vertical-align: baseline !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; box-sizing: content-box !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; min-height: inherit !important; background: none !important"><div class="container" style="margin-left: -10px; width: 640px; border: 0px !important; margin-top: 0px !important; margin-right: 0px !important; margin-bottom: 0px !important; padding: 0px !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: relative !important; right: auto !important; top: auto !important; vertical-align: baseline !important; box-sizing: content-box !important; min-height: inherit !important; background: none !important"><div class="line number1 index0 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important"># import the necessary packages</div><div class="line number2 index1 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">import numpy as np</div><div class="line number3 index2 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">import csv</div><div class="line number4 index3 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;</div><div class="line number5 index4 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">class Searcher:</div><div class="line number6 index5 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;def __init__(self, indexPath):</div><div class="line number7 index6 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# store our index path</div><div class="line number8 index7 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.indexPath = indexPath</div><div class="line number9 index8 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;</div><div class="line number10 index9 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;def search(self, queryFeatures, limit = 10):</div><div class="line number11 index10 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# initialize our dictionary of results</div><div class="line number12 index11 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;results = &#123;&#125;</div></div></td></tr></tbody></table></div></div><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">首先先导入NumPy用于数值计算，csv用于方便的处理index.csv文件。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">在第5行定义Searcher类。Searcher类的构造器只需一个参数，indexPath，用于表示index.csv文件在磁盘上的路径。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">要实际执行搜索，需要在第10行调用search方法。该方法需要两个参数，queryFeatures是提取自待搜索图像（如向CBIR系统提交并请求返回相似图像的图像），和返回图像的数目的最大值。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">最后，在12行初始化results字典。在这里，字典有很用的用途，每个图像有唯一的imageID，可以作为字典的键，而相似度作为字典的值。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">好了，现在将注意力放在这里。这里是发生神奇的地方：</p><div style="border: 0px; margin: 0px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px"><div id="highlighter_996429" class="syntaxhighlighter notranslate python" style="border: 0px; width: 620px; margin: 1em 0px !important; padding: 1px !important; font-size: 12px !important; position: relative !important; overflow-y: hidden !important; overflow-x: auto !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important"><table border="0" cellspacing="0" cellpadding="0" style="border-collapse: collapse; border-spacing: 0px; width: 620px; border: 0px !important; margin: 0px !important; padding: 0px !important; font-size: 12px !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; box-sizing: content-box !important; min-height: inherit !important; background: none !important"><tbody><tr style="border: 0px !important; margin: 0px !important; padding: 0px !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; background: none !important"><td class="gutter" style="border: 0px !important; margin: 0px !important; padding: 0px !important; font-size: 12px !important; vertical-align: baseline !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; min-height: inherit !important; color: #afafaf !important; background: none !important"><div class="line number1 index0 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">1</div><div class="line number2 index1 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">2</div><div class="line number3 index2 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">3</div><div class="line number4 index3 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">4</div><div class="line number5 index4 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">5</div><div class="line number6 index5 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">6</div><div class="line number7 index6 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">7</div><div class="line number8 index7 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">8</div><div class="line number9 index8 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">9</div><div class="line number10 index9 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">10</div><div class="line number11 index10 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">11</div><div class="line number12 index11 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">12</div><div class="line number13 index12 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">13</div><div class="line number14 index13 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">14</div><div class="line number15 index14 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">15</div><div class="line number16 index15 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">16</div><div class="line number17 index16 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">17</div><div class="line number18 index17 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">18</div><div class="line number19 index18 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">19</div><div class="line number20 index19 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">20</div><div class="line number21 index20 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">21</div><div class="line number22 index21 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">22</div><div class="line number23 index22 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">23</div><div class="line number24 index23 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">24</div><div class="line number25 index24 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">25</div><div class="line number26 index25 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">26</div><div class="line number27 index26 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">27</div><div class="line number28 index27 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">28</div><div class="line number29 index28 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">29</div></td><td class="code" style="width: 585px; border: 0px !important; margin: 0px !important; padding: 0px !important; font-size: 12px !important; vertical-align: baseline !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; box-sizing: content-box !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; min-height: inherit !important; background: none !important"><div class="container" style="margin-left: -10px; width: 640px; border: 0px !important; margin-top: 0px !important; margin-right: 0px !important; margin-bottom: 0px !important; padding: 0px !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: relative !important; right: auto !important; top: auto !important; vertical-align: baseline !important; box-sizing: content-box !important; min-height: inherit !important; background: none !important"><div class="line number1 index0 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important"># open the index file for reading</div><div class="line number2 index1 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">with open(self.indexPath) as f:</div><div class="line number3 index2 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;# initialize the CSV reader</div><div class="line number4 index3 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;reader = csv.reader(f)</div><div class="line number5 index4 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;</div><div class="line number6 index5 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;# loop over the rows in the index</div><div class="line number7 index6 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;for row in reader:</div><div class="line number8 index7 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# parse out the image ID and features, then compute the</div><div class="line number9 index8 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# chi-squared distance between the features in our index</div><div class="line number10 index9 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# and our query features</div><div class="line number11 index10 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;features = [float(x) for x in row[1:]]</div><div class="line number12 index11 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d = self.chi2_distance(features, queryFeatures)</div><div class="line number13 index12 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;</div><div class="line number14 index13 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# now that we have the distance between the two feature</div><div class="line number15 index14 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# vectors, we can udpate the results dictionary -- the</div><div class="line number16 index15 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# key is the current image ID in the index and the</div><div class="line number17 index16 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# value is the distance we just computed, representing</div><div class="line number18 index17 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# how 'similar' the image in the index is to our query</div><div class="line number19 index18 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;results[row[0]] = d</div><div class="line number20 index19 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;</div><div class="line number21 index20 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;# close the reader</div><div class="line number22 index21 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;f.close()</div><div class="line number23 index22 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;</div><div class="line number24 index23 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important"># sort our results, so that the smaller distances (i.e. the</div><div class="line number25 index24 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important"># more relevant images are at the front of the list)</div><div class="line number26 index25 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">results = sorted([(v, k) for (k, v) in results.items()])</div><div class="line number27 index26 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;</div><div class="line number28 index27 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important"># return our (limited) results</div><div class="line number29 index28 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">return results[:limit]</div></div></td></tr></tbody></table></div></div><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">在1行打开index.csv文件，在3行获取CSV读取器的句柄，接着在6行循环读取index.csv文件的每一行。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">对于每一行，提取出索引化后的图像的颜色直方图，用11行的chi2_distance函数将其与待搜索的图像特征进行比较，该函数在下面介绍。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">在32行使用唯一的图像文件名作为键，用与待查找图像的与索引后的图像的相似读作为值来更新results字典。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">最后，将results字典根据相似读升序排序。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">卡方相似度为零的图片表示完全相同。相似度数值越高，表示两幅图像差别越大。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">说到卡方相似读，看下面的源码：</p><div style="border: 0px; margin: 0px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px"><div id="highlighter_516963" class="syntaxhighlighter notranslate actionscript3" style="border: 0px; width: 620px; margin: 1em 0px !important; padding: 1px !important; font-size: 12px !important; position: relative !important; overflow-y: hidden !important; overflow-x: auto !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important"><table border="0" cellspacing="0" cellpadding="0" style="border-collapse: collapse; border-spacing: 0px; width: 620px; border: 0px !important; margin: 0px !important; padding: 0px !important; font-size: 12px !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; box-sizing: content-box !important; min-height: inherit !important; background: none !important"><tbody><tr style="border: 0px !important; margin: 0px !important; padding: 0px !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; background: none !important"><td class="gutter" style="border: 0px !important; margin: 0px !important; padding: 0px !important; font-size: 12px !important; vertical-align: baseline !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; min-height: inherit !important; color: #afafaf !important; background: none !important"><div class="line number1 index0 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">1</div><div class="line number2 index1 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">2</div><div class="line number3 index2 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">3</div><div class="line number4 index3 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">4</div><div class="line number5 index4 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">5</div><div class="line number6 index5 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">6</div><div class="line number7 index6 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">7</div></td><td class="code" style="width: 592px; border: 0px !important; margin: 0px !important; padding: 0px !important; font-size: 12px !important; vertical-align: baseline !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; box-sizing: content-box !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; min-height: inherit !important; background: none !important"><div class="container" style="margin-left: -10px; width: 640px; border: 0px !important; margin-top: 0px !important; margin-right: 0px !important; margin-bottom: 0px !important; padding: 0px !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: relative !important; right: auto !important; top: auto !important; vertical-align: baseline !important; box-sizing: content-box !important; min-height: inherit !important; background: none !important"><div class="line number1 index0 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">def chi2_distance(self, histA, histB, eps = 1e-10):</div><div class="line number2 index1 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;# compute the chi-squared distance</div><div class="line number3 index2 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;d = 0.5 * np.sum([((a - b) ** 2) / (a + b + eps)</div><div class="line number4 index3 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (a, b) in zip(histA, histB)])</div><div class="line number5 index4 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;</div><div class="line number6 index5 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;# return the chi-squared distance</div><div class="line number7 index6 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;return d</div></div></td></tr></tbody></table></div></div><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">chi2_distance函数需要两个参数，即用来进行比较的两个直方图。可选的eps值用来预防除零错误。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px"><span style="border: 0px; margin: 0px; padding: 0px">这个函数的名称来自皮尔森的卡方测试统计，用来比较离散概率分布。</span></p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">由于比较的是颜色<span style="border: 0px; margin: 0px; padding: 0px">直方图，根据概率分布的定义，卡方函数是个完美的选择。</span></p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">一般来说，直方图两端的值的差别并不重要，可以使用权重对其进行处理，卡方距离函数就是这么做的。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">还能跟的上吗？我保证，最后一步是最简单的，仅仅需要将前面的各部分组合在一起。</p><h3 style="border: 0px; margin: -8px 0px 20px; padding: 0px; font-size: 20px; font-weight: normal; font-stretch: normal; line-height: 30px; font-family: 'Microsoft YaHei', 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif">第四步：执行搜索</h3><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">如果我告诉你，执行搜索是最简单的一步，你信吗？实际上，只需一个驱动程序导入前面定义的所有的模块，将其依次组合成具有完整功能的CBIR系统。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">所以新建最后一个文件，命名为search.py，这样我们的例子就能完成了：</p><div style="border: 0px; margin: 0px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px"><div id="highlighter_551117" class="syntaxhighlighter notranslate python" style="border: 0px; width: 620px; margin: 1em 0px !important; padding: 1px !important; font-size: 12px !important; position: relative !important; overflow-y: hidden !important; overflow-x: auto !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important"><table border="0" cellspacing="0" cellpadding="0" style="border-collapse: collapse; border-spacing: 0px; width: 620px; border: 0px !important; margin: 0px !important; padding: 0px !important; font-size: 12px !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; box-sizing: content-box !important; min-height: inherit !important; background: none !important"><tbody><tr style="border: 0px !important; margin: 0px !important; padding: 0px !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; background: none !important"><td class="gutter" style="border: 0px !important; margin: 0px !important; padding: 0px !important; font-size: 12px !important; vertical-align: baseline !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; min-height: inherit !important; color: #afafaf !important; background: none !important"><div class="line number1 index0 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">1</div><div class="line number2 index1 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">2</div><div class="line number3 index2 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">3</div><div class="line number4 index3 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">4</div><div class="line number5 index4 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">5</div><div class="line number6 index5 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">6</div><div class="line number7 index6 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">7</div><div class="line number8 index7 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">8</div><div class="line number9 index8 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">9</div><div class="line number10 index9 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">10</div><div class="line number11 index10 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">11</div><div class="line number12 index11 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">12</div><div class="line number13 index12 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">13</div><div class="line number14 index13 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">14</div><div class="line number15 index14 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">15</div><div class="line number16 index15 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">16</div><div class="line number17 index16 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">17</div><div class="line number18 index17 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">18</div></td><td class="code" style="width: 585px; border: 0px !important; margin: 0px !important; padding: 0px !important; font-size: 12px !important; vertical-align: baseline !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; box-sizing: content-box !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; min-height: inherit !important; background: none !important"><div class="container" style="margin-left: -10px; width: 640px; border: 0px !important; margin-top: 0px !important; margin-right: 0px !important; margin-bottom: 0px !important; padding: 0px !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: relative !important; right: auto !important; top: auto !important; vertical-align: baseline !important; box-sizing: content-box !important; min-height: inherit !important; background: none !important"><div class="line number1 index0 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important"># import the necessary packages</div><div class="line number2 index1 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">from pyimagesearch.colordescriptor import ColorDescriptor</div><div class="line number3 index2 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">from pyimagesearch.searcher import Searcher</div><div class="line number4 index3 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">import argparse</div><div class="line number5 index4 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">import cv2</div><div class="line number6 index5 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;</div><div class="line number7 index6 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important"># construct the argument parser and parse the arguments</div><div class="line number8 index7 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">ap = argparse.ArgumentParser()</div><div class="line number9 index8 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">ap.add_argument(&quot;-i&quot;, &quot;--index&quot;, required = True,</div><div class="line number10 index9 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;help = &quot;Path to where the computed index will be stored&quot;)</div><div class="line number11 index10 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">ap.add_argument(&quot;-q&quot;, &quot;--query&quot;, required = True,</div><div class="line number12 index11 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;help = &quot;Path to the query image&quot;)</div><div class="line number13 index12 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">ap.add_argument(&quot;-r&quot;, &quot;--result-path&quot;, required = True,</div><div class="line number14 index13 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;help = &quot;Path to the result path&quot;)</div><div class="line number15 index14 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">args = vars(ap.parse_args())</div><div class="line number16 index15 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;</div><div class="line number17 index16 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important"># initialize the image descriptor</div><div class="line number18 index17 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">cd = ColorDescriptor((8, 12, 3))</div></div></td></tr></tbody></table></div></div><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">首先导入所需的包，导入第一步的ColorDescriptor来提取待查找图像的特征；导入第三步定义的Searcher类，用于执行执行实际的搜索。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">argparse和cv2模块一直会导入。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">在8-15行处理命令行参数。我们需要用一个&ndash;index来表示index.csv文件的位置。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">还需要&ndash;query来表示带搜索图像的存储路径。该图像将与数据集中的每幅图像进行比较。目标是找到数据集中欧给你与待搜索图像相似的图像。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">想象一下，使用Google搜索并输入&ldquo;Python OpenCV tutorials&rdquo;，会希望获得与Python和OpenCV相关的信息。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">与之相同，如果针对相册构建一个图像搜索引擎，提交了一副关于云、大海上的帆船的图像，希望通过图像搜索引擎获得相似的图像。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">接着需要一个&ndash;result-path，用来表示相册数据集的路径。通过这个命令可以选择不同的数据集，向用户显示他们所需要的最终结果。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">最后，在18行使用图像描述符提取相同的参数，就如同在索引化那一步做的一样。如果我们是为了比较图像的相似度（事实也正是如此）<span style="border: 0px; margin: 0px; padding: 0px">，就无需改变数据集中颜色直方图的bin的数目。</span></p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px"><span style="border: 0px; margin: 0px; padding: 0px">直接将第三步中使用的直方图bin的数目作为参数在第四步使用。</span></p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">这样会保证图像的描述是连续且可比较的。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">现在到了进行真正比较的时候：</p><div style="border: 0px; margin: 0px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px"><div id="highlighter_704042" class="syntaxhighlighter notranslate actionscript3" style="border: 0px; width: 620px; margin: 1em 0px !important; padding: 1px !important; font-size: 12px !important; position: relative !important; overflow-y: hidden !important; overflow-x: auto !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important"><table border="0" cellspacing="0" cellpadding="0" style="border-collapse: collapse; border-spacing: 0px; width: 620px; border: 0px !important; margin: 0px !important; padding: 0px !important; font-size: 12px !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; box-sizing: content-box !important; min-height: inherit !important; background: none !important"><tbody><tr style="border: 0px !important; margin: 0px !important; padding: 0px !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; background: none !important"><td class="gutter" style="border: 0px !important; margin: 0px !important; padding: 0px !important; font-size: 12px !important; vertical-align: baseline !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; min-height: inherit !important; color: #afafaf !important; background: none !important"><div class="line number1 index0 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">1</div><div class="line number2 index1 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">2</div><div class="line number3 index2 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">3</div><div class="line number4 index3 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">4</div><div class="line number5 index4 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">5</div><div class="line number6 index5 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">6</div><div class="line number7 index6 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">7</div><div class="line number8 index7 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">8</div><div class="line number9 index8 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">9</div><div class="line number10 index9 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">10</div><div class="line number11 index10 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">11</div><div class="line number12 index11 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">12</div><div class="line number13 index12 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">13</div><div class="line number14 index13 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">14</div><div class="line number15 index14 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">15</div><div class="line number16 index15 alt1" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">16</div><div class="line number17 index16 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">17</div></td><td class="code" style="width: 585px; border: 0px !important; margin: 0px !important; padding: 0px !important; font-size: 12px !important; vertical-align: baseline !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; box-sizing: content-box !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; min-height: inherit !important; background: none !important"><div class="container" style="margin-left: -10px; width: 640px; border: 0px !important; margin-top: 0px !important; margin-right: 0px !important; margin-bottom: 0px !important; padding: 0px !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: relative !important; right: auto !important; top: auto !important; vertical-align: baseline !important; box-sizing: content-box !important; min-height: inherit !important; background: none !important"><div class="line number1 index0 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important"># load the query image and describe it</div><div class="line number2 index1 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">query = cv2.imread(args[&quot;query&quot;])</div><div class="line number3 index2 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">features = cd.describe(query)</div><div class="line number4 index3 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;</div><div class="line number5 index4 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important"># perform the search</div><div class="line number6 index5 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">searcher = Searcher(args[&quot;index&quot;])</div><div class="line number7 index6 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">results = searcher.search(features)</div><div class="line number8 index7 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;</div><div class="line number9 index8 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important"># display the query</div><div class="line number10 index9 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">cv2.imshow(&quot;Query&quot;, query)</div><div class="line number11 index10 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;</div><div class="line number12 index11 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important"># loop over the results</div><div class="line number13 index12 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">for (score, resultID) in results:</div><div class="line number14 index13 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;# load the result image and display it</div><div class="line number15 index14 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;result = cv2.imread(args[&quot;result_path&quot;] + &quot;/&quot; + resultID)</div><div class="line number16 index15 alt1" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;cv2.imshow(&quot;Result&quot;, result)</div><div class="line number17 index16 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">&nbsp;&nbsp;&nbsp;&nbsp;cv2.waitKey(0)</div></div></td></tr></tbody></table></div></div><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">在2行从磁盘读取待搜索图像，在3行提取该图像的特征。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">在6和7行使用提取到的特征进行搜索，返回经过排序后的结果列表。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">到此，所需做的就是将结果显示给用户。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">在9行显示出待搜索的图像。接着在13-17行遍历搜索结果，将相应的图像显示在屏幕上。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">所有这些工作完成后，就可以实际操作了。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">继续阅读，看最终效果如何。</p><h2 style="border: 0px; margin: -9px 0px 20px; padding: 0px; font-size: 24px; font-weight: normal; font-stretch: normal; line-height: 36px; font-family: 'Microsoft YaHei', 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif">CBIR系统实战</h2><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">打开终端，切换到代码所在的目录，执行下面的命令：</p><div style="border: 0px; margin: 0px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px"><div id="highlighter_86216" class="syntaxhighlighter notranslate python" style="border: 0px; width: 620px; margin: 1em 0px !important; padding: 1px !important; font-size: 12px !important; position: relative !important; overflow-y: hidden !important; overflow-x: auto !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important"><table border="0" cellspacing="0" cellpadding="0" style="border-collapse: collapse; border-spacing: 0px; width: 620px; border: 0px !important; margin: 0px !important; padding: 0px !important; font-size: 12px !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; box-sizing: content-box !important; min-height: inherit !important; background: none !important"><tbody><tr style="border: 0px !important; margin: 0px !important; padding: 0px !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; background: none !important"><td class="gutter" style="border: 0px !important; margin: 0px !important; padding: 0px !important; font-size: 12px !important; vertical-align: baseline !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; min-height: inherit !important; color: #afafaf !important; background: none !important"><div class="line number1 index0 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">1</div></td><td class="code" style="width: 592px; border: 0px !important; margin: 0px !important; padding: 0px !important; font-size: 12px !important; vertical-align: baseline !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; box-sizing: content-box !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; min-height: inherit !important; background: none !important"><div class="container" style="margin-left: -10px; width: 640px; border: 0px !important; margin-top: 0px !important; margin-right: 0px !important; margin-bottom: 0px !important; padding: 0px !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: relative !important; right: auto !important; top: auto !important; vertical-align: baseline !important; box-sizing: content-box !important; min-height: inherit !important; background: none !important"><div class="line number1 index0 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">$ python search.py --index index.csv --query queries/108100.png --result-path dataset</div></div></td></tr></tbody></table></div></div><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px"><img style="border: 0px; margin: 0px; padding: 0px; font-size: 0px; color: transparent; vertical-align: middle; max-width: 100%; height: auto" src="http://ww4.sinaimg.cn/mw690/6941baebjw1enxaopyhl3j20m81hcqa2.jpg" border="0" /></p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">图18：在相册中搜索含有埃及金字塔的图像。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">第一幅图像是待搜索的埃及金字塔。我们的目标是在相册中找到相似的图像。可以看到，在相册中找到了去金字塔游玩拍摄的照片。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">我们还游览的埃及其他地方，所以用其他照片搜索试试：</p><div style="border: 0px; margin: 0px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px"><div id="highlighter_551076" class="syntaxhighlighter notranslate shell" style="border: 0px; width: 620px; margin: 1em 0px !important; padding: 1px !important; font-size: 12px !important; position: relative !important; overflow-y: hidden !important; overflow-x: auto !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important"><table border="0" cellspacing="0" cellpadding="0" style="border-collapse: collapse; border-spacing: 0px; width: 620px; border: 0px !important; margin: 0px !important; padding: 0px !important; font-size: 12px !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; box-sizing: content-box !important; min-height: inherit !important; background: none !important"><tbody><tr style="border: 0px !important; margin: 0px !important; padding: 0px !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; background: none !important"><td class="gutter" style="border: 0px !important; margin: 0px !important; padding: 0px !important; font-size: 12px !important; vertical-align: baseline !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; min-height: inherit !important; color: #afafaf !important; background: none !important"><div class="line number1 index0 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">1</div></td><td class="code" style="width: 592px; border: 0px !important; margin: 0px !important; padding: 0px !important; font-size: 12px !important; vertical-align: baseline !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; box-sizing: content-box !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; min-height: inherit !important; background: none !important"><div class="container" style="margin-left: -10px; width: 640px; border: 0px !important; margin-top: 0px !important; margin-right: 0px !important; margin-bottom: 0px !important; padding: 0px !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: relative !important; right: auto !important; top: auto !important; vertical-align: baseline !important; box-sizing: content-box !important; min-height: inherit !important; background: none !important"><div class="line number1 index0 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">$ python search.py --index index.csv --query queries/115100.png --result-path dataset</div></div></td></tr></tbody></table></div></div><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px"><img style="border: 0px; margin: 0px; padding: 0px; font-size: 0px; color: transparent; vertical-align: middle; max-width: 100%; height: auto" src="http://ww4.sinaimg.cn/mw690/6941baebjw1enxaoph5qoj20m81ntk2g.jpg" border="0" /></p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">图19：使用搜索引起搜索埃及其他地方的图片，注意图中蓝天的位置。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">注意我们的搜索图像中，上半部分是蓝天。中间和下半部分是褐色的建筑和土地。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">可以肯定，图像搜索引擎会返回上半部分是蓝天，下半部分是棕褐色建筑和沙子的图像。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">这是因为我们使用了本文开头介绍的基于区域的颜色直方图描述符。使用这种图像描述符可以粗略的针对每个区域执行，最后的结果中会含有图像每个区域的像素的密度。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">旅途的最后一站是海滩，用下面的命令搜索海滩上的图像：</p><div style="border: 0px; margin: 0px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px"><div id="highlighter_747481" class="syntaxhighlighter notranslate shell" style="border: 0px; width: 620px; margin: 1em 0px !important; padding: 1px !important; font-size: 12px !important; position: relative !important; overflow-y: hidden !important; overflow-x: auto !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important"><table border="0" cellspacing="0" cellpadding="0" style="border-collapse: collapse; border-spacing: 0px; width: 620px; border: 0px !important; margin: 0px !important; padding: 0px !important; font-size: 12px !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; box-sizing: content-box !important; min-height: inherit !important; background: none !important"><tbody><tr style="border: 0px !important; margin: 0px !important; padding: 0px !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; background: none !important"><td class="gutter" style="border: 0px !important; margin: 0px !important; padding: 0px !important; font-size: 12px !important; vertical-align: baseline !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; min-height: inherit !important; color: #afafaf !important; background: none !important"><div class="line number1 index0 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">1</div></td><td class="code" style="width: 592px; border: 0px !important; margin: 0px !important; padding: 0px !important; font-size: 12px !important; vertical-align: baseline !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; box-sizing: content-box !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; min-height: inherit !important; background: none !important"><div class="container" style="margin-left: -10px; width: 640px; border: 0px !important; margin-top: 0px !important; margin-right: 0px !important; margin-bottom: 0px !important; padding: 0px !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: relative !important; right: auto !important; top: auto !important; vertical-align: baseline !important; box-sizing: content-box !important; min-height: inherit !important; background: none !important"><div class="line number1 index0 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">$ python search.py --index index.csv --query queries/103300.png --result-path dataset</div></div></td></tr></tbody></table></div></div><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px"><img style="border: 0px; margin: 0px; padding: 0px; font-size: 0px; color: transparent; vertical-align: middle; max-width: 100%; height: auto" src="http://ww4.sinaimg.cn/mw690/6941baebjw1enxaooze29j20m81uawos.jpg" border="0" /></p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">图20：使用OpenCV构建CBIR系统来搜索相册。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">注意，前3个搜索结果是在相同地点拍摄到的图像。其他图像都含有蓝色的区域。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">当然，没有潜水的海滩之旅是不完整的。</p><div style="border: 0px; margin: 0px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px"><div id="highlighter_618886" class="syntaxhighlighter notranslate shell" style="border: 0px; width: 620px; margin: 1em 0px !important; padding: 1px !important; font-size: 12px !important; position: relative !important; overflow-y: hidden !important; overflow-x: auto !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important"><table border="0" cellspacing="0" cellpadding="0" style="border-collapse: collapse; border-spacing: 0px; width: 620px; border: 0px !important; margin: 0px !important; padding: 0px !important; font-size: 12px !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; box-sizing: content-box !important; min-height: inherit !important; background: none !important"><tbody><tr style="border: 0px !important; margin: 0px !important; padding: 0px !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; background: none !important"><td class="gutter" style="border: 0px !important; margin: 0px !important; padding: 0px !important; font-size: 12px !important; vertical-align: baseline !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; min-height: inherit !important; color: #afafaf !important; background: none !important"><div class="line number1 index0 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">1</div></td><td class="code" style="width: 592px; border: 0px !important; margin: 0px !important; padding: 0px !important; font-size: 12px !important; vertical-align: baseline !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; box-sizing: content-box !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; min-height: inherit !important; background: none !important"><div class="container" style="margin-left: -10px; width: 640px; border: 0px !important; margin-top: 0px !important; margin-right: 0px !important; margin-bottom: 0px !important; padding: 0px !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: relative !important; right: auto !important; top: auto !important; vertical-align: baseline !important; box-sizing: content-box !important; min-height: inherit !important; background: none !important"><div class="line number1 index0 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">$ python search.py --index index.csv --query queries/103100.png --result-path dataset</div></div></td></tr></tbody></table></div></div><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px"><img style="border: 0px; margin: 0px; padding: 0px; font-size: 0px; color: transparent; vertical-align: middle; max-width: 100%; height: auto" src="http://ww4.sinaimg.cn/mw690/6941baebjw1enxaoo8m7bj20m81hcqfs.jpg" border="0" /></p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">图21：图像搜索引起再次返回相关的结果。这次是水下冒险。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">结果非常棒。前5个结果是同一条鱼，前10幅有9幅是水下探险。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">最后，一天的旅途结束了，到了观看夕阳的时候：</p><div style="border: 0px; margin: 0px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px"><div id="highlighter_25046" class="syntaxhighlighter notranslate python" style="border: 0px; width: 620px; margin: 1em 0px !important; padding: 1px !important; font-size: 12px !important; position: relative !important; overflow-y: hidden !important; overflow-x: auto !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important"><table border="0" cellspacing="0" cellpadding="0" style="border-collapse: collapse; border-spacing: 0px; width: 620px; border: 0px !important; margin: 0px !important; padding: 0px !important; font-size: 12px !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; box-sizing: content-box !important; min-height: inherit !important; background: none !important"><tbody><tr style="border: 0px !important; margin: 0px !important; padding: 0px !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; background: none !important"><td class="gutter" style="border: 0px !important; margin: 0px !important; padding: 0px !important; font-size: 12px !important; vertical-align: baseline !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; min-height: inherit !important; color: #afafaf !important; background: none !important"><div class="line number1 index0 alt2" style="border-width: 0px 3px 0px 0px !important; border-right-style: solid !important; border-right-color: #6ce26c !important; margin: 0px !important; padding: 0px 0.5em 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">1</div></td><td class="code" style="width: 592px; border: 0px !important; margin: 0px !important; padding: 0px !important; font-size: 12px !important; vertical-align: baseline !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; box-sizing: content-box !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; min-height: inherit !important; background: none !important"><div class="container" style="margin-left: -10px; width: 640px; border: 0px !important; margin-top: 0px !important; margin-right: 0px !important; margin-bottom: 0px !important; padding: 0px !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: relative !important; right: auto !important; top: auto !important; vertical-align: baseline !important; box-sizing: content-box !important; min-height: inherit !important; background: none !important"><div class="line number1 index0 alt2" style="border: 0px !important; margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; min-height: inherit !important; white-space: pre !important; background-image: none !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: initial !important; background-repeat: initial !important">$ python search.py --index index.csv --query queries/127502.png --result-path dataset</div></div></td></tr></tbody></table></div></div><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px"><img style="border: 0px; margin: 0px; padding: 0px; font-size: 0px; color: transparent; vertical-align: middle; max-width: 100%; height: auto" src="http://ww1.sinaimg.cn/mw690/6941baebjw1enxaontp8xj20m81hcjv8.jpg" border="0" /></p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">图22：这个OpenCV图像搜索引起可以查找到相册集中含有夕阳的相片。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">搜索结果非常棒，所有的结果都含有夕阳。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">这样，你就有了第一个图像搜索引擎：</p><h2 style="border: 0px; margin: -9px 0px 20px; padding: 0px; font-size: 24px; font-weight: normal; font-stretch: normal; line-height: 36px; font-family: 'Microsoft YaHei', 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif">总结</h2><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">本文介绍了如何构建一个图像搜索引擎，来查找相册中的图像。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">使用颜色直方图对相册中的图像的颜色部分进行分类。接着，使用颜色描述符索引化相册，提取相册中每一副图像的颜色直方图。</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px"><span style="border: 0px; margin: 0px; padding: 0px">使用卡方距离比较图像，这是比较离散概率分布最常见的选择。</span></p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">接着，实现了提交待搜索图像和返回查找结果的逻辑。</p><h2 style="border: 0px; margin: -9px 0px 20px; padding: 0px; font-size: 24px; font-weight: normal; font-stretch: normal; line-height: 36px; font-family: 'Microsoft YaHei', 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif">下一步</h2><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">接下来该干什么？</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">可以看到，使用命令行是与这个图像搜索引擎交互的唯一方式。这样还不是太吸引人</p><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">下一篇文章将探索如何将这个图像搜索引擎封装进一个Python网络框架中，让其更易于使用。</p><h2 style="border: 0px; margin: -9px 0px 20px; padding: 0px; font-size: 24px; font-weight: normal; font-stretch: normal; line-height: 36px; font-family: 'Microsoft YaHei', 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif">下载：</h2><p style="border: 0px; margin: 0px 0px 20px; padding: 0px; font-size: 14px; font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 21px">代码和数据集总共有约<strong style="border: 0px; margin: 0px; padding: 0px">200mb</strong>。如果读者想要下载文中用到的代码和图像。请在原文中输入你的邮箱地址，我会给你一个下载代码和数据集的链接。这个链接不仅能下载到代码的zip压缩包，还会收到我送给你的11页关于计算机视觉和图像搜索引擎的资源指南，其中含有文中没有介绍到的一些技术！是不是很不错？别犹豫，赶快在下面输入你的邮箱地址，我会立即给你发送代码的！&nbsp;<strong style="border: 0px; margin: 0px; padding: 0px"><a style="text-decoration: none; outline: none; border: 0px; margin: 0px; padding: 0px; color: #0099cc" rel="nofollow" href="http://www.pyimagesearch.com/2014/12/01/complete-guide-building-image-search-engine-python-opencv/" target="_blank">在原文填写邮箱</a>&nbsp;（要查看两次邮箱，还得翻墙。</strong>不想来回倒腾的童鞋，请戳链接：<a style="text-decoration: none; outline: none; border: 0px; margin: 0px; padding: 0px; color: #0099cc" href="http://pan.baidu.com/s/1ntsoamP" target="_blank">http://pan.baidu.com/s/1ntsoamP</a>）</p>
]]>
</description>
</item><item>
<link>http://i.renjihe.com/blog/read.php?6293</link>
<title><![CDATA[OpenGL与OpenCV实现增强现实]]></title> 
<author>renjihe1988 &lt;admin@yourname.com&gt;</author>
<category><![CDATA[OpenCV]]></category>
<pubDate>Fri, 16 Jan 2015 02:49:25 +0000</pubDate> 
<guid>http://i.renjihe.com/blog/read.php?6293</guid> 
<description>
<![CDATA[ 
	http://www.tuicool.com/articles/MNJjyam<br /><br /><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">很久没有写博客了，最近在学习计算机视觉的相关知识，于是写了一个AR的小Demo。</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">该程序通过OpenCV实现对Marker的识别和定位，然后通过OpenGL将虚拟物体叠加到摄像头图像下，实现增强现实。首先来看看我们使用的Marker：</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe"><img style="border: 0px none; max-width: 550px; height: auto; vertical-align: middle; text-align: center; margin: 0px auto; display: block" class="alignCenter" src="http://img0.tuicool.com/vAr63e.jpg" border="0" /></p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">这是众多Marker中的一个，它们都被一圈的黑色边框所包围，边框之中是编码信息，白色代表1，黑色代表0。将每一行作为一个字，那么每个字有5bits。其中，1、3、5位为校验位，2、4位为信息位。也就是说，整个Marker的信息位只有10bits，所以最多可表示1024个数（0~1023）。这种编码方式实际上是汉明码的变种，唯一区别在于它的首位是对应汉明码首位的反（比如汉明码是00000，那么Marker中的编码为10000）。这么做的目的是防止某一行全黑，从而提高识别率。汉明码还有另一大优势&mdash;&mdash;不具有旋转对称性，因此程序能通过汉明码确定Marker的方向，因此从Marker中解码的信息是唯一的。</p><h4 style="margin: 0px 0px 0.5em; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; line-height: 25.6000003814697px; color: #333333; text-rendering: optimizelegibility; font-size: 16px; text-indent: 1em; background-color: #fefefe">一、Marker的检测与识别</h4><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">我们首先实现一个类，用于检测图像中的Marker，解码信息，并计算Marker相对于摄像头的坐标位置。</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">检测部分比较简单。首先将输入图像进行灰度变换，然后对灰度图像进行自适应二值化。之所以使用自适应二值化，是因为它能更好的适应光照的变化。但有一点要注意，很多朋友使用自适应二值化后表示得到的结果很像边缘检测的结果，那是因为自适应窗口过小造成的。使用自适应二值化时，窗口的大小应大于二值化目标的大小，否则得到的阈值不具有适应性。在自适应二值化之后，为了消除噪音或小块，可以加以形态学开运算。以上几部可分别得到下列图像（其中二值化的结果经过了反色处理，方便以后的轮廓提取）。</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe"><img style="border: 0px none; max-width: 550px; height: auto; vertical-align: middle; text-align: center; margin: 0px auto; display: block" class="alignCenter" src="http://img1.tuicool.com/ja2yayf.jpg" border="0" /></p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe"><img style="border: 0px none; max-width: 550px; height: auto; vertical-align: middle; text-align: center; margin: 0px auto; display: block" class="alignCenter" src="http://img2.tuicool.com/ZrIRn2.jpg" border="0" /></p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe"><img style="border: 0px none; max-width: 550px; height: auto; vertical-align: middle; text-align: center; margin: 0px auto; display: block" class="alignCenter" src="http://img0.tuicool.com/AJNVBjE.jpg" border="0" /></p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">得到二值图像后，就可以使用OpenCV中的findContours来提取轮廓了。一副二值图像当中的轮廓有很多，其中有一些轮廓很小，我们通过一个阈值将这些过小的轮廓排除。排除过小轮廓后，就可以对轮廓进行多边形近似了。由于我们的Marker是正方形，其多边形近似结果应该满足以下条件：</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">1、只有4个顶点</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">2、一定是凸多边形</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">3、每一个边的长度不能过小</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">通过以上几个条件，我们可以排除绝大部分轮廓，从而找到最有可能为Marker的部分。找到这样的候选轮廓后，我们将它的多边形四个顶点保存下来，并做适当的调整，使所有顶点逆时针排序。代码如下：</p><pre class="prettyprint cpp" style="padding: 0.3em; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; color: #333333; border-radius: 4px; margin-top: 0px; margin-bottom: 1.5em; font-size: 13px; line-height: 1.5em; word-break: break-all; word-wrap: break-word; white-space: pre-wrap; border: 1px solid rgba(0, 0, 0, 0.14902); overflow-y: auto; background-color: #f6f6f6"><span style="font-weight: bold" class="keyword">void</span> MarkerRecognizer::markerDetect(Mat&amp; img_gray, <span class="stl_container"><span style="color: #0086b3" class="built_in">vector</span>&lt;Marker&gt;</span>&amp; possible_markers, <span style="font-weight: bold" class="keyword">int</span> min_size, <span style="font-weight: bold" class="keyword">int</span> min_side_length) &#123; <span class="indent">&nbsp;&nbsp;</span>Mat img_bin;&nbsp;&nbsp;<span class="indent">&nbsp;&nbsp;</span><span style="font-weight: bold" class="keyword">int</span> thresh_size = (min_size/<span style="color: #009999" class="number">4</span>)*<span style="color: #009999" class="number">2</span> + <span style="color: #009999" class="number">1</span>; <span class="indent">&nbsp;&nbsp;</span>adaptiveThreshold(img_gray, img_bin, <span style="color: #009999" class="number">255</span>, ADAPTIVE_THRESH_GAUSSIAN_C, THRESH_BINARY_INV, thresh_size, thresh_size/<span style="color: #009999" class="number">3</span>); <span class="indent">&nbsp;&nbsp;</span><span style="font-style: italic; color: #999988" class="comment">//threshold(img_gray, img_bin, 125, 255, THRESH_BINARY_INV&#124;THRESH_OTSU);</span> <span class="indent">&nbsp;&nbsp;</span>morphologyEx(img_bin, img_bin, MORPH_OPEN, Mat());&nbsp;&nbsp;<span style="font-style: italic; color: #999988" class="comment">//use open operator to eliminate small patch</span>&nbsp;&nbsp;<span class="indent">&nbsp;&nbsp;</span><span class="stl_container"><span style="color: #0086b3" class="built_in">vector</span>&lt;<span class="stl_container"><span style="color: #0086b3" class="built_in">vector</span>&lt;Point&gt;</span>&gt;</span> all_contours; <span class="indent">&nbsp;&nbsp;</span><span class="stl_container"><span style="color: #0086b3" class="built_in">vector</span>&lt;<span class="stl_container"><span style="color: #0086b3" class="built_in">vector</span>&lt;Point&gt;</span>&gt;</span> contours; <span class="indent">&nbsp;&nbsp;</span>findContours(img_bin, all_contours, CV_RETR_LIST, CV_CHAIN_APPROX_NONE);&nbsp;&nbsp;<span class="indent">&nbsp;&nbsp;</span><span style="font-weight: bold" class="keyword">for</span> (<span style="font-weight: bold" class="keyword">int</span> i = <span style="color: #009999" class="number">0</span>; i &lt; all_contours.size(); ++i) <span class="indent">&nbsp;&nbsp;</span>&#123; <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span style="font-weight: bold" class="keyword">if</span> (all_contours[i].size() &gt; min_size) <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span>&#123; <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span>contours.push_back(all_contours[i]); <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span>&#125; <span class="indent">&nbsp;&nbsp;</span>&#125;&nbsp;&nbsp;<span class="indent">&nbsp;&nbsp;</span><span class="stl_container"><span style="color: #0086b3" class="built_in">vector</span>&lt;Point&gt;</span> approx_poly; <span class="indent">&nbsp;&nbsp;</span><span style="font-weight: bold" class="keyword">for</span> (<span style="font-weight: bold" class="keyword">int</span> i = <span style="color: #009999" class="number">0</span>; i &lt; contours.size(); ++i) <span class="indent">&nbsp;&nbsp;</span>&#123; <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span style="font-weight: bold" class="keyword">double</span> eps = contours[i].size()*APPROX_POLY_EPS; <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span>approxPolyDP(contours[i], approx_poly, eps, <span style="font-weight: bold" class="keyword">true</span>);&nbsp;&nbsp;<span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span style="font-weight: bold" class="keyword">if</span> (approx_poly.size() != <span style="color: #009999" class="number">4</span>) <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span style="font-weight: bold" class="keyword">continue</span>;&nbsp;&nbsp;<span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span style="font-weight: bold" class="keyword">if</span> (!isContourConvex(approx_poly)) <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span style="font-weight: bold" class="keyword">continue</span>;&nbsp;&nbsp;<span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span style="font-style: italic; color: #999988" class="comment">//Ensure that the distance between consecutive points is large enough</span> <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span style="font-weight: bold" class="keyword">float</span> min_side = FLT_MAX; <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span style="font-weight: bold" class="keyword">for</span> (<span style="font-weight: bold" class="keyword">int</span> j = <span style="color: #009999" class="number">0</span>; j &lt; <span style="color: #009999" class="number">4</span>; ++j) <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span>&#123; <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span>Point side = approx_poly[j] - approx_poly[(j+<span style="color: #009999" class="number">1</span>)%<span style="color: #009999" class="number">4</span>]; <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span>min_side = min(min_size, side.dot(side)); <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span>&#125; <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span style="font-weight: bold" class="keyword">if</span> (min_side &lt; min_side_length*min_side_length) <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span style="font-weight: bold" class="keyword">continue</span>;&nbsp;&nbsp;<span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span style="font-style: italic; color: #999988" class="comment">//Sort the points in anti-clockwise</span> <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span>Marker marker = Marker(<span style="color: #009999" class="number">0</span>, approx_poly[<span style="color: #009999" class="number">0</span>], approx_poly[<span style="color: #009999" class="number">1</span>], approx_poly[<span style="color: #009999" class="number">2</span>], approx_poly[<span style="color: #009999" class="number">3</span>]); <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span>Point2f v1 = marker.m_corners[<span style="color: #009999" class="number">1</span>] - marker.m_corners[<span style="color: #009999" class="number">0</span>]; <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span>Point2f v2 = marker.m_corners[<span style="color: #009999" class="number">2</span>] - marker.m_corners[<span style="color: #009999" class="number">0</span>]; <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span style="font-weight: bold" class="keyword">if</span> (v1.cross(v2) &gt; <span style="color: #009999" class="number">0</span>)&nbsp;&nbsp;<span style="font-style: italic; color: #999988" class="comment">//由于图像坐标的Y轴向下，所以大于零才代表逆时针</span> <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span>&#123; <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span>swap(marker.m_corners[<span style="color: #009999" class="number">1</span>], marker.m_corners[<span style="color: #009999" class="number">3</span>]); <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span>&#125; <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span>possible_markers.push_back(marker); <span class="indent">&nbsp;&nbsp;</span>&#125; &#125;</pre><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">下一步，从这些候选区域中进一步筛选出真正的Marker。首先，由于摄像机视角的关系，图像中的Marker是经过透视变换的。为了方便提取Marker中的信息，要使用warpPerspective方法对候选区域进行透视变换，得到Marker的正视图。之后，由于Marker只有黑白两种颜色，其直方图分布是双峰的，所以用大津法（OTSU）对透视变换后的图像做二值化。</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe"><img style="border: 0px none; max-width: 550px; height: auto; vertical-align: middle; text-align: center; margin: 0px auto; display: block" class="alignCenter" src="http://img1.tuicool.com/R7rmey.jpg" border="0" /></p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">由于Marker都有一圈黑色的轮廓，这成为了我们进一步判定Marker的标准。获取正确的Marker图像后，可能有4个不同方向。这时我们就可以通过Marker中的汉明码确定Marker的正确朝向了，正确朝向的Marker，其汉明距离一定为零。得到Marker的朝向后，就可以提取Marker的信息（即ID），还可以调整Marker的4个顶点顺序，使其不随视角的变换而变换。在Demo中，我将正向放置的Marker的左上角作为1号顶点，逆时针旋转依次为2号、3号和4号。</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe"><img style="border: 0px none; max-width: 550px; height: auto; vertical-align: middle; text-align: center; margin: 0px auto; display: block" class="alignCenter" src="http://img2.tuicool.com/RBFBZbn.jpg" border="0" /></p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">代码如下：</p><pre class="prettyprint cpp" style="padding: 0.3em; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; color: #333333; border-radius: 4px; margin-top: 0px; margin-bottom: 1.5em; font-size: 13px; line-height: 1.5em; word-break: break-all; word-wrap: break-word; white-space: pre-wrap; border: 1px solid rgba(0, 0, 0, 0.14902); overflow-y: auto; background-color: #f6f6f6"><span style="font-weight: bold" class="keyword">void</span> MarkerRecognizer::markerRecognize(cv::Mat&amp; img_gray, <span class="stl_container"><span style="color: #0086b3" class="built_in">vector</span>&lt;Marker&gt;</span>&amp; possible_markers, <span class="stl_container"><span style="color: #0086b3" class="built_in">vector</span>&lt;Marker&gt;</span>&amp; final_markers) &#123; <span class="indent">&nbsp;&nbsp;</span>final_markers.clear();&nbsp;&nbsp;<span class="indent">&nbsp;&nbsp;</span>Mat marker_image; <span class="indent">&nbsp;&nbsp;</span>Mat bit_matrix(<span style="color: #009999" class="number">5</span>, <span style="color: #009999" class="number">5</span>, CV_8UC1); <span class="indent">&nbsp;&nbsp;</span><span style="font-weight: bold" class="keyword">for</span> (<span style="font-weight: bold" class="keyword">int</span> i = <span style="color: #009999" class="number">0</span>; i &lt; possible_markers.size(); ++i) <span class="indent">&nbsp;&nbsp;</span>&#123; <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span>Mat M = getPerspectiveTransform(possible_markers[i].m_corners, m_marker_coords); <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span>warpPerspective(img_gray, marker_image, M, Size(MARKER_SIZE, MARKER_SIZE)); <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span>threshold(marker_image, marker_image, <span style="color: #009999" class="number">125</span>, <span style="color: #009999" class="number">255</span>, THRESH_BINARY&#124;THRESH_OTSU); <span style="font-style: italic; color: #999988" class="comment">//OTSU determins threshold automatically.</span>&nbsp;&nbsp;<span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span style="font-style: italic; color: #999988" class="comment">//A marker must has a whole black border.</span> <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span style="font-weight: bold" class="keyword">for</span> (<span style="font-weight: bold" class="keyword">int</span> y = <span style="color: #009999" class="number">0</span>; y &lt; <span style="color: #009999" class="number">7</span>; ++y) <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span>&#123; <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span style="font-weight: bold" class="keyword">int</span> inc = (y == <span style="color: #009999" class="number">0</span> &#124;&#124; y == <span style="color: #009999" class="number">6</span>) ? <span style="color: #009999" class="number">1</span> : <span style="color: #009999" class="number">6</span>; <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span style="font-weight: bold" class="keyword">int</span> cell_y = y*MARKER_CELL_SIZE;&nbsp;&nbsp;<span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span style="font-weight: bold" class="keyword">for</span> (<span style="font-weight: bold" class="keyword">int</span> x = <span style="color: #009999" class="number">0</span>; x &lt; <span style="color: #009999" class="number">7</span>; x += inc) <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span>&#123; <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span style="font-weight: bold" class="keyword">int</span> cell_x = x*MARKER_CELL_SIZE; <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span style="font-weight: bold" class="keyword">int</span> none_zero_count = countNonZero(marker_image(Rect(cell_x, cell_y, MARKER_CELL_SIZE, MARKER_CELL_SIZE))); <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span style="font-weight: bold" class="keyword">if</span> (none_zero_count &gt; MARKER_CELL_SIZE*MARKER_CELL_SIZE/<span style="color: #009999" class="number">4</span>) <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span style="font-weight: bold" class="keyword">goto</span> __wrongMarker; <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span>&#125; <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span>&#125;&nbsp;&nbsp;<span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span style="font-style: italic; color: #999988" class="comment">//Decode the marker</span> <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span style="font-weight: bold" class="keyword">for</span> (<span style="font-weight: bold" class="keyword">int</span> y = <span style="color: #009999" class="number">0</span>; y &lt; <span style="color: #009999" class="number">5</span>; ++y) <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span>&#123; <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span style="font-weight: bold" class="keyword">int</span> cell_y = (y+<span style="color: #009999" class="number">1</span>)*MARKER_CELL_SIZE;&nbsp;&nbsp;<span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span style="font-weight: bold" class="keyword">for</span> (<span style="font-weight: bold" class="keyword">int</span> x = <span style="color: #009999" class="number">0</span>; x &lt; <span style="color: #009999" class="number">5</span>; ++x) <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span>&#123; <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span style="font-weight: bold" class="keyword">int</span> cell_x = (x+<span style="color: #009999" class="number">1</span>)*MARKER_CELL_SIZE; <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span style="font-weight: bold" class="keyword">int</span> none_zero_count = countNonZero(marker_image(Rect(cell_x, cell_y, MARKER_CELL_SIZE, MARKER_CELL_SIZE))); <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span style="font-weight: bold" class="keyword">if</span> (none_zero_count &gt; MARKER_CELL_SIZE*MARKER_CELL_SIZE/<span style="color: #009999" class="number">2</span>) <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span>bit_matrix.at&lt;uchar&gt;(y, x) = <span style="color: #009999" class="number">1</span>; <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span style="font-weight: bold" class="keyword">else</span> <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span>bit_matrix.at&lt;uchar&gt;(y, x) = <span style="color: #009999" class="number">0</span>; <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span>&#125; <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span>&#125;&nbsp;&nbsp;<span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span style="font-style: italic; color: #999988" class="comment">//Find the right marker orientation</span> <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span style="font-weight: bold" class="keyword">bool</span> good_marker = <span style="font-weight: bold" class="keyword">false</span>; <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span style="font-weight: bold" class="keyword">int</span> rotation_idx;&nbsp;&nbsp;<span style="font-style: italic; color: #999988" class="comment">//逆时针旋转的次数</span> <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span style="font-weight: bold" class="keyword">for</span> (rotation_idx = <span style="color: #009999" class="number">0</span>; rotation_idx &lt; <span style="color: #009999" class="number">4</span>; ++rotation_idx) <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span>&#123; <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span style="font-weight: bold" class="keyword">if</span> (hammingDistance(bit_matrix) == <span style="color: #009999" class="number">0</span>) <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span>&#123; <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span>good_marker = <span style="font-weight: bold" class="keyword">true</span>; <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span style="font-weight: bold" class="keyword">break</span>; <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span>&#125; <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span>bit_matrix = bitMatrixRotate(bit_matrix); <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span>&#125; <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span style="font-weight: bold" class="keyword">if</span> (!good_marker) <span style="font-weight: bold" class="keyword">goto</span> __wrongMarker;&nbsp;&nbsp;<span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span style="font-style: italic; color: #999988" class="comment">//Store the final marker</span> <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span>Marker&amp; final_marker = possible_markers[i]; <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span>final_marker.m_id = bitMatrixToId(bit_matrix); <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span style="color: #0086b3" class="built_in">std</span>::rotate(final_marker.m_corners.begin(), final_marker.m_corners.begin() + rotation_idx, final_marker.m_corners.end()); <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span>final_markers.push_back(final_marker);&nbsp;&nbsp;__wrongMarker: <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span style="font-weight: bold" class="keyword">continue</span>; <span class="indent">&nbsp;&nbsp;</span>&#125; &#125;</pre><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">得到最终的Marker后，为了之后计算精确的摄像机位置，还需对Marker四个顶点的坐标进行子像素提取，这一步很简单，直接使用cornerSubPix即可。</p><pre class="prettyprint cpp" style="padding: 0.3em; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; color: #333333; border-radius: 4px; margin-top: 0px; margin-bottom: 1.5em; font-size: 13px; line-height: 1.5em; word-break: break-all; word-wrap: break-word; white-space: pre-wrap; border: 1px solid rgba(0, 0, 0, 0.14902); overflow-y: auto; background-color: #f6f6f6"><span style="font-weight: bold" class="keyword">void</span> MarkerRecognizer::markerRefine(cv::Mat&amp; img_gray, <span class="stl_container"><span style="color: #0086b3" class="built_in">vector</span>&lt;Marker&gt;</span>&amp; final_markers) &#123; <span class="indent">&nbsp;&nbsp;</span><span style="font-weight: bold" class="keyword">for</span> (<span style="font-weight: bold" class="keyword">int</span> i = <span style="color: #009999" class="number">0</span>; i &lt; final_markers.size(); ++i) <span class="indent">&nbsp;&nbsp;</span>&#123; <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span class="stl_container"><span style="color: #0086b3" class="built_in">vector</span>&lt;Point2f&gt;</span>&amp; corners = final_markers[i].m_corners; <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span>cornerSubPix(img_gray, corners, Size(<span style="color: #009999" class="number">5</span>,<span style="color: #009999" class="number">5</span>), Size(-<span style="color: #009999" class="number">1</span>,-<span style="color: #009999" class="number">1</span>), TermCriteria(CV_TERMCRIT_ITER, <span style="color: #009999" class="number">30</span>, <span style="color: #009999" class="number">0.1</span>)); <span class="indent">&nbsp;&nbsp;</span>&#125; &#125;</pre><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">为了检查算法的结果，将Marker的提取结果画到了图像上。其中蓝色边框标记了Marker的区域，空心圆圈代表Marker的1号顶点（正向放置时的左上角），较小的实心原点代表2号顶点，数字代表Marker的ID。</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe"><img style="border: 0px none; max-width: 550px; height: auto; vertical-align: middle; text-align: center; margin: 0px auto; display: block" class="alignCenter" src="http://img0.tuicool.com/iIZ3yqu.jpg" border="0" /></p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">2、计算摄像机位置</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">计算摄像机的位置，首先需要对摄像机进行标定，标定是确定摄像机内参矩阵K的过程，一般用棋盘进行标定，这已经是一个很成熟的方法了，在这就不细说了。得到相机的内参矩阵K后，就可以使用solvePnP方法求取摄像机关于某个Marker的位置。摄像机成像使用小孔模型，如下：</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">x = K[R&#124;T]X</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">其中，X是空间某点的坐标（相对于世界坐标系），[R&#124;T]是摄像机外参矩阵，用于将某点的世界坐标变换为摄像机坐标，K是摄像机内参，用于将摄像机坐标中的某点投影的像平&nbsp;面上，x&nbsp;即为投影后的像素坐标。</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">对于一个确定的Marker，x是已知的，K是已知的，使用solvePnP求取相机位置实际上就是求取相机相对于Marker的外参矩阵[R&#124;T]，但现在X还不知道，如何确定呢？</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">外参矩阵与世界坐标系的选取有关，而世界坐标系的选取是任意的，因此我们可以将世界坐标系直接设定在Marker上，如下图：</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe"><img style="border: 0px none; max-width: 550px; height: auto; vertical-align: middle; text-align: center; margin: 0px auto; display: block" class="alignCenter" src="http://img1.tuicool.com/nmIvu2.jpg" border="0" /></p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">我们想象Marker位于世界坐标系的XY平面上（Z分量为零），且原点位于Marker的中心。由此，我们就确定了四个点的X坐标，将四个点的X坐标以及对应的像素坐标x传入solvePnP方法，即可得到相机关于该Marker的外参了。为了方便之后的使用，使用Rodrigues方法将旋转向量变为对应的旋转矩阵。</p><pre class="prettyprint cpp" style="padding: 0.3em; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; color: #333333; border-radius: 4px; margin-top: 0px; margin-bottom: 1.5em; font-size: 13px; line-height: 1.5em; word-break: break-all; word-wrap: break-word; white-space: pre-wrap; border: 1px solid rgba(0, 0, 0, 0.14902); overflow-y: auto; background-color: #f6f6f6"><span style="font-weight: bold" class="keyword">void</span> Marker::estimateTransformToCamera(<span class="stl_container"><span style="color: #0086b3" class="built_in">vector</span>&lt;Point3f&gt;</span> corners_3d, cv::Mat&amp; camera_matrix, cv::Mat&amp; dist_coeff, cv::Mat&amp; rmat, cv::Mat&amp; tvec) &#123; <span class="indent">&nbsp;&nbsp;</span>Mat rot_vec; <span class="indent">&nbsp;&nbsp;</span><span style="font-weight: bold" class="keyword">bool</span> res = solvePnP(corners_3d, m_corners, camera_matrix, dist_coeff, rot_vec, tvec); <span class="indent">&nbsp;&nbsp;</span>Rodrigues(rot_vec, rmat); &#125;</pre><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">那么现在问题来了！我们设定世界坐标系时，只设定了X轴与Y轴的方向，由于Z分量为零，它的方向并不影响求得的外参矩阵。但之后将虚拟物体放入该世界坐标时，却需要知道Z轴的方向，那么我们的Z轴方向到底是什么呢？</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">首先，solvePnP返回的结果是一个旋转向量和一个平移向量，两者构成一个刚体运动，刚体运动不会改变坐标系的手性（即右手坐标系经过刚体运动后还是右手坐标系），所以世界坐标系的手性应该和相机坐标系的手性一致。从相机的小孔成像模型中可以知道，相机坐标系的Z轴是指向像平面的，因此，通过下图我们可以断定，世界坐标系的Z轴是垂直于Marker向下的。</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe"><img style="border: 0px none; max-width: 550px; height: auto; vertical-align: middle; text-align: center; margin: 0px auto; display: block" class="alignCenter" src="http://img2.tuicool.com/3imEV3N.jpg" border="0" /></p><h4 style="margin: 0px 0px 0.5em; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; line-height: 25.6000003814697px; color: #333333; text-rendering: optimizelegibility; font-size: 16px; text-indent: 1em; background-color: #fefefe">二、从OpenCV到OpenGL</h4><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">得到摄像机的内参K和相对于每个Marker的外参[R&#124;T]后，就可以开始考虑将虚拟物体添加进来了。老惯例，我还是使用OpenFrameworks。OpenFrameworks是在OpenGL基础上构建的一套框架，所以3D显示上，其本质还是OpenGL。</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">OpenGL的投影模型和普通相机的小孔投影模型是类似的，其PROJECTION矩阵对应与相机的内参K，MODELVIEW矩阵对应与相机的外参。但是，我们之前求得的K和[R&#124;T]还不能直接使用，原因有二，其一，OpenGL投影模型使用的坐标系与OpenCV的不同；其二，OpenGL为了进行Clipping，其投影矩阵需要将点投影到NDC空间中。</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe"><img style="border: 0px none; max-width: 550px; height: auto; vertical-align: middle; text-align: center; margin: 0px auto; display: block" class="alignCenter" src="http://img0.tuicool.com/bqeYNz.png" border="0" /></p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">Perspective Frustum and Normalized Device Coordinates (NDC)</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">由上图（左边）可知，OpenGL的相机坐标系相当于OpenCV的相机坐标系绕着X轴旋转了180度，因此，我们使用外参矩阵[R&#124;T]对世界坐标系中的某点进行变换后，还需要左乘一个旋转矩阵才能得到该点在OpenGL坐标系中的坐标。绕X轴旋转180度的旋转矩阵很简单，如下：</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">[ 1, &nbsp;0, &nbsp;0,</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">0, -1, &nbsp;0,</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">0, &nbsp;0, -1 ]</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">总之，外参矩阵[R&#124;T]左乘以上矩阵后，即得OpenGL中的MODELVIEW矩阵，代码如下，注意OpenGL的矩阵元素是以列主序存储的。</p><pre class="prettyprint xml" style="padding: 0.3em; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; color: #333333; border-radius: 4px; margin-top: 0px; margin-bottom: 1.5em; font-size: 13px; line-height: 1.5em; word-break: break-all; word-wrap: break-word; white-space: pre-wrap; border: 1px solid rgba(0, 0, 0, 0.14902); overflow-y: auto; background-color: #f6f6f6">void ofApp::extrinsicMatrix2ModelViewMatrix(cv::Mat&amp; rotation, cv::Mat&amp; translation, float* model_view_matrix) &#123; <span class="indent">&nbsp;&nbsp;</span>//绕X轴旋转180度，从OpenCV坐标系变换为OpenGL坐标系 <span class="indent">&nbsp;&nbsp;</span>static double d[] =&nbsp;&nbsp;<span class="indent">&nbsp;&nbsp;</span>&#123; <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span>1,&nbsp;&nbsp;0,&nbsp;&nbsp;0, <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span>0, -1,&nbsp;&nbsp;0, <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span>0,&nbsp;&nbsp;0, -1 <span class="indent">&nbsp;&nbsp;</span>&#125;; <span class="indent">&nbsp;&nbsp;</span>Mat_<span style="color: #000080" class="tag">&lt;<span class="title">double</span>&gt;</span> rx(3, 3, d);&nbsp;&nbsp;<span class="indent">&nbsp;&nbsp;</span>rotation = rx*rotation; <span class="indent">&nbsp;&nbsp;</span>translation = rx*translation;&nbsp;&nbsp;<span class="indent">&nbsp;&nbsp;</span>model_view_matrix[0] = rotation.at<span style="color: #000080" class="tag">&lt;<span class="title">double</span>&gt;</span>(0,0); <span class="indent">&nbsp;&nbsp;</span>model_view_matrix[1] = rotation.at<span style="color: #000080" class="tag">&lt;<span class="title">double</span>&gt;</span>(1,0); <span class="indent">&nbsp;&nbsp;</span>model_view_matrix[2] = rotation.at<span style="color: #000080" class="tag">&lt;<span class="title">double</span>&gt;</span>(2,0); <span class="indent">&nbsp;&nbsp;</span>model_view_matrix[3] = 0.0f;&nbsp;&nbsp;<span class="indent">&nbsp;&nbsp;</span>model_view_matrix[4] = rotation.at<span style="color: #000080" class="tag">&lt;<span class="title">double</span>&gt;</span>(0,1); <span class="indent">&nbsp;&nbsp;</span>model_view_matrix[5] = rotation.at<span style="color: #000080" class="tag">&lt;<span class="title">double</span>&gt;</span>(1,1); <span class="indent">&nbsp;&nbsp;</span>model_view_matrix[6] = rotation.at<span style="color: #000080" class="tag">&lt;<span class="title">double</span>&gt;</span>(2,1); <span class="indent">&nbsp;&nbsp;</span>model_view_matrix[7] = 0.0f;&nbsp;&nbsp;<span class="indent">&nbsp;&nbsp;</span>model_view_matrix[8] = rotation.at<span style="color: #000080" class="tag">&lt;<span class="title">double</span>&gt;</span>(0,2); <span class="indent">&nbsp;&nbsp;</span>model_view_matrix[9] = rotation.at<span style="color: #000080" class="tag">&lt;<span class="title">double</span>&gt;</span>(1,2); <span class="indent">&nbsp;&nbsp;</span>model_view_matrix[10] = rotation.at<span style="color: #000080" class="tag">&lt;<span class="title">double</span>&gt;</span>(2,2); <span class="indent">&nbsp;&nbsp;</span>model_view_matrix[11] = 0.0f;&nbsp;&nbsp;<span class="indent">&nbsp;&nbsp;</span>model_view_matrix[12] = translation.at<span style="color: #000080" class="tag">&lt;<span class="title">double</span>&gt;</span>(0, 0); <span class="indent">&nbsp;&nbsp;</span>model_view_matrix[13] = translation.at<span style="color: #000080" class="tag">&lt;<span class="title">double</span>&gt;</span>(1, 0); <span class="indent">&nbsp;&nbsp;</span>model_view_matrix[14] = translation.at<span style="color: #000080" class="tag">&lt;<span class="title">double</span>&gt;</span>(2, 0); <span class="indent">&nbsp;&nbsp;</span>model_view_matrix[15] = 1.0f; &#125;</pre><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">下一步是求PROJECTION矩阵。由于OpenGL要做Clipping，要求所有在透视椎体中的点都投影到NDC中，在NDC中的点能够显示在屏幕上，之外的点则不能。因此，我们的PROJECTION矩阵不仅要有与内参矩阵K相同的透视效果，还得把点投影到NDC中。</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">首先先看看内参矩阵K的形式：</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe"><img style="border: 0px none; max-width: 550px; height: auto; vertical-align: middle; text-align: center; margin: 0px auto; display: block" class="alignCenter" src="http://img1.tuicool.com/ArMVnai.jpg" border="0" /></p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">首先假设OpenGL的投影椎体是对称的，那么PROJECTION矩阵的形式如下：</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe"><img style="border: 0px none; max-width: 550px; height: auto; vertical-align: middle; text-align: center; margin: 0px auto; display: block" class="alignCenter" src="http://img2.tuicool.com/n2e6Br.jpg" border="0" /></p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">使用以上矩阵对某一点（X, Y, Z, 1）投影后，可以得到如下关系：</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe"><img style="border: 0px none; max-width: 550px; height: auto; vertical-align: middle; text-align: center; margin: 0px auto; display: block" class="alignCenter" src="http://img0.tuicool.com/BjeeMz.jpg" border="0" /></p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">接下来，OpenGL会对该结果进行Clipping，具体方法是将四个分量都除以-Z，那么，要使我们的点最终显示到屏幕上，前三个分量在除以-Z后其变化范围必须在[-1, 1]内。如下：</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe"><img style="border: 0px none; max-width: 550px; height: auto; vertical-align: middle; text-align: center; margin: 0px auto; display: block" class="alignCenter" src="http://img1.tuicool.com/Yf6Fzm.jpg" border="0" /></p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">由摄像机投影模型（相似三角形）知：</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe"><img style="border: 0px none; max-width: 550px; height: auto; vertical-align: middle; text-align: center; margin: 0px auto; display: block" class="alignCenter" src="http://img2.tuicool.com/U7vmMf.jpg" border="0" /></p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe"><img style="border: 0px none; max-width: 550px; height: auto; vertical-align: middle; display: block; clear: both; text-align: center; margin: 0px auto" class="breakLine" src="http://img0.tuicool.com/QRnaQbV.jpg" border="0" /></p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">其中由于OpenGL相机的相面在Z轴负方向上，所以是-fx和-fy。xp和yp分别为某点在相面上的横坐标和纵坐标，这两个坐标的原点在图像的中心，图像的宽度和高度分别为w和h，因此xp和yp的取值范围分别为[-w/2, w/2]和[-h/2, h/2]，可得：</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe"><img style="border: 0px none; max-width: 550px; height: auto; vertical-align: middle; display: block; clear: both; text-align: center; margin: 0px auto" class="breakLine" src="http://img1.tuicool.com/UNF7Jju.jpg" border="0" /></p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">于是</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe"><img style="border: 0px none; max-width: 550px; height: auto; vertical-align: middle; display: block; clear: both; text-align: center; margin: 0px auto" class="breakLine" src="http://img2.tuicool.com/femEJnV.jpg" border="0" /></p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">接下来，我们为OpenGL相机设定两个面，near和far，只有处于这两个面之间的点才能投影到NDC空间中，所以当 Z=-n 时，(AZ+B)/-Z = -1，当 Z=-f 时，(AZ+B)/-Z = 1，由此我们可以得到关于A和B的二元一次方程，从而解出A、B：</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe"><img style="border: 0px none; max-width: 550px; height: auto; vertical-align: middle; display: block; clear: both; text-align: center; margin: 0px auto" class="breakLine" src="http://img0.tuicool.com/fyyaMn.jpg" border="0" /></p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">现在再来考虑OpenGL投影椎体不对称的情况，这种情况下，PROJECTION矩阵的形式为：</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe"><img style="border: 0px none; max-width: 550px; height: auto; vertical-align: middle; text-align: center; margin: 0px auto; display: block" class="alignCenter" src="http://img1.tuicool.com/UZJVJj.jpg" border="0" /></p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">由于椎体不对称，这时xp和yp的变化范围分别为[l, r]和[b, t]，代表图像左侧（left）右侧（right），以及底部（bottom）顶部（top），用同样的方法，我们有：</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe"><img style="border: 0px none; max-width: 550px; height: auto; vertical-align: middle; text-align: center; margin: 0px auto; display: block" class="alignCenter" src="http://img2.tuicool.com/uaEBnqM.jpg" border="0" /></p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">可得：</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe"><img style="border: 0px none; max-width: 550px; height: auto; vertical-align: middle; display: block; clear: both; text-align: center; margin: 0px auto" class="breakLine" src="http://img0.tuicool.com/ruy2Yr.jpg" border="0" />， &nbsp;&nbsp;<img style="border: 0px none; max-width: 550px; height: auto; vertical-align: middle; text-align: center; margin: 0px auto" src="http://img.blog.csdn.net/20141129172323991" border="0" /></p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">于是：</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe"><img style="border: 0px none; max-width: 550px; height: auto; vertical-align: middle; text-align: center; margin: 0px auto; display: block" class="alignCenter" src="http://img1.tuicool.com/QNjQj2.jpg" border="0" /></p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">关于l+r和b+t是怎么计算的，可以参考下图：</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe"><img style="border: 0px none; max-width: 550px; height: auto; vertical-align: middle; text-align: center; margin: 0px auto; display: block" class="alignCenter" src="http://img2.tuicool.com/NV7jEz.jpg" border="0" /></p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">综上所述，我们可以得到OpenGL投影矩阵的最终形式：</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe"><img style="border: 0px none; max-width: 550px; height: auto; vertical-align: middle; text-align: center; margin: 0px auto; display: block" class="alignCenter" src="http://img0.tuicool.com/eQBJNn.jpg" border="0" /></p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">到此，我们就可以将这个矩阵的数据传递给PROJECTION矩阵了：</p><pre class="prettyprint cpp" style="padding: 0.3em; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; color: #333333; border-radius: 4px; margin-top: 0px; margin-bottom: 1.5em; font-size: 13px; line-height: 1.5em; word-break: break-all; word-wrap: break-word; white-space: pre-wrap; border: 1px solid rgba(0, 0, 0, 0.14902); overflow-y: auto; background-color: #f6f6f6"><span style="font-weight: bold" class="keyword">void</span> ofApp::intrinsicMatrix2ProjectionMatrix(cv::Mat&amp; camera_matrix, <span style="font-weight: bold" class="keyword">float</span> width, <span style="font-weight: bold" class="keyword">float</span> height, <span style="font-weight: bold" class="keyword">float</span> near_plane, <span style="font-weight: bold" class="keyword">float</span> far_plane, <span style="font-weight: bold" class="keyword">float</span>* projection_matrix) &#123; <span class="indent">&nbsp;&nbsp;</span><span style="font-weight: bold" class="keyword">float</span> f_x = camera_matrix.at&lt;<span style="font-weight: bold" class="keyword">float</span>&gt;(<span style="color: #009999" class="number">0</span>,<span style="color: #009999" class="number">0</span>); <span class="indent">&nbsp;&nbsp;</span><span style="font-weight: bold" class="keyword">float</span> f_y = camera_matrix.at&lt;<span style="font-weight: bold" class="keyword">float</span>&gt;(<span style="color: #009999" class="number">1</span>,<span style="color: #009999" class="number">1</span>);&nbsp;&nbsp;<span class="indent">&nbsp;&nbsp;</span><span style="font-weight: bold" class="keyword">float</span> c_x = camera_matrix.at&lt;<span style="font-weight: bold" class="keyword">float</span>&gt;(<span style="color: #009999" class="number">0</span>,<span style="color: #009999" class="number">2</span>); <span class="indent">&nbsp;&nbsp;</span><span style="font-weight: bold" class="keyword">float</span> c_y = camera_matrix.at&lt;<span style="font-weight: bold" class="keyword">float</span>&gt;(<span style="color: #009999" class="number">1</span>,<span style="color: #009999" class="number">2</span>); <span class="indent">&nbsp;&nbsp;</span> <span class="indent">&nbsp;&nbsp;</span>projection_matrix[<span style="color: #009999" class="number">0</span>] = <span style="color: #009999" class="number">2</span>*f_x/width; <span class="indent">&nbsp;&nbsp;</span>projection_matrix[<span style="color: #009999" class="number">1</span>] = <span style="color: #009999" class="number">0.0f</span>; <span class="indent">&nbsp;&nbsp;</span>projection_matrix[<span style="color: #009999" class="number">2</span>] = <span style="color: #009999" class="number">0.0f</span>; <span class="indent">&nbsp;&nbsp;</span>projection_matrix[<span style="color: #009999" class="number">3</span>] = <span style="color: #009999" class="number">0.0f</span>;&nbsp;&nbsp;<span class="indent">&nbsp;&nbsp;</span>projection_matrix[<span style="color: #009999" class="number">4</span>] = <span style="color: #009999" class="number">0.0f</span>; <span class="indent">&nbsp;&nbsp;</span>projection_matrix[<span style="color: #009999" class="number">5</span>] = <span style="color: #009999" class="number">2</span>*f_y/height; <span class="indent">&nbsp;&nbsp;</span>projection_matrix[<span style="color: #009999" class="number">6</span>] = <span style="color: #009999" class="number">0.0f</span>; <span class="indent">&nbsp;&nbsp;</span>projection_matrix[<span style="color: #009999" class="number">7</span>] = <span style="color: #009999" class="number">0.0f</span>;&nbsp;&nbsp;<span class="indent">&nbsp;&nbsp;</span>projection_matrix[<span style="color: #009999" class="number">8</span>] = <span style="color: #009999" class="number">1.0f</span> - <span style="color: #009999" class="number">2</span>*c_x/width; <span class="indent">&nbsp;&nbsp;</span>projection_matrix[<span style="color: #009999" class="number">9</span>] = <span style="color: #009999" class="number">2</span>*c_y/height - <span style="color: #009999" class="number">1.0f</span>; <span class="indent">&nbsp;&nbsp;</span>projection_matrix[<span style="color: #009999" class="number">10</span>] = -(far_plane + near_plane)/(far_plane - near_plane); <span class="indent">&nbsp;&nbsp;</span>projection_matrix[<span style="color: #009999" class="number">11</span>] = -<span style="color: #009999" class="number">1.0f</span>;&nbsp;&nbsp;<span class="indent">&nbsp;&nbsp;</span>projection_matrix[<span style="color: #009999" class="number">12</span>] = <span style="color: #009999" class="number">0.0f</span>; <span class="indent">&nbsp;&nbsp;</span>projection_matrix[<span style="color: #009999" class="number">13</span>] = <span style="color: #009999" class="number">0.0f</span>; <span class="indent">&nbsp;&nbsp;</span>projection_matrix[<span style="color: #009999" class="number">14</span>] = -<span style="color: #009999" class="number">2.0f</span>*far_plane*near_plane/(far_plane - near_plane); <span class="indent">&nbsp;&nbsp;</span>projection_matrix[<span style="color: #009999" class="number">15</span>] = <span style="color: #009999" class="number">0.0f</span>; &#125;</pre><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">现在是时候放一些虚拟物体进来了，为了简单，我就放了几个立方体，由于OpenFrameworks绘制立方体时以立方体在中心为原点，所以为了使立方体的底面贴在Marker上，必须在Marker上方二分之一立方体边长的地方绘制，也就是绘制立方体的坐标为（0, 0, -0.5*size），为什么是负0.5呢？还记得之前所说的世界坐标系的Z轴是垂直于Marker并朝下的吗？所以要画在Marker上方，必须向Z轴负方向移动！</p><pre class="prettyprint javascript" style="padding: 0.3em; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; color: #333333; border-radius: 4px; margin-top: 0px; margin-bottom: 1.5em; font-size: 13px; line-height: 1.5em; word-break: break-all; word-wrap: break-word; white-space: pre-wrap; border: 1px solid rgba(0, 0, 0, 0.14902); overflow-y: auto; background-color: #f6f6f6"><span style="font-weight: bold" class="keyword">void</span> ofApp::draw()&#123;&nbsp;&nbsp;<span class="indent">&nbsp;&nbsp;</span>ofSetColor(<span style="color: #009999" class="number">255</span>); <span class="indent">&nbsp;&nbsp;</span>float view_width = ofGetViewportWidth(); <span class="indent">&nbsp;&nbsp;</span>float view_height = ofGetViewportHeight(); <span class="indent">&nbsp;&nbsp;</span>m_video.draw(<span style="color: #009999" class="number">0</span>, <span style="color: #009999" class="number">0</span>, view_width, view_height);&nbsp;&nbsp;<span class="indent">&nbsp;&nbsp;</span><span style="font-style: italic; color: #999988" class="comment">//Set camera matrix to the opengl projection matrix;</span> <span class="indent">&nbsp;&nbsp;</span>intrinsicMatrix2ProjectionMatrix(m_camera_matrix, <span style="color: #009999" class="number">640</span>, <span style="color: #009999" class="number">480</span>, <span style="color: #009999" class="number">0.01</span>f, <span style="color: #009999" class="number">100.0</span>f, m_projection_matrix); <span class="indent">&nbsp;&nbsp;</span>ofSetMatrixMode(OF_MATRIX_PROJECTION); <span class="indent">&nbsp;&nbsp;</span><span style="font-style: italic; color: #999988" class="comment">//Openframeworks里将(-1, -1)映射到屏幕左上角，而非一般的左下角，所以需要一个矩阵进行垂直镜像</span> <span class="indent">&nbsp;&nbsp;</span>static float reflect[] =&nbsp;&nbsp;<span class="indent">&nbsp;&nbsp;</span>&#123; <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span style="color: #009999" class="number">1</span>,&nbsp;&nbsp;<span style="color: #009999" class="number">0</span>, <span style="color: #009999" class="number">0</span>, <span style="color: #009999" class="number">0</span>, <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span style="color: #009999" class="number">0</span>, -<span style="color: #009999" class="number">1</span>, <span style="color: #009999" class="number">0</span>, <span style="color: #009999" class="number">0</span>, <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span style="color: #009999" class="number">0</span>,&nbsp;&nbsp;<span style="color: #009999" class="number">0</span>, <span style="color: #009999" class="number">1</span>, <span style="color: #009999" class="number">0</span>, <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span style="color: #009999" class="number">0</span>,&nbsp;&nbsp;<span style="color: #009999" class="number">0</span>, <span style="color: #009999" class="number">0</span>, <span style="color: #009999" class="number">1</span> <span class="indent">&nbsp;&nbsp;</span>&#125;; <span class="indent">&nbsp;&nbsp;</span>ofLoadMatrix(reflect); <span class="indent">&nbsp;&nbsp;</span><span style="font-style: italic; color: #999988" class="comment">//OpenGL默认为右乘</span> <span class="indent">&nbsp;&nbsp;</span>ofMultMatrix(m_projection_matrix);&nbsp;&nbsp;<span class="indent">&nbsp;&nbsp;</span><span style="font-style: italic; color: #999988" class="comment">//Reset model view matrix to identity;</span> <span class="indent">&nbsp;&nbsp;</span>ofSetMatrixMode(OF_MATRIX_MODELVIEW); <span class="indent">&nbsp;&nbsp;</span>ofLoadIdentityMatrix();&nbsp;&nbsp;<span class="indent">&nbsp;&nbsp;</span><span style="font-style: italic; color: #999988" class="comment">//Set opengl parameters</span> <span class="indent">&nbsp;&nbsp;</span>ofSetColor(<span style="color: #009999" class="number">255</span>); <span class="indent">&nbsp;&nbsp;</span><span class="xml"><span style="color: #000080" class="tag">&lt;<span class="title">span</span> <span style="color: #008080" class="attribute">style</span>=<span style="color: #dd1144" class="value">&quot;white-space:pre&quot;</span>&gt;</span>&nbsp;&nbsp;<span style="color: #000080" class="tag">&lt;/<span class="title">span</span>&gt;</span>ofEnableBlendMode(OF_BLENDMODE_ALPHA); <span class="indent">&nbsp;&nbsp;</span>ofEnableDepthTest(); <span class="indent">&nbsp;&nbsp;</span><span style="color: #000080" class="tag">&lt;<span class="title">span</span> <span style="color: #008080" class="attribute">style</span>=<span style="color: #dd1144" class="value">&quot;white-space:pre&quot;</span>&gt;</span>&nbsp;&nbsp;<span style="color: #000080" class="tag">&lt;/<span class="title">span</span>&gt;</span>glShadeModel(GL_SMOOTH); //some model / light stuff <span class="indent">&nbsp;&nbsp;</span><span style="color: #000080" class="tag">&lt;<span class="title">span</span> <span style="color: #008080" class="attribute">style</span>=<span style="color: #dd1144" class="value">&quot;white-space:pre&quot;</span>&gt;</span>&nbsp;&nbsp;<span style="color: #000080" class="tag">&lt;/<span class="title">span</span>&gt;</span>m_light.enable(); <span class="indent">&nbsp;&nbsp;</span><span style="color: #000080" class="tag">&lt;<span class="title">span</span> <span style="color: #008080" class="attribute">style</span>=<span style="color: #dd1144" class="value">&quot;white-space:pre&quot;</span>&gt;</span>&nbsp;&nbsp;<span style="color: #000080" class="tag">&lt;/<span class="title">span</span>&gt;</span>ofEnableSeparateSpecularLight();&nbsp;&nbsp;<span class="indent">&nbsp;&nbsp;</span>vector<span style="color: #000080" class="tag">&lt;<span class="title">Marker</span>&gt;</span>&amp; markers = m_recognizer.getMarkers(); <span class="indent">&nbsp;&nbsp;</span>Mat r, t; <span class="indent">&nbsp;&nbsp;</span>for (int i = 0; i <span style="color: #000080" class="tag">&lt; <span style="color: #008080" class="attribute">markers.size</span>(); ++<span style="color: #008080" class="attribute">i</span>) <span class="indent">&nbsp;&nbsp;</span>&#123; <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span>//求出的旋转矩阵<span style="color: #008080" class="attribute">r</span>的行列式为+<span style="color: #008080" class="attribute">1</span>，即为刚体变换，所以不改变坐标系的手性 <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span style="color: #008080" class="attribute">markers</span>[<span style="color: #008080" class="attribute">i</span>]<span style="color: #008080" class="attribute">.estimateTransformToCamera</span>(<span style="color: #008080" class="attribute">m_corners_3d</span>, <span style="color: #008080" class="attribute">m_camera_matrix</span>, <span style="color: #008080" class="attribute">m_dist_coeff</span>, <span style="color: #008080" class="attribute">r</span>, <span style="color: #008080" class="attribute">t</span>); <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span style="color: #008080" class="attribute">extrinsicMatrix2ModelViewMatrix</span>(<span style="color: #008080" class="attribute">r</span>, <span style="color: #008080" class="attribute">t</span>, <span style="color: #008080" class="attribute">m_model_view_matrix</span>); <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span style="color: #008080" class="attribute">ofLoadMatrix</span>(<span style="color: #008080" class="attribute">m_model_view_matrix</span>);&nbsp;&nbsp;<span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span style="color: #008080" class="attribute">ofSetColor</span>(<span style="color: #008080" class="attribute">0x66</span>,<span style="color: #008080" class="attribute">0xcc</span>,<span style="color: #008080" class="attribute">0xff</span>); <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span>//由于<span style="color: #008080" class="attribute">Marker</span>坐标系与<span style="color: #008080" class="attribute">OpenCV</span>坐标系的手性一致，所以<span style="color: #008080" class="attribute">Marker</span>坐标系的<span style="color: #008080" class="attribute">Z</span>轴垂直于<span style="color: #008080" class="attribute">Marker</span>向下 <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span>//绘制<span style="color: #008080" class="attribute">Box</span>时的<span style="color: #008080" class="attribute">Anchor</span>在<span style="color: #008080" class="attribute">Box</span>中心，所以需要<span style="color: #008080" class="attribute">-0.5</span>*<span style="color: #008080" class="attribute">size</span>的偏移才能使<span style="color: #008080" class="attribute">Box</span>的底面在<span style="color: #008080" class="attribute">Marker</span>上！！ <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span style="color: #008080" class="attribute">ofDrawBox</span>(<span style="color: #008080" class="attribute">0</span>, <span style="color: #008080" class="attribute">0</span>, <span style="color: #008080" class="attribute">-0.4f</span>, <span style="color: #008080" class="attribute">0.8f</span>); <span class="indent">&nbsp;&nbsp;</span>&#125;&nbsp;&nbsp;<span class="indent">&nbsp;&nbsp;</span>//<span style="color: #008080" class="attribute">Reset</span> <span style="color: #008080" class="attribute">parameters</span> <span class="indent">&nbsp;&nbsp;</span><span style="color: #008080" class="attribute">ofDisableDepthTest</span>(); <span class="indent">&nbsp;&nbsp;</span>&lt;<span style="color: #008080" class="attribute">span</span> <span style="color: #008080" class="attribute">style</span>=<span style="color: #dd1144" class="value">&quot;white-space:pre&quot;</span>&gt;</span>&nbsp;&nbsp;<span style="color: #000080" class="tag">&lt;/<span class="title">span</span>&gt;</span>m_light.disable(); <span class="indent">&nbsp;&nbsp;</span><span style="color: #000080" class="tag">&lt;<span class="title">span</span> <span style="color: #008080" class="attribute">style</span>=<span style="color: #dd1144" class="value">&quot;white-space:pre&quot;</span>&gt;</span>&nbsp;&nbsp;<span style="color: #000080" class="tag">&lt;/<span class="title">span</span>&gt;</span>ofDisableLighting();&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #000080" class="tag">&lt;<span class="title">span</span> <span style="color: #008080" class="attribute">style</span>=<span style="color: #dd1144" class="value">&quot;white-space:pre&quot;</span>&gt;</span>&nbsp;&nbsp;<span style="color: #000080" class="tag">&lt;/<span class="title">span</span>&gt;</span> ofDisableSeparateSpecularLight();&nbsp;&nbsp;<span class="indent">&nbsp;&nbsp;</span>ofSetMatrixMode(OF_MATRIX_MODELVIEW); <span class="indent">&nbsp;&nbsp;</span>ofLoadIdentityMatrix(); <span class="indent">&nbsp;&nbsp;</span>ofSetMatrixMode(OF_MATRIX_PROJECTION); <span class="indent">&nbsp;&nbsp;</span>ofLoadIdentityMatrix(); &#125;</span></pre><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">注意，我在设置投影矩阵时，左乘了一个垂直方向的镜像矩阵，这是因为，我发现OpenFrameworks将NDC空间中（-1, -1）点映射到屏幕的左上角，而非一般OpenGL所映射的左下角，如果不乘这个镜像矩阵，得到的图像就是上下颠倒的。至于为什么OpenFrameworks是这样，由于没仔细研究它的代码，我只能猜测是其在初始化时对OpenGL做了一些设置所致。所以，如果我的理解或猜测有错误，还请大家指出^_^</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe"><img style="border: 0px none; max-width: 550px; height: auto; vertical-align: middle; text-align: center; margin: 0px auto; display: block" class="alignCenter" src="http://img1.tuicool.com/Ifieuy.jpg" border="0" /></p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">最后给出代码的下载地址，程序用VS2012开发，解压后放到&rdquo;OpenFrameworks安装目录&#92;apps&#92;myApps&ldquo;下打开编译：</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 25.6000003814697px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe"><a style="text-decoration: none; outline: none; color: #949494; -webkit-transition: 0.25s; transition: 0.25s; border-bottom-width: 1px; border-bottom-style: dashed; border-bottom-color: #949494; font-style: italic; font-weight: bold" rel="nofollow,noindex" href="http://download.csdn.net/detail/aichipmunk/8207875" target="_blank">http://download.csdn.net/detail/aichipmunk/8207875</a></p>
]]>
</description>
</item><item>
<link>http://i.renjihe.com/blog/read.php?5878</link>
<title><![CDATA[Gabor的OpenCV代码]]></title> 
<author>renjihe1988 &lt;admin@yourname.com&gt;</author>
<category><![CDATA[OpenCV]]></category>
<pubDate>Tue, 18 Feb 2014 05:55:29 +0000</pubDate> 
<guid>http://i.renjihe.com/blog/read.php?5878</guid> 
<description>
<![CDATA[ 
	<a href="http://blog.csdn.net/liulina603/article/details/8658005">http://blog.csdn.net/liulina603/article/details/8658005</a><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #333333">最近弄人脸识别，用到Gabor卷积核，但网上的代码似乎没有和我心意的，于是参考了自己写了下！参考了</span><span style="font-size: 14px; line-height: 25px; font-family: Calibri; color: #3d3d3d">Zhou Mian以及matlab的Gabor实现代码的代码。虽然OpenCV的imporc下面有个gabor.cpp，但那个是一般形式的公式，不是用来做人脸识别的，可以参考文献A review on Gabor wavelets for face recognition，又说到。上代码和链接地址！<a style="color: #336699; text-decoration: none" href="http://download.csdn.net/detail/guoming0000/4482827" target="_blank"><span style="color: #ca0000">下载地址~</span></a></span><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-family: Calibri; color: #3d3d3d"><span style="line-height: 25px">&nbsp;&nbsp; 目前代码未经过更多的测试，不少功能为加入，但可以满足许多人的使用和参考了吧，很多人肯定非常非常需要，先开源下，欢迎指出错误之处。<br /><br /></span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px">#pragma once</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px">#include &quot;opencv2&#92;opencv.hpp&quot;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px">#include &lt;vector&gt;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px">using namespace std;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px">using namespace cv;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px">class GaborFR</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px">&#123;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px">public:</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>GaborFR();</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>static Mat<span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>getImagGaborKernel(Size ksize, double sigma, double theta,&nbsp;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>double nu,double gamma=1, int ktype= CV_32F);</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>static Mat<span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>getRealGaborKernel( Size ksize, double sigma, double theta,&nbsp;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>double nu,double gamma=1, int ktype= CV_32F);</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>static Mat<span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>getPhase(Mat &amp;real,Mat &amp;imag);</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>static Mat<span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>getMagnitude(Mat &amp;real,Mat &amp;imag);</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>static void getFilterRealImagPart(Mat&amp; src,Mat&amp; real,Mat&amp; imag,Mat &amp;outReal,Mat &amp;outImag);</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>static Mat<span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>getFilterRealPart(Mat&amp; src,Mat&amp; real);</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>static Mat<span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>getFilterImagPart(Mat&amp; src,Mat&amp; imag);</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><br /></span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>void<span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;</span>Init(Size ksize=Size(19,19), double sigma=2*CV_PI,</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>double gamma=1, int ktype=CV_32FC1);</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px">private:</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>vector&lt;Mat&gt; gaborRealKernels;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>vector&lt;Mat&gt; gaborImagKernels;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>bool isInited;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px">&#125;;</span></span></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-family: Calibri; color: #3d3d3d"><span style="line-height: 25px"><br /><br /><br /></span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px">#include &quot;stdafx.h&quot;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px">#include &quot;GaborFR.h&quot;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px">GaborFR::GaborFR()</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px">&#123;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>isInited = false;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px">&#125;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px">void GaborFR::Init(Size ksize, double sigma,double gamma, int ktype)</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px">&#123;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>gaborRealKernels.clear();</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>gaborImagKernels.clear();</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>double mu[8]=&#123;0,1,2,3,4,5,6,7&#125;;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>double nu[5]=&#123;0,1,2,3,4&#125;;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>int i,j;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>for(i=0;i&lt;5;i++)</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>&#123;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;</span>for(j=0;j&lt;8;j++)</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;</span>&#123;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>gaborRealKernels.push_back(getRealGaborKernel(ksize,sigma,mu[j]*CV_PI/8,nu[i],gamma,ktype));</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>gaborImagKernels.push_back(getImagGaborKernel(ksize,sigma,mu[j]*CV_PI/8,nu[i],gamma,ktype));</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;</span>&#125;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>&#125;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>isInited = true;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px">&#125;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px">Mat GaborFR::getImagGaborKernel(Size ksize, double sigma, double theta, double nu,double gamma, int ktype)</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px">&#123;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>double<span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>sigma_x<span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;</span>= sigma;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>double<span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>sigma_y<span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;</span>= sigma/gamma;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>int<span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;</span>nstds<span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;</span>= 3;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>double<span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>kmax<span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;</span>= CV_PI/2;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>double<span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>f<span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>= cv::sqrt(2.0);</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>int xmin, xmax, ymin, ymax;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>double c = cos(theta), s = sin(theta);</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>if( ksize.width &gt; 0 )</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>&#123;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;</span>xmax = ksize.width/2;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>&#125;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>else//这个和matlab中的结果一样，默认都是19 !</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>&#123;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;</span>xmax = cvRound(std::max(fabs(nstds*sigma_x*c), fabs(nstds*sigma_y*s)));</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>&#125;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>if( ksize.height &gt; 0 )</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>&#123;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;</span>ymax = ksize.height/2;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>&#125;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>else</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>&#123;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;</span>ymax = cvRound(std::max(fabs(nstds*sigma_x*s), fabs(nstds*sigma_y*c)));</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>&#125;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>xmin = -xmax;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>ymin = -ymax;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>CV_Assert( ktype == CV_32F &#124;&#124; ktype == CV_64F );</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>float*<span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>pFloat;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>double*<span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>pDouble;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>Mat kernel(ymax - ymin + 1, xmax - xmin + 1, ktype);</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>double k<span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;</span>=<span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>kmax/pow(f,nu);</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>double scaleReal=<span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>k*k/sigma_x/sigma_y;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>for( int y = ymin; y &lt;= ymax; y++ )</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>&#123;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;</span>if( ktype == CV_32F )</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;</span>&#123;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pFloat = kernel.ptr&lt;float&gt;(ymax-y);</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;</span>&#125;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;</span>else</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;</span>&#123;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pDouble = kernel.ptr&lt;double&gt;(ymax-y);</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;</span>&#125;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;</span>for( int x = xmin; x &lt;= xmax; x++ )</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;</span>&#123;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>double xr = x*c + y*s;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>double v = scaleReal*exp(-(x*x+y*y)*scaleReal/2);</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>double temp=sin(k*xr);</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>v<span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>= &nbsp;temp*v;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if( ktype == CV_32F )</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>&#123;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pFloat[xmax - x]= (float)v;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>&#125;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>&#123;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pDouble[xmax - x] = v;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>&#125;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;</span>&#125;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>&#125;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>return kernel;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px">&#125;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px">//sigma一般为2*pi</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px">Mat GaborFR::getRealGaborKernel( Size ksize, double sigma, double theta,&nbsp;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>double nu,double gamma, int ktype)</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px">&#123;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>double<span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>sigma_x<span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;</span>= sigma;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>double<span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>sigma_y<span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;</span>= sigma/gamma;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>int<span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;</span>nstds<span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;</span>= 3;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>double<span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>kmax<span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;</span>= CV_PI/2;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>double<span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>f<span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>= cv::sqrt(2.0);</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>int xmin, xmax, ymin, ymax;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>double c = cos(theta), s = sin(theta);</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>if( ksize.width &gt; 0 )</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>&#123;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;</span>xmax = ksize.width/2;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>&#125;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>else//这个和matlab中的结果一样，默认都是19 !</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>&#123;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;</span>xmax = cvRound(std::max(fabs(nstds*sigma_x*c), fabs(nstds*sigma_y*s)));</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>&#125;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><br /></span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>if( ksize.height &gt; 0 )</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;</span>ymax = ksize.height/2;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>else</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;</span>ymax = cvRound(std::max(fabs(nstds*sigma_x*s), fabs(nstds*sigma_y*c)));</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>xmin = -xmax;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>ymin = -ymax;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>CV_Assert( ktype == CV_32F &#124;&#124; ktype == CV_64F );</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>float*<span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>pFloat;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>double*<span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>pDouble;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>Mat kernel(ymax - ymin + 1, xmax - xmin + 1, ktype);</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>double k<span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;</span>=<span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>kmax/pow(f,nu);</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>double exy<span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;</span>=<span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>sigma_x*sigma_y/2;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>double scaleReal=<span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>k*k/sigma_x/sigma_y;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>int<span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span> &nbsp; x,y;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>for( y = ymin; y &lt;= ymax; y++ )</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>&#123;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;</span>if( ktype == CV_32F )</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;</span>&#123;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pFloat = kernel.ptr&lt;float&gt;(ymax-y);</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;</span>&#125;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;</span>else</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;</span>&#123;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pDouble = kernel.ptr&lt;double&gt;(ymax-y);</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;</span>&#125;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;</span>for( x = xmin; x &lt;= xmax; x++ )</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;</span>&#123;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>double xr = x*c + y*s;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>double v = scaleReal*exp(-(x*x+y*y)*scaleReal/2);</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>double temp=cos(k*xr) - exp(-exy);</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>v<span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>=<span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>temp*v;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if( ktype == CV_32F )</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>&#123;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pFloat[xmax - x]= (float)v;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>&#125;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>&#123;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pDouble[xmax - x] = v;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>&#125;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;</span>&#125;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>&#125;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>return kernel;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px">&#125;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px">Mat GaborFR::getMagnitude(Mat &amp;real,Mat &amp;imag)</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px">&#123;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>CV_Assert(real.type()==imag.type());</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>CV_Assert(real.size()==imag.size());</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>int ktype=real.type();</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>int row = real.rows,col = real.cols;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>int i,j;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>float*<span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>pFloat,*pFloatR,*pFloatI;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>double*<span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>pDouble,*pDoubleR,*pDoubleI;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>Mat<span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;</span>kernel(row, col, real.type());</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>for(i=0;i&lt;row;i++)</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>&#123;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;</span>if( ktype == CV_32FC1 )</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;</span>&#123;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pFloat = kernel.ptr&lt;float&gt;(i);</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pFloatR= real.ptr&lt;float&gt;(i);</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pFloatI= imag.ptr&lt;float&gt;(i);</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;</span>&#125;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;</span>else</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;</span>&#123;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pDouble = kernel.ptr&lt;double&gt;(i);</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pDoubleR= real.ptr&lt;double&gt;(i);</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pDoubleI= imag.ptr&lt;double&gt;(i);</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;</span>&#125;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;</span>for(j=0;j&lt;col;j++)</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;</span>&#123;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if( ktype == CV_32FC1 )</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>&#123;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pFloat[j]= sqrt(pFloatI[j]*pFloatI[j]+pFloatR[j]*pFloatR[j]);</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>&#125;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>&#123;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pDouble[j] = sqrt(pDoubleI[j]*pDoubleI[j]+pDoubleR[j]*pDoubleR[j]);</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>&#125;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;</span>&#125;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>&#125;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>return kernel;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px">&#125;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px">Mat GaborFR::getPhase(Mat &amp;real,Mat &amp;imag)</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px">&#123;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>CV_Assert(real.type()==imag.type());</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>CV_Assert(real.size()==imag.size());</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>int ktype=real.type();</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>int row = real.rows,col = real.cols;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>int i,j;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>float*<span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>pFloat,*pFloatR,*pFloatI;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>double*<span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>pDouble,*pDoubleR,*pDoubleI;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>Mat<span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;</span>kernel(row, col, real.type());</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>for(i=0;i&lt;row;i++)</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>&#123;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;</span>if( ktype == CV_32FC1 )</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;</span>&#123;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pFloat = kernel.ptr&lt;float&gt;(i);</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pFloatR= real.ptr&lt;float&gt;(i);</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pFloatI= imag.ptr&lt;float&gt;(i);</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;</span>&#125;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;</span>else</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;</span>&#123;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pDouble = kernel.ptr&lt;double&gt;(i);</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pDoubleR= real.ptr&lt;double&gt;(i);</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pDoubleI= imag.ptr&lt;double&gt;(i);</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;</span>&#125;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;</span>for(j=0;j&lt;col;j++)</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;</span>&#123;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if( ktype == CV_32FC1 )</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>&#123;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px">// <span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if(pFloatI[j]/(pFloatR[j]+pFloatI[j]) &gt; 0.99)</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px">// <span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>&#123;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px">// <span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pFloat[j]=CV_PI/2;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px">// <span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>&#125;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px">// <span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px">// <span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>&#123;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px">//<span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pFloat[j] = atan(pFloatI[j]/pFloatR[j]);</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pFloat[j] = asin(pFloatI[j]/sqrt(pFloatR[j]*pFloatR[j]+pFloatI[j]*pFloatI[j]));</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px">/*<span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>&#125;*/</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px">//<span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pFloat[j] = atan2(pFloatI[j],pFloatR[j]);</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>&#125;//CV_32F</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>&#123;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if(pDoubleI[j]/(pDoubleR[j]+pDoubleI[j]) &gt; 0.99)</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>&#123;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pDouble[j]=CV_PI/2;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>&#125;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>&#123;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pDouble[j] = atan(pDoubleI[j]/pDoubleR[j]);</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>&#125;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px">//<span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pDouble[j]=atan2(pDoubleI[j],pDoubleR[j]);</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>&#125;//CV_64F</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;</span>&#125;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>&#125;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>return kernel;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px">&#125;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px">Mat GaborFR::getFilterRealPart(Mat&amp; src,Mat&amp; real)</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px">&#123;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>CV_Assert(real.type()==src.type());</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>Mat dst;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>Mat kernel;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>flip(real,kernel,-1);//中心镜面</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px">//<span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>filter2D(src,dst,CV_32F,kernel,Point(-1,-1),0,BORDER_CONSTANT);</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>filter2D(src,dst,CV_32F,kernel,Point(-1,-1),0,BORDER_REPLICATE);</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>return dst;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px">&#125;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px">Mat GaborFR::getFilterImagPart(Mat&amp; src,Mat&amp; imag)</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px">&#123;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>CV_Assert(imag.type()==src.type());</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>Mat dst;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>Mat kernel;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>flip(imag,kernel,-1);//中心镜面</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px">//<span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>filter2D(src,dst,CV_32F,kernel,Point(-1,-1),0,BORDER_CONSTANT);</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>filter2D(src,dst,CV_32F,kernel,Point(-1,-1),0,BORDER_REPLICATE);</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>return dst;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px">&#125;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px">void GaborFR::getFilterRealImagPart(Mat&amp; src,Mat&amp; real,Mat&amp; imag,Mat &amp;outReal,Mat &amp;outImag)</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px">&#123;</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>outReal=getFilterRealPart(src,real);</span></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>outImag=getFilterImagPart(src,imag);</span></span></p><p><span style="font-size: 14px; line-height: 25px"></span></p><p><span style="font-family: Calibri; color: #3d3d3d"><span style="font-size: 14px; line-height: 25px">&#125;</span></span></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px">main<br /></p><p><span style="font-family: Arial; color: #333333"><span style="font-size: 14px; line-height: 26px">// Win32TestPure.cpp : 定义控制台应用程序的入口点。</span></span></p><p><span style="font-family: Arial; color: #333333"><span style="font-size: 14px; line-height: 26px">#include &quot;stdafx.h&quot;</span></span></p><p><span style="font-family: Arial; color: #333333"><span style="font-size: 14px; line-height: 26px">#include &lt;vector&gt;</span></span></p><p><span style="font-family: Arial; color: #333333"><span style="font-size: 14px; line-height: 26px">#include &lt;deque&gt;</span></span></p><p><span style="font-family: Arial; color: #333333"><span style="font-size: 14px; line-height: 26px">#include &lt;iomanip&gt;</span></span></p><p><span style="font-family: Arial; color: #333333"><span style="font-size: 14px; line-height: 26px">#include &lt;stdexcept&gt;</span></span></p><p><span style="font-family: Arial; color: #333333"><span style="font-size: 14px; line-height: 26px">#include &lt;string&gt;</span></span></p><p><span style="font-family: Arial; color: #333333"><span style="font-size: 14px; line-height: 26px">#include &lt;iostream&gt;</span></span></p><p><span style="font-family: Arial; color: #333333"><span style="font-size: 14px; line-height: 26px">#include &lt;fstream&gt;</span></span></p><p><span style="font-family: Arial; color: #333333"><span style="font-size: 14px; line-height: 26px">#include &lt;direct.h&gt;//_mkdir()</span></span></p><p><span style="font-family: Arial; color: #333333"><span style="font-size: 14px; line-height: 26px">#include &quot;opencv2&#92;opencv.hpp&quot;</span></span></p><p><span style="font-family: Arial; color: #333333"><span style="font-size: 14px; line-height: 26px">#include &quot;GaborFR.h&quot;</span></span></p><p><span style="font-family: Arial; color: #333333"><span style="font-size: 14px; line-height: 26px">using namespace std;</span></span></p><p><span style="font-family: Arial; color: #333333"><span style="font-size: 14px; line-height: 26px">using namespace cv;</span></span></p><p><span style="font-family: Arial; color: #333333"><span style="font-size: 14px; line-height: 26px">int main()</span></span></p><p><span style="font-family: Arial; color: #333333"><span style="font-size: 14px; line-height: 26px">&#123;&nbsp;</span></span></p><p><span style="font-family: Arial; color: #333333"><span style="font-size: 14px; line-height: 26px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>//Mat M = getGaborKernel(Size(9,9),2*CV_PI,u*CV_PI/8, 2*CV_PI/pow(2,CV_PI*(v+2)/2),1,0);</span></span></p><p><span style="font-family: Arial; color: #333333"><span style="font-size: 14px; line-height: 26px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>Mat saveM;</span></span></p><p><span style="font-family: Arial; color: #333333"><span style="font-size: 14px; line-height: 26px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>//s8-4</span></span></p><p><span style="font-family: Arial; color: #333333"><span style="font-size: 14px; line-height: 26px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>//s1-5</span></span></p><p><span style="font-family: Arial; color: #333333"><span style="font-size: 14px; line-height: 26px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>//s1中年男人</span></span></p><p><span style="font-family: Arial; color: #333333"><span style="font-size: 14px; line-height: 26px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>Mat I=imread(&quot;H:&#92;&#92;pic&#92;&#92;s1-5.bmp&quot;,-1);</span></span></p><p><span style="font-family: Arial; color: #333333"><span style="font-size: 14px; line-height: 26px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>normalize(I,I,1,0,CV_MINMAX,CV_32F);</span></span></p><p><span style="font-family: Arial; color: #333333"><span style="font-size: 14px; line-height: 26px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>Mat showM,showMM;Mat M,MatTemp1,MatTemp2;</span></span></p><p><span style="font-family: Arial; color: #333333"><span style="font-size: 14px; line-height: 26px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>Mat line;</span></span></p><p><span style="font-family: Arial; color: #333333"><span style="font-size: 14px; line-height: 26px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>int iSize=50;//如果数值比较大，比如50则接近论文中所述的情况了！估计大小和处理的源图像一样！</span></span></p><p><span style="font-family: Arial; color: #333333"><span style="font-size: 14px; line-height: 26px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>for(int i=0;i&lt;8;i++)</span></span></p><p><span style="font-family: Arial; color: #333333"><span style="font-size: 14px; line-height: 26px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>&#123;</span></span></p><p><span style="font-family: Arial; color: #333333"><span style="font-size: 14px; line-height: 26px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;</span>showM.release();</span></span></p><p><span style="font-family: Arial; color: #333333"><span style="font-size: 14px; line-height: 26px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;</span>for(int j=0;j&lt;5;j++)</span></span></p><p><span style="font-family: Arial; color: #333333"><span style="font-size: 14px; line-height: 26px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;</span>&#123;</span></span></p><p><span style="font-family: Arial; color: #333333"><span style="font-size: 14px; line-height: 26px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>Mat M1= GaborFR::getRealGaborKernel(Size(iSize,iSize),2*CV_PI,i*CV_PI/8+CV_PI/2, j,1);</span></span></p><p><span style="font-family: Arial; color: #333333"><span style="font-size: 14px; line-height: 26px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>Mat M2 = GaborFR::getImagGaborKernel(Size(iSize,iSize),2*CV_PI,i*CV_PI/8+CV_PI/2, j,1);</span></span></p><p><span style="font-family: Arial; color: #333333"><span style="font-size: 14px; line-height: 26px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>//加了CV_PI/2才和大部分文献的图形一样，不知道为什么！</span></span></p><p><span style="font-family: Arial; color: #333333"><span style="font-size: 14px; line-height: 26px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>Mat outR,outI;</span></span></p><p><span style="font-family: Arial; color: #333333"><span style="font-size: 14px; line-height: 26px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>GaborFR::getFilterRealImagPart(I,M1,M2,outR,outI);</span></span></p><p><span style="font-family: Arial; color: #333333"><span style="font-size: 14px; line-height: 26px">//<span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>M=GaborFR::getPhase(M1,M2);</span></span></p><p><span style="font-family: Arial; color: #333333"><span style="font-size: 14px; line-height: 26px">//<span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>M=GaborFR::getMagnitude(M1,M2);</span></span></p><p><span style="font-family: Arial; color: #333333"><span style="font-size: 14px; line-height: 26px">//<span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>M=GaborFR::getPhase(outR,outI);</span></span></p><p><span style="font-family: Arial; color: #333333"><span style="font-size: 14px; line-height: 26px">//<span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>M=GaborFR::getMagnitude(outR,outI);</span></span></p><p><span style="font-family: Arial; color: #333333"><span style="font-size: 14px; line-height: 26px">&nbsp;//<span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>M=GaborFR::getMagnitude(outR,outI);</span></span></p><p><span style="font-family: Arial; color: #333333"><span style="font-size: 14px; line-height: 26px">// <span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>MatTemp2=GaborFR::getPhase(outR,outI);</span></span></p><p><span style="font-family: Arial; color: #333333"><span style="font-size: 14px; line-height: 26px">// <span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>M=outR;</span></span></p><p><span style="font-family: Arial; color: #333333"><span style="font-size: 14px; line-height: 26px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> M=M1;</span></span></p><p><span style="font-family: Arial; color: #333333"><span style="font-size: 14px; line-height: 26px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>// <span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;</span>resize(M,M,Size(100,100));</span></span></p><p><span style="font-family: Arial; color: #333333"><span style="font-size: 14px; line-height: 26px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>normalize(M,M,0,255,CV_MINMAX,CV_8U);</span></span></p><p><span style="font-family: Arial; color: #333333"><span style="font-size: 14px; line-height: 26px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>showM.push_back(M);</span></span></p><p><span style="font-family: Arial; color: #333333"><span style="font-size: 14px; line-height: 26px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>line=Mat::ones(4,M.cols,M.type())*255;</span></span></p><p><span style="font-family: Arial; color: #333333"><span style="font-size: 14px; line-height: 26px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>showM.push_back(line);</span></span></p><p><span style="font-family: Arial; color: #333333"><span style="font-size: 14px; line-height: 26px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;</span>&#125;</span></span></p><p><span style="font-family: Arial; color: #333333"><span style="font-size: 14px; line-height: 26px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;</span>showM=showM.t();</span></span></p><p><span style="font-family: Arial; color: #333333"><span style="font-size: 14px; line-height: 26px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;</span>line=Mat::ones(4,showM.cols,showM.type())*255;</span></span></p><p><span style="font-family: Arial; color: #333333"><span style="font-size: 14px; line-height: 26px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;</span>showMM.push_back(showM);</span></span></p><p><span style="font-family: Arial; color: #333333"><span style="font-size: 14px; line-height: 26px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;&nbsp;&nbsp;</span>showMM.push_back(line);</span></span></p><p><span style="font-family: Arial; color: #333333"><span style="font-size: 14px; line-height: 26px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>&#125;</span></span></p><p><span style="font-family: Arial; color: #333333"><span style="font-size: 14px; line-height: 26px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>showMM=showMM.t();</span></span></p><p><span style="font-family: Arial; color: #333333"><span style="font-size: 14px; line-height: 26px">//<span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>bool flag=imwrite(&quot;H:&#92;&#92;out.bmp&quot;,showMM);</span></span></p><p><span style="font-family: Arial; color: #333333"><span style="font-size: 14px; line-height: 26px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>imshow(&quot;saveMM&quot;,showMM);waitKey(0);</span></span></p><p><span style="font-family: Arial; color: #333333"><span style="font-size: 14px; line-height: 26px"><span style="white-space: pre" class="Apple-tab-span">&nbsp;&nbsp;</span>return 0;</span></span></p><p><span style="font-family: Arial; color: #333333"><span style="font-size: 14px; line-height: 26px">&#125;//endof &nbsp; main()</span></span></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px">以下图片可能和程序实际运行结果有点不同，图片只是示意图，代码暂时没问题。需要考虑的是iSize大小问题，首先iSize要用奇数，然后大部分文献iSize都比较大，好像是100左右，但没看到他们描述过卷积核的大小。</p>
]]>
</description>
</item>
</channel>
</rss>