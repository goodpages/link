<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0">
<channel>
<title><![CDATA[流浪的龙－个人知识管理]]></title> 
<link>http://i.renjihe.com/blog/index.php</link> 
<description><![CDATA[]]></description> 
<language>zh-cn</language> 
<copyright><![CDATA[流浪的龙－个人知识管理]]></copyright>
<item>
<link>http://i.renjihe.com/blog/read.php?7448</link>
<title><![CDATA[JSX在React-Native中的应用]]></title> 
<author>renjihe1988 &lt;admin@yourname.com&gt;</author>
<category><![CDATA[Android]]></category>
<pubDate>Tue, 02 Aug 2016 09:12:50 +0000</pubDate> 
<guid>http://i.renjihe.com/blog/read.php?7448</guid> 
<description>
<![CDATA[ 
	<h2 style="margin: 0px 0px 0.5em; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; line-height: 1.6em; color: #333333; text-rendering: optimizeLegibility; font-size: 18px; text-indent: 1em; background-color: #fefefe">React-Native入门指南</h2><h2 style="margin: 0px 0px 0.5em; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; line-height: 1.6em; color: #333333; text-rendering: optimizeLegibility; font-size: 18px; text-indent: 1em; background-color: #fefefe">github:&nbsp;<a style="color: #949494; text-decoration: none; transition: 0.25s; outline: none 0px; border-bottom-width: 1px; border-bottom-style: dashed; border-bottom-color: #949494; font-style: italic" rel="nofollow,noindex" href="https://github.com/vczero/react-native-lession" target="_blank">https://github.com/vczero/react-native-lession</a></h2><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">React-Native:用JavaScript开发你的原生应用，释放Native的UI体验，体验 Hybird开发效率。</p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe"><img style="max-width: 96%; height: auto; vertical-align: middle; border: 0px none; margin: 0px auto 10px; text-align: center; display: block" class="alignCenter" src="http://img1.tuicool.com/bIzEZvb.png!web" border="0" /></p><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">最近一个星期写的文章如下，链接是github page的，其实也可以在系列博客找到相应文章：</p><ul style="padding: 0px; margin: 0px 0px 0.75em 25px; list-style-type: none; font-size: 16px; line-height: 27.2px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe"><li style="line-height: 1.7em; list-style-type: disc"><a style="color: #949494; text-decoration: none; transition: 0.25s; outline: none 0px; border-bottom-width: 1px; border-bottom-style: dashed; border-bottom-color: #949494; font-style: italic; font-weight: bold" rel="nofollow,noindex" href="http://vczero.github.io/react_native/%E7%AC%AC1%E7%AF%87hello%20react-native.html">Lession1: Hello React-Native</a></li><li style="line-height: 1.7em; list-style-type: disc"><a style="color: #949494; text-decoration: none; transition: 0.25s; outline: none 0px; border-bottom-width: 1px; border-bottom-style: dashed; border-bottom-color: #949494; font-style: italic; font-weight: bold" rel="nofollow,noindex" href="http://vczero.github.io/react_native/%E7%AC%AC2%E7%AF%87%E8%AE%A4%E8%AF%86%E4%BB%A3%E7%A0%81%E7%BB%93%E6%9E%84.html">Lession2: 认识代码结构</a></li><li style="line-height: 1.7em; list-style-type: disc"><a style="color: #949494; text-decoration: none; transition: 0.25s; outline: none 0px; border-bottom-width: 1px; border-bottom-style: dashed; border-bottom-color: #949494; font-style: italic; font-weight: bold" rel="nofollow,noindex" href="http://vczero.github.io/react_native/%E7%AC%AC3%E7%AF%87css%E5%92%8C%E5%B8%83%E5%B1%80.html">Lession3: css和布局</a></li><li style="line-height: 1.7em; list-style-type: disc"><a style="color: #949494; text-decoration: none; transition: 0.25s; outline: none 0px; border-bottom-width: 1px; border-bottom-style: dashed; border-bottom-color: #949494; font-style: italic; font-weight: bold" rel="nofollow,noindex" href="http://vczero.github.io/react_native/%E7%AC%AC4%E7%AF%87%E5%AD%A6%E4%BC%9Areact-native%E5%B8%83%E5%B1%80.html">Lession4: 学会React-Native布局（一）</a></li><li style="line-height: 1.7em; list-style-type: disc"><a style="color: #949494; text-decoration: none; transition: 0.25s; outline: none 0px; border-bottom-width: 1px; border-bottom-style: dashed; border-bottom-color: #949494; font-style: italic; font-weight: bold" rel="nofollow,noindex" href="http://vczero.github.io/react_native/%E7%AC%AC4%E7%AF%87react-native%E5%B8%83%E5%B1%80%E5%AE%9E%E6%88%98%EF%BC%88%E4%BA%8C%EF%BC%89.html">Lession5: 学会React-Native布局(二)</a></li><li style="line-height: 1.7em; list-style-type: disc"><a style="color: #949494; text-decoration: none; transition: 0.25s; outline: none 0px; border-bottom-width: 1px; border-bottom-style: dashed; border-bottom-color: #949494; font-style: italic; font-weight: bold" rel="nofollow,noindex" href="http://vczero.github.io/react_native/%E7%AC%AC5%E7%AF%87ui%E7%BB%84%E4%BB%B6.html">Lession6: UI组件</a></li><li style="line-height: 1.7em; list-style-type: disc"><a style="color: #949494; text-decoration: none; transition: 0.25s; outline: none 0px; border-bottom-width: 1px; border-bottom-style: dashed; border-bottom-color: #949494; font-style: italic; font-weight: bold" rel="nofollow,noindex" href="http://vczero.github.io/react_native/%E7%AC%AC6%E7%AF%87jsx%E5%9C%A8react-native%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8.html">Lession7: JSX在React-Native中的应用</a></li></ul><p style="margin: 0px 0px 0.75em; font-size: 16px; line-height: 27.2px; text-indent: 1em; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe">还有几篇会时刻更新：</p><ul style="padding: 0px; margin: 0px 0px 0.75em 25px; list-style-type: none; font-size: 16px; line-height: 27.2px; color: #333333; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; background-color: #fefefe"><li style="line-height: 1.7em; list-style-type: disc"><a style="color: #949494; text-decoration: none; transition: 0.25s; outline: none 0px; border-bottom-width: 1px; border-bottom-style: dashed; border-bottom-color: #949494; font-style: italic; font-weight: bold" rel="nofollow,noindex" href="https://github.com/vczero/react-native-lession/blob/master">Lession8: 自己动手写组件</a></li><li style="line-height: 1.7em; list-style-type: disc"><a style="color: #949494; text-decoration: none; transition: 0.25s; outline: none 0px; border-bottom-width: 1px; border-bottom-style: dashed; border-bottom-color: #949494; font-style: italic; font-weight: bold" rel="nofollow,noindex" href="https://github.com/vczero/react-native-lession/blob/master">Lession9: 模块化开发</a></li><li style="line-height: 1.7em; list-style-type: disc"><a style="color: #949494; text-decoration: none; transition: 0.25s; outline: none 0px; border-bottom-width: 1px; border-bottom-style: dashed; border-bottom-color: #949494; font-style: italic; font-weight: bold" rel="nofollow,noindex" href="https://github.com/vczero/react-native-lession/blob/master">Lession10: 搭建项目架构</a></li><li style="line-height: 1.7em; list-style-type: disc"><a style="color: #949494; text-decoration: none; transition: 0.25s; outline: none 0px; border-bottom-width: 1px; border-bottom-style: dashed; border-bottom-color: #949494; font-style: italic; font-weight: bold" rel="nofollow,noindex" href="https://github.com/vczero/react-native-lession/blob/master">Lession11: 源码分析</a></li></ul><h2 style="margin: 0px 0px 0.5em; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; line-height: 1.6em; color: #333333; text-rendering: optimizeLegibility; font-size: 18px; text-indent: 1em; background-color: #fefefe">第六篇JSX在React-Native中的应用</h2><h3 style="margin: 0px 0px 0.5em; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; line-height: 1.6em; color: #333333; text-rendering: optimizeLegibility; font-size: 18px; text-indent: 1em; background-color: #fefefe">一、JSX概述</h3><pre class="prettyprint undefined" style="padding: 0.3em; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; color: #333333; border-radius: 4px; margin-top: 0px; margin-bottom: 1.5em; font-size: 12px; line-height: 1.5em; word-break: break-all; word-wrap: break-word; white-space: pre-wrap; border: 1px solid rgba(0, 0, 0, 0.14902); overflow-y: auto; background-color: #f6f6f6">你一定疑问为什么要用JSX？其实这不是必需，而是建议。只是因为React是作为MVC中的V,是为UI而生，所以，React-Native使用JSX更能像HTML样表达树形结构，其实HTML的超类就是XML,React-Native将这个带到了解放前，不可否认的是JSX相比节省了很多的代码。JSX不是什么新奇的东西，JSX只是对JavaScript进行了拓展，仅此而已。 </pre><h3 style="margin: 0px 0px 0.5em; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; line-height: 1.6em; color: #333333; text-rendering: optimizeLegibility; font-size: 18px; text-indent: 1em; background-color: #fefefe">二、语法介绍</h3><pre class="undefined" style="padding: 0.3em; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; color: #333333; border-radius: 4px; margin-top: 0px; margin-bottom: 0.75em; font-size: 12px; line-height: 1.5em; word-break: break-all; word-wrap: break-word; white-space: pre-wrap; border: 1px solid rgba(0, 0, 0, 0.14902); overflow-y: auto; background-color: #f6f6f6">1、类XML UI组件表达，在React-Native中表现为：</pre><pre class="prettyprint javascript" style="padding: 0.3em; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; color: #333333; border-radius: 4px; margin-top: 0px; margin-bottom: 1.5em; font-size: 12px; line-height: 1.5em; word-break: break-all; word-wrap: break-word; white-space: pre-wrap; border: 1px solid rgba(0, 0, 0, 0.14902); overflow-y: auto; background-color: #f6f6f6">render: <span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">function</span></span><span style="color: #000000">() &#123; <span class="indent">&nbsp;&nbsp;</span></span><span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">return</span></span><span style="color: #000000"> ( <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span></span><span class="xml"><span style="color: #000080" class="tag">&lt;<span class="title">View</span> <span style="color: #008080" class="attribute">style</span>=<span style="color: #dd1144" class="value">&#123;styles.container&#125;</span>&gt;</span> <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span style="color: #000080" class="tag">&lt;<span class="title">Text</span> <span style="color: #008080" class="attribute">style</span>=<span style="color: #dd1144" class="value">&#123;styles.welcome&#125;</span>&gt;</span><span style="color: #000000"> <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span>Welcome to React Native</span>! <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span style="color: #000080" class="tag">&lt;/<span class="title">Text</span>&gt;</span> <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span style="color: #000080" class="tag">&lt;/<span class="title">View</span>&gt;</span> <span style="color: #000000"><span class="indent">&nbsp;&nbsp;</span>); &#125;</span> </span></pre><pre class="undefined" style="padding: 0.3em; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; color: #333333; border-radius: 4px; margin-top: 0px; margin-bottom: 0.75em; font-size: 12px; line-height: 1.5em; word-break: break-all; word-wrap: break-word; white-space: pre-wrap; border: 1px solid rgba(0, 0, 0, 0.14902); overflow-y: auto; background-color: #f6f6f6"> 2、js表达式 在JSX中，表达式需要｛｝包裹，例如：</pre><pre class="prettyprint javascript" style="padding: 0.3em; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; color: #333333; border-radius: 4px; margin-top: 0px; margin-bottom: 1.5em; font-size: 12px; line-height: 1.5em; word-break: break-all; word-wrap: break-word; white-space: pre-wrap; border: 1px solid rgba(0, 0, 0, 0.14902); overflow-y: auto; background-color: #f6f6f6">render: <span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">function</span></span><span style="color: #000000">() &#123; <span class="indent">&nbsp;&nbsp;</span></span><span style="color: #0000ff"><span style="font-weight: bold; color: #333333" class="keyword">return</span></span><span style="color: #000000"> ( <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span></span><span class="xml"><span style="color: #000080" class="tag">&lt;<span class="title">View</span> <span style="color: #008080" class="attribute">style</span>=<span style="color: #dd1144" class="value">&#123;styles.container&#125;</span>&gt;</span> <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span style="color: #000080" class="tag">&lt;<span class="title">Text</span> <span style="color: #008080" class="attribute">style</span>=<span style="color: #dd1144" class="value">&#123;styles.welcome&#125;</span>&gt;</span><span style="color: #000000"> <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span>&#123;</span>0? '第一段': '第二段'<span style="color: #000000">&#125; <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span></span><span style="color: #000080" class="tag">&lt;/<span class="title">Text</span>&gt;</span> <span class="indent">&nbsp;&nbsp;</span><span class="indent">&nbsp;&nbsp;</span><span style="color: #000080" class="tag">&lt;/<span class="title">View</span>&gt;</span> <span style="color: #000000"><span class="indent">&nbsp;&nbsp;</span>); &#125;</span> </span></pre><pre class="prettyprint css" style="padding: 0.3em; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; color: #333333; border-radius: 4px; margin-top: 0px; margin-bottom: 1.5em; font-size: 12px; line-height: 1.5em; word-break: break-all; word-wrap: break-word; white-space: pre-wrap; border: 1px solid rgba(0, 0, 0, 0.14902); overflow-y: auto; background-color: #f6f6f6"> 上面的代码我们可以看出，<span style="color: #000080" class="tag">style</span>＝｛｝是一个表达式；<span class="rules">&#123;<span class="rule">0? '第一段': '第二段'&#125;</span></span>是表达式，最后显示的应该是&ldquo;第二段&rdquo;。&nbsp;&nbsp;3、属性</pre><pre class="prettyprint xml" style="padding: 0.3em; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; color: #333333; border-radius: 4px; margin-top: 0px; margin-bottom: 1.5em; font-size: 12px; line-height: 1.5em; word-break: break-all; word-wrap: break-word; white-space: pre-wrap; border: 1px solid rgba(0, 0, 0, 0.14902); overflow-y: auto; background-color: #f6f6f6">在HTML中，属性可以是任何值，例如：<span style="color: #000080" class="tag">&lt;<span class="title">div</span> <span style="color: #008080" class="attribute">tagid</span>=<span style="color: #dd1144" class="value">&quot;00_1&quot;</span>&gt;</span><span style="color: #000080" class="tag">&lt;/<span class="title">div</span>&gt;</span>,tagid就是属性；同样，在组件上可以使用属性。 <span style="color: #000000">建议使用以下方式： </span><span style="color: #0000ff">var</span> props =<span style="color: #000000"> &#123;&nbsp;&nbsp;&nbsp;&nbsp; tagid: </span>'GGFSJGFFATQ'<span style="color: #000000">,&nbsp;&nbsp;&nbsp;&nbsp; poiname: </span>'东方明珠'<span style="color: #000000"> &#125;; </span><span style="color: #0000ff">return</span> (<span style="color: #000080" class="tag">&lt;<span class="title">View</span> &#123;<span style="color: #008080" class="attribute">...props</span>&#125;&gt;</span><span style="color: #000080" class="tag">&lt;/<span class="title">View</span>&gt;</span>);</pre><pre class="prettyprint xml" style="padding: 0.3em; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; color: #333333; border-radius: 4px; margin-top: 0px; margin-bottom: 1.5em; font-size: 12px; line-height: 1.5em; word-break: break-all; word-wrap: break-word; white-space: pre-wrap; border: 1px solid rgba(0, 0, 0, 0.14902); overflow-y: auto; background-color: #f6f6f6"> 4、如果需要在调用组件的时候动态增加或者覆盖属性，又该如何呢？ 很简单：<span style="color: #000080" class="tag">&lt;<span class="title">View</span> &#123;<span style="color: #008080" class="attribute">...props</span>&#125; <span style="color: #008080" class="attribute">poiname</span>=<span style="color: #dd1144" class="value">&#123;'虹桥机场'&#125;</span>&gt;</span><span style="color: #000080" class="tag">&lt;/<span class="title">View</span>&gt;</span>&nbsp;&nbsp;5、关于样式</pre><pre class="prettyprint xml" style="padding: 0.3em; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; color: #333333; border-radius: 4px; margin-top: 0px; margin-bottom: 1.5em; font-size: 12px; line-height: 1.5em; word-break: break-all; word-wrap: break-word; white-space: pre-wrap; border: 1px solid rgba(0, 0, 0, 0.14902); overflow-y: auto; background-color: #f6f6f6">（1<span style="color: #000000">）普通内联样式:&#123;&#123;&#125;&#125;,第一层｛｝是表达式，第二层｛｝是js对象； </span><span style="color: #000080" class="tag">&lt;<span class="title">View</span> <span style="color: #008080" class="attribute">style</span>=<span style="color: #dd1144" class="value">&#123;&#123;fontSize:40,</span> <span style="color: #008080" class="attribute">width:80</span>,&#125;&#125;&gt;</span> <span style="color: #000080" class="tag">&lt;/<span class="title">View</span>&gt;</span> （2<span style="color: #000000">）调用样式表:&#123;样式类.属性&#125; </span><span style="color: #000080" class="tag">&lt;<span class="title">View</span> <span style="color: #008080" class="attribute">style</span>=<span style="color: #dd1144" class="value">&#123;styles.container&#125;</span>&gt;</span><span style="color: #000080" class="tag">&lt;/<span class="title">View</span>&gt;</span> （3<span style="color: #000000">）样式表和内联样式共存:&#123;[]&#125; </span><span style="color: #000080" class="tag">&lt;<span class="title">View</span> <span style="color: #008080" class="attribute">style</span>=<span style="color: #dd1144" class="value">&#123;[styles.container,</span> &#123;<span style="color: #008080" class="attribute">fontSize:40</span>, <span style="color: #008080" class="attribute">width:80</span>&#125;]&#125;&gt;</span><span style="color: #000000"> （</span>4<span style="color: #000000">）多个样式表:&#123;[样式类1， 样式类2]&#125; </span><span style="color: #000080" class="tag">&lt;<span class="title">View</span> <span style="color: #008080" class="attribute">style</span>=<span style="color: #dd1144" class="value">&#123;[styles.container,</span> <span style="color: #008080" class="attribute">styles.color</span>]&#125;&gt;</span></pre><pre class="prettyprint undefined" style="padding: 0.3em; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; color: #333333; border-radius: 4px; margin-top: 0px; margin-bottom: 1.5em; font-size: 12px; line-height: 1.5em; word-break: break-all; word-wrap: break-word; white-space: pre-wrap; border: 1px solid rgba(0, 0, 0, 0.14902); overflow-y: auto; background-color: #f6f6f6"> 6、属性校验 为了实现强类型语言的效果，我们可以使用propTypes来声明数据属性的合法性校验。例如：</pre><pre class="prettyprint css" style="padding: 0.3em; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; color: #333333; border-radius: 4px; margin-top: 0px; margin-bottom: 1.5em; font-size: 12px; line-height: 1.5em; word-break: break-all; word-wrap: break-word; white-space: pre-wrap; border: 1px solid rgba(0, 0, 0, 0.14902); overflow-y: auto; background-color: #f6f6f6"><span style="color: #000000"><span style="color: #000080" class="tag">React</span><span style="font-weight: bold; color: #445588" class="class">.createClass</span>(<span class="rules">&#123;&nbsp;&nbsp;&nbsp;&nbsp; <span class="rule"><span style="color: #008080" class="attribute">porpTypes</span>:<span class="value">&#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; username: React.PropTypes.string,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; age: React.propTypes.number,&nbsp;&nbsp;&nbsp;&nbsp; &#125;</span></span></span> &#125;);</span></pre><pre class="http" style="padding: 0.3em; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; color: #333333; border-radius: 4px; margin-top: 0px; margin-bottom: 0.75em; font-size: 12px; line-height: 1.5em; word-break: break-all; word-wrap: break-word; white-space: pre-wrap; border: 1px solid rgba(0, 0, 0, 0.14902); overflow-y: auto; background-color: #f6f6f6"><span style="color: #008080" class="attribute">7、设定默认属性</span></pre><pre class="prettyprint css" style="padding: 0.3em; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; color: #333333; border-radius: 4px; margin-top: 0px; margin-bottom: 1.5em; font-size: 12px; line-height: 1.5em; word-break: break-all; word-wrap: break-word; white-space: pre-wrap; border: 1px solid rgba(0, 0, 0, 0.14902); overflow-y: auto; background-color: #f6f6f6"><span style="color: #000000"><span style="color: #000080" class="tag">React</span><span style="font-weight: bold; color: #445588" class="class">.createClass</span>(<span class="rules">&#123;&nbsp;&nbsp;&nbsp;&nbsp; <span class="rule"><span style="color: #008080" class="attribute">getDefaultProps</span>:<span class="value"> </span></span></span></span><span class="rules"><span class="rule"><span class="value"><span style="color: #0000ff"><span class="function">function</span></span><span class="function"><span style="color: #000000">()</span></span><span style="color: #000000">&#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #0000ff">return</span><span style="color: #000000"> &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sign: </span><span style="color: #dd1144" class="string">'这个家伙很懒，什么都没留下'</span><span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125;</span></span></span></span><span style="color: #000000">;&nbsp;&nbsp;&nbsp;&nbsp; &#125; &#125;);</span></pre><pre class="prettyprint undefined" style="padding: 0.3em; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; color: #333333; border-radius: 4px; margin-top: 0px; margin-bottom: 1.5em; font-size: 12px; line-height: 1.5em; word-break: break-all; word-wrap: break-word; white-space: pre-wrap; border: 1px solid rgba(0, 0, 0, 0.14902); overflow-y: auto; background-color: #f6f6f6">8、组件的生命周期 componentWillMount：组件创建之前 getInitialState：初始化状态 render：渲染视图 componentDidMount：渲染视图完成后 componentWillUnmount：组件被卸载之前 </pre><h3 style="margin: 0px 0px 0.5em; font-family: 'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif; line-height: 1.6em; color: #333333; text-rendering: optimizeLegibility; font-size: 18px; text-indent: 1em; background-color: #fefefe">三、了解虚拟DOM</h3><pre class="prettyprint undefined" style="padding: 0.3em; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; color: #333333; border-radius: 4px; margin-top: 0px; margin-bottom: 1.5em; font-size: 12px; line-height: 1.5em; word-break: break-all; word-wrap: break-word; white-space: pre-wrap; border: 1px solid rgba(0, 0, 0, 0.14902); overflow-y: auto; background-color: #f6f6f6">React进行了虚拟DOM的封装，所有的视图的更新都是虚拟DOM做了一个校验（diff）后最小更新。为什么这么做，因为现在机器的内存已经足以支撑这样视图UI的diff计算，用内存计算换取UI渲染效率。&nbsp;&nbsp;1、我们需要获取组件中真实的dom React.findDOMNode(component)&nbsp;&nbsp;2、第二节已经简单说了组件的生命周期（will, did） 组件的生命周期分为3个部分： Mounting：正在装载组件； Updating：重新计算渲染组件； Unmounting：卸载组件</pre>
]]>
</description>
</item><item>
<link>http://i.renjihe.com/blog/read.php?7419</link>
<title><![CDATA[消息推送BroadcastReceiver，点击通知打开两次Activity问题]]></title> 
<author>renjihe1988 &lt;admin@yourname.com&gt;</author>
<category><![CDATA[Android]]></category>
<pubDate>Tue, 26 Jul 2016 11:14:47 +0000</pubDate> 
<guid>http://i.renjihe.com/blog/read.php?7419</guid> 
<description>
<![CDATA[ 
	<span style="font-size: 14px; line-height: 26px; font-family: Arial">Android开发中，通常会使用BroadcastReceiver来接受Push推送消息。当APP收到推送通知时，我们需要在通知的点击事件中加入自己的逻辑。比如跳转到MainActivity。</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial">比如下面的代码（注意红色部分）：</span><br /><div class="dp-highlighter bg_java" style="font-family: Consolas, 'Courier New', Courier, mono, serif; width: 936.531px; overflow-y: hidden; overflow-x: auto; padding-top: 1px; position: relative; line-height: 26px; margin: 18px 0px !important; background-color: #e7e5dc"><div class="bar" style="padding-left: 45px"><div class="tools" style="padding: 3px 8px 10px 10px; font-stretch: normal; font-size: 9px; line-height: normal; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; color: silver; border-left-width: 3px; border-left-style: solid; border-left-color: #999999; background-color: #f8f8f8"><strong>[java]</strong>&nbsp;<a style="color: #a0a0a0; text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial" href="http://blog.csdn.net/withiter/article/details/30476283#" title="view plain" class="ViewSource">view plain</a><span>&nbsp;<a style="color: #a0a0a0; text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial" href="http://blog.csdn.net/withiter/article/details/30476283#" title="copy" class="CopyToClipboard">copy</a></span><span>&nbsp;<a style="color: #a0a0a0; text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial" href="http://blog.csdn.net/withiter/article/details/30476283#" title="print" class="PrintSource">print</a></span><a style="color: #a0a0a0; text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial" href="http://blog.csdn.net/withiter/article/details/30476283#" title="?" class="About">?</a><span class="tracking-ad"><a style="color: #a0a0a0; text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial" href="https://code.csdn.net/snippets/390813" target="_blank" title="在CODE上查看代码片"><img style="border: none; max-width: 100%; position: relative; top: 1px; left: 2px" src="https://code.csdn.net/assets/CODE_ico.png" border="0" alt="在CODE上查看代码片" width="12" height="12" /></a></span><span class="tracking-ad"><a style="color: #a0a0a0; text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial" href="https://code.csdn.net/snippets/390813/fork" target="_blank" title="派生到我的代码片"><img style="border: none; max-width: 100%; position: relative; top: 2px; left: 2px" src="https://code.csdn.net/assets/ico_fork.svg" border="0" alt="派生到我的代码片" width="12" height="12" /></a></span></div></div><ol class="dp-j" style="padding: 0px; border: none; color: #5c5c5c; margin: 0px 0px 1px 45px !important; background-color: #ffffff"><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #999999; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: blue; background-color: inherit" class="keyword">public</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: blue; background-color: inherit" class="keyword">void</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;onReceive(Context&nbsp;context,&nbsp;Intent&nbsp;intent)&nbsp;&#123;&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #999999; list-style: decimal-leading-zero outside; color: #555555; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Bundle&nbsp;bundle&nbsp;=&nbsp;intent.getExtras();&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #999999; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: blue; background-color: inherit" class="keyword">if</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;(JPushInterface.ACTION_REGISTRATION_ID.equals(intent.getAction()))&nbsp;&#123;&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #999999; list-style: decimal-leading-zero outside; color: #555555; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;regId&nbsp;=&nbsp;bundle.getString(JPushInterface.EXTRA_REGISTRATION_ID);&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #999999; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Log.d(TAG,&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: red; background-color: inherit" class="string">&quot;[JPushReceiver]&nbsp;接收Registration&nbsp;Id&nbsp;:&nbsp;&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;+&nbsp;regId);&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #999999; list-style: decimal-leading-zero outside; color: #555555; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">//send&nbsp;the&nbsp;Registration&nbsp;Id&nbsp;to&nbsp;your&nbsp;server...</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #999999; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #999999; list-style: decimal-leading-zero outside; color: #555555; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: blue; background-color: inherit" class="keyword">else</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: blue; background-color: inherit" class="keyword">if</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;(JPushInterface.ACTION_MESSAGE_RECEIVED.equals(intent.getAction()))&nbsp;&#123;&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #999999; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Log.d(TAG,&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: red; background-color: inherit" class="string">&quot;[JPushReceiver]&nbsp;接收到推送下来的自定义消息:&nbsp;&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;+&nbsp;bundle.getString(JPushInterface.EXTRA_MESSAGE));&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #999999; list-style: decimal-leading-zero outside; color: #555555; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #999999; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: blue; background-color: inherit" class="keyword">else</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: blue; background-color: inherit" class="keyword">if</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;(JPushInterface.ACTION_NOTIFICATION_RECEIVED.equals(intent.getAction()))&nbsp;&#123;&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #999999; list-style: decimal-leading-zero outside; color: #555555; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Log.d(TAG,&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: red; background-color: inherit" class="string">&quot;[JPushReceiver]&nbsp;接收到推送下来的通知&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">);&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #999999; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: blue; background-color: inherit" class="keyword">int</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;notifactionId&nbsp;=&nbsp;bundle.getInt(JPushInterface.EXTRA_NOTIFICATION_ID);&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #999999; list-style: decimal-leading-zero outside; color: #555555; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Log.d(TAG,&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: red; background-color: inherit" class="string">&quot;[JPushReceiver]&nbsp;接收到推送下来的通知的ID:&nbsp;&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;+&nbsp;notifactionId);&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #999999; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #999999; list-style: decimal-leading-zero outside; color: #555555; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: blue; background-color: inherit" class="keyword">else</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: blue; background-color: inherit" class="keyword">if</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;(JPushInterface.ACTION_NOTIFICATION_OPENED.equals(intent.getAction()))&nbsp;&#123;&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #999999; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Log.d(TAG,&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: red; background-color: inherit" class="string">&quot;[JPushReceiver]&nbsp;用户点击打开了通知&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">);&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #999999; list-style: decimal-leading-zero outside; color: #555555; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JPushInterface.reportNotificationOpened(context,&nbsp;bundle.getString(JPushInterface.EXTRA_MSG_ID));&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #999999; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #999999; list-style: decimal-leading-zero outside; color: #555555; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&nbsp;style=<span style="margin: 0px; padding: 0px; border: none; color: red; background-color: inherit" class="string">&quot;color:#ff0000;&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&gt;</span><span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">//&nbsp;打开自定义的Activity</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #999999; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Intent&nbsp;i&nbsp;=&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: blue; background-color: inherit" class="keyword">new</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;Intent(context,&nbsp;MainTabActivity.</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: blue; background-color: inherit" class="keyword">class</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">);&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #999999; list-style: decimal-leading-zero outside; color: #555555; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i.putExtras(bundle);&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #999999; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #999999; list-style: decimal-leading-zero outside; color: #555555; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;context.startActivity(i);&lt;/span&gt;&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #999999; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #999999; list-style: decimal-leading-zero outside; color: #555555; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: blue; background-color: inherit" class="keyword">else</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: blue; background-color: inherit" class="keyword">if</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;(JPushInterface.ACTION_RICHPUSH_CALLBACK.equals(intent.getAction()))&nbsp;&#123;&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #999999; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Log.d(TAG,&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: red; background-color: inherit" class="string">&quot;[MyReceiver]&nbsp;用户收到到RICH&nbsp;PUSH&nbsp;CALLBACK:&nbsp;&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;+&nbsp;bundle.getString(JPushInterface.EXTRA_EXTRA));&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #999999; list-style: decimal-leading-zero outside; color: #555555; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">//在这里根据&nbsp;JPushInterface.EXTRA_EXTRA&nbsp;的内容处理代码，比如打开新的Activity，&nbsp;打开一个网页等..</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #999999; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #999999; list-style: decimal-leading-zero outside; color: #555555; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: blue; background-color: inherit" class="keyword">else</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&#123;&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #999999; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Log.d(TAG,&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: red; background-color: inherit" class="string">&quot;[MyReceiver]&nbsp;Unhandled&nbsp;intent&nbsp;-&nbsp;&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;+&nbsp;intent.getAction());&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #999999; list-style: decimal-leading-zero outside; color: #555555; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125;&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #999999; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&#125;&nbsp;&nbsp;</span></li></ol></div><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial">使用Activity以外的content来startActivity，必须指定为Intent.FLAG_ACTIVITY_NEW_TASK。</span><br /><div class="dp-highlighter bg_java" style="font-family: Consolas, 'Courier New', Courier, mono, serif; width: 936.531px; overflow-y: hidden; overflow-x: auto; padding-top: 1px; position: relative; line-height: 26px; margin: 18px 0px !important; background-color: #e7e5dc"><div class="bar" style="padding-left: 45px"><div class="tools" style="padding: 3px 8px 10px 10px; font-stretch: normal; font-size: 9px; line-height: normal; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; color: silver; border-left-width: 3px; border-left-style: solid; border-left-color: #999999; background-color: #f8f8f8"><strong>[java]</strong>&nbsp;<a style="color: #a0a0a0; text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial" href="http://blog.csdn.net/withiter/article/details/30476283#" title="view plain" class="ViewSource">view plain</a><span>&nbsp;<a style="color: #a0a0a0; text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial" href="http://blog.csdn.net/withiter/article/details/30476283#" title="copy" class="CopyToClipboard">copy</a></span><span>&nbsp;<a style="color: #a0a0a0; text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial" href="http://blog.csdn.net/withiter/article/details/30476283#" title="print" class="PrintSource">print</a></span><a style="color: #a0a0a0; text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial" href="http://blog.csdn.net/withiter/article/details/30476283#" title="?" class="About">?</a><span class="tracking-ad"><a style="color: #a0a0a0; text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial" href="https://code.csdn.net/snippets/390813" target="_blank" title="在CODE上查看代码片"><img style="border: none; max-width: 100%; position: relative; top: 1px; left: 2px" src="https://code.csdn.net/assets/CODE_ico.png" border="0" alt="在CODE上查看代码片" width="12" height="12" /></a></span><span class="tracking-ad"><a style="color: #a0a0a0; text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial" href="https://code.csdn.net/snippets/390813/fork" target="_blank" title="派生到我的代码片"><img style="border: none; max-width: 100%; position: relative; top: 2px; left: 2px" src="https://code.csdn.net/assets/ico_fork.svg" border="0" alt="派生到我的代码片" width="12" height="12" /></a></span></div></div><ol class="dp-j" style="padding: 0px; border: none; color: #5c5c5c; margin: 0px 0px 1px 45px !important; background-color: #ffffff"><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #999999; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">i.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);&nbsp;&nbsp;</span></span></li></ol></div><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial">我们可以尝试下使用Intent.FLAG_ACTIVITY_BROUGHT_TO_FRONT,会抛出以下异常：</span><br /><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"></p><div class="dp-highlighter bg_java" style="font-family: Consolas, 'Courier New', Courier, mono, serif; width: 936.531px; overflow-y: hidden; overflow-x: auto; padding-top: 1px; position: relative; line-height: 26px; margin: 18px 0px !important; background-color: #e7e5dc"><div class="bar" style="padding-left: 45px"><div class="tools" style="padding: 3px 8px 10px 10px; font-stretch: normal; font-size: 9px; line-height: normal; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; color: silver; border-left-width: 3px; border-left-style: solid; border-left-color: #999999; background-color: #f8f8f8"><strong>[java]</strong>&nbsp;<a style="color: #a0a0a0; text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial" href="http://blog.csdn.net/withiter/article/details/30476283#" title="view plain" class="ViewSource">view plain</a><span>&nbsp;<a style="color: #a0a0a0; text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial" href="http://blog.csdn.net/withiter/article/details/30476283#" title="copy" class="CopyToClipboard">copy</a></span><span>&nbsp;<a style="color: #a0a0a0; text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial" href="http://blog.csdn.net/withiter/article/details/30476283#" title="print" class="PrintSource">print</a></span><a style="color: #a0a0a0; text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial" href="http://blog.csdn.net/withiter/article/details/30476283#" title="?" class="About">?</a><span class="tracking-ad"><a style="color: #a0a0a0; text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial" href="https://code.csdn.net/snippets/390813" target="_blank" title="在CODE上查看代码片"><img style="border: none; max-width: 100%; position: relative; top: 1px; left: 2px" src="https://code.csdn.net/assets/CODE_ico.png" border="0" alt="在CODE上查看代码片" width="12" height="12" /></a></span><span class="tracking-ad"><a style="color: #a0a0a0; text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial" href="https://code.csdn.net/snippets/390813/fork" target="_blank" title="派生到我的代码片"><img style="border: none; max-width: 100%; position: relative; top: 2px; left: 2px" src="https://code.csdn.net/assets/ico_fork.svg" border="0" alt="派生到我的代码片" width="12" height="12" /></a></span></div></div><ol class="dp-j" style="padding: 0px; border: none; color: #5c5c5c; margin: 0px 0px 1px 45px !important; background-color: #ffffff"><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #999999; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">ERROR/AndroidRuntime(</span><span style="margin: 0px; padding: 0px; border: none; color: #c00000; background-color: inherit" class="number">7557</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">):&nbsp;java.lang.RuntimeException:&nbsp;Unable&nbsp;to&nbsp;start&nbsp;receiver&nbsp;com.wcc.Wakeup:&nbsp;android.util.AndroidRuntimeException:&nbsp;Calling&nbsp;startActivity()&nbsp;from&nbsp;outside&nbsp;of&nbsp;an&nbsp;Activity&nbsp;context&nbsp;requires&nbsp;the&nbsp;FLAG_ACTIVITY_NEW_TASK&nbsp;flag.&nbsp;Is&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: blue; background-color: inherit" class="keyword">this</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;really&nbsp;what&nbsp;you&nbsp;want?&nbsp;&nbsp;</span></span></li></ol></div><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px"></p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">更多关于Intent的flag，可以参考：<a style="color: #ca0000; text-decoration: none" href="http://developer.android.com/reference/android/content/Intent.html" target="_blank">http://developer.android.com/reference/android/content/Intent.html</a></p><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial">所以只能使用FLAG_ACTIVITY_NEW_TASK。使用这个还有个问题，就是会新打开一个MainActivity。如何解决这个问题？</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial">其实很简单在AndroidManifest.xml中将MainActivity定义为：</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial">&nbsp;android:launchMode=&quot;singleTask&quot; 即可：</span><br /><div class="dp-highlighter bg_html" style="font-family: Consolas, 'Courier New', Courier, mono, serif; width: 936.531px; overflow-y: hidden; overflow-x: auto; padding-top: 1px; position: relative; line-height: 26px; margin: 18px 0px !important; background-color: #e7e5dc"><div class="bar" style="padding-left: 45px"><div class="tools" style="padding: 3px 8px 10px 10px; font-stretch: normal; font-size: 9px; line-height: normal; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; color: silver; border-left-width: 3px; border-left-style: solid; border-left-color: #999999; background-color: #f8f8f8"><strong>[html]</strong>&nbsp;<a style="color: #a0a0a0; text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial" href="http://blog.csdn.net/withiter/article/details/30476283#" title="view plain" class="ViewSource">view plain</a><span>&nbsp;<a style="color: #a0a0a0; text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial" href="http://blog.csdn.net/withiter/article/details/30476283#" title="copy" class="CopyToClipboard">copy</a></span><span>&nbsp;<a style="color: #a0a0a0; text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial" href="http://blog.csdn.net/withiter/article/details/30476283#" title="print" class="PrintSource">print</a></span><a style="color: #a0a0a0; text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial" href="http://blog.csdn.net/withiter/article/details/30476283#" title="?" class="About">?</a><span class="tracking-ad"><a style="color: #a0a0a0; text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial" href="https://code.csdn.net/snippets/390813" target="_blank" title="在CODE上查看代码片"><img style="border: none; max-width: 100%; position: relative; top: 1px; left: 2px" src="https://code.csdn.net/assets/CODE_ico.png" border="0" alt="在CODE上查看代码片" width="12" height="12" /></a></span><span class="tracking-ad"><a style="color: #a0a0a0; text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial" href="https://code.csdn.net/snippets/390813/fork" target="_blank" title="派生到我的代码片"><img style="border: none; max-width: 100%; position: relative; top: 2px; left: 2px" src="https://code.csdn.net/assets/ico_fork.svg" border="0" alt="派生到我的代码片" width="12" height="12" /></a></span></div></div><ol class="dp-xml" style="padding: 0px; border: none; color: #5c5c5c; margin: 0px 0px 1px 45px !important; background-color: #ffffff"><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #999999; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: blue; background-color: inherit" class="tag">&lt;</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: blue; background-color: inherit" class="tag-name">activity</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; color: red; background-color: inherit" class="attribute">android:name</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">=</span><span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="attribute-value">&quot;com.withiter.quhao.activity.MainTabActivity&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; color: red; background-color: inherit" class="attribute">android:launchMode</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">=</span><span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="attribute-value">&quot;singleTask&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; color: red; background-color: inherit" class="attribute">android:label</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">=</span><span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="attribute-value">&quot;@string/app_name&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; color: red; background-color: inherit" class="attribute">android:screenOrientation</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">=</span><span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="attribute-value">&quot;portrait&quot;</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: blue; background-color: inherit" class="tag">&gt;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li></ol></div><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">这样每次打开推送，就不会出现2个activity的情况了。</p><p style="margin: 0px; padding: 0px; font-family: Arial; font-size: 14px; line-height: 26px">更多关于activity的launchMode可以参考：<a style="color: #ca0000; text-decoration: none" href="http://developer.android.com/guide/topics/manifest/activity-element.html#lmode" target="_blank">http://developer.android.com/guide/topics/manifest/activity-element.html#lmode</a></p><div><br /></div>
]]>
</description>
</item><item>
<link>http://i.renjihe.com/blog/read.php?7409</link>
<title><![CDATA[Android实现双进程守护]]></title> 
<author>renjihe1988 &lt;admin@yourname.com&gt;</author>
<category><![CDATA[Android]]></category>
<pubDate>Sat, 23 Jul 2016 08:06:42 +0000</pubDate> 
<guid>http://i.renjihe.com/blog/read.php?7409</guid> 
<description>
<![CDATA[ 
	<span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">做过android开发的人应该都知道应用会在系统资源匮乏的情况下被系统杀死！当后台的应用被系统回收之后，如何重新恢复它呢？网上对此问题有很多的讨论。这里先总结一下网上流传的各种解决方案，看看这些办法是不是真的可行。</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">1.提高优先级</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">这个办法对普通应用而言，应该只是降低了应用被杀死的概率，但是如果真的被系统回收了，还是无法让应用自动重新启动！</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&nbsp; &nbsp;&nbsp;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">2.让service.onStartCommand返回START_STICKY</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">通过实验发现，如果在adb shell当中kill掉进程模拟应用被意外杀死的情况(或者用360手机卫士进行清理操作)，如果服务的onStartCommand返回START_STICKY，在eclipse的进程管理器中会发现过一小会后被杀死的进程的确又会出现在任务管理器中，貌似这是一个可行的办法。但是如果在系统设置的App管理中选择强行关闭应用，这时候会发现即使onStartCommand返回了START_STICKY，应用还是没能重新启动起来！</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">3.android:persistent=&quot;true&quot;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">网上还提出了设置这个属性的办法，通过实验发现即使设置了这个属性，应用程序被kill之后还是不能重新启动起来的！</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">4.让应用成为系统应用</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">实验发现即使成为系统应用，被杀死之后也不能自动重新启动。但是如果对一个系统应用设置了persistent=&quot;true&quot;，情况就不一样了。实验表明对一个设置了persistent属性的系统应用，即使kill掉会立刻重启。一个设置了persistent=&quot;true&quot;的系统应用，在android中具有core service优先级，这种优先级的应用对系统的low memory killer是免疫的！</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">OK，说了半天，只有core service优先级的应用才能保证在被意外杀死之后做到立刻满血复活。而普通应用要想成为系统应用就必须要用目标机器的签名文件进行签名，但这样又造成了应用无法保证兼容所有不同厂商的产品。那么该怎么办呢？这里就来说一说双进程守护。网上也有人提到过双进程守护的办法，但是很少能搜索到类似的源码！如果从进程管理器重观察会发现新浪微博或者360卫视都有两个相关的进程，其中一个就是守护进程，由此可以猜到这些商业级的软件也采用了双进程守护的办法。</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">什么是双进程守护呢？顾名思义就是两个进程互相监视对方，发现对方挂掉就立刻重启！不知道应该把这样的一对进程是叫做相依为命呢还是难兄难弟好呢，但总之，双进程守护的确是一个解决问题的办法！相信说到这里，很多人已经迫切的想知道如何实现双进程守护了。这篇文章就介绍一个用NDK来实现双进程保护的办法，不过首先说明一点，下面要介绍的方法中，会损失不少的效率，反应到现实中就是会使手机的耗电量变大！但是这篇文章仅仅是抛砖引玉，相信看完之后会有更多高人指点出更妙的实现办法。</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">需要了解些什么？</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">这篇文章中实现双进程保护的方法基本上是纯的NDK开发，或者说全部是用C++来实现的，需要双进程保护的程序，只需要在程序的任何地方调用一下JAVA接口即可。下面几个知识点是需要了解的：</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">1.linux中多进程；</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">2.unix domain套接字实现跨进程通信；</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">3.linux的信号处理；</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">4.exec函数族的用法；</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">其实这些东西本身并不是多复杂的技术，只是我们把他们组合起来实现了一个双进程守护而已，没有想象中那么神秘！在正式贴出代码之前，先来说说几个实现双进程守护时的关键点：</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">1.父进程如何监视到子进程（监视进程）的死亡？</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">很简单，在linux中，子进程被终止时，会向父进程发送SIG_CHLD信号，于是我们可以安装信号处理函数，并在此信号处理函数中重新启动创建监视进程；</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">2.子进程（监视进程）如何监视到父进程死亡？</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">当父进程死亡以后，子进程就成为了孤儿进程由Init进程领养，于是我们可以在一个循环中读取子进程的父进程PID，当变为1就说明其父进程已经死亡，于是可以重启父进程。这里因为采用了循环，所以就引出了之前提到的耗电量的问题。</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">3.父子进程间的通信</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">有一种办法是父子进程间建立通信通道，然后通过监视此通道来感知对方的存在，这样不会存在之前提到的耗电量的问题，在本文的实现中，为了简单，还是采用了轮询父进程PID的办法，但是还是留出了父子进程的通信通道，虽然暂时没有用到，但可备不时之需！</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">OK， 下面就贴上代码！首先是Java部分，这一部分太过简单，只是一个类，提供了给外部调用的API接口用于创建守护进程，所有的实现都通过native方法在C++中完成！</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">package com.example.dameonservice;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">import java.util.ArrayList;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">import android.app.ActivityManager;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">import android.app.ActivityManager.RunningServiceInfo;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">import android.content.Context;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">import android.os.Handler;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">import android.os.HandlerThread;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">import android.os.Message;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">import android.util.Log;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">/**</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">* 监视器类，构造时将会在Native创建子进程来监视当前进程，</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">* @author wangqiang</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">* @date 2014-04-24</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">*/</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">public class Watcher</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#123;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">//TODO Fix this according to your service</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">private static final String PACKAGE = &quot;com.example.dameonservice/&quot;;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">private String mMonitoredService = &quot;&quot;;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">private volatile boolean bHeartBreak = false;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">private Context mContext;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">private boolean mRunning = true;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">public void createAppMonitor(String userId)</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#123;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">if( !createWatcher(userId) )</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#123;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">Log.e(&quot;Watcher&quot;, &quot;&lt;&lt;Monitor created failed&gt;&gt;&quot;);</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#125;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#125;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">public Watcher( Context context)</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#123;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">mContext = context;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#125;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">private int isServiceRunning()</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#123;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">ActivityManager am=(ActivityManager)mContext.getSystemService(Context.ACTIVITY_SERVICE);</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">ArrayList&lt;RunningServiceInfo&gt; runningService = (ArrayList&lt;RunningServiceInfo&gt;)am.getRunningServices(1024);&nbsp;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">for( int i = 0; i &lt; runningService.size(); ++i )</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#123;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">if( mMonitoredService.equals(runningService.get(i).service.getClassName().toString() ))</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#123;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">return 1;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#125;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#125;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">return 0;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#125;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">/**</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">* Native方法，创建一个监视子进程.</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">* @param userId 当前进程的用户ID,子进程重启当前进程时需要用到当前进程的用户ID.</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">* @return 如果子进程创建成功返回true，否则返回false</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">*/</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">private native boolean createWatcher(String userId);</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">/**</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">* Native方法，让当前进程连接到监视进程.</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">* @return 连接成功返回true，否则返回false</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">*/</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">private native boolean connectToMonitor();</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">/**</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">* Native方法，向监视进程发送任意信息</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">* @param 发给monitor的信息</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">* @return 实际发送的字节</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">*/</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">private native int sendMsgToMonitor(String msg);</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">static&nbsp;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#123;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">System.loadLibrary(&quot;monitor&quot;);</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#125;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&nbsp; &nbsp;&#125;</span><br /><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">代码中很多属性都是测试时用的，懒得去掉，其实有些都没用到。只需要关心createAppMonitor这个对外接口就可以了，它要求传入一个当前进程的用户ID，然后会调用createWatcher本地方法来创建守护进程。还有两个方法connectToMonitor用于创建和监视进程的socket通道，sendMsgToMonitor用于通过socket向子进程发送数据。由于暂时不需要和子进程进行数据交互，所以这两个方法就没有添加对外的JAVA接口，但是要添加简直是轻而易举的事！</span><br /><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">Ok，JAVA只是个壳，内部的实现还得是C++，为了让程序更加的面向对象，在实现native时，我们用一个ProcessBase基类来对父子进程进行一个抽象，把父子进程都会有的行为抽象出来，而父子进程可以根据需要用自己的方式去实现其中的接口，先来看看这个抽象了父子进程共同行为的ProcessBase基类：</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">#ifndef _PROCESS_H</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">#define _PROCESS_H</span><br /><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">#include &lt;jni.h&gt;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">#include &lt;sys/select.h&gt;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">#include &lt;unistd.h&gt;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">#include &lt;sys/socket.h&gt;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">#include &lt;pthread.h&gt;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">#include &lt;signal.h&gt;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">#include &lt;sys/wait.h&gt;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">#include &lt;android/log.h&gt;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">#include &lt;sys/types.h&gt;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">#include &lt;sys/un.h&gt;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">#include &lt;errno.h&gt;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">#include &lt;stdlib.h&gt;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">#include &quot;constants.h&quot;</span><br /><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">#define LOG_TAG &quot;Native&quot;</span><br /><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">#define LOGE(...) __android_log_print(ANDROID_LOG_ERROR,LOG_TAG,__VA_ARGS__)</span><br /><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">/**</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">* 功能:对父子进程的一个抽象</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">* @author wangqiang</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">* @date 2014-03-14</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">*/</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">class ProcessBase</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#123;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">public:</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">ProcessBase( );</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">/**</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">* 父子进程要做的工作不相同,留出一个抽象接口由父子进程</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">* 自己去实现.</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">*/</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">virtual void do_work() = 0;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">/**</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">* 进程可以根据需要创建子进程,如果不需要创建子进程,可以给</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">* 此接口一个空实现即可.</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">*/</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">virtual bool create_child() = 0;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">/**</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">* 捕捉子进程死亡的信号,如果没有子进程此方法可以给一个空实现.</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">*/</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">virtual void catch_child_dead_signal() = 0;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">/**</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">* 在子进程死亡之后做任意事情.</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">*/</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">virtual void on_child_end() = 0;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">/**</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">* 创建父子进程通信通道.</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">*/</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">bool create_channel();</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">/**</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">* 给进程设置通信通道.</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">* @param channel_fd 通道的文件描述</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">*/</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">void set_channel(int channel_fd);</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">/**</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">* 向通道中写入数据.</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">* @param data 写入通道的数据</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">* @param len &nbsp;写入的字节数</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">* @return 实际写入通道的字节数</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">*/</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">int write_to_channel( void* data, int len );</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">/**</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">* 从通道中读数据.</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">* @param data 保存从通道中读入的数据</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">* @param len &nbsp;从通道中读入的字节数</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">* @return 实际读到的字节数</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">*/</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">int read_from_channel( void* data, int len );</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">/**</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">* 获取通道对应的文件描述符</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">*/</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">int get_channel() const;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">virtual ~ProcessBase();</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&nbsp; &nbsp;protected:</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">int m_channel;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#125;;</span><br /><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">只是很简单的一个类，相信看看注释就知道是什么意思了，比如父子进程可能都需要捕获他的子孙死亡的信号，于是给一个catch_child_dead_signal函数，如果对子进程的死活不感兴趣，可以给个空实现，忽略掉就可以了，谁叫他大逆不道呢？由于用了纯虚函数，所以ProcessBase是一个抽象类，也就是说它不能有自己的实例，只是用来继承的，它的子孙后代可以用不同的方式实现它里面的接口从而表现出不一样的行为，这里父进程和子进程的行为就是有区别的，下面就先为诸君奉上父进程的实现：</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">/**</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">* 功能：父进程的实现</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">* @author wangqiang</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">* @date 2014-03-14</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">*/</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">class Parent : public ProcessBase</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#123;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">public:</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">Parent( JNIEnv* env, jobject jobj );</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">virtual bool create_child( );</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">virtual void do_work();</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">virtual void catch_child_dead_signal();</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">virtual void on_child_end();</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">virtual ~Parent();</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">bool create_channel();</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">/**</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">* 获取父进程的JNIEnv</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">*/</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">JNIEnv *get_jni_env() const;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">/**</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">* 获取Java层的对象</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">*/</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">jobject get_jobj() const;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">private:</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">JNIEnv *m_env;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">jobject m_jobj;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#125;;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">以上是定义部分，其实JNIEnv和jobject基本上没用到，完全可以给剃掉的，大家就当这两个属性不存在就是了！实现部分如下：</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">#include &quot;process.h&quot;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">#include &quot;Utils.h&quot;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">extern ProcessBase *g_process;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">extern const char* g_userId;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">extern JNIEnv* g_env;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">//子进程有权限访问父进程的私有目录,在此建立跨进程通信的套接字文件</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">static const char* PATH = &quot;/data/data/com.example.dameonservice/my.sock&quot;;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">//服务名称</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">static const char* SERVICE_NAME = &quot;com.example.dameonservice/com.example.dameonservice.MyService&quot;;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">bool ProcessBase::create_channel( )</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#123;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#125;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">int ProcessBase::write_to_channel( void* data, int len )</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#123;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">return write( m_channel, data, len );</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#125;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">int ProcessBase::read_from_channel( void* data, int len )</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#123;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">return read( m_channel, data, len );</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#125;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">int ProcessBase::get_channel() const</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#123;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">return m_channel;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#125;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">void ProcessBase::set_channel( int channel_fd )</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#123;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">m_channel = channel_fd;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#125;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">ProcessBase::ProcessBase()</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#123;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#125;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">ProcessBase::~ProcessBase()</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#123;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">close(m_channel);</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#125;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">Parent::Parent(JNIEnv *env, jobject jobj) : m_env(env)</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#123;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">LOGE(&quot;&lt;&lt;new parent instance&gt;&gt;&quot;);</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">m_jobj = env-&gt;NewGlobalRef(jobj);</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#125;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">Parent::~Parent()</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#123;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">LOGE( &quot;&lt;&lt;Parent::~Parent()&gt;&gt;&quot; );</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">g_process = NULL;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#125;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">void Parent::do_work()</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#123;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#125;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">JNIEnv* Parent::get_jni_env() const</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#123;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">return m_env;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#125;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">jobject Parent::get_jobj() const</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#123;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">return m_jobj;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#125;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">/**</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">* 父进程创建通道,这里其实是创建一个客户端并尝试</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">* 连接服务器(子进程)</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">*/</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">bool Parent::create_channel()</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#123;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">int sockfd;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">sockaddr_un addr;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">while( 1 )</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#123;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">sockfd = socket( AF_LOCAL, SOCK_STREAM, 0 );</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">if( sockfd &lt; 0 )</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#123;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">LOGE(&quot;&lt;&lt;Parent create channel failed&gt;&gt;&quot;);</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">return false;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#125;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">memset(&amp;addr, 0, sizeof(addr));</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">addr.sun_family = AF_LOCAL;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">strcpy( addr.sun_path, PATH );</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">if( connect( sockfd, (sockaddr*)&amp;addr, sizeof(addr)) &lt; 0 )</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#123;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">close(sockfd);</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">sleep(1);</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">continue;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#125;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">set_channel(sockfd);</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">LOGE(&quot;&lt;&lt;parent channel fd %d&gt;&gt;&quot;, m_channel );</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">break;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#125;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">return true;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#125;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">/**</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">* 子进程死亡会发出SIGCHLD信号,通过捕捉此信号父进程可以</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">* 知道子进程已经死亡,此函数即为SIGCHLD信号的处理函数.</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">*/</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">static void sig_handler( int signo )</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#123;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">pid_t pid;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">int status;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">//调用wait等待子进程死亡时发出的SIGCHLD</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">//信号以给子进程收尸，防止它变成僵尸进程</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">pid = wait(&amp;status);</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">if( g_process != NULL )</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#123;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">g_process-&gt;on_child_end();</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#125;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#125;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">void Parent::catch_child_dead_signal()</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#123;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">LOGE(&quot;&lt;&lt;process %d install child dead signal detector!&gt;&gt;&quot;, getpid());</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">struct sigaction sa;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">sigemptyset(&amp;sa.sa_mask);</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">sa.sa_flags = 0;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">sa.sa_handler = sig_handler;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">sigaction( SIGCHLD, &amp;sa, NULL );</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#125;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">void Parent::on_child_end()</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#123;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">LOGE(&quot;&lt;&lt;on_child_end:create a new child process&gt;&gt;&quot;);</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">create_child();</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#125;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">bool Parent::create_child( )</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#123;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">pid_t pid;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">if( (pid = fork()) &lt; 0 )</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#123;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">return false;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#125;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">else if( pid == 0 ) //子进程</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#123;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">LOGE(&quot;&lt;&lt;In child process,pid=%d&gt;&gt;&quot;, getpid() );</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">Child child;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">ProcessBase&amp; ref_child = child;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">ref_child.do_work();</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#125;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">else if( pid &gt; 0 ) &nbsp;//父进程</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#123;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">LOGE(&quot;&lt;&lt;In parent process,pid=%d&gt;&gt;&quot;, getpid() );</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#125;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">return true;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#125;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">这里先要说明一下三个全局变量：</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">g_process是父进程的指针；</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">g_userId是父进程用户ID，由Java侧传递过来，我们需要把它用全局变量保存起来，因为子进程在重启父进程的时候需要用到用户ID，否则会有问题，当然这里也得益于子进程能够继承父进程的全局变量这个事实！&nbsp;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">g_env是JNIEnv的指针，把这个变量也作为一个全局变量，是保留给子进程用的；</span><br /><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">父进程在create_child中用fork创建了子进程，其实就是一个fork调用，然后父进程什么都不做，子进程创建一个Child对象并调用其do_work开始做自己该做的事！</span><br /><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">父进程实现了catch_child_dead_signal，在其中安装了SIG_CHLD信号处理函数，因为他很爱他的儿子，时刻关心着他。而在信号处理函数sig_handler中，我们留意到了wait调用，这是为了防止子进程死了以后变成僵尸进程，由于我们已经知道父进程最多只会创建一个子监视进程，所以wait就足够了，不需要waitpid函数亲自出马！而信号处理函数很简单，重新调用一下on_child_end，在其中再次create_child和他亲爱的夫人在make一个小baby就可以了！</span><br /><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">最后要说说create_channel这个函数，他用来创建和子进程的socket通道，这个编程模型对于有网络编程经验的人来说显得非常亲切和熟悉，他遵循标准的网络编程客户端步骤：创建socket，connect，之后收发数据就OK了，只是这里的协议用的是AF_LOCAL，表明我们是要进行跨进程通信。由于域套接字用的不是IP地址，而是通过指定的一个文件来和目标进程通信，父子进程都需要这个文件，所以这个文件的位置指定在哪里也需要注意一下：在一个没有root过的手机上，几乎所有的文件都是没有写入权限的，但是很幸运的是linux的子进程共享父进程的目录，所以把这个位置指定到/data/data/下应用的私有目录就可以做到让父子进程都能访问这个文件了！</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">接下来是子进程的实现了，它的定义如下：</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">/**</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">* 子进程的实现</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">* @author wangqiang</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">* @date 2014-03-14</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">*/</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">class Child : public ProcessBase</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#123;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">public:</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">Child( );</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">virtual ~Child();</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">virtual void do_work();</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">virtual bool create_child();</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">virtual void catch_child_dead_signal();</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">virtual void on_child_end();</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">bool create_channel();</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">private:</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">/**</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">* 处理父进程死亡事件</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">*/</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">void handle_parent_die();</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">/**</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">* 侦听父进程发送的消息</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">*/</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">void listen_msg();</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">/**</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">* 重新启动父进程.</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">*/</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">void restart_parent();</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">/**</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">* 处理来自父进程的消息</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">*/</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">void handle_msg( const char* msg );</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">/**</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">* 线程函数，用来检测父进程是否挂掉</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">*/</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">void* parent_monitor();</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">void start_parent_monitor();</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">/**</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">* 这个联合体的作用是帮助将类的成员函数做为线程函数使用</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">*/</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">union</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#123;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">void* (*thread_rtn)(void*);</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">void* (Child::*member_rtn)();</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#125;RTN_MAP;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#125;;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">#endif&nbsp;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">注意到里面有个union，这个联合体的作用是为了辅助把一个类的成员函数作为线程函数来传递给pthread_create，很多时候我们都希望线程能够像自己人一样访问类的私有成员，就像一个成员函数那样，用friend虽然可以做到这一点，但总感觉不够优美，由于成员函数隐含的this指针，使我们完全可以将一个成员函数作为线程函数来用。只是由于编译器堵死了函数指针的类型转换，所以这里就只好用一个结构体。</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">废话不多说，看看子进程的实现：</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">bool Child::create_child( )</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#123;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">//子进程不需要再去创建子进程,此函数留空</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">return false;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#125;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">Child::Child()</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#123;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">RTN_MAP.member_rtn = &amp;Child::parent_monitor;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#125;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">Child::~Child()</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#123;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">LOGE(&quot;&lt;&lt;~Child(), unlink %s&gt;&gt;&quot;, PATH);</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">unlink(PATH);</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#125;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">void Child::catch_child_dead_signal()</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#123;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">//子进程不需要捕捉SIGCHLD信号</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">return;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#125;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">void Child::on_child_end()</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#123;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">//子进程不需要处理</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">return;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#125;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">void Child::handle_parent_die( )</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#123;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">//子进程成为了孤儿进程,等待被Init进程收养后在进行后续处理</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">while( getppid() != 1 )</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#123;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">usleep(500); //休眠0.5ms</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#125;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">close( m_channel );</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">//重启父进程服务</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">LOGE( &quot;&lt;&lt;parent died,restart now&gt;&gt;&quot; );</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">restart_parent();</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#125;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">void Child::restart_parent()</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#123;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">LOGE(&quot;&lt;&lt;restart_parent enter&gt;&gt;&quot;);</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">/**</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">* TODO 重启父进程,通过am启动Java空间的任一组件(service或者activity等)即可让应用重新启动</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">*/</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">execlp( &quot;am&quot;,</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&quot;am&quot;,</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&quot;startservice&quot;,</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&quot;--user&quot;,</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">g_userId,</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&quot;-n&quot;,</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">SERVICE_NAME, //注意此处的名称</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">(char *)NULL);</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#125;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">void* Child::parent_monitor()</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#123;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">handle_parent_die();</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#125;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">void Child::start_parent_monitor()</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#123;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">pthread_t tid;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">pthread_create( &amp;tid, NULL, RTN_MAP.thread_rtn, this );</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#125;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">bool Child::create_channel()</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#123;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">int listenfd, connfd;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">struct sockaddr_un addr;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">listenfd = socket( AF_LOCAL, SOCK_STREAM, 0 );</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">unlink(PATH);</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">memset( &amp;addr, 0, sizeof(addr) );</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">addr.sun_family = AF_LOCAL;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">strcpy( addr.sun_path, PATH );</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">if( bind( listenfd, (sockaddr*)&amp;addr, sizeof(addr) ) &lt; 0 )</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#123;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">LOGE(&quot;&lt;&lt;bind error,errno(%d)&gt;&gt;&quot;, errno);</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">return false;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#125;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">listen( listenfd, 5 );</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">while( true )</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#123;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">if( (connfd = accept(listenfd, NULL, NULL)) &lt; 0 )</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#123;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">if( errno == EINTR)</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">continue;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">else</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#123;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">LOGE(&quot;&lt;&lt;accept error&gt;&gt;&quot;);</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">return false;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#125;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#125;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">set_channel(connfd);</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">break;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#125;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">LOGE(&quot;&lt;&lt;child channel fd %d&gt;&gt;&quot;, m_channel );</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">return true;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#125;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">void Child::handle_msg( const char* msg )</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#123;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">//TODO How to handle message is decided by you.</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#125;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">void Child::listen_msg( )</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#123;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">fd_set rfds;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">int retry = 0;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">while( 1 )</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#123;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">FD_ZERO(&amp;rfds);</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">FD_SET( m_channel, &amp;rfds );</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">timeval timeout = &#123;3, 0&#125;;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">int r = select( m_channel + 1, &amp;rfds, NULL, NULL, &amp;timeout );</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">if( r &gt; 0 )</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#123;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">char pkg[256] = &#123;0&#125;;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">if( FD_ISSET( m_channel, &amp;rfds) )</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#123;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">read_from_channel( pkg, sizeof(pkg) );</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">LOGE(&quot;&lt;&lt;A message comes:%s&gt;&gt;&quot;, pkg );</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">handle_msg( (const char*)pkg );</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#125;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#125;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#125;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#125;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">void Child::do_work()</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#123;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">start_parent_monitor(); //启动监视线程</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">if( create_channel() ) &nbsp;//等待并且处理来自父进程发送的消息</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#123;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">listen_msg();</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#125;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#125;&nbsp;</span><br /><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">子进程在他的do_work中先创建了一个线程轮询其父进程的PID，如果发现变成了1，就会调用restart_parent，在其中调用execlp，执行一下am指令启动JAVA侧的组件，从而实现父进程的重启！这里请留意一下execlp中给am传入的参数，带了--user并加上了之前我们在全局变量中保存的user id，如果不加这个选项，就无法重启父进程，我在这花费了好长时间哦！</span><br /><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">子进程剩余的工作很简单，创建通道，监听来自父进程的消息，这里我们用select来监听，由于实际上只有一个客户端（父进程），所以用select有点脱裤子放屁，把简单问题复杂化的嫌疑，但是实际上也没啥太大影响！</span><br /><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">有了以上的实现，JNI的实现就相当的简单了：</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">#include &quot;process.h&quot;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">#include &quot;Utils.h&quot;</span><br /><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">/**</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">* 全局变量，代表应用程序进程.</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">*/</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">ProcessBase *g_process = NULL;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">/**</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">* 应用进程的UID.</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">*/</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">const char* g_userId = NULL;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">/**</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">* 全局的JNIEnv，子进程有时会用到它.</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">*/</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">JNIEnv* g_env = NULL;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">extern &quot;C&quot;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#123;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">JNIEXPORT jboolean JNICALL Java_com_example_dameonservice_Watcher_createWatcher( JNIEnv*, jobject, jstring);</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">JNIEXPORT jboolean JNICALL Java_com_example_dameonservice_Watcher_connectToMonitor( JNIEnv*, jobject );</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">JNIEXPORT jint JNICALL Java_com_example_dameonservice_Watcher_sendMsgToMonitor( JNIEnv*, jobject, jstring );</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">JNIEXPORT jint JNICALL JNI_OnLoad( JavaVM* , void* );</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#125;;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">JNIEXPORT jboolean JNICALL Java_com_example_dameonservice_Watcher_createWatcher( JNIEnv* env, jobject thiz, jstring user )</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#123;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">g_process = new Parent( env, thiz );</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">g_userId &nbsp;= (const char*)jstringTostr(env, user);</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">g_process-&gt;catch_child_dead_signal();</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">if( !g_process-&gt;create_child() )</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#123;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">LOGE(&quot;&lt;&lt;create child error!&gt;&gt;&quot;);</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">return JNI_FALSE;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#125;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">return JNI_TRUE;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#125;</span><br /><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">JNIEXPORT jboolean JNICALL Java_com_example_dameonservice_Watcher_connectToMonitor( JNIEnv* env, jobject thiz )</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#123;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">if( g_process != NULL )</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#123;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">if( g_process-&gt;create_channel() )</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#123;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">return JNI_TRUE;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#125;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">return JNI_FALSE;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#125;</span><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">&#125;</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">把上面这些代码整合起来，一个双进程守护的实现就完成了，只需要调用一下Watcher.java的createAppMonitor，你的应用就会有一个守护进程来监视，被杀死后也会立刻重新启动起来！是不是很有意思呢？</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">思考：</span><br /><br /><span style="font-size: 14px; line-height: 26px; font-family: Arial; color: #362e2b">腾讯的面试官问我：应用程序死了如何恢复？确实，双进程守护只能做到进程被杀死后重新启动，但是重启后如何恢复到之前的状态这是一个问题。因为进程被意外杀死的情况，onSaveInstance是来不及执行的，所以程序的状态没法保存！对于双进程守护来说，不知道是不是可以再父进程进入后台以后（onStop），把数据收集起来保存到子进程中，然后父进程重启以后从子进程中取出这些信息呢？这是一个办法，但是上面说明的双进程守护程序的实现中还做不到，因为父进程重启以后，子进程也挂掉重新建立了，要想实现优雅的恢复，还得在做出点改进才是！&nbsp;</span>
]]>
</description>
</item><item>
<link>http://i.renjihe.com/blog/read.php?7408</link>
<title><![CDATA[Android 通过JNI实现守护进程，使Service服务不被杀死]]></title> 
<author>renjihe1988 &lt;admin@yourname.com&gt;</author>
<category><![CDATA[Android]]></category>
<pubDate>Sat, 23 Jul 2016 08:06:19 +0000</pubDate> 
<guid>http://i.renjihe.com/blog/read.php?7408</guid> 
<description>
<![CDATA[ 
	<p style="margin: 0px; padding: 0px; color: #555555; font-family: 'microsoft yahei'; font-size: 15px; line-height: 35px"><span style="color: #ff0000">转载请注明出处：<a style="text-decoration: none; color: #0c89cf" href="http://blog.csdn.net/yyh352091626/article/details/50542554" target="_blank">http://blog.csdn.net/yyh352091626/article/details/50542554</a></span></p><p style="margin: 0px; padding: 0px; color: #555555; font-family: 'microsoft yahei'; font-size: 15px; line-height: 35px">开发一个需要常住后台的App其实是一件非常头疼的事情，不仅要应对国内各大厂商的ROM，还需要应对各类的安全管家...虽然不断的研究各式各样的方法，但是效果并不好，比如任务管理器把App干掉，服务就起不来了...</p><p style="margin: 0px; padding: 0px; color: #555555; font-family: 'microsoft yahei'; font-size: 15px; line-height: 35px">网上搜寻一番后，主要的方法有以下几种方法，但都是治标不治本：</p><p style="margin: 0px; padding: 0px; color: #555555; font-family: 'microsoft yahei'; font-size: 15px; line-height: 35px">1、提高Service的优先级：这个，也只能说在系统内存不足需要回收资源的时候，优先级较高，不容易被回收，然并卵...</p><p style="margin: 0px; padding: 0px; color: #555555; font-family: 'microsoft yahei'; font-size: 15px; line-height: 35px">2、提高Service所在进程的优先级：效果不是很明显</p><p style="margin: 0px; padding: 0px; color: #555555; font-family: 'microsoft yahei'; font-size: 15px; line-height: 35px">3、在onDestroy方法里重启service：这个倒还算挺有效的一个方法，但是，直接干掉进程的时候，onDestroy方法都进不来，更别想重启了</p><p style="margin: 0px; padding: 0px; color: #555555; font-family: 'microsoft yahei'; font-size: 15px; line-height: 35px">4、broadcast广播：和第3种一样，没进入onDestroy，就不知道什么时候发广播了，另外，在Android4.4以上，程序完全退出后，就不好接收广播了，需要在发广播的地方特定处理</p><p style="margin: 0px; padding: 0px; color: #555555; font-family: 'microsoft yahei'; font-size: 15px; line-height: 35px">5、放到System/app底下作为系统应用：这个也就是平时玩玩，没多大的实际意义。</p><p style="margin: 0px; padding: 0px; color: #555555; font-family: 'microsoft yahei'; font-size: 15px; line-height: 35px">6、Service的onStartCommand方法，返回START_STICKY，这个也主要是针对系统资源不足而导致的服务被关闭，还是有一定的道理的。</p><p style="margin: 0px; padding: 0px; color: #555555; font-family: 'microsoft yahei'; font-size: 15px; line-height: 35px">应对的方法是有，实现起来都比较繁琐。如果你自己可以定制ROM，那就有很多种办法了，比如把你的应用加入白名单，或是多安装一个没有图标的app作为守护进程...但是，哪能什么都是定制的，对于安卓开发者来说，这个难题必须攻破~</p><p style="margin: 0px; padding: 0px; color: #555555; font-family: 'microsoft yahei'; font-size: 15px; line-height: 35px">那么，有没有办法在一个APP里面，开启一个子线程，在主线程被干掉了之后，子线程通过监听、轮询等方式去判断服务是否存在，不存在的话则开启服务。答案自然是肯定的，通过JNI的方式（NDK编程），fork()出一个子线程作为守护进程，轮询监听服务状态。守护进程（Daemon）是运行在后台的一种特殊进程。它独立于控制终端并且周期性地执行某种任务或等待处理某些发生的事件。而守护进程的会话组和当前目录，文件描述符都是独立的。后台运行只是终端进行了一次fork，让程序在后台执行，这些都没有改变。</p><p style="margin: 0px; padding: 0px; color: #555555; font-family: 'microsoft yahei'; font-size: 15px; line-height: 35px">那么我们先来看看Android4.4的源码，ActivityManagerService（源码/frameworks/base/services/core/java/com/<a style="text-decoration: none; color: #df3434; font-weight: bold" href="http://lib.csdn.net/base/15" target="_blank" title="undefined" class="replace_word">Android</a>/server/am/ActivityManagerService.java）是如何关闭在应用退出后清理内存的：</p><p style="margin: 0px; padding: 0px; color: #555555; font-family: 'microsoft yahei'; font-size: 15px; line-height: 35px"></p><div class="dp-highlighter bg_java" style="font-family: Consolas, 'Courier New', Courier, mono, serif; width: 938.516px; overflow: hidden; padding-top: 1px; position: relative; border-color: #cccccc; color: #555555; line-height: 35px; margin: 18px 0px !important; background-color: #e7e5dc"><div class="bar" style="padding-left: 45px"><div class="tools" style="padding: 3px 8px 10px 10px; font-stretch: normal; font-size: 9px; line-height: normal; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; color: silver; border-left-width: 3px; border-left-style: solid; border-left-color: #6ce26c; background-color: #f8f8f8"><strong>[java]</strong>&nbsp;<a style="text-decoration: none; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; color: #0c89cf; display: inline-block; width: 16px; height: 16px; text-indent: -2000px; background-image: url('http://static.blog.csdn.net/scripts/SyntaxHighlighter/styles/images/default/ico_plain.gif'); background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat" href="http://blog.csdn.net/yyh352091626/article/details/50542554#" title="view plain" class="ViewSource">view plain</a><span>&nbsp;<a style="text-decoration: none; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; color: #0c89cf; display: inline-block; width: 16px; height: 16px; text-indent: -2000px; background-image: url('http://static.blog.csdn.net/scripts/SyntaxHighlighter/styles/images/default/ico_copy.gif'); background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat" href="http://blog.csdn.net/yyh352091626/article/details/50542554#" title="copy" class="CopyToClipboard">copy</a></span><span>&nbsp;</span><span class="tracking-ad"><a style="text-decoration: none; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; color: #0c89cf; display: inline-block; width: 16px; height: 16px; background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat" href="https://code.csdn.net/snippets/1565940" target="_blank" title="在CODE上查看代码片"><img style="border: none; position: relative; top: 1px; left: 2px" src="https://code.csdn.net/assets/CODE_ico.png" border="0" alt="在CODE上查看代码片" width="12" height="12" /></a></span><span class="tracking-ad"><a style="text-decoration: none; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; color: #0c89cf; display: inline-block; width: 16px; height: 16px; background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat" href="https://code.csdn.net/snippets/1565940/fork" target="_blank" title="派生到我的代码片"><img style="border: none; position: relative; top: 2px; left: 2px" src="https://code.csdn.net/assets/ico_fork.svg" border="0" alt="派生到我的代码片" width="12" height="12" /></a></span></div></div><ol class="dp-j" style="padding: 0px; border: none; color: #5c5c5c; margin: 0px 0px 1px 45px !important; background-color: #ffffff"><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">Process.killProcessQuiet(pid);&nbsp;&nbsp;</span></span></li></ol></div><span style="font-size: 15px; line-height: 35px; font-family: 'microsoft yahei'; color: #555555">应用退出后，ActivityManagerService就把主进程给杀死了，但是，在Android5.0中，ActivityManagerService却是这样处理的：</span><p style="margin: 0px; padding: 0px; color: #555555; font-family: 'microsoft yahei'; font-size: 15px; line-height: 35px"></p><p style="margin: 0px; padding: 0px; color: #555555; font-family: 'microsoft yahei'; font-size: 15px; line-height: 35px"></p><div class="dp-highlighter bg_java" style="font-family: Consolas, 'Courier New', Courier, mono, serif; width: 938.516px; overflow: hidden; padding-top: 1px; position: relative; border-color: #cccccc; color: #555555; line-height: 35px; margin: 18px 0px !important; background-color: #e7e5dc"><div class="bar" style="padding-left: 45px"><div class="tools" style="padding: 3px 8px 10px 10px; font-stretch: normal; font-size: 9px; line-height: normal; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; color: silver; border-left-width: 3px; border-left-style: solid; border-left-color: #6ce26c; background-color: #f8f8f8"><strong>[java]</strong>&nbsp;<a style="text-decoration: none; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; color: #0c89cf; display: inline-block; width: 16px; height: 16px; text-indent: -2000px; background-image: url('http://static.blog.csdn.net/scripts/SyntaxHighlighter/styles/images/default/ico_plain.gif'); background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat" href="http://blog.csdn.net/yyh352091626/article/details/50542554#" title="view plain" class="ViewSource">view plain</a><span>&nbsp;<a style="text-decoration: none; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; color: #0c89cf; display: inline-block; width: 16px; height: 16px; text-indent: -2000px; background-image: url('http://static.blog.csdn.net/scripts/SyntaxHighlighter/styles/images/default/ico_copy.gif'); background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat" href="http://blog.csdn.net/yyh352091626/article/details/50542554#" title="copy" class="CopyToClipboard">copy</a></span><span>&nbsp;</span><span class="tracking-ad"><a style="text-decoration: none; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; color: #0c89cf; display: inline-block; width: 16px; height: 16px; background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat" href="https://code.csdn.net/snippets/1565940" target="_blank" title="在CODE上查看代码片"><img style="border: none; position: relative; top: 1px; left: 2px" src="https://code.csdn.net/assets/CODE_ico.png" border="0" alt="在CODE上查看代码片" width="12" height="12" /></a></span><span class="tracking-ad"><a style="text-decoration: none; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; color: #0c89cf; display: inline-block; width: 16px; height: 16px; background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat" href="https://code.csdn.net/snippets/1565940/fork" target="_blank" title="派生到我的代码片"><img style="border: none; position: relative; top: 2px; left: 2px" src="https://code.csdn.net/assets/ico_fork.svg" border="0" alt="派生到我的代码片" width="12" height="12" /></a></span></div></div><ol class="dp-j" style="padding: 0px; border: none; color: #5c5c5c; margin: 0px 0px 1px 45px !important; background-color: #ffffff"><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">Process.killProcessQuiet(app.pid);&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">Process.killProcessGroup(app.info.uid,&nbsp;app.pid);&nbsp;&nbsp;</span></li></ol></div><span style="font-size: 15px; line-height: 35px; font-family: 'microsoft yahei'; color: #555555">就差了一句话，却差别很大。Android5.0在应用退出后，ActivityManagerService不仅把主进程给杀死，另外把主进程所属的进程组一并杀死，这样一来，由于子进程和主进程在同一进程组，子进程在做的事情，也就停止了...要不怎么说Android5.0在安全方面做了很多更新呢...</span><br /><p style="margin: 0px; padding: 0px; color: #555555; font-family: 'microsoft yahei'; font-size: 15px; line-height: 35px"></p><p style="margin: 0px; padding: 0px; color: #555555; font-family: 'microsoft yahei'; font-size: 15px; line-height: 35px">那么，有没有办法让子进程脱离出来，不要受到主进程的影响，当然也是可以的。那么，在C/C++层是如何实现的呢？先上关键代码：</p><p style="margin: 0px; padding: 0px; color: #555555; font-family: 'microsoft yahei'; font-size: 15px; line-height: 35px"></p><div class="dp-highlighter bg_cpp" style="font-family: Consolas, 'Courier New', Courier, mono, serif; width: 938.516px; overflow: hidden; padding-top: 1px; position: relative; border-color: #cccccc; color: #555555; line-height: 35px; margin: 18px 0px !important; background-color: #e7e5dc"><div class="bar" style="padding-left: 45px"><div class="tools" style="padding: 3px 8px 10px 10px; font-stretch: normal; font-size: 9px; line-height: normal; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; color: silver; border-left-width: 3px; border-left-style: solid; border-left-color: #6ce26c; background-color: #f8f8f8"><strong>[cpp]</strong>&nbsp;<a style="text-decoration: none; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; color: #0c89cf; display: inline-block; width: 16px; height: 16px; text-indent: -2000px; background-image: url('http://static.blog.csdn.net/scripts/SyntaxHighlighter/styles/images/default/ico_plain.gif'); background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat" href="http://blog.csdn.net/yyh352091626/article/details/50542554#" title="view plain" class="ViewSource">view plain</a><span>&nbsp;<a style="text-decoration: none; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; color: #0c89cf; display: inline-block; width: 16px; height: 16px; text-indent: -2000px; background-image: url('http://static.blog.csdn.net/scripts/SyntaxHighlighter/styles/images/default/ico_copy.gif'); background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat" href="http://blog.csdn.net/yyh352091626/article/details/50542554#" title="copy" class="CopyToClipboard">copy</a></span><span>&nbsp;</span><span class="tracking-ad"><a style="text-decoration: none; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; color: #0c89cf; display: inline-block; width: 16px; height: 16px; background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat" href="https://code.csdn.net/snippets/1565940" target="_blank" title="在CODE上查看代码片"><img style="border: none; position: relative; top: 1px; left: 2px" src="https://code.csdn.net/assets/CODE_ico.png" border="0" alt="在CODE上查看代码片" width="12" height="12" /></a></span><span class="tracking-ad"><a style="text-decoration: none; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; color: #0c89cf; display: inline-block; width: 16px; height: 16px; background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat" href="https://code.csdn.net/snippets/1565940/fork" target="_blank" title="派生到我的代码片"><img style="border: none; position: relative; top: 2px; left: 2px" src="https://code.csdn.net/assets/ico_fork.svg" border="0" alt="派生到我的代码片" width="12" height="12" /></a></span></div></div><ol class="dp-cpp" style="padding: 0px; border: none; color: #5c5c5c; margin: 0px 0px 1px 45px !important; background-color: #ffffff"><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">/**</span>&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">&nbsp;*&nbsp;srvname&nbsp;&nbsp;进程名</span>&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">&nbsp;*&nbsp;sd&nbsp;之前创建子进程的pid写入的文件路径</span>&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">&nbsp;*/</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #2e8b57; background-color: inherit" class="datatypes">int</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;start(</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #2e8b57; background-color: inherit" class="datatypes">int</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;argc,&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #2e8b57; background-color: inherit" class="datatypes">char</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">*&nbsp;srvname,&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #2e8b57; background-color: inherit" class="datatypes">char</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">*&nbsp;sd)&nbsp;&#123;&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;pthread_t&nbsp;id;&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #2e8b57; background-color: inherit" class="datatypes">int</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;ret;&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">struct</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;rlimit&nbsp;r;&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #2e8b57; background-color: inherit" class="datatypes">int</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;pid&nbsp;=&nbsp;fork();&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;LOGI(<span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">&quot;fork&nbsp;pid:&nbsp;%d&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">,&nbsp;pid);&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">if</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;(pid&nbsp;&lt;&nbsp;0)&nbsp;&#123;&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGI(<span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">&quot;first&nbsp;fork()&nbsp;error&nbsp;pid&nbsp;%d,so&nbsp;exit&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">,&nbsp;pid);&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit(0);&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&#125;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">else</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">if</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;(pid&nbsp;!=&nbsp;0)&nbsp;&#123;&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGI(<span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">&quot;first&nbsp;fork():&nbsp;I'am&nbsp;father&nbsp;pid=%d&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">,&nbsp;getpid());&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">//exit(0);</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&#125;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">else</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&#123;&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">//&nbsp;&nbsp;第一个子进程</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGI(<span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">&quot;first&nbsp;fork():&nbsp;I'am&nbsp;child&nbsp;pid=%d&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">,&nbsp;getpid());&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setsid();&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGI(<span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">&quot;first&nbsp;fork():&nbsp;setsid=%d&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">,&nbsp;setsid());&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;umask(0);&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">//为文件赋予更多的权限，因为继承来的文件可能某些权限被屏蔽</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #2e8b57; background-color: inherit" class="datatypes">int</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;pid&nbsp;=&nbsp;fork();&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">if</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;(pid&nbsp;==&nbsp;0)&nbsp;&#123;&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">//&nbsp;第二个子进程</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #2e8b57; background-color: inherit" class="datatypes">FILE</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;*fp;&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sprintf(sd,<span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">&quot;%s/pid&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">,sd);&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">if</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">((fp=fopen(sd,</span><span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">&quot;a&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">))==NULL)&nbsp;&#123;</span><span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">//打开文件&nbsp;没有就创建</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGI(<span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">&quot;%s文件还未创建!&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">,sd);&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ftruncate(fp,&nbsp;0);&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lseek(fp,&nbsp;0,&nbsp;SEEK_SET);&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125;&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fclose(fp);&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fp=fopen(sd,<span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">&quot;rw&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">);&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">if</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">(fp&gt;0)&#123;&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #2e8b57; background-color: inherit" class="datatypes">char</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;buff1[6];&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #2e8b57; background-color: inherit" class="datatypes">int</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;p&nbsp;=&nbsp;0;&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memset(buff1,0,<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">sizeof</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">(buff1));&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fseek(fp,0,SEEK_SET);&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fgets(buff1,6,fp);&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">//读取一行（pid）</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGI(<span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">&quot;读取的进程号：%s&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">,buff1);&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">if</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">(strlen(buff1)&gt;1)&#123;&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">//&nbsp;有值</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;kill(atoi(buff1),&nbsp;SIGTERM);&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">//&nbsp;把上一次的进程干掉，防止重复执行</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGI(<span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">&quot;杀死进程，pid=%d&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">,atoi(buff1));&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125;&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125;&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fclose(fp);&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fp=fopen(sd,<span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">&quot;w&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">);&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #2e8b57; background-color: inherit" class="datatypes">char</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;buff[100];&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #2e8b57; background-color: inherit" class="datatypes">int</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;k&nbsp;=&nbsp;3;&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">if</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">(fp&gt;0)&#123;&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sprintf(buff,<span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">&quot;%lu&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">,getpid());&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fprintf(fp,<span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">&quot;%s&#92;n&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">,buff);&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">//&nbsp;把进程号写入文件</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125;&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fclose(fp);&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fflush(fp);&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGI(<span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">&quot;I'am&nbsp;child-child&nbsp;pid=%d&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">,&nbsp;getpid());&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;chdir(<span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">&quot;/&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">);&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">//&lt;span&nbsp;style=&quot;font-family:&nbsp;Arial,&nbsp;Helvetica,&nbsp;sans-serif;&quot;&gt;修改进程工作目录为根目录，chdir(&ldquo;/&rdquo;)&lt;/span&gt;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">//关闭不需要的从父进程继承过来的文件描述符。</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">if</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;(r.rlim_max&nbsp;==&nbsp;RLIM_INFINITY)&nbsp;&#123;&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r.rlim_max&nbsp;=&nbsp;1024;&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125;&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #2e8b57; background-color: inherit" class="datatypes">int</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;i;&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">for</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;(i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;r.rlim_max;&nbsp;i++)&nbsp;&#123;&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;close(i);&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125;&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;umask(0);&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ret&nbsp;=&nbsp;pthread_create(&amp;id,&nbsp;NULL,&nbsp;(<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">void</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;*)&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">thread</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">,&nbsp;srvname);&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">//&nbsp;开启线程，轮询去监听启动服务</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">if</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;(ret&nbsp;!=&nbsp;0)&nbsp;&#123;&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(<span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">&quot;Create&nbsp;pthread&nbsp;error!&#92;n&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">);&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit(1);&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125;&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #2e8b57; background-color: inherit" class="datatypes">int</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;stdfd&nbsp;=&nbsp;open&nbsp;(</span><span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">&quot;/dev/null&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">,&nbsp;O_RDWR);&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dup2(stdfd,&nbsp;STDOUT_FILENO);&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dup2(stdfd,&nbsp;STDERR_FILENO);&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">else</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&#123;&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit(0);&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125;&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&#125;&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">return</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;0;&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&#125;&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">/**</span>&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">&nbsp;*&nbsp;启动Service</span>&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">&nbsp;*/</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">void</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;Java_com_yyh_fork_NativeRuntime_startService(JNIEnv*&nbsp;env,&nbsp;jobject&nbsp;thiz,&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jstring&nbsp;cchrptr_ProcessName,&nbsp;jstring&nbsp;sdpath)&nbsp;&#123;&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #2e8b57; background-color: inherit" class="datatypes">char</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;*&nbsp;rtn&nbsp;=&nbsp;jstringTostring(env,&nbsp;cchrptr_ProcessName);&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">//&nbsp;得到进程名称</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #2e8b57; background-color: inherit" class="datatypes">char</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;*&nbsp;sd&nbsp;=&nbsp;jstringTostring(env,&nbsp;sdpath);&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;LOGI(<span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">&quot;Java_com_yyh_fork_NativeRuntime_startService&nbsp;run....ProcessName:%s&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">,&nbsp;rtn);&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;a&nbsp;=&nbsp;rtn;&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;start(1,&nbsp;rtn,&nbsp;sd);&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&#125;&nbsp;&nbsp;</span></li></ol></div><span style="font-size: 15px; line-height: 35px; font-family: 'microsoft yahei'; color: #555555">这里有几个重点需要理解一下：</span><p style="margin: 0px; padding: 0px; color: #555555; font-family: 'microsoft yahei'; font-size: 15px; line-height: 35px"></p><p style="margin: 0px; padding: 0px; color: #555555; font-family: 'microsoft yahei'; font-size: 15px; line-height: 35px">1、为什么要fork两次？第一次fork的作用是为后面setsid服务。setsid的调用者不能是进程组组长(group leader)，而第一次调用的时候父进程是进程组组长。第二次调用后，把前面一次fork出来的子进程退出，这样第二次fork出来的子进程，就和他们脱离了关系。</p><p style="margin: 0px; padding: 0px; color: #555555; font-family: 'microsoft yahei'; font-size: 15px; line-height: 35px">2、setsid()作用是什么？setsid() 使得第二个子进程是会话组长(sid==pid)，也是进程组组长(pgid == pid)，并且脱离了原来控制终端。故不管控制终端怎么操作，新的进程正常情况下不会收到他发出来的这些信号。</p><p style="margin: 0px; padding: 0px; color: #555555; font-family: 'microsoft yahei'; font-size: 15px; line-height: 35px">3、umask(0)的作用：由于子进程从父进程继承下来的一些东西，可能并未把权限继承下来，所以要赋予他更高的权限，便于子进程操作。</p><p style="margin: 0px; padding: 0px; color: #555555; font-family: 'microsoft yahei'; font-size: 15px; line-height: 35px">4、chdir (&quot;/&quot;);作用：进程活动时，其工作目录所在的文件系统不能卸下，一般需要将工作目录改变到根目录。&nbsp;</p><p style="margin: 0px; padding: 0px; color: #555555; font-family: 'microsoft yahei'; font-size: 15px; line-height: 35px">5、进程从创建它的父进程那里继承了打开的文件描述符。如不关闭，将会浪费系统资源，造成进程所在的文件系统无法卸下以及引起无法预料的错误。所以在最后，记得关闭掉从父进程继承过来的文件描述符。</p><p style="margin: 0px; padding: 0px; color: #555555; font-family: 'microsoft yahei'; font-size: 15px; line-height: 35px">然后，在上面的代码中开启线程后做的事，就是循环去startService()，代码如下：</p><p style="margin: 0px; padding: 0px; color: #555555; font-family: 'microsoft yahei'; font-size: 15px; line-height: 35px"></p><div class="dp-highlighter bg_cpp" style="font-family: Consolas, 'Courier New', Courier, mono, serif; width: 938.516px; overflow: hidden; padding-top: 1px; position: relative; border-color: #cccccc; color: #555555; line-height: 35px; margin: 18px 0px !important; background-color: #e7e5dc"><div class="bar" style="padding-left: 45px"><div class="tools" style="padding: 3px 8px 10px 10px; font-stretch: normal; font-size: 9px; line-height: normal; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; color: silver; border-left-width: 3px; border-left-style: solid; border-left-color: #6ce26c; background-color: #f8f8f8"><strong>[cpp]</strong>&nbsp;<a style="text-decoration: none; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; color: #0c89cf; display: inline-block; width: 16px; height: 16px; text-indent: -2000px; background-image: url('http://static.blog.csdn.net/scripts/SyntaxHighlighter/styles/images/default/ico_plain.gif'); background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat" href="http://blog.csdn.net/yyh352091626/article/details/50542554#" title="view plain" class="ViewSource">view plain</a><span>&nbsp;<a style="text-decoration: none; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; color: #0c89cf; display: inline-block; width: 16px; height: 16px; text-indent: -2000px; background-image: url('http://static.blog.csdn.net/scripts/SyntaxHighlighter/styles/images/default/ico_copy.gif'); background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat" href="http://blog.csdn.net/yyh352091626/article/details/50542554#" title="copy" class="CopyToClipboard">copy</a></span><span>&nbsp;</span><span class="tracking-ad"><a style="text-decoration: none; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; color: #0c89cf; display: inline-block; width: 16px; height: 16px; background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat" href="https://code.csdn.net/snippets/1565940" target="_blank" title="在CODE上查看代码片"><img style="border: none; position: relative; top: 1px; left: 2px" src="https://code.csdn.net/assets/CODE_ico.png" border="0" alt="在CODE上查看代码片" width="12" height="12" /></a></span><span class="tracking-ad"><a style="text-decoration: none; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; color: #0c89cf; display: inline-block; width: 16px; height: 16px; background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat" href="https://code.csdn.net/snippets/1565940/fork" target="_blank" title="派生到我的代码片"><img style="border: none; position: relative; top: 2px; left: 2px" src="https://code.csdn.net/assets/ico_fork.svg" border="0" alt="派生到我的代码片" width="12" height="12" /></a></span></div></div><ol class="dp-cpp" style="padding: 0px; border: none; color: #5c5c5c; margin: 0px 0px 1px 45px !important; background-color: #ffffff"><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">void</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">thread</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">(</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #2e8b57; background-color: inherit" class="datatypes">char</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">*&nbsp;srvname)&nbsp;&#123;&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">while</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">(1)&#123;&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;check_and_restart_service(srvname);&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sleep(4);&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&#125;&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&#125;&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">/**</span>&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">&nbsp;*&nbsp;检测服务，如果不存在服务则启动.</span>&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">&nbsp;*&nbsp;通过am命令启动一个laucher服务,由laucher服务负责进行主服务的检测,laucher服务在检测后自动退出</span>&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">&nbsp;*/</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">void</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;check_and_restart_service(</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #2e8b57; background-color: inherit" class="datatypes">char</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">*&nbsp;service)&nbsp;&#123;&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;LOGI(<span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">&quot;当前所在的进程pid=&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">,getpid());&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #2e8b57; background-color: inherit" class="datatypes">char</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;cmdline[200];&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;sprintf(cmdline,&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">&quot;am&nbsp;startservice&nbsp;--user&nbsp;0&nbsp;-n&nbsp;%s&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">,&nbsp;service);&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #2e8b57; background-color: inherit" class="datatypes">char</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;tmp[200];&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;sprintf(tmp,&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">&quot;cmd=%s&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">,&nbsp;cmdline);&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;ExecuteCommandWithPopen(cmdline,&nbsp;tmp,&nbsp;200);&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;LOGI(&nbsp;tmp,&nbsp;LOG);&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&#125;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">/**</span>&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">&nbsp;*&nbsp;执行命令</span>&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">&nbsp;*/</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">void</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;ExecuteCommandWithPopen(</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #2e8b57; background-color: inherit" class="datatypes">char</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">*&nbsp;command,&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #2e8b57; background-color: inherit" class="datatypes">char</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">*&nbsp;out_result,&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #2e8b57; background-color: inherit" class="datatypes">int</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;resultBufferSize)&nbsp;&#123;&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #2e8b57; background-color: inherit" class="datatypes">FILE</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;*&nbsp;fp;&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;out_result[resultBufferSize&nbsp;-&nbsp;1]&nbsp;=&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">'&#92;0'</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">;&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;fp&nbsp;=&nbsp;popen(command,&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">&quot;r&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">);&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">if</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;(fp)&nbsp;&#123;&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fgets(out_result,&nbsp;resultBufferSize&nbsp;-&nbsp;1,&nbsp;fp);&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;out_result[resultBufferSize&nbsp;-&nbsp;1]&nbsp;=&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">'&#92;0'</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">;&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pclose(fp);&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&#125;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">else</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&#123;&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGI(<span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">&quot;popen&nbsp;null,so&nbsp;exit&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">);&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit(0);&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&#125;&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&#125;&nbsp;&nbsp;</span></li></ol></div><p style="margin: 0px; padding: 0px; color: #555555; font-family: 'microsoft yahei'; font-size: 15px; line-height: 35px">这两个启动服务的函数，里面就涉及到一些Android和linux的命令了，这里我就不细说了。特别是am，挺强大的功能的，不仅可以开启服务，也可以开启广播等等...然后调用ndk-build命令进行编译，生成so库，ndk不会的，自行百度咯~</p><p style="margin: 0px; padding: 0px; color: #555555; font-family: 'microsoft yahei'; font-size: 15px; line-height: 35px; text-align: center"><img style="border: none; max-width: 602px; height: auto" src="http://img.blog.csdn.net/20160119155020137?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" border="0" height="200" /><br /></p><p style="margin: 0px; padding: 0px; color: #555555; font-family: 'microsoft yahei'; font-size: 15px; line-height: 35px">C/C++端关键的部分主要是以上这些，自然而然，Java端还得配合执行。</p><p style="margin: 0px; padding: 0px; color: #555555; font-family: 'microsoft yahei'; font-size: 15px; line-height: 35px">首先来看一下C/C++代码编译完的so库的加载类，以及native的调用：</p><p style="margin: 0px; padding: 0px; color: #555555; font-family: 'microsoft yahei'; font-size: 15px; line-height: 35px"></p><div class="dp-highlighter bg_java" style="font-family: Consolas, 'Courier New', Courier, mono, serif; width: 938.516px; overflow: hidden; padding-top: 1px; position: relative; border-color: #cccccc; color: #555555; line-height: 35px; margin: 18px 0px !important; background-color: #e7e5dc"><div class="bar" style="padding-left: 45px"><div class="tools" style="padding: 3px 8px 10px 10px; font-stretch: normal; font-size: 9px; line-height: normal; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; color: silver; border-left-width: 3px; border-left-style: solid; border-left-color: #6ce26c; background-color: #f8f8f8"><strong>[java]</strong>&nbsp;<a style="text-decoration: none; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; color: #0c89cf; display: inline-block; width: 16px; height: 16px; text-indent: -2000px; background-image: url('http://static.blog.csdn.net/scripts/SyntaxHighlighter/styles/images/default/ico_plain.gif'); background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat" href="http://blog.csdn.net/yyh352091626/article/details/50542554#" title="view plain" class="ViewSource">view plain</a><span>&nbsp;<a style="text-decoration: none; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; color: #0c89cf; display: inline-block; width: 16px; height: 16px; text-indent: -2000px; background-image: url('http://static.blog.csdn.net/scripts/SyntaxHighlighter/styles/images/default/ico_copy.gif'); background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat" href="http://blog.csdn.net/yyh352091626/article/details/50542554#" title="copy" class="CopyToClipboard">copy</a></span><span>&nbsp;</span><span class="tracking-ad"><a style="text-decoration: none; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; color: #0c89cf; display: inline-block; width: 16px; height: 16px; background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat" href="https://code.csdn.net/snippets/1565940" target="_blank" title="在CODE上查看代码片"><img style="border: none; position: relative; top: 1px; left: 2px" src="https://code.csdn.net/assets/CODE_ico.png" border="0" alt="在CODE上查看代码片" width="12" height="12" /></a></span><span class="tracking-ad"><a style="text-decoration: none; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; color: #0c89cf; display: inline-block; width: 16px; height: 16px; background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat" href="https://code.csdn.net/snippets/1565940/fork" target="_blank" title="派生到我的代码片"><img style="border: none; position: relative; top: 2px; left: 2px" src="https://code.csdn.net/assets/ico_fork.svg" border="0" alt="派生到我的代码片" width="12" height="12" /></a></span></div></div><ol class="dp-j" style="padding: 0px; border: none; color: #5c5c5c; margin: 0px 0px 1px 45px !important; background-color: #ffffff"><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">package</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;com.yyh.fork;&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">import</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;java.io.DataInputStream;&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">import</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;java.io.DataOutputStream;&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">import</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;java.io.File;&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">public</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">class</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;NativeRuntime&nbsp;&#123;&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">private</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">static</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;NativeRuntime&nbsp;theInstance&nbsp;=&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">null</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">;&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">private</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;NativeRuntime()&nbsp;&#123;&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&#125;&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">public</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">static</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;NativeRuntime&nbsp;getInstance()&nbsp;&#123;&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">if</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;(theInstance&nbsp;==&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">null</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">)&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;theInstance&nbsp;=&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">new</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;NativeRuntime();&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">return</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;theInstance;&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&#125;&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">/**</span>&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;RunExecutable&nbsp;启动一个可自行的lib*.so文件</span>&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@date&nbsp;2016-1-18&nbsp;下午8:22:28</span>&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;pacaageName</span>&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;filename</span>&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;alias&nbsp;别名</span>&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;args&nbsp;参数</span>&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return</span>&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">public</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;String&nbsp;RunExecutable(String&nbsp;pacaageName,&nbsp;String&nbsp;filename,&nbsp;String&nbsp;alias,&nbsp;String&nbsp;args)&nbsp;&#123;&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;path&nbsp;=&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">&quot;/data/data/&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;+&nbsp;pacaageName;&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;cmd1&nbsp;=&nbsp;path&nbsp;+&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">&quot;/lib/&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;+&nbsp;filename;&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;cmd2&nbsp;=&nbsp;path&nbsp;+&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">&quot;/&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;+&nbsp;alias;&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;cmd2_a1&nbsp;=&nbsp;path&nbsp;+&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">&quot;/&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;+&nbsp;alias&nbsp;+&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">&quot;&nbsp;&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;+&nbsp;args;&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;cmd3&nbsp;=&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">&quot;chmod&nbsp;777&nbsp;&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;+&nbsp;cmd2;&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;cmd4&nbsp;=&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">&quot;dd&nbsp;if=&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;+&nbsp;cmd1&nbsp;+&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">&quot;&nbsp;of=&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;+&nbsp;cmd2;&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;StringBuffer&nbsp;sb_result&nbsp;=&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">new</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;StringBuffer();&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">if</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;(!</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">new</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;File(</span><span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">&quot;/data/data/&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;+&nbsp;alias).exists())&nbsp;&#123;&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RunLocalUserCommand(pacaageName,&nbsp;cmd4,&nbsp;sb_result);&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">//&nbsp;拷贝lib/libtest.so到上一层目录,同时命名为test.</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sb_result.append(<span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">&quot;;&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">);&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125;&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RunLocalUserCommand(pacaageName,&nbsp;cmd3,&nbsp;sb_result);&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">//&nbsp;改变test的属性,让其变为可执行</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sb_result.append(<span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">&quot;;&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">);&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RunLocalUserCommand(pacaageName,&nbsp;cmd2_a1,&nbsp;sb_result);&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">//&nbsp;执行test程序.</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sb_result.append(<span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">&quot;;&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">);&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">return</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;sb_result.toString();&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&#125;&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">/**</span>&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;执行本地用户命令</span>&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@date&nbsp;2016-1-18&nbsp;下午8:23:01</span>&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;pacaageName</span>&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;command</span>&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;sb_out_Result</span>&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return</span>&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">public</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">boolean</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;RunLocalUserCommand(String&nbsp;pacaageName,&nbsp;String&nbsp;command,&nbsp;StringBuffer&nbsp;sb_out_Result)&nbsp;&#123;&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Process&nbsp;process&nbsp;=&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">null</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">;&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">try</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&#123;&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;process&nbsp;=&nbsp;Runtime.getRuntime().exec(<span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">&quot;sh&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">);&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">//&nbsp;获得shell进程</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DataInputStream&nbsp;inputStream&nbsp;=&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">new</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;DataInputStream(process.getInputStream());&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DataOutputStream&nbsp;outputStream&nbsp;=&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">new</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;DataOutputStream(process.getOutputStream());&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;outputStream.writeBytes(<span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">&quot;cd&nbsp;/data/data/&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;+&nbsp;pacaageName&nbsp;+&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">&quot;&#92;n&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">);&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">//&nbsp;保证在command在自己的数据目录里执行,才有权限写文件到当前目录</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;outputStream.writeBytes(command&nbsp;+&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">&quot;&nbsp;&amp;&#92;n&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">);&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">//&nbsp;让程序在后台运行，前台马上返回</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;outputStream.writeBytes(<span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">&quot;exit&#92;n&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">);&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;outputStream.flush();&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;process.waitFor();&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">byte</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">[]&nbsp;buffer&nbsp;=&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">new</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">byte</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">[inputStream.available()];&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inputStream.read(buffer);&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;s&nbsp;=&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">new</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;String(buffer);&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">if</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;(sb_out_Result&nbsp;!=&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">null</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">)&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sb_out_Result.append(<span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">&quot;CMD&nbsp;Result:&#92;n&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;+&nbsp;s);&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">catch</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;(Exception&nbsp;e)&nbsp;&#123;&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">if</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;(sb_out_Result&nbsp;!=&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">null</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">)&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sb_out_Result.append(<span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">&quot;Exception:&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;+&nbsp;e.getMessage());&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">return</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">false</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">;&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125;&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">return</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">true</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">;&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&#125;&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">public</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">native</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">void</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;startActivity(String&nbsp;compname);&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">public</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">native</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;String&nbsp;stringFromJNI();&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">public</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">native</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">void</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;startService(String&nbsp;srvname,&nbsp;String&nbsp;sdpath);&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">public</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">native</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">int</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;findProcess(String&nbsp;packname);&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">public</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">native</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">int</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;stopService();&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">static</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&#123;&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">try</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&#123;&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.loadLibrary(<span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">&quot;helper&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">);&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">//&nbsp;加载so库</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">catch</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;(Exception&nbsp;e)&nbsp;&#123;&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.printStackTrace();&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125;&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&#125;&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&#125;&nbsp;&nbsp;</span></li></ol></div><span style="font-size: 15px; line-height: 35px; font-family: 'microsoft yahei'; color: #555555">然后，我们在收到开机广播后，启动该服务。</span><p style="margin: 0px; padding: 0px; color: #555555; font-family: 'microsoft yahei'; font-size: 15px; line-height: 35px"></p><div class="dp-highlighter bg_java" style="font-family: Consolas, 'Courier New', Courier, mono, serif; width: 938.516px; overflow: hidden; padding-top: 1px; position: relative; border-color: #cccccc; color: #555555; line-height: 35px; margin: 18px 0px !important; background-color: #e7e5dc"><div class="bar" style="padding-left: 45px"><div class="tools" style="padding: 3px 8px 10px 10px; font-stretch: normal; font-size: 9px; line-height: normal; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; color: silver; border-left-width: 3px; border-left-style: solid; border-left-color: #6ce26c; background-color: #f8f8f8"><strong>[java]</strong>&nbsp;<a style="text-decoration: none; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; color: #0c89cf; display: inline-block; width: 16px; height: 16px; text-indent: -2000px; background-image: url('http://static.blog.csdn.net/scripts/SyntaxHighlighter/styles/images/default/ico_plain.gif'); background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat" href="http://blog.csdn.net/yyh352091626/article/details/50542554#" title="view plain" class="ViewSource">view plain</a><span>&nbsp;<a style="text-decoration: none; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; color: #0c89cf; display: inline-block; width: 16px; height: 16px; text-indent: -2000px; background-image: url('http://static.blog.csdn.net/scripts/SyntaxHighlighter/styles/images/default/ico_copy.gif'); background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat" href="http://blog.csdn.net/yyh352091626/article/details/50542554#" title="copy" class="CopyToClipboard">copy</a></span><span>&nbsp;</span><span class="tracking-ad"><a style="text-decoration: none; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; color: #0c89cf; display: inline-block; width: 16px; height: 16px; background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat" href="https://code.csdn.net/snippets/1565940" target="_blank" title="在CODE上查看代码片"><img style="border: none; position: relative; top: 1px; left: 2px" src="https://code.csdn.net/assets/CODE_ico.png" border="0" alt="在CODE上查看代码片" width="12" height="12" /></a></span><span class="tracking-ad"><a style="text-decoration: none; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; color: #0c89cf; display: inline-block; width: 16px; height: 16px; background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat" href="https://code.csdn.net/snippets/1565940/fork" target="_blank" title="派生到我的代码片"><img style="border: none; position: relative; top: 2px; left: 2px" src="https://code.csdn.net/assets/ico_fork.svg" border="0" alt="派生到我的代码片" width="12" height="12" /></a></span></div></div><ol class="dp-j" style="padding: 0px; border: none; color: #5c5c5c; margin: 0px 0px 1px 45px !important; background-color: #ffffff"><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">package</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;com.yyh.activity;&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">import</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;android.content.BroadcastReceiver;&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">import</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;android.content.Context;&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">import</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;android.content.Intent;&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">import</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;android.util.Log;&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">import</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;com.yyh.fork.NativeRuntime;&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">import</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;com.yyh.utils.FileUtils;&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">public</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">class</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;PhoneStatReceiver&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">extends</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;BroadcastReceiver&nbsp;&#123;&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">private</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;String&nbsp;TAG&nbsp;=&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">&quot;tag&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">;&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: #646464; background-color: inherit" class="annotation">@Override</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">public</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">void</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;onReceive(Context&nbsp;context,&nbsp;Intent&nbsp;intent)&nbsp;&#123;&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">if</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;(Intent.ACTION_BOOT_COMPLETED.equals(intent.getAction()))&nbsp;&#123;&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Log.i(TAG,&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">&quot;手机开机了~~&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">);&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NativeRuntime.getInstance().startService(context.getPackageName()&nbsp;+&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">&quot;/com.yyh.service.HostMonitor&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">,&nbsp;FileUtils.createRootPath());&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">else</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">if</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;(Intent.ACTION_USER_PRESENT.equals(intent.getAction()))&nbsp;&#123;&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125;&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&#125;&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&#125;&nbsp;&nbsp;</span></li></ol></div><p style="margin: 0px; padding: 0px; color: #555555; font-family: 'microsoft yahei'; font-size: 15px; line-height: 35px">Service服务里面，就可以做该做的事情。</p><p style="margin: 0px; padding: 0px; color: #555555; font-family: 'microsoft yahei'; font-size: 15px; line-height: 35px"></p><div class="dp-highlighter bg_java" style="font-family: Consolas, 'Courier New', Courier, mono, serif; width: 938.516px; overflow: hidden; padding-top: 1px; position: relative; border-color: #cccccc; color: #555555; line-height: 35px; margin: 18px 0px !important; background-color: #e7e5dc"><div class="bar" style="padding-left: 45px"><div class="tools" style="padding: 3px 8px 10px 10px; font-stretch: normal; font-size: 9px; line-height: normal; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; color: silver; border-left-width: 3px; border-left-style: solid; border-left-color: #6ce26c; background-color: #f8f8f8"><strong>[java]</strong>&nbsp;<a style="text-decoration: none; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; color: #0c89cf; display: inline-block; width: 16px; height: 16px; text-indent: -2000px; background-image: url('http://static.blog.csdn.net/scripts/SyntaxHighlighter/styles/images/default/ico_plain.gif'); background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat" href="http://blog.csdn.net/yyh352091626/article/details/50542554#" title="view plain" class="ViewSource">view plain</a><span>&nbsp;<a style="text-decoration: none; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; color: #0c89cf; display: inline-block; width: 16px; height: 16px; text-indent: -2000px; background-image: url('http://static.blog.csdn.net/scripts/SyntaxHighlighter/styles/images/default/ico_copy.gif'); background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat" href="http://blog.csdn.net/yyh352091626/article/details/50542554#" title="copy" class="CopyToClipboard">copy</a></span><span>&nbsp;</span><span class="tracking-ad"><a style="text-decoration: none; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; color: #0c89cf; display: inline-block; width: 16px; height: 16px; background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat" href="https://code.csdn.net/snippets/1565940" target="_blank" title="在CODE上查看代码片"><img style="border: none; position: relative; top: 1px; left: 2px" src="https://code.csdn.net/assets/CODE_ico.png" border="0" alt="在CODE上查看代码片" width="12" height="12" /></a></span><span class="tracking-ad"><a style="text-decoration: none; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; color: #0c89cf; display: inline-block; width: 16px; height: 16px; background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat" href="https://code.csdn.net/snippets/1565940/fork" target="_blank" title="派生到我的代码片"><img style="border: none; position: relative; top: 2px; left: 2px" src="https://code.csdn.net/assets/ico_fork.svg" border="0" alt="派生到我的代码片" width="12" height="12" /></a></span></div></div><ol class="dp-j" style="padding: 0px; border: none; color: #5c5c5c; margin: 0px 0px 1px 45px !important; background-color: #ffffff"><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">package</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;com.yyh.service;&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">import</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;android.app.Service;&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">import</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;android.content.Intent;&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">import</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;android.os.IBinder;&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">import</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;android.util.Log;&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">public</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">class</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;HostMonitor&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">extends</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;Service&nbsp;&#123;&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: #646464; background-color: inherit" class="annotation">@Override</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">public</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">void</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;onCreate()&nbsp;&#123;&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">super</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">.onCreate();&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Log.i(<span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">&quot;daemon_java&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">,&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">&quot;HostMonitor:&nbsp;onCreate!&nbsp;I&nbsp;can&nbsp;not&nbsp;be&nbsp;Killed!&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">);&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&#125;&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: #646464; background-color: inherit" class="annotation">@Override</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">public</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">int</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;onStartCommand(Intent&nbsp;intent,&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">int</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;flags,&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">int</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;startId)&nbsp;&#123;&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Log.i(<span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">&quot;daemon_java&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">,&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">&quot;HostMonitor:&nbsp;onStartCommand!&nbsp;I&nbsp;can&nbsp;not&nbsp;be&nbsp;Killed!&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">);&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">return</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">super</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">.onStartCommand(intent,&nbsp;flags,&nbsp;startId);&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&#125;&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: #646464; background-color: inherit" class="annotation">@Override</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">public</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;IBinder&nbsp;onBind(Intent&nbsp;arg0)&nbsp;&#123;&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">return</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">null</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">;&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&#125;&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&#125;&nbsp;&nbsp;</span></li></ol></div><span style="font-size: 15px; line-height: 35px; font-family: 'microsoft yahei'; color: #555555">当然，也不要忘记在Manifest.xml文件配置receiver和service：</span><p style="margin: 0px; padding: 0px; color: #555555; font-family: 'microsoft yahei'; font-size: 15px; line-height: 35px"></p><p style="margin: 0px; padding: 0px; color: #555555; font-family: 'microsoft yahei'; font-size: 15px; line-height: 35px"></p><div class="dp-highlighter bg_html" style="font-family: Consolas, 'Courier New', Courier, mono, serif; width: 938.516px; overflow: hidden; padding-top: 1px; position: relative; border-color: #cccccc; color: #555555; line-height: 35px; margin: 18px 0px !important; background-color: #e7e5dc"><div class="bar" style="padding-left: 45px"><div class="tools" style="padding: 3px 8px 10px 10px; font-stretch: normal; font-size: 9px; line-height: normal; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; color: silver; border-left-width: 3px; border-left-style: solid; border-left-color: #6ce26c; background-color: #f8f8f8"><strong>[html]</strong>&nbsp;<a style="text-decoration: none; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; color: #0c89cf; display: inline-block; width: 16px; height: 16px; text-indent: -2000px; background-image: url('http://static.blog.csdn.net/scripts/SyntaxHighlighter/styles/images/default/ico_plain.gif'); background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat" href="http://blog.csdn.net/yyh352091626/article/details/50542554#" title="view plain" class="ViewSource">view plain</a><span>&nbsp;<a style="text-decoration: none; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; color: #0c89cf; display: inline-block; width: 16px; height: 16px; text-indent: -2000px; background-image: url('http://static.blog.csdn.net/scripts/SyntaxHighlighter/styles/images/default/ico_copy.gif'); background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat" href="http://blog.csdn.net/yyh352091626/article/details/50542554#" title="copy" class="CopyToClipboard">copy</a></span><span>&nbsp;</span><span class="tracking-ad"><a style="text-decoration: none; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; color: #0c89cf; display: inline-block; width: 16px; height: 16px; background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat" href="https://code.csdn.net/snippets/1565940" target="_blank" title="在CODE上查看代码片"><img style="border: none; position: relative; top: 1px; left: 2px" src="https://code.csdn.net/assets/CODE_ico.png" border="0" alt="在CODE上查看代码片" width="12" height="12" /></a></span><span class="tracking-ad"><a style="text-decoration: none; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; color: #0c89cf; display: inline-block; width: 16px; height: 16px; background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat" href="https://code.csdn.net/snippets/1565940/fork" target="_blank" title="派生到我的代码片"><img style="border: none; position: relative; top: 2px; left: 2px" src="https://code.csdn.net/assets/ico_fork.svg" border="0" alt="派生到我的代码片" width="12" height="12" /></a></span></div></div><ol class="dp-xml" style="padding: 0px; border: none; color: #5c5c5c; margin: 0px 0px 1px 45px !important; background-color: #ffffff"><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #993300; background-color: inherit" class="tag">&lt;</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #993300; background-color: inherit" class="tag-name">receiver</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: red; background-color: inherit" class="attribute">android:name</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">=</span><span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="attribute-value">&quot;com.yyh.activity.PhoneStatReceiver&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: red; background-color: inherit" class="attribute">android:enabled</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">=</span><span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="attribute-value">&quot;true&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: red; background-color: inherit" class="attribute">android:permission</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">=</span><span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="attribute-value">&quot;android.permission.RECEIVE_BOOT_COMPLETED&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #993300; background-color: inherit" class="tag">&gt;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #993300; background-color: inherit" class="tag">&lt;</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #993300; background-color: inherit" class="tag-name">intent-filter</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #993300; background-color: inherit" class="tag">&gt;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #993300; background-color: inherit" class="tag">&lt;</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #993300; background-color: inherit" class="tag-name">action</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; color: red; background-color: inherit" class="attribute">android:name</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">=</span><span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="attribute-value">&quot;android.intent.action.BOOT_COMPLETED&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #993300; background-color: inherit" class="tag">/&gt;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #993300; background-color: inherit" class="tag">&lt;</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #993300; background-color: inherit" class="tag-name">action</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; color: red; background-color: inherit" class="attribute">android:name</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">=</span><span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="attribute-value">&quot;android.intent.action.USER_PRESENT&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #993300; background-color: inherit" class="tag">/&gt;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #993300; background-color: inherit" class="tag">&lt;/</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #993300; background-color: inherit" class="tag-name">intent-filter</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #993300; background-color: inherit" class="tag">&gt;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #993300; background-color: inherit" class="tag">&lt;/</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #993300; background-color: inherit" class="tag-name">receiver</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #993300; background-color: inherit" class="tag">&gt;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #993300; background-color: inherit" class="tag">&lt;</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #993300; background-color: inherit" class="tag-name">service</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; color: red; background-color: inherit" class="attribute">android:name</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">=</span><span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="attribute-value">&quot;com.yyh.service.HostMonitor&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: red; background-color: inherit" class="attribute">android:enabled</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">=</span><span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="attribute-value">&quot;true&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: red; background-color: inherit" class="attribute">android:exported</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">=</span><span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="attribute-value">&quot;true&quot;</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #993300; background-color: inherit" class="tag">&gt;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #993300; background-color: inherit" class="tag">&lt;/</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #993300; background-color: inherit" class="tag-name">service</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #993300; background-color: inherit" class="tag">&gt;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li></ol></div><br /><span style="font-size: 15px; line-height: 35px; font-family: 'microsoft yahei'; color: #555555">run起来，在程序应用里面，结束掉这个进程，不一会了，又自动起来了~~~~完美~~~~跟流氓软件一个样，没错，就是这么贱，就是这么霸道！！</span><br /><p style="margin: 0px; padding: 0px; color: #555555; font-family: 'microsoft yahei'; font-size: 15px; line-height: 35px"></p><div style="color: #555555; font-family: 'microsoft yahei'; font-size: 15px; line-height: 35px; text-align: center"><img style="border: none" src="http://img.blog.csdn.net/20160119161147528?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" border="0" height="300" /></div><p style="margin: 0px; padding: 0px; color: #555555; font-family: 'microsoft yahei'; font-size: 15px; line-height: 35px"></p><p style="margin: 0px; padding: 0px; color: #555555; font-family: 'microsoft yahei'; font-size: 15px; line-height: 35px">这边是运行在谷歌的原生系统上，Android版本为5.0...不知道会不会被国内的各大ROM干掉，好紧张好紧张~~~所以，总结一下就是：服务常驻要应对的不是各种难的技术，而是各大ROM。QQ为什么不会被杀死，是因为国内各大ROM不想让他死...</p><p style="margin: 0px; padding: 0px; color: #555555; font-family: 'microsoft yahei'; font-size: 15px; line-height: 35px"></p><p style="margin: 0px; padding: 0px; color: #555555; font-family: 'microsoft yahei'; font-size: 15px; line-height: 35px">最后附上本例的源代码：<a style="text-decoration: none; color: #0c89cf" href="http://download.csdn.net/detail/yyh352091626/9410153" target="_blank">Android 通过JNI实现双守护进程，保证服务不被杀死 源码</a></p>
]]>
</description>
</item><item>
<link>http://i.renjihe.com/blog/read.php?7407</link>
<title><![CDATA[android 下 cocos2dx 后台黑屏的解决办法]]></title> 
<author>renjihe1988 &lt;admin@yourname.com&gt;</author>
<category><![CDATA[Android]]></category>
<pubDate>Sat, 23 Jul 2016 08:05:57 +0000</pubDate> 
<guid>http://i.renjihe.com/blog/read.php?7407</guid> 
<description>
<![CDATA[ 
	<span style="font-size: 14px; line-height: 21px; font-family: tahoma, arial, 宋体">问题描述：</span><br /><br /><pre style="margin-top: 0px; margin-bottom: 10.5px; padding: 10px; font-size: 14px; line-height: 1.45; word-break: break-all; word-wrap: break-word; color: #333333; border: 1px solid rgba(128, 128, 128, 0.0745098); border-radius: 5px; overflow: auto; background-color: rgba(128, 128, 128, 0.0470588)">[code]1.运行游戏，无问题2.游戏点击网站链接，或进入后台，回来黑屏3.eclipse控制台报错：&nbsp;&nbsp;03-01 17:51:55.347: W/Adreno-ES20(8664): &lt;__load_uniform_matrix:1091&gt;: GL_INVALID_OPERATION&nbsp;&nbsp;03-01 17:51:55.347: D/cocos2d-x debug info(8664): OpenGL error 0x0502 in /Applications/android/cocos2dx/cocos2dx_v2/cocos2dx/sprite_nodes/CCSprite.cpp draw 5844.可以操作，可以进行触碰操作，反馈声音也存在，只是不显示画面，十分诡异</pre><br /><br /><h2 style="margin: 0px; padding: 0px; font-size: 14px; font-weight: 500; font-family: tahoma, arial, 宋体; line-height: 21px">解决方案</h2><span style="font-size: 14px; line-height: 21px; font-family: tahoma, arial, 宋体">本人并不能代表解决安卓下所有黑屏问题， 但是本人已查询大量的资料， 以及富有经验的 lcg_ryan 同事的帮助， 协力解决了黑屏问题</span><br /><br /><span style="font-size: 14px; line-height: 21px; font-family: tahoma, arial, 宋体">网上各种搜集关键字： GL_INVALID_OPERATION， OpenGL error 0x0502， 以及 cocos2dx 错误</span><br /><br /><h2 style="margin: 0px; padding: 0px; font-size: 14px; font-weight: 500; font-family: tahoma, arial, 宋体; line-height: 21px">解决方案1： 游戏源码</h2><span style="font-size: 14px; line-height: 21px; font-family: tahoma, arial, 宋体">c++代码问题， 从c++端代码处修复</span><br /><br /><span style="font-size: 14px; line-height: 21px; font-family: tahoma, arial, 宋体">下列代码的使用与否，反复测试和黑屏无关， 从c++端代码入手失败</span><br /><br /><pre style="margin-top: 0px; margin-bottom: 10.5px; padding: 10px; font-size: 14px; line-height: 1.45; word-break: break-all; word-wrap: break-word; color: #333333; border: 1px solid rgba(128, 128, 128, 0.0745098); border-radius: 5px; overflow: auto; background-color: rgba(128, 128, 128, 0.0470588)">[code]void AppDelegate::applicationDidEnterBackground()&#123;&nbsp;&nbsp;&nbsp;&nbsp;CCDirector::sharedDirector()-&gt;stopAnimation();&nbsp;&nbsp;&nbsp;&nbsp;SimpleAudioEngine::sharedEngine()-&gt;pauseBackgroundMusic();&nbsp;&nbsp;&nbsp;&nbsp;SimpleAudioEngine::sharedEngine()-&gt;pauseAllEffects();&#125;void AppDelegate::applicationWillEnterForeground()&#123;&nbsp;&nbsp;&nbsp;&nbsp;CCDirector::sharedDirector()-&gt;startAnimation();&nbsp;&nbsp;&nbsp;&nbsp;SimpleAudioEngine::sharedEngine()-&gt;resumeBackgroundMusic();&nbsp;&nbsp;&nbsp;&nbsp;SimpleAudioEngine::sharedEngine()-&gt;resumeAllEffects();&#125;</pre><br /><br /><h2 style="margin: 0px; padding: 0px; font-size: 14px; font-weight: 500; font-family: tahoma, arial, 宋体; line-height: 21px">解决方案2：引擎源码</h2><span style="font-size: 14px; line-height: 21px; font-family: tahoma, arial, 宋体">同样为c++方案解决方式，通过修改cocos2dx引擎来解决问题， 来自 zu12jing 的解决方案，结果同样无法解决问题</span><br /><br /><pre style="margin-top: 0px; margin-bottom: 10.5px; padding: 10px; font-size: 14px; line-height: 1.45; word-break: break-all; word-wrap: break-word; color: #333333; border: 1px solid rgba(128, 128, 128, 0.0745098); border-radius: 5px; overflow: auto; background-color: rgba(128, 128, 128, 0.0470588)">[code]1.cocos2dx/platform/CCPlatformMacros.h将#define CC_ENABLE_CACHE_TEXTURE_DATA 1 修改为02.cocos2dx/platform/android/java/src/org/cocos2dx/lib/Cocos2dxGLSurfaceView.java注释掉super.onPause()&nbsp;&nbsp;//2.2.6已注释掉3.android工程目录下jin/hellocpp/main.cpp注释掉else后面的所有代码 //2.2.6已注释掉</pre><br /><br /><h2 style="margin: 0px; padding: 0px; font-size: 14px; font-weight: 500; font-family: tahoma, arial, 宋体; line-height: 21px">解决方案3：修改AndroidManifest.xml配置文件</h2><span style="font-size: 14px; line-height: 21px; font-family: tahoma, arial, 宋体">修改android下的manifest配置文件， 来自 lcg_ryan 的解决方案， 在屏幕变化时会导致cocos2dx重绘，但本人的黑屏无法用此方案解决</span><br /><br /><pre style="margin-top: 0px; margin-bottom: 10.5px; padding: 10px; font-size: 14px; line-height: 1.45; word-break: break-all; word-wrap: break-word; color: #333333; border: 1px solid rgba(128, 128, 128, 0.0745098); border-radius: 5px; overflow: auto; background-color: rgba(128, 128, 128, 0.0470588)">[code]给activity增加android:configChanges=&quot;orientation&#124;keyboardHidden&#124;screenSize&#124;smallestScreenSize&#124;navigation&#124;screenLayout&quot;</pre><br /><br /><h2 style="margin: 0px; padding: 0px; font-size: 14px; font-weight: 500; font-family: tahoma, arial, 宋体; line-height: 21px">解决方案4：更改适配版本</h2><span style="font-size: 14px; line-height: 21px; font-family: tahoma, arial, 宋体">修改android下的manifest配置文件，更改适配版本, 无效</span><br /><br /><pre style="margin-top: 0px; margin-bottom: 10.5px; padding: 10px; font-size: 14px; line-height: 1.45; word-break: break-all; word-wrap: break-word; color: #333333; border: 1px solid rgba(128, 128, 128, 0.0745098); border-radius: 5px; overflow: auto; background-color: rgba(128, 128, 128, 0.0470588)">[code]从 14 改为 8android:minSdkVersion=&quot;14&quot;</pre><br /><br /><h2 style="margin: 0px; padding: 0px; font-size: 14px; font-weight: 500; font-family: tahoma, arial, 宋体; line-height: 21px">解决方案5: 清理缓存</h2><span style="font-size: 14px; line-height: 21px; font-family: tahoma, arial, 宋体">清空缓存，三清下面的目录，重新生成cocos2dx缓存还是不行</span><br /><br /><pre style="margin-top: 0px; margin-bottom: 10.5px; padding: 10px; font-size: 14px; line-height: 1.45; word-break: break-all; word-wrap: break-word; color: #333333; border: 1px solid rgba(128, 128, 128, 0.0745098); border-radius: 5px; overflow: auto; background-color: rgba(128, 128, 128, 0.0470588)">[code]/proj.android/assets/proj.android/libs/proj.android/obj</pre><br /><br /><h2 style="margin: 0px; padding: 0px; font-size: 14px; font-weight: 500; font-family: tahoma, arial, 宋体; line-height: 21px">解决方案6：更改另一些配置</h2><span style="font-size: 14px; line-height: 21px; font-family: tahoma, arial, 宋体">更改manifest一些其他配置</span><br /><br /><pre style="margin-top: 0px; margin-bottom: 10.5px; padding: 10px; font-size: 14px; line-height: 1.45; word-break: break-all; word-wrap: break-word; color: #333333; border: 1px solid rgba(128, 128, 128, 0.0745098); border-radius: 5px; overflow: auto; background-color: rgba(128, 128, 128, 0.0470588)">[code]1.删掉 (完全没有这个项目)android:noHistory=&quot;true&quot;2.添加singleInstance属性 (无效)android:launchMode=&quot;singleInstance&quot;</pre><br /><br /><h2 style="margin: 0px; padding: 0px; font-size: 14px; font-weight: 500; font-family: tahoma, arial, 宋体; line-height: 21px">解决方案7：修改安卓开发者配置</h2><span style="font-size: 14px; line-height: 21px; font-family: tahoma, arial, 宋体">在 black screen when returning from background 这个帖子下找到了最后的老外回答&nbsp;</span><br /><br /><span style="font-size: 14px; line-height: 21px; font-family: tahoma, arial, 宋体">1. Go to &lsquo;Settings&rsquo;&nbsp;</span><br /><br /><span style="font-size: 14px; line-height: 21px; font-family: tahoma, arial, 宋体">2. Select &lsquo;Developer Options&rsquo;&nbsp;</span><br /><br /><span style="font-size: 14px; line-height: 21px; font-family: tahoma, arial, 宋体">3. Uncheck &lsquo;Do not keep activities&rsquo;</span><br /><br /><pre style="margin-top: 0px; margin-bottom: 10.5px; padding: 10px; font-size: 14px; line-height: 1.45; word-break: break-all; word-wrap: break-word; color: #333333; border: 1px solid rgba(128, 128, 128, 0.0745098); border-radius: 5px; overflow: auto; background-color: rgba(128, 128, 128, 0.0470588)">[code]死马当活马医，试一试的态度我打开了开发者选项，拉到最底，发现&ldquo;不保留活动&rdquo;处于开启状态，关闭后游戏运行正常，调试正常我想当初开启它是为了用的时候节能省电，不过从这个方面考虑，我并没有从根本上解决程序在此模式下完美运行的方式，所以，如果你解决了这个世纪难题，请在下方留言给出答复，谢谢各位朋友</pre>
]]>
</description>
</item><item>
<link>http://i.renjihe.com/blog/read.php?7406</link>
<title><![CDATA[android安全：forceStopPackage对Alarm的影响]]></title> 
<author>renjihe1988 &lt;admin@yourname.com&gt;</author>
<category><![CDATA[Android]]></category>
<pubDate>Sat, 23 Jul 2016 08:05:14 +0000</pubDate> 
<guid>http://i.renjihe.com/blog/read.php?7406</guid> 
<description>
<![CDATA[ 
	<p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px">尊重原创作者，转载请注明出处：</span></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px">http://blog.csdn.net/gemmem/article/details/8858461<br /></span></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px"><br /></span></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px">也许一些使用alarmmanager做定时任务的同学遇到过这样的问题：设定alarm后，进入设置--&gt;应用程序管理--&gt;强行停止app后，定时任务就失效了。</span></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px"><br /></span></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px">简单的讲就是：force stop会导致alarm失效。</span></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px"><br /></span></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px">最典型的例子就是我碰到过的一个bug，使用<a style="color: #df3434; text-decoration: none; font-weight: bold" href="http://lib.csdn.net/base/15" target="_blank" title="undefined" class="replace_word">Android</a>手机的时钟app设置一个闹钟，然后进入设置--&gt;应用程序管理里面，将时钟这个app force stop掉，结果闹钟就不响了。</span></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px"><br /></span></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px">其实这不是bug，这是android系统的新加入的机制。下面我来详细分析一下来龙去脉。</span></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px"><br /></span></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px">1. 在设置的应用程序管理里面强行停止app:</span></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px">&nbsp;&nbsp;&nbsp;&nbsp;这里会最终会调用到 ActivityManagerService的forceStopPackageLocked（）</span></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px">源代码如下：</span></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"></p><div class="dp-highlighter bg_java" style="font-family: Consolas, 'Courier New', Courier, mono, serif; width: 700.906px; overflow-y: hidden; overflow-x: auto; padding-top: 1px; position: relative; color: #333333; line-height: 26px; margin: 18px 0px !important; background-color: #e7e5dc"><div class="bar" style="padding-left: 45px"><div class="tools" style="padding: 3px 8px 10px 10px; font-stretch: normal; font-size: 9px; line-height: normal; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; color: silver; border-left-width: 3px; border-left-style: solid; border-left-color: #6ce26c; background-color: #f8f8f8"><strong>[java]</strong> <a style="color: #a0a0a0; text-decoration: none; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; display: inline-block; width: 16px; height: 16px; text-indent: -2000px; background-image: url('http://static.blog.csdn.net/scripts/SyntaxHighlighter/styles/images/default/ico_plain.gif'); background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat" href="http://blog.csdn.net/gemmem/article/details/8858461#" title="view plain" class="ViewSource">view plain</a><span> <a style="color: #a0a0a0; text-decoration: none; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; display: inline-block; width: 16px; height: 16px; text-indent: -2000px; background-image: url('http://static.blog.csdn.net/scripts/SyntaxHighlighter/styles/images/default/ico_copy.gif'); background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat" href="http://blog.csdn.net/gemmem/article/details/8858461#" title="copy" class="CopyToClipboard">copy</a></span></div></div><ol class="dp-j" style="padding: 0px; border: none; color: #5c5c5c; margin: 0px 0px 1px 45px !important; background-color: #ffffff"><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&lt;span style=</span><span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">&quot;font-size:18px;&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&gt;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">private</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit"> </span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">void</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit"> forceStopPackageLocked(</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">final</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit"> String packageName, </span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">int</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit"> uid) &#123;&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;forceStopPackageLocked(packageName, uid, <span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">false</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">, </span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">false</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">, </span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">true</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">, </span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">false</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">);&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Intent intent = <span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">new</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit"> Intent(Intent.ACTION_PACKAGE_RESTARTED,&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Uri.fromParts(<span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">&quot;package&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">, packageName, </span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">null</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">));&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">if</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit"> (!mProcessesReady) &#123;&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;intent.addFlags(Intent.FLAG_RECEIVER_REGISTERED_ONLY);&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125;&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;intent.putExtra(Intent.EXTRA_UID, uid);&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;broadcastIntentLocked(<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">null</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">, </span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">null</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">, intent,&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">null</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">, </span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">null</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">, </span><span style="margin: 0px; padding: 0px; border: none; color: #c00000; background-color: inherit" class="number">0</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">, </span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">null</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">, </span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">null</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">, </span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">null</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">,&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">false</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">, </span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">false</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">, MY_PID, Process.SYSTEM_UID);&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&#125;&lt;/span&gt;&nbsp;&nbsp;</span></li></ol></div><span style="line-height: 26px; font-size: 18px; font-family: Arial; color: #333333"><br /><span style="color: #ff0000"><strong>代码里面发送了一个广播：ACTION_PACKAGE_RESTARTED，这个广播大有文章</strong></span>。</span><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px">2. 再看看AlarmManagerService.java的代码，可以看一个内部类UninstallReceiver</span></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px">源代码如下：</span></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"></p><div class="dp-highlighter bg_java" style="font-family: Consolas, 'Courier New', Courier, mono, serif; width: 700.906px; overflow-y: hidden; overflow-x: auto; padding-top: 1px; position: relative; color: #333333; line-height: 26px; margin: 18px 0px !important; background-color: #e7e5dc"><div class="bar" style="padding-left: 45px"><div class="tools" style="padding: 3px 8px 10px 10px; font-stretch: normal; font-size: 9px; line-height: normal; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; color: silver; border-left-width: 3px; border-left-style: solid; border-left-color: #6ce26c; background-color: #f8f8f8"><strong>[java]</strong> <a style="color: #a0a0a0; text-decoration: none; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; display: inline-block; width: 16px; height: 16px; text-indent: -2000px; background-image: url('http://static.blog.csdn.net/scripts/SyntaxHighlighter/styles/images/default/ico_plain.gif'); background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat" href="http://blog.csdn.net/gemmem/article/details/8858461#" title="view plain" class="ViewSource">view plain</a><span> <a style="color: #a0a0a0; text-decoration: none; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; display: inline-block; width: 16px; height: 16px; text-indent: -2000px; background-image: url('http://static.blog.csdn.net/scripts/SyntaxHighlighter/styles/images/default/ico_copy.gif'); background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat" href="http://blog.csdn.net/gemmem/article/details/8858461#" title="copy" class="CopyToClipboard">copy</a></span></div></div><ol class="dp-j" style="padding: 0px; border: none; color: #5c5c5c; margin: 0px 0px 1px 45px !important; background-color: #ffffff"><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&lt;span style=</span><span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">&quot;font-size:18px;&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&gt;</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">class</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit"> UninstallReceiver </span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">extends</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit"> BroadcastReceiver &#123;&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">public</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit"> UninstallReceiver() &#123;&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IntentFilter filter = <span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">new</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit"> IntentFilter();&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;filter.addAction(Intent.ACTION_PACKAGE_REMOVED);&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;filter.addAction(Intent.ACTION_PACKAGE_RESTARTED);&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;filter.addAction(Intent.ACTION_QUERY_PACKAGE_RESTART);&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;filter.addDataScheme(<span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">&quot;package&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">);&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mContext.registerReceiver(<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">this</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">, filter);&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">// Register for events related to sdcard installation.</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IntentFilter sdFilter = <span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">new</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit"> IntentFilter();&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sdFilter.addAction(Intent.ACTION_EXTERNAL_APPLICATIONS_UNAVAILABLE);&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mContext.registerReceiver(<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">this</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">, sdFilter);&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125;&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: #646464; background-color: inherit" class="annotation">@Override</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">public</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit"> </span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">void</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit"> onReceive(Context context, Intent intent) &#123;&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">synchronized</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit"> (mLock) &#123;&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String action = intent.getAction();&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String pkgList[] = <span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">null</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">;&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">if</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit"> (Intent.ACTION_QUERY_PACKAGE_RESTART.equals(action)) &#123;&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pkgList = intent.getStringArrayExtra(Intent.EXTRA_PACKAGES);&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">for</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit"> (String packageName : pkgList) &#123;&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">if</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit"> (lookForPackageLocked(packageName)) &#123;&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setResultCode(Activity.RESULT_OK);&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">return</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">;&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125;&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125;&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">return</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">;&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125; <span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">else</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit"> </span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">if</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit"> (Intent.ACTION_EXTERNAL_APPLICATIONS_UNAVAILABLE.equals(action)) &#123;&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pkgList = intent.getStringArrayExtra(Intent.EXTRA_CHANGED_PACKAGE_LIST);&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125; <span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">else</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit"> &#123;&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">if</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit"> (Intent.ACTION_PACKAGE_REMOVED.equals(action)&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;&amp; intent.getBooleanExtra(Intent.EXTRA_REPLACING, <span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">false</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">)) &#123;&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">// This package is being updated; don't kill its alarms.</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">return</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">;&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125;&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Uri data = intent.getData();&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">if</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit"> (data != </span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">null</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">) &#123;&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String pkg = data.getSchemeSpecificPart();&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">if</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit"> (pkg != </span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">null</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">) &#123;&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pkgList = <span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">new</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit"> String[]&#123;pkg&#125;;&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125;&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125;&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125;&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">if</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit"> (pkgList != </span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">null</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit"> &amp;&amp; (pkgList.length &gt; </span><span style="margin: 0px; padding: 0px; border: none; color: #c00000; background-color: inherit" class="number">0</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">)) &#123;&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">for</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit"> (String pkg : pkgList) &#123;&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;removeLocked(pkg);&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mBroadcastStats.remove(pkg);&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125;&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125;&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125;&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125;&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&#125;&lt;/span&gt;&nbsp;&nbsp;</span></li></ol></div><span style="line-height: 26px; font-size: 18px; font-family: Arial; color: #333333">可见AlarmManagerService接受了ACTION_PACKAGE_RESTARTED广播，而且执行了removeLocked（pkg）</span><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px">removeLocked()是做什么的呢？继续看源码：</span></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"></p><div class="dp-highlighter bg_java" style="font-family: Consolas, 'Courier New', Courier, mono, serif; width: 700.906px; overflow-y: hidden; overflow-x: auto; padding-top: 1px; position: relative; color: #333333; line-height: 26px; margin: 18px 0px !important; background-color: #e7e5dc"><div class="bar" style="padding-left: 45px"><div class="tools" style="padding: 3px 8px 10px 10px; font-stretch: normal; font-size: 9px; line-height: normal; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; color: silver; border-left-width: 3px; border-left-style: solid; border-left-color: #6ce26c; background-color: #f8f8f8"><strong>[java]</strong> <a style="color: #a0a0a0; text-decoration: none; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; display: inline-block; width: 16px; height: 16px; text-indent: -2000px; background-image: url('http://static.blog.csdn.net/scripts/SyntaxHighlighter/styles/images/default/ico_plain.gif'); background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat" href="http://blog.csdn.net/gemmem/article/details/8858461#" title="view plain" class="ViewSource">view plain</a><span> <a style="color: #a0a0a0; text-decoration: none; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; display: inline-block; width: 16px; height: 16px; text-indent: -2000px; background-image: url('http://static.blog.csdn.net/scripts/SyntaxHighlighter/styles/images/default/ico_copy.gif'); background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat" href="http://blog.csdn.net/gemmem/article/details/8858461#" title="copy" class="CopyToClipboard">copy</a></span></div></div><ol class="dp-j" style="padding: 0px; border: none; color: #5c5c5c; margin: 0px 0px 1px 45px !important; background-color: #ffffff"><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit"><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&lt;span style=</span><span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit" class="string">&quot;font-size:18px;&quot;</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&gt;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">public</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit"> </span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">void</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit"> removeLocked(String packageName) &#123;&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;removeLocked(mRtcWakeupAlarms, packageName);&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;removeLocked(mRtcAlarms, packageName);&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;removeLocked(mElapsedRealtimeWakeupAlarms, packageName);&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;removeLocked(mElapsedRealtimeAlarms, packageName);&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&#125;&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">private</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit"> </span><span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">void</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit"> removeLocked(ArrayList&lt;Alarm&gt; alarmList,&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String packageName) &#123;&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">if</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit"> (alarmList.size() &lt;= </span><span style="margin: 0px; padding: 0px; border: none; color: #c00000; background-color: inherit" class="number">0</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">) &#123;&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">return</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">;&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125;&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; color: #008200; background-color: inherit" class="comment">// iterator over the list removing any it where the intent match</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit">&nbsp;&nbsp;</span></span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Iterator&lt;Alarm&gt; it = alarmList.iterator();&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">while</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit"> (it.hasNext()) &#123;&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Alarm alarm = it.next();&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin: 0px; padding: 0px; border: none; font-weight: bold; color: #006699; background-color: inherit" class="keyword">if</span><span style="margin: 0px; padding: 0px; border: none; background-color: inherit"> (alarm.operation.getTargetPackage().equals(packageName)) &#123;&nbsp;&nbsp;</span></span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;it.remove();&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125;&nbsp;&nbsp;</span></li><li style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important; background-color: #f8f8f8"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#125;&nbsp;&nbsp;</span></li><li class="alt" style="border-style: none none none solid; border-left-width: 3px; border-left-color: #6ce26c; list-style: decimal-leading-zero outside; color: inherit; line-height: 18px; margin: 0px !important; padding: 0px 3px 0px 10px !important"><span style="margin: 0px; padding: 0px; border: none; color: black; background-color: inherit">&nbsp;&nbsp;&nbsp;&nbsp;&#125;&lt;/span&gt;&nbsp;&nbsp;</span></li></ol></div><span style="line-height: 26px; font-size: 18px; font-family: Arial; color: #333333"><br />看到这里，大家应该明白了，removeLocked就是将对应package设置的所有类型的alarm都remove掉。</span><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px">看到这里大家应该知道为什么自己设置的alarm会不起作用了吧？</span></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px">思考：</span></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px"><span style="color: #ff0000"><strong>为什么google要加入这样的机制呢？</strong></span></span></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px">应该是出于系统安全的考虑，google在4.0系统中在安全方面做了很多努力。</span></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px">很多病毒程序都不希望自己的进程被用户强行停止，希望自己的病毒程序可以一直运行，而常见的方式就是通过设置alarm，在病毒进程被杀死后，通过定时发送广播来拉起病毒进程，来实现病毒进程的重新启动。</span></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px">google也正是看到了这个一点，所以加入了forceStopPackage的这一机制，让用户能够有机会干掉病毒进程。</span></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-size: 18px">android系统的安全性一直是android系统的短板，google在提升系统安全性方面也在不断努力，在之后的文章中，我会再进行介绍。</span></p>
]]>
</description>
</item><item>
<link>http://i.renjihe.com/blog/read.php?7404</link>
<title><![CDATA[Android中程序的停止状态详细介绍]]></title> 
<author>renjihe1988 &lt;admin@yourname.com&gt;</author>
<category><![CDATA[Android]]></category>
<pubDate>Fri, 22 Jul 2016 11:39:07 +0000</pubDate> 
<guid>http://i.renjihe.com/blog/read.php?7404</guid> 
<description>
<![CDATA[ 
	<p style="margin: 0px; padding: 5px 0px; font-size: 14px; font-family: tahoma, arial, 宋体; line-height: 25.2px">很多人遇到过广播收不到的问题,比如Google Play推广安装广播没有收到等,诸如这些问题,又都是什么原因呢,这篇文章将进行回答.</p><p style="margin: 0px; padding: 5px 0px; font-size: 14px; font-family: tahoma, arial, 宋体; line-height: 25.2px">从Android 3.1(HoneyComb) 也就是API 12开始,Android引入了一套新的启动控制,这就是程序的停止状态.那让我们看一下Google对于程序的停止状态的描述.</p><p style="margin: 0px; padding: 5px 0px; font-size: 14px; font-family: tahoma, arial, 宋体; line-height: 25.2px"><strong>什么是程序的停止状态<br /></strong></p><div class="codetitle" style="margin: 3px auto 0px; padding: 0px 3px; width: 640px; clear: both; font-size: 14px; border-top-color: #0099cc; border-right-color: #0099cc; border-left-color: #0099cc; border-top-width: 1px; border-right-width: 1px; border-left-width: 1px; border-top-style: solid; border-right-style: solid; border-left-style: solid; line-height: 25.2px; font-family: tahoma, arial, 宋体; background: #f2f6fb"><span style="line-height: 21.6px; font-size: 12px; float: right"><a id="copybut24589" style="color: #333333; cursor: pointer" class="copybut"><u>复制代码</u></a></span>代码如下:</div><div id="code24589" class="codebody" style="margin: 0px auto 3px; padding: 0px 3px 0px 5px; line-height: 25.2px; font-size: 14px; border: 1px solid #0099cc; width: 638px; clear: both; font-family: tahoma, arial, 宋体; background: #ddedfb"><br />Starting from Android 3.1, the system's package manager keeps track of applications that are in a stopped state and provides a means of controlling their launch from background processes and other applications.<p style="margin: 0px; padding: 5px 0px"></p><p style="margin: 0px; padding: 5px 0px">从Android 3.1开始,系统的包管理器开始跟踪处理停止状态的程序.并且提供了方法来控制从后台进程或者其他程序对它们的启动.</p><p style="margin: 0px; padding: 5px 0px">Note that an application's stopped state is not the same as an Activity's stopped state. The system manages those two stopped states separately.</p><p style="margin: 0px; padding: 5px 0px">注意 程序的停止状态和Activity的停止状态不同,系统会单独处理这两种状态.</p><p style="margin: 0px; padding: 5px 0px">The platform defines two new intent flags that let a sender specify whether the Intent should be allowed to activate components in stopped application. Android平台提供了两个intent flags,用来让发送广播的一方决定广播是否需要同时发送给已经停止的程序.</p><p style="margin: 0px; padding: 5px 0px">FLAG_INCLUDE_STOPPED_PACKAGES &mdash; Include intent filters of stopped applications in the list of potential targets to resolve against. 将已经支持的程序加入到能处理intent的目标处理者.</p><p style="margin: 0px; padding: 5px 0px">FLAG_EXCLUDE_STOPPED_PACKAGES &mdash; Exclude intent filters of stopped applications from the list of potential targets. 在能处理intent的目标处理者中不包含已经停止的程序.<br /></p></div><br /><span style="font-size: 14px; line-height: 25.2px; font-family: tahoma, arial, 宋体">当如果intnet中没有或者设置了上面两个flag,在目标处理者中是包含已经处于停止的程序.但是注意,系统会为所有的广播intent增加FLAG_EXCLUDE_STOPPED_PACKAGES这个flag.</span><p style="margin: 0px; padding: 5px 0px; font-size: 14px; font-family: tahoma, arial, 宋体; line-height: 25.2px"></p><p style="margin: 0px; padding: 5px 0px; font-size: 14px; font-family: tahoma, arial, 宋体; line-height: 25.2px"><strong>为什么Android要引入这一状态<br /></strong></p><div class="codetitle" style="margin: 3px auto 0px; padding: 0px 3px; width: 640px; clear: both; font-size: 14px; border-top-color: #0099cc; border-right-color: #0099cc; border-left-color: #0099cc; border-top-width: 1px; border-right-width: 1px; border-left-width: 1px; border-top-style: solid; border-right-style: solid; border-left-style: solid; line-height: 25.2px; font-family: tahoma, arial, 宋体; background: #f2f6fb"><span style="line-height: 21.6px; font-size: 12px; float: right"><a id="copybut16303" style="color: #333333; cursor: pointer" class="copybut"><u>复制代码</u></a></span>代码如下:</div><div id="code16303" class="codebody" style="margin: 0px auto 3px; padding: 0px 3px 0px 5px; line-height: 25.2px; font-size: 14px; border: 1px solid #0099cc; width: 638px; clear: both; font-family: tahoma, arial, 宋体; background: #ddedfb"><br />Note that the system adds FLAG_EXCLUDE_STOPPED_PACKAGES to all broadcast intents. It does this to prevent broadcasts from background services from inadvertently or unnecessarily launching components of stoppped applications. A background service or application can override this behavior by adding the FLAG_INCLUDE_STOPPED_PACKAGES flag to broadcast intents that should be allowed to activate stopped applications.<br /></div><br /><span style="font-size: 14px; line-height: 25.2px; font-family: tahoma, arial, 宋体">需要注意的是,系统会默认地对所有的广播intent增加一个FLAG_EXCLUDE_STOPPED_PACKAGES的flag,这样做的目的是为了阻止来自后台服务的广播不慎或者启动处于停止状态的程序的不必要的组件.</span><p style="margin: 0px; padding: 5px 0px; font-size: 14px; font-family: tahoma, arial, 宋体; line-height: 25.2px"></p><p style="margin: 0px; padding: 5px 0px; font-size: 14px; font-family: tahoma, arial, 宋体; line-height: 25.2px">通常的intnet广播,处于停止状态的程序的receiver是无法接受到的.那么怎么才能让这些停止状态的程序接受到呢?可以这样做,在后台服务或者应用中发送广播时,增加一个FLAG_INCLUDE_STOPPED_PACKAGES 的flag,意思是包含处于停止状态的程序.这样就可以激活停止状态的程序.</p><p style="margin: 0px; padding: 5px 0px; font-size: 14px; font-family: tahoma, arial, 宋体; line-height: 25.2px">正如上述引用指出,系统默认阻止广播intent发送给处于停止状态的程序包,实际上这是为了保证安全和省电需要.比如说网络变化的广播,如果某些程序注册监听,并且它在得到广播时,做一系列的网络操作,这样必然是很耗能源的.</p><p style="margin: 0px; padding: 5px 0px; font-size: 14px; font-family: tahoma, arial, 宋体; line-height: 25.2px"><strong>激活状态和停止状态的切换</strong></p><p style="margin: 0px; padding: 5px 0px; font-size: 14px; font-family: tahoma, arial, 宋体; line-height: 25.2px">当程序第一次安装并且没有启动,或者用户手动从程序管理将其停止后,程序都会处于停止状态.</p><p style="margin: 0px; padding: 5px 0px; font-size: 14px; font-family: tahoma, arial, 宋体; line-height: 25.2px"><strong>如何变为停止状态</strong></p><p style="margin: 0px; padding: 5px 0px; font-size: 14px; font-family: tahoma, arial, 宋体; line-height: 25.2px">1.在设置应用管理中的应用详情页点击强制停止<br />2.使用adb shell adb shell am force-stop package-name<br />3.使用ActivityManager的隐藏方法forceStopPackages,并且向manifest加入申请权限&lt;uses-permission android:name=&ldquo;android.permission.FORCE_STOP_PACKAGES&rdquo;/&gt;</p><p style="margin: 0px; padding: 5px 0px; font-size: 14px; font-family: tahoma, arial, 宋体; line-height: 25.2px"><strong>如何脱离停止状态</strong></p><p style="margin: 0px; padding: 5px 0px; font-size: 14px; font-family: tahoma, arial, 宋体; line-height: 25.2px">1.手动启动程序<br />2.使用adb激活应用组件,如activity或者receiver</p><p style="margin: 0px; padding: 5px 0px; font-size: 14px; font-family: tahoma, arial, 宋体; line-height: 25.2px"><strong>发送广播intent给处于停止状态的应用</strong></p><p style="margin: 0px; padding: 5px 0px; font-size: 14px; font-family: tahoma, arial, 宋体; line-height: 25.2px">1.在Java代码发送Intent时,加入flag FLAG_INCLUDE_STOPPED_PACKAGES<br />2.如果使用adb,同样是加入FLAG_INCLUDE_STOPPED_PACKAGES(其具体值为32),如adb shell am broadcast -a com.android.vending.INSTALL_REFERRER -f 32</p><p style="margin: 0px; padding: 5px 0px; font-size: 14px; font-family: tahoma, arial, 宋体; line-height: 25.2px"><strong>检查是否处于停止状态</strong></p><p style="margin: 0px; padding: 5px 0px; font-size: 14px; font-family: tahoma, arial, 宋体; line-height: 25.2px">1.进入设置&mdash;应用管理&mdash;某个应用的详细页,如果强制停止按钮不可用,则说明程序已经处于停止状态.<br />2.进入设备终端,查看系统文件cat /data/system/packages-stopped.xml</p><p style="margin: 0px; padding: 5px 0px; font-size: 14px; font-family: tahoma, arial, 宋体; line-height: 25.2px"><strong>问答环节</strong></p><p style="margin: 0px; padding: 5px 0px; font-size: 14px; font-family: tahoma, arial, 宋体; line-height: 25.2px">提问:如果我的程序没有activity只有一个receiver,我改如何激活才能接收到正常的广播intent呢</p><p style="margin: 0px; padding: 5px 0px; font-size: 14px; font-family: tahoma, arial, 宋体; line-height: 25.2px">回答:实际上,如果是上面所述的情况,该应用在安装之后不是处于停止状态,因为它没有任何用户可以直接点击的行为去将它移除停止状态.你可以正常接收广播intent,除非你人为地将它强制停止.</p><p style="margin: 0px; padding: 5px 0px; font-size: 14px; font-family: tahoma, arial, 宋体; line-height: 25.2px">提问:系统的程序刚安装会处于停止状态么?</p><p style="margin: 0px; padding: 5px 0px; font-size: 14px; font-family: tahoma, arial, 宋体; line-height: 25.2px">回答:系统的程序通常会存放在 /system/app目录下,在一开始安装之后不会处于停止状态.</p><p style="margin: 0px; padding: 5px 0px; font-size: 14px; font-family: tahoma, arial, 宋体; line-height: 25.2px">提问:Google Play的推广广播据说是在程序安装完成之后发送,是不是3.1之后受影响么</p><p style="margin: 0px; padding: 5px 0px; font-size: 14px; font-family: tahoma, arial, 宋体; line-height: 25.2px">回答:不受影响的.Google文档说INSTALL_REFERRER会在程序安装完成之后发送,据实际查看日志观察,从3.1之后,是在程序安装后第一次打开时发送.</p>
]]>
</description>
</item><item>
<link>http://i.renjihe.com/blog/read.php?7403</link>
<title><![CDATA[Android 4.0新的广播机制FLAG_EXCLUDE_STOPPED_PACKAGES]]></title> 
<author>renjihe1988 &lt;admin@yourname.com&gt;</author>
<category><![CDATA[Android]]></category>
<pubDate>Fri, 22 Jul 2016 11:38:48 +0000</pubDate> 
<guid>http://i.renjihe.com/blog/read.php?7403</guid> 
<description>
<![CDATA[ 
	<p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-family: 'Microsoft YaHei'">http://ytydyd.blog.sohu.com/232637878.html<br /></span></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"><span style="font-family: 'Microsoft YaHei'"><br /></span></p><p style="color: #333333; font-family: Arial; font-size: 14px; line-height: 26px"></p><div style="color: #333333; font-family: Arial; font-size: 14px; line-height: 22px; margin: 0px auto; padding: 0px; border: 0px"><span style="font-family: 'Microsoft YaHei'">[本人补充：系统应用不受此规则限制]</span></div><div style="color: #333333; font-family: Arial; font-size: 14px; line-height: 22px; margin: 0px auto; padding: 0px; border: 0px"><span style="font-family: 'Microsoft YaHei'">&nbsp;</span></div><div style="color: #333333; font-family: Arial; font-size: 14px; line-height: 22px; margin: 0px auto; padding: 0px; border: 0px"><span style="font-family: 'Microsoft YaHei'">（一）</span></div><div style="color: #333333; font-family: Arial; font-size: 14px; line-height: 22px; margin: 0px auto; padding: 0px; border: 0px"><span style="font-family: 'Microsoft YaHei'">&nbsp;</span><div style="line-height: 25px; margin: 0px auto; padding: 0px; border: 0px"><p style="margin-top: 10px; margin-bottom: 10px"><span style="font-family: 'Microsoft YaHei'">在做<a style="color: #df3434; text-decoration: none; font-weight: bold" href="http://lib.csdn.net/base/15" target="_blank" title="undefined" class="replace_word">Android</a>开发时，很多应用由于各种目的，希望在机器启动时被唤醒，一般的做法是写一个BroadcastReceiver，接收对应的boot action，当然别忘了在Manifest中添加permission &quot;android.permission.RECEIVE_BOOT_COMPLETED&ldquo;。但是最近在做4.0开发时，有同事声称这个广播接收不到了，同时其他有人又说自己的能接收到，到底是怎么回事呢。</span></p><p style="margin-top: 10px; margin-bottom: 10px"><span style="font-family: 'Microsoft YaHei'">原来，在3.1之后，系统的package manager增加了对处于&ldquo;stopped state&rdquo;应用的管理，这个stopped和Activity生命周期中的stop状态是完全两码事，指的是安装后从来没有启动过和被用户手动强制停止的应用，与此同时系统增加了2个Flag：<a style="color: #336699; text-decoration: none" href="http://developer.android.com/reference/android/content/Intent.html#FLAG_INCLUDE_STOPPED_PACKAGES" target="_blank"><span style="color: #ff0000">FLAG_INCLUDE_STOPPED_PACKAGES</span></a>和<a style="color: #336699; text-decoration: none" href="http://developer.android.com/reference/android/content/Intent.html#FLAG_EXCLUDE_STOPPED_PACKAGES" target="_blank"><span style="color: #ff0000">FLAG_EXCLUDE_STOPPED_PACKAGES</span></a>&nbsp;，来标识一个intent是否激活处于&ldquo;stopped state&rdquo;的应用。当2个Flag都不设置或者都进行设置的时候，采用的是<a style="color: #336699; text-decoration: none" href="http://developer.android.com/reference/android/content/Intent.html#FLAG_INCLUDE_STOPPED_PACKAGES" target="_blank"><span style="color: #ff0000">FLAG_INCLUDE_STOPPED_PACKAGES</span></a>的效果。</span></p><p style="margin-top: 10px; margin-bottom: 10px"><span style="font-family: 'Microsoft YaHei'">有了上面的新机制之后，google觉得给所有的广播intent默认加上<a style="color: #704229; text-decoration: none" href="http://developer.android.com/reference/android/content/Intent.html#FLAG_EXCLUDE_STOPPED_PACKAGES" target="_blank">FLAG_EXCLUDE_STOPPED_PACKAGES</a>会非常的Cooooool，能在一定程度上避免流氓软件、病毒啊干坏事，还能提高效率，就导致了本文题目中说的问题，RECEIVE_BOOT_COMPLETED广播如果用户没有运行过应用，就不会响应了。</span></p><p style="margin-top: 10px; margin-bottom: 10px"><span style="font-family: 'Microsoft YaHei'">不过google还是留了点余地，允许应用和后台服务通过给广播intent设置<a style="color: #336699; text-decoration: none" href="http://developer.android.com/reference/android/content/Intent.html#FLAG_INCLUDE_STOPPED_PACKAGES" target="_blank"><span style="color: #ff0000">FLAG_INCLUDE_STOPPED_PACKAGES</span></a>来唤醒处于&ldquo;stopped state&rdquo;的程序，也就是用户自己写的广播intent可以控制这个机制，但是系统自带的广播intent，由于不能修改，就只能接受这个现实了。</span></p><p style="margin-top: 10px; margin-bottom: 10px"><span style="font-family: 'Microsoft YaHei'">&nbsp;</span></p><p style="margin-top: 10px; margin-bottom: 10px"><span style="font-family: 'Microsoft YaHei'">（二）</span></p></div></div><div style="color: #333333; font-family: Arial; font-size: 14px; line-height: 22px; margin: 0px auto; padding: 0px; border: 0px"><span style="font-family: 'Microsoft YaHei'">android 4.0为了防止一些malware（恶意软件）不经用户启动就在后台运行，默认安装的程序在用户启动前是完全被系统忽略的，即使程序注册了广播，系统也不会给该程序传递广播。只有程序被用户运行过之后，消息广播才会生效。而且，即使程序已经运行过了，如果被用户Force Stop（强制停止），又会回到被系统忽略的状态。这个问题其实从3.1的时候就已经有了，最近用4.0的系统测试才发现了这个问题的存在，引起不少麻烦。</span><p style="line-height: 25px; margin-top: 10px; margin-bottom: 10px"><span style="font-family: 'Microsoft YaHei'">Broadcast Regression Confirmed<br />In a previous post, I cited evidence that the BOOT_COMPLETED broadcast will not work out of the box on Android 3.1 until the user uses your app.<br />It&rsquo;s actually somewhat bigger than that.<br />In the issue that I filed seeking clarification, Ms. Hackborn indicated:<br />Starting with 3.1 when applications are installed they are in a &ldquo;stopped&rdquo; state so they will not be able to run until the user explicitly launches them. Pressing Force Stop will return them to this state.<br />As a result, when applications are first installed, they are totally ignored by the system until and unless the user manually launches something: clicking on a launcher activity or adding an app widget, most likely.<br />Developers who had been relying upon getting some sort of system broadcast without user intervention will need to adjust their apps for Android 3.1.<br />As I wrote in the previous post:<br />I expect that most apps will be OK. For example, if your boot receiver is there to establish an AlarmManager schedule, you also needed to establish that schedule when the app is first run, so the user does not have to reboot their phone just to set up your alarms. That pattern doesnot change &ndash; it&rsquo;s just that if the user happens to reboot the phone, it will not set up your alarms, until the user runs one of your activities.<br />UPDATE: To clarify the above quote, once the user runs the app for the first time (and does not Force Stop it), everything behaves as before &mdash; a reboot will cause BOOT_COMPLETED broadcasts to be received and so on. However, if the user installs the app, until and unless they run the app manually, no broadcasts will be received. And if the user force-stops the app, until and unless they run the app manually, no broadcasts will be received.<br />This change is not terribly shocking, as it ratchets up the security another notch by limiting ways malware can run without user knowledge. While it does not offer perfect security &mdash; the malware can still install its own copy of an Angry Birds launcher icon and hope users screw up &mdash; it is an improvement.<br /><br /><br /></span></p><p style="line-height: 26px">&nbsp;在做<a style="color: #df3434; text-decoration: none; font-weight: bold" href="http://lib.csdn.net/base/15" target="_blank" title="undefined" class="replace_word">Android</a>开发时，很多应用由于各种目的，希望在机器启动时被唤醒，一般的做法是写一个BroadcastReceiver，接收对应的boot action，当然别忘了在Manifest中添加permission &quot;android.permission.RECEIVE_BOOT_COMPLETED&ldquo;。但是最近在做4.0开发时，有同事声称这个广播接收不到了，同时其他有人又说自己的能接收到，到底是怎么回事呢。</p><p style="line-height: 26px">&nbsp; &nbsp; 原来，在3.1之后，系统的package manager增加了对处于&ldquo;stopped state&rdquo;应用的管理，这个stopped和Activity生命周期中的stop状态是完全两码事，指的是安装后从来没有启动过和被用户手动强制停止的应用，与此同时系统增加了2个Flag：<a style="color: #336699; text-decoration: none" href="http://developer.android.com/reference/android/content/Intent.html#FLAG_INCLUDE_STOPPED_PACKAGES">FLAG_INCLUDE_STOPPED_PACKAGES</a>和<a style="color: #336699; text-decoration: none" href="http://developer.android.com/reference/android/content/Intent.html#FLAG_EXCLUDE_STOPPED_PACKAGES">FLAG_EXCLUDE_STOPPED_PACKAGES</a>&nbsp;，来标识一个intent是否激活处于&ldquo;stopped state&rdquo;的应用。当2个Flag都不设置或者都进行设置的时候，采用的是<a style="color: #336699; text-decoration: none" href="http://developer.android.com/reference/android/content/Intent.html#FLAG_INCLUDE_STOPPED_PACKAGES">FLAG_INCLUDE_STOPPED_PACKAGES</a>的效果。</p><p style="line-height: 26px">&nbsp; &nbsp; 有了上面的新机制之后，google觉得给所有的广播intent默认加上<a style="color: #336699; text-decoration: none" href="http://developer.android.com/reference/android/content/Intent.html#FLAG_EXCLUDE_STOPPED_PACKAGES">FLAG_EXCLUDE_STOPPED_PACKAGES</a>会非常的Cooooool，能在一定程度上避免流氓软件、病毒啊干坏事，还能提高效率，就导致了本文题目中说的问题，RECEIVE_BOOT_COMPLETED广播如果用户没有运行过应用，就不会响应了。</p><p style="line-height: 26px">&nbsp; &nbsp; 不过google还是留了点余地，允许应用和后台服务通过给广播intent设置<a style="color: #336699; text-decoration: none" href="http://developer.android.com/reference/android/content/Intent.html#FLAG_INCLUDE_STOPPED_PACKAGES">FLAG_INCLUDE_STOPPED_PACKAGES</a>来唤醒处于&ldquo;stopped state&rdquo;的程序，也就是用户自己写的广播intent可以控制这个机制，但是系统自带的广播intent，由于不能修改，就只能接受这个现实了。</p><p style="line-height: 26px">解决方案：定制系统，修改framework<span style="line-height: 25px; font-family: Verdana, Arial, Tahoma">,把系统发bootcompleteIntent的地方改一下,在intent里设上FLAG_EXCLUDE_STOPPED_PACKAGES,那样在这个系统里,你的APP就可以开机启动了.</span></p></div>
]]>
</description>
</item><item>
<link>http://i.renjihe.com/blog/read.php?7402</link>
<title><![CDATA[android AlarmManager使用初探]]></title> 
<author>renjihe1988 &lt;admin@yourname.com&gt;</author>
<category><![CDATA[Android]]></category>
<pubDate>Fri, 22 Jul 2016 11:38:22 +0000</pubDate> 
<guid>http://i.renjihe.com/blog/read.php?7402</guid> 
<description>
<![CDATA[ 
	<p style="margin: 10px auto; padding: 0px; color: #111111; font-size: 13px; line-height: 23.4px">引子：　　</p><p style="margin: 10px auto; padding: 0px; color: #111111; font-size: 13px; line-height: 23.4px">　　可悲的5月29号，由于在android手机中安装的&ldquo;正点闹钟&rdquo;没有响，让我错过了欧冠联赛决赛。完美的巴萨用完美的进球赢了完美的比赛，可我只能在第二天，看看下载的比赛实况，聊以自慰。痛定思痛，我觉得做个简单的闹钟程序。但事情好像并不那么简单&hellip;&hellip;</p><p style="margin: 10px auto; padding: 0px; color: #111111; font-size: 13px; line-height: 23.4px">　　通过粗略查看SDK，初步决定使用service，在service中注册Intent.ACTION_TIME_TICK事件的BroadcastReceiver，每隔一分钟遍历一次定时器表，来判断是否响铃。但在测试中遇到了许多问题，试举几例：</p><ol style="margin: 0px; padding: 0px 0px 0px 40px; color: #111111; font-size: 13px; line-height: 23.4px"><li style="margin: 0px; padding: 0px; list-style: decimal inside">普通优先级的service会在系统资源不够时，被自动回收（kill掉）。</li><li style="margin: 0px; padding: 0px; list-style: decimal inside">被kill掉后，有时能自动被重新启动，有时却不能。</li><li style="margin: 0px; padding: 0px; list-style: decimal inside">service.setForeground在2.3系统中不再被支持。</li><li style="margin: 0px; padding: 0px; list-style: decimal inside">service.startForeground（设置前台服务模式）可以支持，但必须在状态栏一直显示notification icon。</li><li style="margin: 0px; padding: 0px; list-style: decimal inside">前台服务模式可能会阻止设备深度休眠，进而增加设备耗电量。（条件所限，无法测试，所以不能确定，仅仅推测。）</li></ol><p style="margin: 10px auto; padding: 0px; color: #111111; font-size: 13px; line-height: 23.4px">　　在测试中，根据遇到的这些问题，对症下药，最终一一解决，但最后一个问题一直让我放心不下，后来通过查询stackoverflow，并收到同事的建议，决定用AlarmManager实现闹钟，因为它至少可以保证不会出现最后一个问题。这是查到的两个讨论：</p><ol style="margin: 0px; padding: 0px 0px 0px 40px; color: #111111; font-size: 13px; line-height: 23.4px"><li style="margin: 0px; padding: 0px; list-style: decimal inside"><a style="margin: 0px; padding: 0px; color: #444444; cursor: pointer" href="http://stackoverflow.com/questions/5120185/android-sleep-standby-mode">http://stackoverflow.com/questions/5120185/android-sleep-standby-mode</a></li><li style="margin: 0px; padding: 0px; list-style: decimal inside"><a style="margin: 0px; padding: 0px; color: #444444; cursor: pointer" href="http://stackoverflow.com/questions/5007721/android-sleep-stages-levels-on-an-android-device">http://stackoverflow.com/questions/5007721/android-sleep-stages-levels-on-an-android-device</a></li></ol><p style="margin: 10px auto; padding: 0px; color: #111111; font-size: 13px; line-height: 23.4px">正文：</p><p style="margin: 10px auto; padding: 0px; color: #111111; font-size: 13px; line-height: 23.4px">　　这里也有两篇很好的文章来讲如何使用AlarmManager，请先参考：</p><ol style="margin: 0px; padding: 0px 0px 0px 40px; color: #111111; font-size: 13px; line-height: 23.4px"><li style="margin: 0px; padding: 0px; list-style: decimal inside"><a style="margin: 0px; padding: 0px; color: #0066cc" href="https://github.com/commonsguy/cw-advandroid/tree/master/SystemServices/Alarm">https://github.com/commonsguy/cw-advandroid/tree/master/SystemServices/Alarm</a>&nbsp;&nbsp;&nbsp; 这是源代码，结构很清晰，代码全是自注释的。</li><li style="margin: 0px; padding: 0px; list-style: decimal inside"><a style="margin: 0px; padding: 0px; color: #0066cc" href="http://aswang.iteye.com/blog/875863">http://aswang.iteye.com/blog/875863</a>&nbsp; 这是中国程序员写的，言简意赅，特别是倒数第二段话，曾帮了我大忙。</li></ol><p style="margin: 10px auto; padding: 0px; color: #111111; font-size: 13px; line-height: 23.4px">　　在这两篇文章之外，我仅列举一些编程时的注意点：</p><ol style="margin: 0px; padding: 0px 0px 0px 40px; color: #111111; font-size: 13px; line-height: 23.4px"><li style="margin: 0px; padding: 0px; list-style: decimal inside">设置闹钟使用AlarmManager.set()函数，它的triggerAtTime参数，如果要用Calendar.getTimesInMillis()获得，就必须先设置Calendar对象，例如要让闹钟在当天的16:30分启动，就要设置HOUR_OF_DAY（16）、MINUTE（30）、MILLISECOND（0），特别是HOUR_OF_DAY，我一开始误用了HOUR，这是12进制计时方法，HOUR_OF_DAY是24进制计时方法。</li><li style="margin: 0px; padding: 0px; list-style: decimal inside">针对同一个PendingIntent，AlarmManager.set()函数不能设置多个alarm。调用该函数时，假如已经有old alarm使用相同的PendingIntent，会先取消（cancel）old alarm，然后再设置新的alarm。如何判断是否已经有相同的PendingIntent，请看下条。</li><li style="margin: 0px; padding: 0px; list-style: decimal inside">取消alarm使用AlarmManager.cancel()函数，传入参数是个PendingIntent实例。该函数会将所有跟这个PendingIntent相同的Alarm全部取消，怎么判断两者是否相同，android使用的是intent.filterEquals()，具体就是判断两个PendingIntent的action、data、type、class和category是否完全相同。</li><li style="margin: 0px; padding: 0px; list-style: decimal inside">在AndroidManifest.xml中静态注册BroadcastReceiver时，一定使用android：process=&quot;:xxx&quot;属性，因为SDK已注明：<strong style="margin: 0px; padding: 0px">If the name assigned to this attribute begins with a colon (':'), a new process, private to the application, is created when it's needed and the broadcast receiver runs in that process.</strong></li></ol>
]]>
</description>
</item><item>
<link>http://i.renjihe.com/blog/read.php?7401</link>
<title><![CDATA[android避免AlarmManager被kill]]></title> 
<author>renjihe1988 &lt;admin@yourname.com&gt;</author>
<category><![CDATA[Android]]></category>
<pubDate>Fri, 22 Jul 2016 11:38:06 +0000</pubDate> 
<guid>http://i.renjihe.com/blog/read.php?7401</guid> 
<description>
<![CDATA[ 
	<p style="color: #333333; font-size: 14px; font-family: tahoma, 宋体; line-height: 22px; text-align: justify; background-color: #fafafc">在<a style="color: #b32bd5; text-decoration: none" href="http://www.linuxidc.com/topicnews.aspx?tid=11" target="_blank" title="Android">Android</a>中，AlarmManager提供了不受休眠状态的系统定时功能，其一般使用方法如下。</p><p style="color: #333333; font-size: 14px; font-family: tahoma, 宋体; line-height: 22px; text-align: justify; background-color: #fafafc">1、创建一个BroadcastReceiver类的子类，接收定时器事件：</p><ol style="color: #333333; font-size: 14px; font-family: tahoma, 宋体; line-height: 22px; text-align: justify; background-color: #fafafc"><li class="alt"><span class="keyword"><strong><span style="color: #006699">public</span></strong></span>&nbsp;<span class="keyword"><strong><span style="color: #006699">class</span></strong></span>&nbsp;MyReceiver&nbsp;<span class="keyword"><strong><span style="color: #006699">extends</span></strong></span>&nbsp;BroadcastReceiver&nbsp;&#123;&nbsp;</li><li>&nbsp;</li><li class="alt">......&nbsp;</li><li>&nbsp;</li><li class="alt">&#125;&nbsp;</li></ol><p style="color: #333333; font-size: 14px; font-family: tahoma, 宋体; line-height: 22px; text-align: justify; background-color: #fafafc">2、在AndroidMenifest.xml中定义上述广播事件接收类的定义：</p><ol style="color: #333333; font-size: 14px; font-family: tahoma, 宋体; line-height: 22px; text-align: justify; background-color: #fafafc"><li class="alt"><strong><span style="color: #993300"><span class="tag">&lt;</span><span class="tag-name">receiver</span></span></strong>&nbsp;<span class="attribute"><span style="color: #ff0000">android:name</span></span>=<span class="attribute-value"><span style="color: #0000ff">&quot;.MyReceiver&quot;</span></span><span class="tag"><strong><span style="color: #993300">&gt;</span></strong></span>&nbsp;</li><li><strong><span style="color: #993300"><span class="tag">&lt;/</span><span class="tag-name">receiver</span><span class="tag">&gt;</span></span></strong>&nbsp;</li></ol><p style="color: #333333; font-size: 14px; font-family: tahoma, 宋体; line-height: 22px; text-align: justify; background-color: #fafafc">3、在程序中在需要时设置定时器：</p><ol style="color: #333333; font-size: 14px; font-family: tahoma, 宋体; line-height: 22px; text-align: justify; background-color: #fafafc"><li class="alt">Intent&nbsp;intent&nbsp;=&nbsp;<span class="keyword"><strong><span style="color: #006699">new</span></strong></span>&nbsp;Intent(context,MyReceiver.<span class="keyword"><strong><span style="color: #006699">class</span></strong></span>);&nbsp; &nbsp;</li><li>PendingIntent&nbsp;pendingIntent&nbsp;=&nbsp;PendingIntent.getBroadcast(context,&nbsp;<span class="number"><span style="color: #c00000">0</span></span>,&nbsp;intent,&nbsp;PendingIntent.FLAG_UPDATE_CURRENT);&nbsp; &nbsp;</li><li class="alt">AlarmManager&nbsp;alarmManager&nbsp;=&nbsp;(AlarmManager)&nbsp;context.getSystemService(Context.ALARM_SERVICE);&nbsp;</li><li>alarmManager.set(AlarmManager.ELAPSED_REALTIME_WAKEUP&nbsp;,&nbsp;SystemClock.elapsedRealtime()&nbsp;+&nbsp;ms,&nbsp;pendingIntent);&nbsp;</li></ol><p style="color: #333333; font-size: 14px; font-family: tahoma, 宋体; line-height: 22px; text-align: justify; background-color: #fafafc">经过ms毫秒之后，MyReceiver会被调用，从而实现定时触发。</p><p style="color: #333333; font-size: 14px; font-family: tahoma, 宋体; line-height: 22px; text-align: justify; background-color: #fafafc">但是，上述实现存在一个问题：如果设置定时器的进程被杀死之后，定时器事件就不会触发。而在<a style="color: #df3434; text-decoration: none; font-weight: bold" href="http://lib.csdn.net/base/15" target="_blank" title="undefined" class="replace_word">Android</a>中，系统在需要时会自动终止后台进程，因此在定时过程中，进程被杀死的可能性是非常之大的，特别是在一些内存较少的设备中，基本上后台进程所设置的定时器很难被触发。</p><p style="color: #333333; font-size: 14px; font-family: tahoma, 宋体; line-height: 22px; text-align: justify; background-color: #fafafc">为了让定时器在进程被终止后还能触发，需要对上述实现做一个小的修改：在AndroidMefest.xml中如下定义广播接收类：</p><ol style="color: #333333; font-size: 14px; font-family: tahoma, 宋体; line-height: 22px; text-align: justify; background-color: #fafafc"><li class="alt"><strong><span style="color: #993300"><span class="tag">&lt;</span><span class="tag-name">receiver</span></span></strong>&nbsp;<span class="attribute"><span style="color: #ff0000">android:name</span></span>=<span class="attribute-value"><span style="color: #0000ff">&quot;.MyReceiver&quot;</span></span>&nbsp;<span class="attribute"><span style="color: #ff0000">android:process</span></span>=<span class="attribute-value"><span style="color: #0000ff">&quot;:newinst&quot;</span></span><span class="tag"><strong><span style="color: #993300">&gt;</span></strong></span>&nbsp;</li><li><strong><span style="color: #993300"><span class="tag">&lt;/</span><span class="tag-name">receiver</span><span class="tag">&gt;</span></span></strong>&nbsp;</li></ol>
]]>
</description>
</item>
</channel>
</rss>