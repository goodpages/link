<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0">
<channel>
<title><![CDATA[流浪的龙－个人知识管理]]></title> 
<link>http://i.renjihe.com/blog/index.php</link> 
<description><![CDATA[]]></description> 
<language>zh-cn</language> 
<copyright><![CDATA[流浪的龙－个人知识管理]]></copyright>
<item>
<link>http://i.renjihe.com/blog/read.php?</link>
<title><![CDATA[nodejs搭建本地http服务器]]></title> 
<author>renjihe1988 &lt;admin@yourname.com&gt;</author>
<category><![CDATA[web]]></category>
<pubDate>Fri, 26 Aug 2016 17:28:20 +0000</pubDate> 
<guid>http://i.renjihe.com/blog/read.php?</guid> 
<description>
<![CDATA[ 
	<p style="margin: 10px auto; font-size: 14px; line-height: 25.2000007629395px">由于不做php相关的东西，懒得装apache，干脆利用nodejs搭建一个本地的服务器用于测试。</p><p style="margin: 10px auto; font-size: 14px; line-height: 25.2000007629395px">nodejs这玩意儿吧，对做前端的介入后端简直就是一把利器。而且目前，nodejs也越来越有商用价值。</p><p style="margin: 10px auto; font-size: 14px; line-height: 25.2000007629395px">nodejs其实是非常底层的，从功能上说，它既是apache也是php。像搭建http服务器这种功能，本来是apache已经封装好的，但nodejs需要我们手动来搭建。其实在实际应用中，我们可以使用现成的框架。但这里，我想手动搭建，也加深一下对http服务器的理解。</p><p style="margin: 10px auto; font-size: 14px; line-height: 25.2000007629395px">我们node执行下面这个文件，我命名为http.js，它将创建一个httpServer并监听3000端口。</p><div class="cnblogs_code" style="border: 1px solid #cccccc; padding: 5px; overflow: auto; margin: 5px 0px; font-family: 'Courier New' !important; background-color: #f5f5f5"><div class="cnblogs_code_toolbar" style="margin-top: 5px"><span style="padding-right: 5px; line-height: 1.5 !important" class="cnblogs_code_copy"><a style="color: #1d58d1; border: none !important" title="复制代码"><img style="max-width: 900px; border: none !important" src="http://common.cnblogs.com/images/copycode.gif" border="0" alt="复制代码" /></a></span></div><pre style="margin-top: 0px; margin-bottom: 0px; margin-left: 22px; white-space: pre-wrap; word-wrap: break-word; font-size: 12px !important; font-family: 'Courier New' !important"><span style="line-height: 1.5 !important; color: #0000ff">var</span> PORT = 3000<span style="line-height: 1.5 !important">;&nbsp;&nbsp;</span><span style="line-height: 1.5 !important; color: #0000ff">var</span> http = require('http'<span style="line-height: 1.5 !important">); </span><span style="line-height: 1.5 !important; color: #0000ff">var</span> url=require('url'<span style="line-height: 1.5 !important">); </span><span style="line-height: 1.5 !important; color: #0000ff">var</span> fs=require('fs'<span style="line-height: 1.5 !important">); </span><span style="line-height: 1.5 !important; color: #0000ff">var</span> mine=require('./mine'<span style="line-height: 1.5 !important">).types; </span><span style="line-height: 1.5 !important; color: #0000ff">var</span> path=require('path'<span style="line-height: 1.5 !important">);&nbsp;&nbsp;</span><span style="line-height: 1.5 !important; color: #0000ff">var</span> server = http.createServer(<span style="line-height: 1.5 !important; color: #0000ff">function</span><span style="line-height: 1.5 !important"> (request, response) &#123;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="line-height: 1.5 !important; color: #0000ff">var</span> pathname =<span style="line-height: 1.5 !important"> url.parse(request.url).pathname;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="line-height: 1.5 !important; color: #0000ff">var</span> realPath = path.join(&quot;assets&quot;<span style="line-height: 1.5 !important">, pathname);&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="line-height: 1.5 !important; color: #008000">//</span><span style="line-height: 1.5 !important; color: #008000">console.log(realPath);</span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="line-height: 1.5 !important; color: #0000ff">var</span> ext =<span style="line-height: 1.5 !important"> path.extname(realPath);&nbsp;&nbsp;&nbsp;&nbsp; ext </span>= ext ? ext.slice(1) : 'unknown'<span style="line-height: 1.5 !important">;&nbsp;&nbsp;&nbsp;&nbsp; fs.exists(realPath, </span><span style="line-height: 1.5 !important; color: #0000ff">function</span><span style="line-height: 1.5 !important"> (exists) &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="line-height: 1.5 !important; color: #0000ff">if</span> (!<span style="line-height: 1.5 !important">exists) &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; response.writeHead(</span>404<span style="line-height: 1.5 !important">, &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>'Content-Type': 'text/plain'<span style="line-height: 1.5 !important">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125;);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response.write(</span>&quot;This request URL &quot; + pathname + &quot; was not found on this server.&quot;<span style="line-height: 1.5 !important">);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; response.end();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125; </span><span style="line-height: 1.5 !important; color: #0000ff">else</span><span style="line-height: 1.5 !important"> &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fs.readFile(realPath, </span>&quot;binary&quot;, <span style="line-height: 1.5 !important; color: #0000ff">function</span><span style="line-height: 1.5 !important"> (err, file) &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="line-height: 1.5 !important; color: #0000ff">if</span><span style="line-height: 1.5 !important"> (err) &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; response.writeHead(</span>500<span style="line-height: 1.5 !important">, &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>'Content-Type': 'text/plain'<span style="line-height: 1.5 !important">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125;);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; response.end(err);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125; </span><span style="line-height: 1.5 !important; color: #0000ff">else</span><span style="line-height: 1.5 !important"> &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="line-height: 1.5 !important; color: #0000ff">var</span> contentType = mine[ext] &#124;&#124; &quot;text/plain&quot;<span style="line-height: 1.5 !important">;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; response.writeHead(</span>200<span style="line-height: 1.5 !important">, &#123;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>'Content-Type'<span style="line-height: 1.5 !important">: contentType&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125;);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; response.write(file, </span>&quot;binary&quot;<span style="line-height: 1.5 !important">);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; response.end();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125;);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#125;&nbsp;&nbsp;&nbsp;&nbsp; &#125;); &#125;); server.listen(PORT); console.log(</span>&quot;Server runing at port: &quot; + PORT + &quot;.&quot;);</pre><div class="cnblogs_code_toolbar" style="margin-top: 5px"><span style="padding-right: 5px; line-height: 1.5 !important" class="cnblogs_code_copy"><a style="color: #1d58d1; border: none !important" title="复制代码"><img style="max-width: 900px; border: none !important" src="http://common.cnblogs.com/images/copycode.gif" border="0" alt="复制代码" /></a></span></div></div><p style="margin: 10px auto; font-size: 14px; line-height: 25.2000007629395px">上面我们还引入了一个mine.js，这是我自己写的，里面存储的是名值对，用于定义不同<span style="line-height: 1.5">后缀</span><span style="line-height: 1.5">的文件所对应的返回方式：</span></p><div class="cnblogs_code" style="border: 1px solid #cccccc; padding: 5px; overflow: auto; margin: 5px 0px; font-family: 'Courier New' !important; background-color: #f5f5f5"><div class="cnblogs_code_toolbar" style="margin-top: 5px"><span style="padding-right: 5px; line-height: 1.5 !important" class="cnblogs_code_copy"><a style="color: #1d58d1; border: none !important" title="复制代码"><img style="max-width: 900px; border: none !important" src="http://common.cnblogs.com/images/copycode.gif" border="0" alt="复制代码" /></a></span></div><pre style="margin-top: 0px; margin-bottom: 0px; margin-left: 22px; white-space: pre-wrap; word-wrap: break-word; font-size: 12px !important; font-family: 'Courier New' !important">exports.types =<span style="line-height: 1.5 !important"> &#123;&nbsp;&nbsp; </span>&quot;css&quot;: &quot;text/css&quot;<span style="line-height: 1.5 !important">,&nbsp;&nbsp; </span>&quot;gif&quot;: &quot;image/gif&quot;<span style="line-height: 1.5 !important">,&nbsp;&nbsp; </span>&quot;html&quot;: &quot;text/html&quot;<span style="line-height: 1.5 !important">,&nbsp;&nbsp; </span>&quot;ico&quot;: &quot;image/x-icon&quot;<span style="line-height: 1.5 !important">,&nbsp;&nbsp; </span>&quot;jpeg&quot;: &quot;image/jpeg&quot;<span style="line-height: 1.5 !important">,&nbsp;&nbsp; </span>&quot;jpg&quot;: &quot;image/jpeg&quot;<span style="line-height: 1.5 !important">,&nbsp;&nbsp; </span>&quot;js&quot;: &quot;text/javascript&quot;<span style="line-height: 1.5 !important">,&nbsp;&nbsp; </span>&quot;json&quot;: &quot;application/json&quot;<span style="line-height: 1.5 !important">,&nbsp;&nbsp; </span>&quot;pdf&quot;: &quot;application/pdf&quot;<span style="line-height: 1.5 !important">,&nbsp;&nbsp; </span>&quot;png&quot;: &quot;image/png&quot;<span style="line-height: 1.5 !important">,&nbsp;&nbsp; </span>&quot;svg&quot;: &quot;image/svg+xml&quot;<span style="line-height: 1.5 !important">,&nbsp;&nbsp; </span>&quot;swf&quot;: &quot;application/x-shockwave-flash&quot;<span style="line-height: 1.5 !important">,&nbsp;&nbsp; </span>&quot;tiff&quot;: &quot;image/tiff&quot;<span style="line-height: 1.5 !important">,&nbsp;&nbsp; </span>&quot;txt&quot;: &quot;text/plain&quot;<span style="line-height: 1.5 !important">,&nbsp;&nbsp; </span>&quot;wav&quot;: &quot;audio/x-wav&quot;<span style="line-height: 1.5 !important">,&nbsp;&nbsp; </span>&quot;wma&quot;: &quot;audio/x-ms-wma&quot;<span style="line-height: 1.5 !important">,&nbsp;&nbsp; </span>&quot;wmv&quot;: &quot;video/x-ms-wmv&quot;<span style="line-height: 1.5 !important">,&nbsp;&nbsp; </span>&quot;xml&quot;: &quot;text/xml&quot;<span style="line-height: 1.5 !important"> &#125;;</span></pre><div class="cnblogs_code_toolbar" style="margin-top: 5px"><span style="padding-right: 5px; line-height: 1.5 !important" class="cnblogs_code_copy"><a style="color: #1d58d1; border: none !important" title="复制代码"><img style="max-width: 900px; border: none !important" src="http://common.cnblogs.com/images/copycode.gif" border="0" alt="复制代码" /></a></span></div></div><p style="margin: 10px auto; font-size: 14px; line-height: 25.2000007629395px">fs模块是用于读取文件的，提供读取文件的方法，其实仔细研究文档会发现，它有同步和异步两种读取方式。fs.exists这个方法网上很多文章写作path.exists，，现在推荐写作fs.exists这个方法。否则会报警：</p><p style="margin: 10px auto; font-size: 14px; line-height: 25.2000007629395px"><img style="border: 0px; max-width: 900px" src="http://images.cnitblog.com/blog/423946/201306/06144548-1e93f0d5fde145cd93e0636758f794f5.png" border="0" /></p><p style="margin: 10px auto; font-size: 14px; line-height: 25.2000007629395px">需要注意的是，不仅浏览器访问html文件会形成一次访问，里面链接的js，css等外部文件也会分别形成一次http访问。所以，http.createServer的回调其实是在一次页面访问中执行了多次的。我们<span style="font-size: 12px; line-height: 1.5; font-family: 'Courier New'">console.log(realPath)一下就可以看到：</span></p><p style="margin: 10px auto; font-size: 14px; line-height: 25.2000007629395px"><span style="font-size: 12px; line-height: 1.5; font-family: 'Courier New'"><img style="border: 0px; max-width: 900px" src="http://images.cnitblog.com/blog/423946/201306/06144007-80bf9f37172d4f47a624d09013d29b4b.png" border="0" /></span></p><p style="margin: 10px auto; font-size: 14px; line-height: 25.2000007629395px">&nbsp;</p><p style="margin: 10px auto; font-size: 14px; line-height: 25.2000007629395px">这里并没有加入默认访问index.html的功能，所以访问地址要写全http://127.0.0.1:3000/index.html</p>
]]>
</description>
</item><item>
<link>http://i.renjihe.com/blog/read.php?#blogcomment</link>
<title><![CDATA[[评论] nodejs搭建本地http服务器]]></title> 
<author> &lt;user@domain.com&gt;</author>
<category><![CDATA[评论]]></category>
<pubDate>Thu, 01 Jan 1970 00:00:00 +0000</pubDate> 
<guid>http://i.renjihe.com/blog/read.php?#blogcomment</guid> 
<description>
<![CDATA[ 
	
]]>
</description>
</item>
</channel>
</rss>